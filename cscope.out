cscope 16 E:\web\weixun               0002101774
	@E:\web\weixun\config\admin\config_update.php

1 <?
php


9 
	g$upd©eHo¡
 = '';

10 
	g$lškHo¡
 = '';

	@E:\web\weixun\config\cache\memberlogin\c4\ca\42\c4ca4238a0b923820dcc509a6f75849b.php

1 <?
php
 
ex™
('Warning...');?>

2 
	ga
:2:{
s
:4:"d©a";a:22:{s:3:"mid";
	gs
:1:"1";s:5:"mty³";s:6:"ä¸ªäºº";s:6:"u£rid";s:8:"xakadmš";s:3:"pwd";s:32:"1e6e9fb9d4b2c0815e53579“50c4a85";s:5:"uÇme";s:8:"xakadmš";s:3:"£x";s:3:"ç”·";s:4:"¿nk";s:2:"10";s:6:"u±ime";s:1:"0";s:7:"ex±ime";s:1:"0";s:5:"mÚey";s:1:"0";s:5:"ema";s:0:"";s:6:"scÜes";s:5:"10000";s:4:"m©t";s:2:"10";s:8:"¥aû¡a";s:1:"0";s:4:"çû";s:0:"";s:12:"§ãque¡iÚ";s:1:"0";s:10:"§ãªsw”";s:0:"";s:8:"joštime";s:10:"1380010981";s:6:"još";s:0:"";s:9:"logštime";s:10:"1380386428";s:7:"logš";s:9:"127.0.0.1";s:9:"checkma";s:2:"-1";}s:7:"timeout";
	gi
:1380440086;}

	@E:\web\weixun\config\cache\memberlogin\ec\cb\c8\eccbc87e4b5ce2fe28308fd9f2a7baf3.php

1 <?
php
 
ex™
('Warning...');?>

2 
	ga
:2:{
s
:4:"d©a";a:23:{s:3:"mid";
	gs
:1:"3";s:5:"mty³";s:6:"ä¸ªäºº";s:6:"u£rid";s:5:"digua";s:3:"pwd";s:21:"586e074473fd346«d29d";s:5:"uÇme";s:5:"digua";s:3:"£x";s:3:"ç”·";s:4:"¿nk";s:2:"10";s:6:"u±ime";s:1:"0";s:7:"ex±ime";s:1:"0";s:5:"mÚey";s:1:"0";s:5:"ema";s:13:"digua8@qq.com";s:6:"scÜes";s:1:"0";s:4:"m©t";s:1:"0";s:8:"¥aû¡a";s:1:"2";s:4:"çû";s:0:"";s:12:"§ãque¡iÚ";s:1:"0";s:10:"§ãªsw”";s:0:"";s:8:"joštime";s:10:"1365829761";s:6:"još";s:7:"0.0.0.0";s:9:"logštime";s:10:"1365829880";s:7:"logš";s:7:"0.0.0.0";s:9:"checkma";s:2:"-1";s:5:"hÚÜ";s:0:"";}s:7:"timeout";
	gi
:1365831681;}

	@E:\web\weixun\config\config.cache.bak.php

1 <?
php


2 
	g$cfg_ba£ho¡
 = 'http://127.0.0.6';

3 
	g$cfg_cm¥©h
 = '';

4 
	g$cfg_cook›_’code
 = 'EiTBa3435E';

5 
	g$cfg_šdexu¾
 = '/';

6 
	g$cfg_backup_dœ
 = 'backupdata';

7 
	g$cfg_šdexÇme
 = 'é¦–é¡µ';

8 
	g$cfg_webÇme
 = 'æˆ‘çš„ç½‘ç«™';

9 
	g$cfg_admšema
 = '';

10 
	g$cfg_html_ed™Ü
 = 'ckeditor';

11 
	g$cfg_¬cdœ
 = '';

12 
	g$cfg_medŸs_dœ
 = '/upload';

13 
	g$cfg_ddimg_width
 = 240;

14 
	g$cfg_ddimg_height
 = 180;

15 
	g$cfg_domaš_cook›
 = '';

16 
	g$cfg_imgty³
 = 'jpg|gif|png';

17 
	g$cfg_soáty³
 = 'zip|gz|rar|iso|doc|xsl|ppt|wps';

18 
	g$cfg_medŸty³
 = 'swf|mpg|mp3|rm|rmvb|wmv|wma|wav|mid|mov';

19 
	g$cfg_¥eúÙe
 = 6;

20 
	g$cfg_li¡_symbŞ
 = ' > ';

21 
	g$cfg_nÙ®low¡r
 = 'éå…¸|è‰¾æ»‹ç—…|é˜³ç—¿';

22 
	g$cfg_»¶aû¡r
 = 'å¥¹å¦ˆ|å®ƒå¦ˆ|ä»–å¦ˆ|ä½ å¦ˆ|å»æ­»|è´±äºº';

23 
	g$cfg_ãedbackcheck
 = 'N';

24 
	g$cfg_keywÜd_»¶aû
 = 'Y';

25 
	g$cfg_fck_xhtml
 = 'N';

26 
	g$cfg_df_¡yË
 = 'xak';

27 
	g$cfg_muÉi_s™e
 = 'N';

28 
	g$cfg_xak_log
 = 'N';

29 
	g$cfg_pow”by
 = 'Copyright &copy; 2009-2012 æ·±åœ³å¸‚å“ç¿åˆ›æƒ³ç§‘æŠ€æœ‰é™å…¬å¸ ç‰ˆæƒæ‰€æœ‰';

30 
	g$cfg_¬c¥t™Ë
 = 'N';

31 
	g$cfg_¬ÿuto¥
 = 'N';

32 
	g$cfg_¬ÿuto¥_size
 = 5;

33 
	g$cfg_auÙ_desütiÚ
 = 240;

34 
	g$cfg_áp_ho¡
 = '';

35 
	g$cfg_áp_pÜt
 = 21;

36 
	g$cfg_áp_u£r
 = '';

37 
	g$cfg_áp_pwd
 = '';

38 
	g$cfg_áp_roÙ
 = '/';

39 
	g$cfg_áp_mkdœ
 = 'N';

40 
	g$cfg_ãedback_ck
 = 'Y';

41 
	g$cfg_li¡_sÚ
 = 'Y';

42 
	g$cfg_mb_İ’
 = 'N';

43 
	g$cfg_mb_®bum
 = 'Y';

44 
	g$cfg_mb_u¶ßd
 = 'Y';

45 
	g$cfg_mb_u¶ßd_size
 = 1024;

46 
	g$cfg_mb_£nd®l
 = 'Y';

47 
	g$cfg_mb_rmdown
 = 'Y';

48 
	g$cfg_şi_time
 = 8;

49 
	g$cfg_mb_addÚty³
 = 'swf|mpg|mp3|rm|rmvb|wmv|wma|wav|mid|mov|zip|rar|doc|xsl|ppt|wps';

50 
	g$cfg_mb_max
 = 500;

51 
	g$cfg_keywÜd_like
 = 'N';

52 
	g$cfg_šdex_max
 = 10000;

53 
	g$cfg_šdex_ÿche
 = 86400;

54 
	g$cfg_lÿche
 = 'Y';

55 
	g$cfg_lÿche_dœ
 = '/config/tplcache';

56 
	g$cfg_makesign_ÿche
 = 'N';

57 
	g$cfg_rm_»mÙe
 = 'Y';

58 
	g$cfg_¬c_d–lšk
 = 'N';

59 
	g$cfg_¬c_autİic
 = 'Y';

60 
	g$cfg_¬c_autokeywÜd
 = 'Y';

61 
	g$cfg_t™Ë_maxËn
 = 60;

62 
	g$cfg_®bum_width
 = 800;

63 
	g$cfg_check_t™Ë
 = 'Y';

64 
	g$cfg_®bum_row
 = 3;

65 
	g$cfg_®bum_cŞ
 = 4;

66 
	g$cfg_®bum_·gesize
 = 12;

67 
	g$cfg_®bum_¡yË
 = 2;

68 
	g$cfg_®bum_ddwidth
 = 200;

69 
	g$cfg_mb_nÙ®low
 = 'www,bbs,ftp,mail,user,users,admin,administrator';

70 
	g$cfg_mb_idmš
 = 3;

71 
	g$cfg_mb_pwdmš
 = 3;

72 
	g$cfg_mb_pwdty³
 = '32';

73 
	g$cfg_md_idu¾
 = 'N';

74 
	g$cfg_mb_¿nk
 = 10;

75 
	g$cfg_ãedback_time
 = 30;

76 
	g$cfg_ãedback_num
 = 30;

77 
	g$cfg_md_ma‹¡
 = 'N';

78 
	g$cfg_mb_¥aû¡a
 = -10;

79 
	g$cfg_vdcode_memb”
 = 'Y';

80 
	g$cfg_mb_ckt™Ë
 = 'Y';

81 
	g$cfg_mb_ed™day
 = 7;

82 
	g$cfg_ÿiÿi_sub
 = 2;

83 
	g$cfg_ÿiÿi_add
 = 2;

84 
	g$cfg_ãedback_add
 = 5;

85 
	g$cfg_ãedback_sub
 = 5;

86 
	g$cfg_£¬ch_max
 = 50000;

87 
	g$cfg_£¬ch_maxrc
 = 300;

88 
	g$cfg_£¬ch_time
 = 3;

89 
	g$cfg_baiduÃws_lim™
 = '100';

90 
	g$cfg_upd©•”i
 = '15';

91 
	g$cfg_£ndma_bysm
 = 'Y';

92 
	g$cfg_sm_£rv”
 = 'smtp.163.com';

93 
	g$cfg_sm_pÜt
 = '25';

94 
	g$cfg_sm_u£rma
 = 'demo_xak@163.com';

95 
	g$cfg_sm_u£r
 = 'demo_xak';

96 
	g$cfg_sm_·sswÜd
 = 'xak888UP';

97 
	g$cfg_Úlše_ty³
 = 'nps';

98 
	g$cfg_u¶ßd_sw™ch
 = 'Y';

99 
	g$cfg_®l£¬ch_lim™
 = '1';

100 
	g$cfg_»wr™e
 = 'N';

101 
	g$cfg_d–‘e
 = 'Y';

102 
	g$cfg_keywÜds
 = '';

103 
	g$cfg_desütiÚ
 = '';

104 
	g$cfg_beŸn
 = '';

105 
	g$cfg_Ãed_ty³id2
 = 'Y';

106 
	g$cfg_ÿche_ty³
 = 'id';

107 
	g$cfg_max_çû
 = 50;

108 
	g$cfg_ty³dœ_df
 = 'Y';

109 
	g$cfg_makešdex
 = 'N';

110 
	g$cfg_make_ªdÿt
 = 'N';

111 
	g$cfg_make_´’ext
 = 'Y';

112 
	g$cfg_ãedback_fÜbid
 = 'N';

113 
	g$cfg_jump_Úû
 = 'Y';

114 
	g$cfg_sk_pwd
 = '';

115 
	g$cfg_addÚ_domašbšd
 = 'N';

116 
	g$cfg_addÚ_domaš
 = '';

117 
	g$cfg_df_dutyadmš
 = 'admin';

118 
	g$cfg_mb_®lownÿrc
 = 'Y';

119 
	g$cfg_mb_®low»g
 = 'N';

120 
	g$cfg_mb_admšlock
 = 'N';

121 
	g$cfg_£nd¬c_scÜes
 = 10;

122 
	g$cfg_£ndfb_scÜes
 = 3;

123 
	g$cfg_mb_¥aû®Ïrc
 = 0;

124 
	g$cfg_çû_adds
 = 10;

125 
	g$cfg_mÜešfo_adds
 = 20;

126 
	g$cfg_mÚey_scÜes
 = 50;

127 
	g$cfg_mb_wÇmeÚe
 = 'N';

128 
	g$cfg_¬c_dœÇme
 = 'Y';

129 
	g$cfg_pucÿche_time
 = 36000;

130 
	g$cfg_¬c_şick
 = -1;

131 
	g$cfg_addÚ_§v‘y³
 = 'ymd';

132 
	g$cfg_qk_u¶ßdl™
 = 'Y';

133 
	g$cfg_logš_adds
 = 2;

134 
	g$cfg_u£¿d_adds
 = 10;

135 
	g$cfg_ddimg_fuÎ
 = 'N';

136 
	g$cfg_ddimg_bgcŞÜ
 = 0;

137 
	g$cfg_»¶aû_num
 = 2;

138 
	g$cfg_u¶™pic_cut
 = 'Y';

139 
	g$cfg_®bum_m¬k
 = 'N';

140 
	g$cfg_mb_ãedcheck
 = 'N';

141 
	g$cfg_mb_msgischeck
 = 'N';

142 
	g$cfg_mb_»gšfo
 = 'Y';

143 
	g$cfg_»mÙe_s™e
 = 'N';

144 
	g$cfg_t™Ë_s™e
 = 'N';

145 
	g$cfg_mysql_ty³
 = 'mysqli';

146 
	g$cfg_memÿche_’abË
 = 'N';

147 
	g$cfg_¥hšx_¬tişe
 = 'N';

	@E:\web\weixun\config\config.cache.inc.php

1 <?
php


2 
	g$cfg_ba£ho¡
 = 'http://127.0.0.6';

3 
	g$cfg_cm¥©h
 = '';

4 
	g$cfg_cook›_’code
 = 'KkPUc8363D';

5 
	g$cfg_šdexu¾
 = '/';

6 
	g$cfg_backup_dœ
 = 'backupdata';

7 
	g$cfg_šdexÇme
 = 'é¦–é¡µ';

8 
	g$cfg_webÇme
 = 'å¾®è®­';

9 
	g$cfg_admšema
 = '';

10 
	g$cfg_html_ed™Ü
 = 'ckeditor';

11 
	g$cfg_¬cdœ
 = '';

12 
	g$cfg_medŸs_dœ
 = '/upload';

13 
	g$cfg_ddimg_width
 = 240;

14 
	g$cfg_ddimg_height
 = 180;

15 
	g$cfg_domaš_cook›
 = '';

16 
	g$cfg_imgty³
 = 'jpg|gif|png';

17 
	g$cfg_soáty³
 = 'zip|gz|rar|iso|doc|xsl|ppt|wps';

18 
	g$cfg_medŸty³
 = 'swf|mpg|mp3|rm|rmvb|wmv|wma|wav|mid|mov';

19 
	g$cfg_¥eúÙe
 = 6;

20 
	g$cfg_li¡_symbŞ
 = ' > ';

21 
	g$cfg_nÙ®low¡r
 = 'éå…¸|è‰¾æ»‹ç—…|é˜³ç—¿';

22 
	g$cfg_»¶aû¡r
 = 'å¥¹å¦ˆ|å®ƒå¦ˆ|ä»–å¦ˆ|ä½ å¦ˆ|å»æ­»|è´±äºº';

23 
	g$cfg_ãedbackcheck
 = 'N';

24 
	g$cfg_keywÜd_»¶aû
 = 'Y';

25 
	g$cfg_fck_xhtml
 = 'N';

26 
	g$cfg_df_¡yË
 = 'xak';

27 
	g$cfg_muÉi_s™e
 = 'N';

28 
	g$cfg_xak_log
 = 'N';

29 
	g$cfg_pow”by
 = 'Copyright &copy; 2009-2013 æ·±åœ³å¸‚å“ç¿åˆ›æƒ³ç§‘æŠ€æœ‰é™å…¬å¸ ç‰ˆæƒæ‰€æœ‰';

30 
	g$cfg_¬c¥t™Ë
 = 'N';

31 
	g$cfg_¬ÿuto¥
 = 'N';

32 
	g$cfg_¬ÿuto¥_size
 = 5;

33 
	g$cfg_auÙ_desütiÚ
 = 240;

34 
	g$cfg_áp_ho¡
 = '';

35 
	g$cfg_áp_pÜt
 = 21;

36 
	g$cfg_áp_u£r
 = '';

37 
	g$cfg_áp_pwd
 = '';

38 
	g$cfg_áp_roÙ
 = '/';

39 
	g$cfg_áp_mkdœ
 = 'N';

40 
	g$cfg_ãedback_ck
 = 'Y';

41 
	g$cfg_li¡_sÚ
 = 'Y';

42 
	g$cfg_mb_İ’
 = 'N';

43 
	g$cfg_mb_®bum
 = 'N';

44 
	g$cfg_mb_u¶ßd
 = 'Y';

45 
	g$cfg_mb_u¶ßd_size
 = 1024;

46 
	g$cfg_mb_£nd®l
 = 'Y';

47 
	g$cfg_mb_rmdown
 = 'Y';

48 
	g$cfg_şi_time
 = 8;

49 
	g$cfg_mb_addÚty³
 = 'swf|mpg|mp3|rm|rmvb|wmv|wma|wav|mid|mov|zip|rar|doc|xsl|ppt|wps';

50 
	g$cfg_mb_max
 = 500;

51 
	g$cfg_keywÜd_like
 = 'N';

52 
	g$cfg_šdex_max
 = 10000;

53 
	g$cfg_šdex_ÿche
 = 86400;

54 
	g$cfg_lÿche
 = 'Y';

55 
	g$cfg_lÿche_dœ
 = '/config/tplcache';

56 
	g$cfg_makesign_ÿche
 = 'N';

57 
	g$cfg_rm_»mÙe
 = 'Y';

58 
	g$cfg_¬c_d–lšk
 = 'N';

59 
	g$cfg_¬c_autİic
 = 'Y';

60 
	g$cfg_¬c_autokeywÜd
 = 'Y';

61 
	g$cfg_t™Ë_maxËn
 = 120;

62 
	g$cfg_®bum_width
 = 800;

63 
	g$cfg_check_t™Ë
 = 'Y';

64 
	g$cfg_®bum_row
 = 100;

65 
	g$cfg_®bum_cŞ
 = 100;

66 
	g$cfg_®bum_·gesize
 = 12;

67 
	g$cfg_®bum_¡yË
 = 3;

68 
	g$cfg_®bum_ddwidth
 = 200;

69 
	g$cfg_mb_nÙ®low
 = 'www,bbs,ftp,mail,user,users,admin,administrator';

70 
	g$cfg_mb_idmš
 = 3;

71 
	g$cfg_mb_pwdmš
 = 3;

72 
	g$cfg_mb_pwdty³
 = '32';

73 
	g$cfg_md_idu¾
 = 'N';

74 
	g$cfg_mb_¿nk
 = 10;

75 
	g$cfg_ãedback_time
 = 30;

76 
	g$cfg_ãedback_num
 = 30;

77 
	g$cfg_md_ma‹¡
 = 'Y';

78 
	g$cfg_mb_¥aû¡a
 = -1;

79 
	g$cfg_vdcode_memb”
 = 'Y';

80 
	g$cfg_mb_ckt™Ë
 = 'Y';

81 
	g$cfg_mb_ed™day
 = 7;

82 
	g$cfg_ÿiÿi_sub
 = 2;

83 
	g$cfg_ÿiÿi_add
 = 2;

84 
	g$cfg_ãedback_add
 = 5;

85 
	g$cfg_ãedback_sub
 = 5;

86 
	g$cfg_£¬ch_max
 = 50000;

87 
	g$cfg_£¬ch_maxrc
 = 300;

88 
	g$cfg_£¬ch_time
 = 3;

89 
	g$cfg_baiduÃws_lim™
 = '100';

90 
	g$cfg_upd©•”i
 = '15';

91 
	g$cfg_£ndma_bysm
 = 'Y';

92 
	g$cfg_sm_£rv”
 = 'smtp.163.com';

93 
	g$cfg_sm_pÜt
 = '25';

94 
	g$cfg_sm_u£rma
 = 'demo_xak@163.com';

95 
	g$cfg_sm_u£r
 = 'demo_xak';

96 
	g$cfg_sm_·sswÜd
 = 'xak888UP';

97 
	g$cfg_Úlše_ty³
 = 'nps';

98 
	g$cfg_u¶ßd_sw™ch
 = 'Y';

99 
	g$cfg_®l£¬ch_lim™
 = '1';

100 
	g$cfg_»wr™e
 = 'N';

101 
	g$cfg_d–‘e
 = 'Y';

102 
	g$cfg_keywÜds
 = '';

103 
	g$cfg_desütiÚ
 = '';

104 
	g$cfg_beŸn
 = '';

105 
	g$cfg_Ãed_ty³id2
 = 'Y';

106 
	g$cfg_ÿche_ty³
 = 'id';

107 
	g$cfg_max_çû
 = 50;

108 
	g$cfg_ty³dœ_df
 = 'Y';

109 
	g$cfg_makešdex
 = 'N';

110 
	g$cfg_make_ªdÿt
 = 'N';

111 
	g$cfg_make_´’ext
 = 'N';

112 
	g$cfg_ãedback_fÜbid
 = 'N';

113 
	g$cfg_jump_Úû
 = 'Y';

114 
	g$cfg_sk_pwd
 = '';

115 
	g$cfg_addÚ_domašbšd
 = 'N';

116 
	g$cfg_addÚ_domaš
 = '';

117 
	g$cfg_df_dutyadmš
 = 'admin';

118 
	g$cfg_mb_®lownÿrc
 = 'Y';

119 
	g$cfg_mb_®low»g
 = 'N';

120 
	g$cfg_mb_admšlock
 = 'N';

121 
	g$cfg_£nd¬c_scÜes
 = 10;

122 
	g$cfg_£ndfb_scÜes
 = 3;

123 
	g$cfg_mb_¥aû®Ïrc
 = 0;

124 
	g$cfg_çû_adds
 = 10;

125 
	g$cfg_mÜešfo_adds
 = 20;

126 
	g$cfg_mÚey_scÜes
 = 50;

127 
	g$cfg_mb_wÇmeÚe
 = 'N';

128 
	g$cfg_¬c_dœÇme
 = 'Y';

129 
	g$cfg_pucÿche_time
 = 36000;

130 
	g$cfg_¬c_şick
 = -1;

131 
	g$cfg_addÚ_§v‘y³
 = 'ymd';

132 
	g$cfg_qk_u¶ßdl™
 = 'Y';

133 
	g$cfg_logš_adds
 = 2;

134 
	g$cfg_u£¿d_adds
 = 10;

135 
	g$cfg_ddimg_fuÎ
 = 'Y';

136 
	g$cfg_ddimg_bgcŞÜ
 = 0;

137 
	g$cfg_»¶aû_num
 = 2;

138 
	g$cfg_u¶™pic_cut
 = 'N';

139 
	g$cfg_®bum_m¬k
 = 'N';

140 
	g$cfg_mb_ãedcheck
 = 'N';

141 
	g$cfg_mb_msgischeck
 = 'N';

142 
	g$cfg_mb_»gšfo
 = 'N';

143 
	g$cfg_»mÙe_s™e
 = 'N';

144 
	g$cfg_t™Ë_s™e
 = 'N';

145 
	g$cfg_mysql_ty³
 = 'mysql';

146 
	g$cfg_¥hšx_¬tişe
 = 'N';

147 
	g$cfg_¥hšx_ho¡
 = 'localhost';

148 
	g$cfg_¥hšx_pÜt
 = 9312;

149 
	g$cfg_memÿche_’abË
 = 'N';

150 
	g$cfg_memÿche_mc_deç
 = 'memcache://127.0.0.1:11211/default127';

151 
	g$cfg_memÿche_mc_Ùh
 = '';

152 
	g$cfg_üoss_£ùy³id
 = 'N';

153 
	g$cfg_digg_upd©e
 = 0;

154 
	g$cfg_ãedback_gue¡
 = 'N';

155 
	g$cfg_úzz
 = '';

156 
	g$cfg_kf
 = '';

157 
	g$sm_ema
 = '';

158 
	g$cfg_di§bË_funs
 = 'phpinfo,eval,exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,file_put_contents';

159 
	g$cfg_di§bË_gs
 = 'php';

	@E:\web\weixun\config\downmix.data.php

1 <?
	gphp


6 #,
xak
.
ú


	@E:\web\weixun\config\helper.inc.php

1 <?
php


3 
	g$cfg_h–³r_autŞßd
 = 
¬¿y


	@E:\web\weixun\config\mark\inc_photowatermark_config.php

1 <?
php


2 
	g$phÙo_m¬kup
 = '0';

3 
	g$phÙo_m¬kdown
 = '0';

4 
	g$phÙo_m¬kty³
 = '1';

5 
	g$phÙo_wwidth
 = '150';

6 
	g$phÙo_wheight
 = '150';

7 
	g$phÙo_w©”pos
 = '9';

8 
	g$phÙo_w©”‹xt
 = 'www.xak.cn';

9 
	g$phÙo_fÚtsize
 = '20';

10 
	g$phÙo_fÚtcŞÜ
 = '0,0,0';

11 
	g$phÙo_m¬kŒªs
 = '100';

12 
	g$phÙo_dŸphªe™y
 = '100';

13 
	g$phÙo_m¬kimg
 = 'mark.png';

	@E:\web\weixun\config\module\modulescache.php

1 <?
php


2 
glob®
 
	g$®lmoduËs
;

	@E:\web\weixun\config\safe\inc_safe_config.php

1 <?
php


2 
	g$§ã_gdİ’
 = '1,2,3,4,5,6';

3 
	g$§ã_cod‘y³
 = '3';

4 
	g$§ã_gdty³
 = '3';

5 
	g$§ã_wwidth
 = '80';

6 
	g$§ã_wheight
 = '30';

7 
	g$§ã_cod–’
 = '4';

8 
	g$§ã_çq_»g
 = '0';

9 
	g$§ã_çq_£nd
 = '0';

10 
	g$§ã_çq_msg
 = '0';

11 
	g$§ã_çqs
 = 'a:2:{i:1;a:2:{s:8:"question";s:6:"1+11=?";s:6:"answer";s:2:"12";}i:2;a:2:{s:8:"question";s:59:"ä¸­å›½å“ªé¡¹ä½“è‚²è¿åŠ¨æœ€è®©äººå¬ç€ä¼¤å¿ƒ,çœ‹ç€æªå¿ƒ?";s:6:"answer";s:6:"è¶³çƒ";}}';

	@E:\web\weixun\config\safequestions.php

1 <?
php


3 
	g$§ãque¡iÚs
 = 
¬¿y
();

4 
	g$§ãque¡iÚs
[0] = 'æ²¡å®‰å…¨æç¤ºé—®é¢˜';

9 
	g$§ãque¡iÚs
[1] = 'ä½ æœ€å–œæ¬¢çš„æ ¼è¨€ä»€ä¹ˆï¼Ÿ';

10 
	g$§ãque¡iÚs
[2] = 'ä½ å®¶ä¹¡çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ';

11 
	g$§ãque¡iÚs
[3] = 'ä½ è¯»çš„å°å­¦å«ä»€ä¹ˆï¼Ÿ';

12 
	g$§ãque¡iÚs
[4] = 'ä½ çš„çˆ¶äº²å«ä»€ä¹ˆåå­—ï¼Ÿ';

13 
	g$§ãque¡iÚs
[5] = 'ä½ çš„æ¯äº²å«ä»€ä¹ˆåå­—ï¼Ÿ';

14 
	g$§ãque¡iÚs
[6] = 'ä½ æœ€å–œæ¬¢çš„å¶åƒæ˜¯è°ï¼Ÿ';

15 
	g$§ãque¡iÚs
[7] = 'ä½ æœ€å–œæ¬¢çš„æ­Œæ›²æ˜¯ä»€ä¹ˆï¼Ÿ';

22 
funùiÚ
 
G‘Saãque¡iÚ
(
$£lid
=0,
$fÜmÇme
='safequestion')

24 
glob®
 
$§ãque¡iÚs
;

25 
	g$§ãque¡iÚs_fÜm
 = "<select‚ame='$formname' id='$formname'>";

26 
fÜ—ch
(
$§ãque¡iÚs
 
as
 
$k
=>
$v
)

28 if(
$k
==
$£lid
è
$§ãque¡iÚs_fÜm
 .= "<option value='$k' selected>$v</option>\r\n";

29 
	g$§ãque¡iÚs_fÜm
 .= "<option value='$k'>$v</option>\r\n";

31 
	g$§ãque¡iÚs_fÜm
 .= "</select>\r\n";

32  
	g$§ãque¡iÚs_fÜm
;

	@E:\web\weixun\config\smiley.data.php

1 <?
php


3 
	g$GLOBALS
['cfg_smeys'] = 
¬¿y
(

5 '{s:1}' => 
¬¿y
('1.gif', '24', '24', 'é«˜å…´'),

6 '{s:2}' => 
¬¿y
('2.gif', '24', '24', 'æ’‡å˜´'),

7 '{s:3}' => 
¬¿y
('3.gif', '24', '24', 'æŠ“ç‹‚'),

8 '{s:4}' => 
¬¿y
('4.gif', '24', '24', 'æ±—'),

9 '{s:5}' => 
¬¿y
('5.gif', '24', '24', 'æƒŠæ'),

10 '{s:6}' => 
¬¿y
('6.gif', '24', '24', 'å¥‹æ–—'),

11 '{s:7}' => 
¬¿y
('7.gif', '24', '24', 'ç–‘é—®'),

12 '{s:8}' => 
¬¿y
('8.gif', '24', '24', 'æ™•'),

13 '{s:9}' => 
¬¿y
('9.gif', '24', '24', 'å·ç¬‘'),

14 '{s:10}' => 
¬¿y
('10.gif', '24', '24', 'å¯çˆ±'),

15 '{s:11}' => 
¬¿y
('11.gif', '24', '24', 'ç–‘æƒ‘'),

16 '{s:12}' => 
¬¿y
('12.gif', '24', '24', 'é…·'),

17 '{s:13}' => 
¬¿y
('13.gif', '24', '24', 'æš´æ±—'),

18 '{s:14}' => 
¬¿y
('14.gif', '24', '24', 'å‘•å'),

19 '{s:15}' => 
¬¿y
('15.gif', '24', '24', 'å¤§ç¬‘'),

20 '{s:16}' => 
¬¿y
('16.gif', '24', '24', 'è‰²'),

	@E:\web\weixun\config\template.rand.php

1 <?
php


4 
	g$cfg_m¶©e_¿nd
 = 0;

7 
	g$cfg_m¶©e_¬r
[] = 'article_article.htm';

8 
	g$cfg_m¶©e_¬r
[] = 'article_article1.htm';

9 
	g$cfg_m¶©e_¬r
[] = 'article_article2.htm';

	@E:\web\weixun\config\xakdb.php

1 <?
php


3 
	g$cfg_dbho¡
 = 'localhost';

4 
	g$cfg_dbÇme
 = 'weixun';

5 
	g$cfg_dbu£r
 = 'root';

6 
	g$cfg_dbpwd
 = '';

7 
	g$cfg_db´efix
 = 'xak_';

8 
	g$cfg_db_Ïnguage
 = 'utf8';

	@E:\web\weixun\functions\Lurd.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

22 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

28 şas 
	cLurd
 
ex‹nds
 
	mD©aLi¡CP


31 
v¬
 
	m$d©eTy³s
 = 
¬¿y
('DATE', 'DATETIME', 'TIMESTAMP', 'TIME', 'YEAR');

32 
v¬
 
	m$æßtTy³s
 = 
¬¿y
('FLOAT', 'DOUBLE', 'DECIMAL');

33 
v¬
 
	m$štTy³s
 = 
¬¿y
('TINYINT', 'SMALLINT', 'MEDIUMINT', 'INT', 'BIGINT');

34 
v¬
 
	m$ch¬Ty³s
 = 
¬¿y
('VARCHAR', 'CHAR', 'TINYTEXT');

35 
v¬
 
	m$‹xtTy³s
 = 
¬¿y
('TEXT', 'MEDIUMTEXT', 'LONGTEXT');

36 
v¬
 
	m$bšTy³s
 = 
¬¿y
('TINYBLOB', 'BLOB', 'MEDIUMBLOB', 'LONGBLOB', 'BINARY', 'VARBINARY');

37 
v¬
 
	m$emTy³s
 = 
¬¿y
('ENUM', 'SET');

39 
v¬
 
	m$bËName
 = '';

40 
v¬
 
	m$‹m¶©eDœ
 = '';

41 
v¬
 
	m$lurdTempdœ
 = '';

42 
v¬
 
	m$lName
 = '';

43 
v¬
 
	m$­pName
 = '';

44 
v¬
 
	m$´im¬yKey
 = '';

45 
v¬
 
	m$autoF›ld
 = '';

46 
v¬
 
	m$Üd”Qu”y
 = '';

48 
v¬
 
	m$f›lds
 = 
¬¿y
();

50 
v¬
 
	m$isDebug
 = 
FALSE
;

53 
v¬
 
	m$¡ršgSaã
 = 1;

56 
v¬
 
	m$lškTabËs
 = 
¬¿y
();

58 
v¬
 
	m$addF›lds
 = 
¬¿y
();

60 
v¬
 
	m$£¬chP¬am‘”s
 = 
¬¿y
();

63 
v¬
 
	m$sšgËMªage
 = 
TRUE
;

66 
funùiÚ
 
__cÚ¡ruù
(
$bËÇme
, 
$‹m¶©edœ
='', 
$lurd‹mpdœ
='')

68 
glob®
 
$dsql
;

69 
	m$´efix
 = "#@__";

70 
	m$this
->
	mlName
 = 
¡r_»¶aû
(
$´efix
, '', 
$bËÇme
);

71 
	m$this
->
	mbËName
 = 
¡r_»¶aû
(
$´efix
, 
$GLOBALS
['cfg_db´efix'], 
$bËÇme
);

72 
	m$this
->
	m‹m¶©eDœ
 = 
$‹m¶©edœ
;

73 
	m$this
->
	mlurdTempdœ
 = 
em±y
(
$lurd‹mpdœ
è? 
$this
->
‹m¶©eDœ
.'/lurd' : $lurdtempdir;

74 
	m·»Á
::
__cÚ¡ruù
();

75 
	m$this
->
AÇly£TabË
();

76 
	m$ù
 = 
is£t
(
$GLOBALS
['ù'])? $GLOBALS['ù'] : 
»que¡
('ct', '');

77 if(!
em±y
(
$ù
))

79 
	m$this
->
S‘P¬am‘”
('ù', 
$ù
);

81 
	m$this
->
S‘P¬am‘”
('ac', 'list');

85 
funùiÚ
 
Li¡’AÎ
(
$li¡f›ld
 = '', 
$wh”equ”y
 = '', 
$Üd”qu”y
 ='')

87 
glob®
 
$aùiÚ
;

88 
	g$aùiÚ
 = !
em±y
(
$aùiÚ
)? $aùiÚ : 
»que¡
('action');

89 
	g$aùiÚ
)

92 
$this
->
AddD©a
();

95 
$this
->
Ed™D©a
();

98 
$this
->
D–D©a
();

101 
$this
->
SaveAddD©a
();

104 
$this
->
SaveEd™D©a
();

107 
$this
->
Li¡D©a
(
$li¡f›ld
, 
$wh”equ”y
, 
$Üd”qu”y
);

114 
funùiÚ
 
	$AddPriKey
(
$f›ldÇme
)

116 
$this
->
´im¬yKey
 = 
$f›ldÇme
;

117 
	}
}

120 
funùiÚ
 
	$AddAµName
(
$­²ame
)

122 
$this
->
­pName
 = 
$­²ame
;

123 
	}
}

126 
funùiÚ
 
	$S‘Ord”Qu”y
(
$qu”y
)

128 
$this
->
Üd”Qu”y
 = 
$qu”y
;

129 
	}
}

132 
funùiÚ
 
BšdTy³
(
$f›ldÇme
, 
$áy³
, 
$fÜm©
='')

136 
$ty³sA¼
 = 
¬¿y_m”ge
(
$this
->
d©eTy³s
, $this->
æßtTy³s
, $this->
štTy³s
, $this->
ch¬Ty³s
, $this->
‹xtTy³s
, $this->
bšTy³s
, $this->
emTy³s
);

137 ifĞ
is£t
(
$this
->
f›lds
[
$f›ldÇme
]è&& 
š_¬¿y
(
¡¹ouµ”
(
$áy³
), 
$ty³sA¼
) )

139 
	g$this
->
	gf›lds
[
$f›ldÇme
]['ty³'] = 
$áy³
;

140 
	g$this
->
	gf›lds
[
$f›ldÇme
]['fÜm©'] = 
$fÜm©
;

145 
funùiÚ
 
BšdTem¶©e
(
$f›ldÇme
, 
$tm±y³
='li¡', 
$‹mp
='')

147 ifĞ
is£t
(
$this
->
f›lds
[
$f›ldÇme
]) )

149 
$this
->
f›lds
[
$f›ldÇme
][
$tm±y³
.'‹m¶©e'] = 
$‹mp
;

160 
funùiÚ
 
Li¡D©a
(
$li¡f›ld
 = '*', 
$wh”equ”y
 = '', 
$Üd”qu”y
 ='', 
$Suff
 = '_list.htm')

162 
$li¡dd
 = '';

163 if(
Œim
(
$li¡f›ld
)=='') $listfield = '*';

165 
	g$‹m¶©e
 = 
$this
->
‹m¶©eDœ
.'/'.$this->
lName
.
$Suff
;

167 ifĞ!
fe_exi¡s
(
$‹m¶©e
è|| 
	g$this
->
	gisDebug
 )

169 
	g$this
->
MakeLi¡Tem¶©e
(
$li¡f›ld
);

173 ifĞ
	g$wh”equ”y
 == '' )

175 
$wh”equ”y
 = 
$this
->
G‘S—rchQu”y
();

179 
	g$i¦šk
 = 
couÁ
(
$this
->
lškTabËs
è> 0 ? 
TRUE
 : 
FALSE
;

181 
	g$li¡f›lds
 = 
ex¶ode
(',', 
$li¡f›ld
);

182 
fÜ—ch
(
$li¡f›lds
 
as
 
$v
)

184 
	g$v
 = 
Œim
(
$v
);

185 ifĞ!
is£t
(
$this
->
f›lds
[
$v
]è&& 
	g$v
 != '*' ) ;

186 if(
	g$i¦šk
) {

187 
	g$li¡dd
 .ğ(
$li¡dd
=='' ? "{$this->tableName}.{$v}" : ", {$this->tableName}.{$v} ");

190 if(
	g$v
=='*'è
$li¡dd
 .= ' * ';

191 
	g$li¡dd
 .ğ(
$li¡dd
=='' ? "`$v`" : ",`$v`");

194 if(
	g$li¡dd
==''è
$li¡dd
 = " * ";

197 if(
	g$i¦šk
)

199 
	g$jošQu”y
 = '';

200 
fÜ—ch
(
$this
->
lškTabËs
 
as
 
$k
=>
$lškTabË
)

202 
$k
++;

203 
	g$lškTabËName
 = 
$lškTabË
[0]->
bËName
;

204 
	g$jošQu”y
 .= " LEFT JOIN `{$linkTableName}` ON {$linkTableName}.{$linkTable[2]} = {$this->tableName}.{$linkTable[1]} ";

205 
fÜ—ch
(
$this
->
addF›lds
 
as
 
$f
=>
$v
)

207 if(
$v
['bË'] !ğ
$lškTabËName
) ;

208 
	g$li¡dd
 .= ", {$linkTableName}.{$f} ";

211 
	g$qu”y
 = "SELECT $listdd FROM `{$this->tableName}` $joinQuery $wherequery $orderquery ";

215 
	g$qu”y
 = "SELECT $listdd FROM `{$this->tableName}` $wherequery $orderquery ";

218 
	g$this
->
SaveCurU¾
();

219 
	g$this
->
S‘Tem¶©e
(
$‹m¶©e
);

220 
	g$this
->
S‘Sourû
(
$qu”y
);

221 
	g$this
->
Di¥Ïy
();

225 
funùiÚ
 
	$SaveCurU¾
()

227 
	`£tcook›
('LURD_GOBACK_URL', 
$this
->
	`G‘CurFuÎU¾
(), 
	`time
()+3600, '/');

228 
	}
}

230 
funùiÚ
 
	$G‘CurFuÎU¾
()

232 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

234 
$sütName
 = 
$_SERVER
["REQUEST_URI"];

235 
$nowu¾
 = 
$sütName
;

239 
$sütName
 = 
$_SERVER
["PHP_SELF"];

240 
$nowu¾
 = 
	`em±y
(
$_SERVER
["QUERY_STRING"]è? 
$sütName
 : $scriptName."?".$_SERVER["QUERY_STRING"];

242  
$nowu¾
;

243 
	}
}

246 
funùiÚ
 
MakeAÎTem¶©e
(
$li¡f›ld
 = '')

248 
$this
->
MakeLi¡Tem¶©e
(
$li¡f›ld
);

249 
	g$this
->
MakeAddEd™Tem¶©e
('add');

250 
	g$this
->
MakeAddEd™Tem¶©e
('edit');

254 
funùiÚ
 
MakeLi¡Tem¶©e
(
$li¡f›ld
 = '')

256 
$‹m¶©eTem¶©e
 = 
$this
->
lurdTempdœ
.'/lurd-list.htm';

257 
	g$‹m¶©e
 = 
$this
->
‹m¶©eDœ
.'/'.$this->
lName
.'_list.htm';

258 
	g$‹mp¡r
 = '';

259 
	g$å
 = 
fİ’
(
$‹m¶©eTem¶©e
, 'r');

260  !
ãof
(
$å
èè
	g$‹mp¡r
 .ğ
ä—d
($fp, 1024);

261 
fşo£
(
$å
);

262 
	g$‹mpI‹ms
 = 
¬¿y
('appname'=>'', 'totalitem'=>'', 'titleitem'=>'', 'fielditem'=>'');

263 
	g$‹mpI‹ms
['­²ame'] = 
em±y
(
$this
->
­pName
è? "ç®¡ç†æ•°æ®è¡¨ï¼š ".$this->
bËName
 : $this->appName;

265 
	g$‹mpI‹ms
['totalitem'] = 1;

266 
	g$‹mpI‹ms
['£lf'] = 
$_SERVER
["PHP_SELF"];

267 
	g$t™Ë™em
 = " <td class='nowrap'>é€‰æ‹©</td>\r\n";

268 ifĞ!
´eg_m©ch
("/,/", 
$this
->
´im¬yKey
) )

270 
	g$f›ld™em
 = " <td class='nowrap'><inputype=\"checkbox\"‚ame=\"{$this->primaryKey}[]\" value=\"{xak:field‚ame='{$this->primaryKey}' /}\" /></td>\r\n";

274 
	g$´ikeys
 = 
ex¶ode
(',', 
$this
->
´im¬yKey
);

275 
	g$´ikeyV®ue
 = '<'.'?phpƒcho md5("key"';

276 
fÜ—ch
(
$´ikeys
 
as
 
$v
)

278 
	g$´ikeyV®ue
 .ğ'.$f›lds["'.
$v
.'"]';

280 
	g$´ikeyV®ue
 .= '); ?'.'>';

281 
	g$f›ld™em
 = " <td class='nowrap'><inputype=\"checkbox\"‚ame=\"primarykey[]\" value=\"{$prikeyValue}\" /></td>\r\n";

284 if(!
em±y
(
$li¡f›ld
è&& 
	g$li¡f›ld
 != '*' )

286 
$li¡f›lds
 = 
ex¶ode
(',', 
$li¡f›ld
);

287 
	g$‹mpI‹ms
['tÙ®™em'] = 
couÁ
(
$li¡f›lds
) + 1;

288 
fÜ—ch
(
$li¡f›lds
 
as
 
$k
)

290 
	g$k
 = 
Œim
(
$k
);

291 ifĞ!
is£t
(
$this
->
f›lds
[
$k
]) ) ;

292 
	g$v
 = 
$this
->
f›lds
[
$k
];

293 
	g$t™Ë
 = !
em±y
(
$v
['comm’t'])? $v['comm’t'] : 
$k
;

294 
	g$t™Ë™em
 .= " <td class='nowrap'>$title</td>\r\n";

295 ifĞ!
em±y
(
$v
['listtemplate']) )

297 
	g$f›ld™em
 .= " <td class='nowrap'>{$v['listtemplate']}</td>\r\n";

301 
	g$dofunc
 = 
$dty³
 = 
$ffÜm©
 = '';

302 
	g$dty³
 = !
em±y
(
$v
['type']) ? $v['type'] : 'check';

303 if(
is£t
(
$v
['format']))

305 
	g$ffÜm©
 = 
$v
['format'];

307 if(
is£t
(
$v
['dofunc']))

309 
	g$dofunc
 = 
$v
['dofunc'];

311 if(
is£t
(
$v
['type']))

313 
	g$this
->
	gf›lds
[
$k
]['ty³'] = 
$v
['type'];

315 ifĞ
š_¬¿y
(
$v
['ty³'], 
$this
->
æßtTy³s
) )

317 
	g$dty³
 = 'float';

318 
	g$dofunc
 = (
$dofunc
=='' ? "function=\"Lurd::FormatFloat(@me, '$fformat')\"" : '');

320 ifĞ
š_¬¿y
(
$v
['ty³'], 
$this
->
d©eTy³s
) )

322 
	g$dty³
 = 'date';

323 
	g$dofunc
 = (
$dofunc
=='' ? "function=\"Lurd::FormatDate(@me, '{$this->fields[$k]['type']}', '$fformat')\"" : '');

325 
	g$f›ld™em
 .= " <td class='nowrap'>{xak:field‚ame='{$k}' $dofunc /}</td>\r\n";

332 
fÜ—ch
(
$this
->
f›lds
 
as
 
$k
=>
$v
)

334 if(
š_¬¿y
(
$v
['ty³'], 
$this
->
bšTy³s
) )

338 
	g$‹mpI‹ms
['totalitem']++;

339 
	g$t™Ë
 = !
em±y
(
$v
['comm’t'])? $v['comm’t'] : 
$k
;

340 
	g$t™Ë™em
 .= " <td class='nowrap'>$title</td>\r\n";

341 
	g$dofunc
 = 
$dty³
 = 
$ffÜm©
 = '';

342 if(
is£t
(
$v
['format']))

344 
	g$ffÜm©
 = 
$v
['format'];

346 ifĞ
š_¬¿y
(
$v
['ty³'], 
$this
->
æßtTy³s
) )

348 
	g$dty³
 = 'float';

349 
	g$dofunc
 = (
$dofunc
=='' ? "function=\"Lurd::FormatFloat(@me, '$fformat')\"" : '');

351 ifĞ
š_¬¿y
(
$v
['ty³'], 
$this
->
d©eTy³s
) )

353 
	g$dty³
 = 'date';

354 
	g$dofunc
 = (
$dofunc
=='' ? "function=\"Lurd::FormatDate(@me, '{$this->fields[$k]['type']}', '$fformat')\"" : '');

356 
	g$f›ld™em
 .= " <td class='nowrap'>{xak:field‚ame='{$k}' $dofunc /}</td>\r\n";

361 
	g$i¦šk
 = 
couÁ
(
$this
->
lškTabËs
è> 0 ? 
TRUE
 : 
FALSE
;

363 if(
	g$i¦šk
)

365 
fÜ—ch
(
$this
->
addF›lds
 
as
 
$k
=>
$v
)

367 if(
š_¬¿y
(
$v
['ty³'], 
$this
->
bšTy³s
) )

371 
	g$‹mpI‹ms
['totalitem']++;

372 
	g$t™Ë™em
 .= " <td class='nowrap'>$k</td>\r\n";

373 
	g$dofunc
 = 
$dty³
 = 
$ffÜm©
 = '';

374 ifĞ
š_¬¿y
(
$v
['ty³'], 
$this
->
æßtTy³s
) )

376 
	g$dty³
 = 'float';

377 
	g$dofunc
 = (
$dofunc
=='' ? "function=\"Lurd::FormatFloat(@me, '$fformat')\"" : '');

379 ifĞ
š_¬¿y
(
$v
['ty³'], 
$this
->
d©eTy³s
) )

381 
	g$dty³
 = 'date';

382 
	g$dofunc
 = (
$dofunc
=='' ? "function=\"Lurd::FormatDate(@me, '{$this->fields[$k]['type']}', '$fformat')\"" : '');

384 
	g$f›ld™em
 .= " <td class='nowrap'>{xak:field‚ame='{$k}' $dofunc /}</td>\r\n";

388 if(
	g$this
->
	gsšgËMªage
)

390 
	g$‹mpI‹ms
['totalitem']++;

391 
	g$t™Ë™em
 .= " <td class='nowrap'>ç®¡ç†</td>\r\n";

392 
	g$cu¼’tU¾
 = 
$this
->
G‘CurU¾
();

393 
	g$f›ld™em
 .= " <td class='nowrap'>

394 <
a
 
h»f
=\"{$currentUrl}?{$this->primaryKey}={xak:field‚ame='{$this->primaryKey}' /}&ac=edit&get=yes\">ä¿®æ”¹</a>

395 | <
a
 
h»f
=\"{$currentUrl}?{$this->primaryKey}={xak:field‚ame='{$this->primaryKey}' /}&ac=del&get=yes\">åˆ é™¤</a> </td>\r\n";

398 
	g$‹mpI‹ms
['t™Ë™em'] = 
$t™Ë™em
;

399 
	g$‹mpI‹ms
['f›ld™em'] = 
$f›ld™em
;

400 
fÜ—ch
(
$‹mpI‹ms
 
as
 
$k
 => 
$v
)

402 
$‹mp¡r
 = 
¡r_»¶aû
("~$k~", 
$v
, $tempstr);

404 
	g$å
 = 
fİ’
(
$‹m¶©e
, 'w');

405 
fwr™e
(
$å
, 
$‹mp¡r
);

406 
fşo£
(
$å
);

410 
funùiÚ
 
MakeAddEd™Tem¶©e
(
$g‘Tem¶‘s
='add')

412 
$‹m¶©eTem¶©e
 = 
$this
->
lurdTempdœ
."/lurd-{$getTemplets}.htm";

413 
	g$‹m¶©e
 = 
$this
->
‹m¶©eDœ
.'/'.$this->
lName
."_{$getTemplets}.htm";

414 
	g$‹mp¡r
 = '';

415 
	g$å
 = 
fİ’
(
$‹m¶©eTem¶©e
, 'r');

416  !
ãof
(
$å
èè
	g$‹mp¡r
 .ğ
ä—d
($fp, 1024);

417 
fşo£
(
$å
);

418 
	g$‹mpI‹ms
 = 
¬¿y
('appname'=>'', 'fields'=>'', 'primarykey'=>'');

419 
	g$‹mpI‹ms
['­²ame'] = 
em±y
(
$this
->
­pName
è? "åœ¨ {$this->bËName} ".(
$g‘Tem¶‘s
=='add' ? 'æ·»åŠ æ•°æ®' : 'ç¼–è¾‘æ•°æ®' ) : $this->appName;

420 
	g$‹mpI‹ms
['fields'] = '';

421 
	g$‹mpI‹ms
['£lf'] = 
$_SERVER
["PHP_SELF"];

422 ifĞ!
´eg_m©ch
("/,/", 
$this
->
´im¬yKey
) )

424 
	g$‹mpI‹ms
['primarykey'] = " <inputype=\"hidden\"‚ame=\"{$this->primaryKey}\" value=\"{xak:field‚ame='{$this->primaryKey}' /}\" />\r\n";

428 
	g$´ikeys
 = 
ex¶ode
(',', 
$this
->
´im¬yKey
);

429 
	g$´ikeyV®ue
 = '<'.'?phpƒcho md5("key"';

430 
fÜ—ch
(
$´ikeys
 
as
 
$v
)

432 
	g$´ikeyV®ue
 .ğ'.$f›lds["'.
$v
.'"]';

434 
	g$´ikeyV®ue
 .= '); ?'.'>';

435 
	g$‹mpI‹ms
['primarykey'] = " <inputype=\"hidden\"‚ame=\"primarykey[]\" value=\"{$prikeyValue}\" />\r\n";

437 
	g$f›ld™em
 = '';

438 
fÜ—ch
(
$this
->
f›lds
 
as
 
$k
=>
$v
)

440 
$«fÜm
 = 
$dty³
 = 
$deçuÉv®ue
 = 
$ffÜm©
 = '';

441 
	g$t™Ë
 = !
em±y
(
$v
['comm’t'])? $v['comm’t'] : 
$k
;

443 if(
is£t
(
$this
->
f›lds
[
$k
][
$g‘Tem¶‘s
.'template']))

445 
	g$f›ld™em
 .ğ
$this
->
f›lds
[
$k
][
$g‘Tem¶‘s
.'template'];

449 if(
	g$k
==
$this
->
autoF›ld
)

454 if(
	g$k
==
$this
->
´im¬yKey
 && 
$g‘Tem¶‘s
=='edit')

459 if(
is£t
(
$this
->
f›lds
[
$k
]['format']))

461 
	g$ffÜm©
 = 
$this
->
f›lds
[
$k
]['format'];

464 if(
	g$g‘Tem¶‘s
=='edit')

466 ifĞ
š_¬¿y
(
$this
->
f›lds
[
$k
]['ty³'], $this->
bšTy³s
èè
$dfv®ue
 = '';

467 
	g$dfv®ue
 = "{xak:field‚ame='$k' /}";

471 
	g$dfv®ue
 = 
$this
->
f›lds
[
$k
]['default'];

474 ifĞ
š_¬¿y
(
$this
->
f›lds
[
$k
]['ty³'], $this->
æßtTy³s
) )

476 if(
	g$g‘Tem¶‘s
=='edit')

478 
$dfv®ue
 = "{xak:field‚ame='$k' function=\"Lurd::FormatFloat(@me, '$fformat')\" /}";

480 if(
	g$this
->
	gf›lds
[
$k
]['default']=='')

482 
$dfv®ue
 = 0;

484 
	g$«fÜm
 = "<inputype='input'‚ame='{$k}' class='txtnumber' value='$dfvalue' />";

487 ifĞ
š_¬¿y
(
$this
->
f›lds
[
$k
]['ty³'], $this->
štTy³s
) )

489 
	g$«fÜm
 = "<inputype='input'‚ame='{$k}' class='txtnumber' value='$dfvalue' />";

492 ifĞ
š_¬¿y
(
$this
->
f›lds
[
$k
]['ty³'], $this->
d©eTy³s
))

494 if(
em±y
(
$ffÜm©
)è
	g$ffÜm©
 = 'Y-m-d H:i:s';

495 if(
	g$g‘Tem¶‘s
=='edit')

497 
$dfv®ue
 = "{xak:field‚ame='$k' function=\"MyDate(@me, '$fformat')\" /}";

499 if(
em±y
(
$this
->
f›lds
[
$k
]['default']))

501 
	g$dfv®ue
 = "{xak:var.a function=\"MyDate(time(), '$fformat')\" /}";

503 
	g$«fÜm
 = "<inputype='input'‚ame='{$k}' class='txtdate' value='$dfvalue' />";

506 ifĞ
š_¬¿y
(
$this
->
f›lds
[
$k
]['ty³'], $this->
‹xtTy³s
))

508 
	g$«fÜm
 = "<textarea‚ame='$k' class='txtarea'>{$dfvalue}</textarea>";

511 ifĞ
š_¬¿y
(
$this
->
f›lds
[
$k
]['ty³'], $this->
‹xtTy³s
))

513 
	g$«fÜm
 = "<inputype='file'‚ame='$k' size='45' />";

516 ifĞ
	g$this
->
	gf›lds
[
$k
]['type']=='SET' )

518 
$ems
 = 
ex¶ode
(',', 
$this
->
f›lds
[
$k
]['em']);

519 if(
	g$g‘Tem¶‘s
=='edit')

521 
$«fÜm
 .ğ'<'.'?ph°$’umI‹m ğex¶ode(\',\', $f›lds[\''.
$k
.'\']); ?'.'>';

523 
fÜ—ch
(
$ems
 
as
 
$em
)

525 if(
	g$g‘Tem¶‘s
=='add')

527 
$«fÜm
 .= "<inputype='checkbox'‚ame='{$k}[]' value='$em' />$em \r\n";

531 
	g$«fÜm
 .= "<inputype='checkbox'‚ame='{$k}[]' value='$em' {xak:if in_array('$em', \$enumItems)}checked{/xak:if} />$em \r\n";

536 ifĞ
	g$this
->
	gf›lds
[
$k
]['type']=='ENUM' )

538 
$ems
 = 
ex¶ode
(',', 
$this
->
f›lds
[
$k
]['em']);

539 
fÜ—ch
(
$ems
 
as
 
$em
)

541 if(
	g$g‘Tem¶‘s
=='edit') {

542 
$«fÜm
 .= "<inputype='radio'‚ame='$k' value='$em' {xak:if \$fields['$k']}=='$em'}checked{/xak:if} />$em \r\n";

545 
	g$«fÜm
 .= "<inputype='radio'‚ame='$k' value='$em' />$em \r\n";

551 
	g$«fÜm
 = "<inputype='input'‚ame='{$k}' class='txt' value='$dfvalue' />";

553 
	g$f›ld™em
 .= " <tr>\r\n<td height='28'‡lign='center' bgcolor='#FFFFFF'>{$title}</td>\r\n<td bgcolor='#FFFFFF'>{$aeform}</td>\r\n</tr>\r\n";

555 
	g$‹mpI‹ms
['f›lds'] = 
$f›ld™em
;

556 
fÜ—ch
(
$‹mpI‹ms
 
as
 
$k
=>
$v
)

558 
$‹mp¡r
 = 
¡r_»¶aû
("~$k~", 
$v
, $tempstr);

560 
	g$å
 = 
fİ’
(
$‹m¶©e
, 'w');

561 
fwr™e
(
$å
, 
$‹mp¡r
);

562 
fşo£
(
$å
);

566 
funùiÚ
 
	$Ed™D©a
()

568 
$‹m¶©e
 = 
$this
->
‹m¶©eDœ
.'/'.$this->
lName
.'_edit.htm';

570 ifĞ!
	`fe_exi¡s
(
$‹m¶©e
è|| 
$this
->
isDebug
 )

572 
$this
->
	`MakeAddEd™Tem¶©e
('edit');

574 
$wh”eQu”y
 = '';

575 
$GLOBALS
[
$this
->
´im¬yKey
] = 
	`is£t
($GLOBALS[$this->´im¬yKey])? $GLOBALS[$this->´im¬yKey] : 
	`»que¡
($this->primaryKey);

576 if(
	`em±y
(
$GLOBALS
['´im¬ykey'][0]è&&ƒm±y($GLOBALS[
$this
->
´im¬yKey
][0]))

578 
	`ShowMsg
('è¯·é€‰æ‹©è¦ä¿®æ”¹çš„è®°å½•ï¼', '-1');

579 
	`ex™
();

581 if(
	`´eg_m©ch
("/,/", 
$this
->
´im¬yKey
))

583 
$wh”eQu”y
 = "WHERE md5(CONCAT('key', `".
	`¡r_»¶aû
(',', '`,`', 
$this
->
´im¬yKey
)."`) = '{$GLOBALS['primarykey'][0]}' ";

587 
$pkey
 = (
	`»que¡
('g‘'è=ğ'yes')?„eque¡(
$this
->
´im¬yKey
è: 
$GLOBALS
[$this->primaryKey][0];

588 
$wh”eQu”y
 = "WHERE `{$this->´im¬yKey}` = '".
$GLOBALS
[
$this
->
´im¬yKey
][0]."' ";

592 
$qu”y
 = "SELECT * FROM `{$this->tableName}` $whereQuery ";

593 
$this
->
	`S‘Tem¶©e
(
$‹m¶©e
);

594 
$this
->
	`S‘Sourû
(
$qu”y
);

595 
$this
->
	`Di¥Ïy
();

596 
	}
}

599 
funùiÚ
 
	$AddD©a
()

601 
$‹m¶©e
 = 
$this
->
‹m¶©eDœ
.'/'.$this->
lName
.'_add.htm';

603 ifĞ!
	`fe_exi¡s
(
$‹m¶©e
è|| 
$this
->
isDebug
 )

605 
$this
->
	`MakeAddEd™Tem¶©e
('add');

608 
$this
->
	`S‘Tem¶©e
(
$‹m¶©e
);

609 
$this
->
	`Di¥Ïy
();

610 
	`ex™
();

611 
	}
}

614 
funùiÚ
 
	$SaveAddD©a
(
$i¡uº
=
TRUE
)

616 
$®lf›ld
 = 
$®lv®ue
 = '';

617 
	`fÜ—ch
(
$this
->
f›lds
 
as
 
$k
=>
$v
)

620 if(
$k
==
$this
->
autoF›ld
)

624 
$®lf›ld
 .= ($allfield=='' ? "`$k`" : ' , '."`$k`");

625 
$v
 = 
$this
->
	`G‘D©a
(
$k
);

626 
$®lv®ue
 .= ($allvalue=='' ? "'$v'" : ' , '."'$v'");

628 
$šQu”y
 = "INSERT INTO `$this->tableName`($allfield) VALUES($allvalue); ";

629 
$rs
 = 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$šQu”y
);

632 if(!
$i¡uº
)

634  
$rs
;

637 
$gou¾
 = !
	`em±y
(
$_COOKIE
['LURD_GOBACK_URL']) ? $_COOKIE['LURD_GOBACK_URL'] : '-1';

638 if(!
$rs
)

640 
$this
->
dsql
->
	`SaveE¼ÜLog
(
$šQu”y
);

641 
	`ShowMsg
('ä¿å­˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“é”™è¯¯æ—¥å¿—ï¼', 
$gou¾
);

642 
	`ex™
();

646 
	`ShowMsg
('æˆåŠŸä¿å­˜ä¸€ç»„æ•°æ®ï¼', 
$gou¾
);

647 
	`ex™
();

649 
	}
}

652 
funùiÚ
 
	$SaveEd™D©a
(
$i¡uº
=
TRUE
)

654 
$ed™f›ld
 = '';

655 
	`fÜ—ch
(
$this
->
f›lds
 
as
 
$k
=>
$v
)

658 
$GLOBALS
[
$k
] = 
	`is£t
($GLOBALS[$k])? $GLOBALS[$k] : $GLOBALS['»que¡']->
fÜms
[$k];

659 if(
$k
==
$this
->
autoF›ld
 || !
	`is£t
(
$GLOBALS
[$k]))

663 
$v
 = 
$this
->
	`G‘D©a
(
$k
);

664 
$ed™f›ld
 .= ($editfield=='' ? " `$k`='$v' " : ",\n `$k`='$v' ");

667 if(
	`´eg_m©ch
("#,#", 
$this
->
´im¬yKey
))

669 
$keyv®ue
 = (
	`is£t
(
$GLOBALS
['primarykey']) ? $GLOBALS['primarykey'] : '');

673 
$keyv®ue
 = 
$this
->
	`G‘D©a
($this->
´im¬yKey
);

675 
$keyv®ue
 = 
	`´eg_»¶aû
("#[^0-9a-z]#i", "", $keyvalue);

676 ifĞ!
	`´eg_m©ch
("#,#", 
$this
->
´im¬yKey
) )

678 
$šQu”y
 = " UPDATE `$this->tableName` SET $editfield WHERE `{$this->primaryKey}`='{$keyvalue}' ";

682 
$šQu”y
 = " UPDATE `$this->bËName` SET $ed™f›ld WHERE md5('key', `".
	`¡r_»¶aû
(',','`,`',
$this
->
´im¬yKey
)."`='{$keyvalue}' ";

684 
$rs
 = 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$šQu”y
);

686 if(!
$i¡uº
)

688  
$rs
;

691 
$gou¾
 = !
	`em±y
(
$_COOKIE
['LURD_GOBACK_URL']) ? $_COOKIE['LURD_GOBACK_URL'] : '-1';

692 if(!
$rs
)

694 
$this
->
dsql
->
	`SaveE¼ÜLog
(
$šQu”y
);

695 
	`ShowMsg
('ä¿å­˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“é”™è¯¯æ—¥å¿—ï¼', 
$gou¾
);

696 
	`ex™
();

700 
	`ShowMsg
('æˆåŠŸä¿å­˜ä¸€ç»„æ•°æ®ï¼', 
$gou¾
);

701 
	`ex™
();

703 
	}
}

706 
funùiÚ
 
	$G‘CurU¾
()

708 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

710 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

711 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

712 
$nowu¾
 = 
$nowu¾s
[0];

716 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

718  
$nowu¾
;

719 
	}
}

722 
funùiÚ
 
	$D–D©a
(
$i¡uº
=
TRUE
)

724 
$GLOBALS
[
$this
->
´im¬yKey
] = 
	`is£t
($GLOBALS[$this->´im¬yKey])? $GLOBALS[$this->´im¬yKey] : 
	`»que¡
($this->primaryKey);

725 if(
	`´eg_m©ch
("#,#", 
$this
->
´im¬yKey
))

727 
$keyA¼
 = (
	`is£t
(
$GLOBALS
['primarykey']) ? $GLOBALS['primarykey'] : '');

731 
$keyA¼
 = 
	`is£t
(
$GLOBALS
[
$this
->
´im¬yKey
]) ? $GLOBALS[$this->primaryKey] : '';

733 if(!
	`is_¬¿y
(
$keyA¼
))

735 
	`ShowMsg
('æ²¡æŒ‡å®šè¦åˆ é™¤çš„è®°å½•ï¼', '-1');

736 
	`ex™
();

740 
$isid
 = !
	`´eg_m©ch
("#,#", 
$this
->
´im¬yKey
è? 
TRUE
 : 
FALSE
;

741 
$i
 = 0;

742 
	`fÜ—ch
(
$keyA¼
 
as
 
$v
)

744 
$v
 = 
	`´eg_»¶aû
("#[^0-9a-z]#i", '', $v);

745 if(
	`em±y
(
$v
)) ;

746 
$i
++;

747 if(
$isid
)

749 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `{$this->tableName}` WHERE `$this->primaryKey`='$v' ");

753 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `{$this->bËName}` WHERE md5('key', `".
	`¡r_»¶aû
(',','`,`',$this->
´im¬yKey
)."`='$v' ");

756 if(
$i¡uº
)

758 
$gou¾
 = !
	`em±y
(
$_COOKIE
['LURD_GOBACK_URL']) ? $_COOKIE['LURD_GOBACK_URL'] : '-1';

759 
	`ShowMsg
('æˆåŠŸåˆ é™¤æŒ‡å®šçš„è®°å½•ï¼', 
$gou¾
);

760 
	`ex™
();

764  
$i
;

767 
	}
}

773 
funùiÚ
 
AddLškTabË
(&
$bËlurd
, 
$mylškid
, 
$lškid
, 
$lškf›lds
='*')

775 if(
Œim
(
$lškf›lds
)=='') $linkfields = '*';

776 
	g$this
->
	glškTabËs
[] = 
¬¿y
(
$bËlurd
, 
$mylškid
, 
$lškid
, 
$lškf›lds
);

778 if(
	g$lškf›lds
 != '*')

780 
$fs
 = 
ex¶ode
(',', 
$lškf›lds
);

781 
fÜ—ch
(
$fs
 
as
 
$f
)

783 
	g$f
 = 
Œim
(
$f
);

784 if(
is£t
(
$bËlurd
->
f›lds
[
$f
]))

786 
	g$this
->
	gaddF›lds
[
$f
] = 
$bËlurd
->
f›lds
[$f];

787 
	g$this
->
	gaddF›lds
[
$f
]['bË'] = 
$bËlurd
->
bËName
;

793 
fÜ—ch
(
$bËlurd
->
f›lds
 
as
 
$k
=>
$v
)

795 
$this
->
addF›lds
[
$k
] = 
$v
;

796 
	g$this
->
	gaddF›lds
[
$k
]['bË'] = 
$bËlurd
->
bËName
;

802 
funùiÚ
 
	$AÇly£TabË
()

804 if(
$this
->
bËName
 == '')

806 
	`ex™
(" No Input Table! ");

809 
$this
->
dsql
->
	`Execu‹
('ana', " SHOW CREATE TABLE `{$this->tableName}`; ");

810 
$row
 = 
$this
->
dsql
->
	`G‘A¼ay
('ªa', 
MYSQL_NUM
);

811 if(!
	`is_¬¿y
(
$row
))

813 
	`ex™
(" Analyse Table `$tablename` Error! ");

819 
$æšes
 = 
	`ex¶ode
("\n", 
$row
[1]);

820 
$·rA¼ay
 = 
	`¬¿y
('date', 'float', 'int', 'char', 'text', 'bin', 'em');

821 
$´ikeyTmp
 = '';

822 
$i
=1; $˜< 
	`couÁ
(
$æšes
)-1; $i++ )

824 
$lše
 = 
	`Œim
(
$æšes
[
$i
]);

825 
$lšes
 = 
	`ex¶ode
(' ', 
	`¡r_»¶aû
('`', '', 
$lše
));

827 ifĞ
$lšes
[0] == 'KEY' ) ;

828 ifĞ
$lšes
[0] == 'UNIQUE' ) ;

830 ifĞ
$lšes
[0] == 'PRIMARY' )

832 
$this
->
´im¬yKey
 = 
	`´eg_»¶aû
("/[\(\)]|,$/", '', 
$lšes
[
	`couÁ
($lines)-1]);

836 
$this
->
f›lds
[
$lšes
[0]] = 
	`¬¿y
('ty³' => '', 'Ëngth' => '', 'unsigÃd' => 
FALSE
, 'autokey' => FALSE, 'nuÎ' => 
TRUE
, 'default' => '', 'em' => '', 'comment' => '');

837 
$this
->
f›lds
[
$lšes
[0]]['ty³'] = 
	`¡¹ouµ”
(
	`´eg_»¶aû
("/\(.*$|,/", '', $lines[1]));

838 
$this
->
f›lds
[
$lšes
[0]]['Ëngth'] = 
	`´eg_»¶aû
("/^.*\(|\)/", '', $lines[1]);

839 if(
	`´eg_m©ch
("#[^0-9]#", 
$this
->
f›lds
[
$lšes
[0]]['length']))

841 if(
$this
->
f›lds
[
$lšes
[0]]['type'] == 'SET'

842 || 
$this
->
f›lds
[
$lšes
[0]]['type'] == 'ENUM')

844 
$this
->
f›lds
[
$lšes
[0]]['em'] = 
	`´eg_»¶aû
("/'/", '', $this->fields[$lines[0]]['length']);

846 
$this
->
f›lds
[
$lšes
[0]]['length'] = 0;

850 
	`fÜ—ch
(
$·rA¼ay
 
as
 
$v
)

852 
$tmp¡r
 = "if(in_array(\$this->fields[\$lines[0]]['type'], \$this->{$v}Types))

854 \
$this
->{
$v
}
F›lds
[] = \
$lšes
[0];

856 
	`ev®
(
$tmp¡r
);

858 ifĞ!
	`š_¬¿y
(
$this
->
f›lds
[
$lšes
[0]]['ty³'], $this->
‹xtTy³s
)

859 && !
	`š_¬¿y
(
$this
->
f›lds
[
$lšes
[0]]['ty³'], $this->
bšTy³s
) )

861 
$´ikeyTmp
 .ğ($´ikeyTmp=='' ? 
$lšes
[0] : ','.$lines[0]);

866 if(
	`´eg_m©ch
("#unsigÃd#i", 
$lše
))

868 
$this
->
f›lds
[
$lšes
[0]]['unsigÃd'] = 
TRUE
;

870 if(
	`´eg_m©ch
("#auto_šüem’t#i", 
$lše
))

872 
$this
->
f›lds
[
$lšes
[0]]['autokey'] = 
TRUE
;

873 
$this
->
autoF›ld
 = 
$lšes
[0];

875 if(
	`´eg_m©ch
("#NOT NULL#i", 
$lše
))

877 
$this
->
f›lds
[
$lšes
[0]]['nuÎ'] = 
FALSE
;

879 if(
	`´eg_m©ch
("#deçuÉ#i", 
$lše
))

881 
	`´eg_m©ch
("#deçuÉ '(.*?)'#i", 
$lše
, 
$dfm©chs
);

882 
$this
->
f›lds
[
$lšes
[0]]['deçuÉ'] = 
	`is£t
(
$dfm©chs
[1])? $dfm©chs[1] : 
NULL
;

884 if(
	`´eg_m©ch
("#comm’t#i", 
$lše
))

886 
	`´eg_m©ch
("#comm’ˆ'(.*?)'#i", 
$lše
, 
$cmm©chs
);

887 
$this
->
f›lds
[
$lšes
[0]]['comm’t'] = 
	`is£t
(
$cmm©chs
[1])? $cmm©chs[1] : 
NULL
;

891 ifĞ
$this
->
´im¬yKey
=='' )

893 
$this
->
´im¬yKey
 = 
$´ikeyTmp
;

895 
	}
}

904 
funùiÚ
 
AddS—rchP¬am‘”
(
$f›ldÇme
, 
$f›ldv®ue
, 
$cÚd™iÚ
, 
$lškmode
='AND')

906 
$c
 = 
couÁ
(
$this
->
£¬chP¬am‘”s
);

908 ifĞ
´eg_m©ch
('/,/', 
$f›ldÇme
) )

910 
	g$fs
 = 
ex¶ode
(',', 
$f›ldÇme
);

911 
	g$f›ldÇme
 = "CONCAT(";

912 
	g$á
 = '';

913 
fÜ—ch
(
$fs
 
as
 
$f
)

915 
	g$f
 = 
Œim
(
$f
);

916 
	g$á
 .ğ(
$á
=='' ? "`{$f}`" : ",`{$f}`");

918 
	g$f›ldÇme
 .= "{$ft}) ";

920 
	g$this
->
	g£¬chP¬am‘”s
[
$c
]['f›ld'] = 
$f›ldÇme
;

921 
	g$this
->
	g£¬chP¬am‘”s
[
$c
]['v®ue'] = 
$f›ldv®ue
;

922 
	g$this
->
	g£¬chP¬am‘”s
[
$c
]['cÚd™iÚ'] = 
$cÚd™iÚ
;

923 
	g$this
->
	g£¬chP¬am‘”s
[
$c
]['mode'] = 
$lškmode
;

927 
funùiÚ
 
	$G‘S—rchQu”y
()

929 
$wqu”y
 = '';

930 ifĞ
	`couÁ
Ğ
$this
->
£¬chP¬am‘”s
 ) == 0 )

936 
	`fÜ—ch
(
$this
->
£¬chP¬am‘”s
 
as
 
$k
=>
$v
)

938 ifĞ
	`´eg_m©ch
("/like/i", 
$v
['condition']) )

940 
$v
['v®ue'] = 
	`´eg_»¶aû
("/like/i", $v['value'], $v['condition']);

942 
$v
['cÚd™iÚ'] = 
	`´eg_»¶aû
("/%/", '', $v['condition']);

943 ifĞ
$wqu”y
=='' )

945 if(!
	`´eg_m©ch
("/\./", 
$v
['field'])) $v['field'] = "{$v['field']}";

946 
$wqu”y
 .ğ"WHERE ".
$v
['field']." {$v['condition']} '{$v['value']}' ";

950 if(!
	`´eg_m©ch
("/\./", 
$v
['field'])) $v['field'] = "{$v['field']}";

951 
$wqu”y
 .ğ
$v
['mode']." ".$v['field']." {$v['condition']} '{$v['value']}' ";

955  
$wqu”y
 ;

956 
	}
}

959 
funùiÚ
 
	$G‘D©a
(
$âame
)

961 
$»V®ue
 = '';

962 
$áy³
 = 
$this
->
f›lds
[
$âame
]['type'];

963 
$GLOBALS
[
$âame
] = 
	`is£t
($GLOBALS[$âame])? $GLOBALS[$âame] : @$GLOBALS['»que¡']->
fÜms
[$fname];

965 ifĞ
	`š_¬¿y
(
$áy³
, 
$this
->
bšTy³s
) )

967  
$this
->
	`G‘BšD©a
(
$âame
);

970 ifĞ!
	`is£t
(
$GLOBALS
[
$âame
]) )

972 ifĞ
	`is£t
(
$this
->
f›lds
[
$âame
]['default']) )

974  
$this
->
f›lds
[
$âame
]['default'];

978 if(
	`š_¬¿y
(
$áy³
, 
$this
->
štTy³s
è|| in_¬¿y($áy³, $this->
æßtTy³s
)) {

981 if(
	`š_¬¿y
(
$áy³
, 
$this
->
ch¬Ty³s
è|| in_¬¿y($áy³, $this->
‹xtTy³s
)) {

990 ifĞ
	`´eg_m©ch
("#YEAR|INT#", 
$áy³
) )

993 
$ÃgTag
 = 
	`is_št
(
$GLOBALS
[
$âame
]) && $GLOBALS[$fname]< 0 ? '-' : $GLOBALS[$fname];

994 
$»V®ue
 = 
	`´eg_»¶aû
("#[^0-9]#", '', 
$GLOBALS
[
$âame
]);

995 
$»V®ue
 = 
	`em±y
($»V®ueè? 0 : 
	`štv®
($reValue);

996 if(
$ÃgTag
=='-' && !
$this
->
f›lds
[
$âame
]['unsigned']

997 && 
$»V®ue
 !ğ0 && 
$áy³
 != 'YEAR')

999 
$»V®ue
 = 
	`štv®
('-'.$reValue);

1003 if(
	`š_¬¿y
(
$áy³
, 
$this
->
æßtTy³s
))

1005 
$ÃgTag
 = 
$GLOBALS
[
$âame
][0];

1006 
$»V®ue
 = 
	`´eg_»¶aû
("#[^0-9\.]|^\.#", '', 
$GLOBALS
[
$âame
]);

1007 
$»V®ue
 = 
	`em±y
($»V®ueè? 0 : 
	`doubËv®
($reValue);

1008 if(
$ÃgTag
=='-' && !
$this
->
f›lds
[
$âame
]['unsigÃd'] && 
$»V®ue
 != 0)

1010 
$»V®ue
 = 
	`štv®
('-'.$reValue);

1014 if(
	`š_¬¿y
(
$áy³
, 
$this
->
ch¬Ty³s
))

1016 
$»V®ue
 = 
	`ú_sub¡rR
(
$this
->
	`SŒšgSaã
(
$GLOBALS
[
$âame
]), $this->
f›lds
[$fname]['length']);

1019 if(
	`š_¬¿y
(
$áy³
, 
$this
->
‹xtTy³s
))

1021 
$»V®ue
 = 
$this
->
	`SŒšgSaã
(
$GLOBALS
[
$âame
]);

1024 if(
$áy³
=='SET')

1026 
$sysS‘A¼
 = 
	`ex¶ode
(',', 
$this
->
f›lds
[
$âame
]['em']);

1027 ifĞ!
	`is_¬¿y
(
$GLOBALS
[
$âame
]) )

1029 
$£tA¼
[] = 
$GLOBALS
[
$âame
];

1033 
$£tA¼
 = 
$GLOBALS
[
$âame
];

1035 
$»V®ues
 = 
	`¬¿y
();

1036 
	`fÜ—ch
(
$£tA¼
 
as
 
$a
)

1038 if(
	`š_¬¿y
(
$a
, 
$sysS‘A¼
)è
$»V®ues
[] = $a;

1040 
$»V®ue
 = 
	`couÁ
(
$»V®ues
)==0 ? 'NULL' : 
	`još
(',', $reValues);

1043 if(
$áy³
=='ENUM')

1045 
$sysEnumA¼
 = 
	`ex¶ode
(',', 
$this
->
f›lds
[
$âame
]['em']);

1046 if(
	`š_¬¿y
(
$GLOBALS
[
$âame
], 
$sysEnumA¼
)è
$»V®ue
 = $GLOBALS[$fname];

1047 
$»V®ue
 = 'NULL';

1050 if(
	`š_¬¿y
(
$áy³
, 
$this
->
d©eTy³s
))

1052 if(
$áy³
=='TIMESTAMP')

1054 
$»V®ue
 = 
	`G‘MkTime
(
$GLOBALS
[
$âame
]);

1058 
$»V®ue
 = 
	`´eg_»¶aû
("#[^0-9 :-]#", '', 
$GLOBALS
[
$âame
]);

1061  
$»V®ue
;

1062 
	}
}

1065 
funùiÚ
 
SŒšgSaã
(
$¡r
, 
$§ã¡•
=-1)

1067 
$§ã¡•
 = ($§ã¡• > -1è? $§ã¡• : 
$this
->
¡ršgSaã
;

1069 if(
	g$§ã¡•
 == 1)

1071 
$¡r
 = 
´eg_»¶aû
("#script:#i", "ï½“ï½ƒï½’ï½‰ï½ï½”ï¼š", $str);

1072 
	g$¡r
 = 
´eg_»¶aû
("#<[\/]{0,1}Öšk|m‘a|iä|äa|sü)[^>]*>#isU", '', 
$¡r
);

1073 
	g$¡r
 = 
´eg_»¶aû
("#[\r\n\ˆ]{1,}#", ' ', 
$¡r
);

1074  
	g$¡r
;

1078 if(
	g$this
->
	g¡ršgSaã
 == 2)

1080 
$¡r
 = 
add¦ashes
(
html¥ecŸlch¬s
(
¡r¦ashes
($str)));

1081 
	g$¡r
 = 
´eg_»¶aû
("#ev®#i", 'ï½…ï½–ï½ï½Œ', 
$¡r
);

1082 
	g$¡r
 = 
´eg_»¶aû
("#uniÚ#i", 'ï½•ï½ï½‰ï½ï½', 
$¡r
);

1083 
	g$¡r
 = 
´eg_»¶aû
("#cÚÿt#i", 'ï½ƒï½ï½ï½ƒï½ï½”', 
$¡r
);

1084 
	g$¡r
 = 
´eg_»¶aû
("#--#", 'ï¼ï¼', 
$¡r
);

1085 
	g$¡r
 = 
´eg_»¶aû
("#[\r\n\ˆ]{1,}#", ' ', 
$¡r
);

1086  
	g$¡r
;

1091  
	g$¡r
;

1096 
funùiÚ
 
	$G‘BšD©a
(
$âame
)

1098 
$lurdtmp
 = 
XAKDATA
.'/lurdtmp';

1099 if(!
	`is£t
(
$_FILES
[
$âame
]['tmp_Çme']è|| !
	`is_u¶ßded_fe
($_FILES[$fname]['tmp_name']))

1105 
$tmpfe
 = 
$lurdtmp
.'/'.
	`md5
Ğ
	`time
(è. 
Sql
::
	`ExecTime
(è. 
	`mt_¿nd
(1000, 5000) ).'.tmp';

1106 
$rs
 = 
	`move_u¶ßded_fe
(
$_FILES
[
$âame
]['tmp_Çme'], 
$tmpfe
);

1107 if(!
$rs
)  '';

1108 
$å
 = 
	`fİ’
(
$tmpfe
, 'r');

1109 
$d©a
 = 
	`ba£64_’code
(
	`ä—d
(
$å
, 
	`fesize
(
$tmpfe
)));

1110 
	`fşo£
(
$å
);

1111  
$d©a
;

1113 
	}
}

1116 
funùiÚ
 
FÜm©Flßt
(
$fv®ue
, 
$áy³
='')

1118 if(
$áy³
=='') $ftype='%0.4f';

1119  
¥rštf
(
$áy³
, 
$fv®ue
);

1123 
funùiÚ
 
	$G‘D©eTimeDf
(
$áy³
)

1125 if(
$áy³
=='DATE')  'Y-m-d';

1126 if(
$áy³
=='TIME')  'H:i:s';

1127 if(
$áy³
=='YEAR')  'Y';

1129 
	}
}

1132 
funùiÚ
 
FÜm©D©e
(
$fv®ue
, 
$áy³
, 
$ffÜm©
='')

1134 if(
$áy³
=='INT' || $áy³='TIMESTAMP' )  
MyD©e
(
$fv®ue
, 
$ffÜm©
);

1135  
	g$fv®ue
;

	@E:\web\weixun\functions\arc.archives.class.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
»quœe_Úû
(
XAKINC
."/channelunit.class.php");

10 
»quœe_Úû
(
XAKINC
."/downmix.inc.php");

11 
»quœe_Úû
(
XAKINC
.'/ftp.class.php');

13 @
£t_time_lim™
(0);

19 şas 
	cArchives


21 
v¬
 
	m$Ty³Lšk
;

22 
v¬
 
	m$ChªÃlUn™
;

23 
v¬
 
	m$dsql
;

24 
v¬
 
	m$F›lds
;

25 
v¬
 
	m$d
;

26 
v¬
 
	m$ArcID
;

27 
v¬
 
	m$S¶™PageF›ld
;

28 
v¬
 
	m$S¶™F›lds
;

29 
v¬
 
	m$NowPage
;

30 
v¬
 
	m$TÙ®Page
;

31 
v¬
 
	m$NameFœ¡
;

32 
v¬
 
	m$ShÜtName
;

33 
v¬
 
	m$FixedV®ues
;

34 
v¬
 
	m$TempSourû
;

35 
v¬
 
	m$IsE¼Ü
;

36 
v¬
 
	m$S¶™T™Ës
;

37 
v¬
 
	m$P»Next
;

38 
v¬
 
	m$addTabËRow
;

39 
v¬
 
	m$áp
;

40 
v¬
 
	m$»mÙeDœ
;

49 
funùiÚ
 
	$__cÚ¡ruù
(
$aid
)

51 
glob®
 
$dsql
,
$áp
;

52 
$this
->
IsE¼Ü
 = 
FALSE
;

53 
$this
->
ArcID
 = 
$aid
;

54 
$this
->
P»Next
 = 
	`¬¿y
();

56 
$this
->
dsql
 = 
$dsql
;

57 
$qu”y
 = "SELECT channel,typeid FROM `#@__arctiny` WHERE id='$aid' ";

58 
$¬r
 = 
$this
->
dsql
->
	`G‘OÃ
(
$qu”y
);

59 if(!
	`is_¬¿y
(
$¬r
))

61 
$this
->
IsE¼Ü
 = 
TRUE
;

65 if(
$¬r
['channel']==0) $arr['channel']=1;

66 
$this
->
ChªÃlUn™
 = 
Ãw
 
	`ChªÃlUn™
(
$¬r
['chªÃl'], 
$aid
);

67 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(
$¬r
['typeid']);

68 if(
$this
->
ChªÃlUn™
->
ChªÃlInfos
['issystem']!=-1)

71 
$qu”y
 = "SELECT‡rc.*,tp.reid,tp.typedir,ch.addtable

72 
FROM
 `#@
__¬chives
` 
¬c


73 
LEFT
 
JOIN
 #@
__¬ùy³
 

 
Ú
p.
id
=
¬c
.
ty³id


74 
LEFT
 
JOIN
 #@
__chªÃÉy³
 
as
 
ch
 
Ú
 
¬c
.
chªÃl
 = ch.
id


75 
WHERE
 
¬c
.
id
='$aid' ";

76 
$this
->
F›lds
 = $this->
dsql
->
	`G‘OÃ
(
$qu”y
);

80 
$this
->
F›lds
['title'] = '';

81 
$this
->
F›lds
['money'] = $this->Fields['arcrank'] = 0;

82 
$this
->
F›lds
['senddate'] = $this->Fields['pubdate'] = $this->Fields['mid'] = $this->Fields['adminid'] = 0;

83 
$this
->
F›lds
['ismake'] = 1;

84 
$this
->
F›lds
['filename'] = '';

87 if(
$this
->
Ty³Lšk
->
Ty³Infos
['cÜªk'] > 0 && $this->
F›lds
['arcrank']==0)

89 
$this
->
F›lds
['¬üªk'] = $this->
Ty³Lšk
->
Ty³Infos
['corank'];

92 
$this
->
F›lds
['gs'] = 
	`G‘Tags
(
$aid
);

93 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

94 
$this
->
d
->
	`S‘RefObj
($this);

95 
$this
->
S¶™PageF›ld
 = $this->
ChªÃlUn™
->SplitPageField;

96 
$this
->
S¶™F›lds
 = '';

97 
$this
->
TÙ®Page
 = 1;

98 
$this
->
NameFœ¡
 = '';

99 
$this
->
ShÜtName
 = 'html';

100 
$this
->
FixedV®ues
 = '';

101 
$this
->
TempSourû
 = '';

102 
$this
->
áp
 = &
$áp
;

103 
$this
->
»mÙeDœ
 = '';

104 if(
	`em±y
(
$GLOBALS
['pageno']))

106 
$this
->
NowPage
 = 1;

110 
$this
->
NowPage
 = 
$GLOBALS
['pageno'];

114 
$this
->
F›lds
['aid'] = 
$aid
;

115 
$this
->
F›lds
['id'] = 
$aid
;

116 
$this
->
F›lds
['pos™iÚ'] = $this->
Ty³Lšk
->
	`G‘Pos™iÚLšk
(
TRUE
);

117 
$this
->
F›lds
['ty³id'] = 
$¬r
['typeid'];

120 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
)

122 
$this
->
F›lds
[
$k
] = 
$v
;

126 if(
$this
->
ChªÃlUn™
->
ChªÃlInfos
['addtable']!='')

128 
$qu”y
 = "SELECT * FROM `{$this->ChannelUnit->ChannelInfos['addtable']}` WHERE `aid` = '$aid'";

129 
$this
->
addTabËRow
 = $this->
dsql
->
	`G‘OÃ
(
$qu”y
);

133 if(
$this
->
ChªÃlUn™
->
ChªÃlInfos
['addtable']!='' && $this->ChannelUnit->ChannelInfos['issystem']!=-1)

135 if(
	`is_¬¿y
(
$this
->
addTabËRow
))

137 
$this
->
F›lds
['»dœeùu¾'] = $this->
addTabËRow
['redirecturl'];

138 
$this
->
F›lds
['‹m¶‘'] = $this->
addTabËRow
['templet'];

139 
$this
->
F›lds
['u£r'] = $this->
addTabËRow
['userip'];

141 
$this
->
F›lds
['‹m¶‘'] = (
	`em±y
($this->F›lds['‹m¶‘']è? '' : 
	`Œim
($this->Fields['templet']));

142 
$this
->
F›lds
['»dœeùu¾'] = (
	`em±y
($this->F›lds['»dœeùu¾']è? '' : 
	`Œim
($this->Fields['redirecturl']));

143 
$this
->
F›lds
['u£r'] = (
	`em±y
($this->F›lds['u£r']è? '' : 
	`Œim
($this->Fields['userip']));

147 
$this
->
F›lds
['templet'] = $this->Fields['redirecturl'] = '';

153 
funùiÚ
 
	$Archives
(
$aid
)

155 
$this
->
	`__cÚ¡ruù
(
$aid
);

156 
	}
}

164 
funùiÚ
 
	$P¬AddTabË
()

167 if(
$this
->
ChªÃlUn™
->
ChªÃlInfos
['addtable']!='')

169 
$row
 = 
$this
->
addTabËRow
;

170 if(
$this
->
ChªÃlUn™
->
ChªÃlInfos
['issystem']==-1)

172 
$this
->
F›lds
['t™Ë'] = 
$row
['title'];

173 
$this
->
F›lds
['£ndd©e'] = $this->F›lds['pubd©e'] = 
$row
['senddate'];

174 
$this
->
F›lds
['mid'] = $this->F›lds['admšid'] = 
$row
['mid'];

175 
$this
->
F›lds
['ismake'] = 1;

176 
$this
->
F›lds
['arcrank'] = 0;

177 
$this
->
F›lds
['money']=0;

178 
$this
->
F›lds
['filename'] = '';

181 if(
	`is_¬¿y
(
$row
))

183 
	`fÜ—ch
(
$row
 
as
 
$k
=>
$v
è$row[
	`¡¹Şow”
($k)] = $v;

185 if(
	`is_¬¿y
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
è&& !
	`em±y
($this->ChannelUnit->ChannelFields))

187 
	`fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$¬r
)

189 if(
	`is£t
(
$row
[
$k
]))

191 if(!
	`em±y
(
$¬r
['rename']))

193 
$nk
 = 
$¬r
['rename'];

197 
$nk
 = 
$k
;

199 
$cobj
 = 
$this
->
	`G‘CurTag
(
$k
);

200 if(
	`is_objeù
(
$cobj
))

202 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$ùag
)

204 if(
$ùag
->
	`G‘TagName
()=='f›ld' && $ùag->
	`G‘A‰
('Çme')==
$k
)

207 if(
$ùag
->
	`G‘A‰
('noteid') != '') {

208 
$this
->
F›lds
[
$k
.'_'.
$ùag
->
	`G‘A‰
('nÙeid')] = $this->
ChªÃlUn™
->
	`MakeF›ld
($k, 
$row
[$k], $ctag);

212 
$this
->
F›lds
[
$nk
] = $this->
ChªÃlUn™
->
	`MakeF›ld
(
$k
, 
$row
[$k], 
$ùag
);

219 
$this
->
F›lds
[
$nk
] = 
$row
[
$k
];

221 if(
$¬r
['ty³']=='htmÉext' && 
$GLOBALS
['cfg_keywÜd_»¶aû']=='Y' && !
	`em±y
(
$this
->
F›lds
['keywords']))

223 
$this
->
F›lds
[
$nk
] = $this->
	`R•ÏûKeywÜd
($this->Fields['keywords'],$this->Fields[$nk]);

229 
$this
->
F›lds
['ty³Çme'] = $this->
Ty³Lšk
->
Ty³Infos
['typename'];

230 @
	`S‘SysEnv
(
$this
->
F›lds
['typeid'],$this->Fields['typename'],$this->Fields['id'],$this->Fields['title'],'archives');

233 
	`un£t
(
$row
);

236 
$this
->
S¶™T™Ës
 = 
	`A¼ay
();

237 if(
$this
->
S¶™PageF›ld
!='' && 
$GLOBALS
['cfg_arcsptitle']='Y'

238 && 
	`is£t
(
$this
->
F›lds
[$this->
S¶™PageF›ld
]))

240 
$this
->
S¶™F›lds
 = 
	`ex¶ode
("#p#",$this->
F›lds
[$this->
S¶™PageF›ld
]);

241 
$i
 = 1;

242 
	`fÜ—ch
(
$this
->
S¶™F›lds
 
as
 
$k
=>
$v
)

244 
$tmpv
 = 
	`ú_sub¡r
(
$v
,50);

245 
$pos
 = 
	`¡½os
(
$tmpv
,'#e#');

246 if(
$pos
>0)

248 
$¡
 = 
	`Œim
(
	`ú_sub¡r
(
$tmpv
,
$pos
));

249 if(
$¡
==""||$st=="å‰¯æ ‡é¢˜"||$st=="åˆ†é¡µæ ‡é¢˜")

251 
$this
->
S¶™F›lds
[
$k
] = 
	`´eg_»¶aû
("/^(.*)#e#/is","",
$v
);

256 
$this
->
S¶™F›lds
[
$k
] = 
	`´eg_»¶aû
("/^(.*)#e#/is","",
$v
);

257 
$this
->
S¶™T™Ës
[
$k
] = 
$¡
;

264 
$i
++;

266 
$this
->
TÙ®Page
 = 
	`couÁ
($this->
S¶™F›lds
);

267 
$this
->
F›lds
['tÙ®·ge'] = $this->
TÙ®Page
;

271 ià(
	`is£t
(
$this
->
F›lds
['litpic']))

273 if(
$this
->
F›lds
['litpic'] == '-' || $this->Fields['litpic'] == '')

275 
$this
->
F›lds
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

277 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$this
->
F›lds
['l™pic']è&& 
$GLOBALS
['cfg_multi_site'] == 'Y')

279 
$this
->
F›lds
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$this->Fields['litpic'];

281 
$this
->
F›lds
['picname'] = $this->Fields['litpic'];

284 
$this
->
F›lds
['image'] = (!
	`´eg_m©ch
('/jpg|gif|png/i', $this->Fields['picname']) ? '' : "<img src='{$this->Fields['picname']}' />");

289 if(
	`is£t
(
$this
->
F›lds
['cŞÜ']è&& !
	`em±y
($this->Fields['color']))

291 
$this
->
F›lds
['color_title'] = '<font color="'.$this->Fields['color'].'">'.$this->Fields['title'].'</font>';

295 
$this
->
F›lds
['color_title'] = $this->Fields['title'];

299 ià(
	`is£t
(
$this
->
F›lds
['vÙeid']è&& !
	`em±y
($this->Fields['voteid']))

301 
$this
->
F›lds
['vote'] = '';

302 
$vÙeid
 = 
$this
->
F›lds
['voteid'];

303 
$this
->
F›lds
['vote'] = "<script†anguage='javascript' src='{$GLOBALS['cfg_cmspath']}/config/vote/vote_{$voteid}.js'></script>";

304 ià(
$GLOBALS
['cfg_multi_site'] == 'Y')

306 
$this
->
F›lds
['vote'] = "<script†anguage='javascript' src='{$GLOBALS['cfg_mainsite']}/config/vote/vote_{$voteid}.js'></script>";

310 ià(
	`is£t
(
$this
->
F›lds
['goodpost']) && isset($this->Fields['badpost']))

313 if(
$this
->
F›lds
['goodpost'] + $this->Fields['badpost'] == 0)

315 
$this
->
F›lds
['goodper'] = $this->Fields['badper'] = 0;

319 
$this
->
F›lds
['good³r'] = 
	`numb”_fÜm©
($this->Fields['goodpost']/($this->Fields['goodpost']+$this->Fields['badpost']), 3)*100;

320 
$this
->
F›lds
['badper'] = 100 - $this->Fields['goodper'];

323 
	}
}

326 
funùiÚ
 
	$G‘CurTag
(
$f›ldÇme
)

328 if(!
	`is£t
(
$this
->
d
->
CTags
))

332 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$ùag
)

334 if(
$ùag
->
	`G‘TagName
()=='f›ld' && $ùag->
	`G‘A‰
('Çme')==
$f›ldÇme
)

336  
$ùag
;

344 
	}
}

353 
funùiÚ
 
	$MakeHtml
(
$i¤emÙe
=0)

355 
glob®
 
$cfg_»mÙe_s™e
,
$feFœ¡
;

356 if(
$this
->
IsE¼Ü
)

360 
$this
->
F›lds
["displaytype"] = "st";

362 
$this
->
	`LßdTem¶‘
();

363 
$this
->
	`P¬AddTabË
();

364 
$this
->
	`P¬£Tem¶‘sFœ¡
();

365 
$this
->
F›lds
['£ndd©e'] = 
	`em±y
($this->Fields['senddate'])? '' : $this->Fields['senddate'];

366 
$this
->
F›lds
['t™Ë'] = 
	`em±y
($this->Fields['title'])? '' : $this->Fields['title'];

367 
$this
->
F›lds
['¬üªk'] = 
	`em±y
($this->Fields['arcrank'])? 0 : $this->Fields['arcrank'];

368 
$this
->
F›lds
['ismake'] = 
	`em±y
($this->Fields['ismake'])? 0 : $this->Fields['ismake'];

369 
$this
->
F›lds
['mÚey'] = 
	`em±y
($this->Fields['money'])? 0 : $this->Fields['money'];

370 
$this
->
F›lds
['f’ame'] = 
	`em±y
($this->Fields['filename'])? '' : $this->Fields['filename'];

373 
$f’ame
 = 
	`G‘FeNewName
(

374 
$this
->
ArcID
,$this->
F›lds
['typeid'],$this->Fields['senddate'],

375 
$this
->
F›lds
['title'],$this->Fields['ismake'],$this->Fields['arcrank'],

376 
$this
->
Ty³Lšk
->
Ty³Infos
['Çm”uË'],$this->Ty³Lšk->Ty³Infos['ty³dœ'],$this->
F›lds
['money'],$this->Fields['filename']

379 
$f’ames
 = 
	`ex¶ode
(".", 
$f’ame
);

380 
$this
->
ShÜtName
 = 
$f’ames
[
	`couÁ
($filenames)-1];

381 if(
$this
->
ShÜtName
=='') $this->ShortName = 'html';

382 
$feFœ¡
 = 
	`´eg_»¶aû
("/\.".
$this
->
ShÜtName
."$/i", "", 
$f’ame
);

383 
$this
->
F›lds
['Çmehªd'] = 
	`ba£Çme
(
$feFœ¡
);

384 
$f’ames
 = 
	`ex¶ode
("/", 
$f’ame
);

385 
$this
->
NameFœ¡
 = 
	`´eg_»¶aû
("/\.".$this->
ShÜtName
."$/i", "", 
$f’ames
[
	`couÁ
($filenames)-1]);

386 if(
$this
->
NameFœ¡
=='')

388 
$this
->
NameFœ¡
 = $this->
¬cID
;

392 
$f’ameFuÎ
 = 
	`G‘FeU¾
(

393 
$this
->
ArcID
,$this->
F›lds
['typeid'],$this->Fields["senddate"],

394 
$this
->
F›lds
["title"],$this->Fields["ismake"],

395 
$this
->
F›lds
["¬üªk"],$this->
Ty³Lšk
->
Ty³Infos
['namerule'],$this->TypeLink->TypeInfos['typedir'],$this->Fields["money"],$this->Fields['filename'],

396 
$this
->
Ty³Lšk
->
Ty³Infos
['moresite'],$this->TypeLink->TypeInfos['siteurl'],$this->TypeLink->TypeInfos['sitepath']

398 
$this
->
F›lds
['¬cu¾'] = $this->F›lds['fuÎÇme'] = 
$f’ameFuÎ
;

401 if(
$this
->
F›lds
['ismake']==-1 || $this->Fields['arcrank']!=0 || $this->Fields['money']>0

402 || (
$this
->
F›lds
['typeid']==0 && $this->Fields['channel'] != -1) )

404  
$this
->
	`G‘TrueU¾
(
$f’ame
);

409 
$i
=1;$i<=
$this
->
TÙ®Page
;$i++)

411 if(
$this
->
TÙ®Page
 > 1) {

412 
$this
->
F›lds
['tm±™Ë'] = (
	`em±y
($this->Fields['tmptitle']) ? $this->Fields['title'] : $this->Fields['tmptitle']);

413 if(
$i
>1è
$this
->
F›lds
['title'] = $this->Fields['tmptitle']."($i)";

415 if(
$i
>1)

417 
$TRUEf’ame
 = 
$this
->
	`G‘TrueP©h
().
$feFœ¡
."_".
$i
.".".$this->
ShÜtName
;

421 
$TRUEf’ame
 = 
$this
->
	`G‘TrueP©h
().
$f’ame
;

423 
$this
->
	`P¬£DMF›lds
(
$i
,1);

424 
$this
->
d
->
	`SaveTo
(
$TRUEf’ame
);

426 if(
$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
 == 1)

430 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '', 
$TRUEf’ame
);

431 
$loÿlfe
 = '..'.
$»mÙefe
;

433 
$»mÙedœ
 = 
	`´eg_»¶aû
("#[^\/]*\.html#", '', 
$»mÙefe
);

434 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

435 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'ascii');

439 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("Upd©`#@__¬chives` SET ismake=1 WHERE id='".$this->
ArcID
."'");

440  
$this
->
	`G‘TrueU¾
(
$f’ame
);

441 
	}
}

450 
funùiÚ
 
	$G‘TrueU¾
(
$nu¾
)

452  
G‘FeU¾


454 
$this
->
F›lds
['id'],

455 
$this
->
F›lds
['typeid'],

456 
$this
->
F›lds
['senddate'],

457 
$this
->
F›lds
['title'],

458 
$this
->
F›lds
['ismake'],

459 
$this
->
F›lds
['arcrank'],

460 
$this
->
Ty³Lšk
->
Ty³Infos
['namerule'],

461 
$this
->
Ty³Lšk
->
Ty³Infos
['typedir'],

462 
$this
->
F›lds
['money'],

463 
$this
->
F›lds
['filename'],

464 
$this
->
Ty³Lšk
->
Ty³Infos
['moresite'],

465 
$this
->
Ty³Lšk
->
Ty³Infos
['siteurl'],

466 
$this
->
Ty³Lšk
->
Ty³Infos
['sitepath']

468 
	}
}

476 
funùiÚ
 
	$G‘TrueP©h
()

478 
$TRUE·th
 = 
$GLOBALS
["cfg_basedir"];

479  
$TRUE·th
;

480 
	}
}

490 
funùiÚ
 
	$G‘F›ld
(
$âame
, 
$ùag
)

493 if(
$âame
=='array')

495  
$this
->
F›lds
;

498 if(
$ùag
->
	`G‘A‰
('noteid') != '')

500 ifĞ
	`is£t
(
$this
->
F›lds
[
$âame
.'_'.
$ùag
->
	`G‘A‰
('noteid')]) )

502  
$this
->
F›lds
[
$âame
.'_'.
$ùag
->
	`G‘A‰
('noteid')];

505 ifĞ
	`is£t
(
$this
->
F›lds
[
$âame
]) )

507  
$this
->
F›lds
[
$âame
];

510 
	}
}

518 
funùiÚ
 
	$G‘Tem¶‘Fe
()

520 
glob®
 
$cfg_ba£dœ
,
$cfg_‹m¶‘s_dœ
,
$cfg_df_¡yË
;

521 
$cid
 = 
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'];

522 if(!
	`em±y
(
$this
->
F›lds
['templet']))

524 
$f‘ag
 = 
	`MfTem¶‘
(
$this
->
F›lds
['templet']);

525 ifĞ!
	`´eg_m©ch
("#\/#", 
$f‘ag
èè$f‘ag = 
$GLOBALS
['cfg_df_style'].'/'.$filetag;

529 
$f‘ag
 = 
	`MfTem¶‘
(
$this
->
Ty³Lšk
->
Ty³Infos
["temparticle"]);

531 
$tid
 = 
$this
->
F›lds
['typeid'];

532 
$f‘ag
 = 
	`¡r_»¶aû
('{cid}', 
$cid
,$filetag);

533 
$f‘ag
 = 
	`¡r_»¶aû
('{tid}', 
$tid
,$filetag);

534 
$tmpfe
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
.'/'.
$f‘ag
;

535 if(
$cid
=='spec')

537 ifĞ!
	`em±y
(
$this
->
F›lds
['templet']) )

539 
$tmpfe
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
.'/'.
$f‘ag
;

543 
$tmpfe
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/{$cfg_df_style}/article_spec.htm";

546 if(!
	`fe_exi¡s
(
$tmpfe
))

548 
$tmpfe
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/{$cfg_df_¡yË}/".(
$cid
=='spec' ? 'article_spec.htm' : 'article_default.htm');

550 ià(!
	`´eg_m©ch
("#.htm$#", 
$tmpfe
)è 
FALSE
;

551  
$tmpfe
;

552 
	}
}

560 
funùiÚ
 
	$di¥Ïy
()

562 
glob®
 
$htmÉy³
;

563 if(
$this
->
IsE¼Ü
)

567 
$this
->
F›lds
["displaytype"] = "dm";

568 if(
$this
->
NowPage
 > 1è$this->
F›lds
["title"] = $this->Fields["title"]."({$this->NowPage})";

570 
$this
->
	`LßdTem¶‘
();

571 
$this
->
	`P¬AddTabË
();

573 
$this
->
	`P¬£Tem¶‘sFœ¡
();

576 
$this
->
F›lds
['æag']=
	`em±y
($this->Fields['flag'])? "" : $this->Fields['flag'];

577 if(
	`´eg_m©ch
("#j#", 
$this
->
F›lds
['flag']) && $this->Fields['redirecturl'] != '')

579 if(
$GLOBALS
['cfg_jump_once']=='N')

581 
$·geHtml
 = "<html>\r\n<h—d>\r\n<m‘¨h‰p-equiv=\"CÚ‹Á-Ty³\" cÚ‹Á=\"‹xt/html; ch¬£t=".
$GLOBALS
['cfg_soá_Ïng']."\">\r\n<t™Ë>".
$this
->
F›lds
['title']."</title>\r\n";

582 
$·geHtml
 .ğ"<m‘¨h‰p-equiv=\"»äesh\" cÚ‹Á=\"3;URL=".
$this
->
F›lds
['redirecturl']."\">\r\n</head>\r\n<body>\r\n";

583 
$·geHtml
 .ğ"ç°åœ¨æ­£åœ¨è½¬å‘ï¼š".
$this
->
F›lds
['title']."ï¼Œè¯·ç¨å€™...<br/><br/>\r\nè½¬å‘å†…å®¹ç®€ä»‹:".$this->Fields['description']."\r\n</body>\r\n</html>\r\n";

584 
echo
 
$·geHtml
;

588 
	`h—d”
("location:{$this->Fields['redirecturl']}");

590 
	`ex™
();

592 
$·geCouÁ
 = 
$this
->
NowPage
;

593 
$this
->
	`P¬£DMF›lds
(
$·geCouÁ
,0);

594 
$this
->
d
->
	`di¥Ïy
();

595 
	}
}

603 
funùiÚ
 
	$LßdTem¶‘
()

605 if(
$this
->
TempSourû
=='')

607 
$‹mpfe
 = 
$this
->
	`G‘Tem¶‘Fe
();

608 if(!
	`fe_exi¡s
(
$‹mpfe
è|| !
	`is_fe
($tempfile))

610 
echo
 "æ–‡æ¡£IDï¼š{$this->Fields['id']} - {$this->TypeLink->TypeInfos['typename']} - {$this->Fields['title']}<br />";

611 
echo
 "æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è§£ææ–‡æ¡£ï¼";

612 
	`ex™
();

614 
$this
->
d
->
	`LßdTem¶©e
(
$‹mpfe
);

615 
$this
->
TempSourû
 = $this->
d
->
SourûSŒšg
;

619 
$this
->
d
->
	`LßdSourû
($this->
TempSourû
);

621 
	}
}

629 
funùiÚ
 
	$P¬£Tem¶‘sFœ¡
()

631 if(
	`em±y
(
$this
->
F›lds
['keywords']))

633 
$this
->
F›lds
['keywords'] = '';

636 if(
	`em±y
(
$this
->
F›lds
['reid']))

638 
$this
->
F›lds
['reid'] = 0;

641 
$GLOBALS
['’vs']['gs'] = 
$this
->
F›lds
['tags'];

643 if(
	`is£t
(
$this
->
Ty³Lšk
->
Ty³Infos
['reid']))

645 
$GLOBALS
['’vs']['»id'] = 
$this
->
Ty³Lšk
->
Ty³Infos
['reid'];

648 
$GLOBALS
['’vs']['keywÜd'] = 
$this
->
F›lds
['keywords'];

650 
$GLOBALS
['’vs']['ty³id'] = 
$this
->
F›lds
['typeid'];

652 
$GLOBALS
['’vs']['tİid'] = 
	`G‘Tİid
(
$this
->
F›lds
['typeid']);

654 
$GLOBALS
['’vs']['aid'] = $GLOBALS['’vs']['id'] = 
$this
->
F›lds
['id'];

656 
$GLOBALS
['’vs']['admšid'] = $GLOBALS['’vs']['mid'] = 
	`is£t
(
$this
->
F›lds
['mid'])? $this->Fields['mid'] : 1;

658 
$GLOBALS
['’vs']['chªÃlid'] = 
$this
->
Ty³Lšk
->
Ty³Infos
['channeltype'];

660 if(
$this
->
F›lds
['reid']>0)

662 
$GLOBALS
['’vs']['ty³id'] = 
$this
->
F›lds
['reid'];

665 
	`MakeOÃTag
(
$this
->
d
, $this, 'N');

666 
	}
}

676 
funùiÚ
 
	$P¬£DMF›lds
(
$·geNo
, 
$ismake
=1)

678 
$this
->
NowPage
 = 
$·geNo
;

679 
$this
->
F›lds
['now·ge'] = $this->
NowPage
;

680 if(
$this
->
S¶™PageF›ld
!='' && 
	`is£t
($this->
F›lds
[$this->SplitPageField]))

682 
$this
->
F›lds
[$this->
S¶™PageF›ld
] = $this->
S¶™F›lds
[
$·geNo
 - 1];

683 if(
$·geNo
>1è
$this
->
F›lds
['desütiÚ'] = 
	`Œim
(
	`´eg_»¶aû
("/[\r\n\t]/", ' ', 
	`ú_sub¡r
(
	`html2‹xt
($this->F›lds[$this->
S¶™PageF›ld
]), 200)));

687 if(
	`is_¬¿y
(
$this
->
d
->
CTags
))

689 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$i
=>
$ùag
)

691 if(
$ùag
->
	`G‘Name
()=='field')

693 
$this
->
d
->
	`Assign
(
$i
, $this->
	`G‘F›ld
(
$ùag
->
	`G‘A‰
('name'), $ctag) );

695 if(
$ùag
->
	`G‘Name
()=='pagebreak')

697 
$¶ªg
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("sitelang"));

698 if(
$ismake
==0)

700 
$this
->
d
->
	`Assign
(
$i
,$this->
	`G‘Pageb»akDM
($this->
TÙ®Page
,$this->
NowPage
,$this->
ArcID
,
$¶ªg
));

704 
$this
->
d
->
	`Assign
(
$i
,$this->
	`G‘Pageb»ak
($this->
TÙ®Page
,$this->
NowPage
,$this->
ArcID
,
$¶ªg
));

707 if(
$ùag
->
	`G‘Name
()=='pagetitle')

709 if(
$ismake
==0)

711 
$this
->
d
->
	`Assign
(
$i
,$this->
	`G‘PageT™ËsDM
(
$ùag
->
	`G‘A‰
("¡yË"),
$·geNo
));

715 
$this
->
d
->
	`Assign
(
$i
,$this->
	`G‘PageT™ËsST
(
$ùag
->
	`G‘A‰
("¡yË"),
$·geNo
));

718 if(
$ùag
->
	`G‘Name
()=='prenext')

720 
$this
->
d
->
	`Assign
(
$i
,$this->
	`G‘P»Next
(
$ùag
->
	`G‘A‰
('get'), $ctag->GetAtt('sitelang')));

722 if(
$ùag
->
	`G‘Name
()=='fieldlist')

724 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

725 if(
$šÃ¹ext
==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
('tag_fieldlist.htm');

726 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

727 
$d2
->
	`S‘NameS·û
('field','[',']');

728 
$d2
->
	`LßdSourû
(
$šÃ¹ext
);

729 
$ŞdSourû
 = 
$d2
->
SourûSŒšg
;

730 
$ŞdCgs
 = 
$d2
->
CTags
;

731 
$»s
 = '';

732 if(
	`is_¬¿y
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
è&& is_¬¿y(
$d2
->
CTags
))

734 
	`fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$v
)

736 if(
	`is£t
(
$v
['autof›ld']è&& 
	`em±y
($v['autofield'])) {

739 
$d2
->
SourûSŒšg
 = 
$ŞdSourû
;

740 
$d2
->
CTags
 = 
$ŞdCgs
;

741 
$âame
 = 
$v
['itemname'];

742 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$tid
=>
$ùag2
)

744 if(
$ùag2
->
	`G‘Name
()=='name')

746 
$d2
->
	`Assign
(
$tid
,
$âame
);

748 if(
$ùag2
->
	`G‘Name
()=='tagname')

750 
$d2
->
	`Assign
(
$tid
,
$k
);

752 if(
$ùag2
->
	`G‘Name
()=='value')

754 
$this
->
F›lds
[
$k
] = $this->
ChªÃlUn™
->
	`MakeF›ld
($k,$this->F›lds[$k],
$ùag2
);

755 @
$d2
->
	`Assign
(
$tid
,
$this
->
F›lds
[
$k
]);

758 
$»s
 .ğ
$d2
->
	`G‘ResuÉ
();

761 
$this
->
d
->
	`Assign
(
$i
,
$»s
);

767 
	}
}

775 
funùiÚ
 
	$Clo£
()

777 
$this
->
FixedV®ues
 = '';

778 
$this
->
F›lds
 = '';

779 
	}
}

789 
funùiÚ
 
G‘P»Next
(
$gty³
='', 
$s™e_Ïng
)

792 
	g$¡r_´e
 = '';

793 
	g$¡r_Ãxt
 = '';

794 
	g$¡r_´e_wÜds
 = '';

795 
	g$¡r_Ãxt_wÜds
 = '';

796 if(
	g$s™e_Ïng
 =ğ'ú' || 
$s™e_Ïng
 =='')

798 
$¡r_´e
 = 'ä¸Šä¸€ç¯‡';

799 
	g$¡r_Ãxt
 = 'ä¸‹ä¸€ç¯‡';

800 
	g$¡r_´e_wÜds
 = 'ä¸Šä¸€ç¯‡ï¼šæ²¡æœ‰äº†';

801 
	g$¡r_Ãxt_wÜds
 = 'ä¸‹ä¸€ç¯‡ï¼šæ²¡æœ‰äº†';

802 }
–£if
(
$s™e_Ïng
 == 'en')

804 
$¡r_´e
 = 'Preview';

805 
	g$¡r_Ãxt
 = 'Next';

806 
	g$¡r_´e_wÜds
 = 'Previewï¼šNull';

807 
	g$¡r_Ãxt_wÜds
 = 'Nextï¼šNull';

809 
	g$rs
 = '';

810 if(
couÁ
(
$this
->
P»Next
)<2)

812 
	g$aid
 = 
$this
->
ArcID
;

813 
	g$´eR
 = 
$this
->
dsql
->
G‘OÃ
("Select id From `#@__arctiny` where id<$aid And‡rcrank>-1 Andypeid='{$this->Fields['typeid']}' order by id desc");

814 
	g$ÃxtR
 = 
$this
->
dsql
->
G‘OÃ
("Select id From `#@__arctiny` where id>$aid And‡rcrank>-1 Andypeid='{$this->Fields['typeid']}' order by id‡sc");

815 
	g$Ãxt
 = (
is_¬¿y
(
$ÃxtR
) ? " where‡rc.id={$nextR['id']} " : ' where 1>2 ');

816 
	g$´e
 = (
is_¬¿y
(
$´eR
) ? " where‡rc.id={$preR['id']} " : ' where 1>2 ');

817 
	g$qu”y
 = "Select‡rc.id,arc.title,arc.shorttitle,arc.typeid,arc.ismake,arc.senddate,arc.arcrank,arc.money,arc.filename,arc.litpic,

818 
t
.
ty³dœ
,
	gt
.
	gty³Çme
,t.
	gÇm”uË
,t.
	gÇm”uË2
,t.
	gi¥¬t
,t.
	gmÜes™e
,t.
	gs™eu¾
,t.
s™•©h


819 
	gäom
 `#@
	g__¬chives
` 
¬c
 
Ëá
 
	gjoš
 #@
__¬ùy³
 
t
 
Ú
 
	g¬c
.
	gty³id
ñ.
id
 ";

820 
$ÃxtRow
 = 
$this
->
dsql
->
G‘OÃ
(
$qu”y
.
$Ãxt
);

821 
	g$´eRow
 = 
$this
->
dsql
->
G‘OÃ
(
$qu”y
.
$´e
);

822 if(
is_¬¿y
(
$´eRow
))

824 
	g$mlšk
 = 
G‘FeU¾
(
$´eRow
['id'],$preRow['typeid'],$preRow['senddate'],$preRow['title'],$preRow['ismake'],$preRow['arcrank'],

825 
$´eRow
['namerule'],$preRow['typedir'],$preRow['money'],$preRow['filename'],$preRow['moresite'],$preRow['siteurl'],$preRow['sitepath']);

826 
	g$this
->
	gP»Next
['´e'] = 
$¡r_´e
."ï¼š<a href='$mlink'>{$preRow['title']}</a> ";

827 
	g$this
->
	gP»Next
['preimg'] = "<a href='$mlink'><img src=\"{$preRow['litpic']}\"‡lt=\"{$preRow['title']}\"/></a> ";

831 
	g$this
->
	gP»Next
['´e'] = 
$¡r_´e_wÜds
;

832 
	g$this
->
	gP»Next
['preimg'] ="<img src=\"/templets/default/images/nophoto.jpg\"‡lt=\"å¯¹ä¸èµ·ï¼Œæ²¡æœ‰ä¸Šä¸€å›¾é›†äº†ï¼\"/>";

834 if(
is_¬¿y
(
$ÃxtRow
))

836 
	g$mlšk
 = 
G‘FeU¾
(
$ÃxtRow
['id'],$nextRow['typeid'],$nextRow['senddate'],$nextRow['title'],$nextRow['ismake'],$nextRow['arcrank'],

837 
$ÃxtRow
['namerule'],$nextRow['typedir'],$nextRow['money'],$nextRow['filename'],$nextRow['moresite'],$nextRow['siteurl'],$nextRow['sitepath']);

838 
	g$this
->
	gP»Next
['Ãxt'] = 
$¡r_Ãxt
."ï¼š<a href='$mlink'>{$nextRow['title']}</a> ";

839 
	g$this
->
	gP»Next
['nextimg'] = "<a href='$mlink'><img src=\"{$nextRow['litpic']}\"‡lt=\"{$nextRow['title']}\"/></a> ";

843 
	g$this
->
	gP»Next
['Ãxt'] = 
$¡r_Ãxt_wÜds
 ;

844 
	g$this
->
	gP»Next
['nextimg'] ="<a href='javascript:void(0)'‡lt=\"\"><img src=\"/templets/default/images/nophoto.jpg\"‡lt=\"å¯¹ä¸èµ·ï¼Œæ²¡æœ‰ä¸‹ä¸€å›¾é›†äº†ï¼\"/></a>";

847 if(
	g$gty³
=='pre')

849 
$rs
 = 
$this
->
P»Next
['pre'];

851 if(
	g$gty³
=='preimg'){

853 
$rs
 = 
$this
->
P»Next
['preimg'];

855 if(
	g$gty³
=='next')

857 
$rs
 = 
$this
->
P»Next
['next'];

859 if(
	g$gty³
=='nextimg'){

861 
$rs
 = 
$this
->
P»Next
['nextimg'];

865 
	g$rs
 = 
$this
->
P»Next
['pre']." &nbsp; ".$this->PreNext['next'];

867  
	g$rs
;

879 
funùiÚ
 
	$G‘Pageb»akDM
(
$tÙ®Page
, 
$nowPage
, 
$aid
,
$¶ªg
)

882 if(
$¶ªg
 == 'cn' || $plang == '')

884 
$Ïng_tÙ®
 = 'å…±';

885 
$Ïng_·ge
 = 'é¡µ';

886 
$Ïng_´e
 = 'ä¸Šä¸€é¡µ';

887 
$Ïng_Ãxt
 = 'ä¸‹ä¸€é¡µ';

888 }
	`–£if
(
$¶ªg
 == 'en')

890 
$Ïng_tÙ®
 = 'Total';

891 
$Ïng_·ge
 = 'Pages';

892 
$Ïng_´e
 = 'Pre';

893 
$Ïng_Ãxt
 = 'Next';

895 
glob®
 
$cfg_»wr™e
;

896 if(
$tÙ®Page
==1)

900 
$PageLi¡
 = "<li><a>".
$Ïng_tÙ®
.
$tÙ®Page
.
$Ïng_·ge
.": </a></li>";

901 
$nPage
 = 
$nowPage
-1;

902 
$lPage
 = 
$nowPage
+1;

903 if(
$nowPage
==1)

905 
$PageLi¡
.="<li><¨h»f='#'>".
$Ïng_´e
."</a></li>";

909 if(
$nPage
==1)

911 
$PageLi¡
.="<li><¨h»f='v›w.php?aid=$aid'>".
$Ïng_´e
."</a></li>";

912 if(
$cfg_»wr™e
 == 'Y')

914 
$PageLi¡
 = 
	`´eg_»¶aû
("#.php\?aid=(\d+)#i", '-\\1-1.html', $PageList);

919 
$PageLi¡
.="<li><¨h»f='v›w.php?aid=$aid&·g’o=$nPage'>".
$Ïng_´e
."</a></li>";

920 if(
$cfg_»wr™e
 == 'Y')

922 
$PageLi¡
 = 
	`¡r_»¶aû
(".php?aid=", "-", $PageList);

923 
$PageLi¡
 = 
	`´eg_»¶aû
("#&pageno=(\d+)#i", '-\\1.html', $PageList);

927 
$i
=1;$i<=
$tÙ®Page
;$i++)

929 if(
$i
==1)

931 if(
$nowPage
!=1)

933 
$PageLi¡
.="<li><a href='view.php?aid=$aid'>1</a></li>";

934 if(
$cfg_»wr™e
 == 'Y')

936 
$PageLi¡
 = 
	`´eg_»¶aû
("#.php\?aid=(\d+)#i", '-\\1-1.html', $PageList);

941 
$PageLi¡
.="<li class=\"thisclass\"><a>1</a></li>";

946 
$n
 = 
$i
;

947 if(
$nowPage
!=
$i
)

949 
$PageLi¡
.="<li><¨h»f='v›w.php?aid=$aid&·g’o=$i'>".
$n
."</a></li>";

950 if(
$cfg_»wr™e
 == 'Y')

952 
$PageLi¡
 = 
	`¡r_»¶aû
(".php?aid=", "-", $PageList);

953 
$PageLi¡
 = 
	`´eg_»¶aû
("#&pageno=(\d+)#i", '-\\1.html', $PageList);

958 
$PageLi¡
.="<li class=\"thisclass\"><a href='#'>{$n}</a></li>";

962 if(
$lPage
 <ğ
$tÙ®Page
)

964 
$PageLi¡
.="<li><¨h»f='v›w.php?aid=$aid&·g’o=$lPage'>".
$Ïng_Ãxt
."</a></li>";

965 if(
$cfg_»wr™e
 == 'Y')

967 
$PageLi¡
 = 
	`¡r_»¶aû
(".php?aid=", "-", $PageList);

968 
$PageLi¡
 = 
	`´eg_»¶aû
("#&pageno=(\d+)#i", '-\\1.html', $PageList);

973 
$PageLi¡
.ğ"<li><¨h»f='#'>".
$Ïng_Ãxt
."</a></li>";

975  
$PageLi¡
;

976 
	}
}

987 
funùiÚ
 
	$G‘Pageb»ak
(
$tÙ®Page
, 
$nowPage
, 
$aid
 ,
$¶ªg
)

990 if(
$¶ªg
 == 'cn' || $plang == '')

992 
$Ïng_tÙ®
 = 'å…± ';

993 
$Ïng_·ge
 = ' é¡µ';

994 
$Ïng_´e
 = 'ä¸Šä¸€é¡µ';

995 
$Ïng_Ãxt
 = 'ä¸‹ä¸€é¡µ';

997 
	`–£if
(
$¶ªg
 == 'en')

999 
$Ïng_tÙ®
 = 'Total ';

1000 
$Ïng_·ge
 = ' Pages';

1001 
$Ïng_´e
 = 'Pre';

1002 
$Ïng_Ãxt
 = 'Next';

1004 if(
$tÙ®Page
==1)

1008 
$PageLi¡
 = "<li><a>".
$Ïng_tÙ®
.
$tÙ®Page
.
$Ïng_·ge
.": </a></li>";

1009 
$nPage
 = 
$nowPage
-1;

1010 
$lPage
 = 
$nowPage
+1;

1011 if(
$nowPage
==1)

1013 
$PageLi¡
.="<li><¨h»f='#'>".
$Ïng_´e
."</a></li>";

1017 if(
$nPage
==1)

1019 
$PageLi¡
.="<li><¨h»f='".
$this
->
NameFœ¡
.".".$this->
ShÜtName
."'>".
$Ïng_´e
."</a></li>";

1023 
$PageLi¡
.="<li><¨h»f='".
$this
->
NameFœ¡
."_".
$nPage
.".".$this->
ShÜtName
."'>".
$Ïng_´e
."</a></li>";

1026 
$i
=1;$i<=
$tÙ®Page
;$i++)

1028 if(
$i
==1)

1030 if(
$nowPage
!=1)

1032 
$PageLi¡
.="<li><¨h»f='".
$this
->
NameFœ¡
.".".$this->
ShÜtName
."'>1</a></li>";

1036 
$PageLi¡
.="<li class=\"thisclass\"><a href='#'>1</a></li>";

1041 
$n
 = 
$i
;

1042 if(
$nowPage
!=
$i
)

1044 
$PageLi¡
.="<li><¨h»f='".
$this
->
NameFœ¡
."_".
$i
.".".$this->
ShÜtName
."'>".
$n
."</a></li>";

1048 
$PageLi¡
.="<li class=\"thisclass\"><a href='#'>{$n}</a></li>";

1052 if(
$lPage
 <ğ
$tÙ®Page
)

1054 
$PageLi¡
.="<li><¨h»f='".
$this
->
NameFœ¡
."_".
$lPage
.".".$this->
ShÜtName
."'>".
$Ïng_Ãxt
."</a></li>";

1058 
$PageLi¡
.ğ"<li><¨h»f='#'>".
$Ïng_Ãxt
."</a></li>";

1060  
$PageLi¡
;

1061 
	}
}

1071 
funùiÚ
 
	$G‘PageT™ËsDM
(
$¡yËName
, 
$·geNo
)

1073 if(
$this
->
TÙ®Page
==1)

1077 if(
	`couÁ
(
$this
->
S¶™T™Ës
)==0)

1081 
$i
=1;

1082 
$aid
 = 
$this
->
ArcID
;

1083 if(
$¡yËName
=='link')

1085 
$»v®ue
 = "";

1086 
	`fÜ—ch
(
$this
->
S¶™T™Ës
 
as
 
$k
=>
$v
)

1088 if(
$i
==1)

1090 
$»v®ue
 .= "<a href='view.php?aid=$aid&pageno=$i'>$v</a> \r\n";

1094 if(
$·geNo
==
$i
)

1096 
$»v®ue
 .= " $v \r\n";

1100 
$»v®ue
 .= "<a href='view.php?aid=$aid&pageno=$i'>$v</a> \r\n";

1103 
$i
++;

1108 
$»v®ue
 = "<select id='xakpagetitles' onchange='location.href=this.options[this.selectedIndex].value;'>\r\n";

1109 
	`fÜ—ch
(
$this
->
S¶™T™Ës
 
as
 
$k
=>
$v
)

1111 if(
$i
==1)

1113 
$»v®ue
 .ğ"<İtiÚ v®ue='".
$this
->
F›lds
['phpurl']."/view.php?aid=$aid&pageno=$i'>{$i}ã€{$v}</option>\r\n";

1117 if(
$·geNo
==
$i
)

1119 
$»v®ue
 .ğ"<İtiÚ v®ue='".
$this
->
F›lds
['phpurl']."/view.php?aid=$aid&pageno=$i' selected>{$i}ã€{$v}</option>\r\n";

1123 
$»v®ue
 .ğ"<İtiÚ v®ue='".
$this
->
F›lds
['phpurl']."/view.php?aid=$aid&pageno=$i'>{$i}ã€{$v}</option>\r\n";

1126 
$i
++;

1128 
$»v®ue
 .= "</select>\r\n";

1130  
$»v®ue
;

1131 
	}
}

1141 
funùiÚ
 
	$G‘PageT™ËsST
(
$¡yËName
, 
$·geNo
)

1143 if(
$this
->
TÙ®Page
==1)

1147 if(
	`couÁ
(
$this
->
S¶™T™Ës
)==0)

1151 
$i
=1;

1152 if(
$¡yËName
=='link')

1154 
$»v®ue
 = "";

1155 
	`fÜ—ch
(
$this
->
S¶™T™Ës
 
as
 
$k
=>
$v
)

1157 if(
$i
==1)

1159 
$»v®ue
 .ğ"<¨h»f='".
$this
->
NameFœ¡
.".".$this->
ShÜtName
."'>$v</a> \r\n";

1163 if(
$·geNo
==
$i
)

1165 
$»v®ue
 .= " $v \r\n";

1169 
$»v®ue
 .ğ"<¨h»f='".
$this
->
NameFœ¡
."_".
$i
.".".$this->
ShÜtName
."'>$v</a> \r\n";

1172 
$i
++;

1177 
$»v®ue
 = "<select id='xakpagetitles' onchange='location.href=this.options[this.selectedIndex].value;'>\r\n";

1178 
	`fÜ—ch
(
$this
->
S¶™T™Ës
 
as
 
$k
=>
$v
)

1180 if(
$i
==1)

1182 
$»v®ue
 .ğ"<İtiÚ v®ue='".
$this
->
NameFœ¡
.".".$this->
ShÜtName
."'>{$i}ã€{$v}</option>\r\n";

1186 if(
$·geNo
==
$i
)

1188 
$»v®ue
 .ğ"<İtiÚ v®ue='".
$this
->
NameFœ¡
."_".
$i
.".".$this->
ShÜtName
."' selected>{$i}ã€{$v}</option>\r\n";

1192 
$»v®ue
 .ğ"<İtiÚ v®ue='".
$this
->
NameFœ¡
."_".
$i
.".".$this->
ShÜtName
."'>{$i}ã€{$v}</option>\r\n";

1195 
$i
++;

1197 
$»v®ue
 .= "</select>\r\n";

1199  
$»v®ue
;

1200 
	}
}

1209 
funùiÚ
 
	$R•ÏûKeywÜd
(
$kw
,&
$body
)

1211 
glob®
 
$cfg_cm¥©h
;

1212 
$maxkey
 = 5;

1213 
$kws
 = 
	`ex¶ode
(",",
	`Œim
(
$kw
));

1214 
$i
=0;

1215 
$k¬r
 = 
$k¯¼
 = 
$GLOBALS
['»¶aûd'] = 
	`¬¿y
();

1218 
$body
 = 
	`´eg_»¶aû
("#(<a(.*))(>)(.*)(<)(\/a>)#isU", '\\1-]-\\4-[-\\6', $body);

1241 
$qu”y
 = "SELECT * FROM #@__keywords WHERE„purl<>'' ORDER BY„ank DESC";

1242 
$this
->
dsql
->
	`S‘Qu”y
(
$qu”y
);

1243 
$this
->
dsql
->
	`Execu‹
();

1244 
$row
 = 
$this
->
dsql
->
	`G‘A¼ay
())

1246 
$key
 = 
	`Œim
(
$row
['keyword']);

1247 
$key_u¾
=
	`Œim
(
$row
['rpurl']);

1248 
$k¬r
[] = 
$key
;

1249 
$k¯¼
[] = "<a href='$key_url'arget='_blank'><u>$key</u></a>";

1253 
$body
 = @
	`´eg_»¶aû
("#(^|>)([^<]+)(?=<|$)#sUe", "_highlight('\\2', \$karr, \$kaarr, '\\1')", $body);

1256 
$body
 = 
	`´eg_»¶aû
("#(<a(.*))-\]-(.*)-\[-(\/a>)#isU", '\\1>\\3<\\4', $body);

1257  
$body
;

1258 
	}
}

1264 
funùiÚ
 
	$_highlight
(
$¡ršg
, 
$wÜds
, 
$»suÉ
, 
$´e
)

1266 
glob®
 
$cfg_»¶aû_num
;

1267 
$¡ršg
 = 
	`¡r_»¶aû
('\"', '"', $string);

1268 if(
$cfg_»¶aû_num
 > 0)

1270 
	`fÜ—ch
 (
$wÜds
 
as
 
$key
 => 
$wÜd
)

1272 if(
$GLOBALS
['»¶aûd'][
$wÜd
] == 1)

1276 
$¡ršg
 = 
	`´eg_»¶aû
("#".
	`´eg_quÙe
(
$wÜd
)."#", 
$»suÉ
[
$key
], $¡ršg, 
$cfg_»¶aû_num
);

1277 if(
	`¡½os
(
$¡ršg
, 
$wÜd
è!=ğ
FALSE
)

1279 
$GLOBALS
['»¶aûd'][
$wÜd
] = 1;

1285 
$¡ršg
 = 
	`¡r_»¶aû
(
$wÜds
, 
$»suÉ
, $string);

1287  
$´e
.
$¡ršg
;

1288 
	}
}

	@E:\web\weixun\functions\arc.caicai.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

16 şas 
	cCaiÿi
 
ex‹nds
 
	mD©aLi¡CP


18 
v¬
 
	m$maxPageSize
 = 100;

19 
v¬
 
	m$¬cCacheTime
 = 3600;

27 
funùiÚ
 
	$P»Lßd
()

29 
glob®
 
$tÙ®»suÉ
,
$·g’o
;

30 if(
	`em±y
(
$·g’o
è|| 
	`´eg_m©ch
("#[^0-9]#", $pageno)) $pageno = 1;

31 if(
	`em±y
(
$tÙ®»suÉ
è|| 
	`´eg_m©ch
("#[^0-9]#", $totalresult)) $totalresult = 0;

33 
$this
->
·geNO
 = 
$·g’o
;

34 
$this
->
tÙ®ResuÉ
 = 
$tÙ®»suÉ
;

36 if(
	`is£t
(
$this
->
l
->
Cfgs
['pagesize'])){

37 
$this
->
·geSize
 = $this->
l
->
Cfgs
['pagesize'];

39 
$this
->
tÙ®Page
 = 
	`û
($this->
tÙ®ResuÉ
/$this->
·geSize
);

40 if(
$this
->
tÙ®Page
 > $this->
maxPageSize
)

42 
$this
->
tÙ®Page
 = $this->
maxPageSize
;

45 if(
$this
->
·geNO
 > $this->
tÙ®Page
)

47 
$this
->
·geNO
 = $this->
tÙ®Page
;

48 
$this
->
tÙ®ResuÉ
 = $this->
tÙ®Page
 * $this->
·geSize
;

50 
$this
->
sourûSql
 = 
	`´eg_»¶aû
("#LIMIT [0-9,]{1,}#i", '', $this->sourceSql);

51 ifĞ
$this
->
tÙ®ResuÉ
==0 )

56 
$couÁQu”y
 = 
	`´eg_»¶aû
("#SELECT[ \r\n\t](.*)[ \r\n\t]FROM#is","SELECT COUNT(*èa dd FROM", 
$this
->
sourûSql
);

57 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
(
$couÁQu”y
);

58 
$this
->
tÙ®ResuÉ
 = 
$row
['dd'];

59 
$this
->
sourûSql
 .ğ" LIMIT 0,".$this->
·geSize
;

63 
$this
->
sourûSql
 .ğ" LIMIT ".(($this->
·geNO
-1è* $this->
·geSize
).",".$this->pageSize;

75 
funùiÚ
 
	`G‘ArcLi¡
(
$©ts
, 
$»fObj
='', 
$f›lds
=
	$¬¿y
())

77 
$rsA¼ay
 = 
	`¬¿y
();

78 
$t1
 = 
	`Exeùime
();

79 if(!
$this
->
isQu”y
)

81 
$this
->
dsql
->
	`Execu‹
('dli¡', $this->
sourûSql
);

83 
$i
 = 0;

84 
$¬r
=
$this
->
dsql
->
	`G‘A¼ay
('dlist'))

86 
$i
++;

87 
$¬r
['f’ame'] = $¬r['¬cu¾'] = 
	`G‘FeU¾
($arr['id'],$arr['typeid'],$arr['senddate'],$arr['title'],$arr['ismake'],

88 
$¬r
['arcrank'],$arr['namerule'],$arr['typedir'],$arr['money'],$arr['filename'],$arr['moresite'],$arr['siteurl'],$arr['sitepath']);

89 
$¬r
['ty³u¾'] = 
	`G‘Ty³U¾
($¬r['ty³id'],
	`MfTy³dœ
($arr['typedir']),$arr['isdefault'],$arr['defaultname'],

90 
$¬r
['ispart'],$arr['namerule2'],$arr['moresite'],$arr['siteurl'],$arr['sitepath']);

91 if(
$¬r
['litpic'] == '-' || $arr['litpic'] == '')

93 
$¬r
['litpic'] = 'templets/images/dfpic.gif';

95 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$¬r
['l™pic']è&& 
$GLOBALS
['cfg_multi_site'] == 'Y')

97 
$¬r
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$arr['litpic'];

99 
$¬r
['picname'] = $arr['litpic'];

100 
$¬r
['alttitle'] = $arr['userid']." çš„ç©ºé—´";

101 
$¬r
['face'] = ($arr['face']!='' ? $arr['face'] : 'images/nopic.gif');

102 if(
$¬r
['userid']!='')

104 
$¬r
['¥aûu¾'] = 
$GLOBALS
['cfg_basehost'].'/user/index.php?uid='.$arr['userid'];

108 
$¬r
['alttitle'] = $arr['title'];

109 
$¬r
['spaceurl'] = $arr['arcurl'];

110 
$¬r
['face'] = $arr['litpic'];

111 
$¬r
['çû'] = 
	`¡r_»¶aû
('defaultpic','dfcaicai',$arr['face']);

113 if(!
	`em±y
(
$¬r
['lastpost']))

115 
$¬r
['Ï¡po¡'] = 
	`MyD©e
('m-d h:i',$arr['lastpost']);

119 
$¬r
['lastpost'] = "<a href='../module/feedback.php?aid={$arr['id']}'>è¯´å‡ å¥&gt;&gt;</a>";

121 
$rsA¼ay
[
$i
] = 
$¬r
;

122 if(
$i
 >ğ
$this
->
·geSize
)

127 
$this
->
dsql
->
	`F»eResuÉ
('dlist');

128 
$this
->
qu”yTime
 = (
	`Exeùime
(è- 
$t1
);

129  
$rsA¼ay
;

130 
	}
}

140 
funùiÚ
 
G‘SÜtArc
(
$©ts
, 
$»fObj
='', 
$f›lds
=
	$¬¿y
())

142 
$¬üow
 = (
	`em±y
(
$©ts
['row']) ? 12 : $atts['row']);

143 
$Üd”
 = (
	`em±y
(
$©ts
['order']) ? 'scores' : $atts['order'] );

144 
$Üd”way
 = (
	`em±y
(
$©ts
['orderway']) ? 'desc' : $atts['orderway'] );

145 if(
	`em±y
(
$¬üow
)) $arcrow = 12;

147 
$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,

148 

.
isdeçuÉ
,.
deçuÉÇme
,.
Çm”uË
,.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


149 
FROM
 `#@
__¬chives
` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
 =‡rc.
ty³id


150 
WHERE
 
¬c
.
¬üªk
>-1 
ORDER
 
BY
‡rc.{
$Üd”
} 
$Üd”way
 
LIMIT
 0,
$¬üow
 ";

152 
$rsA¼ay
 = 
	`¬¿y
();

154 
$ÿcheFe
 = 
XAKDATA
.'/ÿche/ÿiÿi_'.
	`md5
(
$qu”y
).'.inc';

155 
$ÃedCache
 = 
çl£
;

156 if(
	`fe_exi¡s
(
$ÿcheFe
è&& 
	`femtime
($ÿcheFe)-
	`time
(è< 
$this
->
¬cCacheTime
)

158 
$å
 = 
	`fİ’
(
$ÿcheFe
, 'r');

159 
$ids
 = 
	`ä—d
(
$å
, 
	`fesize
(
$ÿcheFe
));

160 
	`fşo£
(
$å
);

161 
$ids
 = 
	`Œim
($ids);

162 ifĞ!
	`em±y
(
$ids
) )

164 
$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,

165 

.
isdeçuÉ
,.
deçuÉÇme
,.
Çm”uË
,.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


166 
FROM
 `#@
__¬chives
` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
÷rc.
ty³id


167 
WHERE
 
¬c
.
id
 
	`š
(
$ids
è
ORDER
 
BY
‡rc.{
$Üd”
} 
$Üd”way
 ";

172 
$ÃedCache
 = 
Œue
;

174 
$ids
 = 
	`¬¿y
();

175 
$i
 = 0;

176 
$this
->
dsql
->
	`Execu‹
('ÿi',
$qu”y
);

177 
$¬r
=
$this
->
dsql
->
	`G‘A¼ay
('cai'))

179 
$i
++;

180 
$ids
[] = 
$¬r
['id'];

181 
$¬r
['f’ame'] = $¬r['¬cu¾'] = 
	`G‘FeU¾
($arr['id'],$arr['typeid'],$arr['senddate'],$arr['title'],$arr['ismake'],

182 
$¬r
['arcrank'],$arr['namerule'],$arr['typedir'],$arr['money'],$arr['filename'],$arr['moresite'],$arr['siteurl'],$arr['sitepath']);

184 
$¬r
['ty³u¾'] = 
	`G‘Ty³U¾
($¬r['ty³id'], 
	`MfTy³dœ
($arr['typedir']), $arr['isdefault'], $arr['defaultname'],

185 
$¬r
['ispart'], $arr['namerule2'], $arr['moresite'], $arr['siteurl'], $arr['sitepath']);

187 if(
$¬r
['litpic']=='') $arr['litpic'] = '/images/defaultpic.gif';

189 if(!
	`´eg_m©ch
("#^h‰p:\/\/#", 
$¬r
['litpic']))

191 
$¬r
['piúame'] = $¬r['l™pic'] = 
$GLOBALS
['cfg_cmsurl'].$arr['litpic'];

195 
$¬r
['picname'] = $arr['litpic'] = $arr['litpic'];

198 
$rsA¼ay
[
$i
] = 
$¬r
;

200 
$this
->
dsql
->
	`F»eResuÉ
('cai');

203 if(
$ÃedCache
 && 
	`couÁ
(
$ids
) > 0)

205 
$ids¡r
 = 
	`još
(',', 
$ids
);

206 
	`fe_put_cÚ‹Ás
(
$ÿcheFe
, 
$ids¡r
);

212  
$rsA¼ay
;

214 
	}
}

224 
funùiÚ
 
G‘C©®og
(
$©ts
,
$»fObj
='',
$f›lds
=
	$¬¿y
())

226 
$maxrow
 = (
	`em±y
(
$©ts
['row']) ? 12 : $atts['row']);

227 
$qu”y
 = "SELECT id,typename FROM `#@__arctype` WHERE„eid=0 AND ispart<2 AND channeltype>0 ORDER BY sortrank ASC LIMIT 0,$maxrow ";

228 
$rsA¼ay
 = 
	`¬¿y
();

229 
$this
->
dsql
->
	`Execu‹
('co',
$qu”y
);

230 
$i
 = 0;

231 
$¬r
=
$this
->
dsql
->
	`G‘A¼ay
('co'))

233 
$i
++;

234 
$rsA¼ay
[
$i
] = 
$¬r
;

236 
$this
->
dsql
->
	`F»eResuÉ
('co');

237  
$rsA¼ay
;

238 
	}
}

	@E:\web\weixun\functions\arc.freelist.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
 
	gXAKINC
.'/arc.partview.class.php';

9 @
£t_time_lim™
(0);

16 şas 
	cF»eLi¡


18 
v¬
 
	m$dsql
;

19 
v¬
 
	m$d
;

20 
v¬
 
	m$Ty³ID
;

21 
v¬
 
	m$Ty³Lšk
;

22 
v¬
 
	m$PageNo
;

23 
v¬
 
	m$TÙ®Page
;

24 
v¬
 
	m$TÙ®ResuÉ
;

25 
v¬
 
	m$PageSize
;

26 
v¬
 
	m$ChªÃlUn™
;

27 
v¬
 
	m$F›lds
;

28 
v¬
 
	m$P¬tV›w
;

29 
v¬
 
	m$FLInfos
;

30 
v¬
 
	m$Li¡Obj
;

31 
v¬
 
	m$Tem¶‘sFe
;

32 
v¬
 
	m$mašbË
;

35 
funùiÚ
 
	$__cÚ¡ruù
(
$fid
)

37 
glob®
 
$dsql
;

38 
$this
->
F»eID
 = 
$fid
;

39 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(0);

40 
$this
->
dsql
 = 
$dsql
;

41 
$this
->
mašbË
 = '#@__archives';

42 
$this
->
Tem¶‘sFe
 = '';

43 
$this
->
FLInfos
 = $this->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__freelist` WHERE‡id='$fid' ");

44 
$li¡¡r
 = 
$this
->
FLInfos
['listtag'];

45 
$this
->
FLInfos
['max·ge'] = (
	`em±y
($this->FLInfos['maxpage']) ? 100 : $this->FLInfos['maxpage']);

48 
$nd
 = 
Ãw
 
	`XakTagP¬£
();

49 
$nd
->
	`S‘NameS·û
("xak","{","}");

50 
$nd
->
	`LßdSŒšg
(
$li¡¡r
);

51 
$this
->
Li¡Obj
 = 
$nd
->
	`G‘Tag
('list');

52 
$this
->
PageSize
 = $this->
Li¡Obj
->
	`G‘A‰
('pagesize');

53 if(
	`em±y
(
$this
->
PageSize
))

55 
$this
->
PageSize
 = 30;

57 
$chªÃlid
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('channel');

71 
$chªÃlid
 = 
	`štv®
($channelid);

72 
$this
->
mašbË
 = '#@__archives';

75 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

76 
$this
->
d
->
	`S‘NameS·û
("xak","{","}");

77 
$this
->
d
->
	`S‘RefObj
($this);

80 
$this
->
F›lds
['aid'] = $this->
FLInfos
['aid'];

81 
$this
->
F›lds
['t™Ë'] = $this->
FLInfos
['title'];

82 
$this
->
F›lds
['pos™iÚ'] = $this->
FLInfos
['title'];

83 
$this
->
F›lds
['keywÜds'] = $this->
FLInfos
['keywords'];

84 
$this
->
F›lds
['desütiÚ'] = $this->
FLInfos
['description'];

85 
$chªÃlid
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('channel');

86 if(!
	`em±y
(
$chªÃlid
))

88 
$this
->
F›lds
['chªÃÉy³'] = 
$chªÃlid
;

89 
$this
->
ChªÃlUn™
 = 
Ãw
 
	`ChªÃlUn™
(
$chªÃlid
);

93 
$this
->
F›lds
['channeltype'] = 0;

95 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
)

97 
$this
->
F›lds
[
$k
] = 
$v
;

99 
$this
->
P¬tV›w
 = 
Ãw
 
	`P¬tV›w
();

100 
$this
->
	`CouÁRecÜd
();

104 
funùiÚ
 
	$F»eLi¡
(
$fid
)

106 
$this
->
	`__cÚ¡ruù
(
$fid
);

107 
	}
}

110 
funùiÚ
 
	$Clo£
()

112 
	}
}

120 
funùiÚ
 
	$CouÁRecÜd
()

122 
glob®
 
$cfg_li¡_sÚ
,
$cfg_ÃedsÚty³
;

125 
$this
->
TÙ®ResuÉ
 = -1;

126 if(
	`is£t
(
$GLOBALS
['TotalResult']))

128 
$this
->
TÙ®ResuÉ
 = 
$GLOBALS
['TotalResult'];

130 if(
	`is£t
(
$GLOBALS
['PageNo']))

132 
$this
->
PageNo
 = 
$GLOBALS
['PageNo'];

136 
$this
->
PageNo
 = 1;

140 if(
$this
->
TÙ®ResuÉ
==-1)

142 
$addSql
 = "‡rcrank > -1 AND channel>-1 ";

143 
$ty³id
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('typeid');

144 
$subday
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('subday');

145 
$li¡ty³
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('type');

146 
$©t
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('att');

147 
$chªÃlid
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('channel');

148 if(
	`em±y
(
$chªÃlid
))

150 
$chªÃlid
 = 0;

154 if(!
	`em±y
(
$ty³id
))

156 if(
$cfg_li¡_sÚ
=='N')

158 
$addSql
 .= " AND (typeid='$typeid') ";

162 
$addSql
 .ğ" ANDy³id iÀ(".
	`G‘SÚIds
(
$ty³id
,0,
TRUE
).") ";

167 if(
$©t
!='') {

168 
$æags
 = 
	`ex¶ode
(',',
$©t
);

169 
$i
=0;
	`is£t
(
$æags
[$i]);$i++è
$addSql
 .= " AND FIND_IN_SET('{$flags[$i]}',flag)>0 ";

173 if(
$chªÃlid
>0 && !
	`´eg_m©ch
("#¥ec#i", 
$li¡ty³
))

175 
$addSql
 .= " AND channel = '$channelid' ";

179 if(
	`´eg_m©ch
("#comm’d#i",
$li¡ty³
))

181 
$addSql
 .= " AND FIND_IN_SET('c',flag) > 0 ";

183 if(
	`´eg_m©ch
("#image#i",
$li¡ty³
))

185 
$addSql
 .= " AND†itpic <> '' ";

187 if(
	`´eg_m©ch
("#¥ec#i",
$li¡ty³
è|| 
$chªÃlid
==-1)

189 
$addSql
 .= " AND channel = -1 ";

191 if(!
	`em±y
(
$subday
))

193 
$¡¬‰ime
 = 
	`time
(è- 
$subday
 * 86400;

194 
$addSql
 .= " AND senddate > $starttime ";

196 
$keywÜd
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('keyword');

197 if(!
	`em±y
(
$keywÜd
))

199 
$addSql
 .= " AND CONCAT(title,keywords) REGEXP '$keyword' ";

201 
$cqu”y
 = "SELECT COUNT(*) AS dd FROM `{$this->maintable}` WHERE $addSql";

202 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
(
$cqu”y
);

203 if(
	`is_¬¿y
(
$row
))

205 
$this
->
TÙ®ResuÉ
 = 
$row
['dd'];

209 
$this
->
TÙ®ResuÉ
 = 0;

212 
$this
->
TÙ®Page
 = 
	`û
($this->
TÙ®ResuÉ
/$this->
PageSize
);

213 if(
$this
->
TÙ®Page
 > $this->
FLInfos
['maxpage'])

215 
$this
->
TÙ®Page
 = $this->
FLInfos
['maxpage'];

216 
$this
->
TÙ®ResuÉ
 = $this->
TÙ®Page
 * $this->
PageSize
;

218 
	}
}

226 
funùiÚ
 
	$LßdTem¶‘
()

228 
$tmpdœ
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir'];

229 
$‹mpfe
 = 
	`¡r_»¶aû
("{¡yË}",
$GLOBALS
['cfg_df_¡yË'],
$this
->
FLInfos
['templet']);

230 
$‹mpfe
 = 
$tmpdœ
."/".$tempfile;

231 if(!
	`fe_exi¡s
(
$‹mpfe
))

233 
$‹mpfe
 = 
$tmpdœ
."/".
$GLOBALS
['cfg_df_style']."/list_free.htm";

235 
$this
->
d
->
	`LßdTem¶©e
(
$‹mpfe
);

236 
$this
->
Tem¶‘sFe
 = 
	`´eg_»¶aû
("#^".
$GLOBALS
['cfg_ba£dœ']."#", '', 
$‹mpfe
);

237 
	}
}

247 
funùiÚ
 
	$MakeHtml
(
$¡¬age
=1, 
$mak•agesize
=0)

249 
$this
->
	`LßdTem¶‘
();

250 
$mu¾
 = "";

251 if(
	`em±y
(
$¡¬age
))

253 
$¡¬age
 = 1;

255 
$this
->
	`P¬£Tem¶‘sFœ¡
();

256 
$tÙ®·ge
 = 
	`û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

257 if(
$tÙ®·ge
==0)

259 
$tÙ®·ge
 = 1;

261 if(
$mak•agesize
>0)

263 
$’d·ge
 = 
$¡¬age
+
$mak•agesize
;

267 
$’d·ge
 = (
$tÙ®·ge
+1);

269 if(
$’d·ge
>(
$tÙ®·ge
+1))

271 
$’d·ge
 = 
$tÙ®·ge
;

273 
$fœ¡Fe
 = '';

274 
$this
->
PageNo
=
$¡¬age
;$this->PageNo<
$’d·ge
;$this->PageNo++)

276 
$this
->
	`P¬£DMF›lds
($this->
PageNo
,1);

279 
$makeFe
 = 
$this
->
	`G‘MakeFeRuË
();

280 if(!
	`´eg_m©ch
("#^\/#", 
$makeFe
))

282 
$makeFe
 = "/".$makeFile;

284 
$makeFe
 = 
	`¡r_»¶aû
('{·ge}',
$this
->
PageNo
,$makeFile);

285 
$mu¾
 = 
$makeFe
;

286 
$makeFe
 = 
$GLOBALS
['cfg_basedir'].$makeFile;

287 
$makeFe
 = 
	`´eg_»¶aû
("#\/{1,}#", "/", $makeFile);

288 if(
$this
->
PageNo
==1)

290 
$fœ¡Fe
 = 
$makeFe
;

294 
$this
->
d
->
	`SaveTo
(
$makeFe
);

295 
echo
 "æˆåŠŸåˆ›å»ºï¼š<¨h»f='".
	`´eg_»¶aû
("#\/{1,}#", "/", 
$mu¾
)."'arget='_blank'>".preg_replace("#\/{1,}#", "/", $murl)."</a><br/>";

297 if(
$this
->
FLInfos
['nodefault']==0)

299 
$mu¾
 = '/'.
	`¡r_»¶aû
('{cm¥©h}',
$GLOBALS
['cfg_cm¥©h'],
$this
->
FLInfos
['listdir']);

300 
$mu¾
 .ğ'/'.
$this
->
FLInfos
['defaultpage'];

301 
$šdexfe
 = 
$GLOBALS
['cfg_ba£dœ'].
$mu¾
;

302 
$mu¾
 = 
	`´eg_»¶aû
("#\/{1,}#", "/", $murl);

303 
echo
 "å¤åˆ¶ï¼š$fœ¡Fä¸º ".
$this
->
FLInfos
['defaultpage']." <br/>";

304 
	`cİy
(
$fœ¡Fe
,
$šdexfe
);

306 
$this
->
	`Clo£
();

307  
$mu¾
;

308 
	}
}

316 
funùiÚ
 
	$Di¥Ïy
()

318 
$this
->
	`LßdTem¶‘
();

319 
$this
->
	`P¬£Tem¶‘sFœ¡
();

320 
$this
->
	`P¬£DMF›lds
($this->
PageNo
,0);

321 
$this
->
d
->
	`Di¥Ïy
();

322 
	}
}

330 
funùiÚ
 
	$Di¥ÏyP¬tTem¶‘s
()

332 
$nmç
 = 0;

333 
$tmpdœ
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir'];

334 if(
$this
->
F›lds
['ispart']==1)

336 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
F»eID
,$this->
F›lds
['tempindex']);

337 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

338 
$‹mpfe
 = 
$tmpdœ
."/".$tempfile;

339 if(!
	`fe_exi¡s
(
$‹mpfe
))

341 
$‹mpfe
 = 
$tmpdœ
."/".
$GLOBALS
['cfg_df_style']."/index_default.htm";

343 
$this
->
P¬tV›w
->
	`S‘Tem¶‘
(
$‹mpfe
);

345 if(
$this
->
F›lds
['ispart']==2)

347 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
F»eID
,$this->
F›lds
['tempone']);

348 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

349 if(
	`is_fe
(
$tmpdœ
."/".
$‹mpfe
))

351 
$this
->
P¬tV›w
->
	`S‘Tem¶‘
(
$tmpdœ
."/".
$‹mpfe
);

355 
$this
->
P¬tV›w
->
	`S‘Tem¶‘
("è¿™æ˜¯æ²¡æœ‰ä½¿ç”¨æ¨¡æ¿çš„å•ç‹¬é¡µï¼","¡ršg"); 
$nmç
 = 1;

358 
	`C»©eDœ
(
$this
->
F›lds
['typedir']);

359 
$makeU¾
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],"index",$this->Fields['typedir'],$this->Fields['defaultname'],$this->Fields['namerule2']);

360 
$makeFe
 = 
$this
->
	`G‘TrueP©h
().
$makeU¾
;

361 if(
$nmç
==0)

363 
$this
->
P¬tV›w
->
	`Di¥Ïy
();

366 if(!
	`fe_exi¡s
(
$makeFe
))

368 
$this
->
P¬tV›w
->
	`Di¥Ïy
();

372 
	`šşude
(
$makeFe
);

375 
	}
}

383 
funùiÚ
 
	$P¬£Tem¶‘sFœ¡
()

385 
	`MakeOÃTag
(
$this
->
d
,$this);

386 
	}
}

396 
funùiÚ
 
	$P¬£DMF›lds
(
$PageNo
,
$ismake
=1)

398 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$gid
=>
$ùag
)

400 if(
$ùag
->
	`G‘Name
()=="freelist")

402 
$lim™¡¬t
 = (
$this
->
PageNo
-1è* $this->
PageSize
;

403 if(
$this
->
PageNo
 > $this->
FLInfos
['max·ge']è$this->
d
->
	`Assign
(
$gid
, 'å·²ç»è¶…è¿‡äº†æœ€å¤§å…è®¸åˆ—å‡ºçš„é¡µé¢ï¼');

404 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘Li¡
(
$lim™¡¬t
,
$ismake
));

406 if(
$ùag
->
	`G‘Name
()=="pagelist")

408 
$li¡_Ën
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("listsize"));

409 
$ùag
->
	`G‘A‰
("li¡™em")=="" ? 
$li¡™em
="info,index,pre,pageno,next,end,option" : $listitem=$ctag->GetAtt("listitem");

410 if(
$li¡_Ën
=="")

412 
$li¡_Ën
 = 3;

414 if(
$ismake
==0)

416 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
));

420 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡ST
(
$li¡_Ën
,
$li¡™em
));

423 if(
$ùag
->
	`G‘Name
()=="pageno")

425 
$this
->
d
->
	`Assign
(
$gid
,
$PageNo
);

428 
	}
}

436 
funùiÚ
 
	$G‘MakeFeRuË
()

438 
$okfe
 = '';

439 
$Çm”uË
 = 
$this
->
FLInfos
['namerule'];

440 
$li¡dœ
 = 
$this
->
FLInfos
['listdir'];

441 
$li¡dœ
 = 
	`¡r_»¶aû
('{cm¥©h}',
$GLOBALS
['cfg_cmspath'],$listdir);

442 
$okfe
 = 
	`¡r_»¶aû
('{li¡id}',
$this
->
FLInfos
['aid'],
$Çm”uË
);

443 
$okfe
 = 
	`¡r_»¶aû
('{li¡dœ}',
$li¡dœ
,$okfile);

444 
$okfe
 = 
	`¡r_»¶aû
("\\","/",$okfile);

445 
$mdœ
 = 
	`´eg_»¶aû
("#/([^/]*)$#", "", 
$okfe
);

446 if(!
	`´eg_m©ch
("#\/#", 
$mdœ
) &&…reg_match("#\.#", $mdir))

448  
$okfe
;

452 
	`C»©eDœ
(
$mdœ
,'','');

453  
$okfe
;

455 
	}
}

465 
funùiÚ
 
	$G‘Li¡
(
$lim™¡¬t
, 
$ismake
=1)

467 
glob®
 
$cfg_li¡_sÚ
,
$cfg_ÃedsÚty³
;

468 
$cŞ
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('col');

469 if(
	`em±y
(
$cŞ
))

471 
$cŞ
 = 1;

473 
$t™ËËn
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('titlelen');

474 
$šfŞ’
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('infolen');

475 
$imgwidth
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('imgwidth');

476 
$imgheight
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('imgheight');

477 
$t™ËËn
 = 
	`A‰Def
($titlelen,60);

478 
$šfŞ’
 = 
	`A‰Def
($infolen,250);

479 
$imgwidth
 = 
	`A‰Def
($imgwidth,80);

480 
$imgheight
 = 
	`A‰Def
($imgheight,80);

481 
$šÃ¹ext
 = 
	`Œim
(
$this
->
Li¡Obj
->
	`G‘IÂ”Text
());

482 if(
	`em±y
(
$šÃ¹ext
)è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("list_fulllist.htm");

484 
$bËwidth
 = 100;

485 if(
$cŞ
=="") $col=1;

486 
$cŞWidth
 = 
	`û
(100 / 
$cŞ
);

487 
$bËwidth
 = $tablewidth."%";

488 
$cŞWidth
 = $colWidth."%";

491 
$Üwh”e
 = "‡rc.arcrank > -1 AND channel>-1 ";

492 
$ty³id
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('typeid');

493 
$subday
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('subday');

494 
$li¡ty³
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('type');

495 
$©t
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('att');

496 
$chªÃlid
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('channel');

497 if(
	`em±y
(
$chªÃlid
)) $channelid = 0;

500 if(!
	`em±y
(
$ty³id
))

502 if(
$cfg_li¡_sÚ
=='N')

504 
$Üwh”e
 .= " AND (arc.typeid='$typeid') ";

508 
$Üwh”e
 .ğ" AND‡rc.ty³id IN (".
	`G‘SÚIds
(
$ty³id
, 0, 
TRUE
).") ";

513 if(
$©t
!='') {

514 
$æags
 = 
	`ex¶ode
(',', 
$©t
);

515 
$i
=0; 
	`is£t
(
$æags
[$i]); $i++è
$Üwh”e
 .= " AND FIND_IN_SET('{$flags[$i]}',flag)>0 ";

518 if(
$chªÃlid
>0 && !
	`´eg_m©ch
("#¥ec#i", 
$li¡ty³
))

520 
$Üwh”e
 .= " AND‡rc.channel = '$channelid' ";

524 if(
	`´eg_m©ch
("#comm’d#i",
$li¡ty³
))

526 
$Üwh”e
 .= " AND FIND_IN_SET('c',flag) > 0 ";

528 if(
	`´eg_m©ch
("#image#i",
$li¡ty³
))

530 
$Üwh”e
 .= " AND‡rc.litpic <> '' ";

532 if(
	`´eg_m©ch
("#¥ec#i",
$li¡ty³
è|| 
$chªÃlid
==-1)

534 
$Üwh”e
 .= " AND‡rc.channel = -1 ";

536 if(!
	`em±y
(
$subday
))

538 
$¡¬‰ime
 = 
	`time
(è- 
$subday
*86400;

539 
$Üwh”e
 .= " AND‡rc.senddate > $starttime ";

541 
$keywÜd
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('keyword');

542 if(!
	`em±y
(
$keywÜd
))

544 
$Üwh”e
 .= " AND CONCAT(arc.title,arc.keywords) REGEXP '$keyword' ";

546 
$Üd”by
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('orderby');

547 
$Üd”Way
 = 
$this
->
Li¡Obj
->
	`G‘A‰
('orderway');

550 
$Üd”sql
 = "";

551 if(
$Üd”by
=="senddate")

553 
$Üd”sql
=" ORDER BY‡rc.senddate $orderWay";

555 if(
$Üd”by
=="pubdate")

557 
$Üd”sql
=" ORDER BY‡rc.pubdate $orderWay";

559 if(
$Üd”by
=="id")

561 
$Üd”sql
=" ORDER BY‡rc.id $orderWay";

563 if(
$Üd”by
=="hot"||$orderby=="click")

565 
$Üd”sql
 = " ORDER BY‡rc.click $orderWay";

567 if(
$Üd”by
=="lastpost")

569 
$Üd”sql
 = " ORDER BY‡rc.lastpost $orderWay";

571 if(
$Üd”by
=="scores")

573 
$Üd”sql
 = " ORDER BY‡rc.scores $orderWay";

575 if(
$Üd”by
=="rand")

577 
$Üd”sql
 = " ORDER BY„and()";

581 
$Üd”sql
=" ORDER BY‡rc.sortrank $orderWay";

585 
$addF›ld
 = "";

586 
$addJoš
 = "";

587 if(
	`is_objeù
(
$this
->
ChªÃlUn™
))

589 
$addbË
 = 
$this
->
ChªÃlUn™
->
ChªÃlInfos
['addtable'];

590 if(
$addbË
!="")

592 
$addJoš
 = " LEFT JOIN $addbË ON‡rc.id = ".
$addbË
.".aid ";

593 
$addF›ld
 = "";

594 
$f›lds
 = 
	`ex¶ode
(",",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['listfields']);

595 
	`fÜ—ch
(
$f›lds
 
as
 
$k
=>
$v
)

597 
$nf›lds
[
$v
] = 
$k
;

599 
	`fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$¬r
)

601 if(
	`is£t
(
$nf›lds
[
$k
]))

603 if(!
	`em±y
(
$¬r
['rename']))

605 
$addF›ld
 .ğ",".
$addbË
.".".
$k
."‡ ".
$¬r
['rename'];

609 
$addF›ld
 .ğ",".
$addbË
.".".
$k
;

616 
$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,

617 

.
Çm”uË
,.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


618 
$addF›ld


619 
FROM
 {
$this
->
mašbË
} 
¬c


620 
LEFT
 
JOIN
 #@
__¬ùy³
 

 
ON
 
¬c
.
ty³id
ñp.
id


621 
$addJoš


622 
WHERE
 
$Üwh”e
 
$Üd”sql
 
LIMIT
 
$lim™¡¬t
,".$this->PageSize;

623 
$this
->
dsql
->
	`S‘Qu”y
(
$qu”y
);

624 
$this
->
dsql
->
	`Execu‹
("al");

625 
$¬i¡
 = "";

626 if(
$cŞ
>1)

628 
$¬i¡
 = "<table width='$tablewidth' border='0' cellspacing='0' cellpadding='0'>\r\n";

630 
$šd
 = 
Ãw
 
	`XakTagP¬£
();

631 
$šd
->
	`S‘NameS·û
("field","[","]");

632 
$šd
->
	`LßdSourû
(
$šÃ¹ext
);

633 
$GLOBALS
['autoindex'] = 0;

634 
$i
=0;$i<
$this
->
PageSize
;$i++)

636 if(
$cŞ
>1)

638 
$¬i¡
 .= "<tr>\r\n";

640 
$j
=0;$j<
$cŞ
;$j++)

642 if(
$cŞ
>1)

644 
$¬i¡
 .= "<td width='$colWidth'>\r\n";

646 if(
$row
 = 
$this
->
dsql
->
	`G‘A¼ay
("al"))

648 
$GLOBALS
['autoindex']++;

651 
$row
['id'] = $row['id'];

652 
$row
['¬cu¾'] = 
$this
->
	`G‘ArcU¾
($row['id'],$row['typeid'],$row['senddate'],

653 
$row
['title'],$row['ismake'],$row['arcrank'],$row['namerule'],$row['typedir'],$row['money'],

654 
$row
['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

655 
$row
['ty³u¾'] = 
	`G‘Ty³U¾
($row['typeid'],$row['typedir'],$row['isdefault'],$row['defaultname'],

656 
$row
['ispart'],$row['namerule2'],$row['siteurl'],$row['sitepath']);

657 if(
$ismake
==0 && 
$GLOBALS
['cfg_multi_site']=='Y')

659 if(
$row
["siteurl"]=="")

661 
$row
["s™eu¾"] = 
$GLOBALS
['cfg_mainsite'];

665 
$row
['desütiÚ'] = 
	`ú_sub¡r
($row['desütiÚ'],
$šfŞ’
);

667 if(
$row
['litpic'] == '-' || $row['litpic'] == '')

669 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

671 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$row
['l™pic']è&& 
$GLOBALS
['cfg_multi_site'] == 'Y')

673 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

675 
$row
['picname'] = $row['litpic'];

676 
$row
['info'] = $row['description'];

677 
$row
['filename'] = $row['arcurl'];

678 
$row
['¡ime'] = 
	`G‘D©eMK
($row['pubdate']);

679 
$row
['‹xšk'] = "<¨h»f='".$row['f’ame']."'™Ë='".
	`¡r_»¶aû
("'","",$row['title'])."'>".$row['title']."</a>";

680 
$row
['typelink'] = "<a href='".$row['typeurl']."'>[".$row['typename']."]</a>";

681 
$row
['imglšk'] = "<¨h»f='".$row['f’ame']."'><img src='".$row['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
	`¡r_»¶aû
("'","",$row['title'])."'></a>";

682 
$row
['image'] = "<img src='".$row['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
	`¡r_»¶aû
("'","",$row['title'])."'>";

683 
$row
['¶usu¾'] = $row['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

684 
$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

685 
$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

686 
$row
['t™Ë'] = 
	`ú_sub¡r
($row['t™Ë'],
$t™ËËn
);

687 if(
$row
['color']!="")

689 
$row
['title'] = "<font color='".$row['color']."'>".$row['title']."</font>";

691 if(
	`´eg_m©ch
("#c#", 
$row
['flag']))

693 
$row
['title'] = "<b>".$row['title']."</b>";

697 if(
	`is_objeù
(
$this
->
ChªÃlUn™
))

699 
	`fÜ—ch
(
$row
 
as
 
$k
=>
$v
)

701 if(
	`´eg_m©ch
("#[A-Z]#", 
$k
))

703 
$row
[
	`¡¹Şow”
(
$k
)] = 
$v
;

706 
	`fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$¬r
)

708 if(
	`is£t
(
$row
[
$k
]))

710 
$row
[
$k
] = 
$this
->
ChªÃlUn™
->
	`MakeF›ld
($k,$row[$k]);

716 if(
	`is_¬¿y
(
$šd
->
CTags
))

718 
	`fÜ—ch
(
$šd
->
CTags
 
as
 
$k
=>
$ùag
)

720 
$_f
 = 
$ùag
->
	`G‘Name
();

721 if(
$_f
=='array')

724 
$šd
->
	`Assign
(
$k
,
$row
);

728 if(
	`is£t
(
$row
[
$_f
]))

730 
$šd
->
	`Assign
(
$k
,
$row
[
$_f
]);

734 
$šd
->
	`Assign
(
$k
,"");

739 
$¬i¡
 .ğ
$šd
->
	`G‘ResuÉ
();

744 
$¬i¡
 .= "";

746 if(
$cŞ
>1)

748 
$¬i¡
 .= " </td>\r\n";

752 if(
$cŞ
>1){

753 
$i
 +ğ
$cŞ
 - 1;

755 if(
$cŞ
>1)

757 
$¬i¡
 .= " </tr>\r\n";

761 if(
$cŞ
>1)

763 
$¬i¡
 .= "</table>\r\n";

765 
$this
->
dsql
->
	`F»eResuÉ
("al");

766  
$¬i¡
;

767 
	}
}

777 
funùiÚ
 
G‘PageLi¡ST
(
$li¡_Ën
, 
$li¡™em
="info,index,end,pre,next,pageno")

779 
$´•age
="";

780 
	g$Ãxage
="";

781 
	g$´•ag’um
 = 
$this
->
PageNo
-1;

782 
	g$Ãxag’um
 = 
$this
->
PageNo
+1;

783 if(
	g$li¡_Ën
=="" || 
´eg_m©ch
("#[^0-9]#", 
$li¡_Ën
))

785 
	g$li¡_Ën
=3;

787 
	g$tÙ®·ge
 = 
û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

788 if(
	g$tÙ®·ge
 <ğ1 && 
$this
->
TÙ®ResuÉ
 > 0)

790  "å…±1é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•";

792 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

794  "å…±0é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•";

796 
	g$maššfo
 = " å…±{$tÙ®·ge}é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½• ";

797 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

798 
	g$Šam”uË
 = 
$this
->
G‘MakeFeRuË
();

799 
	g$Šam”uË
 = 
´eg_»¶aû
("#^(.*)\/#", '', 
$Šam”uË
);

803 if(
	g$this
->
	gPageNo
 != 1)

805 
$´•age
.="<¨h»f='".
¡r_»¶aû
("{·ge}", 
$´•ag’um
, 
$Šam”uË
)."'>ä¸Šä¸€é¡µ</a>\r\n";

806 
	g$šdex·ge
="<¨h»f='".
¡r_»¶aû
("{·ge}", 1, 
$Šam”uË
)."'>é¦–é¡µ</a>\r\n";

810 
	g$šdex·ge
="<a href='#'>é¦–é¡µ</a>\r\n";

814 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

816 
$Ãxage
.="<¨h»f='".
¡r_»¶aû
("{·ge}",
$Ãxag’um
,
$Šam”uË
)."'>ä¸‹ä¸€é¡µ</a>\r\n";

817 
	g$’d·ge
="<¨h»f='".
¡r_»¶aû
("{·ge}",
$tÙ®·ge
,
$Šam”uË
)."'>æœ«é¡µ</a>\r\n";

821 
	g$’d·ge
="<a href='#'>æœ«é¡µ</a>\r\n";

825 
	g$İtiÚËn
 = 
¡¾’
(
$tÙ®·ge
);

826 
	g$İtiÚËn
 = 
$İtiÚËn
*12 + 18;

827 if(
	g$İtiÚËn
 < 36) $optionlen = 36;

828 if(
	g$İtiÚËn
 > 100) $optionlen = 100;

829 
	g$İtiÚli¡
 = "<select‚ame='sldd' style='width:$optionlen' onchange='location.href=this.options[this.selectedIndex].value;'>\r\n";

830 
	g$æ
=1; $æ<=
$tÙ®·ge
; $fl++)

832 if(
	g$æ
==
$this
->
PageNo
)

834 
$İtiÚli¡
 .ğ"<İtiÚ v®ue='" . 
¡r_»¶aû
("{·ge}",
$æ
,
$Šam”uË
) . "' selected>$fl</option>\r\n";

836 
	g$İtiÚli¡
 .ğ"<İtiÚ v®ue='" . 
¡r_»¶aû
("{·ge}",
$æ
,
$Šam”uË
)."'>$fl</option>\r\n";

839 
	g$İtiÚli¡
 .= "</select>";

842 
	g$li¡dd
="";

843 
	g$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

844 if(
	g$this
->
	gPageNo
 >ğ
$tÙ®_li¡
)

846 
$j
 = 
$this
->
PageNo
-
$li¡_Ën
;

847 
	g$tÙ®_li¡
 = 
$this
->
PageNo
+
$li¡_Ën
;

848 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

850 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

855 
	g$j
 = 1;

856 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

858 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

862 
	g$j
; $j<=
$tÙ®_li¡
; $j++)

864 if(
	g$j
==
$this
->
PageNo
)

866 
$li¡dd
.= "<strong>{$j}</strong>\r\n";

870 
	g$li¡dd
.="<¨h»f='".
¡r_»¶aû
("{·ge}", 
$j
, 
$Šam”uË
)."'>".
	g$j
."</a>\r\n";

873 
	g$¶i¡
 = "";

874 if(
´eg_m©ch
('#šfo#i', 
$li¡™em
))

876 
	g$¶i¡
 .ğ
$maššfo
.' ';

878 if(
´eg_m©ch
('#šdex#i',
$li¡™em
))

880 
	g$¶i¡
 .ğ
$šdex·ge
.' ';

882 if(
´eg_m©ch
('#´e#i', 
$li¡™em
))

884 
	g$¶i¡
 .ğ
$´•age
.' ';

886 if(
´eg_m©ch
('#·g’o#i', 
$li¡™em
))

888 
	g$¶i¡
 .ğ
$li¡dd
.' ';

890 if(
´eg_m©ch
('#Ãxt#i', 
$li¡™em
))

892 
	g$¶i¡
 .ğ
$Ãxage
.' ';

894 if(
´eg_m©ch
('#’d#i', 
$li¡™em
))

896 
	g$¶i¡
 .ğ
$’d·ge
.' ';

898 if(
´eg_m©ch
('#İtiÚ#i', 
$li¡™em
))

900 
	g$¶i¡
 .ğ
$İtiÚli¡
;

902  
	g$¶i¡
;

913 
funùiÚ
 
G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
="index,end,pre,next,pageno")

915 
$´•age
="";

916 
	g$Ãxage
="";

917 
	g$´•ag’um
 = 
$this
->
PageNo
-1;

918 
	g$Ãxag’um
 = 
$this
->
PageNo
+1;

919 if(
	g$li¡_Ën
==""||
´eg_m©ch
("/[^0-9]/", 
$li¡_Ën
))

921 
	g$li¡_Ën
=3;

923 
	g$tÙ®·ge
 = 
û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

924 if(
	g$tÙ®·ge
<=1 && 
$this
->
TÙ®ResuÉ
>0)

926  "å…±1é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•";

928 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

930  "å…±0é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•";

932 
	g$maššfo
 = "å…±{$tÙ®·ge}é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•";

933 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

934 
	g$g‘u¾
 = "lid=".
$this
->
F»eID
."&TÙ®ResuÉ=".$this->
TÙ®ResuÉ
."&";

935 
	g$hid’fÜm
 = "<špuˆty³='hidd’'‚ame='lid' v®ue='".
$this
->
F»eID
."' />\r\n";

936 
	g$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='TÙ®ResuÉ' v®ue='".
$this
->
TÙ®ResuÉ
."' />\r\n";

937 
	g$pu¾
 .ğ"?".
$g‘u¾
;

940 if(
	g$this
->
	gPageNo
 != 1)

942 
$´•age
.="<¨h»f='".
$pu¾
."PageNo=$prepagenum'>ä¸Šä¸€é¡µ</a>\r\n";

943 
	g$šdex·ge
="<¨h»f='".
$pu¾
."PageNo=1'>é¦–é¡µ</a>\r\n";

947 
	g$šdex·ge
="<a href='#'>é¦–é¡µ</a>\r\n";

949 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

951 
$Ãxage
.="<¨h»f='".
$pu¾
."PageNo=$nextpagenum'>ä¸‹ä¸€é¡µ</a>\r\n";

952 
	g$’d·ge
="<¨h»f='".
$pu¾
."PageNo=$totalpage'>æœ«é¡µ</a>\r\n";

956 
	g$’d·ge
="<a href='#'>æœ«é¡µ</a>\r\n";

960 
	g$li¡dd
="";

961 
	g$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

962 if(
	g$this
->
	gPageNo
 >ğ
$tÙ®_li¡
)

964 
$j
 = 
$this
->
PageNo
-
$li¡_Ën
;

965 
	g$tÙ®_li¡
 = 
$this
->
PageNo
+
$li¡_Ën
;

966 if(
	g$tÙ®_li¡
>
	g$tÙ®·ge
è$tÙ®_li¡=
$tÙ®·ge
;

970 
	g$j
=1;

971 if(
	g$tÙ®_li¡
>
	g$tÙ®·ge
è$tÙ®_li¡=
$tÙ®·ge
;

973 
	g$j
;$j<=
$tÙ®_li¡
;$j++)

975 if(
	g$j
==
$this
->
PageNo
)

977 
$li¡dd
.= "<a href='#'>.$j.</a>\r\n";

981 
	g$li¡dd
.="<¨h»f='".
$pu¾
."PageNo=$j'>".
$j
."</a>\r\n";

984 
	g$¶i¡
 = "<fÜm‚ame='·g–i¡'‡ùiÚ='".
$this
->
G‘CurU¾
()."'>$hidenform";

985 
	g$¶i¡
 .ğ
$maššfo
.
$šdex·ge
.
$´•age
.
$li¡dd
.
$Ãxage
.
$’d·ge
;

986 if(
	g$tÙ®·ge
>
	g$tÙ®_li¡
)

988 
	g$¶i¡
.="<špuˆty³='‹xt'‚ame='PageNo' v®ue='".
$this
->
PageNo
."' style='width:30px' />\r\n";

989 
	g$¶i¡
.="<inputype='submit'‚ame='plistgo' value='GO' />\r\n";

991 
	g$¶i¡
 .= "</form>\r\n";

992  
	g$¶i¡
;

1014 
funùiÚ
 
G‘ArcU¾
(
$aid
, 
$ty³id
, 
$tim‘ag
, 
$t™Ë
, 
$ismake
=0, 
$¿nk
=0, 
$Çm”uË
='', 
$¬tdœ
='',

1015 
$mÚey
=0, 
$f’ame
='', 
$mÜes™e
='', 
$s™eu¾
='', 
$s™•©h
='')

1017  
G‘FeU¾
(
$aid
, 
$ty³id
, 
$tim‘ag
, 
$t™Ë
, 
$ismake
, 
$¿nk
, 
$Çm”uË
, 
$¬tdœ
,

1018 
$mÚey
, 
$f’ame
, 
$mÜes™e
, 
$s™eu¾
, 
$s™•©h
);

1027 
funùiÚ
 
	$G‘CurU¾
()

1029 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

1031 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

1032 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

1033 
$nowu¾
 = 
$nowu¾s
[0];

1037 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

1039  
$nowu¾
;

1040 
	}
}

	@E:\web\weixun\functions\arc.listview.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

7 
»quœe_Úû
(
XAKINC
.'/arc.partview.class.php');

8 
»quœe_Úû
(
XAKINC
.'/ftp.class.php');

10 
h–³r
('cache');

11 @
£t_time_lim™
(0);

19 şas 
	cLi¡V›w


21 
v¬
 
	m$dsql
;

22 
v¬
 
	m$d
;

23 
v¬
 
	m$d2
;

24 
v¬
 
	m$Ty³ID
;

25 
v¬
 
	m$Ty³Lšk
;

26 
v¬
 
	m$PageNo
;

27 
v¬
 
	m$TÙ®Page
;

28 
v¬
 
	m$TÙ®ResuÉ
;

29 
v¬
 
	m$PageSize
;

30 
v¬
 
	m$ChªÃlUn™
;

31 
v¬
 
	m$Li¡Ty³
;

32 
v¬
 
	m$F›lds
;

33 
v¬
 
	m$P¬tV›w
;

34 
v¬
 
	m$upPageTy³
;

35 
v¬
 
	m$addSql
;

36 
v¬
 
	m$IsE¼Ü
;

37 
v¬
 
	m$CrossID
;

38 
v¬
 
	m$IsR•Ïû
;

39 
v¬
 
	m$áp
;

40 
v¬
 
	m$»mÙeDœ
;

50 
funùiÚ
 
	$__cÚ¡ruù
(
$ty³id
, 
$uµage
=1)

52 
glob®
 
$dsql
,
$áp
;

53 
$this
->
Ty³ID
 = 
$ty³id
;

54 
$this
->
dsql
 = &
$dsql
;

55 
$this
->
CrossID
 = '';

56 
$this
->
IsR•Ïû
 = 
çl£
;

57 
$this
->
IsE¼Ü
 = 
çl£
;

58 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

59 
$this
->
d
->
	`S‘RefObj
($this);

60 
$this
->
d
->
	`S‘NameS·û
("xak", "{", "}");

61 
$this
->
d2
 = 
Ãw
 
	`XakTagP¬£
();

62 
$this
->
d2
->
	`S‘NameS·û
("field","[","]");

63 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(
$ty³id
);

64 
$this
->
upPageTy³
 = 
$uµage
;

65 
$this
->
áp
 = &
$áp
;

66 
$this
->
»mÙeDœ
 = '';

67 
$this
->
TÙ®ResuÉ
 = 
	`is_num”ic
($this->TotalResult)? $this->TotalResult : "";

69 if(!
	`is_¬¿y
(
$this
->
Ty³Lšk
->
Ty³Infos
))

71 
$this
->
IsE¼Ü
 = 
Œue
;

73 if(!
$this
->
IsE¼Ü
)

75 
$this
->
ChªÃlUn™
 = 
Ãw
 
	`ChªÃlUn™
($this->
Ty³Lšk
->
Ty³Infos
['channeltype']);

76 
$this
->
F›lds
 = $this->
Ty³Lšk
->
Ty³Infos
;

77 
$this
->
F›lds
['id'] = 
$ty³id
;

78 
$this
->
F›lds
['pos™iÚ'] = $this->
Ty³Lšk
->
	`G‘Pos™iÚLšk
(
Œue
);

79 
$this
->
F›lds
['t™Ë'] = 
	`´eg_»¶aû
("/[<>]/", " / ", $this->
Ty³Lšk
->
	`G‘Pos™iÚLšk
(
çl£
));

82 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
è
$this
->
F›lds
[$k] = $v;

83 
$this
->
F›lds
['rs¦šk'] = 
$GLOBALS
['cfg_cmsu¾']."/cÚfig/rss/".$this->
Ty³ID
.".xml";

86 
	`S‘SysEnv
(
$this
->
Ty³ID
,$this->
F›lds
['typename'],0,'','list');

87 
$this
->
F›lds
['ty³id'] = $this->
Ty³ID
;

90 if(
$this
->
Ty³Lšk
->
Ty³Infos
['cross']>0 && $this->TypeLink->TypeInfos['ispart']==0)

92 
$£lqu”y
 = '';

93 if(
$this
->
Ty³Lšk
->
Ty³Infos
['cross']==1)

95 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHEREypename LIKE '{$this->Fields['typename']}' AND id<>'{$this->TypeID}' ANDopid<>'{$this->TypeID}' ";

99 
$this
->
F›lds
['üossid'] = 
	`´eg_»¶aû
('/[^0-9,]/', '', 
	`Œim
($this->Fields['crossid']));

100 if(
$this
->
F›lds
['crossid']!='')

102 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHERE id in({$this->Fields['crossid']}) AND id<>{$this->TypeID} ANDopid<>{$this->TypeID} ";

105 if(
$£lqu”y
!='')

107 
$this
->
dsql
->
	`S‘Qu”y
(
$£lqu”y
);

108 
$this
->
dsql
->
	`Execu‹
();

109 
$¬r
 = 
$this
->
dsql
->
	`G‘A¼ay
())

111 
$this
->
CrossID
 .ğ($this->CrossID=='' ? 
$¬r
['id'] : ','.$arr['id']);

121 
funùiÚ
 
	$Li¡V›w
(
$ty³id
,
$uµage
=0){

122 
$this
->
	`__cÚ¡ruù
(
$ty³id
,
$uµage
);

123 
	}
}

126 
funùiÚ
 
	$Clo£
()

129 
	}
}

138 
funùiÚ
 
	$CouÁRecÜd
()

140 
glob®
 
$cfg_li¡_sÚ
,
$cfg_Ãed_ty³id2
,
$cfg_üoss_£ùy³id
;

141 if(
	`em±y
(
$cfg_Ãed_ty³id2
)) $cfg_need_typeid2 = 'N';

144 
$this
->
TÙ®ResuÉ
 = -1;

145 if(
	`is£t
(
$GLOBALS
['TÙ®ResuÉ'])è
$this
->
TÙ®ResuÉ
 = $GLOBALS['TotalResult'];

146 if(
	`is£t
(
$GLOBALS
['PageNo'])è
$this
->
PageNo
 = $GLOBALS['PageNo'];

147 
$this
->
PageNo
 = 1;

148 
$this
->
addSql
 = "‡rc.arcrank > -1 ";

150 
$ty³id2like
 = " '%,{$this->TypeID},%' ";

151 if(
$cfg_li¡_sÚ
=='N')

154 if(
$cfg_Ãed_ty³id2
=='N')

156 if(
$this
->
CrossID
==''è$this->
addSql
 .ğ" AND (¬c.ty³id='".$this->
Ty³ID
."') ";

157 
$this
->
addSql
 .= " AND (arc.typeid in({$this->CrossID},{$this->TypeID})) ";

161 if(
$this
->
CrossID
=='')

163 
$this
->
addSql
 .ğ" AND ( (¬c.ty³id='".$this->
Ty³ID
."') OR CONCAT(',',‡rc.typeid2, ',') LIKE $typeid2like) ";

165 if(
$cfg_üoss_£ùy³id
 == 'Y')

167 
$ty³id2Clike
 = " '%,{$this->CrossID},%' ";

168 
$this
->
addSql
 .= " AND (‡rc.typeid IN({$this->CrossID},{$this->TypeID}) OR CONCAT(',',‡rc.typeid2, ',') LIKE $typeid2like OR CONCAT(',',‡rc.typeid2, ',') LIKE $typeid2Clike)";

170 
$this
->
addSql
 .= " AND (‡rc.typeid IN({$this->CrossID},{$this->TypeID}) OR CONCAT(',',‡rc.typeid2, ',') LIKE $typeid2like)";

177 
$sÚids
 = 
	`G‘SÚIds
(
$this
->
Ty³ID
,$this->
F›lds
['channeltype']);

178 if(!
	`´eg_m©ch
("/,/", 
$sÚids
)) {

179 
$sÚidsCÚ
 = "‡rc.typeid = '$sonids' ";

182 
$sÚidsCÚ
 = "‡rc.typeid IN($sonids) ";

184 if(
$cfg_Ãed_ty³id2
=='N')

186 if(
$this
->
CrossID
==''è$this->
addSql
 .= " AND ( $sonidsCon ) ";

187 
$this
->
addSql
 .= " AND (‡rc.typeid IN ({$sonids},{$this->CrossID}) ) ";

191 if(
$this
->
CrossID
=='')

193 
$this
->
addSql
 .= " AND ( $sonidsCon OR CONCAT(',',‡rc.typeid2, ',')†ike $typeid2like ) ";

195 if(
$cfg_üoss_£ùy³id
 == 'Y')

197 
$ty³id2Clike
 = " '%,{$this->CrossID},%' ";

198 
$this
->
addSql
 .= " AND (‡rc.typeid IN ({$sonids},{$this->CrossID}) OR CONCAT(',',‡rc.typeid2, ',') LIKE $typeid2like OR CONCAT(',',‡rc.typeid2, ',') LIKE $typeid2Clike) ";

200 
$this
->
addSql
 .= " AND (‡rc.typeid IN ({$sonids},{$this->CrossID}) OR CONCAT(',',‡rc.typeid2, ',') LIKE $typeid2like) ";

206 if(
$this
->
TÙ®ResuÉ
==-1)

208 
$cqu”y
 = "SELECT COUNT(*èAS dd FROM `#@__¬ùšy`‡røWHERE ".
$this
->
addSql
;

209 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
(
$cqu”y
);

210 if(
	`is_¬¿y
(
$row
))

212 
$this
->
TÙ®ResuÉ
 = 
$row
['dd'];

216 
$this
->
TÙ®ResuÉ
 = 0;

221 
$‹mpfe
 = 
$GLOBALS
['cfg_ba£dœ'].$GLOBALS['cfg_‹m¶‘s_dœ']."/".
$this
->
Ty³Lšk
->
Ty³Infos
['templist'];

222 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}", 
$this
->
Ty³ID
, $tempfile);

223 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}", 
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'], $tempfile);

224 if(!
	`fe_exi¡s
(
$‹mpfe
))

226 
$‹mpfe
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir']."/".$GLOBALS['cfg_df_style']."/list_default.htm";

228 if(!
	`fe_exi¡s
(
$‹mpfe
)||!
	`is_fe
($tempfile))

230 
echo
 "æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è§£ææ–‡æ¡£ï¼";

231 
	`ex™
();

233 
$this
->
d
->
	`LßdTem¶©e
(
$‹mpfe
);

234 
$ùag
 = 
$this
->
d
->
	`G‘Tag
("page");

235 if(!
	`is_objeù
(
$ùag
))

237 
$ùag
 = 
$this
->
d
->
	`G‘Tag
("list");

239 if(!
	`is_objeù
(
$ùag
))

241 
$this
->
PageSize
 = 20;

245 if(
$ùag
->
	`G‘A‰
("pagesize")!="")

247 
$this
->
PageSize
 = 
$ùag
->
	`G‘A‰
("pagesize");

251 
$this
->
PageSize
 = 20;

254 
$this
->
TÙ®Page
 = 
	`û
($this->
TÙ®ResuÉ
/$this->
PageSize
);

255 
	}
}

266 
funùiÚ
 
	$MakeHtml
(
$¡¬age
=1, 
$mak•agesize
=0, 
$i¤emÙe
=0)

268 
glob®
 
$cfg_»mÙe_s™e
;

269 if(
	`em±y
(
$¡¬age
))

271 
$¡¬age
 = 1;

275 if(
$this
->
Ty³Lšk
->
Ty³Infos
['isdefault']==-1)

277 
echo
 'è¿™ä¸ªç±»ç›®æ˜¯åŠ¨æ€ç±»ç›®ï¼';

278  '../moduË/li¡.php?tid='.
$this
->
Ty³Lšk
->
Ty³Infos
['id'];

281 if(
$this
->
Ty³Lšk
->
Ty³Infos
['isdefault']==2)

283 
echo
 'è¿™ä¸ªç±»ç›®é“¾æ¥åˆ°ç¬¬ä¸€ä¸ªå­åˆ†ç±»ï¼';

284  '../moduË/li¡.php?tid='.
$this
->
Ty³Lšk
->
Ty³Infos
['id'];

288 if(
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']>0)

290 
$»u¾
 = 
$this
->
	`MakeP¬tTem¶‘s
();

291  
$»u¾
;

294 
$this
->
	`CouÁRecÜd
();

296 
$this
->
	`P¬£Tem¶‘sFœ¡
();

297 
$tÙ®·ge
 = 
	`û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

298 if(
$tÙ®·ge
==0)

300 
$tÙ®·ge
 = 1;

302 
	`C»©eDœ
(
	`MfTy³dœ
(
$this
->
F›lds
['typedir']));

303 
$mu¾
 = '';

304 if(
$mak•agesize
 > 0)

306 
$’d·ge
 = 
$¡¬age
+
$mak•agesize
;

310 
$’d·ge
 = (
$tÙ®·ge
+1);

312 ifĞ
$’d·ge
 >ğ
$tÙ®·ge
+1 )

314 
$’d·ge
 = 
$tÙ®·ge
+1;

316 if(
$’d·ge
==1)

318 
$’d·ge
 = 2;

320 
$this
->
PageNo
=
$¡¬age
; $this->PageNØ< 
$’d·ge
; $this->PageNo++)

322 
$this
->
	`P¬£DMF›lds
($this->
PageNo
,1);

323 
$makeFe
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],'list',$this->Fields['typedir'],'',$this->Fields['namerule2']);

324 
$makeFe
 = 
	`¡r_»¶aû
("{·ge}", 
$this
->
PageNo
, $makeFile);

325 
$mu¾
 = 
$makeFe
;

326 if(!
	`´eg_m©ch
("/^\//", 
$makeFe
))

328 
$makeFe
 = "/".$makeFile;

330 
$makeFe
 = 
$this
->
	`G‘TrueP©h
().$makeFile;

331 
$makeFe
 = 
	`´eg_»¶aû
("/\/{1,}/", "/", $makeFile);

332 
$mu¾
 = 
$this
->
	`G‘TrueU¾
($murl);

333 
$this
->
d
->
	`SaveTo
(
$makeFe
);

335 if(
$cfg_»mÙe_s™e
=='Y'&& 
$i¤emÙe
 == 1)

338 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '',
$makeFe
);

339 
$loÿlfe
 = '..'.
$»mÙefe
;

340 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.html/', '',
$»mÙefe
);

342 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

343 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'acii');

346 if(
$¡¬age
==1)

349 if(
$this
->
Ty³Lšk
->
Ty³Infos
['isdefault']==1

350 && 
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']==0)

352 
$ÚlyruË
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],"list",$this->Fields['typedir'],'',$this->Fields['namerule2']);

353 
$ÚlyruË
 = 
	`¡r_»¶aû
("{page}","1",$onlyrule);

354 
$li¡_1
 = 
$this
->
	`G‘TrueP©h
().
$ÚlyruË
;

355 
$mu¾
 = 
	`MfTy³dœ
(
$this
->
F›lds
['typedir']).'/'.$this->Fields['defaultname'];

357 if(
$cfg_»mÙe_s™e
=='Y'&& 
$i¤emÙe
 == 1)

360 
$»mÙefe
 = 
$mu¾
;

361 
$loÿlfe
 = '..'.
$»mÙefe
;

362 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.html/', '',
$»mÙefe
);

364 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

365 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'acii');

367 
$šdexÇme
 = 
$this
->
	`G‘TrueP©h
().
$mu¾
;

368 
	`cİy
(
$li¡_1
,
$šdexÇme
);

371  
$mu¾
;

372 
	}
}

380 
funùiÚ
 
	$Di¥Ïy
()

382 if(
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']>0)

384 
$this
->
	`Di¥ÏyP¬tTem¶‘s
();

387 
$this
->
	`CouÁRecÜd
();

388 if((
	`em±y
(
$this
->
PageNo
) || $this->PageNo==1)

389 && 
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']==1)

391 
$tmpdœ
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir'];

392 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
Ty³ID
,$this->
F›lds
['tempindex']);

393 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

394 
$‹mpfe
 = 
$tmpdœ
."/".$tempfile;

395 if(!
	`fe_exi¡s
(
$‹mpfe
))

397 
$‹mpfe
 = 
$tmpdœ
."/".
$GLOBALS
['cfg_df_style']."/index_default.htm";

399 
$this
->
d
->
	`LßdTem¶©e
(
$‹mpfe
);

401 
$this
->
	`P¬£Tem¶‘sFœ¡
();

402 
$this
->
	`P¬£DMF›lds
($this->
PageNo
,0);

403 
$this
->
d
->
	`Di¥Ïy
();

404 
	}
}

412 
funùiÚ
 
	$MakeP¬tTem¶‘s
()

414 
$this
->
P¬tV›w
 = 
Ãw
 
	`P¬tV›w
($this->
Ty³ID
,
çl£
);

415 
$this
->
P¬tV›w
->
	`S‘Ty³Lšk
($this->
Ty³Lšk
);

416 
$nmç
 = 0;

417 
$tmpdœ
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir'];

418 if(
$this
->
F›lds
['ispart']==1)

420 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
Ty³ID
,$this->
F›lds
['tempindex']);

421 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

422 
$‹mpfe
 = 
$tmpdœ
."/".$tempfile;

423 if(!
	`fe_exi¡s
(
$‹mpfe
))

425 
$‹mpfe
 = 
$tmpdœ
."/".
$GLOBALS
['cfg_df_style']."/index_default.htm";

427 
$this
->
P¬tV›w
->
	`S‘Tem¶‘
(
$‹mpfe
);

429 if(
$this
->
F›lds
['ispart']==2)

432  
$this
->
F›lds
['typedir'];

434 
	`C»©eDœ
(
	`MfTy³dœ
(
$this
->
F›lds
['typedir']));

435 
$makeU¾
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],"šdex",
	`MfTy³dœ
($this->Fields['typedir']),$this->Fields['defaultname'],$this->Fields['namerule2']);

436 
$makeU¾
 = 
	`´eg_»¶aû
("/\/{1,}/", "/", $makeUrl);

437 
$makeFe
 = 
$this
->
	`G‘TrueP©h
().
$makeU¾
;

438 if(
$nmç
==0)

440 
$this
->
P¬tV›w
->
	`SaveToHtml
(
$makeFe
);

442 if(
$GLOBALS
['cfg_»mÙe_s™e']=='Y'&& 
$i¤emÙe
 == 1)

445 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '',
$makeFe
);

446 
$loÿlfe
 = '..'.
$»mÙefe
;

447 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.html/', '',
$»mÙefe
);

449 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

450 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'acii');

455 if(!
	`fe_exi¡s
(
$makeFe
))

457 
$this
->
P¬tV›w
->
	`SaveToHtml
(
$makeFe
);

459 if(
$cfg_»mÙe_s™e
=='Y'&& 
$i¤emÙe
 == 1)

462 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '',
$makeFe
);

463 
$loÿlfe
 = '..'.
$»mÙefe
;

464 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.html/', '',
$»mÙefe
);

466 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

467 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'acii');

471  
$this
->
	`G‘TrueU¾
(
$makeU¾
);

472 
	}
}

481 
funùiÚ
 
	$Di¥ÏyP¬tTem¶‘s
()

483 
$this
->
P¬tV›w
 = 
Ãw
 
	`P¬tV›w
($this->
Ty³ID
,
çl£
);

484 
$this
->
P¬tV›w
->
	`S‘Ty³Lšk
($this->
Ty³Lšk
);

485 
$nmç
 = 0;

486 
$tmpdœ
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir'];

487 if(
$this
->
F›lds
['ispart']==1)

490 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
Ty³ID
,$this->
F›lds
['tempindex']);

491 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

492 
$‹mpfe
 = 
$tmpdœ
."/".$tempfile;

493 if(!
	`fe_exi¡s
(
$‹mpfe
))

495 
$‹mpfe
 = 
$tmpdœ
."/".
$GLOBALS
['cfg_df_style']."/index_default.htm";

497 
$this
->
P¬tV›w
->
	`S‘Tem¶‘
(
$‹mpfe
);

499 if(
$this
->
F›lds
['ispart']==2)

502 
$gÙou¾
 = 
$this
->
F›lds
['typedir'];

503 
	`h—d”
("Location:$gotourl");

504 
	`ex™
();

506 
	`C»©eDœ
(
	`MfTy³dœ
(
$this
->
F›lds
['typedir']));

507 
$makeU¾
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],"šdex",
	`MfTy³dœ
($this->Fields['typedir']),$this->Fields['defaultname'],$this->Fields['namerule2']);

508 
$makeFe
 = 
$this
->
	`G‘TrueP©h
().
$makeU¾
;

509 if(
$nmç
==0)

511 
$this
->
P¬tV›w
->
	`Di¥Ïy
();

515 if(!
	`fe_exi¡s
(
$makeFe
))

517 
$this
->
P¬tV›w
->
	`Di¥Ïy
();

521 
	`šşude
(
$makeFe
);

524 
	}
}

532 
funùiÚ
 
	$G‘TrueP©h
()

534 
$Œu•©h
 = 
$GLOBALS
["cfg_basedir"];

535  
$Œu•©h
;

536 
	}
}

545 
funùiÚ
 
	$G‘TrueU¾
(
$nu¾
)

547 if(
$this
->
F›lds
['moresite']==1)

549 if(
$this
->
F›lds
['sitepath']!='')

551 
$nu¾
 = 
	`´eg_»¶aû
("/^".
$this
->
F›lds
['sitepath']."/", '', $nurl);

553 
$nu¾
 = 
$this
->
F›lds
['siteurl'].$nurl;

555  
$nu¾
;

556 
	}
}

564 
funùiÚ
 
	$P¬£Tem¶‘sFœ¡
()

566 if(
	`is£t
(
$this
->
Ty³Lšk
->
Ty³Infos
['reid']))

568 
$GLOBALS
['’vs']['»id'] = 
$this
->
Ty³Lšk
->
Ty³Infos
['reid'];

570 
$GLOBALS
['’vs']['ty³id'] = 
$this
->
Ty³ID
;

571 
$GLOBALS
['’vs']['tİid'] = 
	`G‘Tİid
(
$this
->
F›lds
['typeid']);

572 
$GLOBALS
['envs']['cross'] = 1;

573 
	`MakeOÃTag
(
$this
->
d
,$this);

574 
	}
}

584 
funùiÚ
 
	$P¬£DMF›lds
(
$PageNo
,
$ismake
=1)

587 if((
$PageNo
>1 || 
	`¡¾’
(
$this
->
F›lds
['cÚ‹Á'])<10 ) && !$this->
IsR•Ïû
)

589 
$this
->
d
->
SourûSŒšg
 = 
	`¡r_»¶aû
('[cmsreplace]','display:none',$this->dtp->SourceString);

590 
$this
->
IsR•Ïû
 = 
Œue
;

592 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$gid
=>
$ùag
)

594 if(
$ùag
->
	`G‘Name
()=="list")

596 
$lim™¡¬t
 = (
$this
->
PageNo
-1è* $this->
PageSize
;

597 
$row
 = 
$this
->
PageSize
;

598 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())=="")

600 
$IÂ”Text
 = 
	`G‘SysTem¶‘s
("list_fulllist.htm");

604 
$IÂ”Text
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

606 
$this
->
d
->
	`Assign
(
$gid
,

607 
$this
->
	`G‘ArcLi¡
(

608 
$lim™¡¬t
,

609 
$row
,

610 
$ùag
->
	`G‘A‰
("col"),

611 
$ùag
->
	`G‘A‰
("titlelen"),

612 
$ùag
->
	`G‘A‰
("infolen"),

613 
$ùag
->
	`G‘A‰
("imgwidth"),

614 
$ùag
->
	`G‘A‰
("imgheight"),

615 
$ùag
->
	`G‘A‰
("listtype"),

616 
$ùag
->
	`G‘A‰
("orderby"),

617 
$IÂ”Text
,

618 
$ùag
->
	`G‘A‰
("tablewidth"),

619 
$ismake
,

620 
$ùag
->
	`G‘A‰
("orderway")

624 if(
$ùag
->
	`G‘Name
()=="pagelist")

626 
$li¡_Ën
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("listsize"));

628 
$s™e_Ïng
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("sitelang"));

629 
$ùag
->
	`G‘A‰
("li¡™em")=="" ? 
$li¡™em
="index,pre,pageno,next,end,option" : $listitem=$ctag->GetAtt("listitem");

630 if(
$li¡_Ën
=="")

632 
$li¡_Ën
 = 3;

634 if(
$ismake
==0)

636 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
, 
$s™e_Ïng
));

640 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡ST
(
$li¡_Ën
,
$li¡™em
, 
$s™e_Ïng
));

643 if(
$PageNo
!=1 && 
$ùag
->
	`G‘Name
()=='f›ld' && $ùag->
	`G‘A‰
('display')!='')

645 
$this
->
d
->
	`Assign
(
$gid
,'');

648 
	}
}

661 
funùiÚ
 
	$G‘MakeFeRuË
(
$ty³id
,
$wÇme
,
$ty³dœ
,
$deçuÉÇme
,
$Çm”uË2
)

663 
$ty³dœ
 = 
	`MfTy³dœ
($typedir);

664 if(
$wÇme
=='index')

666  
$ty³dœ
.'/'.
$deçuÉÇme
;

670 
$Çm”uË2
 = 
	`¡r_»¶aû
('{tid}',
$ty³id
,$namerule2);

671 
$Çm”uË2
 = 
	`¡r_»¶aû
('{ty³dœ}',
$ty³dœ
,$namerule2);

672  
$Çm”uË2
;

674 
	}
}

695 
funùiÚ
 
G‘ArcLi¡
(
$lim™¡¬t
=0,
$row
=10,
$cŞ
=1,
$t™ËËn
=30,
$šfŞ’
=250,

696 
$imgwidth
=120,
$imgheight
=90,
$li¡ty³
="®l",
$Üd”by
="deçuÉ",
$šÃ¹ext
="",
$bËwidth
="100",
$ismake
=1,
$Üd”Way
='desc')

698 
glob®
 
$cfg_li¡_sÚ
,
$cfg_digg_upd©e
;

700 
	g$ty³id
=
$this
->
Ty³ID
;

702 if(
	g$row
==''è
$row
 = 10;

703 if(
	g$lim™¡¬t
==''è
$lim™¡¬t
 = 0;

704 if(
	g$t™ËËn
==''è
$t™ËËn
 = 100;

705 if(
	g$šfŞ’
==''è
$šfŞ’
 = 250;

706 if(
	g$imgwidth
==''è
$imgwidth
 = 120;

707 if(
	g$imgheight
==''è
$imgheight
 = 120;

708 if(
	g$li¡ty³
==''è
$li¡ty³
 = 'all';

709 if(
	g$Üd”Way
==''è
$Üd”Way
 = 'desc';

711 if(
	g$Üd”by
=='') {

712 
$Üd”by
='default';

715 
	g$Üd”by
=
¡¹Şow”
(
$Üd”by
);

718 
	g$bËwidth
 = 
¡r_»¶aû
('%','',
$bËwidth
);

719 if(
	g$bËwidth
==''è
$bËwidth
=100;

720 if(
	g$cŞ
==''è
$cŞ
=1;

721 
	g$cŞWidth
 = 
û
(100/
$cŞ
);

722 
	g$bËwidth
 = 
$bËwidth
.'%';

723 
	g$cŞWidth
 = 
$cŞWidth
.'%';

725 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

726 if(
	g$šÃ¹ext
=='') {

727 
$šÃ¹ext
 = 
G‘SysTem¶‘s
('list_fulllist.htm');

731 
	g$Üd”sql
 = '';

732 if(
	g$Üd”by
=="£ndd©e" || 
$Üd”by
=="id") {

733 
$Üd”sql
=" ORDER BY‡rc.id $orderWay";

735 if(
	g$Üd”by
=="hÙ" || 
$Üd”by
=="click") {

736 
$Üd”sql
 = " ORDER BY‡rc.click $orderWay";

738 if(
	g$Üd”by
=="lastpost") {

739 
$Üd”sql
 = " ORDER BY‡rc.lastpost $orderWay";

741 if(
	g$Üd”by
=="weight") {

742 
$Üd”sql
 = " order by‡rc.weight $orderWay ,arc.id $orderWay";

745 
	g$Üd”sql
=" ORDER BY‡rc.sortrank $orderWay";

749 
	g$addbË
 = 
$this
->
ChªÃlUn™
->
ChªÃlInfos
['addtable'];

750 if(
	g$addbË
!="")

752 
$addJoš
 = " LEFT JOIN `$addbË` ON‡rc.id = ".
$addbË
.'.aid ';

753 
	g$addF›ld
 = '';

754 
	g$f›lds
 = 
ex¶ode
(',',
$this
->
ChªÃlUn™
->
ChªÃlInfos
['listfields']);

755 
fÜ—ch
(
$f›lds
 
as
 
$k
=>
$v
)

757 
$nf›lds
[
$v
] = 
$k
;

759 if(
is_¬¿y
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
è&& !
em±y
($this->ChannelUnit->ChannelFields))

761 
fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$¬r
)

763 if(
is£t
(
$nf›lds
[
$k
]))

765 if(!
em±y
(
$¬r
['rename'])) {

766 
$addF›ld
 .ğ','.
$addbË
.'.'.
$k
.'‡ '.
$¬r
['rename'];

769 
	g$addF›ld
 .ğ','.
$addbË
.'.'.
$k
;

777 
	g$addF›ld
 = '';

778 
	g$addJoš
 = '';

782 if(
´eg_m©ch
('/hÙ|şick|Ï¡po¡|weight/', 
$Üd”by
))

784 
	g$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,

785 

.
Çm”uË
,
	g
.
	gÇm”uË2
,.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h


786 
$addF›ld


787 
	gFROM
 `#@
	g__¬chives
` 
¬c


788 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g¬c
.
	gty³id
ñp.
id


789 
$addJoš


790 
WHERE
 {
$this
->
addSql
} 
$Üd”sql
 
LIMIT
 
$lim™¡¬t
,
	g$row
";

795 
	g$t1
 = 
ExecTime
();

796 
	g$ids
 = 
¬¿y
();

797 
	g$qu”y
 = "SELECT id FROM `#@__arctiny`‡rc WHERE {$this->addSql} $ordersql LIMIT $limitstart,$row ";

798 
	g$this
->
	gdsql
->
S‘Qu”y
(
$qu”y
);

799 
	g$this
->
	gdsql
->
Execu‹
();

800 
	g$¬r
=
$this
->
dsql
->
G‘A¼ay
())

802 
$ids
[] = 
$¬r
['id'];

804 
	g$id¡r
 = 
još
(',',
$ids
);

805 if(
	g$id¡r
=='')

811 
	g$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,

812 

.
Çm”uË
,
	g
.
	gÇm”uË2
,.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h


813 
$addF›ld


814 
	gFROM
 `#@
	g__¬chives
` 
¬c
 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g¬c
.
	gty³id
ñp.
id


815 
$addJoš


816 
WHERE
 
¬c
.
id
 
š
(
$id¡r
è
$Üd”sql
 ";

818 
	g$t2
 = 
ExecTime
();

822 
	g$this
->
	gdsql
->
S‘Qu”y
(
$qu”y
);

823 
	g$this
->
	gdsql
->
Execu‹
('al');

824 
	g$t2
 = 
ExecTime
();

827 
	g$¬i¡
 = '';

828 
	g$this
->
	gd2
->
LßdSourû
(
$šÃ¹ext
);

829 
	g$GLOBALS
['autoindex'] = 0;

830 
	g$i
=0;$i<
	g$row
;$i++)

832 if(
	g$cŞ
>1)

834 
	g$¬i¡
 .= "<div>\r\n";

836 
	g$j
=0;$j<
	g$cŞ
;$j++)

838 if(
	g$row
 = 
$this
->
dsql
->
G‘A¼ay
("al"))

840 
$GLOBALS
['autoindex']++;

841 
	g$ids
[
$row
['id']] = $row['id'];

844 
	g$row
['šfos'] = 
ú_sub¡r
(
$row
['desütiÚ'],
$šfŞ’
);

845 
	g$row
['id'] = 
$row
['id'];

846 if(
	g$cfg_digg_upd©e
 > 0)

848 
	g$´efix
 = 'diggCache';

849 
	g$key
 = 'aid-'.
$row
['id'];

850 
	g$ÿch”ow
 = 
G‘Cache
(
$´efix
, 
$key
);

851 
	g$row
['goodpo¡'] = 
$ÿch”ow
['goodpost'];

852 
	g$row
['badpo¡'] = 
$ÿch”ow
['badpost'];

853 
	g$row
['scÜes'] = 
$ÿch”ow
['scores'];

856 if(
	g$row
['corank'] > 0 && $row['arcrank']==0)

858 
$row
['arcrank'] = $row['corank'];

861 
	g$row
['f’ame'] = 
$row
['¬cu¾'] = 
G‘FeU¾
($row['id'],$row['typeid'],$row['senddate'],$row['title'],$row['ismake'],

862 
$row
['arcrank'],$row['namerule'],$row['typedir'],$row['money'],$row['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

863 
	g$row
['ty³u¾'] = 
G‘Ty³U¾
(
$row
['ty³id'],
MfTy³dœ
($row['typedir']),$row['isdefault'],$row['defaultname'],

864 
$row
['ispart'],$row['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

865 if(
	g$row
['l™pic'] =ğ'-' || 
$row
['litpic'] == '')

867 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

869 if(!
´eg_m©ch
("/^h‰p:\/\//i", 
$row
['l™pic']è&& 
	g$GLOBALS
['cfg_multi_site'] == 'Y')

871 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

873 
	g$row
['piúame'] = 
$row
['litpic'];

874 
	g$row
['¡ime'] = 
G‘D©eMK
(
$row
['pubdate']);

875 
	g$row
['ty³lšk'] = "<¨h»f='".
$row
['typeurl']."'>".$row['typename']."</a>";

876 
	g$row
['image'] = "<img src='".
$row
['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
´eg_»¶aû
("/['><]/", "", $row['title'])."'>";

877 
	g$row
['imglšk'] = "<¨h»f='".
$row
['filename']."'>".$row['image']."</a>";

878 
	g$row
['fuÎt™Ë'] = 
$row
['title'];

879 
	g$row
['t™Ë'] = 
ú_sub¡r
(
$row
['t™Ë'],
$t™ËËn
);

880 if(
	g$row
['color']!='')

882 
$row
['title'] = "<font color='".$row['color']."'>".$row['title']."</font>";

891 
	g$row
['‹xšk'] = "<¨h»f='".
$row
['filename']."'>".$row['title']."</a>";

892 
	g$row
['¶usu¾'] = 
$row
['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

893 
	g$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

894 
	g$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

897 
fÜ—ch
(
$row
 
as
 
$k
=>
$v
)

899 
$row
[
¡¹Şow”
(
$k
)] = 
$v
;

901 
fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$¬r
)

903 if(
is£t
(
$row
[
$k
]))

905 
$row
[
$k
] = 
$this
->
ChªÃlUn™
->
MakeF›ld
($k,$row[$k]);

908 if(
is_¬¿y
(
$this
->
d2
->
CTags
))

910 
fÜ—ch
(
$this
->
d2
->
CTags
 
as
 
$k
=>
$ùag
)

912 if(
$ùag
->
G‘Name
()=='array')

915 
$this
->
d2
->
Assign
(
$k
,
$row
);

919 if(
is£t
(
$row
[
$ùag
->
G‘Name
()]))

921 
	g$this
->
	gd2
->
Assign
(
$k
,
$row
[
$ùag
->
G‘Name
()]);

925 
	g$this
->
	gd2
->
Assign
(
$k
,'');

930 
	g$¬i¡
 .ğ
$this
->
d2
->
G‘ResuÉ
();

935 if(
	g$cŞ
>1)

937 
	g$i
 +ğ
$cŞ
 - 1;

938 
	g$¬i¡
 .= " </div>\r\n";

942 
	g$t3
 = 
ExecTime
();

945 
	g$this
->
	gdsql
->
F»eResuÉ
('al');

946  
	g$¬i¡
;

957 
funùiÚ
 
G‘PageLi¡ST
(
$li¡_Ën
,
$li¡™em
="šdex,’d,´e,Ãxt,·g’o",
$s™e_Ïng
)

959 
	g$´•age
 = 
$Ãxage
 = '';

960 
	g$´•ag’um
 = 
$this
->
PageNo
-1;

961 
	g$Ãxag’um
 = 
$this
->
PageNo
+1;

962 if(
	g$li¡_Ën
=='' || 
´eg_m©ch
("/[^0-9]/", 
$li¡_Ën
))

964 
	g$li¡_Ën
=3;

966 
	g$tÙ®·ge
 = 
û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

967 if(
	g$s™e_Ïng
 =ğ'ú' || 
$s™e_Ïng
 =='')

969 if(
$tÙ®·ge
<=1 && 
$this
->
TÙ®ResuÉ
>0)

972  "<li><¥ª cÏss=\"·gešfo\">å…± <¡rÚg>1</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡è®°å½•</span></li>\r\n";

974 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

976  "<li><¥ª cÏss=\"·gešfo\">å…± <¡rÚg>0</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡è®°å½•</span></li>\r\n";

978 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

979 
	g$maššfo
 = "<li><¥ª cÏss=\"·gešfo\">å…± <¡rÚg>{$tÙ®·ge}</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡</span></li>\r\n";

980 
	g$Šam”uË
 = 
$this
->
G‘MakeFeRuË
($this->
F›lds
['id'],"list",$this->Fields['typedir'],$this->Fields['defaultname'],$this->Fields['namerule2']);

981 
	g$Šam”uË
 = 
´eg_»¶aû
("/^(.*)\//", '', 
$Šam”uË
);

984 if(
	g$this
->
	gPageNo
 != 1)

986 
$´•age
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}",
$´•ag’um
,
$Šam”uË
)."'>ä¸Šä¸€é¡µ</a></li>\r\n";

987 
	g$šdex·ge
="<li><¨h»f='".
¡r_»¶aû
("{·ge}",1,
$Šam”uË
)."'>é¦–é¡µ</a></li>\r\n";

991 
	g$šdex·ge
="<li><a href='javascript:void(0)'>é¦–é¡µ</a></li>\r\n";

995 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

997 
$Ãxage
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}",
$Ãxag’um
,
$Šam”uË
)."'>ä¸‹ä¸€é¡µ</a></li>\r\n";

998 
	g$’d·ge
="<li><¨h»f='".
¡r_»¶aû
("{·ge}",
$tÙ®·ge
,
$Šam”uË
)."'>æœ«é¡µ</a></li>\r\n";

1002 
	g$’d·ge
="<li><a href='javascript:void(0)'>æœ«é¡µ</a></li>\r\n";

1005 
–£if
 (
$s™e_Ïng
 == 'en')

1007 if(
$tÙ®·ge
<=1 && 
$this
->
TÙ®ResuÉ
>0)

1010  "<li><¥ª cÏss=\"·gešfo\">TÙ® <¡rÚg>1</¡rÚg> Page <¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong> Records</span></li>\r\n";

1012 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

1014  "<li><¥ª cÏss=\"·gešfo\">TÙ® <¡rÚg>0</¡rÚg> Pages<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong> Records</span></li>\r\n";

1016 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

1017 
	g$maššfo
 = "<li><¥ª cÏss=\"·gešfo\">TÙ® <¡rÚg>{$tÙ®·ge}</¡rÚg> Pages<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong> Records</span></li>\r\n";

1018 
	g$Šam”uË
 = 
$this
->
G‘MakeFeRuË
($this->
F›lds
['id'],"list",$this->Fields['typedir'],$this->Fields['defaultname'],$this->Fields['namerule2']);

1019 
	g$Šam”uË
 = 
´eg_»¶aû
("/^(.*)\//", '', 
$Šam”uË
);

1022 if(
	g$this
->
	gPageNo
 != 1)

1024 
$´•age
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}",
$´•ag’um
,
$Šam”uË
)."'>Previous</a></li>\r\n";

1025 
	g$šdex·ge
="<li><¨h»f='".
¡r_»¶aû
("{·ge}",1,
$Šam”uË
)."'>Home</a></li>\r\n";

1029 
	g$šdex·ge
="<li><a href='javascript:void(0)'>Home</a></li>\r\n";

1033 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

1035 
$Ãxage
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}",
$Ãxag’um
,
$Šam”uË
)."'>Next</a></li>\r\n";

1036 
	g$’d·ge
="<li><¨h»f='".
¡r_»¶aû
("{·ge}",
$tÙ®·ge
,
$Šam”uË
)."'>End</a></li>\r\n";

1040 
	g$’d·ge
="<li><a href='javascript:void(0)'>End</a></li>\r\n";

1045 
	g$İtiÚli¡
 = '';

1047 
	g$İtiÚËn
 = 
¡¾’
(
$tÙ®·ge
);

1048 
	g$İtiÚËn
 = 
$İtiÚËn
*12 + 18;

1049 if(
	g$İtiÚËn
 < 36) $optionlen = 36;

1050 if(
	g$İtiÚËn
 > 100) $optionlen = 100;

1051 
	g$İtiÚli¡
 = "<li><select‚ame='sldd' style='width:{$optionlen}px' onchange='location.href=this.options[this.selectedIndex].value;'>\r\n";

1052 
	g$mjj
=1;$mjj<=
$tÙ®·ge
;$mjj++)

1054 if(
	g$mjj
==
$this
->
PageNo
)

1056 
$İtiÚli¡
 .ğ"<İtiÚ v®ue='".
¡r_»¶aû
("{·ge}",
$mjj
,
$Šam”uË
)."' selected>$mjj</option>\r\n";

1060 
	g$İtiÚli¡
 .ğ"<İtiÚ v®ue='".
¡r_»¶aû
("{·ge}",
$mjj
,
$Šam”uË
)."'>$mjj</option>\r\n";

1063 
	g$İtiÚli¡
 .= "</select></li>\r\n";

1066 
	g$li¡dd
="";

1067 
	g$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

1068 if(
	g$this
->
	gPageNo
 >ğ
$tÙ®_li¡
)

1070 
$j
 = 
$this
->
PageNo
-
$li¡_Ën
;

1071 
	g$tÙ®_li¡
 = 
$this
->
PageNo
+
$li¡_Ën
;

1072 if(
	g$tÙ®_li¡
>
	g$tÙ®·ge
)

1074 
	g$tÙ®_li¡
=
$tÙ®·ge
;

1079 
	g$j
=1;

1080 if(
	g$tÙ®_li¡
>
	g$tÙ®·ge
)

1082 
	g$tÙ®_li¡
=
$tÙ®·ge
;

1085 
	g$j
;$j<=
$tÙ®_li¡
;$j++)

1087 if(
	g$j
==
$this
->
PageNo
)

1089 
$li¡dd
.= "<li class=\"thisclass\"><a href='javascript:void(0)'>$j</a></li>\r\n";

1093 
	g$li¡dd
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}",
$j
,
$Šam”uË
)."'>".
	g$j
."</a></li>\r\n";

1096 
	g$¶i¡
 = '';

1097 if(
´eg_m©ch
('/šdex/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$šdex·ge
;

1098 if(
´eg_m©ch
('/´e/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$´•age
;

1099 if(
´eg_m©ch
('/·g’o/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$li¡dd
;

1100 if(
´eg_m©ch
('/Ãxt/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$Ãxage
;

1101 if(
´eg_m©ch
('/’d/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$’d·ge
;

1102 if(
´eg_m©ch
('/İtiÚ/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$İtiÚli¡
;

1103 if(
´eg_m©ch
('/šfo/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$maššfo
;

1105  
	g$¶i¡
;

1116 
funùiÚ
 
G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
="šdex,’d,´e,Ãxt,·g’o",
$s™e_Ïng
)

1118 
glob®
 
	g$cfg_»wr™e
;

1119 
	g$´•age
 = 
$Ãxage
 = '';

1120 
	g$´•ag’um
 = 
$this
->
PageNo
-1;

1121 
	g$Ãxag’um
 = 
$this
->
PageNo
+1;

1122 if(
	g$li¡_Ën
=='' || 
´eg_m©ch
("/[^0-9]/", 
$li¡_Ën
))

1124 
	g$li¡_Ën
=3;

1126 
	g$tÙ®·ge
 = 
û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

1127 if(
	g$s™e_Ïng
 =ğ'ú' || 
$s™e_Ïng
 =='')

1129 if(
$tÙ®·ge
<=1 && 
$this
->
TÙ®ResuÉ
>0)

1131  "<li><¥ª cÏss=\"·gešfo\">å…± 1 é¡µ/".
$this
->
TÙ®ResuÉ
." æ¡è®°å½•</span></li>\r\n";

1133 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

1135  "<li><¥ª cÏss=\"·gešfo\">å…± 0 é¡µ/".
$this
->
TÙ®ResuÉ
." æ¡è®°å½•</span></li>\r\n";

1137 
	g$maššfo
 = "<li><¥ª cÏss=\"·gešfo\">å…± <¡rÚg>{$tÙ®·ge}</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡</span></li>\r\n";

1139 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

1141 if(
	g$cfg_»wr™e
 == 'Y')

1143 
$nowu¾s
 = 
´eg_»¶aû
("/\-/", ".php?", 
$pu¾
);

1144 
	g$nowu¾s
 = 
ex¶ode
("?", 
$nowu¾s
);

1145 
	g$pu¾
 = 
$nowu¾s
[0];

1148 
–£if
(
$s™e_Ïng
 == 'en')

1150 if(
$tÙ®·ge
<=1 && 
$this
->
TÙ®ResuÉ
>0)

1152  "<li><¥ª cÏss=\"·gešfo\">TOTALS 1 Page/".
$this
->
TÙ®ResuÉ
." Records</span></li>\r\n";

1154 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

1156  "<li><¥ª cÏss=\"·gešfo\">TOTALS 0 Page/".
$this
->
TÙ®ResuÉ
." Records</span></li>\r\n";

1158 
	g$maššfo
 = "<li><¥ª cÏss=\"·gešfo\">TOTALS <¡rÚg>{$tÙ®·ge}</¡rÚg>Pages<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>Records</span></li>\r\n";

1160 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

1162 if(
	g$cfg_»wr™e
 == 'Y')

1164 
$nowu¾s
 = 
´eg_»¶aû
("/\-/", ".php?", 
$pu¾
);

1165 
	g$nowu¾s
 = 
ex¶ode
("?", 
$nowu¾s
);

1166 
	g$pu¾
 = 
$nowu¾s
[0];

1170 
	g$g‘u¾
 = "tid=".
$this
->
Ty³ID
."&TÙ®ResuÉ=".$this->
TÙ®ResuÉ
."&";

1171 
	g$pu¾
 .ğ'?'.
$g‘u¾
;

1173 
	g$İtiÚli¡
 = '';

1178 if(
	g$s™e_Ïng
 =ğ'ú' || 
$s™e_Ïng
 =='')

1180 if(
$this
->
PageNo
 != 1)

1182 
$´•age
.="<li><¨h»f='".
$pu¾
."PageNo=$prepagenum'>ä¸Šä¸€é¡µ</a></li>\r\n";

1183 
	g$šdex·ge
="<li><¨h»f='".
$pu¾
."PageNo=1'>é¦–é¡µ</a></li>\r\n";

1187 
	g$šdex·ge
="<li><a>é¦–é¡µ</a></li>\r\n";

1189 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

1191 
$Ãxage
.="<li><¨h»f='".
$pu¾
."PageNo=$nextpagenum'>ä¸‹ä¸€é¡µ</a></li>\r\n";

1192 
	g$’d·ge
="<li><¨h»f='".
$pu¾
."PageNo=$totalpage'>æœ«é¡µ</a></li>\r\n";

1196 
	g$’d·ge
="<li><a>æœ«é¡µ</a></li>\r\n";

1199 
–£if
(
$s™e_Ïng
 == 'en')

1201 if(
$this
->
PageNo
 != 1)

1203 
$´•age
.="<li><¨h»f='".
$pu¾
."PageNo=$prepagenum'>Previous</a></li>\r\n";

1204 
	g$šdex·ge
="<li><¨h»f='".
$pu¾
."PageNo=1'>Home</a></li>\r\n";

1208 
	g$šdex·ge
="<li><a>Home</a></li>\r\n";

1210 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

1212 
$Ãxage
.="<li><¨h»f='".
$pu¾
."PageNo=$nextpagenum'>Next</a></li>\r\n";

1213 
	g$’d·ge
="<li><¨h»f='".
$pu¾
."PageNo=$totalpage'>End</a></li>\r\n";

1217 
	g$’d·ge
="<li><a>End</a></li>\r\n";

1223 
	g$li¡dd
="";

1224 
	g$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

1225 if(
	g$this
->
	gPageNo
 >ğ
$tÙ®_li¡
)

1227 
$j
 = 
$this
->
PageNo
-
$li¡_Ën
;

1228 
	g$tÙ®_li¡
 = 
$this
->
PageNo
+
$li¡_Ën
;

1229 if(
	g$tÙ®_li¡
>
	g$tÙ®·ge
)

1231 
	g$tÙ®_li¡
=
$tÙ®·ge
;

1236 
	g$j
=1;

1237 if(
	g$tÙ®_li¡
>
	g$tÙ®·ge
)

1239 
	g$tÙ®_li¡
=
$tÙ®·ge
;

1242 
	g$j
;$j<=
$tÙ®_li¡
;$j++)

1244 if(
	g$j
==
$this
->
PageNo
)

1246 
$li¡dd
.= "<li class=\"thisclass\"><a>$j</a></li>\r\n";

1250 
	g$li¡dd
.="<li><¨h»f='".
$pu¾
."PageNo=$j'>".
$j
."</a></li>\r\n";

1254 
	g$¶i¡
 = '';

1255 if(
´eg_m©ch
('/šdex/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$šdex·ge
;

1256 if(
´eg_m©ch
('/´e/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$´•age
;

1257 if(
´eg_m©ch
('/·g’o/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$li¡dd
;

1258 if(
´eg_m©ch
('/Ãxt/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$Ãxage
;

1259 if(
´eg_m©ch
('/’d/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$’d·ge
;

1260 if(
´eg_m©ch
('/İtiÚ/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$İtiÚli¡
;

1261 if(
´eg_m©ch
('/šfo/i', 
$li¡™em
)è
	g$¶i¡
 .ğ
$maššfo
;

1263 if(
	g$cfg_»wr™e
 == 'Y')

1265 
$¶i¡
 = 
¡r_»¶aû
('.php?tid=', '-', $plist);

1266 
	g$¶i¡
 = 
¡r_»¶aû
('&TÙ®ResuÉ=', '-', 
$¶i¡
);

1267 
	g$¶i¡
 = 
´eg_»¶aû
("/&PageNo=(\d+)/i",'-\\1.html',
$¶i¡
);

1269  
	g$¶i¡
;

1278 
funùiÚ
 
	$G‘CurU¾
()

1280 if(!
	`em±y
(
$_SERVER
['REQUEST_URI']))

1282 
$nowu¾
 = 
$_SERVER
['REQUEST_URI'];

1283 
$nowu¾s
 = 
	`ex¶ode
('?', 
$nowu¾
);

1284 
$nowu¾
 = 
$nowu¾s
[0];

1288 
$nowu¾
 = 
$_SERVER
['PHP_SELF'];

1290  
$nowu¾
;

1291 
	}
}

	@E:\web\weixun\functions\arc.memberlistview.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
(
XAKINC
."/xaktemplate.class.php");

9 
	g$Ïng_´e_·ge
 = 'ä¸Šé¡µ';

10 
	g$Ïng_Ãxt_·ge
 = 'ä¸‹é¡µ';

11 
	g$Ïng_šdex_·ge
 = 'é¦–é¡µ';

12 
	g$Ïng_’d_·ge
 = 'æœ«é¡µ';

13 
	g$Ïng_»cÜd_numb”
 = 'æ¡è®°å½•';

14 
	g$Ïng_·ge
 = 'é¡µ';

15 
	g$Ïng_tÙ®
 = 'å…±';

22 şas 
	cMemb”Li¡v›w


24 
v¬
 
	m$dsql
 = '';

25 
v¬
 
	m$l
 = '';

26 
v¬
 
	m$·geNO
 = 1;

27 
v¬
 
	m$tÙ®Page
 = 0;

28 
v¬
 
	m$tÙ®ResuÉ
 = 0;

29 
v¬
 
	m$·geSize
 = 25;

30 
v¬
 
	m$g‘V®ues
 = 
¬¿y
();

31 
v¬
 
	m$sourûSql
 = '';

32 
v¬
 
	m$isQu”y
 = 
çl£
;

33 
v¬
 
	m$¿ndts
 = 0;

42 
funùiÚ
 
__cÚ¡ruù
(
$lfe
='')

44 
$this
->
sourûSql
 = '';

45 
	m$this
->
	m·geSize
 = 25;

46 
	m$this
->
	mqu”yTime
 = 0;

47 
	m$this
->
	mg‘V®ues
 = 
A¼ay
();

48 
	m$this
->
	m¿ndts
 = 
time
();

49 
	m$this
->
	mdsql
 = 
$GLOBALS
['dsql'];

50 
	m$this
->
S‘V¬
('ParseEnv','datalist');

51 
	m$this
->
	ml
 = 
Ãw
 
XakTem¶©e
();

52 if(
	m$GLOBALS
['cfg_tplcache']=='N')

54 
$this
->
l
->
isCache
 = 
çl£
;

56 if(
	m$lfe
!='')

58 
$this
->
l
->
LßdTem¶©e
(
$lfe
);

63 
funùiÚ
 
Memb”Li¡v›w
(
$lfe
='')

65 
$this
->
__cÚ¡ruù
(
$lfe
);

75 
funùiÚ
 
	$S‘Sourû
(
$sql
)

77 
$this
->
sourûSql
 = 
$sql
;

78 
	}
}

88 
funùiÚ
 
	$S‘Tem¶©e
(
$lfe
)

90 
$this
->
l
->
	`LßdTem¶©e
(
$lfe
);

91 
	}
}

100 
funùiÚ
 
	$S‘Tem¶‘
(
$lfe
)

102 
$this
->
l
->
	`LßdTem¶©e
(
$lfe
);

103 
	}
}

111 
funùiÚ
 
	$P»Lßd
()

113 
glob®
 
$tÙ®»suÉ
,
$·g’o
;

114 if(
	`em±y
(
$·g’o
è|| 
	`´eg_m©ch
("/[^0-9]/", $pageno))

116 
$·g’o
 = 1;

118 if(
	`em±y
(
$tÙ®»suÉ
è|| 
	`´eg_m©ch
("/[^0-9]/", $totalresult))

120 
$tÙ®»suÉ
 = 0;

122 
$this
->
·geNO
 = 
$·g’o
;

123 
$this
->
tÙ®ResuÉ
 = 
$tÙ®»suÉ
;

125 if(
	`is£t
(
$this
->
l
->
Cfgs
['pagesize']))

127 
$this
->
·geSize
 = $this->
l
->
Cfgs
['pagesize'];

129 
$this
->
tÙ®Page
 = 
	`û
($this->
tÙ®ResuÉ
/$this->
·geSize
);

130 if(
$this
->
tÙ®ResuÉ
==0)

135 
$couÁQu”y
 = 
	`´eg_»¶aû
("/£Ëù[ \r\n\t](.*)[ \r\n\t]äom/i","S–eù couÁ(*èa dd From",
$this
->
sourûSql
);

136 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
(
$couÁQu”y
);

137 
$row
['dd'] = 
	`em±y
($row['dd']) ? 0 : $row['dd'];

138 
$this
->
tÙ®ResuÉ
 = 
$row
['dd'];

139 
$this
->
sourûSql
 .ğ"†im™ 0,".$this->
·geSize
;

143 
$this
->
sourûSql
 .ğ"†im™ ".(($this->
·geNO
-1è* $this->
·geSize
).",".$this->pageSize;

145 
	}
}

155 
funùiÚ
 
	$S‘P¬am‘”
(
$key
, 
$v®ue
)

157 
$this
->
g‘V®ues
[
$key
] = 
$v®ue
;

158 
	}
}

168 
funùiÚ
 
	$S‘V¬
(
$k
, 
$v
)

170 
glob®
 
$_v¬s
;

171 if(!
	`is£t
(
$_v¬s
[
$k
])è$_v¬s[$k] = 
$v
;

172 
	}
}

180 
funùiÚ
 
	$G‘V¬
(
$k
)

182 
glob®
 
$_v¬s
;

183 if(
	`is£t
(
$_v¬s
[
$k
]))  $_vars[$k];

185 
	}
}

196 
funùiÚ
 
G‘ArcLi¡
(
$©ts
,
$»fObj
='',
$f›lds
=
	$¬¿y
())

198 
$©i¡
 = "titlelen=30,infolen=200,imgwidth=120,imgheight=90";

199 
	`FlA‰s
(
$©ts
,
$©i¡
);

200 
	`FlF›lds
(
$©ts
,
$f›lds
,
$»fObj
);

201 
	`exŒaù
(
$©ts
, 
EXTR_OVERWRITE
);

202 
$rsA¼ay
 = 
	`¬¿y
();

206 if(!
$this
->
isQu”y
)

208 
$this
->
dsql
->
	`Execu‹
('mbdl',$this->
sourûSql
);

210 
$i
 = 0;

211 
$row
 = 
$this
->
dsql
->
	`G‘A¼ay
('mbdl'))

213 
$i
++;

215 if(!
	`is£t
(
$row
['description'])) $row['description'] = '';

216 if(!
	`is£t
(
$row
['color'])) $row['color'] = '';

217 if(!
	`is£t
(
$row
['pubdate'])) $row['pubdate'] = $row['senddate'];

219 
$row
['šfos'] = 
	`ú_sub¡r
($row['desütiÚ'],
$šfŞ’
);

220 
$row
['id'] = $row['id'];

221 
$row
['f’ame'] = $row['¬cu¾'] = 
	`G‘FeU¾
($row['id'],$row['typeid'],$row['senddate'],$row['title'],$row['ismake'],

222 
$row
['arcrank'],$row['namerule'],$row['typedir'],$row['money'],$row['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

223 
$row
['ty³u¾'] = 
	`G‘Ty³U¾
($row['typeid'],$row['typedir'],$row['isdefault'],$row['defaultname'],$row['ispart'],

224 
$row
['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

225 if(
$row
['litpic'] == '-' || $row['litpic'] == '')

227 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

229 if(!
	`´eg_m©ch
("/^h‰p:\/\//i", 
$row
['l™pic']è&& 
$GLOBALS
['cfg_multi_site'] == 'Y')

231 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

233 
$row
['picname'] = $row['litpic'];

234 
$row
['¡ime'] = 
	`G‘D©eMK
($row['pubdate']);

235 
$row
['typelink'] = "<a href='".$row['typeurl']."'>".$row['typename']."</a>";

236 
$row
['image'] = "<img src='".$row['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
	`´eg_»¶aû
("/['><]/", "", $row['title'])."'>";

237 
$row
['imglink'] = "<a href='".$row['filename']."'>".$row['image']."</a>";

238 
$row
['fulltitle'] = $row['title'];

239 
$row
['t™Ë'] = 
	`ú_sub¡r
($row['t™Ë'],
$t™ËËn
);

240 if(
$row
['color']!='')

242 
$row
['title'] = "<font color='".$row['color']."'>".$row['title']."</font>";

244 if(
	`´eg_m©ch
('/b/', 
$row
['flag']))

246 
$row
['title'] = "<strong>".$row['title']."</strong>";

250 
$row
['textlink'] = "<a href='".$row['filename']."'>".$row['title']."</a>";

251 
$row
['¶usu¾'] = $row['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

252 
$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

253 
$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

254 
$rsA¼ay
[
$i
] = 
$row
;

255 if(
$i
 >ğ
$this
->
·geSize
)

260 
$this
->
dsql
->
	`F»eResuÉ
();

263  
$rsA¼ay
;

264 
	}
}

275 
funùiÚ
 
G‘PageLi¡
(
$©ts
,
$»fObj
='',
$f›lds
=
	$¬¿y
())

277 
glob®
 
$Ïng_´e_·ge
,
$Ïng_Ãxt_·ge
,
$Ïng_šdex_·ge
,
$Ïng_’d_·ge
,
$Ïng_»cÜd_numb”
,
$Ïng_·ge
,
$Ïng_tÙ®
;

278 
$´•age
 = 
$Ãxage
 = 
$g‘u¾
ğ
$hid’fÜm
 = '';

279 
$pu¾
 = 
$this
->
	`G‘CurU¾
();

280 
$´•ag’um
 = 
$this
->
·geNO
-1;

281 
$Ãxag’um
 = 
$this
->
·geNO
+1;

282 if(!
	`is£t
(
$©ts
['li¡size']è|| 
	`´eg_m©ch
("/[^0-9]/", $atts['listsize']))

284 
$©ts
['listsize'] = 5;

286 if(!
	`is£t
(
$©ts
['listitem']))

288 
$©ts
['listitem'] = "info,index,end,pre,next,pageno";

290 
$tÙ®·ge
 = 
	`û
(
$this
->
tÙ®ResuÉ
/$this->
·geSize
);

295 if(
$tÙ®·ge
<=1 && 
$this
->
tÙ®ResuÉ
 > 0)

297  "{$Ïng_tÙ®} 1 {$Ïng_·ge}/".
$this
->
tÙ®ResuÉ
.
$Ïng_»cÜd_numb”
;

299 if(
$this
->
tÙ®ResuÉ
 == 0)

301  "{$Ïng_tÙ®} 0 {$Ïng_·ge}/".
$this
->
tÙ®ResuÉ
.
$Ïng_»cÜd_numb”
;

303 
$šfos
 = "<span>{$lang_total} {$totalpage} {$lang_page}/{$this->totalResult}{$lang_record_number}</span> ";

304 if(
$this
->
tÙ®ResuÉ
!=0)

306 
$this
->
g‘V®ues
['tÙ®»suÉ'] = $this->
tÙ®ResuÉ
;

308 if(
	`couÁ
(
$this
->
g‘V®ues
)>0)

310 
	`fÜ—ch
(
$this
->
g‘V®ues
 
as
 
$key
=>
$v®ue
)

312 
$v®ue
 = 
	`u¾’code
($value);

313 
$g‘u¾
.="$key=$value"."&";

314 
$hid’fÜm
.="<inputype='hidden'‚ame='$key' value='$value'>\r\n";

317 
$pu¾
 .ğ"?".
$g‘u¾
;

320 if(
$this
->
·geNO
!=1)

322 
$´•age
.="<¨h»f='".
$pu¾
."pageno=$prepagenum'>$lang_pre_page</a> \r\n";

323 
$šdex·ge
="<¨h»f='".
$pu¾
."pageno=1'>$lang_index_page</a> \r\n";

327 
$šdex·ge
="$lang_index_page \r\n";

329 if(
$this
->
·geNO
!=
$tÙ®·ge
&&$totalpage>1)

331 
$Ãxage
.="<¨h»f='".
$pu¾
."pageno=$nextpagenum'>$lang_next_page</a> \r\n";

332 
$’d·ge
="<¨h»f='".
$pu¾
."pageno=$totalpage'>$lang_end_page</a> \r\n";

336 
$’d·ge
=" $lang_end_page \r\n";

340 
$li¡dd
="";

341 
$tÙ®_li¡
 = 
$©ts
['listsize'] * 2 + 1;

342 if(
$this
->
·geNO
>=
$tÙ®_li¡
)

344 
$j
=
$this
->
·geNO
-
$©ts
['listsize'];

345 
$tÙ®_li¡
=
$this
->
·geNO
+
$©ts
['listsize'];

346 if(
$tÙ®_li¡
>
$tÙ®·ge
)

348 
$tÙ®_li¡
=
$tÙ®·ge
;

353 
$j
=1;

354 if(
$tÙ®_li¡
>
$tÙ®·ge
) $total_list=$totalpage;

356 
$j
;$j<=
$tÙ®_li¡
;$j++)

358 if(
$j
==
$this
->
·geNO
)

360 
$li¡dd
.= "<strong>$j</strong> \r\n";

364 
$li¡dd
.="<¨h»f='".
$pu¾
."·g’o=$j'>".
$j
."</a> \r\n";

367 
$¶i¡
 = "<div class=\"pagelistbox\">\r\n";

370 if(
	`´eg_m©ch
("/šfo/i",
$©ts
['listitem']))

372 
$¶i¡
 .ğ
$šfos
;

374 if(
	`´eg_m©ch
("/šdex/i",
$©ts
['listitem']))

376 
$¶i¡
 .ğ
$šdex·ge
;

378 if(
	`´eg_m©ch
("/´e/i",
$©ts
['listitem']))

380 
$¶i¡
 .ğ
$´•age
;

382 if(
	`´eg_m©ch
("/·g’o/i",
$©ts
['listitem']))

384 
$¶i¡
 .ğ
$li¡dd
;

386 if(
	`´eg_m©ch
("/Ãxt/i",
$©ts
['listitem']))

388 
$¶i¡
 .ğ
$Ãxage
;

390 if(
	`´eg_m©ch
("/’d/i",
$©ts
['listitem']))

392 
$¶i¡
 .ğ
$’d·ge
;

394 if(
	`´eg_m©ch
("/fÜm/i",
$©ts
['listitem']))

396 
$¶i¡
 .=" <fÜm‚ame='·g–i¡'‡ùiÚ='".
$this
->
	`G‘CurU¾
()."'>$hidenform";

397 if(
$tÙ®·ge
>
$tÙ®_li¡
)

399 
$¶i¡
.="<inputype='text'‚ame='pageno' style='padding:0px;width:30px;height:18px'>\r\n";

400 
$¶i¡
.="<inputype='submit'‚ame='plistgo' value='GO' style='padding:0px;width:30px;height:18px;font-size:11px'>\r\n";

402 
$¶i¡
 .= "</form>\r\n";

404 
$¶i¡
 .= "</div>\r\n";

405  
$¶i¡
;

406 
	}
}

414 
funùiÚ
 
	$G‘CurU¾
()

416 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

418 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

419 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

420 
$nowu¾
 = 
$nowu¾s
[0];

424 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

426  
$nowu¾
;

427 
	}
}

430 
funùiÚ
 
	$Clo£
()

432 
	}
}

440 
funùiÚ
 
	$Di¥Ïy
()

443 if(
$this
->
sourûSql
 !ğ''è$this->
	`P»Lßd
();

446 
$this
->
l
->
	`S‘Objeù
($this);

447 
$this
->
l
->
	`Di¥Ïy
();

448 
	}
}

457 
funùiÚ
 
	$SaveTo
(
$f’ame
)

459 
$this
->
l
->
	`SaveTo
(
$f’ame
);

460 
	}
}

	@E:\web\weixun\functions\arc.partview.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

7 
»quœe_Úû
(
XAKINC
.'/channelunit.class.php');

8 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

9 
»quœe_Úû
(
XAKINC
.'/ftp.class.php');

16 şas 
	cP¬tV›w


18 
v¬
 
	m$dsql
;

19 
v¬
 
	m$d
;

20 
v¬
 
	m$Ty³ID
;

21 
v¬
 
	m$F›lds
;

22 
v¬
 
	m$Ty³Lšk
;

23 
v¬
 
	m$pvCİy
;

24 
v¬
 
	m$»fObj
;

25 
v¬
 
	m$áp
;

26 
v¬
 
	m$»mÙeDœ
;

36 
funùiÚ
 
	$__cÚ¡ruù
(
$ty³id
=0,
$Ãedty³lšk
=
TRUE
)

38 
glob®
 
$_sys_glob®s
,
$áp
;

39 
$this
->
Ty³ID
 = 
$ty³id
;

40 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

41 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

42 
$this
->
d
->
	`S‘NameS·û
("xak","{","}");

43 
$this
->
d
->
	`S‘RefObj
($this);

44 
$this
->
áp
 = &
$áp
;

45 
$this
->
»mÙeDœ
 = '';

47 if(
$Ãedty³lšk
)

49 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(
$ty³id
);

50 if(
	`is_¬¿y
(
$this
->
Ty³Lšk
->
Ty³Infos
))

52 
	`fÜ—ch
(
$this
->
Ty³Lšk
->
Ty³Infos
 
as
 
$k
=>
$v
)

54 if(
	`´eg_m©ch
("/[^0-9]/", 
$k
))

56 
$this
->
F›lds
[
$k
] = 
$v
;

60 
$_sys_glob®s
['curfile'] = 'partview';

61 
$_sys_glob®s
['ty³Çme'] = 
$this
->
F›lds
['typename'];

64 
	`S‘SysEnv
(
$this
->
Ty³ID
,$this->
F›lds
['typename'],0,'','partview');

66 
	`S‘SysEnv
(
$this
->
Ty³ID
,'',0,'','partview');

67 
$this
->
F›lds
['ty³id'] = $this->
Ty³ID
;

70 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
)

72 
$this
->
F›lds
[
$k
] = 
$v
;

77 
funùiÚ
 
	$P¬tV›w
(
$ty³id
=0,
$Ãedty³lšk
=
TRUE
)

79 
$this
->
	`__cÚ¡ruù
(
$ty³id
,
$Ãedty³lšk
);

80 
	}
}

89 
funùiÚ
 
	$S‘RefObj
(&
$»fObj
)

91 
$this
->
d
->
	`S‘RefObj
(
$»fObj
);

92 if(
	`is£t
(
$»fObj
->
Ty³ID
))

94 
$this
->
	`__cÚ¡ruù
(
$»fObj
->
Ty³ID
);

96 
	}
}

105 
funùiÚ
 
	$S‘Ty³Lšk
(&
$ty³lšk
)

107 
$this
->
Ty³Lšk
 = 
$ty³lšk
;

108 if(
	`is_¬¿y
(
$this
->
Ty³Lšk
->
Ty³Infos
))

110 
	`fÜ—ch
(
$this
->
Ty³Lšk
->
Ty³Infos
 
as
 
$k
=>
$v
)

112 if(
	`´eg_m©ch
("/[^0-9]/", 
$k
))

114 
$this
->
F›lds
[
$k
] = 
$v
;

118 
	}
}

128 
funùiÚ
 
S‘Tem¶‘
(
$‹mp
,
$¡y³
="file")

130 if(
$¡y³
=="string")

132 
$this
->
d
->
LßdSourû
(
$‹mp
);

136 
	g$this
->
	gd
->
LßdTem¶‘
(
$‹mp
);

138 if(
	g$this
->
	gTy³ID
 > 0)

140 
	g$this
->
	gF›lds
['pos™iÚ'] = 
$this
->
Ty³Lšk
->
G‘Pos™iÚLšk
(
TRUE
);

141 
	g$this
->
	gF›lds
['t™Ë'] = 
$this
->
Ty³Lšk
->
G‘Pos™iÚLšk
(
çl£
);

143 
	g$this
->
P¬£Tem¶‘
();

152 
funùiÚ
 
	$Di¥Ïy
()

154 
$this
->
d
->
	`Di¥Ïy
();

155 
	}
}

163 
funùiÚ
 
	$G‘ResuÉ
()

165  
$this
->
d
->
	`G‘ResuÉ
();

166 
	}
}

176 
funùiÚ
 
	$SaveToHtml
(
$f’ame
,
$i¤emÙe
=0)

178 
glob®
 
$cfg_»mÙe_s™e
;

180 if(
$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
 == 1)

183 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '', 
$f’ame
);

184 
$loÿlfe
 = '..'.
$»mÙefe
;

186 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.js/', '', 
$»mÙefe
);

187 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

188 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'ascii');

190 
$this
->
d
->
	`SaveTo
(
$f’ame
);

191 
	}
}

199 
funùiÚ
 
	$P¬£Tem¶‘
()

201 
$GLOBALS
['’vs']['ty³id'] = 
$this
->
Ty³ID
;

202 if(
$this
->
Ty³ID
>0)

204 
$GLOBALS
['’vs']['tİid'] = 
	`G‘Tİid
(
$this
->
Ty³ID
);

208 
$GLOBALS
['envs']['topid'] = 0;

210 if(
	`is£t
(
$this
->
Ty³Lšk
->
Ty³Infos
['reid']))

212 
$GLOBALS
['’vs']['»id'] = 
$this
->
Ty³Lšk
->
Ty³Infos
['reid'];

214 if(
	`is£t
(
$this
->
Ty³Lšk
->
Ty³Infos
['channeltype']))

216 
$GLOBALS
['’vs']['chªÃlid'] = 
$this
->
Ty³Lšk
->
Ty³Infos
['channeltype'];

218 
	`MakeOÃTag
(
$this
->
d
,$this);

219 
	}
}

250 
funùiÚ
 
G‘ArcLi¡
(
$‹m¶‘s
='',
$ty³id
=0,
$row
=10,
$cŞ
=1,
$t™ËËn
=30,
$šfŞ’
=160,

251 
$imgwidth
=120,
$imgheight
=90,
$li¡ty³
="®l",
$Üd”by
="deçuÉ",
$keywÜd
="",
$šÃ¹ext
="",

252 
$bËwidth
="100",
$¬cid
=0,
$idli¡
="",
$chªÃlid
=0,
$lim™
="",
$©t
=0,
$Üd”
='desc',
$subday
=0,

253 
$autİ¬tid
=-1,
$ismemb”
=0,
$mašbË
='',
$ùag
='')

255 if(
em±y
(
$autİ¬tid
))

257 
$autİ¬tid
 = -1;

259 if(
em±y
(
$ty³id
))

261 
	g$ty³id
=
$this
->
Ty³ID
;

263 if(
	g$autİ¬tid
!=-1)

265 
$ty³id
 = 
$this
->
G‘AutoChªÃlID
(
$autİ¬tid
,$typeid);

266 if(
	g$ty³id
==0)

272 if(!
is£t
(
$GLOBALS
['__SpGetArcList']))

274 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/inc/inc_fun_SpGetArcList.php");

276  
SpG‘ArcLi¡
(
$this
->
dsql
,
$‹m¶‘s
,
$ty³id
,
$row
,
$cŞ
,
$t™ËËn
,
$šfŞ’
,
$imgwidth
,
$imgheight
,

277 
$li¡ty³
,
$Üd”by
,
$keywÜd
,
$šÃ¹ext
,
$bËwidth
,
$¬cid
,
$idli¡
,
$chªÃlid
,
$lim™
,
$©t
,

278 
$Üd”
,
$subday
,
$ismemb”
,
$mašbË
,
$ùag
);

282 
funùiÚ
 
	$Clo£
()

284 
	}
}

	@E:\web\weixun\functions\arc.rssview.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

10 
»quœe_Úû
(
XAKINC
.'/ftp.class.php');

12 @
£t_time_lim™
(0);

18 şas 
	cRssV›w


20 
v¬
 
	m$dsql
;

21 
v¬
 
	m$Ty³ID
;

22 
v¬
 
	m$Ty³Lšk
;

23 
v¬
 
	m$Ty³F›lds
;

24 
v¬
 
	m$MaxRow
;

25 
v¬
 
	m$d
;

26 
v¬
 
	m$áp
;

27 
v¬
 
	m$»mÙeDœ
;

37 
funùiÚ
 
	$__cÚ¡ruù
(
$ty³id
,
$max_row
=50)

39 
glob®
 
$áp
;

40 
$this
->
Ty³ID
 = 
$ty³id
;

41 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

42 
$this
->
d
->
»fObj
 = $this;

43 
$‹m¶‘fes
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir']."/module/rss.htm";

44 
$this
->
d
->
	`LßdTem¶©e
(
$‹m¶‘fes
);

45 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

46 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(
$ty³id
);

47 
$this
->
Ty³F›lds
 = $this->
Ty³Lšk
->
Ty³Infos
;

48 
$this
->
MaxRow
 = 
$max_row
;

49 
$this
->
Ty³F›lds
['t™Ë'] = $this->
Ty³Lšk
->
	`G‘Pos™iÚLšk
(
çl£
);

50 
$this
->
Ty³F›lds
['t™Ë'] = 
	`´eg_»¶aû
("/[<>]/"," / ",$this->TypeFields['title']);

51 
$this
->
Ty³F›lds
['ty³lšk'] = 
$GLOBALS
['cfg_ba£ho¡'].$this->
Ty³Lšk
->
	`G‘OÃTy³U¾
($this->TypeFields);

52 
$this
->
Ty³F›lds
['pow”by'] = 
$GLOBALS
['cfg_powerby'];

53 
$this
->
Ty³F›lds
['admšema'] = 
$GLOBALS
['cfg_adminemail'];

54 
$this
->
áp
 = &
$áp
;

55 
$this
->
»mÙeDœ
 = '';

56 
	`fÜ—ch
(
$this
->
Ty³F›lds
 
as
 
$k
=>
$v
)

58 
$this
->
Ty³F›lds
[
$k
] = 
	`html¥ecŸlch¬s
(
$v
);

60 
$this
->
	`P¬£Tem¶‘
();

64 
funùiÚ
 
	$RssV›w
(
$ty³id
,
$max_row
=50)

66 
$this
->
	`__cÚ¡ruù
(
$ty³id
,
$max_row
);

67 
	}
}

70 
funùiÚ
 
	$Clo£
()

72 
	}
}

80 
funùiÚ
 
	$Di¥Ïy
()

82 
$this
->
d
->
	`Di¥Ïy
();

83 
	}
}

92 
funùiÚ
 
	$MakeRss
(
$i¤emÙe
=0)

94 
glob®
 
$cfg_»mÙe_s™e
;

95 
$mu¾
 = 
$GLOBALS
['cfg_cm¥©h']."/cÚfig/rss/".
$this
->
Ty³ID
.".xml";

96 
$mfe
 = 
$GLOBALS
['cfg_ba£dœ'].
$mu¾
;

97 
$this
->
d
->
	`SaveTo
(
$mfe
);

99 if(
$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
 == 1)

102 
$»mÙefe
 = 
$mu¾
;

103 
$loÿlfe
 = '..'.
$»mÙefe
;

104 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.xml/', '',
$»mÙefe
);

106 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

107 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'acii');

109  
$mu¾
;

110 
	}
}

118 
funùiÚ
 
	$P¬£Tem¶‘
()

120 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$tid
 => 
$ùag
)

122 if(
$ùag
->
	`G‘Name
()=="field")

124 
$this
->
d
->
	`Assign
(
$tid
,$this->
Ty³F›lds
[
$ùag
->
	`G‘A‰
('name')]);

126 if(
$ùag
->
	`G‘Name
()=="rssitem")

128 
$this
->
d
->
	`Assign
(
$tid
,

129 
$this
->
	`G‘ArcLi¡
(
$ùag
->
	`G‘IÂ”Text
())

133 
	}
}

142 
funùiÚ
 
G‘ArcLi¡
(
$šÃ¹ext
="")

144 
$ty³id
=
$this
->
Ty³ID
;

145 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

146 if(
	g$šÃ¹ext
=="")

148 
$šÃ¹ext
 = 
G‘SysTem¶‘s
("rss.htm");

150 
	g$Üwh”e
 = "‡rc.arcrank > -1 ";

151 
	g$Üwh”e
 .ğ" AND (¬c.ty³id iÀ(".
G‘SÚIds
(
$this
->
Ty³ID
,$this->
Ty³F›lds
['channeltype']).") ) ";

152 
	g$Üd”sql
=" ORDER BY‡rc.id desc";

153 
	g$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.isdefault,

154 

.
deçuÉÇme
,
	g
.
	gÇm”uË
,.
	gÇm”uË2
,.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h


155 
	gFROM
 `#@
	g__¬chives
` 
¬c
 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g¬c
.
	gty³id
ñp.
id


156 
WHERE
 
$Üwh”e
 
$Üd”sql
 
LIMIT
 0,".$this->MaxRow;

157 
	g$this
->
	gdsql
->
S‘Qu”y
(
$qu”y
);

158 
	g$this
->
	gdsql
->
Execu‹
('al');

159 
	g$¬i¡
 = '';

160 
	g$d2
 = 
Ãw
 
XakTagP¬£
();

161 
	g$d2
->
S‘NameS·û
('field','[',']');

162 
	g$d2
->
LßdSourû
(
$šÃ¹ext
);

163 
	g$row
 = 
$this
->
dsql
->
G‘A¼ay
('al'))

166 if(
$row
['litpic'] == '-' || $row['litpic'] == '')

168 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

170 if(!
´eg_m©ch
("/^h‰p:\/\//", 
$row
['l™pic']è&& 
	g$GLOBALS
['cfg_multi_site'] == 'Y')

172 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

174 
	g$row
['piúame'] = 
$row
['litpic'];

175 
	g$row
["¬cu¾"] = 
G‘FeU¾
(
$row
["id"],$row["typeid"],$row["senddate"],$row["title"],

176 
$row
["ismake"],$row["arcrank"],$row["namerule"],$row["typedir"],$row["money"],$row['filename'],$row["moresite"],$row["siteurl"],$row["sitepath"]);

177 
	g$row
["ty³u¾"] = 
G‘Ty³U¾
(
$row
["typeid"],$row["typedir"],$row["isdefault"],$row["defaultname"],$row["ispart"],

178 
$row
["namerule2"],$row["moresite"],$row["siteurl"],$row["sitepath"]);

179 
	g$row
["šfo"] = 
$row
["description"];

180 
	g$row
["f’ame"] = 
$row
["arcurl"];

181 
	g$row
["¡ime"] = 
G‘D©eMK
(
$row
["pubdate"]);

182 
	g$row
["image"] = "<img src='".
$row
["picname"]."' border='0'>";

183 
	g$row
["fuÎu¾"] = 
$GLOBALS
["cfg_ba£ho¡"].
$row
["arcurl"];

185 if(
	g$GLOBALS
['cfg_muÉi_s™e'] =ğ'Y'è
$row
["fullurl"] = $row["arcurl"];

186 
	g$row
["phpu¾"] = 
$GLOBALS
["cfg_plus_dir"];

187 
	g$row
["‹m¶‘u¾"] = 
$GLOBALS
["cfg_templets_dir"];

188 if(
	g$row
["source"]=='')

190 
$row
["sourû"] = 
$GLOBALS
['cfg_webname'];

192 if(
	g$row
["writer"]=='')

194 
$row
["writer"] = "ç§©å";

196 
fÜ—ch
(
$row
 
as
 
$k
=>
$v
)

198 
$row
[
$k
] = 
html¥ecŸlch¬s
(
$v
);

200 if(
is_¬¿y
(
$d2
->
CTags
))

202 
fÜ—ch
(
$d2
->
CTags
 
as
 
$k
=>
$ùag
)

204 if(
$ùag
->
G‘Name
()=='array')

208 
$d2
->
Assign
(
$k
,
$row
);

212 if(
is£t
(
$row
[
$ùag
->
G‘Name
()]))

214 
	g$d2
->
Assign
(
$k
,
$row
[
$ùag
->
G‘Name
()]);

218 
	g$d2
->
Assign
(
$k
,'');

223 
	g$¬i¡
 .ğ
$d2
->
G‘ResuÉ
()."\r\n";

225 
	g$this
->
	gdsql
->
F»eResuÉ
('al');

226  
	g$¬i¡
;

	@E:\web\weixun\functions\arc.searchview.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

11 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

12 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

13 
»quœe_Úû
(
XAKINC
."/splitword.class.php");

14 
»quœe_Úû
(
XAKINC
."/taglib/hotwords.lib.php");

15 
»quœe_Úû
(
XAKINC
."/taglib/channel.lib.php");

16 
»quœe_Úû
(
XAKINC
."/taglib/rpad.lib.php");

17 
»quœe_Úû
(
XAKINC
."/taglib/type.lib.php");

19 @
£t_time_lim™
(0);

20 @
ši_£t
('memory_limit', '512M');

27 şas 
	cS—rchV›w


29 
v¬
 
	m$dsql
;

30 
v¬
 
	m$d
;

31 
v¬
 
	m$d2
;

32 
v¬
 
	m$Ty³ID
;

33 
v¬
 
	m$Ty³Lšk
;

34 
v¬
 
	m$PageNo
;

35 
v¬
 
	m$TÙ®Page
;

36 
v¬
 
	m$TÙ®ResuÉ
;

37 
v¬
 
	m$PageSize
;

38 
v¬
 
	m$ChªÃlTy³
;

39 
v¬
 
	m$TempInfos
;

40 
v¬
 
	m$F›lds
;

41 
v¬
 
	m$P¬tV›w
;

42 
v¬
 
	m$S¹Time
;

43 
v¬
 
	m$KeywÜds
;

44 
v¬
 
	m$Ord”By
;

45 
v¬
 
	m$S—rchTy³
;

46 
v¬
 
	m$mid
;

47 
v¬
 
	m$KTy³
;

48 
v¬
 
	m$KeywÜd
;

49 
v¬
 
	m$S—rchMax
;

50 
v¬
 
	m$S—rchMaxRc
;

51 
v¬
 
	m$S—rchTime
;

52 
v¬
 
	m$AddSql
;

53 
v¬
 
	m$RsF›lds
;

54 
v¬
 
	m$Sphšx
;

55 
v¬
 
	m$Ïng
;

56 
v¬
 
	m$diy_tmp
;

73 
funùiÚ
 
__cÚ¡ruù
(
$ty³id
,
$keywÜd
,
$Üd”by
,
$achªÃÉy³
="®l",
$£¬chty³
='',
$¡¬‰ime
=0,
$u·gesize
=20,
$kwty³
=1,
$mid
=0,
$Ïng
='ú',
$diy_tmp
='')

75 
glob®
 
$cfg_£¬ch_max
,
$cfg_£¬ch_maxrc
,
$cfg_£¬ch_time
,
$cfg_¥hšx_¬tişe
;

76 if(
em±y
(
$u·gesize
))

78 
	m$u·gesize
 = 10;

80 
	m$this
->
	mTy³ID
 = 
$ty³id
;

81 
	m$this
->
	mKeywÜd
 = 
$keywÜd
;

82 
	m$this
->
	mOrd”By
 = 
$Üd”by
;

83 
	m$this
->
	mKTy³
 = 
$kwty³
;

84 
	m$this
->
	mPageSize
 = ()
$u·gesize
;

85 
	m$this
->
	mS¹Time
 = 
$¡¬‰ime
;

86 
	m$this
->
	mChªÃlTy³
 = 
$achªÃÉy³
;

87 
	m$this
->
	mS—rchMax
 = 
$cfg_£¬ch_max
;

88 
	m$this
->
	mS—rchMaxRc
 = 
$cfg_£¬ch_maxrc
;

89 
	m$this
->
	mS—rchTime
 = 
$cfg_£¬ch_time
;

90 
	m$this
->
	mmid
 = 
$mid
;

91 
	m$this
->
	mRsF›lds
 = '';

92 
	m$this
->
	mS—rchTy³
 = 
$£¬chty³
=='' ? 'titlekeyword' : $searchtype;

93 
	m$this
->
	mdsql
 = 
$GLOBALS
['dsql'];

94 
	m$this
->
	md
 = 
Ãw
 
XakTagP¬£
();

95 
	m$this
->
	md
->
S‘RefObj
(
$this
);

96 
	m$this
->
	md
->
S‘NameS·û
("xak","{","}");

97 
	m$this
->
	md2
 = 
Ãw
 
XakTagP¬£
();

98 
	m$this
->
	md2
->
S‘NameS·û
("field","[","]");

99 
	m$this
->
	mTy³Lšk
 = 
Ãw
 
Ty³Lšk
(
$ty³id
);

101 
	m$this
->
	mKeywÜds
 = 
$this
->
G‘KeywÜds
(
$keywÜd
);

104 if(
	m$this
->
	mTy³ID
=="0"){

105 
$this
->
ChªÃlTy³id
=1;

107 
	m$row
 =
$this
->
dsql
->
G‘OÃ
("SELECT channeltype FROM `#@__arctype` WHERE id={$this->TypeID}");

108 
	m$this
->
	mChªÃlTy³id
=
$row
['channeltype'];

110 
fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
)

112 
$this
->
F›lds
[
$k
] = 
$v
;

114 ià(
	m$cfg_¥hšx_¬tişe
 == 'Y')

117 
$this
->
¥hšx
 = 
Ãw
 
SphšxCl›Á
;

119 
	m$mode
 = 
SPH_MATCH_EXTENDED2
;

120 
	m$¿nk”
 = 
SPH_RANK_PROXIMITY_BM25
;

121 
	m$this
->
	m¥hšx
->
S‘S”v”
(
$GLOBALS
['cfg_sphinx_host'], $GLOBALS['cfg_sphinx_port']);

122 
	m$this
->
	m¥hšx
->
S‘A¼ayResuÉ
(
Œue
);

123 
	m$this
->
	m¥hšx
->
S‘M©chMode
(
$mode
);

124 
	m$this
->
	m¥hšx
->
S‘RªkšgMode
(
$¿nk”
);

126 
	m$this
->
CouÁRecÜdSphšx
();

128 
	m$this
->
CouÁRecÜd
();

130 
	m$this
->
	mÏng
 = 
$Ïng
;

131 
	m$this
->
	mdiy_tmp
 = 
$diy_tmp
;

133 
	m$‹mpfe
 = 
$GLOBALS
['cfg_ba£dœ'].$GLOBALS['cfg_‹m¶‘s_dœ']."/".$GLOBALS['cfg_df_¡yË'].
$diy_tmp
."/search.htm";

135 if(!
fe_exi¡s
(
$‹mpfe
)||!
is_fe
($tempfile))

137 if(
	m$this
->
	mÏng
=='cn')

139 
echo
 "æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è§£æï¼";

143 
	mecho
 "Tempfile No Found.";

145 
ex™
();

147 
	m$this
->
	md
->
LßdTem¶©e
(
$‹mpfe
);

148 
	m$this
->
	mTempInfos
['gs'] = 
$this
->
d
->
CTags
;

149 
	m$this
->
	mTempInfos
['sourû'] = 
$this
->
d
->
SourûSŒšg
;

150 if(
	m$this
->
	mPageSize
=="")

152 
$this
->
PageSize
 = 20;

154 
	m$this
->
	mTÙ®Page
 = 
û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

155 if(
	m$this
->
	mPageNo
==1)

157 
$this
->
dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__£¬ch_keywÜds` SET„esuÉ='".$this->
TÙ®ResuÉ
."' WHERE keywÜd='".
add¦ashes
(
$keywÜd
)."'; ");

163 
funùiÚ
 
S—rchV›w
(
$ty³id
,
$keywÜd
,
$Üd”by
,
$achªÃÉy³
="®l",
$£¬chty³
="",
$¡¬‰ime
=0,
$u·gesize
=20,
$kwty³
=1,
$mid
=0,
$Ïng
='ú',
$diy_tmp
='')

165 
$this
->
__cÚ¡ruù
(
$ty³id
,
$keywÜd
,
$Üd”by
,
$achªÃÉy³
,
$£¬chty³
,
$¡¬‰ime
,
$u·gesize
,
$kwty³
,
$mid
,
$Ïng
,
$diy_tmp
);

169 
funùiÚ
 
	$Clo£
()

171 
	}
}

180 
funùiÚ
 
	$G‘KeywÜds
(
$keywÜd
)

182 
glob®
 
$cfg_soá_Ïng
;

183 
$keywÜd
 = 
	`ú_sub¡r
($keyword, 50);

184 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT spwÜd FROM `#@__£¬ch_keywÜds` WHERE keywÜd='".
	`add¦ashes
(
$keywÜd
)."'; ");

185 if(!
	`is_¬¿y
(
$row
))

187 if(
	`¡¾’
(
$keywÜd
)>7)

190 
$¥
 = 
Ãw
 
	`S¶™WÜd
(
$cfg_soá_Ïng
, $cfg_soft_lang);

191 
$¥
->
	`S‘Sourû
(
$keywÜd
, 
$cfg_soá_Ïng
, $cfg_soft_lang);

192 
$¥
->
	`S‘ResuÉTy³
(2);

193 
$¥
->
	`S¹AÇlysis
(
TRUE
);

194 
$keywÜds
 = 
$¥
->
	`G‘Fš®lyResuÉ
();

195 
$idx_keywÜds
 = 
$¥
->
	`G‘Fš®lyIndex
();

196 
	`ksÜt
(
$idx_keywÜds
);

197 
$keywÜds
 = 
$keywÜd
.' ';

198 
	`fÜ—ch
 (
$idx_keywÜds
 
as
 
$key
 => 
$v®ue
) {

199 ià(
	`¡¾’
(
$key
) <= 3) {

202 
$keywÜds
 .ğ' '.
$key
;

204 
$keywÜds
 = 
	`´eg_»¶aû
("/[ ]{1,}/", " ", $keywords);

206 
	`un£t
(
$¥
);

210 
$keywÜds
 = 
$keywÜd
;

212 
$šqu”y
 = "INSERT INTO `#@__search_keywords`(`keyword`,`spwords`,`count`,`result`,`lasttime`)

213 
	`VALUES
 ('".addslashes($keyword)."', '".addslashes($keywords)."', '1', '0', '".time()."'); ";

214 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

218 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__£¬ch_keywÜds` SET couÁ=couÁ+1,Ï¡time='".
	`time
()."' WHERE keywÜd='".
	`add¦ashes
(
$keywÜd
)."'; ");

219 
$keywÜds
 = 
$row
['spwords'];

221  
$keywÜds
;

222 
	}
}

230 
funùiÚ
 
	$G‘KeywÜdSql
()

232 
$ks
 = 
	`ex¶ode
(' ',
$this
->
KeywÜds
);

233 
$kwsql
 = '';

234 
$kwsqls
 = 
	`¬¿y
();

235 
	`fÜ—ch
(
$ks
 
as
 
$k
)

237 
$k
 = 
	`Œim
($k);

238 if(
	`¡¾’
(
$k
)<1)

242 if(
	`Üd
(
$k
[0])>0x80 && 
	`¡¾’
($k)<2)

246 
$k
 = 
	`add¦ashes
($k);

247 if(
$this
->
ChªÃlTy³
 < 0 || $this->
ChªÃlTy³id
 < 0){

248 
$kwsqls
[] = "‡rc.title LIKE '%$k%' ";

250 if(
$this
->
S—rchTy³
=="title"){

251 
$kwsqls
[] = "‡rc.title LIKE '%$k%' ";

253 
$kwsqls
[] = " CONCAT(arc.title,' ',arc.writer,' ',arc.keywords) LIKE '%$k%' ";

257 if(!
	`is£t
(
$kwsqls
[0]))

263 if(
$this
->
KTy³
==1)

265 
$kwsql
 = 
	`još
(' OR ',
$kwsqls
);

269 
$kwsql
 = 
	`još
(' And ',
$kwsqls
);

271  
$kwsql
;

273 
	}
}

282 
funùiÚ
 
	$G‘LikeWÜds
(
$num
=8)

284 
$ks
 = 
	`ex¶ode
(' ',
$this
->
KeywÜds
);

285 
$lsql
 = '';

286 
	`fÜ—ch
(
$ks
 
as
 
$k
)

288 
$k
 = 
	`Œim
($k);

289 if(
	`¡¾’
(
$k
)<2)

293 if(
	`Üd
(
$k
[0])>0x80 && 
	`¡¾’
($k)<2)

297 
$k
 = 
	`add¦ashes
($k);

298 if(
$lsql
=='')

300 
$lsql
 = $lsql." CONCAT(spwords,' ') LIKE '%$k %' ";

302 
$lsql
 = $lsql." OR CONCAT(spwords,' ') LIKE '%$k %' ";

305 if(
$lsql
=='')

311 
$likewÜd
 = '';

312 
$lsql
 = "(".$lsql."èAND NOT(keywÜd†ik'".
	`add¦ashes
(
$this
->
KeywÜd
)."') ";

313 
$this
->
dsql
->
	`S‘Qu”y
("SELECT keyword,count FROM `#@__search_keywords` WHERE $lsql ORDER BY†asttime DESC LIMIT 0,$num; ");

314 
$this
->
dsql
->
	`Execu‹
('l');

315 
$row
=
$this
->
dsql
->
	`G‘A¼ay
('l'))

317 if(
$row
['count']>1000)

319 
$f¡yË
=" style='font-size:11pt;color:red'";

321 if(
$row
['count']>300)

323 
$f¡yË
=" style='font-size:10pt;color:green'";

327 
$¡yË
 = "";

329 
$likewÜd
 .ğ"ã€€<¨h»f='£¬ch.php?keywÜd=".
	`u¾’code
(
$row
['keywÜd'])."&£¬chty³ñ™ËkeywÜd'".
$¡yË
."><u>".$row['keyword']."</u></a> ";

331  
$likewÜd
;

333 
	}
}

342 
funùiÚ
 
	$G‘RedKeyWÜd
(
$f¡r
)

345 
$ks
 = 
	`ex¶ode
(' ',
$this
->
KeywÜds
);

346 
	`fÜ—ch
(
$ks
 
as
 
$k
)

348 
$k
 = 
	`Œim
($k);

349 if(
$k
=='')

353 if(
	`Üd
(
$k
[0])>0x80 && 
	`¡¾’
($k)<2)

358 
$f¡r
 = 
	`¡r_œ•Ïû
(
$k
, "<font color='red'>$k</font>", $fstr);

362  
$f¡r
;

363 
	}
}

366 
funùiÚ
 
	$CouÁRecÜdSphšx
()

368 
$this
->
TÙ®ResuÉ
 = -1;

369 if(
	`is£t
(
$GLOBALS
['TotalResult']))

371 
$this
->
TÙ®ResuÉ
 = 
$GLOBALS
['TotalResult'];

372 
$this
->
TÙ®ResuÉ
 = 
	`is_num”ic
($this->TotalResult)? $this->TotalResult : "";

374 if(
	`is£t
(
$GLOBALS
['PageNo']))

376 
$this
->
PageNo
 = 
	`štv®
(
$GLOBALS
['PageNo']);

380 
$this
->
PageNo
 = 1;

383 if(
$this
->
S¹Time
 > 0)

385 
$this
->
¥hšx
->
	`S‘F‹rRªge
('£ndd©e', $this->
S¹Time
, 
	`time
(), 
çl£
);

387 if(
$this
->
Ty³ID
 > 0)

389 
$this
->
¥hšx
->
	`S‘F‹r
('ty³id', 
	`G‘SÚIds
($this->
Ty³ID
));

391 
$this
->
¥hšx
->
	`S‘F‹r
('chªÃl', 
	`¬¿y
(1));

392 if(
$this
->
mid
 > 0)

394 
$this
->
¥hšx
->
	`S‘F‹r
('mid', $this->
mid
);

398 
$»s
 = 
	`¬¿y
();

399 
$»s
 = 
	`AutoCh¬£t
(
$this
->
¥hšx
->
	`Qu”y
($this->
KeywÜds
, 'mysql, delta'), 'utf-8', 'gbk');

401 
$this
->
TÙ®ResuÉ
 = 
$»s
['total'];

402 
	}
}

410 
funùiÚ
 
	$CouÁRecÜd
()

412 
$this
->
TÙ®ResuÉ
 = -1;

413 if(
	`is£t
(
$GLOBALS
['TotalResult']))

415 
$this
->
TÙ®ResuÉ
 = 
$GLOBALS
['TotalResult'];

416 
$this
->
TÙ®ResuÉ
 = 
	`is_num”ic
($this->TotalResult)? $this->TotalResult : "";

418 if(
	`is£t
(
$GLOBALS
['PageNo']))

420 
$this
->
PageNo
 = 
	`štv®
(
$GLOBALS
['PageNo']);

424 
$this
->
PageNo
 = 1;

426 
$ksql
 = 
$this
->
	`G‘KeywÜdSql
();

427 
$ksqls
 = 
	`¬¿y
();

428 if(
$this
->
S¹Time
 > 0)

430 
$ksqls
[] = "‡rc.£ndd©e>'".
$this
->
S¹Time
."' ";

432 if(
$this
->
Ty³ID
 > 0)

434 
$ksqls
[] = "y³id IN (".
	`G‘SÚIds
(
$this
->
Ty³ID
).") ";

436 if(
$this
->
ChªÃlTy³
 > 0)

438 
$ksqls
[] = "‡rc.chªÃl='".
$this
->
ChªÃlTy³
."'";

440 if(
$this
->
mid
 > 0)

442 
$ksqls
[] = "‡rc.mid = '".
$this
->
mid
."'";

444 
$ksqls
[] = "‡rc.arcrank > -1 ";

445 
$this
->
AddSql
 = (
$ksql
=='' ? 
	`još
(' AND ',
$ksqls
) : join(' AND ',$ksqls)." AND ($ksql)" );

446 if(
$this
->
ChªÃlTy³
 < 0 || $this->
ChªÃlTy³id
< 0){

447 if(
$this
->
ChªÃlTy³
=="0"è
$id
=$this->
ChªÃlTy³id
;

448 
$id
=
$this
->
ChªÃlTy³
;

449 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id=$id");

450 
$addbË
 = 
	`Œim
(
$row
['addtable']);

451 
$this
->
AddTabË
=
$addbË
;

453 
$this
->
AddTabË
="#@__archives";

455 
$cqu”y
 = "SELECT * FROM `{$this->AddTabË}`‡røWHERE ".
$this
->
AddSql
;

456 
$hascode
 = 
	`md5
(
$cqu”y
);

457 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__¬cÿche` WHERE `md5hash`='".
$hascode
."' ");

458 
$u±ime
 = 
	`time
();

459 if(
	`is_¬¿y
(
$row
è&& 
	`time
()-$row['uptime'] < 3600 * 24)

461 
$aids
 = 
	`ex¶ode
(',', 
$row
['cachedata']);

462 
$this
->
TÙ®ResuÉ
 = 
	`couÁ
(
$aids
)-1;

463 
$this
->
RsF›lds
 = 
$row
['cachedata'];

467 if(
$this
->
TÙ®ResuÉ
==-1)

469 
$this
->
dsql
->
	`S‘Qu”y
(
$cqu”y
);

470 
$this
->
dsql
->
	`execu‹
();

471 
$aid¬r
 = 
	`¬¿y
();

472 
$aid¬r
[] = 0;

473 
$row
 = 
$this
->
dsql
->
	`g‘¬¿y
())

475 if(
$this
->
ChªÃlTy³
< 0 ||$this->
ChªÃlTy³id
< 0è
$aid¬r
[] = 
$row
['aid'];

476 
$aid¬r
[] = 
$row
['id'];

478 
$nums
 = 
	`couÁ
(
$aid¬r
)-1;

479 
$aids
 = 
	`im¶ode
(',', 
$aid¬r
);

480 
$d–‘e
 = "DELETE FROM `#@__¬cÿche` WHERE u±ime<".(
	`time
() - 3600 * 24);

481 
$this
->
dsql
->
	`S‘Qu”y
(
$d–‘e
);

482 
$this
->
dsql
->
	`execu‹nÚequ”y
();

483 
$š£¹
 = "INSERT INTO `#@__arccache` (`md5hash`, `uptime`, `cachedata`)

484 
	`VALUES
('$hascode', '$uptime', '$aids')";

485 
$this
->
dsql
->
	`S‘Qu”y
(
$š£¹
);

486 
$this
->
dsql
->
	`execu‹nÚequ”y
();

487 
$this
->
TÙ®ResuÉ
 = 
$nums
;

490 
	}
}

499 
funùiÚ
 
	$Di¥Ïy
()

501 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$gid
=>
$ùag
)

503 
$gÇme
 = 
$ùag
->
	`G‘Name
();

504 if(
$gÇme
=="list")

506 
$lim™¡¬t
 = (
$this
->
PageNo
-1è* $this->
PageSize
;

507 
$row
 = 
$this
->
PageSize
;

508 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())=="")

510 
$IÂ”Text
 = 
	`G‘SysTem¶‘s
("list_fulllist.htm");

514 
$IÂ”Text
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

516 
$this
->
d
->
	`Assign
(
$gid
,

517 
$this
->
	`G‘ArcLi¡
(
$lim™¡¬t
,

518 
$row
,

519 
$ùag
->
	`G‘A‰
("col"),

520 
$ùag
->
	`G‘A‰
("titlelen"),

521 
$ùag
->
	`G‘A‰
("infolen"),

522 
$ùag
->
	`G‘A‰
("imgwidth"),

523 
$ùag
->
	`G‘A‰
("imgheight"),

524 
$this
->
ChªÃlTy³
,

525 
$this
->
Ord”By
,

526 
$IÂ”Text
,

527 
$ùag
->
	`G‘A‰
("tablewidth"))

530 if(
$gÇme
=="pagelist")

532 
$li¡_Ën
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("listsize"));

533 if(
$li¡_Ën
=="")

535 
$li¡_Ën
 = 3;

537 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡DM
(
$li¡_Ën
));

539 if(
$gÇme
=="likewords")

541 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘LikeWÜds
(
$ùag
->
	`G‘A‰
('num')));

543 if(
$gÇme
=="hotwords")

545 
$this
->
d
->
	`Assign
(
$gid
,
	`lib_hÙwÜds
(
$ùag
,$this));

547 if(
$gÇme
=="field")

550 if(
	`is£t
(
$this
->
F›lds
[
$ùag
->
	`G‘A‰
('name')]))

552 
$this
->
d
->
	`Assign
(
$gid
,$this->
F›lds
[
$ùag
->
	`G‘A‰
('name')]);

556 
$this
->
d
->
	`Assign
(
$gid
,"");

559 if(
$gÇme
=="channel")

562 if(
$this
->
Ty³ID
>0)

564 
$ty³id
 = 
$this
->
Ty³ID
; 
$»id
 = $this->
Ty³Lšk
->
Ty³Infos
['reid'];

568 
$ty³id
 = 0; 
$»id
=0;

570 
$GLOBALS
['’vs']['ty³id'] = 
$ty³id
;

571 
$GLOBALS
['’vs']['»id'] = 
$ty³id
;

572 
$this
->
d
->
	`Assign
(
$gid
,
	`lib_chªÃl
(
$ùag
,$this));

574 if(
$gÇme
=="rpad")

576 
$this
->
d
->
	`Assign
(
$gid
,
	`lib_½ad
(
$ùag
,$this));

578 if(
$gÇme
=="type")

580 
$this
->
d
->
	`Assign
(
$gid
,
	`lib_ty³
(
$ùag
,$this));

584 
glob®
 
$keywÜd
, 
$ŞdkeywÜd
;

585 if(!
	`em±y
(
$ŞdkeywÜd
)è
$keywÜd
 = $oldkeyword;

586 
$this
->
d
->
	`Di¥Ïy
();

587 
	}
}

606 
funùiÚ
 
G‘ArcLi¡
(
$lim™¡¬t
=0,
$row
=10,
$cŞ
=1,
$t™ËËn
=30,
$šfŞ’
=250,
$imgwidth
=120,
$imgheight
=90,
$achªÃÉy³
="®l",
$Üd”by
="deçuÉ",
$šÃ¹ext
="",
$bËwidth
="100")

608 
glob®
 
$cfg_¥hšx_¬tişe
;

609 
	g$ty³id
=
$this
->
Ty³ID
;

610 if(
	g$row
==''è
$row
 = 10;

611 if(
	g$lim™¡¬t
==''è
$lim™¡¬t
 = 0;

612 if(
	g$t™ËËn
==''è
$t™ËËn
 = 30;

613 if(
	g$šfŞ’
==''è
$šfŞ’
 = 250;

614 if(
	g$imgwidth
==''è
$imgwidth
 = 120;

615 if(
	g$imgheight
=''è
$imgheight
 = 120;

616 if(
	g$achªÃÉy³
==''è
$achªÃÉy³
 = '0';

617 
	g$Üd”by
 = 
$Üd”by
=='' ? 'deçuÉ' : 
¡¹Şow”
($orderby);

618 
	g$bËwidth
 = 
¡r_»¶aû
("%","",
$bËwidth
);

619 if(
	g$bËwidth
==''è
$bËwidth
=100;

620 if(
	g$cŞ
==''è
$cŞ
=1;

621 
	g$cŞWidth
 = 
û
(100/
$cŞ
);

622 
	g$bËwidth
 = 
$bËwidth
."%";

623 
	g$cŞWidth
 = 
$cŞWidth
."%";

624 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

625 if(
	g$šÃ¹ext
=='')

627 
$šÃ¹ext
 = 
G‘SysTem¶‘s
("search_list.htm");

630 ià(
	g$cfg_¥hšx_¬tişe
 == 'Y')

632 
$Üd”sql
 = '';

633 if(
	g$this
->
	gChªÃlTy³
< 0 ||$this->
	gChªÃlTy³id
< 0)

635 if(
	g$Üd”by
=="id"){

636 
$Üd”sql
="@id desc";

638 
	g$Üd”sql
="@senddate desc";

641 if(
	g$Üd”by
=="senddate")

643 
$Üd”sql
="@senddate desc";

645 if(
	g$Üd”by
=="pubdate")

647 
$Üd”sql
="@pubdate desc";

649 if(
	g$Üd”by
=="id")

651 
$Üd”sql
="@id desc";

655 
	g$Üd”sql
="@sortrank desc";

659 
	g$this
->
	g¥hšx
->
S‘Lim™s
(
$lim™¡¬t
, ()
$row
, ($row>1000) ? $row : 1000);

660 
	g$»s
 = 
¬¿y
();

661 
	g$»s
 = 
AutoCh¬£t
(
$this
->
¥hšx
->
Qu”y
($this->
KeywÜds
, 'mysql, delta'), 'utf-8', 'gbk');

663 
fÜ—ch
 (
$»s
['wÜds'] 
as
 
$k
 => 
$v
) {

664 
$this
->
KeywÜds
 .= " $k";

666 
fÜ—ch
(
$»s
['m©ches'] 
as
 
$_v
) {

667 
	g$aids
[] = 
$_v
['id'];

670 
	g$aids
 = @
im¶ode
(',', 
$aids
);

673 
	g$qu”y
 = "SELECT‡rc.*,act.typedir,act.typename,act.isdefault,act.defaultname,act.namerule,

674 
aù
.
Çm”uË2
,
	gaù
.
	gi¥¬t
,aù.
	gmÜes™e
,aù.
	gs™eu¾
,aù.
s™•©h


675 
	gFROM
 `#@
	g__¬chives
` 
¬c
 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 
aù
 
ON
 
	g¬c
.
	gty³id
÷ù.
id


676 
WHERE
 
¬c
.
id
 
IN
 (
$aids
)";

680 
	g$Üd”sql
 = '';

681 if(
	g$this
->
	gChªÃlTy³
< 0 ||$this->
	gChªÃlTy³id
< 0)

683 if(
	g$Üd”by
=="id"){

684 
$Üd”sql
="ORDER BY‡rc.aid desc";

686 
	g$Üd”sql
="ORDER BY‡rc.senddate desc";

689 if(
	g$Üd”by
=="senddate")

691 
$Üd”sql
=" ORDER BY‡rc.senddate desc";

693 if(
	g$Üd”by
=="pubdate")

695 
$Üd”sql
=" ORDER BY‡rc.pubdate desc";

697 if(
	g$Üd”by
=="id")

699 
$Üd”sql
=" ORDER BY‡rc.id desc";

703 
	g$Üd”sql
=" ORDER BY‡rc.sortrank desc";

708 
	g$qu”y
 = "SELECT‡rc.*,act.typedir,act.typename,act.isdefault,act.defaultname,act.namerule,

709 
aù
.
Çm”uË2
,
	gaù
.
	gi¥¬t
,aù.
	gmÜes™e
,aù.
	gs™eu¾
,aù.
s™•©h


710 
	gFROM
 `{
	g$this
->
	gAddTabË
}` 
¬c
 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 
aù
 
ON
 
	g¬c
.
	gty³id
÷ù.
id


711 
WHERE
 {
$this
->
AddSql
} 
$Üd”sql
 
LIMIT
 
$lim™¡¬t
,
	g$row
";

714 
	g$this
->
	gdsql
->
S‘Qu”y
(
$qu”y
);

715 
	g$this
->
	gdsql
->
Execu‹
("al");

716 
	g$¬i¡
 = "";

717 if(
	g$cŞ
>1)

719 
	g$¬i¡
 = "<table width='$tablewidth' border='0' cellspacing='0' cellpadding='0'>\r\n";

721 
	g$this
->
	gd2
->
LßdSourû
(
$šÃ¹ext
);

722 
	g$i
=0;$i<
	g$row
;$i++)

724 if(
	g$cŞ
>1)

726 
	g$¬i¡
 .= "<tr>\r\n";

728 
	g$j
=0;$j<
	g$cŞ
;$j++)

730 if(
	g$cŞ
>1)

732 
	g$¬i¡
 .= "<td width='$colWidth'>\r\n";

734 if(
	g$row
 = 
$this
->
dsql
->
G‘A¼ay
("al"))

736 if(
$this
->
ChªÃlTy³
< 0 || $this->
ChªÃlTy³id
< 0) {

737 
$row
["id"]=$row["aid"];

738 
	g$row
["ismake"]=
em±y
(
$row
["ismake"])? "" : $row["ismake"];

739 
	g$row
["f’ame"]=
em±y
(
$row
["filename"])? "" : $row["filename"];

740 
	g$row
["mÚey"]=
em±y
(
$row
["money"])? "" : $row["money"];

741 
	g$row
["desütiÚ"]=
em±y
(
$row
["description "])? "" : $row["description"];

742 
	g$row
["pubd©e"]=
em±y
(
$row
["pubdate "])? $row["senddate"] : $row["pubdate"];

745 
	g$row
["¬cu¾"] = 
G‘FeU¾
(
$row
["id"],$row["typeid"],$row["senddate"],$row["title"],

746 
$row
["ismake"],$row["arcrank"],$row["namerule"],$row["typedir"],$row["money"],$row['filename'],$row["moresite"],$row["siteurl"],$row["sitepath"]);

747 
	g$row
["desütiÚ"] = 
$this
->
G‘RedKeyWÜd
(
ú_sub¡r
(
$row
["desütiÚ"],
$šfŞ’
));

748 
	g$row
["t™Ë"] = 
$this
->
G‘RedKeyWÜd
(
ú_sub¡r
(
$row
["t™Ë"],
$t™ËËn
));

749 
	g$row
["id"] = 
$row
["id"];

750 if(
	g$row
['l™pic'] =ğ'-' || 
$row
['litpic'] == '')

752 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

754 if(!
´eg_m©ch
("/^h‰p:\/\//", 
$row
['l™pic']è&& 
	g$GLOBALS
['cfg_multi_site'] == 'Y')

756 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

758 
	g$row
['piúame'] = 
$row
['litpic'];

759 
	g$row
["ty³u¾"] = 
G‘Ty³U¾
(
$row
["typeid"],$row["typedir"],$row["isdefault"],$row["defaultname"],$row["ispart"],$row["namerule2"],$row["moresite"],$row["siteurl"],$row["sitepath"]);

760 
	g$row
["šfo"] = 
$row
["description"];

761 
	g$row
["f’ame"] = 
$row
["arcurl"];

762 
	g$row
["¡ime"] = 
G‘D©eMK
(
$row
["pubdate"]);

763 
	g$row
["‹xšk"] = "<¨h»f='".
$row
["filename"]."'>".$row["title"]."</a>";

764 
	g$row
["ty³lšk"] = "[<¨h»f='".
$row
["typeurl"]."'>".$row["typename"]."</a>]";

765 
	g$row
["imglšk"] = "<¨h»f='".
$row
["filename"]."'><img src='".$row["picname"]."' border='0' width='$imgwidth' height='$imgheight'></a>";

766 
	g$row
["image"] = "<img src='".
$row
["picname"]."' border='0' width='$imgwidth' height='$imgheight'>";

767 
	g$row
['¶usu¾'] = 
$row
['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

768 
	g$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

769 
	g$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

770 if(
is_¬¿y
(
$this
->
d2
->
CTags
))

772 
fÜ—ch
(
$this
->
d2
->
CTags
 
as
 
$k
=>
$ùag
)

774 if(
$ùag
->
G‘Name
()=='array')

777 
$this
->
d2
->
Assign
(
$k
,
$row
);

781 if(
is£t
(
$row
[
$ùag
->
G‘Name
()]))

783 
	g$this
->
	gd2
->
Assign
(
$k
,
$row
[
$ùag
->
G‘Name
()]);

787 
	g$this
->
	gd2
->
Assign
(
$k
,'');

792 
	g$¬i¡
 .ğ
$this
->
d2
->
G‘ResuÉ
();

797 
	g$¬i¡
 .= "";

799 if(
	g$cŞ
>1è
	g$¬i¡
 .= "</td>\r\n";

802 if(
	g$cŞ
>1)

804 
	g$¬i¡
 .= "</tr>\r\n";

808 if(
	g$cŞ
>1)

810 
	g$¬i¡
 .= "</table>\r\n";

812 
	g$this
->
	gdsql
->
F»eResuÉ
("al");

814  
	g$¬i¡
;

824 
funùiÚ
 
	$G‘PageLi¡DM
(
$li¡_Ën
)

826 
glob®
 
$ŞdkeywÜd
;

829 if(
$this
->
Ïng
=='cn')

831 
$Ïng_tÙ®
='å…±';

832 
$Ïng_·ge
='é¡µ';

833 
$Ïng_»cÜd
='æ¡è®°å½•';

834 
$Ïng_fšd
='å…±æ‰¾åˆ°';

835 
$Ïng_show
='æœ€å¤§æ˜¾ç¤º';

836 
$Ïng_šdex
='é¦–é¡µ';

837 
$Ïng_’d
='æœ«é¡µ';

838 
$Ïng_´e
='ä¸Šä¸€é¡µ';

839 
$Ïng_Ãxt
='ä¸‹ä¸€é¡µ';

843 
$Ïng_tÙ®
='Total';

844 
$Ïng_·ge
='Pages';

845 
$Ïng_»cÜd
='Records';

846 
$Ïng_fšd
='Find';

847 
$Ïng_show
='Show';

848 
$Ïng_šdex
='Index';

849 
$Ïng_’d
='End';

850 
$Ïng_´e
='Previous';

851 
$Ïng_Ãxt
='Next';

855 
$´•age
="";

856 
$Ãxage
="";

857 
$´•ag’um
 = 
$this
->
PageNo
 - 1;

858 
$Ãxag’um
 = 
$this
->
PageNo
 + 1;

859 if(
$li¡_Ën
=="" || 
	`´eg_m©ch
("/[^0-9]/", $list_len))

861 
$li¡_Ën
=3;

863 
$tÙ®·ge
 = 
	`û
(
$this
->
TÙ®ResuÉ
 / $this->
PageSize
);

864 if(
$tÙ®·ge
<=1 && 
$this
->
TÙ®ResuÉ
>0)

866  "$Ïng_tÙ® 1 $Ïng_·ge/".
$this
->
TÙ®ResuÉ
.
$Ïng_»cÜd
;

868 if(
$this
->
TÙ®ResuÉ
 == 0)

870  "$Ïng_tÙ® 0 $Ïng_·ge/".
$this
->
TÙ®ResuÉ
.
$Ïng_»cÜd
;

872 
$pu¾
 = 
$this
->
	`G‘CurU¾
();

876 
$ŞdkeywÜd
 = (
	`em±y
($ŞdkeywÜdè? 
$this
->
KeywÜd
 : $oldkeyword);

879 if(
$this
->
TÙ®ResuÉ
 > $this->
S—rchMaxRc
)

881 
$tÙ®·ge
 = 
	`û
(
$this
->
S—rchMaxRc
/$this->
PageSize
);

883 
$šfos
 = "<li><¥ª cÏss=\"·gešfo\">$Ïng_fšd ".
$this
->
TÙ®ResuÉ
." $lang_record/$lang_show <b>{$totalpage}</b> $lang_page </span></li>\r\n";

884 
$g‘u¾
 = "keywÜd=".
	`u¾’code
(
$ŞdkeywÜd
)."&£¬chty³=".
$this
->
S—rchTy³
;

885 
$hid’fÜm
 = "<špuˆty³='hidd’'‚ame='keywÜd' v®ue='".
	`¿wu¾decode
(
$ŞdkeywÜd
)."'>\r\n";

886 
$g‘u¾
 .ğ"&chªÃÉy³=".
$this
->
ChªÃlTy³
."&Üd”by=".$this->
Ord”By
;

887 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='chªÃÉy³' v®ue='".
$this
->
ChªÃlTy³
."'>\r\n";

888 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='Üd”by' v®ue='".
$this
->
Ord”By
."'>\r\n";

889 
$g‘u¾
 .ğ"&kwty³=".
$this
->
KTy³
."&·gesize=".$this->
PageSize
;

890 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='kwty³' v®ue='".
$this
->
KTy³
."'>\r\n";

891 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='·gesize' v®ue='".
$this
->
PageSize
."'>\r\n";

893 if(
$this
->
Ïng
=='en')

895 
$g‘u¾
 .ğ"&Ïng=".
$this
->
Ïng
;

896 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='Ïng' v®ue='".
$this
->
Ïng
."'>\r\n";

899 if(
$this
->
diy_tmp
!='')

901 
$g‘u¾
 .ğ"&diy_tmp=".
$this
->
diy_tmp
;

902 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='diy_tmp' v®ue='".
$this
->
diy_tmp
."'>\r\n";

906 
$g‘u¾
 .ğ"&ty³id=".
$this
->
Ty³ID
."&TÙ®ResuÉ=".$this->
TÙ®ResuÉ
."&";

907 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='ty³id' v®ue='".
$this
->
Ty³ID
."'>\r\n";

908 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='TÙ®ResuÉ' v®ue='".
$this
->
TÙ®ResuÉ
."'>\r\n";

909 
$pu¾
 .ğ"?".
$g‘u¾
;

912 if(
$this
->
PageNo
 != 1)

914 
$´•age
.="<li><¨h»f='".
$pu¾
."PageNo=$prepagenum'>$lang_pre</a></li>\r\n";

915 
$šdex·ge
="<li><¨h»f='".
$pu¾
."PageNo=1'>$lang_index</a></li>\r\n";

919 
$šdex·ge
="<li><a href='javascript:void(0);'>$lang_index</a></li>\r\n";

921 if(
$this
->
PageNo
!=
$tÙ®·ge
 && $totalpage>1)

923 
$Ãxage
.="<li><¨h»f='".
$pu¾
."PageNo=$nextpagenum'>$lang_next</a></li>\r\n";

924 
$’d·ge
="<li><¨h»f='".
$pu¾
."PageNo=$totalpage'>$lang_end</a></li>\r\n";

928 
$’d·ge
="<li><a href='javascript:void(0);'>$lang_end</a></li>\r\n";

932 
$li¡dd
="";

933 
$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

934 if(
$this
->
PageNo
 >ğ
$tÙ®_li¡
)

936 
$j
 = 
$this
->
PageNo
 - 
$li¡_Ën
;

937 
$tÙ®_li¡
 = 
$this
->
PageNo
 + 
$li¡_Ën
;

938 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

940 
$tÙ®_li¡
 = 
$tÙ®·ge
;

945 
$j
=1;

946 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

948 
$tÙ®_li¡
 = 
$tÙ®·ge
;

951 
$j
; $j<=
$tÙ®_li¡
; $j++)

953 if(
$j
 =ğ
$this
->
PageNo
)

955 
$li¡dd
.= "<li class=\"thisclass\"><a>$j</a></li>\r\n";

959 
$li¡dd
.="<li><¨h»f='".
$pu¾
."PageNo=$j'>".
$j
."</a></li>\r\n";

962 
$¶i¡
 .ğ"<fÜm‚ame='·g–i¡'‡ùiÚ='".
$this
->
	`G‘CurU¾
()."'>$hidenform";

963 
$¶i¡
 .ğ
$šfos
;

964 
$¶i¡
 .ğ
$šdex·ge
;

965 
$¶i¡
 .ğ
$´•age
;

966 
$¶i¡
 .ğ
$li¡dd
;

967 
$¶i¡
 .ğ
$Ãxage
;

968 
$¶i¡
 .ğ
$’d·ge
;

969 if(
$tÙ®·ge
>
$tÙ®_li¡
)

971 
$¶i¡
.="<li><špuˆty³='‹xt'‚ame='PageNo' styË='width:28px;height:14px' v®ue='".
$this
->
PageNo
."' /></li>\r\n";

972 
$¶i¡
.="<li><inputype='submit'‚ame='plistgo' value='GO' style='width:30px;height:22px;font-size:9pt' /></li>\r\n";

974 
$¶i¡
 .= "</form>\r\n";

975  
$¶i¡
;

976 
	}
}

984 
funùiÚ
 
	$G‘CurU¾
()

986 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

988 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

989 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

990 
$nowu¾
 = 
$nowu¾s
[0];

994 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

996  
$nowu¾
;

997 
	}
}

	@E:\web\weixun\functions\arc.sglistview.class.php

1 <?
php
 if(!
defšed
('XAKINC'))
ex™
('Warning...');

8 @
£t_time_lim™
(0);

9 
»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

16 şas 
	cSgLi¡V›w


18 
v¬
 
	m$dsql
;

19 
v¬
 
	m$d
;

20 
v¬
 
	m$d2
;

21 
v¬
 
	m$Ty³ID
;

22 
v¬
 
	m$Ty³Lšk
;

23 
v¬
 
	m$PageNo
;

24 
v¬
 
	m$TÙ®Page
;

25 
v¬
 
	m$TÙ®ResuÉ
;

26 
v¬
 
	m$PageSize
;

27 
v¬
 
	m$ChªÃlUn™
;

28 
v¬
 
	m$Li¡Ty³
;

29 
v¬
 
	m$F›lds
;

30 
v¬
 
	m$P¬tV›w
;

31 
v¬
 
	m$addSql
;

32 
v¬
 
	m$IsE¼Ü
;

33 
v¬
 
	m$CrossID
;

34 
v¬
 
	m$IsR•Ïû
;

35 
v¬
 
	m$AddTabË
;

36 
v¬
 
	m$Li¡F›lds
;

37 
v¬
 
	m$£¬chA¼
;

38 
v¬
 
	m$sAddTabË
;

48 
funùiÚ
 
__cÚ¡ruù
(
$ty³id
,
$£¬chA¼
=
	$¬¿y
())

50 
glob®
 
$dsql
;

51 
$this
->
Ty³ID
 = 
$ty³id
;

52 
$this
->
dsql
 = 
$dsql
;

53 
$this
->
CrossID
 = '';

54 
$this
->
IsR•Ïû
 = 
çl£
;

55 
$this
->
IsE¼Ü
 = 
çl£
;

56 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

57 
$this
->
d
->
	`S‘RefObj
($this);

58 
$this
->
sAddTabË
 = 
çl£
;

59 
$this
->
d
->
	`S‘NameS·û
("xak","{","}");

60 
$this
->
d2
 = 
Ãw
 
	`XakTagP¬£
();

61 
$this
->
d2
->
	`S‘NameS·û
("field","[","]");

62 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(
$ty³id
);

63 
$this
->
£¬chA¼
 = 
$£¬chA¼
;

64 if(!
	`is_¬¿y
(
$this
->
Ty³Lšk
->
Ty³Infos
))

66 
$this
->
IsE¼Ü
 = 
Œue
;

68 if(!
$this
->
IsE¼Ü
)

70 
$this
->
ChªÃlUn™
 = 
Ãw
 
	`ChªÃlUn™
($this->
Ty³Lšk
->
Ty³Infos
['channeltype']);

71 
$this
->
F›lds
 = $this->
Ty³Lšk
->
Ty³Infos
;

72 
$this
->
F›lds
['id'] = 
$ty³id
;

73 
$this
->
F›lds
['pos™iÚ'] = $this->
Ty³Lšk
->
	`G‘Pos™iÚLšk
(
Œue
);

74 
$this
->
F›lds
['t™Ë'] = 
	`´eg_»¶aû
("/[<>]/", " / ", $this->
Ty³Lšk
->
	`G‘Pos™iÚLšk
(
çl£
));

77 
$this
->
AddTabË
 = $this->
ChªÃlUn™
->
ChªÃlInfos
['addtable'];

78 
$li¡f›ld
 = 
	`Œim
(
$this
->
ChªÃlUn™
->
ChªÃlInfos
['listfields']);

80 
$this
->
Li¡F›lds
 = 
	`ex¶ode
(',', 
$li¡f›ld
);

83 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
è
$this
->
F›lds
[$k] = $v;

84 
$this
->
F›lds
['rs¦šk'] = 
$GLOBALS
['cfg_cmsu¾']."/cÚfig/rss/".$this->
Ty³ID
.".xml";

87 
	`S‘SysEnv
(
$this
->
Ty³ID
,$this->
F›lds
['typename'],0,'','list');

88 
$this
->
F›lds
['ty³id'] = $this->
Ty³ID
;

91 if(
$this
->
Ty³Lšk
->
Ty³Infos
['cross']>0 && $this->TypeLink->TypeInfos['ispart']==0)

93 
$£lqu”y
 = '';

94 if(
$this
->
Ty³Lšk
->
Ty³Infos
['cross']==1)

96 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHEREypename LIKE '{$this->Fields['typename']}' AND id<>'{$this->TypeID}' ANDopid<>'{$this->TypeID}' ";

100 
$this
->
F›lds
['üossid'] = 
	`´eg_»¶aû
("/[^0-9,]/", '', 
	`Œim
($this->Fields['crossid']));

101 if(
$this
->
F›lds
['crossid']!='')

103 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHERE id IN({$this->Fields['crossid']}) AND id<>{$this->TypeID} ANDopid<>{$this->TypeID} ";

106 if(
$£lqu”y
!='')

108 
$this
->
dsql
->
	`S‘Qu”y
(
$£lqu”y
);

109 
$this
->
dsql
->
	`Execu‹
();

110 
$¬r
 = 
$this
->
dsql
->
	`G‘A¼ay
())

112 
$this
->
CrossID
 .ğ($this->CrossID=='' ? 
$¬r
['id'] : ','.$arr['id']);

122 
funùiÚ
 
	`SgLi¡V›w
(
$ty³id
,
$£¬chA¼
=
	$¬¿y
()){

123 
$this
->
	`__cÚ¡ruù
(
$ty³id
,
$£¬chA¼
);

124 
	}
}

126 
funùiÚ
 
	$Clo£
()

129 
	}
}

137 
funùiÚ
 
	$CouÁRecÜd
()

139 
glob®
 
$cfg_li¡_sÚ
;

142 
$this
->
TÙ®ResuÉ
 = -1;

143 if(
	`is£t
(
$GLOBALS
['TÙ®ResuÉ'])è
$this
->
TÙ®ResuÉ
 = $GLOBALS['TotalResult'];

144 if(
	`is£t
(
$GLOBALS
['PageNo'])è
$this
->
PageNo
 = $GLOBALS['PageNo'];

145 
$this
->
PageNo
 = 1;

146 
$this
->
addSql
 = "‡rc.arcrank > -1 ";

149 if(!
	`em±y
(
$this
->
Ty³ID
))

151 if(
$cfg_li¡_sÚ
=='N')

153 if(
$this
->
CrossID
==''è$this->
addSql
 .ğ" AND (¬c.ty³id='".$this->
Ty³ID
."') ";

154 
$this
->
addSql
 .= " AND (arc.typeid IN({$this->CrossID},{$this->TypeID})) ";

158 if(
$this
->
CrossID
==''è$this->
addSql
 .ğ" AND (¬c.ty³id IN (".
	`G‘SÚIds
($this->
Ty³ID
,$this->
F›lds
['channeltype']).") ) ";

159 
$this
->
addSql
 .ğ" AND (¬c.ty³id IN (".
	`G‘SÚIds
($this->
Ty³ID
,$this->
F›lds
['channeltype']).",{$this->CrossID}) ) ";

163 
$ÇddQu”y
 = '';

165 if(
	`couÁ
(
$this
->
£¬chA¼
) > 0)

167 if(!
	`em±y
(
$this
->
£¬chA¼
['nativeplace']))

169 if(
$this
->
£¬chA¼
['nativeplace'] % 500 ==0 )

171 
$ÇddQu”y
 .ğ" AND‡rc.Çtiv•Ïû >ğ'{$this->£¬chA¼['Çtiv•Ïû']}' AND‡rc.Çtiv•Ïû < '".(
$this
->
£¬chA¼
['nativeplace']+500)."'";

175 
$ÇddQu”y
 .= "AND‡rc.nativeplace = '{$this->searchArr['nativeplace']}'";

178 if(!
	`em±y
(
$this
->
£¬chA¼
['infotype']))

180 if(
$this
->
£¬chA¼
['infotype'] % 500 ==0 )

182 
$ÇddQu”y
 .ğ" AND‡rc.šfÙy³ >ğ'{$this->£¬chA¼['šfÙy³']}' AND‡rc.šfÙy³ < '".(
$this
->
£¬chA¼
['infotype']+500)."'";

186 
$ÇddQu”y
 .= "AND‡rc.infotype = '{$this->searchArr['infotype']}'";

189 if(!
	`em±y
(
$this
->
£¬chA¼
['keyword']))

191 
$ÇddQu”y
 .= "AND‡rc.title†ike '%{$this->searchArr['keyword']}%' ";

195 if(
$ÇddQu”y
!='')

197 
$this
->
sAddTabË
 = 
Œue
;

198 
$this
->
addSql
 .ğ
$ÇddQu”y
;

201 if(
$this
->
TÙ®ResuÉ
==-1)

203 if(
$this
->
sAddTabË
)

205 
$cqu”y
 = "SELECT COUNT(*èAS dd FROM `{$this->AddTabË}`‡røWHERE ".
$this
->
addSql
;

209 
$cqu”y
 = "SELECT COUNT(*èAS dd FROM `#@__¬ùšy`‡røWHERE ".
$this
->
addSql
;

211 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
(
$cqu”y
);

212 if(
	`is_¬¿y
(
$row
))

214 
$this
->
TÙ®ResuÉ
 = 
$row
['dd'];

218 
$this
->
TÙ®ResuÉ
 = 0;

222 
$‹mpfe
 = 
$GLOBALS
['cfg_ba£dœ'].$GLOBALS['cfg_‹m¶‘s_dœ']."/".
$this
->
Ty³Lšk
->
Ty³Infos
['templist'];

223 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
Ty³ID
,$tempfile);

224 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

225 if(!
	`fe_exi¡s
(
$‹mpfe
))

227 
$‹mpfe
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir']."/".$GLOBALS['cfg_df_style']."/list_default_sg.htm";

229 if(!
	`fe_exi¡s
(
$‹mpfe
)||!
	`is_fe
($tempfile))

231 
echo
 "æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è§£ææ–‡æ¡£ï¼";

232 
	`ex™
();

234 
$this
->
d
->
	`LßdTem¶©e
(
$‹mpfe
);

235 
$ùag
 = 
$this
->
d
->
	`G‘Tag
("page");

236 if(!
	`is_objeù
(
$ùag
))

238 
$ùag
 = 
$this
->
d
->
	`G‘Tag
("list");

240 if(!
	`is_objeù
(
$ùag
))

242 
$this
->
PageSize
 = 20;

246 if(
$ùag
->
	`G‘A‰
('pagesize')!='')

248 
$this
->
PageSize
 = 
$ùag
->
	`G‘A‰
('pagesize');

252 
$this
->
PageSize
 = 20;

255 
$this
->
TÙ®Page
 = 
	`û
($this->
TÙ®ResuÉ
/$this->
PageSize
);

256 
	}
}

266 
funùiÚ
 
	$MakeHtml
(
$¡¬age
=1,
$mak•agesize
=0)

268 if(
	`em±y
(
$¡¬age
))

270 
$¡¬age
 = 1;

274 if(
$this
->
Ty³Lšk
->
Ty³Infos
['isdefault']==-1)

276 
echo
 'è¿™ä¸ªç±»ç›®æ˜¯åŠ¨æ€ç±»ç›®ï¼';

280 if(
$this
->
Ty³Lšk
->
Ty³Infos
['isdefault']==2)

282 
echo
 'è¿™ä¸ªç±»ç›®é“¾æ¥åˆ°ç¬¬ä¸€ä¸ªå­åˆ†ç±»ï¼';

283  '../moduË/li¡.php?tid='.
$this
->
Ty³Lšk
->
Ty³Infos
['id'];

286 if(
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']>0)

288 
$»u¾
 = 
$this
->
	`MakeP¬tTem¶‘s
();

289  
$»u¾
;

292 
$this
->
	`CouÁRecÜd
();

294 
$this
->
	`P¬£Tem¶‘sFœ¡
();

295 
$tÙ®·ge
 = 
	`û
(
$this
->
TÙ®ResuÉ
/$this->
PageSize
);

296 if(
$tÙ®·ge
==0)

298 
$tÙ®·ge
 = 1;

300 
	`C»©eDœ
(
	`MfTy³dœ
(
$this
->
F›lds
['typedir']));

301 
$mu¾
 = '';

302 if(
$mak•agesize
 > 0)

304 
$’d·ge
 = 
$¡¬age
+
$mak•agesize
;

308 
$’d·ge
 = (
$tÙ®·ge
+1);

310 ifĞ
$’d·ge
 >ğ
$tÙ®·ge
+1 )

312 
$’d·ge
 = 
$tÙ®·ge
+1;

314 if(
$’d·ge
==1)

316 
$’d·ge
 = 2;

318 
$this
->
PageNo
=
$¡¬age
; $this->PageNØ< 
$’d·ge
; $this->PageNo++)

320 
$this
->
	`P¬£DMF›lds
($this->
PageNo
,1);

321 
$makeFe
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],'list',$this->Fields['typedir'],'',$this->Fields['namerule2']);

322 
$makeFe
 = 
	`¡r_»¶aû
("{·ge}",
$this
->
PageNo
,$makeFile);

323 
$mu¾
 = 
$makeFe
;

324 if(!
	`´eg_m©ch
("/^\//",
$makeFe
))

326 
$makeFe
 = "/".$makeFile;

328 
$makeFe
 = 
$this
->
	`G‘TrueP©h
().$makeFile;

329 
$makeFe
 = 
	`´eg_»¶aû
("/\/{1,}/", "/", $makeFile);

330 
$mu¾
 = 
$this
->
	`G‘TrueU¾
($murl);

331 
$this
->
d
->
	`SaveTo
(
$makeFe
);

333 if(
$¡¬age
==1)

336 if(
$this
->
Ty³Lšk
->
Ty³Infos
['isdefault']==1

337 && 
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']==0)

339 
$ÚlyruË
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],"list",$this->Fields['typedir'],'',$this->Fields['namerule2']);

340 
$ÚlyruË
 = 
	`¡r_»¶aû
("{page}","1",$onlyrule);

341 
$li¡_1
 = 
$this
->
	`G‘TrueP©h
().
$ÚlyruË
;

342 
$mu¾
 = 
	`MfTy³dœ
(
$this
->
F›lds
['typedir']).'/'.$this->Fields['defaultname'];

343 
$šdexÇme
 = 
$this
->
	`G‘TrueP©h
().
$mu¾
;

344 
	`cİy
(
$li¡_1
,
$šdexÇme
);

347  
$mu¾
;

348 
	}
}

356 
funùiÚ
 
	$Di¥Ïy
()

358 if(
$this
->
Ty³Lšk
->
Ty³Infos
['i¥¬t']>0 && 
	`couÁ
($this->
£¬chA¼
)==0 )

360 
$this
->
	`Di¥ÏyP¬tTem¶‘s
();

363 
$this
->
	`CouÁRecÜd
();

378 
$this
->
	`P¬£Tem¶‘sFœ¡
();

379 
$this
->
	`P¬£DMF›lds
($this->
PageNo
,0);

380 
$this
->
d
->
	`Di¥Ïy
();

381 
	}
}

389 
funùiÚ
 
	$MakeP¬tTem¶‘s
()

391 
$this
->
P¬tV›w
 = 
Ãw
 
	`P¬tV›w
($this->
Ty³ID
,
çl£
);

392 
$this
->
P¬tV›w
->
	`S‘Ty³Lšk
($this->
Ty³Lšk
);

393 
$nmç
 = 0;

394 
$tmpdœ
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir'];

395 if(
$this
->
F›lds
['ispart']==1)

397 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
Ty³ID
,$this->
F›lds
['tempindex']);

398 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

399 
$‹mpfe
 = 
$tmpdœ
."/".$tempfile;

400 if(!
	`fe_exi¡s
(
$‹mpfe
))

402 
$‹mpfe
 = 
$tmpdœ
."/".
$GLOBALS
['cfg_df_style']."/index_default_sg.htm";

404 
$this
->
P¬tV›w
->
	`S‘Tem¶‘
(
$‹mpfe
);

406 if(
$this
->
F›lds
['ispart']==2)

409  
$this
->
F›lds
['typedir'];

411 
	`C»©eDœ
(
	`MfTy³dœ
(
$this
->
F›lds
['typedir']));

412 
$makeU¾
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],"šdex",
	`MfTy³dœ
($this->Fields['typedir']),$this->Fields['defaultname'],$this->Fields['namerule2']);

413 
$makeU¾
 = 
	`´eg_»¶aû
("/\/{1,}/", "/", $makeUrl);

414 
$makeFe
 = 
$this
->
	`G‘TrueP©h
().
$makeU¾
;

415 if(
$nmç
==0)

417 
$this
->
P¬tV›w
->
	`SaveToHtml
(
$makeFe
);

421 if(!
	`fe_exi¡s
(
$makeFe
))

423 
$this
->
P¬tV›w
->
	`SaveToHtml
(
$makeFe
);

426  
$this
->
	`G‘TrueU¾
(
$makeU¾
);

427 
	}
}

435 
funùiÚ
 
	$Di¥ÏyP¬tTem¶‘s
()

437 
$this
->
P¬tV›w
 = 
Ãw
 
	`P¬tV›w
($this->
Ty³ID
,
çl£
);

438 
$this
->
P¬tV›w
->
	`S‘Ty³Lšk
($this->
Ty³Lšk
);

439 
$nmç
 = 0;

440 
$tmpdœ
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir'];

441 if(
$this
->
F›lds
['ispart']==1)

444 
$‹mpfe
 = 
	`¡r_»¶aû
("{tid}",
$this
->
Ty³ID
,$this->
F›lds
['tempindex']);

445 
$‹mpfe
 = 
	`¡r_»¶aû
("{cid}",
$this
->
ChªÃlUn™
->
ChªÃlInfos
['nid'],$tempfile);

446 
$‹mpfe
 = 
$tmpdœ
."/".$tempfile;

447 if(!
	`fe_exi¡s
(
$‹mpfe
))

449 
$‹mpfe
 = 
$tmpdœ
."/".
$GLOBALS
['cfg_df_style']."/index_default_sg.htm";

451 
$this
->
P¬tV›w
->
	`S‘Tem¶‘
(
$‹mpfe
);

453 if(
$this
->
F›lds
['ispart']==2)

456 
$gÙou¾
 = 
$this
->
F›lds
['typedir'];

457 
	`h—d”
("Location:$gotourl");

458 
	`ex™
();

460 
	`C»©eDœ
(
	`MfTy³dœ
(
$this
->
F›lds
['typedir']));

461 
$makeU¾
 = 
$this
->
	`G‘MakeFeRuË
($this->
F›lds
['id'],"šdex",
	`MfTy³dœ
($this->Fields['typedir']),$this->Fields['defaultname'],$this->Fields['namerule2']);

462 
$makeFe
 = 
$this
->
	`G‘TrueP©h
().
$makeU¾
;

463 if(
$nmç
==0)

465 
$this
->
P¬tV›w
->
	`Di¥Ïy
();

469 if(!
	`fe_exi¡s
(
$makeFe
))

471 
$this
->
P¬tV›w
->
	`Di¥Ïy
();

475 
	`šşude
(
$makeFe
);

478 
	}
}

486 
funùiÚ
 
	$G‘TrueP©h
()

488 
$Œu•©h
 = 
$GLOBALS
["cfg_basedir"];

489  
$Œu•©h
;

490 
	}
}

499 
funùiÚ
 
	$G‘TrueU¾
(
$nu¾
)

501 if(
	`´eg_m©ch
("/^h‰p:\/\//", 
$nu¾
))  $nurl;

502 if(
$this
->
F›lds
['moresite']==1)

504 if(
$this
->
F›lds
['sitepath']!='')

506 
$nu¾
 = 
	`´eg_»¶aû
("/^".
$this
->
F›lds
['sitepath']."/", '', $nurl);

508 
$nu¾
 = 
$this
->
F›lds
['siteurl'].$nurl;

510  
$nu¾
;

511 
	}
}

519 
funùiÚ
 
	$P¬£Tem¶‘sFœ¡
()

521 if(
	`is£t
(
$this
->
Ty³Lšk
->
Ty³Infos
['reid']))

523 
$GLOBALS
['’vs']['»id'] = 
$this
->
Ty³Lšk
->
Ty³Infos
['reid'];

525 
$GLOBALS
['’vs']['chªÃlid'] = 
$this
->
Ty³Lšk
->
Ty³Infos
['channeltype'];

526 
$GLOBALS
['’vs']['ty³id'] = 
$this
->
Ty³ID
;

527 
$GLOBALS
['envs']['cross'] = 1;

528 
	`MakeOÃTag
(
$this
->
d
,$this);

529 
	}
}

539 
funùiÚ
 
	$P¬£DMF›lds
(
$PageNo
, 
$ismake
=1)

542 if((
$PageNo
>1 || 
	`¡¾’
(
$this
->
F›lds
['cÚ‹Á'])<10 ) && !$this->
IsR•Ïû
)

544 
$this
->
d
->
SourûSŒšg
 = 
	`¡r_»¶aû
('[cmsreplace]','display:none',$this->dtp->SourceString);

545 
$this
->
IsR•Ïû
 = 
Œue
;

547 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$gid
=>
$ùag
)

549 if(
$ùag
->
	`G‘Name
()=="list")

551 
$lim™¡¬t
 = (
$this
->
PageNo
-1è* $this->
PageSize
;

552 
$row
 = 
$this
->
PageSize
;

553 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())=="")

555 
$IÂ”Text
 = 
	`G‘SysTem¶‘s
("list_fulllist.htm");

559 
$IÂ”Text
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

561 
$this
->
d
->
	`Assign
(
$gid
,

562 
$this
->
	`G‘ArcLi¡
(

563 
$lim™¡¬t
,

564 
$row
,

565 
$ùag
->
	`G‘A‰
("col"),

566 
$ùag
->
	`G‘A‰
("titlelen"),

567 
$ùag
->
	`G‘A‰
("listtype"),

568 
$ùag
->
	`G‘A‰
("orderby"),

569 
$IÂ”Text
,

570 
$ùag
->
	`G‘A‰
("tablewidth"),

571 
$ismake
,

572 
$ùag
->
	`G‘A‰
("orderway")

576 if(
$ùag
->
	`G‘Name
()=="pagelist")

578 
$li¡_Ën
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("listsize"));

579 
$ùag
->
	`G‘A‰
("li¡™em")=="" ? 
$li¡™em
="index,pre,pageno,next,end,option" : $listitem=$ctag->GetAtt("listitem");

580 if(
$li¡_Ën
=="")

582 
$li¡_Ën
 = 3;

584 if(
$ismake
==0)

586 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
));

590 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡ST
(
$li¡_Ën
,
$li¡™em
));

593 if(
$PageNo
!=1 && 
$ùag
->
	`G‘Name
()=='f›ld' && $ùag->
	`G‘A‰
('display')!='')

595 
$this
->
d
->
	`Assign
(
$gid
,'');

598 
	}
}

611 
funùiÚ
 
	$G‘MakeFeRuË
(
$ty³id
,
$wÇme
,
$ty³dœ
,
$deçuÉÇme
,
$Çm”uË2
)

613 
$ty³dœ
 = 
	`MfTy³dœ
($typedir);

614 if(
$wÇme
=='index')

616  
$ty³dœ
.'/'.
$deçuÉÇme
;

620 
$Çm”uË2
 = 
	`¡r_»¶aû
('{tid}',
$ty³id
,$namerule2);

621 
$Çm”uË2
 = 
	`¡r_»¶aû
('{ty³dœ}',
$ty³dœ
,$namerule2);

622  
$Çm”uË2
;

624 
	}
}

645 
funùiÚ
 
G‘ArcLi¡
(
$lim™¡¬t
=0,
$row
=10,
$cŞ
=1,
$t™ËËn
=30,
$li¡ty³
="®l",
$Üd”by
="deçuÉ",
$šÃ¹ext
="",
$bËwidth
="100",
$ismake
=1,
$Üd”Way
='desc')

647 
glob®
 
$cfg_li¡_sÚ
;

648 
	g$ty³id
=
$this
->
Ty³ID
;

650 if(
	g$row
==''è
$row
 = 10;

652 if(
	g$lim™¡¬t
==''è
$lim™¡¬t
 = 0;

654 if(
	g$t™ËËn
==''è
$t™ËËn
 = 100;

656 if(
	g$li¡ty³
==''è
$li¡ty³
 = "all";

658 if(
	g$Üd”by
==''è
$Üd”by
='id';

659 
	g$Üd”by
=
¡¹Şow”
(
$Üd”by
);

661 if(
	g$Üd”Way
==''è
$Üd”Way
 = 'desc';

663 
	g$bËwidth
 = 
¡r_»¶aû
("%", "", 
$bËwidth
);

664 if(
	g$bËwidth
==''è
$bËwidth
=100;

665 if(
	g$cŞ
==''è
$cŞ
=1;

666 
	g$cŞWidth
 = 
û
(100 / 
$cŞ
);

667 
	g$bËwidth
 = 
$bËwidth
."%";

668 
	g$cŞWidth
 = 
$cŞWidth
."%";

670 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

671 if(
	g$šÃ¹ext
==''è
$šÃ¹ext
 = 
G‘SysTem¶‘s
('list_sglist.htm');

674 
	g$Üd”sql
 = '';

675 if(
	g$Üd”by
=='£ndd©e'||
$Üd”by
=='id')

677 
$Üd”sql
=" ORDER BY‡rc.aid $orderWay";

679 if(
	g$Üd”by
=='hÙ'||
$Üd”by
=='click')

681 
$Üd”sql
 = " ORDER BY‡rc.click $orderWay";

685 
	g$Üd”sql
=" ORDER BY‡rc.aid $orderWay";

688 
	g$addF›ld
 = '¬c.'.
još
(',¬c.',
$this
->
Li¡F›lds
);

691 if(
´eg_m©ch
('/hÙ|şick/', 
$Üd”by
è|| 
	g$this
->
	gsAddTabË
)

693 
	g$qu”y
 = "SELECTp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,

694 

.
i¥¬t
,
	g
.
	gmÜes™e
,.
	gs™eu¾
,.
	gs™•©h
,
	g¬c
.
	gaid
,¬c.
aid
 
AS
 
	gid
,¬c.
	gty³id
,

695 
$addF›ld


696 
	gFROM
 `{
	g$this
->
	gAddTabË
}` 
¬c


697 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g¬c
.
	gty³id
ñp.
id


698 
WHERE
 {
$this
->
addSql
} 
$Üd”sql
 
LIMIT
 
$lim™¡¬t
,
	g$row
";

703 
	g$t1
 = 
ExecTime
();

704 
	g$ids
 = 
¬¿y
();

705 
	g$nÜd”sql
 = 
¡r_»¶aû
('.aid','.id',
$Üd”sql
);

706 
	g$qu”y
 = "SELECT id From `#@__arctiny`‡rc WHERE {$this->addSql} $nordersql LIMIT $limitstart,$row ";

708 
	g$this
->
	gdsql
->
S‘Qu”y
(
$qu”y
);

709 
	g$this
->
	gdsql
->
Execu‹
();

710 
	g$¬r
=
$this
->
dsql
->
G‘A¼ay
())

712 
$ids
[] = 
$¬r
['id'];

714 
	g$id¡r
 = 
još
(',',
$ids
);

715 if(
	g$id¡r
=='')

721 
	g$qu”y
 = "SELECTp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,

722 

.
i¥¬t
,
	g
.
	gmÜes™e
,.
	gs™eu¾
,.
	gs™•©h
,
	g¬c
.
	gaid
,¬c.
aid
 
AS
 
	gid
,¬c.
	gty³id
,

723 
$addF›ld


724 
	gFROM
 `{
	g$this
->
	gAddTabË
}` 
¬c
 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g¬c
.
	gty³id
ñp.
id


725 
WHERE
 
¬c
.
aid
 
IN
(
$id¡r
è
AND
‡rc.
¬üªk
 >-1 
$Üd”sql
 ";

727 
	g$t2
 = 
ExecTime
();

731 
	g$this
->
	gdsql
->
S‘Qu”y
(
$qu”y
);

732 
	g$this
->
	gdsql
->
Execu‹
('al');

733 
	g$t2
 = 
ExecTime
();

736 
	g$¬i¡
 = '';

737 
	g$this
->
	gd2
->
LßdSourû
(
$šÃ¹ext
);

738 
	g$GLOBALS
['autoindex'] = 0;

739 
	g$i
=0;$i<
	g$row
;$i++)

741 if(
	g$cŞ
>1)

743 
	g$¬i¡
 .= "<div>\r\n";

745 
	g$j
=0;$j<
	g$cŞ
;$j++)

747 if(
	g$row
 = 
$this
->
dsql
->
G‘A¼ay
("al"))

749 
$GLOBALS
['autoindex']++;

750 
	g$ids
[
$row
['aid']] = $row['id']= $row['aid'];

753 
	g$row
['ismake'] = 1;

754 
	g$row
['money'] = 0;

755 
	g$row
['arcrank'] = 0;

756 
	g$row
['filename'] = '';

757 
	g$row
['f’ame'] = 
$row
['¬cu¾'] = 
G‘FeU¾
($row['id'],$row['typeid'],$row['senddate'],$row['title'],$row['ismake'],

758 
$row
['arcrank'],$row['namerule'],$row['typedir'],$row['money'],$row['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

760 
	g$row
['ty³u¾'] = 
G‘Ty³U¾
(
$row
['ty³id'],
MfTy³dœ
($row['typedir']),$row['isdefault'],$row['defaultname'],

761 
$row
['ispart'],$row['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

762 if(
	g$row
['l™pic'] =ğ'-' || 
$row
['litpic'] == '')

764 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

766 if(!
´eg_m©ch
("/^h‰p:\/\//", 
$row
['l™pic']è&& 
	g$GLOBALS
['cfg_multi_site'] == 'Y')

768 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

770 
	g$row
['piúame'] = 
$row
['litpic'];

772 
	g$row
['pubd©e'] = 
$row
['senddate'];

774 
	g$row
['¡ime'] = 
G‘D©eMK
(
$row
['pubdate']);

776 
	g$row
['ty³lšk'] = "<¨h»f='".
$row
['typeurl']."'>".$row['typename']."</a>";

778 
	g$row
['fuÎt™Ë'] = 
$row
['title'];

780 
	g$row
['t™Ë'] = 
ú_sub¡r
(
$row
['t™Ë'],
$t™ËËn
);

782 if(
´eg_m©ch
('/b/', 
$row
['flag']))

784 
	g$row
['t™Ë'] = "<b>".
$row
['title']."</b>";

787 
	g$row
['‹xšk'] = "<¨h»f='".
$row
['filename']."'>".$row['title']."</a>";

789 
	g$row
['¶usu¾'] = 
$row
['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

791 
	g$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

793 
	g$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

796 
fÜ—ch
(
$row
 
as
 
$k
=>
$v
è$row[
¡¹Şow”
($k)] = $v;

798 
fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$¬r
)

800 if(
is£t
(
$row
[
$k
]))

802 
$row
[
$k
] = 
$this
->
ChªÃlUn™
->
MakeF›ld
($k,$row[$k]);

806 if(
is_¬¿y
(
$this
->
d2
->
CTags
))

808 
fÜ—ch
(
$this
->
d2
->
CTags
 
as
 
$k
=>
$ùag
)

810 if(
$ùag
->
G‘Name
()=='array')

813 
$this
->
d2
->
Assign
(
$k
,
$row
);

817 if(
is£t
(
$row
[
$ùag
->
G‘Name
()]))

819 
	g$this
->
	gd2
->
Assign
(
$k
,
$row
[
$ùag
->
G‘Name
()]);

823 
	g$this
->
	gd2
->
Assign
(
$k
,'');

828 
	g$¬i¡
 .ğ
$this
->
d2
->
G‘ResuÉ
();

833 if(
	g$cŞ
>1)

835 
	g$i
 +ğ
$cŞ
 - 1;

836 
	g$¬i¡
 .= " </div>\r\n";

840 
	g$t3
 = 
ExecTime
();

843 
	g$this
->
	gdsql
->
F»eResuÉ
('al');

844  
	g$¬i¡
;

855 
funùiÚ
 
G‘PageLi¡ST
(
$li¡_Ën
,
$li¡™em
="index,end,pre,next,pageno")

857 
$´•age
="";

858 
	g$Ãxage
="";

859 
	g$´•ag’um
 = 
$this
->
PageNo
-1;

860 
	g$Ãxag’um
 = 
$this
->
PageNo
+1;

861 if(
	g$li¡_Ën
=="" || 
´eg_m©ch
("/[^0-9]/", 
$li¡_Ën
))

863 
	g$li¡_Ën
=3;

865 
	g$tÙ®·ge
 = 
û
(
$this
->
TÙ®ResuÉ
 / $this->
PageSize
);

866 if(
	g$tÙ®·ge
 <ğ1 && 
$this
->
TÙ®ResuÉ
 > 0)

868  "<¥ª cÏss=\"·gešfo\">å…± <¡rÚg>1</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡è®°å½•</span>";

870 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

872  "<¥ª cÏss=\"·gešfo\">å…± <¡rÚg>0</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡è®°å½•</span>";

874 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

875 
	g$maššfo
 = "<¥ª cÏss=\"·gešfo\">å…± <¡rÚg>{$tÙ®·ge}</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡</span>";

876 
	g$Šam”uË
 = 
$this
->
G‘MakeFeRuË
($this->
F›lds
['id'], "list", $this->Fields['typedir'], $this->Fields['defaultname'], $this->Fields['namerule2']);

877 
	g$Šam”uË
 = 
´eg_»¶aû
("/^(.*)\//", '', 
$Šam”uË
);

880 if(
	g$this
->
	gPageNo
 != 1)

882 
$´•age
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}", 
$´•ag’um
, 
$Šam”uË
)."'>ä¸Šä¸€é¡µ</a></li>\r\n";

883 
	g$šdex·ge
="<li><¨h»f='".
¡r_»¶aû
("{·ge}", 1, 
$Šam”uË
)."'>é¦–é¡µ</a></li>\r\n";

887 
	g$šdex·ge
="<li>é¦–é¡µ</li>\r\n";

891 if(
	g$this
->
	gPageNo
 !ğ
$tÙ®·ge
 && $totalpage>1)

893 
$Ãxage
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}", 
$Ãxag’um
, 
$Šam”uË
)."'>ä¸‹ä¸€é¡µ</a></li>\r\n";

894 
	g$’d·ge
="<li><¨h»f='".
¡r_»¶aû
("{·ge}", 
$tÙ®·ge
, 
$Šam”uË
)."'>æœ«é¡µ</a></li>\r\n";

898 
	g$’d·ge
="<li>æœ«é¡µ</li>";

902 
	g$İtiÚli¡
 = "";

922 
	g$li¡dd
 = "";

923 
	g$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

924 if(
	g$this
->
	gPageNo
 >ğ
$tÙ®_li¡
)

926 
$j
 = 
$this
->
PageNo
 - 
$li¡_Ën
;

927 
	g$tÙ®_li¡
 = 
$this
->
PageNo
 + 
$li¡_Ën
;

928 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

930 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

935 
	g$j
=1;

936 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

938 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

941 
	g$j
; $j <ğ
$tÙ®_li¡
; $j++)

943 if(
	g$j
 =ğ
$this
->
PageNo
)

945 
$li¡dd
.= "<li class=\"thisclass\">$j</li>\r\n";

949 
	g$li¡dd
.="<li><¨h»f='".
¡r_»¶aû
("{·ge}", 
$j
, 
$Šam”uË
)."'>".
	g$j
."</a></li>\r\n";

952 
	g$¶i¡
 = "";

953 if(
´eg_m©ch
('/šfo/i', 
$li¡™em
))

955 
	g$¶i¡
 .ğ
$maššfo
.' ';

957 if(
´eg_m©ch
('/šdex/i', 
$li¡™em
))

959 
	g$¶i¡
 .ğ
$šdex·ge
.' ';

961 if(
´eg_m©ch
('/´e/i', 
$li¡™em
))

963 
	g$¶i¡
 .ğ
$´•age
.' ';

965 if(
´eg_m©ch
('/·g’o/i', 
$li¡™em
))

967 
	g$¶i¡
 .ğ
$li¡dd
.' ';

969 if(
´eg_m©ch
('/Ãxt/i', 
$li¡™em
))

971 
	g$¶i¡
 .ğ
$Ãxage
.' ';

973 if(
´eg_m©ch
('/’d/i', 
$li¡™em
))

975 
	g$¶i¡
 .ğ
$’d·ge
.' ';

977 if(
´eg_m©ch
('/İtiÚ/i', 
$li¡™em
))

979 
	g$¶i¡
 .ğ
$İtiÚli¡
;

981  
	g$¶i¡
;

992 
funùiÚ
 
G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
="index,end,pre,next,pageno")

994 
glob®
 
$Çtiv•Ïû
,
$šfÙy³
,
$keywÜd
;

995 if(
em±y
(
$Çtiv•Ïû
)è
	g$Çtiv•Ïû
 = 0;

996 if(
em±y
(
$šfÙy³
)è
	g$šfÙy³
 = 0;

997 if(
em±y
(
$keywÜd
)è
	g$keywÜd
 = '';

998 
	g$´•age
 = 
$Ãxage
 = '';

999 
	g$´•ag’um
 = 
$this
->
PageNo
 - 1;

1000 
	g$Ãxag’um
 = 
$this
->
PageNo
 + 1;

1001 if(
	g$li¡_Ën
=="" || 
´eg_m©ch
("/[^0-9]/", 
$li¡_Ën
))

1003 
	g$li¡_Ën
=3;

1005 
	g$tÙ®·ge
 = 
û
(
$this
->
TÙ®ResuÉ
 / $this->
PageSize
);

1006 if(
	g$tÙ®·ge
<=1 && 
$this
->
TÙ®ResuÉ
>0)

1008  "<¥ª cÏss=\"·gešfo\">å…±1é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•</span>";

1010 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

1012  "<¥ª cÏss=\"·gešfo\">å…±0é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•</span>";

1014 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

1015 
	g$g‘u¾
 = "tid=".
$this
->
Ty³ID
."&TÙ®ResuÉ=".$this->
TÙ®ResuÉ
."&Çtiv•Ïû=$Çtiv•Ïû&šfÙy³=$šfÙy³&keywÜd=".
u¾’code
(
$keywÜd
)."&";

1016 
	g$hid’fÜm
 = "<špuˆty³='hidd’'‚ame='tid' v®ue='".
$this
->
Ty³ID
."' />\r\n";

1017 
	g$hid’fÜm
 = "<inputype='hidden'‚ame='nativeplace' value='$nativeplace' />\r\n";

1018 
	g$hid’fÜm
 = "<inputype='hidden'‚ame='infotype' value='$infotype' />\r\n";

1019 
	g$hid’fÜm
 = "<inputype='hidden'‚ame='keyword' value='$keyword' />\r\n";

1020 
	g$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='TÙ®ResuÉ' v®ue='".
$this
->
TÙ®ResuÉ
."' />\r\n";

1021 
	g$pu¾
 .ğ"?".
$g‘u¾
;

1024 if(
	g$this
->
	gPageNo
 != 1)

1026 
$´•age
.="<li><¨h»f='".
$pu¾
."PageNo=$prepagenum'>ä¸Šä¸€é¡µ</a></li>\r\n";

1027 
	g$šdex·ge
="<li><¨h»f='".
$pu¾
."PageNo=1'>é¦–é¡µ</a></li>\r\n";

1031 
	g$šdex·ge
="<li><a>é¦–é¡µ</a></li>\r\n";

1033 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

1035 
$Ãxage
.="<li><¨h»f='".
$pu¾
."PageNo=$nextpagenum'>ä¸‹ä¸€é¡µ</a></li>\r\n";

1036 
	g$’d·ge
="<li><¨h»f='".
$pu¾
."PageNo=$totalpage'>æœ«é¡µ</a></li>\r\n";

1040 
	g$’d·ge
="<li><a>æœ«é¡µ</a></li>";

1044 
	g$li¡dd
="";

1045 
	g$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

1046 if(
	g$this
->
	gPageNo
 >ğ
$tÙ®_li¡
)

1048 
$j
 = 
$this
->
PageNo
 - 
$li¡_Ën
;

1049 
	g$tÙ®_li¡
 = 
$this
->
PageNo
 + 
$li¡_Ën
;

1050 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

1052 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

1057 
	g$j
=1;

1058 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

1060 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

1063 
	g$j
; $j <ğ
$tÙ®_li¡
; $j++)

1065 if(
	g$j
 =ğ
$this
->
PageNo
)

1067 
$li¡dd
.= "<li class=\"thisclass\"><a>$j</a></li>\r\n";

1071 
	g$li¡dd
.="<li><¨h»f='".
$pu¾
."PageNo=$j'>".
$j
."</a></li>\r\n";

1075 
	g$¶i¡
 = 
$šdex·ge
.
$´•age
.
$li¡dd
.
$Ãxage
.
$’d·ge
;

1076  
	g$¶i¡
;

1085 
funùiÚ
 
	$G‘CurU¾
()

1087 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

1089 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

1090 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

1091 
$nowu¾
 = 
$nowu¾s
[0];

1095 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

1097  
$nowu¾
;

1098 
	}
}

	@E:\web\weixun\functions\arc.sgpage.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

14 şas 
	csg·ge


16 
v¬
 
	m$dsql
;

17 
v¬
 
	m$d
;

18 
v¬
 
	m$Ty³ID
;

19 
v¬
 
	m$F›lds
;

20 
v¬
 
	m$Ty³Lšk
;

21 
v¬
 
	m$·¹V›w
;

30 
funùiÚ
 
	$__cÚ¡ruù
(
$aid
)

32 
glob®
 
$cfg_ba£dœ
,
$cfg_‹m¶‘s_dœ
,
$cfg_df_¡yË
,
$’vs
;

34 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

35 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

36 
$this
->
d
->
»fObj
 = $this;

37 
$this
->
d
->
	`S‘NameS·û
("xak","{","}");

38 
$this
->
F›lds
 = $this->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__sgpage` WHERE‡id='$aid' ");

39 
$’vs
['aid'] = 
$this
->
F›lds
['aid'];

42 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
)

44 
$this
->
F›lds
[
$k
] = 
$v
;

46 if(
$this
->
F›lds
['ismake']==1)

48 
$pv
 = 
Ãw
 
	`P¬tV›w
();

49 
$pv
->
	`S‘Tem¶‘
(
$this
->
F›lds
['body'],'string');

50 
$this
->
F›lds
['body'] = 
$pv
->
	`G‘ResuÉ
();

52 
$lfe
 = 
$cfg_ba£dœ
.
	`¡r_»¶aû
('{¡yË}',
$cfg_‹m¶‘s_dœ
.'/'.
$cfg_df_¡yË
,
$this
->
F›lds
['template']);

53 
$this
->
d
->
	`LßdTem¶©e
(
$lfe
);

54 
$this
->
	`P¬£Tem¶‘
();

58 
funùiÚ
 
	$sg·ge
(
$aid
)

60 
$this
->
	`__cÚ¡ruù
(
$aid
);

61 
	}
}

69 
funùiÚ
 
	$Di¥Ïy
()

71 
$this
->
d
->
	`Di¥Ïy
();

72 
	}
}

80 
funùiÚ
 
	$G‘ResuÉ
()

82  
$this
->
d
->
	`G‘ResuÉ
();

83 
	}
}

91 
funùiÚ
 
	$SaveToHtml
()

93 
$f’ame
 = 
$GLOBALS
['cfg_ba£dœ'].$GLOBALS['cfg_cm¥©h'].'/'.
$this
->
F›lds
['filename'];

94 
$f’ame
 = 
	`´eg_»¶aû
("/\/{1,}/", '/', $filename);

95 
$this
->
d
->
	`SaveTo
(
$f’ame
);

96 
	}
}

104 
funùiÚ
 
	$P¬£Tem¶‘
()

106 
$GLOBALS
['’vs']['likeid'] = 
$this
->
F›lds
['likeid'];

107 
	`MakeOÃTag
(
$this
->
d
,$this);

108 
	}
}

111 
funùiÚ
 
	$Clo£
()

113 
	}
}

	@E:\web\weixun\functions\arc.specview.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
»quœe_Úû
(
XAKINC
."/channelunit.class.php");

10 
»quœe_Úû
(
XAKINC
.'/ftp.class.php');

12 @
£t_time_lim™
(0);

18 şas 
	cS³cV›w


20 
v¬
 
	m$dsql
;

21 
v¬
 
	m$d
;

22 
v¬
 
	m$d2
;

23 
v¬
 
	m$Ty³ID
;

24 
v¬
 
	m$Ty³Lšk
;

25 
v¬
 
	m$PageNo
;

26 
v¬
 
	m$TÙ®Page
;

27 
v¬
 
	m$TÙ®ResuÉ
;

28 
v¬
 
	m$PageSize
;

29 
v¬
 
	m$ChªÃlUn™
;

30 
v¬
 
	m$Li¡Ty³
;

31 
v¬
 
	m$TempInfos
;

32 
v¬
 
	m$F›lds
;

33 
v¬
 
	m$S¹Time
;

34 
v¬
 
	m$áp
;

35 
v¬
 
	m$»mÙeDœ
;

44 
funùiÚ
 
	$__cÚ¡ruù
(
$¡¬‰ime
=0)

46 
glob®
 
$áp
;

47 
$this
->
Ty³ID
 = 0;

48 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

49 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

50 
$this
->
d
->
	`S‘RefObj
($this);

51 
$this
->
d
->
	`S‘NameS·û
("xak","{","}");

52 
$this
->
d2
 = 
Ãw
 
	`XakTagP¬£
();

53 
$this
->
d2
->
	`S‘NameS·û
("field","[","]");

54 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(0);

55 
$this
->
ChªÃlUn™
 = 
Ãw
 
	`ChªÃlUn™
(-1);

56 
$this
->
áp
 = &
$áp
;

57 
$this
->
»mÙeDœ
 = '';

60 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
)

62 
$this
->
F›lds
[
$k
] = 
$v
;

64 if(
$¡¬‰ime
==0)

66 
$this
->
S¹Time
 = 0;

70 
$this
->
S¹Time
 = 
	`G‘MkTime
(
$¡¬‰ime
);

72 
$this
->
	`CouÁRecÜd
();

73 
$‹mpfe
 = 
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_templets_dir']."/".$GLOBALS['cfg_df_style']."/list_spec.htm";

74 if(!
	`fe_exi¡s
(
$‹mpfe
)||!
	`is_fe
($tempfile))

76 
echo
 "æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è§£ææ–‡æ¡£ï¼";

77 
	`ex™
();

79 
$this
->
d
->
	`LßdTem¶©e
(
$‹mpfe
);

80 
$this
->
TempInfos
['gs'] = $this->
d
->
CTags
;

81 
$this
->
TempInfos
['sourû'] = $this->
d
->
SourûSŒšg
;

82 
$ùag
 = 
$this
->
d
->
	`G‘Tag
("page");

83 if(!
	`is_objeù
(
$ùag
))

85 
$this
->
PageSize
 = 20;

89 if(
$ùag
->
	`G‘A‰
("pagesize")!="")

91 
$this
->
PageSize
 = 
$ùag
->
	`G‘A‰
("pagesize");

95 
$this
->
PageSize
 = 20;

98 
$this
->
TÙ®Page
 = 
	`û
($this->
TÙ®ResuÉ
/$this->
PageSize
);

102 
funùiÚ
 
	$S³cV›w
(
$¡¬‰ime
=0)

104 
$this
->
	`__cÚ¡ruù
(
$¡¬‰ime
);

105 
	}
}

108 
funùiÚ
 
	$Clo£
()

110 
	}
}

118 
funùiÚ
 
	$CouÁRecÜd
()

120 
$this
->
TÙ®ResuÉ
 = -1;

121 if(
	`is£t
(
$GLOBALS
['TotalResult']))

123 
$this
->
TÙ®ResuÉ
 = 
$GLOBALS
['TotalResult'];

125 if(
	`is£t
(
$GLOBALS
['PageNo']))

127 
$this
->
PageNo
 = 
$GLOBALS
['PageNo'];

131 
$this
->
PageNo
 = 1;

133 if(
$this
->
TÙ®ResuÉ
==-1)

135 if(
$this
->
S¹Time
>0)

137 
$timesql
 = " AND #@__¬chives.£ndd©e>'".
$this
->
S¹Time
."'";

141 
$timesql
 = "";

143 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT count(*) AS dd FROM #@__archives WHERE #@__archives.arcrank > -1 AND channel=-1 $timesql");

144 if(
	`is_¬¿y
(
$row
))

146 
$this
->
TÙ®ResuÉ
 = 
$row
['dd'];

150 
$this
->
TÙ®ResuÉ
 = 0;

153 
	}
}

161 
funùiÚ
 
	$Di¥Ïy
()

163 if(
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']==1

164 ||
$this
->
Ty³Lšk
->
Ty³Infos
['ispart']==2)

166 
$this
->
	`Di¥ÏyP¬tTem¶‘s
();

168 
$this
->
	`P¬£Tem¶‘sFœ¡
();

169 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$gid
=>
$ùag
)

171 if(
$ùag
->
	`G‘Name
()=="list")

173 
$lim™¡¬t
 = (
$this
->
PageNo
-1è* $this->
PageSize
;

174 
$row
 = 
$this
->
PageSize
;

175 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())=="")

177 
$IÂ”Text
 = 
	`G‘SysTem¶‘s
("list_fulllist.htm");

181 
$IÂ”Text
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

183 
$this
->
d
->
	`Assign
(
$gid
,

184 
$this
->
	`G‘ArcLi¡
(
$lim™¡¬t
,
$row
,

185 
$ùag
->
	`G‘A‰
("col"),

186 
$ùag
->
	`G‘A‰
("titlelen"),

187 
$ùag
->
	`G‘A‰
("infolen"),

188 
$ùag
->
	`G‘A‰
("imgwidth"),

189 
$ùag
->
	`G‘A‰
("imgheight"),

190 
$ùag
->
	`G‘A‰
("listtype"),

191 
$ùag
->
	`G‘A‰
("orderby"),

192 
$IÂ”Text
,

193 
$ùag
->
	`G‘A‰
("tablewidth"))

196 if(
$ùag
->
	`G‘Name
()=="pagelist")

198 
$li¡_Ën
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("listsize"));

199 if(
$li¡_Ën
=="")

201 
$li¡_Ën
 = 3;

203 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡DM
(
$li¡_Ën
));

206 
$this
->
d
->
	`Di¥Ïy
();

207 
	}
}

216 
funùiÚ
 
	$MakeHtml
(
$i¤emÙe
=0)

218 
glob®
 
$cfg_»mÙe_s™e
;

220 
$this
->
	`P¬£Tem¶‘sFœ¡
();

221 
$tÙ®·ge
 = 
	`û
(
$this
->
TÙ®ResuÉ
 / $this->
PageSize
);

222 if(
$tÙ®·ge
==0)

224 
$tÙ®·ge
 = 1;

226 
	`C»©eDœ
(
$GLOBALS
['cfg_special']);

227 
$mu¾
 = "";

228 
$this
->
PageNo
=1;$this->PageNo<=
$tÙ®·ge
;$this->PageNo++)

230 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$gid
=>
$ùag
)

232 if(
$ùag
->
	`G‘Name
()=="list")

234 
$lim™¡¬t
 = (
$this
->
PageNo
-1è* $this->
PageSize
;

235 
$row
 = 
$this
->
PageSize
;

236 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())=="")

238 
$IÂ”Text
 = 
	`G‘SysTem¶‘s
("spec_list.htm");

242 
$IÂ”Text
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

244 
$this
->
d
->
	`Assign
(
$gid
,

245 
$this
->
	`G‘ArcLi¡
(
$lim™¡¬t
,
$row
,

246 
$ùag
->
	`G‘A‰
("col"),

247 
$ùag
->
	`G‘A‰
("titlelen"),

248 
$ùag
->
	`G‘A‰
("infolen"),

249 
$ùag
->
	`G‘A‰
("imgwidth"),

250 
$ùag
->
	`G‘A‰
("imgheight"),

252 
$ùag
->
	`G‘A‰
("orderby"),

253 
$IÂ”Text
,

254 
$ùag
->
	`G‘A‰
("tablewidth"))

257 if(
$ùag
->
	`G‘Name
()=="pagelist")

259 
$li¡_Ën
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("listsize"));

260 if(
$li¡_Ën
=="")

262 
$li¡_Ën
 = 3;

264 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡ST
(
$li¡_Ën
));

268 
$makeFe
 = 
$GLOBALS
['cfg_¥ecŸl']."/¥ec_".
$this
->
PageNo
.$GLOBALS['art_shortname'];

269 
$mu¾
 = 
$makeFe
;

270 
$makeFe
 = 
$GLOBALS
['cfg_basedir'].$makeFile;

271 
$this
->
d
->
	`SaveTo
(
$makeFe
);

273 if(
$cfg_»mÙe_s™e
=='Y'&& 
$i¤emÙe
 == 1)

276 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '', 
$makeFe
);

277 
$loÿlfe
 = '..'.
$»mÙefe
;

278 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.html/', '',
$»mÙefe
);

280 
$this
->
áp
->
	`rmkdœ
(
$»mÙedœ
);

281 
$this
->
áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'acii');

283 
echo
 "æˆåŠŸåˆ›å»ºï¼š$murl<br/>";

285 
	`cİy
(
$GLOBALS
['cfg_basedir'].$GLOBALS['cfg_special']."/spec_1".$GLOBALS['art_shortname'],$GLOBALS['cfg_basedir'].$GLOBALS['cfg_special']."/index.html");

286 
$mu¾
 = 
$GLOBALS
['cfg_special']."/index.html";

287  
$mu¾
;

288 
	}
}

296 
funùiÚ
 
	$P¬£Tem¶‘sFœ¡
()

298 
	`MakeOÃTag
(
$this
->
d
,$this);

299 
	}
}

318 
funùiÚ
 
G‘ArcLi¡
(
$lim™¡¬t
=0,
$row
=10,
$cŞ
=1,
$t™ËËn
=30,
$šfŞ’
=250,

319 
$imgwidth
=120,
$imgheight
=90,
$li¡ty³
="®l",
$Üd”by
="deçuÉ",
$šÃ¹ext
="",
$bËwidth
="100")

321 
$ty³id
=
$this
->
Ty³ID
;

322 if(
	g$row
=="")

324 
$row
 = 10;

326 if(
	g$lim™¡¬t
=="")

328 
$lim™¡¬t
 = 0;

330 if(
	g$t™ËËn
=="")

332 
$t™ËËn
 = 30;

334 if(
	g$šfŞ’
=="")

336 
$šfŞ’
 = 250;

338 if(
	g$imgwidth
=="")

340 
$imgwidth
 = 120;

342 if(
	g$imgheight
=="")

344 
$imgheight
 = 120;

346 if(
	g$li¡ty³
=="")

348 
$li¡ty³
 = "all";

350 if(
	g$Üd”by
=="")

352 
$Üd”by
="default";

356 
	g$Üd”by
=
¡¹Şow”
(
$Üd”by
);

358 
	g$bËwidth
 = 
¡r_»¶aû
("%", "", 
$bËwidth
);

359 if(
	g$bËwidth
=="")

361 
$bËwidth
=100;

363 if(
	g$cŞ
=="")

365 
$cŞ
=1;

367 
	g$cŞWidth
 = 
û
(100/
$cŞ
);

368 
	g$bËwidth
 = 
$bËwidth
."%";

369 
	g$cŞWidth
 = 
$cŞWidth
."%";

370 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

371 if(
	g$šÃ¹ext
=="")

373 
$šÃ¹ext
 = 
G‘SysTem¶‘s
("spec_list.htm");

377 
	g$Üwh”e
 = "‡rc.arcrank > -1 AND‡rc.channel = -1 ";

378 if(
	g$this
->
	gS¹Time
>0)

380 
	g$Üwh”e
 .ğ" AND‡rc.£ndd©e>'".
$this
->
S¹Time
."'";

384 
	g$Üd”sql
 = '';

385 if(
	g$Üd”by
=='senddate')

387 
$Üd”sql
=" ORDER BY‡rc.senddate desc";

389 if(
	g$Üd”by
=='pubdate')

391 
$Üd”sql
=" ORDER BY‡rc.pubdate desc";

393 if(
	g$Üd”by
=='id')

395 
$Üd”sql
=" ORDER BY‡rc.id desc";

399 
	g$Üd”sql
=" ORDER BY‡rc.sortrank desc";

401 
	g$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.isdefault,arc.money,

402 

.
deçuÉÇme
,
	g
.
	gÇm”uË
,.
	gÇm”uË2
,.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h


403 
	gFROM
 `#@
	g__¬chives
` 
¬c
 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g¬c
.
	gty³id
ñp.
id


404 
WHERE
 
$Üwh”e
 
$Üd”sql
 
LIMIT
 
$lim™¡¬t
,
	g$row
 ";

405 
	g$this
->
	gdsql
->
S‘Qu”y
(
$qu”y
);

406 
	g$this
->
	gdsql
->
Execu‹
('al');

407 
	g$¬i¡
 = '';

408 if(
	g$cŞ
>1)

410 
	g$¬i¡
 = "<table width='$tablewidth' border='0' cellspacing='0' cellpadding='0'>\r\n";

412 
	g$this
->
	gd2
->
LßdSourû
(
$šÃ¹ext
);

413 
	g$i
=0;$i<
	g$row
;$i++)

415 if(
	g$cŞ
>1)

417 
	g$¬i¡
 .= "<tr>\r\n";

419 
	g$j
=0;$j<
	g$cŞ
;$j++)

421 if(
	g$cŞ
>1)

423 
	g$¬i¡
 .= "<td width='$colWidth'>\r\n";

425 if(
	g$row
 = 
$this
->
dsql
->
G‘A¼ay
("al"))

428 
$row
["desütiÚ"] = 
ú_sub¡r
($row["desütiÚ"],
$šfŞ’
);

429 
	g$row
["t™Ë"] = 
ú_sub¡r
(
$row
["t™Ë"],
$t™ËËn
);

430 
	g$row
["id"] = 
$row
["id"];

431 if(
	g$row
['l™pic'] =ğ'-' || 
$row
['litpic'] == '')

433 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

435 if(!
´eg_m©ch
("/^h‰p:\/\//", 
$row
['l™pic']è&& 
	g$GLOBALS
['cfg_multi_site'] == 'Y')

437 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

439 
	g$row
['piúame'] = 
$row
['litpic'];

440 
	g$row
["¬cu¾"] = 
G‘FeU¾
(
$row
["id"],$row["typeid"],$row["senddate"],$row["title"],

441 
$row
["ismake"],$row["arcrank"],$row["namerule"],$row["typedir"],$row["money"],$row['filename'],$row["moresite"],$row["siteurl"],$row["sitepath"]);

442 
	g$row
["ty³u¾"] = 
G‘Ty³U¾
(
$row
["typeid"],$row["typedir"],$row["isdefault"],$row["defaultname"],$row["ispart"],$row["namerule2"],$row["moresite"],$row["siteurl"],$row["sitepath"]);

443 
	g$row
["šfo"] = 
$row
["description"];

444 
	g$row
["f’ame"] = 
$row
["arcurl"];

445 
	g$row
["¡ime"] = 
G‘D©eMK
(
$row
["pubdate"]);

446 
	g$row
["‹xšk"] = "<¨h»f='".
$row
["filename"]."'>".$row["title"]."</a>";

447 
	g$row
["ty³lšk"] = "[<¨h»f='".
$row
["typeurl"]."'>".$row["typename"]."</a>]";

448 
	g$row
["imglšk"] = "<¨h»f='".
$row
["filename"]."'><img src='".$row["picname"]."' border='0' width='$imgwidth' height='$imgheight'></a>";

449 
	g$row
["image"] = "<img src='".
$row
["picname"]."' border='0' width='$imgwidth' height='$imgheight'>";

450 
	g$row
['¶usu¾'] = 
$row
['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

451 
	g$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

452 
	g$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

455 
fÜ—ch
(
$this
->
ChªÃlUn™
->
ChªÃlF›lds
 
as
 
$k
=>
$¬r
)

457 if(
is£t
(
$row
[
$k
]))

459 
$row
[
$k
] = 
$this
->
ChªÃlUn™
->
MakeF›ld
($k,$row[$k]);

462 if(
is_¬¿y
(
$this
->
d2
->
CTags
))

464 
fÜ—ch
(
$this
->
d2
->
CTags
 
as
 
$k
=>
$ùag
)

466 if(
$ùag
->
G‘Name
()=='array')

469 
$this
->
d2
->
Assign
(
$k
,
$row
);

473 if(
is£t
(
$row
[
$ùag
->
G‘Name
()]))

475 
	g$this
->
	gd2
->
Assign
(
$k
,
$row
[
$ùag
->
G‘Name
()]);

479 
	g$this
->
	gd2
->
Assign
(
$k
,'');

484 
	g$¬i¡
 .ğ
$this
->
d2
->
G‘ResuÉ
();

489 
	g$¬i¡
 .= "";

491 if(
	g$cŞ
>1)

493 
	g$¬i¡
 .= "</td>\r\n";

497 if(
	g$cŞ
>1)

499 
	g$¬i¡
 .= "</tr>\r\n";

503 if(
	g$cŞ
>1)

505 
	g$¬i¡
 .= "</table>\r\n";

507 
	g$this
->
	gdsql
->
F»eResuÉ
("al");

508  
	g$¬i¡
;

518 
funùiÚ
 
	$G‘PageLi¡ST
(
$li¡_Ën
)

520 
$´•age
="";

521 
$Ãxage
="";

522 
$´•ag’um
 = 
$this
->
PageNo
 - 1;

523 
$Ãxag’um
 = 
$this
->
PageNo
 + 1;

524 if(
$li¡_Ën
=="" || 
	`´eg_m©ch
("/[^0-9]/", $list_len))

526 
$li¡_Ën
=3;

528 
$tÙ®·ge
 = 
	`û
(
$this
->
TÙ®ResuÉ
 / $this->
PageSize
);

529 if(
$tÙ®·ge
 <ğ1 && 
$this
->
TÙ®ResuÉ
 > 0)

532  "<¥ª cÏss=\"·gešfo\">å…± <¡rÚg>1</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡è®°å½•</span>";

534 if(
$this
->
TÙ®ResuÉ
 == 0)

536  "<¥ª cÏss=\"·gešfo\">å…± <¡rÚg>0</¡rÚg>é¡µ<¡rÚg>".
$this
->
TÙ®ResuÉ
."</strong>æ¡è®°å½•</span>";

538 
$pu¾
 = 
$this
->
	`G‘CurU¾
();

539 
$Šam”uË
 = "spec_";

542 if(
$this
->
PageNo
 != 1)

544 
$´•age
.="<li><¨h»f='".
$Šam”uË
."$´•ag’um".
$GLOBALS
['art_shortname']."'>ä¸Šä¸€é¡µ</a></li>\r\n";

545 
$šdex·ge
="<li><¨h»f='".
$Šam”uË
."1".
$GLOBALS
['art_shortname']."'>é¦–é¡µ</a></li>\r\n";

549 
$šdex·ge
="<li><a>é¦–é¡µ</a></li>\r\n";

551 if(
$this
->
PageNo
!=
$tÙ®·ge
 && $totalpage>1)

553 
$Ãxage
.="<li><¨h»f='".
$Šam”uË
."$Ãxag’um".
$GLOBALS
['art_shortname']."'>ä¸‹ä¸€é¡µ</a></li>\r\n";

554 
$’d·ge
="<li><¨h»f='".
$Šam”uË
."$tÙ®·ge".
$GLOBALS
['art_shortname']."'>æœ«é¡µ</a></li>\r\n";

558 
$’d·ge
="<li><a>æœ«é¡µ</a></li>\r\n";

562 
$li¡dd
="";

563 
$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

564 if(
$this
->
PageNo
 >ğ
$tÙ®_li¡
)

566 
$j
 = 
$this
->
PageNo
 - 
$li¡_Ën
;

567 
$tÙ®_li¡
 = 
$this
->
PageNo
 + 
$li¡_Ën
;

568 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

570 
$tÙ®_li¡
 = 
$tÙ®·ge
;

575 
$j
=1;

576 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

578 
$tÙ®_li¡
 = 
$tÙ®·ge
;

581 
$j
; $j<=
$tÙ®_li¡
; $j++)

583 if(
$j
 =ğ
$this
->
PageNo
)

585 
$li¡dd
.= "<li class=\"thisclass\"><a>$j</a></li>\r\n";

589 
$li¡dd
.="<li><¨h»f='".
$Šam”uË
."$j".
$GLOBALS
['¬t_shÜŠame']."'>".
$j
."</a></li>\r\n";

592 
$¶i¡
 = 
$šdex·ge
.
$´•age
.
$li¡dd
.
$Ãxage
.
$’d·ge
;

593  
$¶i¡
;

594 
	}
}

604 
funùiÚ
 
	$G‘PageLi¡DM
(
$li¡_Ën
)

606 
$´•age
="";

607 
$Ãxage
="";

608 
$´•ag’um
 = 
$this
->
PageNo
 - 1;

609 
$Ãxag’um
 = 
$this
->
PageNo
 + 1;

610 if(
$li¡_Ën
=="" || 
	`´eg_m©ch
("/[^0-9]/", $list_len))

612 
$li¡_Ën
=3;

614 
$tÙ®·ge
 = 
	`û
(
$this
->
TÙ®ResuÉ
 / $this->
PageSize
);

615 if(
$tÙ®·ge
 <ğ1 && 
$this
->
TÙ®ResuÉ
 > 0)

617  "<¥ª cÏss=\"·gešfo\">å…±1é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•</span>";

619 if(
$this
->
TÙ®ResuÉ
 == 0)

621  "<¥ª cÏss=\"·gešfo\">å…±0é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡è®°å½•</span>";

624 
$pu¾
 = 
$this
->
	`G‘CurU¾
();

625 
$g‘u¾
 = "ty³id=".
$this
->
Ty³ID
."&TÙ®ResuÉ=".$this->
TÙ®ResuÉ
."&";

626 
$hid’fÜm
 = "<špuˆty³='hidd’'‚ame='ty³id' v®ue='".
$this
->
Ty³ID
."'>\r\n";

627 
$hid’fÜm
 .ğ"<špuˆty³='hidd’'‚ame='TÙ®ResuÉ' v®ue='".
$this
->
TÙ®ResuÉ
."'>\r\n";

628 
$pu¾
 .ğ"?".
$g‘u¾
;

631 if(
$this
->
PageNo
 != 1)

633 
$´•age
.="<li><¨h»f='".
$pu¾
."PageNo=$prepagenum'>ä¸Šä¸€é¡µ</a></li>\r\n";

634 
$šdex·ge
="<li><¨h»f='".
$pu¾
."PageNo=1'>é¦–é¡µ</a></li>\r\n";

638 
$šdex·ge
="<li><a>é¦–é¡µ</a></li>\r\n";

640 if(
$this
->
PageNo
 !ğ
$tÙ®·ge
 && $totalpage>1)

642 
$Ãxage
.="<li><¨h»f='".
$pu¾
."PageNo=$nextpagenum'>ä¸‹ä¸€é¡µ</a></li>\r\n";

643 
$’d·ge
="<li><¨h»f='".
$pu¾
."PageNo=$totalpage'>æœ«é¡µ</a></li>\r\n";

647 
$’d·ge
="<li><a>æœ«é¡µ</a></li>";

651 
$li¡dd
 = "";

652 
$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

653 if(
$this
->
PageNo
 >ğ
$tÙ®_li¡
)

655 
$j
 = 
$this
->
PageNo
 - 
$li¡_Ën
;

656 
$tÙ®_li¡
 = 
$this
->
PageNo
 + 
$li¡_Ën
;

657 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

659 
$tÙ®_li¡
 = 
$tÙ®·ge
;

664 
$j
=1;

665 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

667 
$tÙ®_li¡
 = 
$tÙ®·ge
;

670 
$j
; $j<=
$tÙ®_li¡
; $j++)

672 if(
$j
 =ğ
$this
->
PageNo
)

674 
$li¡dd
.= "<li class=\"thisclass\"><a>$j</a></li>\r\n";

678 
$li¡dd
.="<li><¨h»f='".
$pu¾
."PageNo=$j'>".
$j
."</a></li>\r\n";

682 
$¶i¡
 = 
$šdex·ge
.
$´•age
.
$li¡dd
.
$Ãxage
.
$’d·ge
;

683  
$¶i¡
;

684 
	}
}

692 
funùiÚ
 
	$G‘CurU¾
()

694 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

696 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

697 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

698 
$nowu¾
 = 
$nowu¾s
[0];

702 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

704  
$nowu¾
;

705 
	}
}

	@E:\web\weixun\functions\arc.taglist.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
»quœe_Úû
(
XAKINC
.'/channelunit.class.php');

9 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

11 @
£t_time_lim™
(0);

17 şas 
	cTagLi¡


19 
v¬
 
	m$dsql
;

20 
v¬
 
	m$d
;

21 
v¬
 
	m$d2
;

22 
v¬
 
	m$Ty³Lšk
;

23 
v¬
 
	m$PageNo
;

24 
v¬
 
	m$TÙ®Page
;

25 
v¬
 
	m$TÙ®ResuÉ
;

26 
v¬
 
	m$PageSize
;

27 
v¬
 
	m$Li¡Ty³
;

28 
v¬
 
	m$F›lds
;

29 
v¬
 
	m$Tag
;

30 
v¬
 
	m$Tem¶‘
;

31 
v¬
 
	m$TagInfos
;

32 
v¬
 
	m$Tem¶‘sFe
;

42 
funùiÚ
 
	$__cÚ¡ruù
(
$keywÜd
, 
$‹m¶‘
)

44 
glob®
 
$dsql
;

45 
$this
->
Tem¶‘
 = 
$‹m¶‘
;

46 
$this
->
Tag
 = 
$keywÜd
;

47 
$this
->
dsql
 = 
$dsql
;

48 
$this
->
d
 = 
Ãw
 
	`XakTagP¬£
();

49 
$this
->
d
->
	`S‘RefObj
($this);

50 
$this
->
d
->
	`S‘NameS·û
("xak","{","}");

51 
$this
->
d2
 = 
Ãw
 
	`XakTagP¬£
();

52 
$this
->
d2
->
	`S‘NameS·û
("field","[","]");

53 
$this
->
Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(0);

54 
$this
->
F›lds
['g'] = 
$keywÜd
;

55 
$this
->
F›lds
['t™Ë'] = 
$keywÜd
;

56 
$this
->
Tem¶‘sFe
 = '';

59 
	`fÜ—ch
(
$GLOBALS
['PubF›lds'] 
as
 
$k
=>
$v
è
$this
->
F›lds
[$k] = $v;

62 if(
$this
->
Tag
!='')

64 
$this
->
TagInfos
 = $this->
dsql
->
	`G‘OÃ
("Select * From `#@__tagindex` whereag†ike '{$this->Tag}' ");

65 if(!
	`is_¬¿y
(
$this
->
TagInfos
))

67 
$fuÎ£¬ch
 = 
$GLOBALS
['cfg_phpu¾']."/£¬ch.php?keywÜd=".
$this
->
Tag
."&searchtype=titlekeyword";

68 
$msg
 = "ç³»ç»Ÿæ— æ­¤æ ‡ç­¾ï¼Œå¯èƒ½å·²ç»ç§»é™¤ï¼<br /><br />ä½ è¿˜å¯ä»¥å°è¯•é€šè¿‡æœç´¢ç¨‹åºå»æœç´¢è¿™ä¸ªå…³é”®å­—ï¼š<a href='$fullsearch'>å‰å¾€æœç´¢&gt;&gt;</a>";

69 
	`ShowMsg
(
$msg
,"-1");

70 
	`ex™
();

75 
$‹mpfe
 = 
$GLOBALS
['cfg_ba£dœ'].$GLOBALS['cfg_‹m¶‘s_dœ']."/".$GLOBALS['cfg_df_¡yË'].'/'.
$this
->
Tem¶‘
;

76 if(!
	`fe_exi¡s
(
$‹mpfe
)||!
	`is_fe
($tempfile))

78 
echo
 "æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è§£ææ–‡æ¡£ï¼";

79 
	`ex™
();

81 
$this
->
d
->
	`LßdTem¶©e
(
$‹mpfe
);

82 
$this
->
Tem¶‘sFe
 = 
	`´eg_»¶aû
("#^".
$GLOBALS
['cfg_ba£dœ']."#", '', 
$‹mpfe
);

87 
funùiÚ
 
	$TagLi¡
(
$keywÜd
,
$‹m¶‘
)

89 
$this
->
	`__cÚ¡ruù
(
$keywÜd
,
$‹m¶‘
);

90 
	}
}

93 
funùiÚ
 
	$Clo£
()

95 @
$this
->
dsql
->
	`Clo£
();

96 @
$this
->
Ty³Lšk
->
	`Clo£
();

97 
	}
}

105 
funùiÚ
 
	$CouÁRecÜd
()

108 
$this
->
TÙ®ResuÉ
 = -1;

109 if(
	`is£t
(
$GLOBALS
['TotalResult']))

111 
$this
->
TÙ®ResuÉ
 = 
$GLOBALS
['TotalResult'];

113 if(
	`is£t
(
$GLOBALS
['PageNo']))

115 
$this
->
PageNo
 = 
$GLOBALS
['PageNo'];

119 
$this
->
PageNo
 = 1;

121 if(
$this
->
TÙ®ResuÉ
==-1)

123 
$cqu”y
 = "SELECT COUNT(*) AS dd FROM `#@__taglist` WHEREid = '{$this->TagInfos['id']}' AND‡rcrank >-1 ";

124 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
(
$cqu”y
);

125 
$this
->
TÙ®ResuÉ
 = 
$row
['dd'];

128 
$Áime
 = 
	`time
();

131 
$upqu”y
 = "UPDATE `#@__tagindex` SETotal='{$row['dd']}',count=count+1,weekcc=weekcc+1,monthcc=monthcc+1 WHEREag LIKE '{$this->Tag}' ";

132 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$upqu”y
);

133 
$Úeday
 = 24 * 3600;

136 if(
	`û
Ğ(
$Áime
 - 
$this
->
TagInfos
['w“kup'])/
$Úeday
 ) > 7)

138 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__tagindex` SET weekcc=0,weekup='{$ntime}' WHEREag LIKE '{$this->Tag}' ");

142 if(
	`û
Ğ(
$Áime
 - 
$this
->
TagInfos
['mÚthup'])/
$Úeday
 ) > 30)

144 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__tagindex` SET monthcc=0,monthup='{$ntime}' WHEREag LIKE '{$this->Tag}' ");

147 
$ùag
 = 
$this
->
d
->
	`G‘Tag
("page");

148 if(!
	`is_objeù
(
$ùag
))

150 
$ùag
 = 
$this
->
d
->
	`G‘Tag
("list");

152 if(!
	`is_objeù
(
$ùag
))

154 
$this
->
PageSize
 = 25;

158 if(
$ùag
->
	`G‘A‰
("pagesize")!='')

160 
$this
->
PageSize
 = 
$ùag
->
	`G‘A‰
("pagesize");

164 
$this
->
PageSize
 = 25;

167 
$this
->
TÙ®Page
 = 
	`û
($this->
TÙ®ResuÉ
/$this->
PageSize
);

168 
	}
}

176 
funùiÚ
 
	$Di¥Ïy
()

178 if(
$this
->
Tag
!='')

180 
$this
->
	`CouÁRecÜd
();

182 
$this
->
	`P¬£Tem¶‘sFœ¡
();

183 if(
$this
->
Tag
!='')

185 
$this
->
	`P¬£DMF›lds
($this->
PageNo
,0);

187 
$this
->
	`Clo£
();

188 
$this
->
d
->
	`Di¥Ïy
();

189 
	}
}

197 
funùiÚ
 
	$P¬£Tem¶‘sFœ¡
()

199 
	`MakeOÃTag
(
$this
->
d
,$this);

200 
	}
}

210 
funùiÚ
 
	$P¬£DMF›lds
(
$PageNo
, 
$ismake
=1)

212 
	`fÜ—ch
(
$this
->
d
->
CTags
 
as
 
$gid
=>
$ùag
){

213 if(
$ùag
->
	`G‘Name
()=="list")

215 
$lim™¡¬t
 = (
$this
->
PageNo
-1è* $this->
PageSize
;

216 if(
$lim™¡¬t
<0)

218 
$lim™¡¬t
 = 0;

220 
$row
 = 
$this
->
PageSize
;

221 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())=="")

223 
$IÂ”Text
 = 
	`G‘SysTem¶‘s
("list_fulllist.htm");

227 
$IÂ”Text
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

229 
$this
->
d
->
	`Assign
(
$gid
,

230 
$this
->
	`G‘ArcLi¡
(

231 
$lim™¡¬t
,

232 
$row
,

233 
$ùag
->
	`G‘A‰
("col"),

234 
$ùag
->
	`G‘A‰
("titlelen"),

235 
$ùag
->
	`G‘A‰
("infolen"),

236 
$ùag
->
	`G‘A‰
("imgwidth"),

237 
$ùag
->
	`G‘A‰
("imgheight"),

238 
$ùag
->
	`G‘A‰
("listtype"),

239 
$ùag
->
	`G‘A‰
("orderby"),

240 
$IÂ”Text
,

241 
$ùag
->
	`G‘A‰
("tablewidth"),

242 
$ismake
,

243 
$ùag
->
	`G‘A‰
("orderway")

247 if(
$ùag
->
	`G‘Name
()=="pagelist")

249 
$li¡_Ën
 = 
	`Œim
(
$ùag
->
	`G‘A‰
("listsize"));

250 
$ùag
->
	`G‘A‰
("li¡™em")=="" ? 
$li¡™em
="info,index,pre,pageno,next,end,option" : $listitem=$ctag->GetAtt("listitem");

251 if(
$li¡_Ën
=="")

253 
$li¡_Ën
 = 3;

255 if(
$ismake
==0)

257 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
));

261 
$this
->
d
->
	`Assign
(
$gid
,$this->
	`G‘PageLi¡ST
(
$li¡_Ën
,
$li¡™em
));

265 
	}
}

286 
funùiÚ
 
G‘ArcLi¡
(
$lim™¡¬t
=0,
$row
=10,
$cŞ
=1,
$t™ËËn
=30,
$šfŞ’
=250,

287 
$imgwidth
=120,
$imgheight
=90,
$li¡ty³
="®l",
$Üd”by
="deçuÉ",
$šÃ¹ext
="",
$bËwidth
="100",
$ismake
=1,
$Üd”Way
='desc')

289 
$g‘row
 = (
$row
=='' ? 10 : $row);

290 if(
	g$lim™¡¬t
==''è
$lim™¡¬t
 = 0;

291 if(
	g$t™ËËn
==''è
$t™ËËn
 = 100;

292 if(
	g$šfŞ’
==''è
$šfŞ’
 = 250;

293 if(
	g$imgwidth
==''è
$imgwidth
 = 120;

294 if(
	g$imgheight
==''è
$imgheight
 = 120;

295 if(
	g$li¡ty³
==''è
$li¡ty³
 = 'all';

296 
	g$Üd”by
 = (
$Üd”by
=='' ? 'deçuÉ' : 
¡¹Şow”
($orderby) );

297 if(
	g$Üd”Way
==''è
$Üd”Way
 = 'desc';

298 
	g$bËwidth
 = 
¡r_»¶aû
("%", "", 
$bËwidth
);

299 if(
	g$bËwidth
==''è
$bËwidth
=100;

300 if(
	g$cŞ
==''è
$cŞ
=1;

301 
	g$cŞWidth
 = 
û
(100/
$cŞ
);

302 
	g$bËwidth
 = 
$bËwidth
."%";

303 
	g$cŞWidth
 = 
$cŞWidth
."%";

304 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

305 if(
	g$šÃ¹ext
==''è
$šÃ¹ext
 = 
G‘SysTem¶‘s
("list_fulllist.htm");

306 
	g$idli¡s
 = 
$Üd”sql
 = '';

307 
	g$this
->
	gdsql
->
S‘Qu”y
("SELECT‡id FROM `#@__taglist` WHEREid = '{$this->TagInfos['id']}' AND‡rcrank>-1 LIMIT $limitstart,$getrow");

308 
	g$this
->
	gdsql
->
Execu‹
();

309 
	g$row
=
$this
->
dsql
->
G‘A¼ay
())

311 
$idli¡s
 .ğ($idli¡s=='' ? 
$row
['aid'] : ','.$row['aid']);

313 if(
	g$idli¡s
=='')  '';

316 
	g$Üwh”e
 = " se.id IN($idlists) ";

319 if(
	g$Üd”by
=="sortrank")

321 
$Üd”sql
 = " ORDER BY se.sortrank $orderWay";

325 
	g$Üd”sql
=" ORDER BY se.id $orderWay";

327 
	g$qu”y
 = "SELECT se.*,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath

328 
FROM
 `#@
__¬chives
` 
£
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
 se.
ty³id
ñp.
id
 
WHERE
 
$Üwh”e
 
$Üd”sql
 ";

330 
$this
->
dsql
->
S‘Qu”y
(
$qu”y
);

331 
	g$this
->
	gdsql
->
Execu‹
('al');

332 
	g$row
 = 
$this
->
PageSize
 / 
$cŞ
;

333 
	g$¬i¡
 = '';

334 
	g$this
->
	gd2
->
LßdSourû
(
$šÃ¹ext
);

335 
	g$GLOBALS
['autoindex'] = 0;

336 
	g$i
=0; $i<
	g$row
; $i++)

338 if(
	g$cŞ
 > 1)

340 
	g$¬i¡
 .= "<div>\r\n";

342 
	g$j
=0; $j<
	g$cŞ
; $j++)

344 if(
	g$row
 = 
$this
->
dsql
->
G‘A¼ay
("al"))

346 
$GLOBALS
['autoindex']++;

347 
	g$ids
[
$row
['id']] = $row['id'];

350 
	g$row
['šfos'] = 
ú_sub¡r
(
$row
['desütiÚ'],
$šfŞ’
);

351 
	g$row
['id'] = 
$row
['id'];

352 
	g$row
['¬cu¾'] = 
G‘FeU¾
(
$row
['id'],$row['typeid'],$row['senddate'],$row['title'],

353 
$row
['ismake'],

354 
$row
['arcrank'],$row['namerule'],$row['typedir'],$row['money'],

355 
$row
['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

356 
	g$row
['ty³u¾'] = 
G‘Ty³U¾
(
$row
['ty³id'],
MfTy³dœ
($row['typedir']),$row['isdefault'],$row['defaultname'],

357 
$row
['ispart'],$row['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

358 if(
	g$row
['l™pic'] =ğ'-' || 
$row
['litpic'] == '')

360 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

362 if(!
´eg_m©ch
("/^h‰p:\/\//", 
$row
['l™pic']è&& 
	g$GLOBALS
['cfg_multi_site'] == 'Y')

364 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

366 
	g$row
['piúame'] = 
$row
['litpic'];

367 
	g$row
['¡ime'] = 
G‘D©eMK
(
$row
['pubdate']);

368 
	g$row
['ty³lšk'] = "<¨h»f='".
$row
['typeurl']."'>".$row['typename']."</a>";

369 
	g$row
['image'] = "<img src='".
$row
['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
´eg_»¶aû
("/['><]/", "", $row['title'])."'>";

370 
	g$row
['imglšk'] = "<¨h»f='".
$row
['filename']."'>".$row['image']."</a>";

371 
	g$row
['fuÎt™Ë'] = 
$row
['title'];

372 
	g$row
['t™Ë'] = 
ú_sub¡r
(
$row
['t™Ë'],
$t™ËËn
);

373 if(
	g$row
['color']!='')

375 
$row
['title'] = "<font color='".$row['color']."'>".$row['title']."</font>";

377 if(
´eg_m©ch
('/c/', 
$row
['flag']))

379 
	g$row
['t™Ë'] = "<b>".
$row
['title']."</b>";

381 
	g$row
['‹xšk'] = "<¨h»f='".
$row
['filename']."'>".$row['title']."</a>";

382 
	g$row
['¶usu¾'] = 
$row
['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

383 
	g$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

384 
	g$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

385 if(
is_¬¿y
(
$this
->
d2
->
CTags
))

387 
fÜ—ch
(
$this
->
d2
->
CTags
 
as
 
$k
=>
$ùag
)

389 if(
$ùag
->
G‘Name
()=='array')

392 
$this
->
d2
->
Assign
(
$k
,
$row
);

396 if(
is£t
(
$row
[
$ùag
->
G‘Name
()]))

398 
	g$this
->
	gd2
->
Assign
(
$k
,
$row
[
$ùag
->
G‘Name
()]);

402 
	g$this
->
	gd2
->
Assign
(
$k
,'');

407 
	g$¬i¡
 .ğ
$this
->
d2
->
G‘ResuÉ
();

412 if(
	g$cŞ
>1)

414 
	g$i
 +ğ
$cŞ
 - 1;

415 
	g$¬i¡
 .= " </div>\r\n";

419 
	g$this
->
	gdsql
->
F»eResuÉ
('al');

420  
	g$¬i¡
;

431 
funùiÚ
 
G‘PageLi¡DM
(
$li¡_Ën
,
$li¡™em
="info,index,end,pre,next,pageno")

433 
$´•age
="";

434 
	g$Ãxage
="";

435 
	g$´•ag’um
 = 
$this
->
PageNo
 - 1;

436 
	g$Ãxag’um
 = 
$this
->
PageNo
 + 1;

437 if(
	g$li¡_Ën
 =ğ"" || 
´eg_m©ch
("/[^0-9]/", 
$li¡_Ën
))

439 
	g$li¡_Ën
 = 3;

441 
	g$tÙ®·ge
 = 
$this
->
TÙ®Page
;

442 if(
	g$tÙ®·ge
 <ğ1 && 
$this
->
TÙ®ResuÉ
 > 0)

444  "<¥ª cÏss=\"·gešfo\">å…±1é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡</span>";

446 if(
	g$this
->
	gTÙ®ResuÉ
 == 0)

448  "<¥ª cÏss=\"·gešfo\">å…±0é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡</span>";

450 
	g$maššfo
 = "<¥ª cÏss=\"·gešfo\">å…±{$tÙ®·ge}é¡µ/".
$this
->
TÙ®ResuÉ
."æ¡</span>\r\n";

451 
	g$pu¾
 = 
$this
->
G‘CurU¾
();

452 
	g$pu¾
 .ğ"?/".
u¾’code
(
$this
->
Tag
);

455 if(
	g$this
->
	gPageNo
 != 1)

457 
$´•age
.="<li><¨h»f='".
$pu¾
."/$prepagenum/'>ä¸Šä¸€é¡µ</a></li>\r\n";

458 
	g$šdex·ge
="<li><¨h»f='".
$pu¾
."/1/'>é¦–é¡µ</a></li>\r\n";

462 
	g$šdex·ge
="<li><a>é¦–é¡µ</a></li>\r\n";

464 if(
	g$this
->
	gPageNo
!=
$tÙ®·ge
 && $totalpage>1)

466 
$Ãxage
.="<li><¨h»f='".
$pu¾
."/$nextpagenum/'>ä¸‹ä¸€é¡µ</a></li>\r\n";

467 
	g$’d·ge
="<li><¨h»f='".
$pu¾
."/$totalpage/'>æœ«é¡µ</a></li>\r\n";

471 
	g$’d·ge
="<li><a>æœ«é¡µ</a></li>\r\n";

475 
	g$li¡dd
="";

476 
	g$tÙ®_li¡
 = 
$li¡_Ën
 * 2 + 1;

477 if(
	g$this
->
	gPageNo
 >ğ
$tÙ®_li¡
)

479 
$j
 = 
$this
->
PageNo
 - 
$li¡_Ën
;

480 
	g$tÙ®_li¡
 = 
$this
->
PageNo
 + 
$li¡_Ën
;

481 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

483 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

488 
	g$j
=1;

489 if(
	g$tÙ®_li¡
 > 
	g$tÙ®·ge
)

491 
	g$tÙ®_li¡
 = 
$tÙ®·ge
;

494 
	g$j
; $j<=
$tÙ®_li¡
; $j++)

496 if(
	g$j
 =ğ
$this
->
PageNo
)

498 
$li¡dd
.= "<li class=\"thisclass\"><a>$j</a></li>\r\n";

502 
	g$li¡dd
.="<li><¨h»f='".
$pu¾
."/$j/'>".
$j
."</a></li>\r\n";

505 
	g$¶i¡
 = '';

506 if(
´eg_m©ch
('/šfo/i', 
$li¡™em
))

508 
	g$¶i¡
 .ğ
$maššfo
.' ';

510 if(
´eg_m©ch
('/šdex/i', 
$li¡™em
))

512 
	g$¶i¡
 .ğ
$šdex·ge
.' ';

514 if(
´eg_m©ch
('/´e/i', 
$li¡™em
))

516 
	g$¶i¡
 .ğ
$´•age
.' ';

518 if(
´eg_m©ch
('/·g’o/i', 
$li¡™em
))

520 
	g$¶i¡
 .ğ
$li¡dd
.' ';

522 if(
´eg_m©ch
('/Ãxt/i', 
$li¡™em
))

524 
	g$¶i¡
 .ğ
$Ãxage
.' ';

526 if(
´eg_m©ch
('/’d/i', 
$li¡™em
))

528 
	g$¶i¡
 .ğ
$’d·ge
.' ';

530  
	g$¶i¡
;

546 
funùiÚ
 
G‘Li¡U¾
(
$ty³id
,
$ty³dœ
,
$isdeçuÉ
,
$deçuÉÇme
,
$i¥¬t
,
$Çm”uË2
,
$s™eu¾
="")

548  
G‘Ty³U¾
(
$ty³id
,
MfTy³dœ
(
$ty³dœ
),
$isdeçuÉ
,
$deçuÉÇme
,
$i¥¬t
,
$Çm”uË2
,
$s™eu¾
);

567 
funùiÚ
 
G‘ArcU¾
(
$aid
,
$ty³id
,
$tim‘ag
,
$t™Ë
,
$ismake
=0,
$¿nk
=0,
$Çm”uË
="",
$¬tdœ
="",
$mÚey
=0,
$f’ame
='')

569  
G‘FeU¾
(
$aid
,
$ty³id
,
$tim‘ag
,
$t™Ë
,
$ismake
,
$¿nk
,
$Çm”uË
,
$¬tdœ
,
$mÚey
,
$f’ame
);

578 
funùiÚ
 
	$G‘CurU¾
()

580 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

582 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

583 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

584 
$nowu¾
 = 
$nowu¾s
[0];

588 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

590  
$nowu¾
;

591 
	}
}

	@E:\web\weixun\functions\archives.func.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
h–³r
('archive');

	@E:\web\weixun\functions\channelunit.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

6 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

7 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

12 şas 
	cChªÃlUn™


14 
v¬
 
	m$ChªÃlInfos
;

15 
v¬
 
	m$ChªÃlF›lds
;

16 
v¬
 
	m$AÎF›ldNames
;

17 
v¬
 
	m$ChªÃlID
;

18 
v¬
 
	m$ArcID
;

19 
v¬
 
	m$dsql
;

20 
v¬
 
	m$S¶™PageF›ld
;

23 
funùiÚ
 
	$__cÚ¡ruù
(
$cid
,
$aid
=0)

25 
$this
->
ChªÃlInfos
 = '';

26 
$this
->
ChªÃlF›lds
 = '';

27 
$this
->
AÎF›ldNames
 = '';

28 
$this
->
S¶™PageF›ld
 = '';

29 
$this
->
ChªÃlID
 = 
$cid
;

30 
$this
->
ArcID
 = 
$aid
;

31 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

32 
$sql
 = " SELECT * FROM `#@__channeltype` WHERE id='$cid' ";

33 
$this
->
ChªÃlInfos
 = $this->
dsql
->
	`G‘OÃ
(
$sql
);

34 if(!
	`is_¬¿y
(
$this
->
ChªÃlInfos
))

36 
echo
 'è¯»å–é¢‘é“ä¿¡æ¯å¤±è´¥ï¼Œæ— æ³•è¿›è¡Œåç»­æ“ä½œï¼';

37 
	`ex™
();

39 
$d
 = 
Ãw
 
	`XakTagP¬£
();

40 
$d
->
	`S‘NameS·û
('field','<','>');

41 
$d
->
	`LßdSourû
(
$this
->
ChªÃlInfos
['fieldset']);

42 if(
	`is_¬¿y
(
$d
->
CTags
))

44 
$Šames
 = 
	`A¼ay
();

45 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

47 
$Šame
 = 
$ùag
->
	`G‘Name
();

48 if(
	`is£t
(
$Šames
[
$Šame
]))

52 
$Šames
[
$Šame
] = 1;

53 if(
$this
->
AÎF›ldNames
!='')

55 
$this
->
AÎF›ldNames
 .ğ','.
$Šame
;

59 
$this
->
AÎF›ldNames
 .ğ
$Šame
;

61 if(
	`is_¬¿y
(
$ùag
->
CA‰ribu‹
->
I‹ms
))

63 
$this
->
ChªÃlF›lds
[
$Šame
] = 
$ùag
->
CA‰ribu‹
->
I‹ms
;

65 
$this
->
ChªÃlF›lds
[
$Šame
]['value'] = '';

66 
$this
->
ChªÃlF›lds
[
$Šame
]['šÃ¹ext'] = 
$ùag
->
	`G‘IÂ”Text
();

67 if(
	`em±y
(
$this
->
ChªÃlF›lds
[
$Šame
]['itemname']))

69 
$this
->
ChªÃlF›lds
[
$Šame
]['itemname'] = $tname;

71 if(
$ùag
->
	`G‘A‰
('page')=='split')

73 
$this
->
S¶™PageF›ld
 = 
$Šame
;

77 
$d
->
	`CË¬
();

80 
funùiÚ
 
	$ChªÃlUn™
(
$cid
,
$aid
=0)

82 
$this
->
	`__cÚ¡ruù
(
$cid
,
$aid
);

83 
	}
}

92 
funùiÚ
 
	$S‘ArcID
(
$aid
)

94 
$this
->
ArcID
 = 
$aid
;

95 
	}
}

106 
funùiÚ
 
MakeF›ld
(
$âame
, 
$fv®ue
, 
$addv®ue
='')

109 
$áy³
 = 
$this
->
ChªÃlF›lds
[
$âame
]['type'];

110 if(
	g$fv®ue
=='')

112 if(
$áy³
 !ğ'checkbox'è
$fv®ue
 = 
$this
->
ChªÃlF›lds
[
$âame
]['default'];

115 if(
	g$áy³
=='text')

117 
$fv®ue
 = 
HtmlR•Ïû
($fvalue);

119 if(
	g$áy³
=='textdata')

121 if(!
is_fe
(
$GLOBALS
['cfg_ba£dœ'].
$fv®ue
))

125 
	g$å
 = 
fİ’
(
$GLOBALS
['cfg_ba£dœ'].
$fv®ue
,'r');

126 
	g$fv®ue
 = '';

127 !
ãof
(
$å
))

129 
	g$fv®ue
 .ğ
fg‘s
(
$å
,1024);

131 
fşo£
(
$å
);

133 if(
	g$áy³
=='addon')

135 
$fŞdv®ue
 = 
$fv®ue
;

136 
	g$tm±ext
 = 
G‘SysTem¶‘s
("channel_addon.htm");

137 
	g$fv®ue
 = 
¡r_»¶aû
('~lšk~',
$fŞdv®ue
,
$tm±ext
);

138 
	g$fv®ue
 = 
¡r_»¶aû
('~phpu¾~',
$GLOBALS
['cfg_phpu¾'],
$fv®ue
);

140 if(
fe_exi¡s
(
XAKINC
.'/glib/chªÃl/'.
$áy³
.'.lib.php'))

142 
šşude_Úû
(
XAKINC
.'/glib/chªÃl/'.
$áy³
.'.lib.php');

143 
	g$func
 = 'ch_'.
$áy³
;

144 
	g$fv®ue
 = 
$func
(
$fv®ue
,
$addv®ue
,
$this
,
$âame
);

146  
	g$fv®ue
;

156 
funùiÚ
 
	$G‘l™ImgLšks
(
$fv®ue
)

158 if(
$GLOBALS
["htmltype"]=="dm"){

159 if(
	`em±y
(
$GLOBALS
["·g’o"])è
$NowPage
 = 1;

160 
$NowPage
 = 
	`štv®
(
$GLOBALS
["pageno"]);

162 if(
	`em±y
(
$GLOBALS
["¡NowPage"])è
$NowPage
 = 1;

163 
$NowPage
 = 
	`štv®
(
$GLOBALS
["stNowPage"]);

166 
$»v®ue
 = "";

167 
$d
 = 
Ãw
 
	`XakTagP¬£
();

168 
$d
->
	`LßdSourû
(
$fv®ue
);

169 if(!
	`is_¬¿y
(
$d
->
CTags
)){

170 
$d
->
	`CË¬
();

173 
$±ag
 = 
$d
->
	`G‘Tag
("pagestyle");

174 if(
	`is_objeù
(
$±ag
)){

175 
$·ge¡yË
 = 
$±ag
->
	`G‘A‰
('value');

176 
$maxwidth
 = 
$±ag
->
	`G‘A‰
('maxwidth');

177 
$ddmaxwidth
 = 
$±ag
->
	`G‘A‰
('ddmaxwidth');

178 
$œow
 = 
$±ag
->
	`G‘A‰
('row');

179 
$icŞ
 = 
$±ag
->
	`G‘A‰
('col');

180 if(
	`em±y
(
$maxwidth
)è$maxwidth = 
$GLOBALS
['cfg_album_width'];

182 
$·ge¡yË
 = 2;

183 
$maxwidth
 = 
$GLOBALS
['cfg_album_width'];

184 
$ddmaxwidth
 = 200;

186 if(
$·ge¡yË
 == 3){

187 if(
	`em±y
(
$œow
)) $irow = 4;

188 if(
	`em±y
(
$icŞ
)) $icol = 4;

190 
$mrow
 = 0;

191 
$mcŞ
 = 0;

192 
$phÙoid
 = 1;

193 
$images
 = 
	`¬¿y
();

194 
$TÙ®PhÙo
 = (
$d
->
CTags
);

196 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
){

197 if(
$ùag
->
	`G‘Name
()=="img")

199 
$iw
 = 
$ùag
->
	`G‘A‰
('width');

200 
$ih
 = 
$ùag
->
	`G‘A‰
('heigth');

201 
$®t
 = 
	`¡r_»¶aû
("'","",
$ùag
->
	`G‘A‰
('text'));

202 
$¤c
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

203 
$ddimg
 = 
$ùag
->
	`G‘A‰
('ddimg');

204 if(
$iw
 > 
$maxwidth
) $iw = $maxwidth;

205 
$iw
 = (
	`em±y
($iw) ? "" : "width='$iw'");

206 if(
$GLOBALS
["htmltype"]=="dm") {

207 
$imgu¾
 = "view.php?aid=$this->ArcID&pageno=$photoid";

209 if(
$phÙoid
==1){

210 
$imgu¾
 = 
$GLOBALS
["fileFirst"].".html";

212 
$imgu¾
 = 
$GLOBALS
["feFœ¡"]."_".
$phÙoid
.".html";

215 
$imgşs
 = "image".(
$phÙoid
-1);

216 
$»v®ue
 .= "<dl><dt>$alt<dd>$ddimg<dd>$ddimg<dd>$ddimg<dd><dd><div></div><div></div><dd><dd>$photoid</dd></dl>\r\n";

217 
$phÙoid
++;

220 
	`un£t
(
$d
);

221 
	`un£t
(
$images
);

222  
$»v®ue
;

223 
	}
}

226 
funùiÚ
 
	$Clo£
()

228 
	}
}

	@E:\web\weixun\functions\channelunit.func.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

9 if(!
	$is£t
(
$cfg_mašs™e
)è
	`exŒaù
(
$GLOBALS
, 
EXTR_SKIP
);

10 
glob®
 
$PubF›lds
,
$pTy³A¼ays
,
$idA¼¬y
,
$’vs
,
$v1
,
$v2
;

12 
$pTy³A¼ays
 = 
$idA¼¬y
 = 
$PubF›lds
 = 
$’vs
 = 
	`¬¿y
();

13 
$PubF›lds
['phpu¾'] = 
$cfg_phpu¾
;

14 
$PubF›lds
['šdexu¾'] = 
$cfg_mašs™e
.
$cfg_šdexu¾
;

15 
$PubF›lds
['‹m¶‘u¾'] = 
$cfg_‹m¶‘u¾
;

16 
$PubF›lds
['memb”u¾'] = 
$cfg_memb”u¾
;

17 
$PubF›lds
['¥ecu¾'] = 
$cfg_¥ecŸlu¾
;

18 
$PubF›lds
['šdexÇme'] = 
$cfg_šdexÇme
;

19 
$PubF›lds
['‹m¶‘def'] = 
$cfg_‹m¶‘s_dœ
.'/'.
$cfg_df_¡yË
;

20 
$’vs
['typeid'] = 0;

21 
$’vs
['reid'] = 0;

22 
$’vs
['aid'] = 0;

23 
$’vs
['keyword'] = '';

24 
$’vs
['idlist'] = '';

26 
	`h–³r
('channelunit');

	@E:\web\weixun\functions\charset.func.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

6 
h–³r
("charset");

	@E:\web\weixun\functions\ckeditor\ckeditor.inc.php

1 <?
php


2 
	g$toŞb¬
['Basic'] = 
¬¿y
(

3 
¬¿y
( 'Source','-','Templates'),

4 
¬¿y
( 'Cut','Copy','Paste','PasteText','PasteFromWord','-','Print'),

5 
¬¿y
( 'Undo','Redo','-','Find','Replace','-','SelectAll','RemoveFormat'),

6 
¬¿y
( 'ShowBlocks'),array('Image','Flash','Addon'),array('Maximize'),'/',

7 
¬¿y
( 'Bold','Italic','Underline','Strike','-'),

8 
¬¿y
( 'NumberedList','BulletedList','-','Outdent','Indent','Blockquote'),

9 
¬¿y
( 'JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock'),

10 
¬¿y
( 'Table','HorizontalRule','Smiley','SpecialChar'),

11 
¬¿y
( 'Link','Unlink','Anchor'),'/',

12 
¬¿y
( 'Styles','Format','Font','FontSize','Subscript','Superscript'),

13 
¬¿y
( 'TextColor', 'BGColor', 'MyPage','MultiPic')

15 
	g$toŞb¬
['DeçuÉ'] = 
¬¿y
(

16 
¬¿y
( 'Source','-','Templates'),

17 
¬¿y
( 'Cut','Copy','Paste','PasteText','PasteFromWord','-','Print'),

18 
¬¿y
( 'Undo','Redo','-','Find','Replace','-','SelectAll','RemoveFormat'),

19 
¬¿y
( 'ShowBlocks'),array('Image','Flash','Addon'),array('Maximize'),'/',

20 
¬¿y
( 'Bold','Italic','Underline','Strike','-'),

21 
¬¿y
( 'NumberedList','BulletedList','-','Outdent','Indent','Blockquote'),

22 
¬¿y
( 'JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock'),

23 
¬¿y
( 'Table','HorizontalRule','Smiley','SpecialChar'),

24 
¬¿y
( 'Link','Unlink','Anchor'),'/',

25 
¬¿y
( 'Styles','Format','Font','FontSize','Subscript','Superscript'),

26 
¬¿y
( 'TextColor', 'BGColor' )

28 
	g$toŞb¬
['Sm®l'] = 
¬¿y
(

29 
¬¿y
( 'Source','-','Templates'),

30 
¬¿y
( 'Cut','Copy','Paste','PasteText','PasteFromWord','-','Print'),

31 
¬¿y
( 'Undo','Redo','-','Find','Replace','-','SelectAll','RemoveFormat'),

32 
¬¿y
( 'Bold','Italic','Underline','Strike','-'),

33 
¬¿y
( 'Image','Flash'),

34 
¬¿y
( 'Table','HorizontalRule'),

35 
¬¿y
( 'Link','Unlink','Anchor'),'/',

36 
¬¿y
( 'Styles','Format','Font','FontSize'),

37 
¬¿y
( 'TextColor', 'BGColor')

39 
	g$toŞb¬
['Memb”'] = 
¬¿y
(

40 
¬¿y
( 'Source','-'),

41 
¬¿y
( 'Cut','Copy','Paste','PasteText','PasteFromWord','-','Print'),

42 
¬¿y
( 'Undo','Redo','-','Find','Replace','-','SelectAll','RemoveFormat'),

43 
¬¿y
( 'Bold','Italic','Underline','Strike','-'),

44 
¬¿y
( 'Table','HorizontalRule'),

45 
¬¿y
( 'Link','Unlink','Image','Anchor'),

46 
¬¿y
( 'Styles','Format','Font','FontSize'),

47 
¬¿y
( 'TextColor', 'BGColor')

49 
	g$toŞb¬
['Memb”L™'] = 
¬¿y
(

50 
¬¿y
( 'Source','-'),

51 
¬¿y
( 'Cut','Copy','Paste','PasteText','PasteFromWord','-','Print'),

52 
¬¿y
( 'Undo','Redo','-','Find','Replace','-','SelectAll','RemoveFormat'),

53 
¬¿y
( 'Bold','Italic','Underline','Strike','-'),

54 
¬¿y
( 'Table','HorizontalRule'),

55 
¬¿y
( 'Link','Unlink','Anchor'),

56 
¬¿y
( 'Styles','Format','Font','FontSize'),

57 
¬¿y
( 'TextColor', 'BGColor')

59 
	g$toŞb¬
['Diy'] = 
¬¿y
(

60 
¬¿y
( 'Source','-'),

61 
¬¿y
( 'Cut','Copy','Paste','PasteText','PasteFromWord','-','Print'),

62 
¬¿y
( 'Undo','Redo','-','Find','Replace','-','SelectAll','RemoveFormat'),

63 
¬¿y
( 'Bold','Italic','Underline','Strike','-'),

64 
¬¿y
( 'Table','HorizontalRule'),

65 
¬¿y
( 'Link','Unlink','Image','Anchor'),

66 
¬¿y
( 'Styles','Format','Font','FontSize'),

67 
¬¿y
( 'TextColor', 'BGColor')

69 
	g$toŞb¬
['F“dback'] = 
¬¿y
(

70 
¬¿y
( 'Source','-','Bold','Italic','Underline','-'),

71 
¬¿y
( 'FontSize', 'TextColor'),

72 
¬¿y
( 'Link', 'Unlink', 'Smiley')

	@E:\web\weixun\functions\ckeditor\ckeditor.php

1 <?
php


26 iàĞ!
funùiÚ_exi¡s
('v”siÚ_com·»'è|| 
v”siÚ_com·»
Ğ
phpv”siÚ
(), '5', '<' ) )

27 
šşude_Úû
( 'ckeditor_php4.php' ) ;

29 
šşude_Úû
( 'ckeditor_php5.php' ) ;

32 
»quœe_Úû
('ckeditor.inc.php');

	@E:\web\weixun\functions\ckeditor\ckeditor_php4.php

1 <?
php


18 şas 
	cCKEd™Ü


24 
v¬
 
	m$v”siÚ
 = '3.6.2';

29 
v¬
 
	m$_time¡amp
 = 'B8DJ5M3';

40 
v¬
 
	m$ba£P©h
;

52 
v¬
 
	m$cÚfig
 = 
¬¿y
();

58 
v¬
 
	m$š™Ÿlized
 = 
çl£
;

71 
v¬
 
	m$»tuºOuut
 = 
çl£
;

78 
v¬
 
	m$‹x»aA‰ribu‹s
 = 
¬¿y
( "rows" => 8, "cols" => 60 );

83 
v¬
 
	m$time¡amp
 = "B8DJ5M3";

88 
v¬
 
	m$_ev’ts
 = 
¬¿y
();

93 
v¬
 
	m$_glob®Ev’ts
 = 
¬¿y
();

100 
funùiÚ
 
	$CKEd™Ü
(
$ba£P©h
 = 
nuÎ
) {

101 ià(!
	`em±y
(
$ba£P©h
)) {

102 
$this
->
ba£P©h
 = 
$ba£P©h
;

135 
funùiÚ
 
	`ed™Ü
(
$Çme
, 
$v®ue
 = "", 
$cÚfig
 = 
	`¬¿y
(), 
$ev’ts
 = 
	$¬¿y
())

137 
$©Œ
 = "";

138 
	`fÜ—ch
 (
$this
->
‹x»aA‰ribu‹s
 
as
 
$key
 => 
$v®
) {

139 
$©Œ
.ğ" " . 
$key
 . '="' . 
	`¡r_»¶aû
('"', '&quÙ;', 
$v®
) . '"';

141 
$out
 = "<‹x»¨Çme=\"" . 
$Çme
 . "\"" . 
$©Œ
 . ">" . 
	`html¥ecŸlch¬s
(
$v®ue
) . "</textarea>\n";

142 ià(!
$this
->
š™Ÿlized
) {

143 
$out
 .ğ
$this
->
	`š™
();

146 
$_cÚfig
 = 
$this
->
	`cÚfigS‘tšgs
(
$cÚfig
, 
$ev’ts
);

148 
$js
 = 
$this
->
	`»tuºGlob®Ev’ts
();

149 ià(!
	`em±y
(
$_cÚfig
))

150 
$js
 .ğ"CKEDITOR.»¶aû('".
$Çme
."', ".
$this
->
	`jsEncode
(
$_cÚfig
).");";

152 
$js
 .ğ"CKEDITOR.»¶aû('".
$Çme
."');";

154 
$out
 .ğ
$this
->
	`süt
(
$js
);

156 ià(!
$this
->
»tuºOuut
) {

157 
´št
 
$out
;

158 
$out
 = "";

161  
$out
;

162 
	}
}

177 
funùiÚ
 
»¶aû
(
$id
, 
$cÚfig
 = 
¬¿y
(), 
$ev’ts
 = 
	$¬¿y
())

179 
$out
 = "";

180 ià(!
$this
->
š™Ÿlized
) {

181 
$out
 .ğ
$this
->
	`š™
();

184 
$_cÚfig
 = 
$this
->
	`cÚfigS‘tšgs
(
$cÚfig
, 
$ev’ts
);

186 
$js
 = 
$this
->
	`»tuºGlob®Ev’ts
();

187 ià(!
	`em±y
(
$_cÚfig
)) {

188 
$js
 .ğ"CKEDITOR.»¶aû('".
$id
."', ".
$this
->
	`jsEncode
(
$_cÚfig
).");";

191 
$js
 .ğ"CKEDITOR.»¶aû('".
$id
."');";

193 
$out
 .ğ
$this
->
	`süt
(
$js
);

195 ià(!
$this
->
»tuºOuut
) {

196 
´št
 
$out
;

197 
$out
 = "";

200  
$out
;

201 
	}
}

220 
funùiÚ
 
	$»¶aûAÎ
(
$şassName
 = 
nuÎ
)

222 
$out
 = "";

223 ià(!
$this
->
š™Ÿlized
) {

224 
$out
 .ğ
$this
->
	`š™
();

227 
$_cÚfig
 = 
$this
->
	`cÚfigS‘tšgs
();

229 
$js
 = 
$this
->
	`»tuºGlob®Ev’ts
();

230 ià(
	`em±y
(
$_cÚfig
)) {

231 ià(
	`em±y
(
$şassName
)) {

232 
$js
 .= "CKEDITOR.replaceAll();";

235 
$js
 .ğ"CKEDITOR.»¶aûAÎ('".
$şassName
."');";

239 
$şassD‘eùiÚ
 = "";

240 
$js
 .= "CKEDITOR.replaceAll( function(textarea, config) {\n";

241 ià(!
	`em±y
(
$şassName
)) {

242 
$js
 .ğ" v¬ cÏssRegex =‚ew RegExp('(?:^| )' + '". 
$şassName
 ."' + '(?:$| )');\n";

243 
$js
 .= " if (!classRegex.test(textarea.className))\n";

244 
$js
 .= "„eturn false;\n";

246 
$js
 .ğ" CKEDITOR.toŞs.ex‹nd(cÚfig, ". 
$this
->
	`jsEncode
(
$_cÚfig
) .",rue);";

247 
$js
 .= "} );";

251 
$out
 .ğ
$this
->
	`süt
(
$js
);

253 ià(!
$this
->
»tuºOuut
) {

254 
´št
 
$out
;

255 
$out
 = "";

258  
$out
;

259 
	}
}

275 
funùiÚ
 
	$addEv’tHªdËr
(
$ev’t
, 
$javasütCode
)

277 ià(!
	`is£t
(
$this
->
_ev’ts
[
$ev’t
])) {

278 
$this
->
_ev’ts
[
$ev’t
] = 
	`¬¿y
();

281 ià(!
	`š_¬¿y
(
$javasütCode
, 
$this
->
_ev’ts
[
$ev’t
])) {

282 
$this
->
_ev’ts
[
$ev’t
][] = 
$javasütCode
;

284 
	}
}

292 
funùiÚ
 
	$ş—rEv’tHªdËrs
(
$ev’t
 = 
nuÎ
)

294 ià(!
	`em±y
(
$ev’t
)) {

295 
$this
->
_ev’ts
[
$ev’t
] = 
	`¬¿y
();

298 
$this
->
_ev’ts
 = 
	`¬¿y
();

300 
	}
}

315 
funùiÚ
 
	$addGlob®Ev’tHªdËr
(
$ev’t
, 
$javasütCode
)

317 ià(!
	`is£t
(
$this
->
_glob®Ev’ts
[
$ev’t
])) {

318 
$this
->
_glob®Ev’ts
[
$ev’t
] = 
	`¬¿y
();

321 ià(!
	`š_¬¿y
(
$javasütCode
, 
$this
->
_glob®Ev’ts
[
$ev’t
])) {

322 
$this
->
_glob®Ev’ts
[
$ev’t
][] = 
$javasütCode
;

324 
	}
}

332 
funùiÚ
 
	$ş—rGlob®Ev’tHªdËrs
(
$ev’t
 = 
nuÎ
)

334 ià(!
	`em±y
(
$ev’t
)) {

335 
$this
->
_glob®Ev’ts
[
$ev’t
] = 
	`¬¿y
();

338 
$this
->
_glob®Ev’ts
 = 
	`¬¿y
();

340 
	}
}

348 
funùiÚ
 
	$süt
(
$js
)

350 
$out
 = "<scriptype=\"text/javascript\">";

351 
$out
 .= "//<![CDATA[\n";

352 
$out
 .ğ
$js
;

353 
$out
 .= "\n//]]>";

354 
$out
 .= "</script>\n";

356  
$out
;

357 
	}
}

366 
funùiÚ
 
cÚfigS‘tšgs
(
$cÚfig
 = 
¬¿y
(), 
$ev’ts
 = 
	$¬¿y
())

368 
$_cÚfig
 = 
$this
->
cÚfig
;

369 
$_ev’ts
 = 
$this
->
_ev’ts
;

371 ià(
	`is_¬¿y
(
$cÚfig
è&& !
	`em±y
($config)) {

372 
$_cÚfig
 = 
	`¬¿y_m”ge
($_cÚfig, 
$cÚfig
);

375 ià(
	`is_¬¿y
(
$ev’ts
è&& !
	`em±y
($events)) {

376 
	`fÜ—ch
 (
$ev’ts
 
as
 
$ev’tName
 => 
$code
) {

377 ià(!
	`is£t
(
$_ev’ts
[
$ev’tName
])) {

378 
$_ev’ts
[
$ev’tName
] = 
	`¬¿y
();

380 ià(!
	`š_¬¿y
(
$code
, 
$_ev’ts
[
$ev’tName
])) {

381 
$_ev’ts
[
$ev’tName
][] = 
$code
;

386 ià(!
	`em±y
(
$_ev’ts
)) {

387 
	`fÜ—ch
(
$_ev’ts
 
as
 
$ev’tName
 => 
$hªdËrs
) {

388 ià(
	`em±y
(
$hªdËrs
)) {

391 ià(
	`couÁ
(
$hªdËrs
) == 1) {

392 
$_cÚfig
['Ú'][
$ev’tName
] = '@@'.
$hªdËrs
[0];

395 
$_cÚfig
['Ú'][
$ev’tName
] = '@@function (ev){';

396 
	`fÜ—ch
 (
$hªdËrs
 
as
 
$hªdËr
 => 
$code
) {

397 
$_cÚfig
['Ú'][
$ev’tName
] .ğ'('.
$code
.')(ev);';

399 
$_cÚfig
['Ú'][
$ev’tName
] .= '}';

404  
$_cÚfig
;

405 
	}
}

411 
funùiÚ
 
	$»tuºGlob®Ev’ts
()

413 
$»tuºedEv’ts
;

414 
$out
 = "";

416 ià(!
	`is£t
(
$»tuºedEv’ts
)) {

417 
$»tuºedEv’ts
 = 
	`¬¿y
();

420 ià(!
	`em±y
(
$this
->
_glob®Ev’ts
)) {

421 
	`fÜ—ch
 (
$this
->
_glob®Ev’ts
 
as
 
$ev’tName
 => 
$hªdËrs
) {

422 
	`fÜ—ch
 (
$hªdËrs
 
as
 
$hªdËr
 => 
$code
) {

423 ià(!
	`is£t
(
$»tuºedEv’ts
[
$ev’tName
])) {

424 
$»tuºedEv’ts
[
$ev’tName
] = 
	`¬¿y
();

427 ià(!
	`š_¬¿y
(
$code
, 
$»tuºedEv’ts
[
$ev’tName
])) {

428 
$out
 .ğ(
$code
 ? "\n" : ""è. "CKEDITOR.Ú('". 
$ev’tName
 ."', $code);";

429 
$»tuºedEv’ts
[
$ev’tName
][] = 
$code
;

435  
$out
;

436 
	}
}

442 
funùiÚ
 
	$š™
()

444 
$š™Com¶‘e
;

445 
$out
 = "";

447 ià(!
	`em±y
(
$š™Com¶‘e
)) {

451 ià(
$this
->
š™Ÿlized
) {

452 
$š™Com¶‘e
 = 
Œue
;

456 
$¬gs
 = "";

457 
$cked™ÜP©h
 = 
$this
->
	`cked™ÜP©h
();

459 ià(!
	`em±y
(
$this
->
time¡amp
) && $this->timestamp != "%"."TIMESTAMP%") {

460 
$¬gs
 = '?t=' . 
$this
->
time¡amp
;

464 ià(
	`¡½os
(
$cked™ÜP©h
, '..') !== 0) {

465 
$out
 .ğ
$this
->
	`süt
("wšdow.CKEDITOR_BASEPATH='". 
$cked™ÜP©h
 ."';");

468 
$out
 .ğ"<süˆty³=\"‹xt/javasüt\" src=\"" . 
$cked™ÜP©h
 . 'cked™Ü.js' . 
$¬gs
 . "\"></script>\n";

470 
$exŒaCode
 = "";

471 ià(
$this
->
time¡amp
 !ğ$this->
_time¡amp
) {

472 
$exŒaCode
 .ğ($exŒaCod? "\n" : ""è. "CKEDITOR.time¡am°ğ'". 
$this
->
time¡amp
 ."';";

474 ià(
$exŒaCode
) {

475 
$out
 .ğ
$this
->
	`süt
(
$exŒaCode
);

478 
$š™Com¶‘e
 = 
$this
->
š™Ÿlized
 = 
Œue
;

480  
$out
;

481 
	}
}

487 
funùiÚ
 
	$cked™ÜP©h
()

489 ià(!
	`em±y
(
$this
->
ba£P©h
)) {

490  
$this
->
ba£P©h
;

498 ià(
	`is£t
(
$_SERVER
['SCRIPT_FILENAME'])) {

499 
$»®P©h
 = 
	`dœÇme
(
$_SERVER
['SCRIPT_FILENAME']);

505 
$»®P©h
 = 
	`»®·th
( './' ) ;

513 
$£lfP©h
 = 
	`dœÇme
(
$_SERVER
['PHP_SELF']);

514 
$fe
 = 
	`¡r_»¶aû
("\\", "/", 
__FILE__
);

516 ià(!
$£lfP©h
 || !
$»®P©h
 || !
$fe
) {

520 
$docum’tRoÙ
 = 
	`sub¡r
(
$»®P©h
, 0, 
	`¡¾’
($»®P©hè- sŒËn(
$£lfP©h
));

521 
$feU¾
 = 
	`sub¡r
(
$fe
, 
	`¡¾’
(
$docum’tRoÙ
));

522 
$cked™ÜU¾
 = 
	`¡r_»¶aû
("cked™Ü_php4.php", "", 
$feU¾
);

524  
$cked™ÜU¾
;

525 
	}
}

534 
funùiÚ
 
	$jsEncode
(
$v®
)

536 ià(
	`is_nuÎ
(
$v®
)) {

539 ià(
	`is_boŞ
(
$v®
)) {

540  
$v®
 ? 'true' : 'false';

542 ià(
	`is_št
(
$v®
)) {

543  
$v®
;

545 ià(
	`is_æßt
(
$v®
)) {

546  
	`¡r_»¶aû
(',', '.', 
$v®
);

548 ià(
	`is_¬¿y
(
$v®
è|| 
	`is_objeù
($val)) {

549 ià(
	`is_¬¿y
(
$v®
è&& (
	`¬¿y_keys
($v®è==ğ
	`¿nge
(0,
	`couÁ
($val)-1))) {

550  '[' . 
	`im¶ode
(',', 
	`¬¿y_m­
(
	`¬¿y
(
$this
, 'jsEncode'), 
$v®
)) . ']';

552 
$‹mp
 = 
	`¬¿y
();

553 
	`fÜ—ch
 (
$v®
 
as
 
$k
 => 
$v
){

554 
$‹mp
[] = 
$this
->
	`jsEncode
("{$k}"è. ':' . $this->jsEncode(
$v
);

556  '{' . 
	`im¶ode
(',', 
$‹mp
) . '}';

559 ià(
	`¡½os
(
$v®
, '@@') === 0)

560  
	`sub¡r
(
$v®
, 2);

561 ià(
	`¡¹ouµ”
(
	`sub¡r
(
$v®
, 0, 9)) == 'CKEDITOR.')

562  
$v®
;

564  '"' . 
	`¡r_»¶aû
(
	`¬¿y
("\\", "/", "\n", "\t", "\r", "\x08", "\x0c", '"'),‡¼ay('\\\\', '\\/', '\\n', '\\t', '\\r', '\\b', '\\f', '\"'), 
$v®
) . '"';

565 
	}
}

	@E:\web\weixun\functions\ckeditor\ckeditor_php5.php

1 <?
php


18 şas 
	cCKEd™Ü


23 cÚ¡ 
	mv”siÚ
 = '3.6.2';

27 cÚ¡ 
	mtime¡amp
 = 'B8DJ5M3';

38 
public
 
	m$ba£P©h
;

50 
public
 
	m$cÚfig
 = 
¬¿y
();

56 
public
 
	m$š™Ÿlized
 = 
çl£
;

69 
public
 
	m$»tuºOuut
 = 
çl£
;

76 
public
 
	m$‹x»aA‰ribu‹s
 = 
¬¿y
( "rows" => 8, "cols" => 60 );

81 
public
 
	m$time¡amp
 = "B8DJ5M3";

85 
´iv©e
 
	m$ev’ts
 = 
¬¿y
();

89 
´iv©e
 
	m$glob®Ev’ts
 = 
¬¿y
();

96 
funùiÚ
 
	$__cÚ¡ruù
(
$ba£P©h
 = 
nuÎ
) {

97 ià(!
	`em±y
(
$ba£P©h
)) {

98 
$this
->
ba£P©h
 = 
$ba£P©h
;

131 
public
 
funùiÚ
 
	`ed™Ü
(
$Çme
, 
$v®ue
 = "", 
$cÚfig
 = 
	`¬¿y
(), 
$ev’ts
 = 
	$¬¿y
())

133 
$©Œ
 = "";

134 
	`fÜ—ch
 (
$this
->
‹x»aA‰ribu‹s
 
as
 
$key
 => 
$v®
) {

135 
$©Œ
.ğ" " . 
$key
 . '="' . 
	`¡r_»¶aû
('"', '&quÙ;', 
$v®
) . '"';

137 
$out
 = "<‹x»¨Çme=\"" . 
$Çme
 . "\"" . 
$©Œ
 . ">" . 
	`html¥ecŸlch¬s
(
$v®ue
) . "</textarea>\n";

138 ià(!
$this
->
š™Ÿlized
) {

139 
$out
 .ğ
$this
->
	`š™
();

142 
$_cÚfig
 = 
$this
->
	`cÚfigS‘tšgs
(
$cÚfig
, 
$ev’ts
);

144 
$js
 = 
$this
->
	`»tuºGlob®Ev’ts
();

145 ià(!
	`em±y
(
$_cÚfig
))

146 
$js
 .ğ"CKEDITOR.»¶aû('".
$Çme
."', ".
$this
->
	`jsEncode
(
$_cÚfig
).");";

148 
$js
 .ğ"CKEDITOR.»¶aû('".
$Çme
."');";

150 
$out
 .ğ
$this
->
	`süt
(
$js
);

152 ià(!
$this
->
»tuºOuut
) {

153 
´št
 
$out
;

154 
$out
 = "";

157  
$out
;

158 
	}
}

173 
public
 
funùiÚ
 
»¶aû
(
$id
, 
$cÚfig
 = 
¬¿y
(), 
$ev’ts
 = 
	$¬¿y
())

175 
$out
 = "";

176 ià(!
$this
->
š™Ÿlized
) {

177 
$out
 .ğ
$this
->
	`š™
();

180 
$_cÚfig
 = 
$this
->
	`cÚfigS‘tšgs
(
$cÚfig
, 
$ev’ts
);

182 
$js
 = 
$this
->
	`»tuºGlob®Ev’ts
();

183 ià(!
	`em±y
(
$_cÚfig
)) {

184 
$js
 .ğ"CKEDITOR.»¶aû('".
$id
."', ".
$this
->
	`jsEncode
(
$_cÚfig
).");";

187 
$js
 .ğ"CKEDITOR.»¶aû('".
$id
."');";

189 
$out
 .ğ
$this
->
	`süt
(
$js
);

191 ià(!
$this
->
»tuºOuut
) {

192 
´št
 
$out
;

193 
$out
 = "";

196  
$out
;

197 
	}
}

216 
public
 
funùiÚ
 
	$»¶aûAÎ
(
$şassName
 = 
nuÎ
)

218 
$out
 = "";

219 ià(!
$this
->
š™Ÿlized
) {

220 
$out
 .ğ
$this
->
	`š™
();

223 
$_cÚfig
 = 
$this
->
	`cÚfigS‘tšgs
();

225 
$js
 = 
$this
->
	`»tuºGlob®Ev’ts
();

226 ià(
	`em±y
(
$_cÚfig
)) {

227 ià(
	`em±y
(
$şassName
)) {

228 
$js
 .= "CKEDITOR.replaceAll();";

231 
$js
 .ğ"CKEDITOR.»¶aûAÎ('".
$şassName
."');";

235 
$şassD‘eùiÚ
 = "";

236 
$js
 .= "CKEDITOR.replaceAll( function(textarea, config) {\n";

237 ià(!
	`em±y
(
$şassName
)) {

238 
$js
 .ğ" v¬ cÏssRegex =‚ew RegExp('(?:^| )' + '". 
$şassName
 ."' + '(?:$| )');\n";

239 
$js
 .= " if (!classRegex.test(textarea.className))\n";

240 
$js
 .= "„eturn false;\n";

242 
$js
 .ğ" CKEDITOR.toŞs.ex‹nd(cÚfig, ". 
$this
->
	`jsEncode
(
$_cÚfig
) .",rue);";

243 
$js
 .= "} );";

247 
$out
 .ğ
$this
->
	`süt
(
$js
);

249 ià(!
$this
->
»tuºOuut
) {

250 
´št
 
$out
;

251 
$out
 = "";

254  
$out
;

255 
	}
}

271 
public
 
funùiÚ
 
	$addEv’tHªdËr
(
$ev’t
, 
$javasütCode
)

273 ià(!
	`is£t
(
$this
->
ev’ts
[
$ev’t
])) {

274 
$this
->
ev’ts
[
$ev’t
] = 
	`¬¿y
();

277 ià(!
	`š_¬¿y
(
$javasütCode
, 
$this
->
ev’ts
[
$ev’t
])) {

278 
$this
->
ev’ts
[
$ev’t
][] = 
$javasütCode
;

280 
	}
}

288 
public
 
funùiÚ
 
	$ş—rEv’tHªdËrs
(
$ev’t
 = 
nuÎ
)

290 ià(!
	`em±y
(
$ev’t
)) {

291 
$this
->
ev’ts
[
$ev’t
] = 
	`¬¿y
();

294 
$this
->
ev’ts
 = 
	`¬¿y
();

296 
	}
}

311 
public
 
funùiÚ
 
	$addGlob®Ev’tHªdËr
(
$ev’t
, 
$javasütCode
)

313 ià(!
	`is£t
(
$this
->
glob®Ev’ts
[
$ev’t
])) {

314 
$this
->
glob®Ev’ts
[
$ev’t
] = 
	`¬¿y
();

317 ià(!
	`š_¬¿y
(
$javasütCode
, 
$this
->
glob®Ev’ts
[
$ev’t
])) {

318 
$this
->
glob®Ev’ts
[
$ev’t
][] = 
$javasütCode
;

320 
	}
}

328 
public
 
funùiÚ
 
	$ş—rGlob®Ev’tHªdËrs
(
$ev’t
 = 
nuÎ
)

330 ià(!
	`em±y
(
$ev’t
)) {

331 
$this
->
glob®Ev’ts
[
$ev’t
] = 
	`¬¿y
();

334 
$this
->
glob®Ev’ts
 = 
	`¬¿y
();

336 
	}
}

343 
´iv©e
 
funùiÚ
 
	$süt
(
$js
)

345 
$out
 = "<scriptype=\"text/javascript\">";

346 
$out
 .= "//<![CDATA[\n";

347 
$out
 .ğ
$js
;

348 
$out
 .= "\n//]]>";

349 
$out
 .= "</script>\n";

351  
$out
;

352 
	}
}

360 
´iv©e
 
funùiÚ
 
cÚfigS‘tšgs
(
$cÚfig
 = 
¬¿y
(), 
$ev’ts
 = 
	$¬¿y
())

362 
$_cÚfig
 = 
$this
->
cÚfig
;

363 
$_ev’ts
 = 
$this
->
ev’ts
;

365 ià(
	`is_¬¿y
(
$cÚfig
è&& !
	`em±y
($config)) {

366 
$_cÚfig
 = 
	`¬¿y_m”ge
($_cÚfig, 
$cÚfig
);

369 ià(
	`is_¬¿y
(
$ev’ts
è&& !
	`em±y
($events)) {

370 
	`fÜ—ch
 (
$ev’ts
 
as
 
$ev’tName
 => 
$code
) {

371 ià(!
	`is£t
(
$_ev’ts
[
$ev’tName
])) {

372 
$_ev’ts
[
$ev’tName
] = 
	`¬¿y
();

374 ià(!
	`š_¬¿y
(
$code
, 
$_ev’ts
[
$ev’tName
])) {

375 
$_ev’ts
[
$ev’tName
][] = 
$code
;

380 ià(!
	`em±y
(
$_ev’ts
)) {

381 
	`fÜ—ch
(
$_ev’ts
 
as
 
$ev’tName
 => 
$hªdËrs
) {

382 ià(
	`em±y
(
$hªdËrs
)) {

385 ià(
	`couÁ
(
$hªdËrs
) == 1) {

386 
$_cÚfig
['Ú'][
$ev’tName
] = '@@'.
$hªdËrs
[0];

389 
$_cÚfig
['Ú'][
$ev’tName
] = '@@function (ev){';

390 
	`fÜ—ch
 (
$hªdËrs
 
as
 
$hªdËr
 => 
$code
) {

391 
$_cÚfig
['Ú'][
$ev’tName
] .ğ'('.
$code
.')(ev);';

393 
$_cÚfig
['Ú'][
$ev’tName
] .= '}';

398  
$_cÚfig
;

399 
	}
}

404 
´iv©e
 
funùiÚ
 
	$»tuºGlob®Ev’ts
()

406 
$»tuºedEv’ts
;

407 
$out
 = "";

409 ià(!
	`is£t
(
$»tuºedEv’ts
)) {

410 
$»tuºedEv’ts
 = 
	`¬¿y
();

413 ià(!
	`em±y
(
$this
->
glob®Ev’ts
)) {

414 
	`fÜ—ch
 (
$this
->
glob®Ev’ts
 
as
 
$ev’tName
 => 
$hªdËrs
) {

415 
	`fÜ—ch
 (
$hªdËrs
 
as
 
$hªdËr
 => 
$code
) {

416 ià(!
	`is£t
(
$»tuºedEv’ts
[
$ev’tName
])) {

417 
$»tuºedEv’ts
[
$ev’tName
] = 
	`¬¿y
();

420 ià(!
	`š_¬¿y
(
$code
, 
$»tuºedEv’ts
[
$ev’tName
])) {

421 
$out
 .ğ(
$code
 ? "\n" : ""è. "CKEDITOR.Ú('". 
$ev’tName
 ."', $code);";

422 
$»tuºedEv’ts
[
$ev’tName
][] = 
$code
;

428  
$out
;

429 
	}
}

434 
´iv©e
 
funùiÚ
 
	$š™
()

436 
$š™Com¶‘e
;

437 
$out
 = "";

439 ià(!
	`em±y
(
$š™Com¶‘e
)) {

443 ià(
$this
->
š™Ÿlized
) {

444 
$š™Com¶‘e
 = 
Œue
;

448 
$¬gs
 = "";

449 
$cked™ÜP©h
 = 
$this
->
	`cked™ÜP©h
();

451 ià(!
	`em±y
(
$this
->
time¡amp
) && $this->timestamp != "%"."TIMESTAMP%") {

452 
$¬gs
 = '?t=' . 
$this
->
time¡amp
;

456 ià(
	`¡½os
(
$cked™ÜP©h
, '..') !== 0) {

457 
$out
 .ğ
$this
->
	`süt
("wšdow.CKEDITOR_BASEPATH='". 
$cked™ÜP©h
 ."';");

460 
$out
 .ğ"<süˆty³=\"‹xt/javasüt\" src=\"" . 
$cked™ÜP©h
 . 'cked™Ü.js' . 
$¬gs
 . "\"></script>\n";

462 
$exŒaCode
 = "";

463 ià(
$this
->
time¡amp
 !ğ
£lf
::timestamp) {

464 
$exŒaCode
 .ğ($exŒaCod? "\n" : ""è. "CKEDITOR.time¡am°ğ'". 
$this
->
time¡amp
 ."';";

466 ià(
$exŒaCode
) {

467 
$out
 .ğ
$this
->
	`süt
(
$exŒaCode
);

470 
$š™Com¶‘e
 = 
$this
->
š™Ÿlized
 = 
Œue
;

472  
$out
;

473 
	}
}

478 
´iv©e
 
funùiÚ
 
	$cked™ÜP©h
()

480 ià(!
	`em±y
(
$this
->
ba£P©h
)) {

481  
$this
->
ba£P©h
;

489 ià(
	`is£t
(
$_SERVER
['SCRIPT_FILENAME'])) {

490 
$»®P©h
 = 
	`dœÇme
(
$_SERVER
['SCRIPT_FILENAME']);

496 
$»®P©h
 = 
	`»®·th
( './' ) ;

504 
$£lfP©h
 = 
	`dœÇme
(
$_SERVER
['PHP_SELF']);

505 
$fe
 = 
	`¡r_»¶aû
("\\", "/", 
__FILE__
);

507 ià(!
$£lfP©h
 || !
$»®P©h
 || !
$fe
) {

511 
$docum’tRoÙ
 = 
	`sub¡r
(
$»®P©h
, 0, 
	`¡¾’
($»®P©hè- sŒËn(
$£lfP©h
));

512 
$feU¾
 = 
	`sub¡r
(
$fe
, 
	`¡¾’
(
$docum’tRoÙ
));

513 
$cked™ÜU¾
 = 
	`¡r_»¶aû
("cked™Ü_php5.php", "", 
$feU¾
);

515  
$cked™ÜU¾
;

516 
	}
}

524 
´iv©e
 
funùiÚ
 
	$jsEncode
(
$v®
)

526 ià(
	`is_nuÎ
(
$v®
)) {

529 ià(
	`is_boŞ
(
$v®
)) {

530  
$v®
 ? 'true' : 'false';

532 ià(
	`is_št
(
$v®
)) {

533  
$v®
;

535 ià(
	`is_æßt
(
$v®
)) {

536  
	`¡r_»¶aû
(',', '.', 
$v®
);

538 ià(
	`is_¬¿y
(
$v®
è|| 
	`is_objeù
($val)) {

539 ià(
	`is_¬¿y
(
$v®
è&& (
	`¬¿y_keys
($v®è==ğ
	`¿nge
(0,
	`couÁ
($val)-1))) {

540  '[' . 
	`im¶ode
(',', 
	`¬¿y_m­
(
	`¬¿y
(
$this
, 'jsEncode'), 
$v®
)) . ']';

542 
$‹mp
 = 
	`¬¿y
();

543 
	`fÜ—ch
 (
$v®
 
as
 
$k
 => 
$v
){

544 
$‹mp
[] = 
$this
->
	`jsEncode
("{$k}"è. ':' . $this->jsEncode(
$v
);

546  '{' . 
	`im¶ode
(',', 
$‹mp
) . '}';

549 ià(
	`¡½os
(
$v®
, '@@') === 0)

550  
	`sub¡r
(
$v®
, 2);

551 ià(
	`¡¹ouµ”
(
	`sub¡r
(
$v®
, 0, 9)) == 'CKEDITOR.')

552  
$v®
;

554  '"' . 
	`¡r_»¶aû
(
	`¬¿y
("\\", "/", "\n", "\t", "\r", "\x08", "\x0c", '"'),‡¼ay('\\\\', '\\/', '\\n', '\\t', '\\r', '\\b', '\\f', '\"'), 
$v®
) . '"';

555 
	}
}

	@E:\web\weixun\functions\common.func.php

1 <?
php


6 if(!
defšed
('XAKINC')è
ex™
('Error');

15 
	g$_h–³rs
 = 
¬¿y
();

16 
funùiÚ
 
	$h–³r
(
$h–³rs
)

19 ià(
	`is_¬¿y
(
$h–³rs
))

21 
	`fÜ—ch
(
$h–³rs
 
as
 
$Xak
)

23 
	`h–³r
(
$Xak
);

28 ià(
	`is£t
(
$_h–³rs
[
$h–³rs
]))

32 ià(
	`fe_exi¡s
(
XAKINC
.'/h–³rs/'.
$h–³rs
.'.helper.php'))

34 
	`šşude_Úû
(
XAKINC
.'/h–³rs/'.
$h–³rs
.'.helper.php');

35 
$_h–³rs
[
$h–³rs
] = 
TRUE
;

38 iàĞ! 
	`is£t
(
$_h–³rs
[
$h–³rs
]))

40 
	`ex™
('UÇbËØlßdh»que¡ed fe: h–³rs/'.
$h–³rs
.'.helper.php');

42 
	}
}

53 
funùiÚ
 
RunAµ
(
$ù
, 
$ac
 = '',
$dœeùÜy
 = '')

56 
$ù
 = 
´eg_»¶aû
("/[^0-9a-z_]/i", '', $ct);

57 
	g$ac
 = 
´eg_»¶aû
("/[^0-9a-z_]/i", '', 
$ac
);

59 
	g$ac
 = 
em±y
 ( 
$ac
 ) ? $ac = 'index' : $ac;

60 if(!
em±y
(
$dœeùÜy
)è
	g$·th
 = 
XAKCONTROL
.'/'.$dœeùÜy. '/' . 
$ù
 . '.php';

61 
	g$·th
 = 
XAKCONTROL
 . '/' . 
$ù
 . '.php';

63 ià(
fe_exi¡s
 ( 
$·th
 ))

65 
»quœe
 
	g$·th
;

67 ià(
	gDEBUG_LEVEL
 ==ğ
TRUE
)

69 
Œigg”_”rÜ
("Load Controller false!");

74 
h—d”
 ( "location:/404.html" );

75 
d›
 ();

78 
	g$aùiÚ
 = 'ac_'.
$ac
;

79 
	g$lßd”r
 = 
FALSE
;

80 
	g$š¡ªû
 = 
Ãw
 
$ù
 ( );

81 ià(
m‘hod_exi¡s
 ( 
$š¡ªû
, 
$aùiÚ
 ) ==ğ
TRUE
)

83 
$š¡ªû
->
$aùiÚ
();

84 
un£t
(
$š¡ªû
);

85 } 
	g$lßd”r
 = 
TRUE
;

87 ià(
	g$lßd”r
)

89 ià(
	gDEBUG_LEVEL
 ==ğ
TRUE
)

91 
Œigg”_”rÜ
("Load Method false!");

96 
h—d”
 ( "location:/404.html" );

97 
d›
 ();

109 
funùiÚ
 
	$h–³rs
(
$h–³rs
)

111 
	`h–³r
(
$h–³rs
);

112 
	}
}

115 if(!
funùiÚ_exi¡s
('file_put_contents'))

117 
funùiÚ
 
fe_put_cÚ‹Ás
(
$n
, 
$d
)

119 
	g$f
=@
fİ’
(
$n
, "w");

120 ià(!
	g$f
)

122  
	gFALSE
;

126 
fwr™e
(
$f
, 
$d
);

127 
fşo£
(
$f
);

128  
	gTRUE
;

138 
funùiÚ
 
	$Upd©eSt
()

140 
	`šşude_Úû
(
XAKINC
."/inc/inc_stat.php");

141  
	`SpUpd©eSt
();

142 
	}
}

154 
funùiÚ
 
	$ShowMsg
(
$msg
, 
$gou¾
, 
$Úlymsg
=0, 
$lim™time
=0)

156 if(
	`em±y
(
$GLOBALS
['cfg_plus_dir'])) $GLOBALS['cfg_plus_dir'] = '..';

158 
$htmlh—d
 = "<html>\r\n<head>\r\n<title>ç³»ç»Ÿæç¤ºä¿¡æ¯</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n";

159 
$htmlh—d
 .ğ"<ba£¬g‘='_£lf'/>\r\n<¡yË>div{lše-height:160%;}</¡yË></h—d>\r\n<body†eám¬gš='0'İm¬gš='0' bgcŞÜ='#FFFFFF'>".(
	`is£t
(
$GLOBALS
['ucsynlogin']) ? $GLOBALS['ucsynlogin'] : '')."\r\n<center>\r\n<script>\r\n";

160 
$htmlfoÙ
 = "</script>\r\n</center>\r\n</body>\r\n</html>\r\n";

162 
$l™ime
 = (
$lim™time
==0 ? 1000 : $limittime);

163 
$func
 = '';

165 if(
$gou¾
=='-1')

167 if(
$lim™time
==0è
$l™ime
 = 5000;

168 
$gou¾
 = "javascript:history.go(-1);";

171 if(
$gou¾
=='' || 
$Úlymsg
==1)

173 
$msg
 = "<süt>®”t(\"".
	`¡r_»¶aû
("\"","â€œ",$msg)."\");</script>";

178 if(
	`´eg_m©ch
('/şo£::/',
$gou¾
))

180 
$tgobj
 = 
	`Œim
(
	`´eg_»¶aû
('/şo£::/', '', 
$gou¾
));

181 
$gou¾
 = 'javascript:;';

182 
$func
 .= "window.parent.document.getElementById('{$tgobj}').style.display='none';\r\n";

185 
$func
 .= " var…go=0;

186 
funùiÚ
 
	`JumpU¾
(){

187 if(
pgo
==0){ 
loÿtiÚ
='$gourl';…go=1; }

188 }\
r
\
n
";

189 
$rmsg
 = 
$func
;

190 
$rmsg
 .= "document.write(\"<br /><div style='width:450px;padding:0px;border:1px solid #DADADA;'>";

191 
$rmsg
 .= "<div style='padding:6px;font-size:12px;border-bottom:1px solid #DADADA;background:#DBEEBD url({$GLOBALS['cfg_plus_dir']}/img/wbg.gif)';'><b>ç³»ç»Ÿæç¤ºä¿¡æ¯ï¼</b></div>\");\r\n";

192 
$rmsg
 .= "document.write(\"<div style='height:130px;font-size:10pt;background:#ffffff'><br />\");\r\n";

193 
$rmsg
 .ğ"docum’t.wr™e(\"".
	`¡r_»¶aû
("\"","â€œ",
$msg
)."\");\r\n";

194 
$rmsg
 .= "document.write(\"";

196 if(
$Úlymsg
==0)

198 ifĞ
$gou¾
 != 'javascript:;' && $gourl != '')

200 
$rmsg
 .= "<br /><a href='{$gourl}'>å¦‚æœä½ çš„æµè§ˆå™¨æ²¡ååº”ï¼Œè¯·ç‚¹å‡»è¿™é‡Œ...</a>";

201 
$rmsg
 .= "<br/></div></div>\");\r\n";

202 
$rmsg
 .= "setTimeout('JumpUrl()',$litime);";

206 
$rmsg
 .= "<br/></div></div>\");\r\n";

211 
$rmsg
 .= "<br/><br/></div></div>\");\r\n";

213 
$msg
 = 
$htmlh—d
.
$rmsg
.
$htmlfoÙ
;

215 
echo
 
$msg
;

216 
	}
}

223 
funùiÚ
 
	$G‘CkVdV®ue
()

225 @
	`£ssiÚ_id
(
$_COOKIE
['PHPSESSID']);

226 @
	`£ssiÚ_¡¬t
();

227  
	`is£t
(
$_SESSION
['securimage_code_value']) ? $_SESSION['securimage_code_value'] : '';

228 
	}
}

235 
funùiÚ
 
	$Re£tVdV®ue
()

237 @
	`£ssiÚ_¡¬t
();

238 
$_SESSION
['securimage_code_value'] = '';

239 
	}
}

243 ifĞ
fe_exi¡s
(
XAKINC
.'/extend.func.php') )

245 
»quœe_Úû
(
XAKINC
.'/extend.func.php');

249 
funùiÚ
 
	$PassJoš
(
$·ss
)

251 
$·ss
 = 
	`sub¡r
(
	`md5
($pass),7,21);

252 
$·ss
 = 
	`¡¹ouµ”
($pass);

253 
$·ss
 = 
	`md5
($pass);

254  
$·ss
;

255 
	}
}

	@E:\web\weixun\functions\common.inc.php

1 <?
php


5 
”rÜ_»pÜtšg
(
E_ALL
);

8 
defše
('XAKINC', 
¡r_»¶aû
("\\", '/', 
dœÇme
(
__FILE__
) ) );

9 
defše
('XAKROOT', 
¡r_»¶aû
("\\", '/', 
sub¡r
(
XAKINC
,0,-10) ) );

10 
defše
('XAKDATA', 
XAKROOT
.'/config');

11 
defše
('XAKMEMBER', 
XAKROOT
.'/user');

12 
defše
('XAKTEMPLATE', 
XAKROOT
.'/templets');

19 
defše
('XAKMODEL', './model');

20 
defše
('XAKCONTROL', './control');

21 
defše
('XAKAPPTPL', './templates');

23 
defše
('DEBUG_LEVEL', 
FALSE
);

25 ià(
v”siÚ_com·»
(
PHP_VERSION
, '5.3.0', '<'))

27 
£t_magic_quÙes_ruÁime
(0);

30 if(
v”siÚ_com·»
(
PHP_VERSION
, '5.3.0', '>'))

32 if(
¡¹ouµ”
(
ši_g‘
('request_order')) == 'GP')

34 
h—d”
("Content-type:ext/html; charset=utf-8");

35 
ex™
("è¯·å°†php.ini é‡Œçš„„equest_order è®¾ä¸º CGP!");

39 ià(
v”siÚ_com·»
(
PHP_VERSION
, '5.4.0', '>='))

41 ià(!
funùiÚ_exi¡s
('session_register'))

43 
funùiÚ
 
£ssiÚ_»gi¡”
()

45 
	g$¬gs
 = 
func_g‘_¬gs
();

46 
fÜ—ch
 (
$¬gs
 
as
 
$key
){

47 
	g$_SESSION
[
$key
]=
$GLOBALS
[$key];

50 
funùiÚ
 
£ssiÚ_is_»gi¡”ed
(
$key
)

52  
is£t
(
$_SESSION
[
$key
]);

54 
funùiÚ
 
£ssiÚ_uÄegi¡”
(
$key
){

55 
un£t
(
$_SESSION
[
$key
]);

61 
	g$cfg_is_mb
 = 
$cfg_is_icÚv
 = 
FALSE
;

62 if(
funùiÚ_exi¡s
('mb_sub¡r')è
	g$cfg_is_mb
 = 
TRUE
;

63 if(
funùiÚ_exi¡s
('icÚv_sub¡r')è
	g$cfg_is_icÚv
 = 
TRUE
;

65 
funùiÚ
 
	$_RunMagicQuÙes
(&
$sv¬
)

67 if(!
	`g‘_magic_quÙes_gpc
())

69 ifĞ
	`is_¬¿y
(
$sv¬
) )

71 
	`fÜ—ch
(
$sv¬
 
as
 
$_k
 => 
$_v
è$sv¬[$_k] = 
	`_RunMagicQuÙes
($_v);

75 ifĞ
	`¡¾’
(
$sv¬
)>0 && 
	`´eg_m©ch
('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE)#',$svar) )

77 
	`ex™
('Request var‚ot‡llow!');

79 
$sv¬
 = 
	`add¦ashes
($svar);

82  
$sv¬
;

83 
	}
}

85 ià(!
defšed
('XAKREQUEST'))

88 
funùiÚ
 
CheckReque¡
(&
$v®
) {

89 ià(
is_¬¿y
(
$v®
)) {

90 
fÜ—ch
 (
$v®
 
as
 
$_k
=>
$_v
) {

91 if(
$_k
 == 'nvarname') ;

92 
CheckReque¡
(
$_k
);

93 
CheckReque¡
(
$v®
[
$_k
]);

97 ifĞ
¡¾’
(
$v®
)>0 && 
´eg_m©ch
('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE)#',$val) )

99 
ex™
('Request var‚ot‡llow!');

105 
CheckReque¡
(
$_REQUEST
);

107 
fÜ—ch
(
A¼ay
('_GET','_POST','_COOKIE'è
as
 
$_»que¡
)

109 
fÜ—ch
(
$$_»que¡
 
as
 
$_k
 => 
$_v
)

111 if(
$_k
 =ğ'nv¬Çme'è
$
{$_k} = 
$_v
;

112 
	g$
{
	g$_k
} = 
_RunMagicQuÙes
(
$_v
);

118 if(!
	$is£t
(
$ÃedF‹r
))

120 
$ÃedF‹r
 = 
çl£
;

121 
	}
}

122 
	g$»gi¡”Glob®s
 = @
ši_g‘
("register_globals");

123 
	g$isU¾O³n
 = @
ši_g‘
("allow_url_fopen");

124 
	g$isSaãMode
 = @
ši_g‘
("safe_mode");

125 ifĞ
´eg_m©ch
('/wšdows/i', @
g‘’v
('OS')) )

127 
	g$isSaãMode
 = 
çl£
;

131 
	g$£ssSaveP©h
 = 
XAKDATA
."/sessions/";

132 if(
is_wr™—bË
(
$£ssSaveP©h
è&& 
	$is_»adabË
(
$£ssSaveP©h
))

134 
	`£ssiÚ_§ve_·th
(
$£ssSaveP©h
);

135 
	}
}

138 
»quœe_Úû
(
XAKDATA
."/config.cache.inc.php");

141 if(
	g$_FILES
)

143 
»quœe_Úû
(
XAKINC
.'/uploadsafe.inc.php');

147 
»quœe_Úû
(
XAKDATA
.'/xakdb.php');

150 if(
fe_exi¡s
(
XAKDATA
.'/safe/inc_safe_config.php'))

152 
»quœe_Úû
(
XAKDATA
.'/safe/inc_safe_config.php');

153 if(!
em±y
(
$§ã_çqs
)è
	g$§ãçqs
 = 
un£rŸlize
($safe_faqs);

157 if(!
	$em±y
(
$cfg_domaš_cook›
))

159 @
	`£ssiÚ_£t_cook›_·¿ms
(0,'/',
$cfg_domaš_cook›
);

160 
	}
}

164 if(
	gPHP_VERSION
 > '5.1')

166 
	g$time51
 = 
$cfg_şi_time
 * -1;

167 @
d©e_deçuÉ_timezÚe_£t
('Etc/GMT'.
$time51
);

169 
	g$cfg_isU¾O³n
 = @
ši_g‘
("allow_url_fopen");

172 
	g$cfg_şiho¡
 = 'h‰p://'.
$_SERVER
['HTTP_HOST'];

175 
	g$cfg_ba£dœ
 = 
´eg_»¶aû
('#'.
$cfg_cm¥©h
.'\/funùiÚs$#i', '', 
XAKINC
);

176 if(
	g$cfg_muÉi_s™e
 == 'Y')

178 
$cfg_mašs™e
 = 
$cfg_ba£ho¡
;

182 
	g$cfg_mašs™e
 = '';

186 
	g$cfg_‹m¶‘s_dœ
 = 
$cfg_cm¥©h
.'/templets';

187 
	g$cfg_‹m¶‘u¾
 = 
$cfg_mašs™e
.
$cfg_‹m¶‘s_dœ
;

188 
	g$cfg_‹m¶‘s_skš
 = 
em±y
(
$cfg_df_¡yË
)? 
$cfg_mašs™e
.
$cfg_‹m¶‘s_dœ
."/default" : $cfg_mainsite.$cfg_templets_dir."/$cfg_df_style";

191 
	g$cfg_cmsu¾
 = 
$cfg_mašs™e
.
$cfg_cm¥©h
;

194 
	g$cfg_¶us_dœ
 = 
$cfg_cm¥©h
.'/module';

195 
	g$cfg_phpu¾
 = 
$cfg_mašs™e
.
$cfg_¶us_dœ
;

197 
	g$cfg_d©a_dœ
 = 
$cfg_cm¥©h
.'/config';

198 
	g$cfg_d©au¾
 = 
$cfg_mašs™e
.
$cfg_d©a_dœ
;

201 
	g$cfg_memb”_dœ
 = 
$cfg_cm¥©h
.'/user';

202 
	g$cfg_memb”u¾
 = 
$cfg_mašs™e
.
$cfg_memb”_dœ
;

205 
	g$cfg_¥ecŸl
 = 
$cfg_cm¥©h
.'/special';

206 
	g$cfg_¥ecŸlu¾
 = 
$cfg_mašs™e
.
$cfg_¥ecŸl
;

209 
	g$cfg_medŸs_dœ
 = 
$cfg_cm¥©h
.
$cfg_medŸs_dœ
;

210 
	g$cfg_medŸsu¾
 = 
$cfg_mašs™e
.
$cfg_medŸs_dœ
;

213 
	g$cfg_image_dœ
 = 
$cfg_medŸs_dœ
.'/allimg';

216 
	g$ddcfg_image_dœ
 = 
$cfg_medŸs_dœ
.'/litimg';

219 
	g$cfg_u£r_dœ
 = 
$cfg_medŸs_dœ
.'/userup';

222 
	g$cfg_soá_dœ
 = 
$cfg_medŸs_dœ
.'/soft';

225 
	g$cfg_Ùh”_medŸs
 = 
$cfg_medŸs_dœ
.'/media';

228 
	g$cfg_v”siÚ
 = 'V5.0';

229 
	g$cfg_soá_Ïng
 = 'utf-8';

230 
	g$cfg_soá_public
 = 'base';

232 
	g$cfg_soáÇme
 = 'å“ç¿åˆ›æƒ³ç½‘ç«™ç®¡ç†ç³»ç»Ÿ';

233 
	g$cfg_soá_’Çme
 = 'xakcms';

234 
	g$cfg_soá_dev‹am
 = 'Xak Team';

237 
	g$¬t_shÜŠame
 = 
$cfg_df_ext
 = '.html';

238 
	g$cfg_df_Çm”uË
 = '{ty³dœ}/{aid}'.
$cfg_df_ext
;

241 if(
is£t
(
$cfg_áp_mkdœ
è&& 
	g$cfg_áp_mkdœ
=='Y')

243 
$cfg_dœ_purv›w
 = '0755';

247 
	g$cfg_dœ_purv›w
 = 0755;

251 
	g$cfg_mb_l™
 = 'N';

254 
	g$_sys_glob®s
['curfile'] = '';

255 
	g$_sys_glob®s
['typeid'] = 0;

256 
	g$_sys_glob®s
['typename'] = '';

257 
	g$_sys_glob®s
['aid'] = 0;

259 if(
	$em±y
(
$cfg_addÚ_§v‘y³
))

261 
$cfg_addÚ_§v‘y³
 = 'Ymd';

262 
	}
}

263 if(
	g$cfg_£ndma_bysm
=='Y' && !
	$em±y
(
$cfg_sm_u£rma
))

265 
$cfg_admšema
 = 
$cfg_sm_u£rma
;

266 
	}
}

269 ià(
is£t
(
$GLOBALS
['PageNo'])) {

270 
	g$GLOBALS
['PageNo'] = 
štv®
(
$GLOBALS
['PageNo']);

272 ià(
is£t
(
$GLOBALS
['TotalResult'])) {

273 
	g$GLOBALS
['TÙ®ResuÉ'] = 
štv®
(
$GLOBALS
['TotalResult']);

278 ià(
	g$cfg_memÿche_’abË
 == 'Y')

280 
$ÿche_h–³r_cÚfig
 = 
¬¿y
();

281 
	g$ÿche_h–³r_cÚfig
['memÿche']['is_mc_’abË'] = 
$GLOBALS
["cfg_memcache_enable"];

282 
	g$ÿche_h–³r_cÚfig
['memÿche']['mc'] = 
¬¿y
 (

283 'deçuÉ' => 
$GLOBALS
["cfg_memcache_mc_defa"],

284 'Ùh”' => 
$GLOBALS
["cfg_memcache_mc_oth"]

286 
	g$ÿche_h–³r_cÚfig
['memÿche']['mc_ÿche_time'] = 
$GLOBALS
["cfg_puccache_time"];

290 if(!
	$is£t
(
$cfg_NÙPrštH—d
)) {

291 
	`h—d”
("Content-Type:ext/html; charset={$cfg_soft_lang}");

292 
	}
}

295 
funùiÚ
 
	$__autŞßd
(
$şas¢ame
)

297 
glob®
 
$cfg_soá_Ïng
;

298 
$şas¢ame
 = 
	`´eg_»¶aû
("/[^0-9a-z_]/i", '', $classname);

299 ifĞ
	`şass_exi¡s
 ( 
$şas¢ame
 ) )

301  
TRUE
;

303 
$şassfe
 = 
$şas¢ame
.'.php';

304 
$libşassfe
 = 
$şas¢ame
.'.class.php';

305 iàĞ
	`is_fe
 ( 
XAKINC
.'/'.
$libşassfe
 ) )

307 
»quœe
 
XAKINC
.'/'.
$libşassfe
;

309 ifĞ
	`is_fe
 ( 
XAKMODEL
.'/'.
$şassfe
 ) )

311 
»quœe
 
XAKMODEL
.'/'.
$şassfe
;

315 ià(
DEBUG_LEVEL
 ==ğ
TRUE
)

317 
echo
 '<pre>';

318 
echo
 
$şas¢ame
.'ç±»æ‰¾ä¸åˆ°';

319 
echo
 '</pre>';

320 
	`ex™
 ();

327 
	}
}

330 ià(
	g$GLOBALS
['cfg_mysql_ty³'] =ğ'mysqli' && 
funùiÚ_exi¡s
("mysqli_init"))

332 
»quœe_Úû
(
XAKINC
.'/xaksqli.class.php');

334 
»quœe_Úû
(
XAKINC
.'/xaksql.class.php');

339 
»quœe_Úû
(
XAKINC
.'/common.func.php');

342 
»quœe_Úû
(
XAKINC
.'/control.class.php');

343 
»quœe_Úû
(
XAKINC
.'/model.class.php');

346 if(
fe_exi¡s
(
XAKDATA
.'/helper.inc.php'))

348 
»quœe_Úû
(
XAKDATA
.'/helper.inc.php');

350 ià(!
is£t
(
$cfg_h–³r_autŞßd
))

352 
	g$cfg_h–³r_autŞßd
 = 
¬¿y
('util', 'charset', 'string', 'time', 'cookie');

355 
h–³r
(
$cfg_h–³r_autŞßd
);

	@E:\web\weixun\functions\control.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
»quœe_Úû
(
XAKINC
."/xaktemplate.class.php");

9 şas 
	cCÚŒŞ


11 
v¬
 
	m$l
;

12 
v¬
 
	m$dsql
;

13 
v¬
 
	m$¡yË
='default';

14 
v¬
 
	m$_h–³rs
 = 
¬¿y
();

16 
v¬
 
	m$­±¶
 = '../templates/';

18 
funùiÚ
 
	$__cÚ¡ruù
()

20 
$this
->
	`CÚŒŞ
();

24 
funùiÚ
 
	$CÚŒŞ
()

26 
glob®
 
$dsql
;

27 
$this
->
l
 = 
	`is£t
($this->l)? $this->È: 
Ãw
 
	`XakTem¶©e
();

28 
$sqÉy³
 = "XakSql";

29 ià(
$GLOBALS
['cfg_mysql_ty³'] =ğ'mysqli' && 
	`funùiÚ_exi¡s
("mysqli_š™")è
$sqÉy³
 = "XakSql";

30 
$sqÉy³
 = "XakSqli";

31 
$this
->
dsql
 = 
	`is£t
(
$dsql
)? $dsqÈ: 
Ãw
 
	`$sqÉy³
(
FALSE
);

32 
	}
}

36 
funùiÚ
 
	$S‘Tem¶©e
(
$lfe
)

38 
$lfe
 = 
XAKAPPTPL
.'/'.
$this
->
¡yË
.'/'.$tplfile;

39 
$this
->
l
->
	`LßdTem¶©e
(
$lfe
);

40 
	}
}

41 
funùiÚ
 
	$S‘Tem¶‘
(
$lfe
)

43 
$lfe
 = 
XAKAPPTPL
.'/'.
$this
->
¡yË
.'/'.$tplfile;

44 
$this
->
l
->
	`LßdTem¶©e
(
$lfe
);

45 
	}
}

48 
funùiÚ
 
	$S‘V¬
(
$k
, 
$v
)

50 
$this
->
l
->
	`Assign
(
$k
, 
$v
);

51 
	}
}

53 
funùiÚ
 
	$G‘V¬
(
$k
)

55 
glob®
 
$_v¬s
;

56  
	`is£t
(
$_v¬s
[
$k
]) ? $_vars[$k] : '';

57 
	}
}

59 
funùiÚ
 
Mod–
(
$Çme
='')

61 
$Çme
 = 
´eg_»¶aû
("#[^\w]#", "", $name);

62 
	g$mod–fe
 = 
XAKMODEL
.'/'.
$Çme
.'.php';

63 ià(
fe_exi¡s
(
$mod–fe
))

65 
»quœe_Úû
 
	g$mod–fe
;

67 ià(!
em±y
(
$Çme
è&& 
şass_exi¡s
($name))

69  
Ãw
 
	g$Çme
;

71  
	gçl£
;

74 
funùiÚ
 
Lib¿r›s
(
$Çme
='',
$d©a
 = '')

76 if(
defšed
('APPNAME'))

78 
$şassfe
 = 'MY_'.
$Çme
.'.class.php';

79 iàĞ
fe_exi¡s
 ( '../'.
APPNAME
.'/lib¿r›s/'.
$şassfe
 ) )

81 
	g»quœe
 '../'.
	gAPPNAME
.'/lib¿r›s/'.
	g$şassfe
;

82  
Ãw
 
$Çme
(
$d©a
);

84 ià(!
em±y
(
$Çme
è&& 
şass_exi¡s
($name))

86  
Ãw
 
$Çme
(
$d©a
);

89  
	gFALSE
;

91 ià(!
em±y
(
$Çme
è&& 
şass_exi¡s
($name))

93  
Ãw
 
$Çme
(
$d©a
);

95  
	gFALSE
;

100 
funùiÚ
 
h–³r
(
$h–³r
 = "",
$·th
)

102 
	g$h–p_·th
 = 
$·th
.'/cÚfig/h–³r/'.
$h–³r
.".helper.php";

103 ià(
fe_exi¡s
(
$h–p_·th
))

105 
šşude_Úû
(
$h–p_·th
);

107 
ex™
('UÇbËØlßdh»que¡ed fe: '.
$h–³r
.".helper.php");

112 
funùiÚ
 
	$Di¥Ïy
()

114 
$this
->
l
->
	`S‘Objeù
($this);

115 
$this
->
l
->
	`Di¥Ïy
();

116 
	}
}

119 
funùiÚ
 
	$SaveTo
(
$f’ame
)

121 
$this
->
l
->
	`S‘Objeù
($this);

122 
$this
->
l
->
	`SaveTo
(
$f’ame
);

123 
	}
}

126 
funùiÚ
 
	$__de¡ruù
() {

127 
	`un£t
(
$this
->
l
);

128 
$this
->
dsql
->
	`Clo£
(
TRUE
);

129 
	}
}

	@E:\web\weixun\functions\customfields.func.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

15 
funùiÚ
 
G‘FÜmI‹m
(
$ùag
, 
$admšty³
='admin')

17 
glob®
 
$dsql
;

18 
	g$f›ldÇme
 = 
$ùag
->
G‘Name
();

19 
	g$f›ldTy³
 = 
$ùag
->
G‘A‰
('type');

20 
	g$fÜm™em
 = 
$fÜm™em
 = 
G‘SysTem¶‘s
("custom_fields_{$admintype}.htm");

21 
	g$šÃ¹ext
 = 
Œim
(
$ùag
->
G‘IÂ”Text
());

22 if(
	g$šÃ¹ext
!='')

24 
$fÜm™em
 = 
$šÃ¹ext
;

27 if(
	g$f›ldTy³
=='select')

29 
$myfÜmI‹m
 = '';

30 
	g$™ems
 = 
ex¶ode
(',',
$ùag
->
G‘A‰
("default"));

31 
	g$myfÜmI‹m
 = "<select‚ame='$fieldname' style='width:150px'>";

32 
fÜ—ch
(
$™ems
 
as
 
$v
)

34 
	g$v
 = 
Œim
(
$v
);

35 if(
	g$v
!='') {

36 
$myfÜmI‹m
.= "<option value='$v'>$v</option>\r\n";

39 
	g$myfÜmI‹m
 .= "</select>\r\n";

40 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

42 if(
	g$f›ldTy³
=='stepselect')

44 
glob®
 
$hasS‘EnumJs
,
$cfg_cm¥©h
;

45 
	g$cm¥©h
 = ( (
em±y
(
$cfg_cm¥©h
è|| !
´eg_m©ch
('/[/$]/', $cfg_cm¥©h)è? 
	g$cfg_cm¥©h
.'/' : $cfg_cmspath );

46 
	g$myfÜmI‹m
 = '';

47 
	g$myfÜmI‹m
 .= "<inputype='hidden' id='hidden_{$fieldname}'‚ame='{$fieldname}' value='0' />\r\n";

48 
	g$myfÜmI‹m
 .= "<span id='span_{$fieldname}'></span>\r\n";

49 
	g$myfÜmI‹m
 .= "<span id='span_{$fieldname}_son'></span>\r\n";

50 
	g$myfÜmI‹m
 .= "<span id='span_{$fieldname}_sec'></span>\r\n";

51 if(
	g$hasS‘EnumJs
 != 'hasset')

53 
$myfÜmI‹m
 .ğ'<süˆÏnguage="javasüt"y³="‹xt/javasüt" src="'.
$cm¥©h
.'images/enums.js"></script>'."\r\n";

54 
	g$GLOBALS
['hasSetEnumJs'] = 'hasset';

56 
	g$myfÜmI‹m
 .= "<script†anguage='javascript'ype='text/javascript' src='{$cmspath}config/enums/{$fieldname}.js'></script>\r\n";

57 
	g$myfÜmI‹m
 .ğ'<süˆÏnguage="javasüt"y³="‹xt/javasüt">MakeTİS–eù("'.
$f›ldÇme
.'", 0);</script>'."\r\n";

58 
	g$fÜm™em
 = 
¡r_»¶aû
('~Çme~', 
$ùag
->
G‘A‰
('™emÇme'), 
$fÜm™em
);

59 
	g$fÜm™em
 = 
¡r_»¶aû
('~fÜm~', 
$myfÜmI‹m
, 
$fÜm™em
);

60  
	g$fÜm™em
;

62 if(
	g$f›ldTy³
=='radio')

64 
$myfÜmI‹m
 = '';

65 
	g$™ems
 = 
ex¶ode
(',',
$ùag
->
G‘A‰
("default"));

66 
	g$i
 = 0;

67 
fÜ—ch
(
$™ems
 
as
 
$v
)

69 
	g$v
 = 
Œim
(
$v
);

70 if(
	g$v
!='')

72 
$myfÜmI‹m
 .ğ(
$i
==0 ? "<inputype='radio'‚ame='$fieldname' class='np' value='$v' checked>$v\r\n" : "<inputype='radio'‚ame='$fieldname' class='np' value='$v'>$v\r\n");

73 
	g$i
++;

76 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

78 if(
	g$f›ldTy³
=='checkbox')

80 
$myfÜmI‹m
 = '';

81 
	g$™ems
 = 
ex¶ode
(',',
$ùag
->
G‘A‰
("default"));

82 
fÜ—ch
(
$™ems
 
as
 
$v
)

84 
	g$v
 = 
Œim
(
$v
);

85 if(
	g$v
!='')

87 if(
$admšty³
 == 'membermodel')

89 
$myfÜmI‹m
 .= "<label><inputype='checkbox'‚ame='{$fieldname}[]' class='np' value='$v'>$v</label>\r\n";

91 
	g$myfÜmI‹m
 .= "<inputype='checkbox'‚ame='{$fieldname}[]' class='np' value='$v'>$v\r\n";

96 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

98 if(
	g$f›ldTy³
=='htmÉext'||
$f›ldTy³
=='textdata')

100 
$dfv®ue
 = (
$ùag
->
G‘A‰
('default')!='' ? $ctag->GetAtt('default') : '');

101 
	g$dfv®ue
 = 
¡r_»¶aû
('{{', '<', 
$dfv®ue
);

102 
	g$dfv®ue
 = 
¡r_»¶aû
('}}', '>', 
$dfv®ue
);

103 if(
	g$admšty³
=='admin')

105 
$šÃ¹ext
 = 
G‘Ed™Ü
(
$f›ldÇme
, 
$dfv®ue
, 350, 'Basic', 'string');

107 if(
	g$admšty³
=='diy')

109 
$šÃ¹ext
 = 
G‘Ed™Ü
(
$f›ldÇme
, 
$dfv®ue
, 350, 'Diy', 'string');

113 
	g$šÃ¹ext
 = 
G‘Ed™Ü
(
$f›ldÇme
, 
$dfv®ue
, 350, 'Member', 'string');

116 if(
	g$f›ldTy³
=="multitext")

118 
$šÃ¹ext
 = "<textarea‚ame='$fieldname' id='$fieldname' style='width:90%;height:80px;'></textarea>\r\n";

120 if(
	g$f›ldTy³
=="datetime")

122 
$nowtime
 = 
G‘D©eTimeMk
(
time
());

123 
	g$šÃ¹ext
 = "<input‚ame=\"$fieldname\" value=\"$nowtime\"ype=\"text\" id=\"$fieldname\" style=\"width:250px\" class=\"intxt\" />";

124 
	g$šÃ¹ext
 .= " <script†anguage=\"javascript\"ype=\"text/javascript\">

125 
C®’d¬
.
£tup
({

126 
šputF›ld
 : \"$fieldname\",

127 
ifFÜm©
 : \"%Y-%m-%d %H:%M\",

128 
showsTime
 : 
Œue
,

129 
timeFÜm©
 : \"24\"

131 </
	gsüt
>";

133 if(
	g$f›ldTy³
=='img'||
$f›ldTy³
=='imgfile')

135 if(
$admšty³
=='diy') {

136 
$šÃ¹ext
 = "<inputype='file'‚ame='$fieldname' id='$fieldname' style='width:300px;height:22px;line-height:22px' />\r\n";

139 
	g$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt'ype='button' class='inputbut' value='æµè§ˆ...' onClick=\"SelectImage('form1.$fieldname','big')\" />\r\n";

142 if(
	g$f›ldTy³
=='media')

144 if(
$admšty³
=='diy')

146 
$šÃ¹ext
 = "<inputype='hidden'‚ame='$fieldname' id='$fieldname' value='' />ä¸æ”¯æŒçš„ç±»å‹\r\n";

150 
	g$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt'ype='button' class='inputbut' value='æµè§ˆ...' onClick=\"SelectMedia('form1.$fieldname')\" />\r\n";

153 if(
	g$f›ldTy³
=='addon')

155 if(
$admšty³
=='diy')

157 
$šÃ¹ext
 = "<inputype='file'‚ame='$fieldname' id='$fieldname' style='width:300px;height:22px;line-height:22px' />\r\n";

161 
	g$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt'ype='button' class='inputbut' value='æµè§ˆ...' onClick=\"SelectSoft('form1.$fieldname')\" />\r\n";

164 if(
	g$f›ldTy³
=='št'||
$f›ldTy³
=='float')

166 
$dfv®ue
 = (
$ùag
->
G‘A‰
('default')!='' ? $ctag->GetAtt('default') : '0');

167 
	g$šÃ¹ext
 = "<inputype='text'‚ame='$fieldname' id='$fieldname' style='width:100px' class='intxt' value='$dfvalue' /> (å¡«å†™æ•°å€¼)\r\n";

171 
	g$dfv®ue
 = (
$ùag
->
G‘A‰
('default')!='' ? $ctag->GetAtt('default') : '');

172 
	g$šÃ¹ext
 = "<inputype='text'‚ame='$fieldname' id='$fieldname' style='width:250px' class='intxt' value='$dfvalue' />\r\n";

174 
	g$fÜm™em
 = 
¡r_»¶aû
("~Çme~",
$ùag
->
G‘A‰
('™emÇme'),
$fÜm™em
);

175 
	g$fÜm™em
 = 
¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,
$fÜm™em
);

176  
	g$fÜm™em
;

192 
funùiÚ
 
G‘F›ldV®ue
(
$dv®ue
, 
$dty³
, 
$aid
=0, 
$job
='add', 
$addv¬
='', 
$admšty³
='admš', 
$f›ldÇme
='')

194 
glob®
 
$cfg_ba£dœ
, 
$cfg_cm¥©h
, 
$admšid
, 
$cfg_ml
, 
$cfg_cook›_’code
;

195 if(!
em±y
(
$admšid
))

197 
	g$admšid
 = 
$admšid
;

201 
	g$admšid
 = 
is£t
(
$cfg_ml
è? $cfg_ml->
M_ID
 : 1;

203 if(
	g$dty³
=='int')

205 if(
$dv®ue
=='')

209  
G‘AÏbNum
(
$dv®ue
);

211 if(
	g$dty³
=='stepselect')

213 
$dv®ue
 = 
Œim
(
´eg_»¶aû
("#[^0-9\.]#", "", $dvalue));

214  
	g$dv®ue
;

216 if(
	g$dty³
=='float')

218 if(
$dv®ue
=='')

222  
G‘AÏbNum
(
$dv®ue
);

224 if(
	g$dty³
=='datetime')

226 if(
$dv®ue
=='')

230  
G‘MkTime
(
$dv®ue
);

232 if(
	g$dty³
=='checkbox')

234 
$okv®ue
 = '';

235 if(
is_¬¿y
(
$dv®ue
))

237 
	g$okv®ue
 = 
još
(',',
$dv®ue
);

239  
	g$okv®ue
;

241 if(
	g$dty³
=="htmltext")

243 if(
$admšty³
=='member' || $admintype=='diy')

245 
$dv®ue
 = 
HtmlR•Ïû
($dvalue,-1);

247  
	g$dv®ue
;

249 if(
	g$dty³
=="multitext")

251 if(
$admšty³
=='member' || $admintype=='diy')

253 
$dv®ue
 = 
HtmlR•Ïû
($dvalue,0);

255  
	g$dv®ue
;

257 if(
	g$dty³
=="textdata")

259 
$©h
 = 
$cfg_cm¥©h
."/config/textdata";

260 
	g$©h
 = 
û
(
$aid
 / 5000);

261 if(!
is_dœ
(
$cfg_ba£dœ
.
$©h
))

263 
MkdœAÎ
(
$cfg_ba£dœ
.
$©h
, 
$GLOBALS
['cfg_dir_purview']);

265 if(!
is_dœ
(
$cfg_ba£dœ
.
$©h
.'/'.
$©h
))

267 
MkdœAÎ
(
$cfg_ba£dœ
.
$©h
.'/'.
$©h
,
$GLOBALS
['cfg_dir_purview']);

269 
	g$©h
 = 
$©h
.'/'.
$©h
;

270 
	g$f’ame
 = "{$©h}/{$aid}-".
ú_sub¡r
(
md5
(
$cfg_cook›_’code
), 0, 16).".txt";

273 if(
	g$admšty³
=='memb”' || 
$admšty³
=='diy')

275 
$dv®ue
 = 
HtmlR•Ïû
($dvalue, -1);

277 
	g$å
 = 
fİ’
(
$cfg_ba£dœ
.
$f’ame
,"w");

278 
fwr™e
(
$å
, 
¡r¦ashes
(
$dv®ue
));

279 
fşo£
(
$å
);

280 
Clo£F
();

281  
	g$f’ame
;

283 if(
	g$dty³
=='img' || 
$dty³
=='imgfile')

285 if(
´eg_m©ch
("#[\\|/]u¶ßds[\\|/]u£rup#", 
$dv®ue
))  $dvalue;

286 if(
	g$admšty³
=='diy')

288 
$iu¾
 = 
Memb”U¶ßds
(
$f›ldÇme
, '', 0, 'image', '', -1, -1, 
çl£
);

289  
	g$iu¾
;

291 
	g$iu¾
 = 
¡r¦ashes
(
$dv®ue
);

292 if(
Œim
(
$iu¾
)=='')

296 
	g$iu¾
 = 
Œim
(
¡r_»¶aû
(
$GLOBALS
['cfg_ba£ho¡'],"",
$iu¾
));

297 
	g$imgu¾
 = 
$iu¾
;

298 if(
´eg_m©ch
("/^h‰p:\/\//i", 
$iu¾
è&& 
	g$GLOBALS
['cfg_isUrlOpen'])

301 
	g$»imgs
 = '';

302 if(
	g$GLOBALS
['cfg_isUrlOpen'])

304 
	g$»imgs
 = 
G‘RemÙeImage
(
$iu¾
,
$admšid
);

305 if(
is_¬¿y
(
$»imgs
))

307 if(
	g$dty³
=='imgfile')

309 
$imgu¾
 = 
$»imgs
[1];

313 
	g$imgu¾
 = "{xak:imgext='' width='".
$»imgs
[1]."' height='".$reimgs[2]."'} ".$reimgs[0]." {/xak:img}";

319 if(
	g$dty³
=='imgfile')

321 
$imgu¾
 = 
$iu¾
;

325 
	g$imgu¾
 = "{xak:imgext='' width='' height=''} ".
$iu¾
." {/xak:img}";

329 if(
	g$iu¾
 != '')

332 
$imgfe
 = 
$cfg_ba£dœ
.
$iu¾
;

333 if(
is_fe
(
$imgfe
))

335 
	g$šfo
 = '';

336 
	g$imgšfos
 = 
G‘ImageSize
(
$imgfe
,
$šfo
);

337 if(
	g$dty³
=="imgfile")

339 
$imgu¾
 = 
$iu¾
;

343 
	g$imgu¾
 = "{xak:imgext='' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}";

348  
add¦ashes
(
$imgu¾
);

350 if(
	g$dty³
=='addÚ' && 
$admšty³
=='diy')

352 if(
´eg_m©ch
("#[\\|/]u¶ßds[\\|/]u£rup#", 
$dv®ue
))  $dvalue;

353 
	g$dv®ue
 = 
Memb”U¶ßds
(
$f›ldÇme
,'', 0, 'addÚ', '', -1, -1, 
çl£
);

354  
	g$dv®ue
;

358 if(
	g$admšty³
=='memb”' || 
$admšty³
=='diy')

360 
$dv®ue
 = 
HtmlR•Ïû
($dvalue,1);

362  
	g$dv®ue
;

376 
funùiÚ
 
G‘FÜmI‹mV®ue
(
$ùag
, 
$fv®ue
, 
$admšty³
='admš', 
$f›ldÇme
='')

378 
glob®
 
$cfg_ba£dœ
,
$dsql
;

379 
	g$f›ldÇme
 = 
$ùag
->
G‘Name
();

380 
	g$fÜm™em
 = 
$fÜm™em
 = 
G‘SysTem¶‘s
("custom_fields_{$admintype}.htm");

381 
	g$šÃ¹ext
 = 
Œim
(
$ùag
->
G‘IÂ”Text
());

382 if(
	g$šÃ¹ext
!='')

384 
$fÜm™em
 = 
$šÃ¹ext
;

386 
	g$áy³
 = 
$ùag
->
G‘A‰
('type');

387 
	g$myfÜmI‹m
 = '';

388 if(
´eg_m©ch
("/£Ëù|¿dio|checkbox/i", 
$áy³
))

390 
	g$™ems
 = 
ex¶ode
(',',
$ùag
->
G‘A‰
('default'));

392 if(
	g$áy³
=='select')

394 
$myfÜmI‹m
 = "<select‚ame='$fieldname' style='width:150px'>";

395 if(
is_¬¿y
(
$™ems
))

397 
fÜ—ch
(
$™ems
 
as
 
$v
)

399 
	g$v
 = 
Œim
(
$v
);

400 if(
	g$v
=='')

404 
	g$myfÜmI‹m
.ğ(
$fv®ue
==
$v
 ? "<option value='$v' selected>$v</option>\r\n" : "<option value='$v'>$v</option>\r\n");

407 
	g$myfÜmI‹m
 .= "</select>\r\n";

408 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

410 if(
	g$ùag
->
G‘A‰
("type")=='stepselect')

412 
glob®
 
$hasS‘EnumJs
,
$cfg_cm¥©h
;

413 
	g$cm¥©h
 = ( (
em±y
(
$cfg_cm¥©h
è|| 
´eg_m©ch
('/[/$]/', $cfg_cm¥©h)è? 
	g$cfg_cm¥©h
.'/' : $cfg_cmspath );

414 
	g$myfÜmI‹m
 = '';

415 
	g$myfÜmI‹m
 .= "<inputype='hidden' id='hidden_{$fieldname}'‚ame='{$fieldname}' value='{$fvalue}' />\r\n";

416 
	g$myfÜmI‹m
 .= "<span id='span_{$fieldname}'></span>\r\n";

417 
	g$myfÜmI‹m
 .= "<span id='span_{$fieldname}_son'></span>\r\n";

418 
	g$myfÜmI‹m
 .= "<span id='span_{$fieldname}_sec'></span>\r\n";

419 if(
	g$hasS‘EnumJs
 != 'hasset')

421 
$myfÜmI‹m
 .ğ'<süˆÏnguage="javasüt"y³="‹xt/javasüt" src="'.
$cm¥©h
.'images/enums.js"></script>'."\r\n";

422 
	g$GLOBALS
['hasSetEnumJs'] = 'hasset';

424 
	g$myfÜmI‹m
 .= "<script†anguage='javascript'ype='text/javascript' src='{$cmspath}config/enums/{$fieldname}.js'></script>\r\n";

425 
	g$myfÜmI‹m
 .= "<script†anguage='javascript'ype='text/javascript'>MakeTopSelect('$fieldname', $fvalue);</script>\r\n";

426 
	g$fÜm™em
 = 
¡r_»¶aû
('~Çme~', 
$ùag
->
G‘A‰
('™emÇme'), 
$fÜm™em
);

427 
	g$fÜm™em
 = 
¡r_»¶aû
('~fÜm~', 
$myfÜmI‹m
, 
$fÜm™em
);

428  
	g$fÜm™em
;

430 if(
	g$áy³
=='radio')

432 if(
is_¬¿y
(
$™ems
))

434 
fÜ—ch
(
$™ems
 
as
 
$v
)

436 
$v
 = 
Œim
($v);

437 if(
	g$v
=='') ;

438 
	g$myfÜmI‹m
.ğ(
$fv®ue
==
$v
 ? "<inputype='radio'‚ame='$fieldname' class='np' value='$v' checked='checked' />$v\r\n" : "<inputype='radio'‚ame='$fieldname' class='np' value='$v' />$v\r\n");

441 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

445 if(
	g$áy³
=='checkbox')

447 
$myfÜmI‹m
 = '';

448 
	g$fv®ues
 = 
ex¶ode
(',',
$fv®ue
);

449 if(
is_¬¿y
(
$™ems
))

451 
fÜ—ch
(
$™ems
 
as
 
$v
)

453 
	g$v
 = 
Œim
(
$v
);

454 if(
	g$v
=='')

458 if(
š_¬¿y
(
$v
,
$fv®ues
))

460 
	g$myfÜmI‹m
 .= "<inputype='checkbox'‚ame='{$fieldname}[]' class='np' value='$v' checked='checked' />$v\r\n";

464 
	g$myfÜmI‹m
 .= "<inputype='checkbox'‚ame='{$fieldname}[]' class='np' value='$v' />$v\r\n";

468 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

472 if(
	g$áy³
=="textdata")

474 if(
is_fe
(
$cfg_ba£dœ
.
$fv®ue
))

476 
$å
 = 
fİ’
(
$cfg_ba£dœ
.
$fv®ue
,'r');

477 
	g$okfv®ue
 = '';

478 !
ãof
(
$å
)){ 
	g$okfv®ue
 .ğ
fg‘s
($fp,1024); }

479 
fşo£
(
$å
);

483 
	g$okfv®ue
 = '';

485 if(
	g$admšty³
=='admin')

487 
$myfÜmI‹m
 = 
G‘Ed™Ü
(
$f›ldÇme
,
$okfv®ue
,350,'Basic','string')."\r\n <inputype='hidden'‚ame='{$fieldname}_file' value='{$fvalue}' />\r\n ";

491 
	g$myfÜmI‹m
 = 
G‘Ed™Ü
(
$f›ldÇme
,
$okfv®ue
,350,'Member','string')."\r\n <inputype='hidden'‚ame='{$fieldname}_file' value='{$fvalue}' />\r\n ";

493 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

495 if(
	g$áy³
=="htmltext")

497 if(
$admšty³
=='admin')

499 
$myfÜmI‹m
 = 
G‘Ed™Ü
(
$f›ldÇme
,
$fv®ue
,350,'Basic','string')."\r\n ";

503 
	g$myfÜmI‹m
 = 
G‘Ed™Ü
(
$f›ldÇme
,
$fv®ue
,350,'Member','string')."\r\n ";

505 
	g$šÃ¹ext
 = 
$myfÜmI‹m
;

507 if(
	g$áy³
=="multitext")

509 
$šÃ¹ext
 = "<textarea‚ame='$fieldname' id='$fieldname' style='width:90%;height:80px'>$fvalue</textarea>\r\n";

511 if(
	g$áy³
=="datetime")

513 
$nowtime
 = 
G‘D©eTimeMk
(
$fv®ue
);

514 
	g$šÃ¹ext
 = "<input‚ame=\"$fieldname\" value=\"$nowtime\"ype=\"text\" id=\"$fieldname\" style=\"width:250px\" class=\"intxt\" />";

515 
	g$šÃ¹ext
 .= " <script†anguage=\"javascript\"ype=\"text/javascript\">

516 
C®’d¬
.
£tup
({

517 
šputF›ld
 : \"$fieldname\",

518 
ifFÜm©
 : \"%Y-%m-%d %H:%M\",

519 
showsTime
 : 
Œue
,

520 
timeFÜm©
 : \"24\"

522 </
	gsüt
>";

524 if(
	g$áy³
=="img")

526 
$nd
 = 
Ãw
 
XakTagP¬£
();

527 
	g$nd
->
LßdSourû
(
$fv®ue
);

528 if(!
is_¬¿y
(
$nd
->
CTags
))

530 
	g$nd
->
CË¬
();

531 
	g$fv®ue
 = "";

535 
	g$Áag
 = 
$nd
->
G‘Tag
("img");

536 
	g$fv®ue
 = 
Œim
(
$Áag
->
G‘IÂ”Text
());

538 
	g$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' v®ue='$fv®ue' id='$f›ldÇme' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt' class='inputbut'ype='button' value='æµè§ˆ...' onClick=\"SelectImage('form1.$fieldname','big')\" />\r\n";

540 if(
	g$áy³
=="imgfile")

542 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' v®ue='$fv®ue' id='$f›ldÇme' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt' class='inputbut'ype='button' value='æµè§ˆ...' onClick=\"SelectImage('form1.$fieldname','big')\" />\r\n";

544 if(
	g$áy³
=="media")

546 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' v®ue='$fv®ue' id='$f›ldÇme' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt' class='inputbut'ype='button' value='æµè§ˆ...' onClick=\"SelectMedia('form1.$fieldname')\" />\r\n";

548 if(
	g$áy³
=="addon")

550 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' v®ue='$fv®ue' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt' class='inputbut'ype='button' value='æµè§ˆ...' onClick=\"SelectSoft('form1.$fieldname')\" />\r\n";

552 if(
	g$áy³
=="št"||
$áy³
=="float")

554 
$šÃ¹ext
 = "<inputype='text'‚ame='$fieldname' id='$fieldname' style='width:100px' class='intxt' value='$fvalue' /> (å¡«å†™æ•°å€¼)\r\n";

558 
	g$šÃ¹ext
 = "<inputype='text'‚ame='$fieldname' id='$fieldname' style='width:250px' class='intxt' value='$fvalue' />\r\n";

560 
	g$fÜm™em
 = 
¡r_»¶aû
('~Çme~',
$ùag
->
G‘A‰
('™emÇme'),
$fÜm™em
);

561 
	g$fÜm™em
 = 
¡r_»¶aû
('~fÜm~',
$šÃ¹ext
,
$fÜm™em
);

562  
	g$fÜm™em
;

	@E:\web\weixun\functions\datalistcp.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

17 
»quœe_Úû
(
XAKINC
.'/xaktemplate.class.php');

23 şas 
	cD©aLi¡CP


25 
v¬
 
	m$dsql
;

26 
v¬
 
	m$l
;

27 
v¬
 
	m$·geNO
;

28 
v¬
 
	m$tÙ®Page
;

29 
v¬
 
	m$tÙ®ResuÉ
;

30 
v¬
 
	m$·geSize
;

31 
v¬
 
	m$g‘V®ues
;

32 
v¬
 
	m$sourûSql
;

33 
v¬
 
	m$isQu”y
;

34 
v¬
 
	m$qu”yTime
;

43 
funùiÚ
 
__cÚ¡ruù
(
$lfe
='')

45 ià(
$GLOBALS
['cfg_mysql_ty³'] =ğ'mysqli' && 
funùiÚ_exi¡s
("mysqli_init"))

47 
$dsql
 = 
$GLOBALS
['dsqli'];

49 
	m$dsql
 = 
$GLOBALS
['dsql'];

51 
	m$this
->
	msourûSql
='';

52 
	m$this
->
	m·geSize
=25;

53 
	m$this
->
	mqu”yTime
=0;

54 
	m$this
->
	mg‘V®ues
=
A¼ay
();

55 
	m$this
->
	misQu”y
 = 
çl£
;

56 
	m$this
->
	mtÙ®ResuÉ
 = 0;

57 
	m$this
->
	mtÙ®Page
 = 0;

58 
	m$this
->
	m·geNO
 = 0;

59 
	m$this
->
	mdsql
 = 
$dsql
;

60 
	m$this
->
S‘V¬
('ParseEnv','datalist');

61 
	m$this
->
	ml
 = 
Ãw
 
XakTem¶©e
();

62 if(
	m$GLOBALS
['cfg_tplcache']=='N')

64 
$this
->
l
->
isCache
 = 
çl£
;

66 if(
	m$lfe
!='')

68 
$this
->
l
->
LßdTem¶©e
(
$lfe
);

80 
funùiÚ
 
D©aLi¡CP
(
$lfe
='')

82 
$this
->
__cÚ¡ruù
(
$lfe
);

86 
funùiÚ
 
	$S‘Sourû
(
$sql
)

88 
$this
->
sourûSql
 = 
$sql
;

89 
	}
}

93 
funùiÚ
 
	$S‘Tem¶©e
(
$lfe
)

95 
$this
->
l
->
	`LßdTem¶©e
(
$lfe
);

96 
	}
}

97 
funùiÚ
 
	$S‘Tem¶‘
(
$lfe
)

99 
$this
->
l
->
	`LßdTem¶©e
(
$lfe
);

100 
	}
}

108 
funùiÚ
 
	$P»Lßd
()

110 
glob®
 
$tÙ®»suÉ
,
$·g’o
;

111 if(
	`em±y
(
$·g’o
è|| 
	`´eg_m©ch
("#[^0-9]#", $pageno))

113 
$·g’o
 = 1;

115 if(
	`em±y
(
$tÙ®»suÉ
è|| 
	`´eg_m©ch
("#[^0-9]#", $totalresult))

117 
$tÙ®»suÉ
 = 0;

119 
$this
->
·geNO
 = 
$·g’o
;

120 
$this
->
tÙ®ResuÉ
 = 
$tÙ®»suÉ
;

122 if(
	`is£t
(
$this
->
l
->
Cfgs
['pagesize']))

124 
$this
->
·geSize
 = $this->
l
->
Cfgs
['pagesize'];

126 
$this
->
tÙ®Page
 = 
	`û
($this->
tÙ®ResuÉ
 / $this->
·geSize
);

127 if(
$this
->
tÙ®ResuÉ
==0)

129 
$couÁQu”y
 = 
	`´eg_»¶aû
("#SELECT[ \r\n\t](.*)[ \r\n\t]FROM#is", 'SELECT COUNT(*èAS dd FROM', 
$this
->
sourûSql
);

130 
$couÁQu”y
 = 
	`´eg_»¶aû
("#ORDER[ \r\n\t]{1,}BY(.*)#is", '', $countQuery);

131 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
(
$couÁQu”y
);

132 if(!
	`is_¬¿y
(
$row
)) $row['dd'] = 0;

133 
$this
->
tÙ®ResuÉ
 = 
	`is£t
(
$row
['dd'])? $row['dd'] : 0;

134 
$this
->
sourûSql
 .ğ" LIMIT 0,".$this->
·geSize
;

138 
$this
->
sourûSql
 .ğ" LIMIT ".(($this->
·geNO
-1è* $this->
·geSize
).",".$this->pageSize;

140 
	}
}

143 
funùiÚ
 
	$S‘P¬am‘”
(
$key
,
$v®ue
)

145 
$this
->
g‘V®ues
[
$key
] = 
$v®ue
;

146 
	}
}

149 
funùiÚ
 
	$S‘V¬
(
$k
,
$v
)

151 
glob®
 
$_v¬s
;

152 if(!
	`is£t
(
$_v¬s
[
$k
]))

154 
$_v¬s
[
$k
] = 
$v
;

156 
	}
}

158 
funùiÚ
 
	$G‘V¬
(
$k
)

160 
glob®
 
$_v¬s
;

161  
	`is£t
(
$_v¬s
[
$k
]) ? $_vars[$k] : '';

162 
	}
}

165 
funùiÚ
 
G‘ArcLi¡
(
$©ts
,
$»fObj
='',
$f›lds
=
	$¬¿y
())

167 
$rsA¼ay
 = 
	`¬¿y
();

168 
$t1
 = 
	`Exeùime
();

169 if(!
$this
->
isQu”y
è$this->
dsql
->
	`Execu‹
('dli¡',$this->
sourûSql
);

170 
$i
 = 0;

171 
$¬r
=
$this
->
dsql
->
	`G‘A¼ay
('dlist'))

173 
$i
++;

174 
$rsA¼ay
[
$i
] = 
$¬r
;

175 if(
$i
 >ğ
$this
->
·geSize
)

180 
$this
->
dsql
->
	`F»eResuÉ
('dlist');

181 
$this
->
qu”yTime
 = (
	`Exeùime
(è- 
$t1
);

182  
$rsA¼ay
;

183 
	}
}

186 
funùiÚ
 
G‘PageLi¡
(
$©ts
,
$»fObj
='',
$f›lds
=
	$¬¿y
())

190 if(!
	`is£t
(
$©ts
['sitelang']) || $atts['sitelang'] =='cn')

192 
$Ïng_´e_·ge
 = 'ä¸Šé¡µ';

193 
$Ïng_Ãxt_·ge
 = 'ä¸‹é¡µ';

194 
$Ïng_šdex_·ge
 = 'é¦–é¡µ';

195 
$Ïng_’d_·ge
 = 'æœ«é¡µ';

196 
$Ïng_»cÜd_numb”
 = 'æ¡è®°å½•';

197 
$Ïng_·ge
 = 'é¡µ';

198 
$Ïng_tÙ®
 = 'å…±';

202 
$Ïng_´e_·ge
 = 'Previous';

203 
$Ïng_Ãxt_·ge
 = 'Next';

204 
$Ïng_šdex_·ge
 = 'Index';

205 
$Ïng_’d_·ge
 = 'End';

206 
$Ïng_»cÜd_numb”
 = ' Records';

207 
$Ïng_·ge
 = ' Pages ';

208 
$Ïng_tÙ®
 = 'Total';

211 
$´•age
 = 
$Ãxage
 = 
$g‘u¾
ğ
$hid’fÜm
 = '';

212 
$pu¾
 = 
$this
->
	`G‘CurU¾
();

213 
$´•ag’um
 = 
$this
->
·geNO
-1;

214 
$Ãxag’um
 = 
$this
->
·geNO
+1;

215 if(!
	`is£t
(
$©ts
['li¡size']è|| 
	`´eg_m©ch
("#[^0-9]#", $atts['listsize']))

217 
$©ts
['listsize'] = 5;

219 if(!
	`is£t
(
$©ts
['listitem']))

221 
$©ts
['listitem'] = "info,index,end,pre,next,pageno";

223 
$tÙ®·ge
 = 
	`û
(
$this
->
tÙ®ResuÉ
/$this->
·geSize
);

227 if(
$tÙ®·ge
<=1 && 
$this
->
tÙ®ResuÉ
 > 0)

229  "<¥ª>{$Ïng_tÙ®} 1 {$Ïng_·ge}/".
$this
->
tÙ®ResuÉ
.
$Ïng_»cÜd_numb”
."</span>";

231 if(
$this
->
tÙ®ResuÉ
 == 0)

233  "<¥ª>{$Ïng_tÙ®} 0 {$Ïng_·ge}/".
$this
->
tÙ®ResuÉ
.
$Ïng_»cÜd_numb”
."</span>";

235 
$šfos
 = "<span>{$lang_total} {$totalpage} {$lang_page}/{$this->totalResult}{$lang_record_number} </span>";

236 if(
$this
->
tÙ®ResuÉ
!=0)

238 
$this
->
g‘V®ues
['tÙ®»suÉ'] = $this->
tÙ®ResuÉ
;

240 if(
	`couÁ
(
$this
->
g‘V®ues
)>0)

242 
	`fÜ—ch
(
$this
->
g‘V®ues
 
as
 
$key
=>
$v®ue
)

244 
$v®ue
 = 
	`u¾’code
($value);

245 
$g‘u¾
 .= "$key=$value"."&";

246 
$hid’fÜm
 .= "<inputype='hidden'‚ame='$key' value='$value' />\n";

249 
$pu¾
 .ğ"?".
$g‘u¾
;

252 if(
$this
->
·geNO
 != 1)

254 
$´•age
 .ğ"<¨şass='´ePage' h»f='".
$pu¾
."pageno=$prepagenum'>$lang_pre_page</a> \n";

255 
$šdex·ge
 = "<¨şass='šdexPage' h»f='".
$pu¾
."pageno=1'>$lang_index_page</a> \n";

259 
$šdex·ge
 = "<span class='indexPage'>"."$lang_index_page \n"."</span>";

261 if(
$this
->
·geNO
 !ğ
$tÙ®·ge
 && $totalpage > 1)

263 
$Ãxage
.="<¨şass='ÃxtPage' h»f='".
$pu¾
."pageno=$nextpagenum'>$lang_next_page</a> \n";

264 
$’d·ge
="<¨şass='’dPage' h»f='".
$pu¾
."pageno=$totalpage'>$lang_end_page</a> \n";

268 
$’d·ge
=" <strong>$lang_end_page</strong> \n";

272 
$li¡dd
 = "";

273 
$tÙ®_li¡
 = 
$©ts
['listsize'] * 2 + 1;

274 if(
$this
->
·geNO
 >ğ
$tÙ®_li¡
)

276 
$j
 = 
$this
->
·geNO
 - 
$©ts
['listsize'];

277 
$tÙ®_li¡
=
$this
->
·geNO
 + 
$©ts
['listsize'];

278 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

280 
$tÙ®_li¡
 = 
$tÙ®·ge
;

285 
$j
=1;

286 if(
$tÙ®_li¡
 > 
$tÙ®·ge
)

288 
$tÙ®_li¡
 = 
$tÙ®·ge
;

291 
$j
; $j<=
$tÙ®_li¡
; $j++)

293 
$li¡dd
 .ğ
$j
==
$this
->
·geNO
 ? "<¡rÚg>$j</¡rÚg>\n" : "<¨h»f='".
$pu¾
."pageno=$j'>".$j."</a>\n";

296 
$¶i¡
 = "<div class=\"pagelistbox\">\n";

299 if(
	`´eg_m©ch
("#šfo#i",
$©ts
['listitem']))

301 
$¶i¡
 .ğ
$šfos
;

303 if(
	`´eg_m©ch
("#šdex#i", 
$©ts
['listitem']))

305 
$¶i¡
 .ğ
$šdex·ge
;

307 if(
	`´eg_m©ch
("#´e#i", 
$©ts
['listitem']))

309 
$¶i¡
 .ğ
$´•age
;

311 if(
	`´eg_m©ch
("#·g’o#i", 
$©ts
['listitem']))

313 
$¶i¡
 .ğ
$li¡dd
;

315 if(
	`´eg_m©ch
("#Ãxt#i", 
$©ts
['listitem']))

317 
$¶i¡
 .ğ
$Ãxage
;

319 if(
	`´eg_m©ch
("#’d#i", 
$©ts
['listitem']))

321 
$¶i¡
 .ğ
$’d·ge
;

323 if(
	`´eg_m©ch
("#fÜm#i", 
$©ts
['listitem']))

325 
$¶i¡
 .=" <fÜm‚ame='·g–i¡'‡ùiÚ='".
$this
->
	`G‘CurU¾
()."' style='float:left;' class='pagelistform'>$hidenform";

326 if(
$tÙ®·ge
>
$tÙ®_li¡
)

328 
$¶i¡
.="<inputype='text'‚ame='pageno' style='padding:0px;width:30px;height:18px;font-size:11px' />\r\n";

329 
$¶i¡
.="<inputype='submit'‚ame='plistgo' value='GO' style='padding:0px;width:30px;height:22px;font-size:11px' />\r\n";

331 
$¶i¡
 .= "</form>\n";

333 
$¶i¡
 .= "</div>\n";

334  
$¶i¡
;

335 
	}
}

338 
funùiÚ
 
	$G‘CurU¾
()

340 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

342 
$nowu¾
 = 
$_SERVER
["REQUEST_URI"];

343 
$nowu¾s
 = 
	`ex¶ode
("?",
$nowu¾
);

344 
$nowu¾
 = 
$nowu¾s
[0];

348 
$nowu¾
 = 
$_SERVER
["PHP_SELF"];

350  
$nowu¾
;

351 
	}
}

354 
funùiÚ
 
	$Clo£
()

357 
	}
}

360 
funùiÚ
 
	$Di¥Ïy
()

362 
$this
->
	`P»Lßd
();

365 
$this
->
l
->
	`S‘Objeù
($this);

366 
$this
->
l
->
	`Di¥Ïy
();

367 
	}
}

370 
funùiÚ
 
	$SaveTo
(
$f’ame
)

372 
$this
->
l
->
	`SaveTo
(
$f’ame
);

373 
	}
}

	@E:\web\weixun\functions\dialog\config.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../common.inc.php");

8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../userlogin.class.php");

11 
	g$xakNowu¾
 = '';

12 
	g$s_sütName
 = '';

13 
	g$isU¾O³n
 = @
ši_g‘
('allow_url_fopen');

15 
	g$xakNowu¾
 = 
G‘CurU¾
();

16 
	g$xakNowu¾s
 = 
ex¶ode
("?",
$xakNowu¾
);

17 
	g$s_sütName
 = 
$xakNowu¾s
[0];

20 
	g$cu£rLogš
 = 
Ãw
 
u£rLogš
();

22 if(
	g$cu£rLogš
->
g‘U£rID
() <=0 )

24 if(
em±y
(
$admšDœHªd
))

26 
ShowMsg
("<b>æç¤ºï¼šéœ€è¾“å…¥åå°ç®¡ç†ç›®å½•æ‰èƒ½ç™»å½•</b><b¸/><fÜm>è¯·è¾“å…¥åå°ç®¡ç†ç›®å½•åï¼š<špuˆty³='hidd’'‚ame='gÙİage' v®ue='".
u¾’code
(
$xakNowu¾
)."' /><inputype='text'‚ame='adminDirHand' value='' style='width:120px;' /><input style='width:80px;'ype='submit'‚ame='sbt' value='è½¬å…¥ç™»å½•' /></form>", "javascript:;");

27 
ex™
();

29 
	g$gu¾
 = "../../{$admšDœHªd}/logš.php?gÙİage=".
u¾’code
(
$xakNowu¾
);

30 
	gecho
 "<script†anguage='javascript'>location='$gurl';</script>";

31 
ex™
();

35 if(
	g$cfg_»mÙe_s™e
=='Y')

37 
»quœe_Úû
(
XAKINC
.'/ftp.class.php');

38 if(
fe_exi¡s
(
XAKDATA
."/cache/inc_remote_config.php"))

40 
»quœe_Úû
 
	gXAKDATA
."/cache/inc_remote_config.php";

42 if(
em±y
(
$»mÙeu¶ßds
)è
	g$»mÙeu¶ßds
 = 0;

43 if(
em±y
(
$»mÙeupU¾
)è
	g$»mÙeupU¾
 = '';

45 
	g$ápcÚfig
 = 
¬¿y
(

46 'ho¡Çme'=>
$rmho¡
,

47 'pÜt'=>
$rmpÜt
,

48 'u£ºame'=>
$rmÇme
,

49 '·sswÜd'=>
$rmpwd


52 
	g$áp
 = 
Ãw
 
FTP
;

53 
	g$áp
->
cÚÃù
(
$ápcÚfig
);

	@E:\web\weixun\functions\dialog\select_images.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
šşude
(
XAKDATA
.'/mark/inc_photowatermark_config.php');

9 if(
	$em±y
(
$aùiv•©h
))

11 
$aùiv•©h
 = '';

12 
	}
}

13 if(
	$em±y
(
$img¡ick
))

15 
$img¡ick
 = '';

16 
	}
}

17 
	g$nÛd™Ü
 = 
is£t
(
$nÛd™Ü
)? $noeditor : '';

18 
	g$aùiv•©h
 = 
¡r_»¶aû
('.', '', 
$aùiv•©h
);

19 
	g$aùiv•©h
 = 
´eg_»¶aû
("#\/{1,}#", '/', 
$aùiv•©h
);

20 if(
¡¾’
(
$aùiv•©h
è< 
	$¡¾’
(
$cfg_medŸs_dœ
))

22 
$aùiv•©h
 = 
$cfg_medŸs_dœ
;

23 
	}
}

25 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

26 
	g$aùiveu¾
 = '..'.
$aùiv•©h
;

29 if(
	$em±y
(
$f
))

31 
$f
 = 'form1.picname';

32 
	}
}

33 if(
	$em±y
(
$v
))

35 
$v
 = 'picview';

36 
	}
}

37 if(
	$em±y
(
$comeback
))

39 
$comeback
 = '';

40 
	}
}

41 
	g$add·rm
 = '';

42 ià(!
	$em±y
(
$CKEd™Ü
))

44 
$add·rm
 = '&CKEd™Ü='.
$CKEd™Ü
;

45 
$f
 = 
$CKEd™Ü
;

46 
	}
}

47 ià(!
	$em±y
(
$CKEd™ÜFuncNum
))

49 
$add·rm
 .ğ'&CKEd™ÜFuncNum='.
$CKEd™ÜFuncNum
;

50 
	}
}

52 ià(!
	$em±y
(
$nÛd™Ü
))

54 
$add·rm
 .= '&noeditor=yes';

55 
	}
}

57 <
	ghtml
>

58 <
	gh—d
>

59 <
m‘a
 
	gh‰p
-
	gequiv
='CÚ‹Á-Ty³' 
cÚ‹Á
='text/html; charset=<?phpƒcho $cfg_soft_lang; ?>'>

60 <
t™Ë
>å›¾ç‰‡æµè§ˆå™¨</title>

61 <
lšk
 
h»f
='../../moduË/img/ba£.css' 
»l
='¡yËsh“t' 
ty³
='text/css'>

62 <
¡yË
>

63 .
lš”ow
 {
bÜd”
-
bÙtom
: 1
px
 
sŞid
 #CBD8AC;}

64 .
	gÇpisdiv
 {
	gËá
:40;
	gtİ
:3;
	gwidth
:150
px
;
	gheight
:100px;
	gpos™iÚ
:
absŞu‹
;
	gz
-
	gšdex
:3;
	gdi¥Ïy
:
nÚe
;}

65 </
	g¡yË
>

66 <
	gsüt
>

67 
funùiÚ
 
	$nuÎLšk
(){ ; 
	}
}

68 
funùiÚ
 
	$ChªgeImage
(
su¾
){ 
docum’t
.
	`g‘EËm’tById
('picv›w').
¤c
 = su¾; 
	}
}

69 </
	gsüt
>

70 </
	gh—d
>

71 <
body
 
	gbackground
='img/®lbg.gif' 
Ëám¬gš
='0' 
tİm¬gš
='0'>

72 <
div
 
id
="æß‹r" 
şass
="napisdiv">

73 <
a
 
h»f
="javasüt:nuÎLšk();" 
ÚClick
="docum’t.g‘EËm’tById('æß‹r').¡yË.di¥Ïy='nÚe';"><
img
 
¤c
='img/picv›wnÚe.gif' 
id
='picv›w' 
bÜd”
='0' 
®t
='å•å‡»å…³é—­é¢„è§ˆ'></a>

74 </
div
>

75 <
SCRIPT
 
Ïnguage
=
JavaSüt
 
¤c
="js/float.js"></SCRIPT>

76 <
SCRIPT
 
Ïnguage
=
JavaSüt
>

77 
funùiÚ
 
	$nuÎLšk
(){ ; 
	}
}

78 
funùiÚ
 
	$ChªgeImage
(
su¾
){ 
docum’t
.
	`g‘EËm’tById
('æß‹r').
¡yË
.
di¥Ïy
='block';docum’t.g‘EËm’tById('picv›w').
¤c
 = su¾; 
	}
}

79 
funùiÚ
 
	$TNav
()

81 if(
wšdow
.
Çvig©Ü
.
u£rAg’t
.
	`šdexOf
("MSIE")>=1)  'IE';

82 if(
wšdow
.
Çvig©Ü
.
u£rAg’t
.
	`šdexOf
("Firefox")>=1)  'FF';

84 
	}
}

86 
funùiÚ
 
	$g‘U¾P¬am
(
·¿mName
)

88 
v¬
 
»P¬am
 = 
Ãw
 
	`RegExp
('(?:[\?&]|&amp;)' + 
·¿mName
 + '=([^&]+)', 'i') ;

89 
v¬
 
m©ch
 = 
wšdow
.
loÿtiÚ
.
£¬ch
.
	`m©ch
(
»P¬am
) ;

90  (
m©ch
 && m©ch.
Ëngth
 > 1) ? match[1] : '' ;

91 
	}
}

93 
funùiÚ
 
	$R‘uºImg
(
»img
)

95 
v¬
 
funcNum
 = 
	`g‘U¾P¬am
('CKEditorFuncNum');

96 if(
funcNum
 > 1)

98 
v¬
 
feU¾
 = 
»img
;

99 
wšdow
.
İ’”
.
CKEDITOR
.
toŞs
.
	`ÿÎFunùiÚ
(
funcNum
, 
feU¾
);

101 if(
wšdow
.
İ’”
.
docum’t
.<?
php
 
echo
 
$f
?> !ğ
nuÎ
)

103 
wšdow
.
İ’”
.
docum’t
.<?
php
 
echo
 
$f
?>.
v®ue
=
»img
;

104 if(
wšdow
.
İ’”
.
docum’t
.
	`g‘EËm’tById
('div<?phpƒcho $v?>'))

106 if(
	`TNav
()=='IE'){

108 
wšdow
.
İ’”
.
docum’t
.
	`g‘EËm’tById
('div<?ph°echØ$v?>').
¤c
 = 
»img
;

109 
wšdow
.
İ’”
.
docum’t
.
	`g‘EËm’tById
('div<?ph°echØ$v?>').
¡yË
.
width
 = '150px';

110 
wšdow
.
İ’”
.
docum’t
.
	`g‘EËm’tById
('div<?ph°echØ$v?>').
¡yË
.
height
 = '100px';

113 
wšdow
.
İ’”
.
docum’t
.
	`g‘EËm’tById
('div<?ph°echØ$v?>').
¡yË
.
backgroundImage
 = "u¾("+
»img
+")";

115 if(
wšdow
.
İ’”
.
docum’t
.
	`g‘EËm’tById
('<?phpƒcho $v?>')){

116 
wšdow
.
İ’”
.
docum’t
.
	`g‘EËm’tById
('<?ph°echØ$v?>').
¤c
 = 
»img
;

118 if(
docum’t
.
®l
è
wšdow
.
İ’”
=
Œue
;

121 
wšdow
.
	`şo£
();

122 
	}
}

123 </
	gSCRIPT
>

124 <
bË
 
	gwidth
='100%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0' 
®ign
="center">

125 <
Œ
>

126 <
td
 
cŞ¥ª
='4' 
®ign
='right'>

127 <
bË
 
width
='100%' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CBD8AC'>

128 <
Œ
 
bgcŞÜ
='#FFFFFF'>

129 <
td
 
cŞ¥ª
='4'>

130 <
bË
 
width
='100%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='2'>

131 <
Œ
 
bgcŞÜ
="#CCCCCC">

132 <
td
 
width
="8%" 
®ign
="ûÁ”" 
şass
='lš”ow' 
bgcŞÜ
='#EEF4EA'><
¡rÚg
>é¢„è§ˆ</strong></td>

133 <
td
 
width
="47%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>ç‚¹å‡»åç§°é€‰æ‹©å›¾ç‰‡</strong></td>

134 <
td
 
width
="15%" 
®ign
="ûÁ”" 
bgcŞÜ
='#EEF4EA' 
şass
='lš”ow'><
¡rÚg
>æ–‡ä»¶å¤§å°</strong></td>

135 <
td
 
width
="30%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>æœ€åä¿®æ”¹æ—¶é—´</strong></td>

136 </
Œ
>

137 <
Œ
>

138 <
td
 
şass
='lš”ow' 
cŞ¥ª
='4' 
bgcŞÜ
='#F9FBF0'>

139 ç‚¹å‡»â€œ
V
â€é¢„è§ˆå›¾ç‰‡ï¼Œç‚¹å‡»å›¾ç‰‡åé€‰æ‹©å›¾ç‰‡ï¼Œæ˜¾ç¤ºå›¾ç‰‡åç‚¹å‡»è¯¥å›¾ç‰‡å…³é—­é¢„è§ˆã€‚

140 </
td
>

141 </
Œ
>

142 <?
php


144 
$dh
 = 
dœ
(
$š·th
);

145 
	g$ty1
="";

146 
	g$ty2
="";

147 
	g$fe
 = 
$dh
->
	$»ad
()) {

149 if(
$fe
!="." && $fe!=".." && !
	`is_dœ
("$inpath/$file")){

150 
$fesize
 = 
	`fesize
("$inpath/$file");

151 
$fesize
 = $filesize / 1024;

152 if(
$fesize
 != "")

153 if(
$fesize
 < 0.1){

154 @
	`li¡
(
$ty1
, 
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

155 
$fesize
 = 
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 2);

158 @
	`li¡
(
$ty1
, 
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

159 
$fesize
 = 
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 1);

161 
$f‘ime
 = 
	`femtime
("$inpath/$file");

162 
$f‘ime
 = 
	`MyD©e
("Y-m-d H:i:s", $filetime);

165 if(
$fe
 == ".") ;

166 if(
$fe
 == "..")

168 if(
$aùiv•©h
 == "") ;

169 
$tmp
 = 
	`´eg_»¶aû
("#[\/][^\/]*$#i", "", 
$aùiv•©h
);

170 
$lše
 = "\n<tr>

171 <
td
 
şass
='lš”ow' 
cŞ¥ª
='2'>

172 <
a
 
h»f
='£Ëù_images.php?img¡ick=$img¡ick&v=$v&f=$f&aùiv•©h=".u¾’code($tmp).$add·rm."'><
img
 
¤c
=img/
dœ2
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>ä¸Šçº§ç›®å½•</a></
td
>

173 <
td
 
cŞ¥ª
='2' 
şass
='lš”ow'> å½“å‰ç›®å½•:
$aùiv•©h
</td>

174 </
Œ
>

176 
echo
 
$lše
;

178 if(
	`is_dœ
("$inpath/$file"))

180 if(
	`´eg_m©ch
("#^_(.*)$#i", 
$fe
)è; #å±è”½
FrÚtPage
æ‰©å±•ç›®å½•å’Œ
lšux
éšè”½ç›®å½•

181 if(
	`´eg_m©ch
("#^\.(.*)$#i", 
$fe
)) ;

182 
$lše
 = "\n<tr>

183 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='lš”ow' 
cŞ¥ª
='2'>

184 <
a
 
h»f
='£Ëù_images.php?img¡ick=$img¡ick&v=$v&f=$f&aùiv•©h=".u¾’code("$aùiv•©h/$fe").$add·rm."'><
img
 
¤c
=img/
dœ
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>
$fe
</a></
td
>

185 <
td
 
şass
='linerow'>ã€€</td>

186 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='linerow'>ã€€</td>

187 </
Œ
>";

188 
echo
 "$line";

190 if(
	`´eg_m©ch
("#\.(gif|²g)#i", 
$fe
))

192 
$»u¾
 = "$activeurl/$file";

193 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

194 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

196 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

198 
$»u¾
 = $reurl;

201 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

202 
$l¡yË
 = "";

204 
$lše
 = "\n<tr>

205 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

206 <
a
 
h»f
=\"#\" onClick=\"ChangeImage('$reurl');\"><img src='img/picviewnone.gif' width='16' height='16' border='0'‡lign=absmiddle></a>

207 </
td
>

208 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

209 <
a
 
h»f
=#onclick=\"ReturnImg('$reurl');\" $lstyle><img src=img/gif.gif border=0 width=16 height=16‡lign=absmiddle>$file</a></td>

210 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

211 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

212 </
Œ
>";

213 
echo
 "$line";

215 if(
	`´eg_m©ch
("#\.(jpg)#i", 
$fe
))

217 
$»u¾
 = "$activeurl/$file";

218 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

219 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

221 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

223 
$»u¾
 = $reurl;

226 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

227 
$l¡yË
 = "";

229 
$lše
 = "\n<tr>

230 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

231 <
a
 
h»f
=\"#\" onClick=\"ChangeImage('$reurl');\"><img src='img/picviewnone.gif' width='16' height='16' border='0'‡lign=absmiddle></a>

232 </
td
>

233 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

234 <
a
 
h»f
=#onclick=\"ReturnImg('$reurl');\" $lstyle><img src=img/jpg.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

235 </
td
>

236 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

237 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

238 </
Œ
>";

239 
echo
 "$line";

241 
	}
}

242 
	g$dh
->
şo£
();

244 <
	gŒ
>

245 <
td
 
	gcŞ¥ª
='4' 
bgcŞÜ
='#E8F1DE'>

247 <
bË
 
width
='100%'>

248 <
fÜm
 
aùiÚ
='£Ëù_images_po¡.php' 
m‘hod
='POST' 
’ùy³
="muÉ¬t/fÜm-d©a" 
Çme
='myform'>

249 <?
php
 
$nÛd™Ü
 = !
em±y
($nÛd™Ü)?"<špuˆty³='hidd’'‚ame='nÛd™Ü' v®ue='yes'>":''; 
echo
 
	g$nÛd™Ü
;

250 <
šput
 
	gty³
='hidd’' 
Çme
='aùiv•©h' 
v®ue
='<?phpƒcho $activepath?>'>

251 <
šput
 
ty³
='hidd’' 
Çme
='f' 
v®ue
='<?phpƒcho $f?>'>

252 <
šput
 
ty³
='hidd’' 
Çme
='v' 
v®ue
='<?phpƒcho $v?>'>

253 <
šput
 
ty³
='hidd’' 
Çme
='img¡ick' 
v®ue
='<?phpƒcho $imgstick?>'>

254 <
šput
 
ty³
='hidd’' 
Çme
='CKEd™ÜFuncNum' 
v®ue
='<?phpƒcho isset($CKEditorFuncNum)? $CKEditorFuncNum : 1;?>'>

255 <
šput
 
ty³
='hidd’' 
Çme
='job' 
v®ue
='upload'>

256 <
Œ
>

257 <
td
 
background
="img/tbg.gif" 
bgcŞÜ
="#99CC00">

258 &
nb¥
;ä¸Šã€€ä¼ ï¼š <
šput
 
	gty³
='fe' 
Çme
='imgfe' 
¡yË
='width:250px'/>

259 <
šput
 
ty³
='checkbox' 
Çme
='Ãedw©”m¬k' 
v®ue
='1' 
şass
='Å' <?
php
 if(
$phÙo_m¬kup
=='1'è
echo
 "checked"; ?> />æ°´å°

260 <
šput
 
	gty³
='checkbox' 
Çme
='»size' 
v®ue
='1' 
şass
='np' />ç¼©å°

261 å®½ï¼š<
šput
 
ty³
='‹xt' 
¡yË
='width:30' 
Çme
='iwidth' 
v®ue
='<?phpƒcho $cfg_ddimg_width?>' />

262 é«˜ï¼š<
šput
 
ty³
='‹xt' 
¡yË
='width:30' 
Çme
='iheight' 
v®ue
='<?phpƒcho $cfg_ddimg_height?>' />

263 <
šput
 
ty³
='subm™' 
Çme
='sb1' 
v®ue
='ç¡®å®š' />

264 </
td
>

265 </
Œ
>

266 </
fÜm
>

267 </
bË
>

269 </
td
>

270 </
Œ
>

271 </
bË
>

272 </
td
>

273 </
Œ
>

274 </
bË
>

275 </
td
>

276 </
Œ
>

277 </
bË
>

278 </
body
>

279 </
html
>

	@E:\web\weixun\functions\dialog\select_images_post.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../image.func.php");

11 if(
	$em±y
(
$aùiv•©h
))

13 
$aùiv•©h
 ='';

14 
$aùiv•©h
 = 
	`¡r_»¶aû
('.', '', $activepath);

15 
$aùiv•©h
 = 
	`´eg_»¶aû
("#\/{1,}#", '/', $activepath);

16 if(
	`¡¾’
(
$aùiv•©h
è< sŒËn(
$cfg_image_dœ
))

18 
$aùiv•©h
 = 
$cfg_image_dœ
;

20 
	}
}

22 if(
	$em±y
(
$imgfe
))

24 
$imgfe
='';

25 
	}
}

26 if(!
	$is_u¶ßded_fe
(
$imgfe
))

28 
	`ShowMsg
("ä½ æ²¡æœ‰é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶!".
$imgfe
, "-1");

29 
	`ex™
();

30 
	}
}

31 
	g$CKEd™ÜFuncNum
 = (
is£t
(
$CKEd™ÜFuncNum
))? $CKEditorFuncNum : 1;

32 
	g$imgfe_Çme
 = 
Œim
(
´eg_»¶aû
("#[ \r\n\t\*\%\\\/\?><\|\":]{1,}#", '', 
$imgfe_Çme
));

34 if(!
´eg_m©ch
("#\.(".
$cfg_imgty³
.")#i", 
$imgfe_Çme
))

36 
ShowMsg
("ä½ æ‰€ä¸Šä¼ çš„å›¾ç‰‡ç±»å‹ä¸åœ¨è®¸å¯åˆ—è¡¨ï¼Œè¯·æ›´æ”¹ç³»ç»Ÿå¯¹æ‰©å±•åé™å®šçš„é…ç½®ï¼", "-1");

37 
ex™
();

39 
	g$nowtme
 = 
time
();

40 
	g$¥¬r
 = 
A¼ay
("image/pjpeg", "image/jpeg", "image/gif", "image/png", "image/xpng", "image/wbmp");

41 
	g$imgfe_ty³
 = 
¡¹Şow”
(
Œim
(
$imgfe_ty³
));

42 if(!
	$š_¬¿y
(
$imgfe_ty³
, 
$¥¬r
))

44 
	`ShowMsg
("ä¸Šä¼ çš„å›¾ç‰‡æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨JPEGã€GIFã€PNGã€WBMPæ ¼å¼çš„å…¶ä¸­ä¸€ç§ï¼","-1");

45 
	`ex™
();

46 
	}
}

47 
	g$mdœ
 = 
MyD©e
(
$cfg_addÚ_§v‘y³
, 
$nowtme
);

48 if(!
is_dœ
(
$cfg_ba£dœ
.
$aùiv•©h
."/$mdir"))

50 
MkdœAÎ
(
$cfg_ba£dœ
.
$aùiv•©h
."/$mdœ",
$cfg_dœ_purv›w
);

51 
Clo£F
();

53 
	g$f’ame_Çme
 = 
$cu£rLogš
->
g‘U£rID
().'-'.
dd2ch¬
(
MyD©e
("ymdHis", 
$nowtme
).
mt_¿nd
(100,999));

54 
	g$f’ame
 = 
$mdœ
.'/'.
$f’ame_Çme
;

55 
	g$fs
 = 
ex¶ode
('.', 
$imgfe_Çme
);

56 
	g$f’ame
 = 
$f’ame
.'.'.
$fs
[
couÁ
($fs)-1];

57 
	g$f’ame_Çme
 = 
$f’ame_Çme
.'.'.
$fs
[
couÁ
($fs)-1];

58 
	g$fuÎf’ame
 = 
$cfg_ba£dœ
.
$aùiv•©h
."/".
$f’ame
;

59 
	$move_u¶ßded_fe
(
$imgfe
, 
$fuÎf’ame
è
Ü
 
	`d›
("ä¸Šä¼ æ–‡ä»¶åˆ° $fullfilename å¤±è´¥ï¼");

60 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

63 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '', 
$fuÎf’ame
);

64 
$loÿlfe
 = '../..'.
$»mÙefe
;

66 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.(jpg|gif|bmp|²g)/', '', 
$»mÙefe
);

67 
$áp
->
	`rmkdœ
(
$»mÙedœ
);

68 
$áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
);

69 
	}
}

70 @
uÆšk
(
$imgfe
);

72 if(
	$em±y
(
$»size
))

74 
$»size
 = 0;

75 
	}
}

76 if(
	g$»size
==1)

78 if(
š_¬¿y
(
$imgfe_ty³
, 
$cfg_phÙo_ty³Çmes
))

80 if(
$cfg_ddimg_fuÎ
=='Y')

82 
ImageResizeNew
(
$fuÎf’ame
, 
$iwidth
, 
$iheight
);

86 
ImageResize
(
$fuÎf’ame
, 
$iwidth
, 
$iheight
);

93 if(
š_¬¿y
(
$imgfe_ty³
, 
$cfg_phÙo_ty³Çmes
))

95 
W©”Img
(
$fuÎf’ame
, 'up');

99 
	g$šfo
 = '';

100 
	g$sizes
[0] = 0; $sizes[1] = 0;

101 
	g$sizes
 = 
g‘imagesize
(
$fuÎf’ame
, 
$šfo
);

102 
	g$imgwidthV®ue
 = 
$sizes
[0];

103 
	g$imgheightV®ue
 = 
$sizes
[1];

104 
	g$imgsize
 = 
fesize
(
$fuÎf’ame
);

105 
	g$šqu”y
 = "INSERT INTO `#@__uploads`(arcid,title,url,mediatype,width,height,playtime,filesize,uptime,mid)

106 
VALUES
 ('0','$filename','".$activepath."/".$filename."','1','$imgwidthValue','$imgheightValue','0','{$imgsize}','{$nowtme}','".$cuserLogin->getUserID()."'); ";

107 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

108 
	g$fid
 = 
$dsql
->
G‘La¡ID
();

109 
AddMyAddÚ
(
$fid
, 
$aùiv•©h
.'/'.
$f’ame
);

110 
	g$CKU¶ßd
 = 
is£t
(
$CKU¶ßd
)? $CKU¶ßd : 
FALSE
;

111 ià(
	g$GLOBALS
['cfg_html_ed™Ü']=='cked™Ü' && 
$CKU¶ßd
)

113 
$feu¾
 = 
$aùiv•©h
.'/'.
$f’ame
;

114 
	g$mes§ge
 = '';

116 
	g$¡r
='<süˆty³="‹xt/javasüt">wšdow.·»Á.CKEDITOR.toŞs.ÿÎFunùiÚ('.
$CKEd™ÜFuncNum
.', \''.
$feu¾
.'\', \''.
$mes§ge
.'\');</script>';

117 
ex™
(
$¡r
);

120 if(!
	$em±y
(
$nÛd™Ü
)){

122 
	`ShowMsg
("æˆåŠŸä¸Šä¼ ä¸€å¹…å›¾ç‰‡ï¼","£Ëù_images.php?img¡ick=$img¡ick&comeback=".
	`u¾’code
(
$f’ame_Çme
)."&v=$v&f=$f&CKEd™ÜFuncNum=$CKEd™ÜFuncNum&nÛd™Ü=yes&aùiv•©h=".u¾’code(
$aùiv•©h
)."/$mdœ&d=".
	`time
());

123 
	}

	g}–£
{

124 
ShowMsg
("æˆåŠŸä¸Šä¼ ä¸€å¹…å›¾ç‰‡ï¼","£Ëù_images.php?img¡ick=$img¡ick&comeback=".
u¾’code
(
$f’ame_Çme
)."&v=$v&f=$f&CKEd™ÜFuncNum=$CKEd™ÜFuncNum&aùiv•©h=".u¾’code(
$aùiv•©h
)."/$mdœ&d=".
time
());

126 
ex™
();

	@E:\web\weixun\functions\dialog\select_media.php

1 <?
php


8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

9 if(
	$em±y
(
$aùiv•©h
))

11 
$aùiv•©h
 = '';

12 
	}
}

13 
	g$nÛd™Ü
 = 
is£t
(
$nÛd™Ü
)? $noeditor : '';

14 
	g$aùiv•©h
 = 
¡r_»¶aû
('.', '', 
$aùiv•©h
);

15 
	g$aùiv•©h
 = 
´eg_»¶aû
("#\/{1,}#", '/', 
$aùiv•©h
);

16 if(
¡¾’
(
$aùiv•©h
è< 
	$¡¾’
(
$cfg_Ùh”_medŸs
))

18 
$aùiv•©h
 = 
$cfg_Ùh”_medŸs
;

19 
	}
}

20 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

21 
	g$aùiveu¾
 = '..'.
$aùiv•©h
;

22 if(
	$em±y
(
$f
))

24 
$f
 = 'form1.enclosure';

25 
	}
}

27 if(
	$em±y
(
$comeback
))

29 
$comeback
 = '';

30 
	}
}

31 
	g$add·rm
 = '';

32 ià(!
	$em±y
(
$CKEd™Ü
))

34 
$add·rm
 = '&CKEd™Ü='.
$CKEd™Ü
;

35 
	}
}

36 ià(!
	$em±y
(
$CKEd™ÜFuncNum
))

38 
$add·rm
 .ğ'&CKEd™ÜFuncNum='.
$CKEd™ÜFuncNum
;

39 
	}
}

40 ià(!
	$em±y
(
$nÛd™Ü
))

42 
$add·rm
 .= '&noeditor=yes';

43 
	}
}

45 <
	ghtml
>

46 <
	gh—d
>

47 <
m‘a
 
	gh‰p
-
	gequiv
='CÚ‹Á-Ty³' 
cÚ‹Á
='text/html; charset=<?phpƒcho $cfg_soft_lang; ?>'>

48 <
t™Ë
>åª’ä½“æ–‡ä»¶ç®¡ç†å™¨</title>

49 <
lšk
 
h»f
='../../moduË/img/ba£.css' 
»l
='¡yËsh“t' 
ty³
='text/css'>

50 <
¡yË
>

51 .
lš”ow
 {
bÜd”
-
bÙtom
: 1
px
 
sŞid
 #CBD8AC;}

52 </
	g¡yË
>

53 </
	gh—d
>

54 <
body
 
	gbackground
='img/®lbg.gif' 
Ëám¬gš
='0' 
tİm¬gš
='0'>

55 <
SCRIPT
 
Ïnguage
='JavaScript'>

56 
funùiÚ
 
	$nuÎLšk
()

59 
	}
}

61 
funùiÚ
 
	$R‘uºV®ue
(
»img
)

63 if(
wšdow
.
İ’”
.
docum’t
.<?
php
 
echo
 
$f
?> !ğ
nuÎ
)

65 
wšdow
.
İ’”
.
docum’t
.<?
php
 
echo
 
$f
?>.
v®ue
=
»img
;

68 
v¬
 
funcNum
 = <?
php
 
echo
 
	`is£t
(
$CKEd™ÜFuncNum
)? $CKEditorFuncNum : 1;?>;

69 if(
wšdow
.
İ’”
.
CKEDITOR
 !ğ
nuÎ
 && 
funcNum
 != 1)

72 
wšdow
.
İ’”
.
CKEDITOR
.
toŞs
.
	`ÿÎFunùiÚ
(
funcNum
, 
»img
);

75 
wšdow
.
	`şo£
();

76 
	}
}

77 </
	gSCRIPT
>

78 <
bË
 
	gwidth
='100%' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CBD8AC' 
®ign
="center">

79 <
Œ
 
bgcŞÜ
='#FFFFFF'>

80 <
td
 
cŞ¥ª
='3'>

82 <
bË
 
width
='100%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='2'>

83 <
Œ
 
bgcŞÜ
="#CCCCCC">

84 <
td
 
width
="55%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>ç‚¹å‡»åç§°é€‰æ‹©æ–‡ä»¶</strong></td>

85 <
td
 
width
="15%" 
®ign
="ûÁ”" 
bgcŞÜ
='#EEF4EA' 
şass
='lš”ow'><
¡rÚg
>æ–‡ä»¶å¤§å°</strong></td>

86 <
td
 
width
="30%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>æœ€åä¿®æ”¹æ—¶é—´</strong></td>

87 </
Œ
>

88 <?
php


89 
$dh
 = 
dœ
(
$š·th
);

90 
	g$ty1
="";

91 
	g$ty2
="";

92 
	g$fe
 = 
$dh
->
	$»ad
()) {

94 if(
$fe
!="." && $fe!=".." && !
	`is_dœ
("$inpath/$file")){

95 
$fesize
 = 
	`fesize
("$inpath/$file");

96 
$fesize
 = $filesize/1024;

97 if(
$fesize
!="")

98 if(
$fesize
<0.1)

100 @
	`li¡
(
$ty1
,
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

101 
$fesize
 = 
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 2);

104 @
	`li¡
(
$ty1
,
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

105 
$fesize
=
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 1);

107 
$f‘ime
 = 
	`femtime
("$inpath/$file");

108 
$f‘ime
 = 
	`MyD©e
("Y-m-d H:i:s", $filetime);

112 if(
$fe
 == ".") ;

113 if(
$fe
 == "..")

115 if(
$aùiv•©h
 == "") ;

116 
$tmp
 = 
	`´eg_»¶aû
("#[\/][^\/]*$#i", "", 
$aùiv•©h
);

117 
$lše
 = "\n<tr>

118 <
td
 
şass
='lš”ow'> <
a
 
h»f
=
£Ëù_medŸ
.
php
?
f
=
$f
&
aùiv•©h
=".u¾’code($tmp).$add·rm."><
img
 
¤c
=img/
dœ2
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>ä¸Šçº§ç›®å½•</a></td>

119 <
td
 
cŞ¥ª
='2' 
şass
='lš”ow'> å½“å‰ç›®å½•:
$aùiv•©h
</td>

120 </
Œ
>\
r
\
n
";

121 
echo
 
$lše
;

123 if(
	`is_dœ
("$inpath/$file"))

125 if(
	`´eg_m©ch
("#^_(.*)$#i", 
$fe
)è; #å±è”½
FrÚtPage
æ‰©å±•ç›®å½•å’Œ
lšux
éšè”½ç›®å½•

126 if(
	`´eg_m©ch
("#^\.(.*)$#i", 
$fe
)) ;

127 
$lše
 = "\n<tr>

128 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='linerow'>

129 <
a
 
h»f
=
£Ëù_medŸ
.
php
?
f
=
$f
&
aùiv•©h
=".u¾’code("
$aùiv•©h
/
$fe
").$add·rm."><
img
 
¤c
=img/
dœ
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>$file</a>

130 </
td
>

131 <
td
 
şass
='linerow'>-</td>

132 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='linerow'>-</td>

133 </
Œ
>";

134 
echo
 "$line";

136 if(
	`´eg_m©ch
("#\.(swf|æy|æa|æv)#i", 
$fe
)){

137 
$»u¾
 = "$activeurl/$file";

138 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

139 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

141 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

143 
$»u¾
 = $reurl;

146 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

147 
$l¡yË
 = "";

149 
$lše
 = "\n<tr>

150 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

151 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\"><img src=img/flash.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

152 </
td
>

153 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

154 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

155 </
Œ
>";

156 
echo
 "$line";

158 if(
	`´eg_m©ch
("#\.(wmv|avi)#i", 
$fe
)){

160 
$»u¾
 = "$activeurl/$file";

161 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

162 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

164 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

166 
$»u¾
 = $reurl;

169 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

170 
$l¡yË
 = "";

172 
$lše
 = "\n<tr>

173 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

174 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\"><img src=img/wmv.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

175 </
td
>

176 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

177 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

178 </
Œ
>";

179 
echo
 "$line";

181 if(
	`´eg_m©ch
("#\.Ôm|rmvb)#i", 
$fe
))

183 
$»u¾
 = "$activeurl/$file";

184 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

185 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

187 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

189 
$»u¾
 = $reurl;

192 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

193 
$l¡yË
 = "";

195 
$lše
 = "\n<tr>

196 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

197 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\"><img src=img/rm.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

198 </
td
>

199 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

200 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

201 </
Œ
>";

202 
echo
 "$line";

204 if(
	`´eg_m©ch
("#\.(mp3|wma)#", 
$fe
)){

206 
$»u¾
 = "$activeurl/$file";

207 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

208 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

210 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

212 
$»u¾
 = $reurl;

215 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

216 
$l¡yË
 = "";

218 
$lše
 = "\n<tr>

219 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

220 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\"><img src=img/mp3.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

221 </
td
>

222 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

223 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

224 </
Œ
>";

225 
echo
 "$line";

227 
	}
}

228 
	g$dh
->
şo£
();

231 <
	gŒ
>

232 <
td
 
	gcŞ¥ª
='3' 
bgcŞÜ
='#E8F1DE'>

234 <
bË
 
width
='100%'>

235 <
fÜm
 
aùiÚ
='£Ëù_medŸ_po¡.php' 
m‘hod
='POST' 
’ùy³
="muÉ¬t/fÜm-d©a" 
Çme
='myform'>

236 <
šput
 
ty³
='hidd’' 
Çme
='aùiv•©h' 
v®ue
='<?phpƒcho $activepath?>'>

237 <
šput
 
ty³
='hidd’' 
Çme
='f' 
v®ue
='<?phpƒcho $f?>'>

238 <
šput
 
ty³
='hidd’' 
Çme
='job' 
v®ue
='upload'>

239 <
šput
 
ty³
='hidd’' 
Çme
='CKEd™ÜFuncNum' 
v®ue
='<?phpƒcho isset($CKEditorFuncNum)? $CKEditorFuncNum : 1;?>'>

240 <
Œ
>

241 <
td
 
background
="img/tbg.gif" 
bgcŞÜ
="#99CC00">

242 &
nb¥
;ä¸Šã€€ä¼ ï¼š <
šput
 
	gty³
='fe' 
Çme
='u¶ßdfe' 
¡yË
='width:320px'>&nb¥;<špuˆty³='subm™'‚ame='sb1' 
v®ue
='ç¡®å®š'>

243 </
td
>

244 </
Œ
>

245 </
fÜm
>

246 </
bË
>

248 </
td
>

249 </
Œ
>

250 </
bË
>

252 </
td
>

253 </
Œ
>

254 </
bË
>

256 </
body
>

257 </
html
>

	@E:\web\weixun\functions\dialog\select_media_post.php

1 <?
php


7 
šşude_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
	g$cfg_soáty³
 = 
$cfg_medŸty³
;

9 
	g$cfg_soá_dœ
 = 
$cfg_Ùh”_medŸs
;

10 
	g$bku¾
 = 'select_media.php';

11 
	g$u¶ßdmbty³
 = "å¤šåª’ä½“æ–‡ä»¶ç±»å‹";

12 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/select_soft_post.php");

	@E:\web\weixun\functions\dialog\select_soft.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
	$em±y
(
$aùiv•©h
))

10 
$aùiv•©h
 = '';

11 
	}
}

12 
	g$aùiv•©h
 = 
¡r_»¶aû
('.','',
$aùiv•©h
);

13 
	g$aùiv•©h
 = 
´eg_»¶aû
("#\/{1,}#", '/', 
$aùiv•©h
);

14 if(
¡¾’
(
$aùiv•©h
è< 
	$¡¾’
(
$cfg_soá_dœ
))

16 
$aùiv•©h
 = 
$cfg_soá_dœ
;

17 
	}
}

18 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

19 
	g$aùiveu¾
 = '..'.
$aùiv•©h
;

20 if(
	$em±y
(
$f
))

22 
$f
='form1.enclosure';

23 
	}
}

25 if(
	$em±y
(
$comeback
))

27 
$comeback
 = '';

28 
	}
}

29 
	g$add·rm
 = '';

30 ià(!
	$em±y
(
$CKEd™Ü
))

32 
$add·rm
 = '&CKEd™Ü='.
$CKEd™Ü
;

33 
	}
}

34 ià(!
	$em±y
(
$CKEd™ÜFuncNum
))

36 
$add·rm
 .ğ'&CKEd™ÜFuncNum='.
$CKEd™ÜFuncNum
;

37 
	}
}

38 ià(!
	$em±y
(
$nÛd™Ü
))

40 
$add·rm
 .= '&noeditor=yes';

41 
	}
}

43 <
	ghtml
>

44 <
	gh—d
>

45 <
m‘a
 
	gh‰p
-
	gequiv
='CÚ‹Á-Ty³' 
cÚ‹Á
='text/html; charset=<?phpƒcho $cfg_soft_lang; ?>'>

46 <
t™Ë
>è½¯ä»¶ç®¡ç†å™¨</title>

47 <
lšk
 
h»f
='../../moduË/img/ba£.css' 
»l
='¡yËsh“t' 
ty³
='text/css'>

48 <
¡yË
>

49 .
lš”ow
 {
bÜd”
-
bÙtom
: 1
px
 
sŞid
 #CBD8AC;}

50 </
	g¡yË
>

51 </
	gh—d
>

52 <
body
 
	gbackground
='img/®lbg.gif' 
Ëám¬gš
='5' 
tİm¬gš
='0'>

53 <
SCRIPT
 
Ïnguage
='JavaScript'>

54 
funùiÚ
 
	$nuÎLšk
()

57 
	}
}

59 
funùiÚ
 
	$R‘uºV®ue
(
»img
)

61 if(
wšdow
.
İ’”
.
docum’t
.<?
php
 
echo
 
$f
?> !ğ
nuÎ
)

63 
wšdow
.
İ’”
.
docum’t
.<?
php
 
echo
 
$f
?>.
v®ue
=
»img
;

65 
v¬
 
funcNum
 = "<?phpƒcho isset($CKEditorFuncNum)? $CKEditorFuncNum : 1;?>";

66 if(
wšdow
.
İ’”
.
CKEDITOR
 !ğ
nuÎ
 && 
funcNum
 != 1 && funcNum != '')

69 
wšdow
.
İ’”
.
CKEDITOR
.
toŞs
.
	`ÿÎFunùiÚ
(
funcNum
, 
»img
);

72 
wšdow
.
	`şo£
();

73 
	}
}

74 </
	gSCRIPT
>

75 <
bË
 
	gwidth
='100%' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CBD8AC' 
®ign
="center">

76 <
Œ
>

77 <
td
 
cŞ¥ª
='3' 
bgcŞÜ
='#E8F1DE' 
background
="img/tbg.gif" 
height
='28'>

78 <
fÜm
 
aùiÚ
='£Ëù_soá_po¡.php' 
m‘hod
='POST' 
’ùy³
="muÉ¬t/fÜm-d©a" 
Çme
='myform'>

79 <
šput
 
ty³
='hidd’' 
Çme
='aùiv•©h' 
v®ue
='<?phpƒcho $activepath;?>' />

80 <
šput
 
ty³
='hidd’' 
Çme
='f' 
v®ue
='<?phpƒcho $f?>' />

81 <
šput
 
ty³
='hidd’' 
Çme
='CKEd™ÜFuncNum' 
v®ue
='<?phpƒcho $CKEditorFuncNum;?>' />

82 <
šput
 
ty³
='hidd’' 
Çme
='job' 
v®ue
='upload' />

83 &
nb¥
;ä¸Šã€€ä¼ ï¼š <
šput
 
	gty³
='fe' 
Çme
='u¶ßdfe' 
size
='25' />

84 &
nb¥
;

85 æ”¹ åï¼š<
šput
 
	gty³
='‹¡' 
Çme
='ÃwÇme' 
¡yË
='width:90px' />

86 &
nb¥
;

87 <
šput
 
	gty³
='subm™' 
Çme
='sb1' 
v®ue
='ç¡®å®š' />

88 </
fÜm
>

89 </
td
>

90 </
Œ
>

91 <
Œ
 
bgcŞÜ
='#FFFFFF'>

92 <
td
 
cŞ¥ª
='3'>

94 <
bË
 
width
='100%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='2'>

95 <
Œ
 
bgcŞÜ
="#CCCCCC" 
height
="24">

96 <
td
 
width
="55%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>ç‚¹å‡»åç§°é€‰æ‹©æ–‡ä»¶</strong></td>

97 <
td
 
width
="15%" 
®ign
="ûÁ”" 
bgcŞÜ
='#EEF4EA' 
şass
='lš”ow'><
¡rÚg
>æ–‡ä»¶å¤§å°</strong></td>

98 <
td
 
width
="30%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>æœ€åä¿®æ”¹æ—¶é—´</strong></td>

99 </
Œ
>

100 <?
php


101 
$dh
 = 
dœ
(
$š·th
);

102 
	g$ty1
 = 
$ty2
 = '';

103 
	g$fe
 = 
$dh
->
	$»ad
())

106 if(
$fe
 !ğ"." && $f!ğ".." && !
	`is_dœ
("$inpath/$file"))

108 
$fesize
 = 
	`fesize
("$inpath/$file");

109 
$fesize
 = $filesize / 1024;

110 if(
$fesize
 != "")

111 if(
$fesize
 < 0.1){

112 @
	`li¡
(
$ty1
, 
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

113 
$fesize
 = 
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 2);

116 @
	`li¡
(
$ty1
, 
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

117 
$fesize
 = 
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 1);

119 
$f‘ime
 = 
	`femtime
("$inpath/$file");

120 
$f‘ime
 = 
	`MyD©e
("Y-m-d H:i:s", $filetime);

123 if(
$fe
 == ".") ;

124 if(
$fe
 == "..")

126 if(
$aùiv•©h
 == "") ;

127 
$tmp
 = 
	`´eg_»¶aû
("#[\/][^\/]*$#i", "", 
$aùiv•©h
);

128 
$lše
 = "\n<tr height='24'>

129 <
td
 
şass
='lš”ow'> <
a
 
h»f
='£Ëù_soá.php?f=$f&aùiv•©h=".u¾’code($tmp).$add·rm."'><
img
 
¤c
=img/
dœ2
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>ä¸Šçº§ç›®å½•</a></td>

130 <
td
 
cŞ¥ª
='2' 
şass
='lš”ow'> å½“å‰ç›®å½•:
$aùiv•©h
</td>

131 </
Œ
>\
r
\
n
";

132 
echo
 
$lše
;

134 if(
	`is_dœ
("$inpath/$file"))

136 if(
	`´eg_m©ch
("#^_(.*)$#i", 
$fe
)è; #å±è”½
FrÚtPage
æ‰©å±•ç›®å½•å’Œ
lšux
éšè”½ç›®å½•

137 if(
	`´eg_m©ch
("#^\.(.*)$#i", 
$fe
)) ;

138 
$lše
 = "\n<tr height='24'>

139 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='linerow'>

140 <
a
 
h»f
=
£Ëù_soá
.
php
?
f
=
$f
&
aùiv•©h
=".u¾’code("
$aùiv•©h
/
$fe
").$add·rm."><
img
 
¤c
=img/
dœ
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>$file</a>

141 </
td
>

142 <
td
 
şass
='linerow'>-</td>

143 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='linerow'>-</td>

144 </
Œ
>";

145 
echo
 "$line";

147 if(
	`´eg_m©ch
("#\.(z|¿r|tgr.gz)#i", 
$fe
))

149 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

150 
$l¡yË
 = "";

152 
$»u¾
 = "$activeurl/$file";

154 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

155 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

157 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

159 
$»u¾
 = $reurl;

162 
$lše
 = "\n<tr height='24'>

163 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

165 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/zip.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

166 </
td
>

167 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

168 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

169 </
Œ
>";

170 
echo
 "$line";

174 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

175 
$l¡yË
 = '';

177 
$»u¾
 = "$activeurl/$file";

179 
$»u¾
 = 
	`´eg_»¶aû
("#^\.\.#", "", $reurl);

180 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

182 
$»u¾
 = 
$»mÙeupU¾
.$reurl;

184 
$»u¾
 = $reurl;

187 
$lše
 = "\n<tr height='24'>

188 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

189 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/exe.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

190 </
td
>

191 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

192 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

193 </
Œ
>";

194 
echo
 "$line";

196 
	}
}

197 
	g$dh
->
şo£
();

200 </
	gbË
></
	gtd
></
	gŒ
>

201 <
	gŒ
><
td
 
	gcŞ¥ª
='3' 
bgcŞÜ
='#E8F1DE' 
height
='26'>&
nb¥
;è¯·ç‚¹å‡»è¦é€‰æ‹©çš„æ–‡ä»¶ï¼Œçº¢è‰²å­—æ ·çš„ä¸ºåˆšä¸Šä¼ çš„æ–‡ä»¶ã€‚</
	gtd
></tr>

202 </
	gbË
>

203 </
	gbody
>

204 </
	ghtml
>

	@E:\web\weixun\functions\dialog\select_soft_post.php

1 <?
php


7 if(!
	$is£t
(
$cfg_ba£dœ
))

9 
	`šşude_Úû
(
	`dœÇme
(
__FILE__
).'/config.php');

10 
	}
}

11 if(
em±y
(
$u¶ßdfe
)è
	g$u¶ßdfe
 = '';

12 if(
em±y
(
$u¶ßdmbty³
)è
	g$u¶ßdmbty³
 = 'è½¯ä»¶ç±»å‹';

13 if(
em±y
(
$bku¾
)è
	g$bku¾
 = 'select_soft.php';

14 
	g$CKEd™ÜFuncNum
 = (
is£t
(
$CKEd™ÜFuncNum
))? $CKEditorFuncNum : 1;

15 
	g$ÃwÇme
 = ( 
em±y
(
$ÃwÇme
è? '' : 
´eg_»¶aû
("#[\\ \"\*\?\t\r\n<>':\/|]#", "", $newname) );

17 if(!
	$is_u¶ßded_fe
(
$u¶ßdfe
))

19 
	`ShowMsg
("ä½ æ²¡æœ‰é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶æˆ–é€‰æ‹©çš„æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶!", "-1");

20 
	`ex™
();

21 
	}
}

24 
	g$cfg_soáty³
 = 
$cfg_soáty³
;

25 
	g$cfg_soáty³
 = 
¡r_»¶aû
('||', '|', 
$cfg_soáty³
);

26 
	g$u¶ßdfe_Çme
 = 
Œim
(
´eg_»¶aû
("#[ \r\n\t\*\%\\\/\?><\|\":]{1,}#", '', 
$u¶ßdfe_Çme
));

27 if(!
´eg_m©ch
("#\.(".
$cfg_soáty³
.")#i", 
$u¶ßdfe_Çme
))

29 
ShowMsg
("ä½ æ‰€ä¸Šä¼ çš„{$uploadmbtype}ä¸åœ¨è®¸å¯åˆ—è¡¨ï¼Œè¯·æ›´æ”¹ç³»ç»Ÿå¯¹æ‰©å±•åé™å®šçš„é…ç½®ï¼","");

30 
ex™
();

33 
	g$nowtme
 = 
time
();

34 if(
	g$aùiv•©h
==
$cfg_soá_dœ
)

36 
$Ãwdœ
 = 
MyD©e
(
$cfg_addÚ_§v‘y³
, 
$nowtme
);

37 
	g$aùiv•©h
 = 
$aùiv•©h
.'/'.
$Ãwdœ
;

38 if(!
is_dœ
(
$cfg_ba£dœ
.
$aùiv•©h
))

40 
MkdœAÎ
(
$cfg_ba£dœ
.
$aùiv•©h
,
$cfg_dœ_purv›w
);

41 
Clo£F
();

46 if(!
	$em±y
(
$ÃwÇme
))

48 
$f’ame
 = 
$ÃwÇme
;

49 if(!
	`´eg_m©ch
("#\.#", 
$f’ame
)è
$fs
 = 
	`ex¶ode
('.', 
$u¶ßdfe_Çme
);

50 
$fs
 = 
	`ex¶ode
('.', 
$f’ame
);

51 if(
	`´eg_m©ch
("#".
$cfg_nÙ_®low®l
."#", 
$fs
[
	`couÁ
($fs)-1]))

53 
	`ShowMsg
("ä½ æŒ‡å®šçš„æ–‡ä»¶åè¢«ç³»ç»Ÿç¦æ­¢ï¼",'javascript:;');

54 
	`ex™
();

56 if(!
	`´eg_m©ch
("#\.#", 
$f’ame
)è$f’amğ$f’ame.'.'.
$fs
[
	`couÁ
($fs)-1];

57 
	}

	g}–£
{

58 
	g$f’ame
 = 
$cu£rLogš
->
g‘U£rID
().'-'.
dd2ch¬
(
MyD©e
('ymdHis',
$nowtme
));

59 
	g$fs
 = 
ex¶ode
('.', 
$u¶ßdfe_Çme
);

60 if(
´eg_m©ch
("#".
$cfg_nÙ_®low®l
."#", 
$fs
[
couÁ
($fs)-1]))

62 
ShowMsg
("ä½ ä¸Šä¼ äº†æŸäº›å¯èƒ½å­˜åœ¨ä¸å®‰å…¨å› ç´ çš„æ–‡ä»¶ï¼Œç³»ç»Ÿæ‹’ç»æ“ä½œï¼",'javascript:;');

63 
ex™
();

65 
	g$f’ame
 = 
$f’ame
.'.'.
$fs
[
couÁ
($fs)-1];

68 
	g$fuÎf’ame
 = 
$cfg_ba£dœ
.
$aùiv•©h
.'/'.
$f’ame
;

69 
	g$fuÎfeu¾
 = 
$aùiv•©h
.'/'.
$f’ame
;

70 
	$move_u¶ßded_fe
(
$u¶ßdfe
,
$fuÎf’ame
è
Ü
 
	`d›
("ä¸Šä¼ æ–‡ä»¶åˆ° $fullfilename å¤±è´¥ï¼");

71 @
	`uÆšk
(
$u¶ßdfe
);

72 if(
$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

75 
$»mÙefe
 = 
	`¡r_»¶aû
(
XAKROOT
, '', 
$fuÎf’ame
);

76 
$loÿlfe
 = '../..'.
$»mÙefe
;

78 
$»mÙedœ
 = 
	`´eg_»¶aû
('/[^\/]*\.('.
$cfg_soáty³
.')/', '', 
$»mÙefe
);

79 
$áp
->
	`rmkdœ
(
$»mÙedœ
);

80 
$áp
->
	`u¶ßd
(
$loÿlfe
, 
$»mÙefe
);

81 
	}
}

83 if(
	g$u¶ßdfe_ty³
 == 'application/x-shockwave-flash')

85 
$medŸty³
=2;

87 if(
´eg_m©ch
('#image#i', 
$u¶ßdfe_ty³
))

89 
	g$medŸty³
=1;

91 if(
´eg_m©ch
('#audio|medŸ|video#i', 
$u¶ßdfe_ty³
))

93 
	g$medŸty³
=3;

97 
	g$medŸty³
=4;

100 
	g$šqu”y
 = "INSERT INTO `#@__uploads`(arcid,title,url,mediatype,width,height,playtime,filesize,uptime,mid)

101 
VALUES
 ('0','$filename','$fullfileurl','$mediatype','0','0','0','{$uploadfile_size}','{$nowtme}','".$cuserLogin->getUserID()."'); ";

103 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

104 
	g$fid
 = 
$dsql
->
G‘La¡ID
();

105 
AddMyAddÚ
(
$fid
, 
$fuÎfeu¾
);

107 
ShowMsg
("æˆåŠŸä¸Šä¼ æ–‡ä»¶ï¼",
$bku¾
."?comeback=".
u¾’code
(
$f’ame
)."&f=$f&CKEd™ÜFuncNum=$CKEd™ÜFuncNum&aùiv•©h=".u¾’code(
$aùiv•©h
)."&d=".
time
());

108 
ex™
();

	@E:\web\weixun\functions\dialog\select_templets.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
	$em±y
(
$aùiv•©h
))

10 
$aùiv•©h
 = '';

11 
	}
}

12 
	g$cfg_tx‰y³
 = 'htm|html|tpl|txt|dtp';

13 
	g$aùiv•©h
 = 
¡r_»¶aû
('.', '', 
$aùiv•©h
);

14 
	g$aùiv•©h
 = 
´eg_»¶aû
("#\/{1,}#", '/', 
$aùiv•©h
);

15 
	g$‹m¶‘dœ
 = 
$cfg_‹m¶‘s_dœ
;

16 if(
¡¾’
(
$aùiv•©h
è< 
	$¡¾’
(
$‹m¶‘dœ
))

18 
$aùiv•©h
 = 
$‹m¶‘dœ
;

19 
	}
}

20 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

21 
	g$aùiveu¾
 = '..'.
$aùiv•©h
;

22 if(
	$em±y
(
$f
))

24 
$f
='form1.enclosure';

25 
	}
}

26 if(
	$em±y
(
$comeback
))

28 
$comeback
 = '';

29 
	}
}

31 <
	ghtml
>

32 <
	gh—d
>

33 <
m‘a
 
	gh‰p
-
	gequiv
='CÚ‹Á-Ty³' 
cÚ‹Á
='text/html; charset=<?phpƒcho $cfg_soft_lang; ?>'>

34 <
t™Ë
>æ¨¡æ¿ç®¡ç†å™¨</title>

35 <
lšk
 
h»f
='../../moduË/img/ba£.css' 
»l
='¡yËsh“t' 
ty³
='text/css'>

36 <
¡yË
>

37 .
lš”ow
 {
bÜd”
-
bÙtom
: 1
px
 
sŞid
 #CBD8AC;}

38 </
	g¡yË
>

39 </
	gh—d
>

40 <
body
 
	gbackground
='img/®lbg.gif' 
Ëám¬gš
='0' 
tİm¬gš
='0'>

41 <
SCRIPT
 
Ïnguage
='JavaScript'>

42 
funùiÚ
 
	$nuÎLšk
()

45 
	}
}

46 
funùiÚ
 
	$R‘uºV®ue
(
»img
)

48 
wšdow
.
İ’”
.
docum’t
.<?
php
 
echo
 
$f
?>.
v®ue
=
»img
;

49 if(
docum’t
.
®l
è
wšdow
.
İ’”
=
Œue
;

50 
wšdow
.
	`şo£
();

51 
	}
}

52 </
	gSCRIPT
>

53 <
bË
 
	gwidth
='100%' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CBD8AC' 
®ign
="center">

54 <
Œ
 
bgcŞÜ
='#FFFFFF'>

55 <
td
 
cŞ¥ª
='3'>

57 <
bË
 
width
='100%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='2'>

58 <
Œ
 
bgcŞÜ
="#CCCCCC">

59 <
td
 
width
="55%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>ç‚¹å‡»åç§°é€‰æ‹©æ–‡ä»¶</strong></td>

60 <
td
 
width
="15%" 
®ign
="ûÁ”" 
bgcŞÜ
='#EEF4EA' 
şass
='lš”ow'><
¡rÚg
>æ–‡ä»¶å¤§å°</strong></td>

61 <
td
 
width
="30%" 
®ign
="ûÁ”" 
background
="img/wbg.gif" 
şass
='lš”ow'><
¡rÚg
>æœ€åä¿®æ”¹æ—¶é—´</strong></td>

62 </
Œ
>

63 <?
php


64 
$dh
 = 
dœ
(
$š·th
);

65 
	g$ty1
="";

66 
	g$ty2
="";

67 
	g$fe
 = 
$dh
->
	$»ad
()) {

69 if(
$fe
!="." && $fe!=".." && !
	`is_dœ
("$inpath/$file")){

70 
$fesize
 = 
	`fesize
("$inpath/$file");

71 
$fesize
 = $filesize / 1024;

72 if(
$fesize
 != "")

73 if(
$fesize
 < 0.1)

75 @
	`li¡
(
$ty1
,
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

76 
$fesize
=
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 2);

78 @
	`li¡
(
$ty1
,
$ty2
èğ
	`¥l™
("\.", 
$fesize
);

79 
$fesize
=
$ty1
.".".
	`sub¡r
(
$ty2
, 0, 1);

81 
$f‘ime
 = 
	`femtime
("$inpath/$file");

82 
$f‘ime
 = 
	`MyD©e
("Y-m-d H:i:s", $filetime);

86 if(
$fe
 == ".") ;

87 if(
$fe
 == "..")

89 if(
$aùiv•©h
 == "") ;

90 
$tmp
 = 
	`´eg_»¶aû
("#[\/][^\/]*$#", "", 
$aùiv•©h
);

91 
$lše
 = "\n<tr>

92 <
td
 
şass
='lš”ow'> <
a
 
h»f
='£Ëù_‹m¶‘s.php?f=$f&aùiv•©h=".u¾’code($tmp)."'><
img
 
¤c
=img/
dœ2
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>ä¸Šçº§ç›®å½•</a></td>

93 <
td
 
cŞ¥ª
='2' 
şass
='lš”ow'> å½“å‰ç›®å½•:
$aùiv•©h
</td>

94 </
Œ
>\
r
\
n
";

95 
echo
 
$lše
;

97 if(
	`is_dœ
("$inpath/$file"))

99 if(
	`´eg_m©ch
("#^_(.*)$#i", 
$fe
)è; #å±è”½
FrÚtPage
æ‰©å±•ç›®å½•å’Œ
lšux
éšè”½ç›®å½•

100 if(
	`´eg_m©ch
("#^\.(.*)$#i", 
$fe
)) ;

101 
$lše
 = "\n<tr>

102 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='linerow'>

103 <
a
 
h»f
=
£Ëù_‹m¶‘s
.
php
?
f
=
$f
&
aùiv•©h
=".u¾’code("
$aùiv•©h
/
$fe
")."><
img
 
¤c
=img/
dœ
.
gif
 
bÜd”
=0 
width
=16 
height
=16 
®ign
=
absmiddË
>$file</a>

104 </
td
>

105 <
td
 
şass
='linerow'>-</td>

106 <
td
 
bgcŞÜ
='#F9FBF0' 
şass
='linerow'>-</td>

107 </
Œ
>";

108 
echo
 "$line";

109 } if(
	`´eg_m©ch
("#\.(htm|html)#i", 
$fe
))

112 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

113 
$l¡yË
 = "";

115 
$»u¾
 = "$activeurl/$file";

117 
$»u¾
 = 
	`´eg_»¶aû
("#\.\.#", "", $reurl);

118 
$»u¾
 = 
	`´eg_»¶aû
("#".
$‹m¶‘dœ
."\/#", "", $reurl);

120 
$lše
 = "\n<tr>

121 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

122 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/htm.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

123 </
td
>

124 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

125 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

126 </
Œ
>";

127 
echo
 "$line";

128 } if(
	`´eg_m©ch
("#\.(css)#i", 
$fe
))

130 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

131 
$l¡yË
 = "";

133 
$»u¾
 = "$activeurl/$file";

135 
$»u¾
 = 
	`´eg_»¶aû
("#\.\.#", "", $reurl);

136 
$»u¾
 = 
	`´eg_»¶aû
("#".
$‹m¶‘dœ
."/#", "", $reurl);

138 
$lše
 = "\n<tr>

139 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

140 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/css.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

141 </
td
>

142 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

143 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

144 </
Œ
>";

145 
echo
 "$line";

146 } if(
	`´eg_m©ch
("#\.(js)#i", 
$fe
))

148 ifĞ
$fe
 =ğ
$comeback
 ) 
$l¡yË
 = " style='color:red' ";

149 
$l¡yË
 = "";

151 
$»u¾
 = "$activeurl/$file";

153 
$»u¾
 = 
	`´eg_»¶aû
("#\.\.#", "", $reurl);

154 
$»u¾
 = 
	`´eg_»¶aû
("#".
$‹m¶‘dœ
."\/#", "", $reurl);

156 
$lše
 = "\n<tr>

157 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

158 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/js.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

159 </
td
>

160 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

161 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

162 </
Œ
>";

163 
echo
 "$line";

164 } if(
	`´eg_m©ch
("#\.(jpg)#i", 
$fe
))

166 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

167 
$l¡yË
 = "";

169 
$»u¾
 = "$activeurl/$file";

171 
$»u¾
 = 
	`´eg_»¶aû
("#\.\.#", "", $reurl);

172 
$»u¾
 = 
	`´eg_»¶aû
("#".
$‹m¶‘dœ
."\/#", "", $reurl);

174 
$lše
 = "\n<tr>

175 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

176 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/jpg.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

177 </
td
>

178 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

179 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

180 </
Œ
>";

181 
echo
 "$line";

182 } if(
	`´eg_m©ch
("#\.(gif|²g)#i", 
$fe
))

185 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

186 
$l¡yË
 = "";

188 
$»u¾
 = "$activeurl/$file";

190 
$»u¾
 = 
	`´eg_»¶aû
("#\.\.#", "", $reurl);

191 
$»u¾
 = 
	`´eg_»¶aû
("#".
$‹m¶‘dœ
."\/#", "", $reurl);

193 
$lše
 = "\n<tr>

194 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

195 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/gif.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

196 </
td
>

197 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

198 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

199 </
Œ
>";

200 
echo
 "$line";

202 if(
	`´eg_m©ch
("#\.Ñxt)#i", 
$fe
))

205 if(
$fe
==
$comeback
è
$l¡yË
 = " style='color:red' ";

206 
$l¡yË
 = "";

208 
$»u¾
 = "$activeurl/$file";

210 
$»u¾
 = 
	`´eg_»¶aû
("#\.\.#", "", $reurl);

211 
$»u¾
 = 
	`´eg_»¶aû
("#".
$‹m¶‘dœ
."\/#", "", $reurl);

213 
$lše
 = "\n<tr>

214 <
td
 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>

215 <
a
 
h»f
=\"javascript:ReturnValue('$reurl');\" $lstyle><img src=img/txt.gif border=0 width=16 height=16‡lign=absmiddle>$file</a>

216 </
td
>

217 <
td
 
şass
='lš”ow'>
$fesize
 
KB
</td>

218 <
td
 
®ign
='ûÁ”' 
şass
='lš”ow' 
bgcŞÜ
='#F9FBF0'>
$f‘ime
</td>

219 </
Œ
>";

220 
echo
 "$line";

222 
	}
}

223 
	g$dh
->
şo£
();

226 <
	gŒ
>

227 <
td
 
	gcŞ¥ª
='3' 
bgcŞÜ
='#E8F1DE'>

229 <
bË
 
width
='100%'>

230 <
fÜm
 
aùiÚ
='£Ëù_‹m¶‘s_po¡.php' 
m‘hod
='POST' 
’ùy³
="muÉ¬t/fÜm-d©a" 
Çme
='myform'>

231 <
šput
 
ty³
='hidd’' 
Çme
='aùiv•©h' 
v®ue
='<?phpƒcho $activepath?>'>

232 <
šput
 
ty³
='hidd’' 
Çme
='f' 
v®ue
='<?phpƒcho $f?>'>

233 <
šput
 
ty³
='hidd’' 
Çme
='job' 
v®ue
='upload'>

234 <
Œ
>

235 <
td
 
background
="img/tbg.gif" 
bgcŞÜ
="#99CC00">

236 &
nb¥
;ä¸Šã€€ä¼ ï¼š <
šput
 
	gty³
='fe' 
Çme
='u¶ßdfe' 
¡yË
='width:320px'>

237 æ”¹åï¼š<
šput
 
ty³
='‹xt' 
Çme
='f’ame' 
v®ue
='' 
¡yË
='width:100px'>

238 <
šput
 
ty³
='subm™' 
Çme
='sb1' 
v®ue
='ç¡®å®š'>

239 </
td
>

240 </
Œ
>

241 </
fÜm
>

242 </
bË
>

244 </
td
>

245 </
Œ
>

246 </
bË
>

248 </
td
>

249 </
Œ
>

250 </
bË
>

252 </
body
>

253 </
html
>

	@E:\web\weixun\functions\dialog\select_templets_post.php

1 <?
php


8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

9 
	g$cfg_tx‰y³
 = "htm|html|tpl|txt";

10 if(
	$em±y
(
$u¶ßdfe
))

12 
$u¶ßdfe
 = "";

13 
	}
}

14 if(!
	$is_u¶ßded_fe
(
$u¶ßdfe
))

16 
	`ShowMsg
("ä½ æ²¡æœ‰é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶!","-1");

17 
	`ex™
();

18 
	}
}

19 if(!
´eg_m©ch
("#^‹xt#", 
$u¶ßdfe_ty³
))

21 
ShowMsg
("ä½ ä¸Šä¼ çš„ä¸æ˜¯æ–‡æœ¬ç±»å‹é™„ä»¶!","-1");

22 
ex™
();

24 if(!
´eg_m©ch
("#\.(".
$cfg_tx‰y³
.")#i", 
$u¶ßdfe_Çme
))

26 
ShowMsg
("ä½ æ‰€ä¸Šä¼ çš„æ¨¡æ¿æ–‡ä»¶ç±»å‹ä¸èƒ½è¢«è¯†åˆ«ï¼Œåªå…è®¸htmã€htmlã€tplã€txtæ‰©å±•åï¼","-1");

27 
ex™
();

29 if(
	g$f’ame
!='')

31 
$f’ame
 = 
Œim
(
´eg_»¶aû
("#[ \r\n\t\*\%\\\/\?><\|\":]{1,}#", '', $filename));

35 
	g$u¶ßdfe_Çme
 = 
Œim
(
´eg_»¶aû
("#[ \r\n\t\*\%\\\/\?><\|\":]{1,}#", '', 
$u¶ßdfe_Çme
));

36 
	g$f’ame
 = 
$u¶ßdfe_Çme
;

37 if(
	g$f’ame
=='' || !
´eg_m©ch
("#\.(".
$cfg_tx‰y³
.")#i", 
$f’ame
))

39 
ShowMsg
("ä½ æ‰€ä¸Šä¼ çš„æ–‡ä»¶å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦é€‚åˆï¼","-1");

40 
ex™
();

43 
	g$fuÎf’ame
 = 
$cfg_ba£dœ
.
$aùiv•©h
."/".
$f’ame
;

44 
	$move_u¶ßded_fe
(
$u¶ßdfe
,
$fuÎf’ame
è
Ü
 
	`d›
("ä¸Šä¼ æ–‡ä»¶åˆ° $fullfilename å¤±è´¥ï¼");

45 @
	`uÆšk
(
$u¶ßdfe
);

46 
	`ShowMsg
("æˆåŠŸä¸Šä¼ æ–‡ä»¶ï¼","£Ëù_‹m¶‘s.php?comeback=".
	`u¾’code
(
$f’ame
)."&f=$f&aùiv•©h=".u¾’code(
$aùiv•©h
)."&d=".
	`time
());

47 
	`ex™
();

	@E:\web\weixun\functions\diyform.cls.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
 
	gXAKINC
.'/xaktag.class.php';

9 
»quœe_Úû
 
	gXAKINC
.'/customfields.func.php';

16 şas 
	cdiyfÜm


18 
v¬
 
	m$diyid
;

19 
v¬
 
	m$db
;

20 
v¬
 
	m$šfo
;

21 
v¬
 
	m$Çme
;

22 
v¬
 
	m$bË
;

23 
v¬
 
	m$public
;

24 
v¬
 
	m$li¡Tem¶©e
;

25 
v¬
 
	m$v›wTem¶©e
;

26 
v¬
 
	m$po¡Tem¶©e
;

28 
funùiÚ
 
	$diyfÜm
(
$diyid
){

29 
$this
->
	`__cÚ¡ruù
(
$diyid
);

38 
funùiÚ
 
	$__cÚ¡ruù
(
$diyid
){

39 
$this
->
diyid
 = 
$diyid
;

40 
$this
->
db
 = 
$GLOBALS
['dsql'];

41 
$qu”y
 = "SELECT * FROM #@__diyforms WHERE diyid='{$diyid}'";

42 
$diyšfo
 = 
$this
->
db
->
	`G‘OÃ
(
$qu”y
);

43 if(!
	`is_¬¿y
(
$diyšfo
))

45 
	`showMsg
('å‚æ•°ä¸æ­£ç¡®ï¼Œè¯¥è‡ªå®šä¹‰è¡¨å•ä¸å­˜åœ¨','javascript:;');

46 
	`ex™
();

48 
$this
->
šfo
 = 
$diyšfo
['info'];

49 
$this
->
Çme
 = 
$diyšfo
['name'];

50 
$this
->
bË
 = 
$diyšfo
['table'];

51 
$this
->
public
 = 
$diyšfo
['public'];

52 
$this
->
li¡Tem¶©e
 = 
$diyšfo
['li¡‹m¶©e'] !ğ'' && 
	`fe_exi¡s
(
XAKTEMPLATE
.'/module/'.$diyinfo['listtemplate']) ? $diyinfo['listtemplate'] : 'list_diyform.htm';

53 
$this
->
v›wTem¶©e
 = 
$diyšfo
['v›w‹m¶©e'] !ğ'' && 
	`fe_exi¡s
(
XAKTEMPLATE
.'/module/'.$diyinfo['viewtemplate']) ? $diyinfo['viewtemplate'] : 'view_diyform.htm';;

54 
$this
->
po¡Tem¶©e
 = 
$diyšfo
['po¡‹m¶©e'] !ğ'' && 
	`fe_exi¡s
(
XAKTEMPLATE
.'/module/'.$diyinfo['posttemplate']) ? $diyinfo['posttemplate'] : 'post_diyform.htm';;

55 
	}
}

66 
funùiÚ
 
g‘FÜm
(
$ty³
 = 'po¡', 
$v®ue
 = '', 
$admšty³
='diy')

68 
glob®
 
$cfg_cook›_’code
;

69 
	g$d
 = 
Ãw
 
XakTagP¬£
();

70 
	g$d
->
S‘NameS·û
("field","<",">");

71 
	g$d
->
LßdSourû
(
$this
->
šfo
);

72 
	g$fÜm¡ršg
 = '';

73 
	g$fÜmf›lds
 = '';

74 
	g$func
 = 
$ty³
 == 'post' ? 'GetFormItem' : 'GetFormItemValue';

75 if(
is_¬¿y
(
$d
->
CTags
))

77 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$g
)

79 if(
$g
->
G‘A‰
('autofield'))

81 if(
$ty³
 == 'post')

83 
$fÜm¡ršg
 .ğ
$func
(
$g
,
$admšty³
);

87 
	g$fÜm¡ršg
 .ğ
$func
(
$g
,
html¥ecŸlch¬s
(
$v®ue
[$g->
G‘Name
()],
ENT_QUOTES
),
$admšty³
);

89 
	g$fÜmf›lds
 .ğ
$fÜmf›lds
 =ğ'' ? 
$g
->
G‘Name
().','.$g->
G‘A‰
('type') : ';'.$tag->GetName().','.$tag->GetAtt('type');

94 
	g$fÜm¡ršg
 .ğ"<špuˆty³=\"hidd’\"‚ame=\"xak_f›lds\" v®ue=\"".
$fÜmf›lds
."\" />\n";

95 
	g$fÜm¡ršg
 .ğ"<špuˆty³=\"hidd’\"‚ame=\"xak_f›ldshash\" v®ue=\"".
md5
(
$fÜmf›lds
.
$cfg_cook›_’code
)."\" />";

96  
	g$fÜm¡ršg
;

105 
funùiÚ
 
	$g‘F›ldLi¡
()

107 
$d
 = 
Ãw
 
	`XakTagP¬£
();

108 
$d
->
	`S‘NameS·û
("field","<",">");

109 
$d
->
	`LßdSourû
(
$this
->
šfo
);

110 
$f›lds
 = 
	`¬¿y
();

111 if(
	`is_¬¿y
(
$d
->
CTags
))

113 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$g
)

115 
$f›lds
[
$g
->
	`G‘Name
()] = 
	`¬¿y
($g->
	`G‘A‰
('itemname'), $tag->GetAtt('type'));

118  
$f›lds
;

119 
	}
}

	@E:\web\weixun\functions\downmix.inc.php

1 <?
php


9 
h–³r
('downmix');

	@E:\web\weixun\functions\enums.func.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

9 if(!
fe_exi¡s
(
XAKDATA
.'/’ums/sy¡em.php')è
Wr™eEnumsCache
();

18 
funùiÚ
 
Wr™eEnumsCache
(
$egroup
='')

20 
glob®
 
$dsql
;

21 
	g$egroups
 = 
¬¿y
();

22 if(
	g$egroup
=='') {

23 
$dsql
->
S‘Qu”y
("SELECTƒgroup FROM `#@__sys_enum` GROUP BYƒgroup ");

26 
	g$dsql
->
S‘Qu”y
("SELECTƒgroup FROM `#@__sys_enum` WHEREƒgroup='$egroup' GROUP BYƒgroup ");

28 
	g$dsql
->
Execu‹
('enum');

29 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('enum')) {

30 
$egroups
[] = 
$Äow
['egroup'];

32 
fÜ—ch
(
$egroups
 
as
 
$egroup
)

34 
	g$ÿchefe
 = 
XAKDATA
.'/’ums/'.
$egroup
.'.php';

35 
	g$å
 = 
fİ’
(
$ÿchefe
,'w');

36 
fwr™e
(
$å
,'<'."?php\r\nglobal \$em_{$egroup}s;\r\n\$em_{$egroup}s =‡rray();\r\n");

37 
	g$dsql
->
S‘Qu”y
("SELECTƒname,evalue,issign FROM `#@__sys_enum` WHEREƒgroup='$egroup' ORDER BY disorder ASC,ƒvalue ASC ");

38 
	g$dsql
->
Execu‹
('enum');

39 
	g$issign
 = -1;

40 
	g$‹num
 = 
çl£
;

41 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('enum'))

43 
fwr™e
(
$å
,"\$em_{$egroup}s['{$nrow['evalue']}'] = '{$nrow['ename']}';\r\n");

44 if(
	g$issign
==-1è
$issign
 = 
$Äow
['issign'];

45 if(
	g$Äow
['issign']==2è
$‹num
 = 
Œue
;

47 ià(
	g$‹num
è
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__stepselect` SET `issign`=2 WHEREƒgroup='$egroup'; ");

48 
fwr™e
(
$å
,'?'.'>');

49 
fşo£
(
$å
);

50 if(
em±y
(
$issign
)è
Wr™eEnumsJs
(
$egroup
);

62 
funùiÚ
 
	$G‘EnumsTy³s
(
$v
)

64 
$»¬r
['top'] = $rearr['son'] = 0;

65 if(
$v
==0è 
$»¬r
;

66 if(
$v
%500==0) {

67 
$»¬r
['tİ'] = 
$v
;

70 
$»¬r
['sÚ'] = 
$v
;

71 
$»¬r
['tİ'] = 
$v
 - ($v%500);

73  
$»¬r
;

74 
	}
}

86 
funùiÚ
 
G‘EnumsFÜm
(
$egroup
, 
$ev®ue
=0, 
$fÜmid
='', 
$£É™Ë
='')

88 
$ÿchefe
 = 
XAKDATA
.'/’ums/'.
$egroup
.'.php';

89 
šşude
(
$ÿchefe
);

90 if(
	g$fÜmid
=='')

92 
$fÜmid
 = 
$egroup
;

94 
	g$fÜms
 = "<select‚ame='$formid' id='$formid' class='enumselect'>\r\n";

95 
	g$fÜms
 .= "\t<option value='0' selected='selected'>--è¯·é€‰æ‹©--{$seltitle}</option>\r\n";

96 
fÜ—ch
(
$
{'em_'.
$egroup
.'s'} 
as
 
$v
=>
$n
)

98 
$´efix
 = (
$v
 > 500 && $v%500 != 0) ? 'â””â”€ ' : '';

99 ià(
´eg_m©ch
("#\.#", 
$v
)è
	g$´efix
 = ' &nbsp;&nbsp;â””â”€â”€ ';

101 if(
	g$v
==
$ev®ue
)

103 
$fÜms
 .= "\t<option value='$v' selected='selected'>$prefix$n</option>\r\n";

107 
	g$fÜms
 .= "\t<option value='$v'>$prefix$n</option>\r\n";

110 
	g$fÜms
 .= "</select>";

111  
	g$fÜms
;

121 
funùiÚ
 
	$g‘TİD©a
(
$egroup
)

123 
$d©a
 = 
	`¬¿y
();

124 
$ÿchefe
 = 
XAKDATA
.'/’ums/'.
$egroup
.'.php';

125 
	`šşude
(
$ÿchefe
);

126 
	`fÜ—ch
(
$
{'em_'.
$egroup
.'s'} 
as
 
$k
=>
$v
)

128 if(
$k
 >= 500 && $k%500 == 0) {

129 
$d©a
[
$k
] = 
$v
;

132  
$d©a
;

133 
	}
}

143 
funùiÚ
 
	$G‘EnumsJs
(
$egroup
)

145 
glob®
 
$
{'em_'.
$egroup
.'s'};

146 
	`šşude_Úû
(
XAKDATA
.'/’ums/'.
$egroup
.'.php');

147 
$jsCode
 = "<!--\r\n";

148 
$jsCode
 .= "em_{$egroup}s=new Array();\r\n";

149 
	`fÜ—ch
(
$
{'em_'.
$egroup
.'s'} 
as
 
$k
 => 
$v
)

152 ià(
	`´eg_m©ch
("#([0-9]{1,})\.([0-9]{1,})#", 
$k
, 
$m©chs
))

154 
$v®Key
 = 
$m©chs
[1] + $matchs[2] / 1000;

155 
$jsCode
 .= "em_{$egroup}s[{$valKey}]='$v';\r\n";

157 
$jsCode
 .= "em_{$egroup}s[$k]='$v';\r\n";

160 
$jsCode
 .= "-->";

161  
$jsCode
;

162 
	}
}

171 
funùiÚ
 
	$Wr™eEnumsJs
(
$egroup
)

173 
$jsfe
 = 
XAKDATA
.'/’ums/'.
$egroup
.'.js';

174 
$å
 = 
	`fİ’
(
$jsfe
, 'w');

175 
	`fwr™e
(
$å
, 
	`G‘EnumsJs
(
$egroup
));

176 
	`fşo£
(
$å
);

177 
	}
}

188 
funùiÚ
 
	$G‘EnumsV®ue
(
$egroup
, 
$ev®ue
=0)

190 
	`šşude_Úû
(
XAKDATA
.'/’ums/'.
$egroup
.'.php');

191 if(
	`is£t
(
$
{'em_'.
$egroup
.'s'}[
$ev®ue
])) {

192  
$
{'em_'.
$egroup
.'s'}[
$ev®ue
];

197 
	}
}

	@E:\web\weixun\functions\extend.func.php

1 <?
php


2 
funùiÚ
 
	$l™imgu¾s
(
$imgid
=0)

4 
glob®
 
$l™_imgli¡
,
$dsql
;

6 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT c.addtable FROM #@__archives AS‡ LEFT JOIN #@__channeltype AS c

7 
ON
 
a
.
chªÃl
=
c
.
id
 
wh”e
‡.id='$imgid'");

8 
$addbË
 = 
	`Œim
(
$row
['addtable']);

11 
$row
 = 
$dsql
->
	`G‘OÃ
("Select imgurls From `$addtable` where‡id='$imgid'");

14 
$ChªÃlUn™
 = 
Ãw
 
	`ChªÃlUn™
(2,
$imgid
);

17 
$l™_imgli¡
 = 
$ChªÃlUn™
->
	`G‘l™ImgLšks
(
$row
['imgurls']);

20  
$l™_imgli¡
;

21 
	}
}

30 
funùiÚ
 
»¶aû_image
(
$v®ue
,
$width
='600'){

31 if(
em±y
(
$v®ue
))

33 
$v®
 ='';

37 
	g$image
 ='<img oÆßd="auto_imageÑhis,'.
$width
.')"';

38 
	g$v®
=
¡r_»¶aû
('<img', 
$image
, 
$v®ue
);

40  
	g$v®
;

45 
funùiÚ
 
	$pos™iÚ_´eg
(
$pos™iÚ
)

47 
$k
 = 
	`´eg_»¶aû
("/(<¨h»f=.*>ç®€ä½“ä¸­æ–‡<\/a> >)(.*)/i","\\2",
$pos™iÚ
);

48 
$k
 = 
	`´eg_»¶aû
("/(<a href=.*>English<\/a> >)(.*)/i","\\2",$k);

49 
$pos™iÚ
 =
$k
;

50  
$pos™iÚ
;

51 
	}
}

60 
funùiÚ
 
	$G‘TİInfo
(
$id
,
$tİid
=0,
$ty³
=1)

62 
glob®
 
$dsql
;

63 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__arctype where id='$id'");

64 if(
$row
['»id']==
$tİid
 || $row['reid']==0)

66 if(
$ty³
==1)

68 
$code
 = 
$row
['id'];

72 
$code
 = 
$row
['typename'];

77 
$code
 = 
	`G‘TİInfo
(
$row
['»id'],
$tİid
,
$ty³
);

79  
$code
;

80 
	}
}

89 
funùiÚ
 
	$G‘ReidInfo
(
$id
,
$tİid
=0,
$ty³
=1)

91 
glob®
 
$dsql
;

92 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__arctype where id='$id'");

93 if(
$row
['»id']==
$tİid
 || $row['reid']==0)

95 if(
$ty³
==1)

97 
$code
 = 
$row
['id'];

101 
$code
 = 
$row
['typename'];

106 
$»id_row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__¬ùy³ wh”id=".
$row
['reid']);

107 if(
$ty³
==1)

109 
$code
 = 
$»id_row
['id'];

113 
$code
 = 
$»id_row
['typename'];

116  
$code
;

117 
	}
}

126 
funùiÚ
 
IfAdInfo
(
$v®
,
$css
='')

128 
$code
='';

129 if(
	g$v®
!='' && 
$css
!='')

131 
$code
 = 
¡r_»¶aû
('~code~',
$v®
,
$css
);

135 
	g$code
 = 
$v®
;

138  
	g$code
;

143 
funùiÚ
 
	$R•Li¡BªÃr
(
$v®
)

145 
$code
 = '';

146 
$¡r
="/<[img|IMG].*?src=[\'|\"](.*?(?:[\.gif|\.jpg]))[\'|\"].*?[\/]?>/";

147 
	`´eg_m©ch
(
$¡r
,
$v®
,
$img
);

148 if(!
	`em±y
(
$img
[1]))

151 
$code
 .ğ'<div cÏss="li¡_bªÃr" styË="background:u¾('.
$img
[1].')‚o-repeat centerop"></div>';

154  
$code
;

155 
	}
}

166 
funùiÚ
 
IfSeoT™Ë
(
$v®
,
$m¬k
='_',
$pos
='before')

168 
$code
 ='';

169 if(!
em±y
(
$v®
))

171 if(
	g$pos
 == 'before')

173 
$code
 = 
$m¬k
.
$v®
;

177 
	g$code
 = 
$v®
.
$m¬k
;

180  
	g$code
;

189 
funùiÚ
 
R•Wr™”Souû
(
$v®
,
$t™Ë
='')

191 
$code
 ='';

192 if(
	g$v®
 !='' && 
$v®
 != 'admin' && $val !='æœªçŸ¥')

194 
$code
 = 
$t™Ë
.
$v®
."&nbsp;&nbsp;";

196  
	g$code
;

201 
funùiÚ
 
	$IsHaveCÚ‹Á
(
$v®
)

203 if(!
	`em±y
(
$v®
) && $val !='&nbsp;')

206 
$v®
 = '<div cÏss="about_cÚ‹Á">'.
	`»¶aû_image
($val,'610').'</div>';

210 
$v®
 = '';

212  
$v®
;

213 
	}
}

217 
funùiÚ
 
	$R•FoÙ”Key
(
$v®
)

219 
glob®
 
$cfg_ba£ho¡
;

220 
$code
 = '';

221 if(!
	`em±y
(
$v®
))

223 
$v®_¬r
 = 
	`ex¶ode
(',',
$v®
);

224 
	`fÜ—ch
(
$v®_¬r
 
as
 
$v
)

226 if(!
	`em±y
(
$v
))

228 
$code
 .ğ'<¨h»f="'.
$cfg_ba£ho¡
.'"™Ë="'.
$v
.'">'.$v.'</a>'."\r\n";

232  
$code
;

233 
	}
}

237 
funùiÚ
 
	$R•S—rchKey
(
$v®
)

239 
$code
 = '';

240 if(!
	`em±y
(
$v®
))

242 
$v®_¬r
 = 
	`ex¶ode
(',',
$v®
);

243 
	`fÜ—ch
(
$v®_¬r
 
as
 
$v
)

245 if(!
	`em±y
(
$v
))

248 
$code
 .ğ'<¨h»f="/moduË/£¬ch.php?kwty³=0&·gesize=25&£¬chty³ñ™ËkeywÜd&q='.
	`u¾’code
(
$v
).'"itle="'.$v.'">'.$v.'</a>'."\r\n";

253  
$code
;

254 
	}
}

258 
funùiÚ
 
	$G‘Ty³Lšk
(
$id
)

260 
glob®
 
$dsql
;

261 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id,typename,typedir,seotitle,content,typepic,open_new,description,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath FROM `#@__arctype` WHERE id='$id' ");

262  
	`G‘OÃTy³U¾A
(
$row
);

263 
	}
}

271 
funùiÚ
 
	$g‘_image_li¡
(
$aid
=0,
$ty³
=2)

273 
glob®
 
$dsql
;

275 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT c.addtable FROM #@__archives AS‡ LEFT JOIN #@__channeltype AS c

276 
ON
 
a
.
chªÃl
=
c
.
id
 
wh”e
‡.id='$aid'");

277 
$addbË
 = 
	`Œim
(
$row
['addtable']);

280 
$row
 = 
$dsql
->
	`G‘OÃ
("Select imgurls From `$addtable` where‡id='$aid'");

282 
$d
 = 
Ãw
 
	`XakTagP¬£
();

283 
$d
->
	`LßdSourû
(
$row
['imgurls']);

284 
$img_li¡
='';

285 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

287 if(
$ùag
->
	`G‘Name
()=="img")

289 if(
$ty³
=='1')

291 
$img
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

292 
$ddimg
 = 
$ùag
->
	`G‘A‰
('ddimg');

294 if(
	`em±y
(
$img
è&& !em±y(
$ddimg
))

296 
$img
 = 
$ddimg
;

302 
$ddimg
 = 
$ùag
->
	`G‘A‰
('ddimg');

303 
$¤c
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

304 if(
	`em±y
(
$ddimg
))

306 
$ddimg
 =
$¤c
;

309 
$img_li¡
.='<li><¨h»f="javasüt:void(0);"„–="{g®Ëry: \'g®1\', sm®limage: \''.
$¤c
.'\',Ïrgeimage: \''.$¤c.'\'}"><img src="'.
$ddimg
.'" /></a></li>'."\r\n";

313 if(
$ty³
==1)

315 if(
	`em±y
(
$img
))

317 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT†itpic FROM #@__archives where id='$aid'");

318 if(
$row
['litpic']!='')

320 
$img
 =
$row
['litpic'];

324 
$img
='/images/defaultpic.gif';

327  
$img
;

331  
$img_li¡
;

333 
	}
}

343 
funùiÚ
 
	$·¡”Tem¶‘Diy
(
$·th
)

345 
	`»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

346 
glob®
 
$cfg_ba£dœ
,
$cfg_‹m¶‘s_dœ
;

347 
$tmpfe
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/".
$·th
;

348 
$d
 = 
Ãw
 
	`P¬tV›w
();

349 
$d
->
	`S‘Tem¶‘
(
$tmpfe
);

350 
$d
->
	`Di¥Ïy
();

351 
	}
}

	@E:\web\weixun\functions\filter.inc.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

16 
funùiÚ
 
	$_F‹rAÎ
(
$fk
, &
$sv¬
)

18 
glob®
 
$cfg_nÙ®low¡r
,
$cfg_»¶aû¡r
;

19 ifĞ
	`is_¬¿y
(
$sv¬
) )

21 
	`fÜ—ch
(
$sv¬
 
as
 
$_k
 => 
$_v
)

23 
$sv¬
[
$_k
] = 
	`_F‹rAÎ
(
$fk
,
$_v
);

28 if(
$cfg_nÙ®low¡r
!='' && 
	`´eg_m©ch
("#".$cfg_nÙ®low¡r."#i", 
$sv¬
))

30 
	`ShowMsg
(" $fk has‚ot‡llow words!",'-1');

31 
	`ex™
();

33 if(
$cfg_»¶aû¡r
!='')

35 
$sv¬
 = 
	`´eg_»¶aû
('/'.
$cfg_»¶aû¡r
.'/i', "***", $svar);

38  
$sv¬
;

39 
	}
}

42 
fÜ—ch
(
A¼ay
('_GET','_POST','_COOKIE'è
as
 
$_»que¡
)

44 
fÜ—ch
(
$$_»que¡
 
as
 
$_k
 => 
$_v
)

46 
$
{
$_k
} = 
_F‹rAÎ
($_k,
$_v
);

	@E:\web\weixun\functions\ftp.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

14 @
£t_time_lim™
(1000);

15 şas 
	cFTP
 {

16 
v¬
 
	m$ho¡Çme
 = '';

17 
v¬
 
	m$u£ºame
 = '';

18 
v¬
 
	m$·sswÜd
 = '';

19 
v¬
 
	m$pÜt
 = 21;

20 
v¬
 
	m$·ssive
 = 
TRUE
;

21 
v¬
 
	m$debug
 = 
FALSE
;

22 
v¬
 
	m$cÚn_id
 = 
FALSE
;

29 
funùiÚ
 
FTP
(
$cÚfig
 = 
	$¬¿y
())

31 ià(
	`couÁ
(
$cÚfig
) > 0)

33 
$this
->
	`š™Ÿlize
(
$cÚfig
);

44 
funùiÚ
 
	`š™Ÿlize
(
$cÚfig
 = 
	$¬¿y
())

46 
	`fÜ—ch
 (
$cÚfig
 
as
 
$key
 => 
$v®
)

48 ià(
	`is£t
(
$this
->
$key
))

50 
$this
->
$key
 = 
$v®
;

55 
$this
->
ho¡Çme
 = 
	`´eg_»¶aû
('|.+?://|', '', $this->hostname);

56 
	}
}

65 
funùiÚ
 
cÚÃù
(
$cÚfig
 = 
	$¬¿y
())

67 ià(
	`couÁ
(
$cÚfig
) > 0)

69 
$this
->
	`š™Ÿlize
(
$cÚfig
);

72 ià(
FALSE
 ==ğ(
$this
->
cÚn_id
 = @
	`áp_cÚÃù
($this->
ho¡Çme
, $this->
pÜt
)))

74 ià(
$this
->
debug
 =ğ
TRUE
)

76 
$this
->
	`_”rÜ
('æ— æ³•é“¾æ¥');

78  
FALSE
;

81 iàĞ! 
$this
->
	`_logš
())

83 ià(
$this
->
debug
 =ğ
TRUE
)

85 
$this
->
	`_”rÜ
('æ— æ³•ç™»å½•');

87  
FALSE
;

91 ià(
$this
->
·ssive
 =ğ
TRUE
)

93 
	`áp_·sv
(
$this
->
cÚn_id
, 
TRUE
);

96  
TRUE
;

97 
	}
}

105 
funùiÚ
 
	$_logš
()

107  @
	`áp_logš
(
$this
->
cÚn_id
, $this->
u£ºame
, $this->
·sswÜd
);

108 
	}
}

116 
funùiÚ
 
	$_is_cÚn
()

118 iàĞ! 
	`is_»sourû
(
$this
->
cÚn_id
))

120 ià(
$this
->
debug
 =ğ
TRUE
)

122 
$this
->
	`_”rÜ
('æ— æ³•é“¾æ¥');

124  
FALSE
;

126  
TRUE
;

127 
	}
}

141 
funùiÚ
 
chªgedœ
(
$·th
 = '', 
$su´ess_debug
 = 
FALSE
)

143 ià(
$·th
 =ğ'' 
OR
 ! 
$this
->
_is_cÚn
())

145  
FALSE
;

148 
	g$»suÉ
 = @
áp_chdœ
(
$this
->
cÚn_id
, 
$·th
);

150 ià(
	g$»suÉ
 ==ğ
FALSE
)

152 ià(
$this
->
debug
 =ğ
TRUE
 
AND
 
$su´ess_debug
 =ğ
FALSE
)

154 
$this
->
_”rÜ
('æ— æ³•æ›´æ”¹ç›®å½•');

156  
	gFALSE
;

159  
	gTRUE
;

169 
funùiÚ
 
mkdœ
(
$·th
 = '', 
$³rmissiÚs
 = 
NULL
)

171 ià(
$·th
 =ğ'' 
OR
 ! 
$this
->
_is_cÚn
())

173  
FALSE
;

176 
	g$»suÉ
 = @
áp_mkdœ
(
$this
->
cÚn_id
, 
$·th
);

178 ià(
	g$»suÉ
 ==ğ
FALSE
)

180 ià(
$this
->
debug
 =ğ
TRUE
)

182 
$this
->
_”rÜ
('æ— æ³•åˆ›å»ºæ–‡ä»¶å¤¹');

184  
	gFALSE
;

188 iàĞ! 
is_nuÎ
(
$³rmissiÚs
))

190 
	g$this
->
chmod
(
$·th
, ()
$³rmissiÚs
);

193  
	gTRUE
;

203 
funùiÚ
 
rmkdœ
(
$·th
 = '', 
$·thsymbŞ
 = '/')

205 
$·thA¼ay
 = 
ex¶ode
(
$·thsymbŞ
,
$·th
);

206 
	g$·th¡r
 = 
$·thsymbŞ
;

207 
fÜ—ch
(
$·thA¼ay
 
as
 
$v®
)

209 if(!
em±y
(
$v®
))

212 
	g$·th¡r
 = 
$·th¡r
.
$v®
.
$·thsymbŞ
;

213 ià(! 
	g$this
->
_is_cÚn
())

215  
	gFALSE
;

217 
	g$»suÉ
 = @
áp_chdœ
(
$this
->
cÚn_id
, 
$·th¡r
);

218 if(
	g$»suÉ
 ==ğ
FALSE
)

221 if(!
$this
->
mkdœ
(
$·th¡r
))

223  
FALSE
;

228  
	gTRUE
;

240 
funùiÚ
 
u¶ßd
(
$loı©h
, 
$»m·th
, 
$mode
 = 'auto', 
$³rmissiÚs
 = 
NULL
)

242 ià(!
$this
->
_is_cÚn
())

244  
FALSE
;

247 ià(!
fe_exi¡s
(
$loı©h
))

249 
	g$this
->
_”rÜ
('ä¸å­˜åœ¨æºæ–‡ä»¶');

250  
	gFALSE
;

254 ià(
	g$mode
 == 'auto')

257 
$ext
 = 
$this
->
_g‘ext
(
$loı©h
);

258 
	g$mode
 = 
$this
->
_£‰y³
(
$ext
);

261 
	g$mode
 = (
$mode
 =ğ'ascii'è? 
FTP_ASCII
 : 
FTP_BINARY
;

263 
	g$»suÉ
 = @
áp_put
(
$this
->
cÚn_id
, 
$»m·th
, 
$loı©h
, 
$mode
);

265 ià(
	g$»suÉ
 ==ğ
FALSE
)

267 ià(
$this
->
debug
 =ğ
TRUE
)

269 
$this
->
_”rÜ
('æ— æ³•ä¸Šä¼ ');

271  
	gFALSE
;

275 iàĞ! 
is_nuÎ
(
$³rmissiÚs
))

277 
	g$this
->
chmod
(
$»m·th
, ()
$³rmissiÚs
);

280  
	gTRUE
;

292 
funùiÚ
 
	$»Çme
(
$Şd_fe
, 
$Ãw_fe
, 
$move
 = 
FALSE
)

294 iàĞ! 
$this
->
	`_is_cÚn
())

296  
FALSE
;

299 
$»suÉ
 = @
	`áp_»Çme
(
$this
->
cÚn_id
, 
$Şd_fe
, 
$Ãw_fe
);

301 ià(
$»suÉ
 ==ğ
FALSE
)

303 ià(
$this
->
debug
 =ğ
TRUE
)

305 
$msg
 = (
$move
 =ğ
FALSE
) ? 'æ— æ³•é‡å‘½å' : 'æ— æ³•ç§»åŠ¨';

307 
$this
->
	`_”rÜ
(
$msg
);

309  
FALSE
;

312  
TRUE
;

313 
	}
}

323 
funùiÚ
 
	$move
(
$Şd_fe
, 
$Ãw_fe
)

325  
$this
->
	`»Çme
(
$Şd_fe
, 
$Ãw_fe
, 
TRUE
);

326 
	}
}

335 
funùiÚ
 
	$d–‘e_fe
(
$f•©h
)

337 iàĞ! 
$this
->
	`_is_cÚn
())

339  
FALSE
;

342 
$»suÉ
 = @
	`áp_d–‘e
(
$this
->
cÚn_id
, 
$f•©h
);

344 ià(
$»suÉ
 ==ğ
FALSE
)

346 ià(
$this
->
debug
 =ğ
TRUE
)

348 
$this
->
	`_”rÜ
('æ— æ³•åˆ é™¤');

350  
FALSE
;

353  
TRUE
;

354 
	}
}

363 
funùiÚ
 
	$d–‘e_dœ
(
$f•©h
)

365 iàĞ! 
$this
->
	`_is_cÚn
())

367  
FALSE
;

371 
$f•©h
 = 
	`´eg_»¶aû
("/(.+?)\/*$/", "\\1/", $filepath);

373 
$li¡
 = 
$this
->
	`li¡_fes
(
$f•©h
);

375 ià(
$li¡
 !=ğ
FALSE
 
AND
 
	`couÁ
($list) > 0)

377 
	`fÜ—ch
 (
$li¡
 
as
 
$™em
)

381 iàĞ! @
	`áp_d–‘e
(
$this
->
cÚn_id
, 
$™em
))

383 
$this
->
	`d–‘e_dœ
(
$™em
);

388 
$»suÉ
 = @
	`áp_rmdœ
(
$this
->
cÚn_id
, 
$f•©h
);

390 ià(
$»suÉ
 ==ğ
FALSE
)

392 ià(
$this
->
debug
 =ğ
TRUE
)

394 
$this
->
	`_”rÜ
('æ— æ³•åˆ é™¤');

396  
FALSE
;

399  
TRUE
;

400 
	}
}

410 
funùiÚ
 
	$chmod
(
$·th
, 
$³rm
)

412 iàĞ! 
$this
->
	`_is_cÚn
())

414  
FALSE
;

418 iàĞ! 
	`funùiÚ_exi¡s
('ftp_chmod'))

420 ià(
$this
->
debug
 =ğ
TRUE
)

422 
$this
->
	`_”rÜ
('æ— æ³•æ›´æ”¹æƒé™');

424  
FALSE
;

427 
$»suÉ
 = @
	`áp_chmod
(
$this
->
cÚn_id
, 
$³rm
, 
$·th
);

429 ià(
$»suÉ
 ==ğ
FALSE
)

431 ià(
$this
->
debug
 =ğ
TRUE
)

433 
$this
->
	`_”rÜ
('æ— æ³•æ›´æ”¹æƒé™');

435  
FALSE
;

438  
TRUE
;

439 
	}
}

447 
funùiÚ
 
li¡_fes
(
$·th
 = '.')

449 iàĞ! 
$this
->
_is_cÚn
())

451  
FALSE
;

454  
áp_Æi¡
(
$this
->
cÚn_id
, 
$·th
);

463 
funùiÚ
 
li¡_¿wfes
(
$·th
 = '.', 
$ty³
='dir')

465 iàĞ! 
$this
->
_is_cÚn
())

467  
FALSE
;

470 
	g$áp_¿wli¡
 = 
áp_¿wli¡
(
$this
->
cÚn_id
, 
$·th
, 
TRUE
);

471 
fÜ—ch
 (
$áp_¿wli¡
 
as
 
$v
) {

472 
	g$šfo
 = 
¬¿y
();

473 
	g$všfo
 = 
´eg_¥l™
("/[\s]+/", 
$v
, 9);

474 ià(
	g$všfo
[0] !== "total") {

475 
$šfo
['chmod'] = 
$všfo
[0];

476 
	g$šfo
['num'] = 
$všfo
[1];

477 
	g$šfo
['owÃr'] = 
$všfo
[2];

478 
	g$šfo
['group'] = 
$všfo
[3];

479 
	g$šfo
['size'] = 
$všfo
[4];

480 
	g$šfo
['mÚth'] = 
$všfo
[5];

481 
	g$šfo
['day'] = 
$všfo
[6];

482 
	g$šfo
['time'] = 
$všfo
[7];

483 
	g$šfo
['Çme'] = 
$všfo
[8];

484 
	g$¿wli¡
[
$šfo
['name']] = $info;

488 
	g$dœ
 = 
¬¿y
();

489 
	g$fe
 = 
¬¿y
();

490 
fÜ—ch
 (
$¿wli¡
 
as
 
$k
 => 
$v
) {

491 ià(
$v
['chmod']{0} == "d") {

492 
$dœ
[
$k
] = 
$v
;

493 } 
–£if
 (
$v
['chmod']{0} == "-") {

494 
$fe
[
$k
] = 
$v
;

498  (
	g$ty³
 =ğ'dœ')? 
$dœ
 : 
$fe
;

510 
funùiÚ
 
	$mœrÜ
(
$loı©h
, 
$»m·th
)

512 iàĞ! 
$this
->
	`_is_cÚn
())

514  
FALSE
;

518 ià(
$å
 = @
	`İ’dœ
(
$loı©h
))

521 iàĞ! 
$this
->
	`chªgedœ
(
$»m·th
, 
TRUE
))

524 iàĞ! 
$this
->
	`rmkdœ
(
$»m·th
è
OR
 ! $this->
	`chªgedœ
($rempath))

526  
FALSE
;

531 
FALSE
 !=ğ(
$fe
 = 
	`»addœ
(
$å
)))

533 ià(@
	`is_dœ
(
$loı©h
.
$fe
è&& 
	`sub¡r
($file, 0, 1) != '.')

535 
$this
->
	`mœrÜ
(
$loı©h
.
$fe
."/", 
$»m·th
.$file."/");

537 
	`–£if
 (
	`sub¡r
(
$fe
, 0, 1) != ".")

540 
$ext
 = 
$this
->
	`_g‘ext
(
$fe
);

541 
$mode
 = 
$this
->
	`_£‰y³
(
$ext
);

543 
$this
->
	`u¶ßd
(
$loı©h
.
$fe
, 
$»m·th
.$fe, 
$mode
);

546  
TRUE
;

549  
FALSE
;

550 
	}
}

559 
funùiÚ
 
	$_g‘ext
(
$f’ame
)

561 ià(
FALSE
 ==ğ
	`¡½os
(
$f’ame
, '.'))

566 
$x
 = 
	`ex¶ode
('.', 
$f’ame
);

567  
	`’d
(
$x
);

568 
	}
}

577 
funùiÚ
 
	$_£‰y³
(
$ext
)

579 
$‹xt_ty³s
 = 
	`¬¿y
(

596  (
	`š_¬¿y
(
$ext
, 
$‹xt_ty³s
)) ? 'ascii' : 'binary';

597 
	}
}

607 
funùiÚ
 
	$şo£
()

609 iàĞ! 
$this
->
	`_is_cÚn
())

611  
FALSE
;

614 @
	`áp_şo£
(
$this
->
cÚn_id
);

615 
	}
}

624 
funùiÚ
 
	$_”rÜ
(
$msg
)

626 
$”rÜT¿ckFe
 = 
	`dœÇme
(
__FILE__
).'/../config/ftp_error_trace.inc';

627 
$emsg
 = 'Error Warning!';

629 
echo
 
$emsg
;

631 
$§vemsg
 = 'Page: '.
$this
->
	`G‘CurU¾
()."\r\nE¼Ü: ".
$msg
;

633 
$å
 = @
	`fİ’
(
$”rÜT¿ckFe
, 'a');

634 @
	`fwr™e
(
$å
, '<'.'?phpƒxit();'."\r\n/*\r\n{$savemsg}\r\n*/\r\n?".">\r\n");

635 @
	`fşo£
(
$å
);

636 
	}
}

644 
funùiÚ
 
	$G‘CurU¾
()

646 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

648 
$sütName
 = 
$_SERVER
["REQUEST_URI"];

649 
$nowu¾
 = 
$sütName
;

653 
$sütName
 = 
$_SERVER
["PHP_SELF"];

654 if(
	`em±y
(
$_SERVER
["QUERY_STRING"])) {

655 
$nowu¾
 = 
$sütName
;

658 
$nowu¾
 = 
$sütName
."?".
$_SERVER
["QUERY_STRING"];

661  
$nowu¾
;

662 
	}
}

	@E:\web\weixun\functions\helpers\archive.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

15 iàĞ! 
funùiÚ_exi¡s
('GetOneArchive'))

17 
funùiÚ
 
G‘OÃArchive
(
$aid
)

19 
glob®
 
	g$dsql
;

20 
šşude_Úû
(
XAKINC
."/channelunit.func.php");

21 
	g$aid
 = 
Œim
(
´eg_»¶aû
('/[^0-9]/', '', 
$aid
));

22 
	g$»A¼
 = 
¬¿y
();

24 
	g$chRow
 = 
$dsql
->
G‘OÃ
("SELECT‡rc.*,ch.maintable,ch.addtable,ch.issystem FROM `#@__arctiny`‡rc LEFT JOIN `#@__channeltype` ch ON ch.id=arc.channel WHERE‡rc.id='$aid' ");

26 if(!
is_¬¿y
(
$chRow
)) {

27  
	g$»A¼
;

30 if(
em±y
(
$chRow
['mašbË'])è
	g$chRow
['maintable'] = '#@__archives';

33 if(
	g$chRow
['issystem']!=-1)

35 
$nqu”y
 = " SELECT‡rc.*,tp.typedir,tp.topid,tp.namerule,tp.moresite,tp.siteurl,tp.sitepath

36 
FROM
 `{
$chRow
['mašbË']}` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
÷rc.
ty³id


37 
WHERE
 
¬c
.
id
='$aid' ";

41 
	g$nqu”y
 = " SELECT‡rc.*,1 AS ismake,0 AS money,'' AS filename,tp.typedir,tp.topid,tp.namerule,tp.moresite,tp.siteurl,tp.sitepath

42 
FROM
 `{
$chRow
['addbË']}` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
÷rc.
ty³id


43 
WHERE
 
¬c
.
aid
='$aid' ";

46 
	g$¬cRow
 = 
$dsql
->
G‘OÃ
(
$nqu”y
);

48 if(!
is_¬¿y
(
$¬cRow
)) {

49  
	g$»A¼
;

52 if(!
is£t
(
$¬cRow
['description'])) {

53 
	g$¬cRow
['description'] = '';

56 if(
em±y
(
$¬cRow
['desütiÚ']è&& 
is£t
($arcRow['body'])) {

57 
	g$¬cRow
['desütiÚ'] = 
ú_sub¡r
(
html2‹xt
(
$¬cRow
['body']), 250);

60 if(!
is£t
(
$¬cRow
['pubdate'])) {

61 
	g$¬cRow
['pubd©e'] = 
$¬cRow
['senddate'];

64 if(!
is£t
(
$¬cRow
['notpost'])) {

65 
	g$¬cRow
['notpost'] = 0;

68 
	g$»A¼
 = 
$¬cRow
;

69 
	g$»A¼
['aid'] = 
$aid
;

70 
	g$»A¼
['tİid'] = 
$¬cRow
['topid'];

71 
	g$»A¼
['¬ù™Ë'] = 
$¬cRow
['title'];

72 
	g$»A¼
['¬cu¾'] = 
G‘FeU¾
(
$aid
, 
$¬cRow
['ty³id'], $¬cRow['£ndd©e'], 
$»A¼
['title'],

73 
$¬cRow
['ismake'], $arcRow['arcrank'], $arcRow['namerule'], $arcRow['typedir'],

74 
$¬cRow
['money'], $arcRow['filename'], $arcRow['moresite'], $arcRow['siteurl'],

75 
$¬cRow
['sitepath']);

76  
	g$»A¼
;

89 iàĞ! 
funùiÚ_exi¡s
('GetChannelTable'))

91 
funùiÚ
 
G‘ChªÃlTabË
(
$id
,
$fÜmty³
='channel')

93 
glob®
 
$dsql
;

94 if(
	g$fÜmty³
 == 'archive')

96 
$qu”y
 = "SELECT ch.maintable, ch.addtable FROM #@__arctinyin LEFT JOIN #@__channeltype ch ON ch.id=tin.channel WHEREin.id='$id'";

98 if(
	g$fÜmty³
 == 'typeid')

100 
$qu”y
 = "SELECT ch.maintable, ch.addtable FROM #@__arctype‡ct LEFT JOIN #@__channeltype ch ON ch.id=act.channeltype WHERE‡ct.id='$id'";

104 
	g$qu”y
 = "SELECT maintable,‡ddtable FROM #@__channeltype WHERE id='$id'";

106 
	g$row
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

107  
	g$row
;

117 iàĞ! 
funùiÚ_exi¡s
('GetTags'))

119 
funùiÚ
 
G‘Tags
(
$aid
)

121 
glob®
 
	g$dsql
;

122 
	g$gs
 = '';

123 
	g$qu”y
 = "SELECTag FROM `#@__taglist` WHERE‡id='$aid' ";

124 
	g$dsql
->
Execu‹
('g',
$qu”y
);

125 
	g$row
 = 
$dsql
->
G‘A¼ay
('tag'))

127 
$gs
 .ğ($gs=='' ? 
$row
['tag'] : ','.$row['tag']);

129  
	g$gs
;

145 iàĞ! 
funùiÚ_exi¡s
('GetIndexKey'))

147 
funùiÚ
 
G‘IndexKey
(
$¬üªk
, 
$ty³id
, 
$sÜŒªk
=0, 
$chªÃlid
=1, 
$£ndd©e
=0, 
$mid
=1)

149 
glob®
 
$dsql
,
$£ndd©e
,
$ty³id2
;

150 if(
em±y
(
$ty³id2
)è
	g$ty³id2
 = 0;

151 if(
em±y
(
$£ndd©e
)è
	g$£ndd©e
 = 
time
();

152 if(
em±y
(
$sÜŒªk
)è
	g$sÜŒªk
 = 
$£ndd©e
;

153 
	g$iqu”y
 = "

154 
INSERT
 
INTO
 `#@
__¬ùšy
` (`
¬üªk
`,`
	gty³id
`,`
	gty³id2
`,`
	gchªÃl
`,`
	g£ndd©e
`, `
	gsÜŒªk
`, `
	gmid
`)

155 
VALUES
 ('$arcrank','$typeid','$typeid2' , '$channelid','$senddate', '$sortrank', '$mid') ";

156 
	g$dsql
->
Execu‹NÚeQu”y
(
$iqu”y
);

157 
	g$aid
 = 
$dsql
->
G‘La¡ID
();

158  
	g$aid
;

174 iàĞ! 
funùiÚ_exi¡s
('UpIndexKey'))

176 
funùiÚ
 
UpIndexKey
(
$id
, 
$¬üªk
, 
$ty³id
, 
$sÜŒªk
=0, 
$gs
='')

178 
glob®
 
$dsql
,
$ty³id2
;

179 if(
em±y
(
$ty³id2
)è
	g$ty³id2
 = 0;

180 
	g$addtime
 = 
time
();

181 
	g$qu”y
 = " UPDATE `#@__arctiny` SET `arcrank`='$arcrank', `typeid`='$typeid', `typeid2`='$typeid2', `sortrank`='$sortrank' WHERE id = '$id' ";

182 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

187 if(
	g$gs
!='')

189 
$Şdg
 = 
G‘Tags
(
$id
);

190 
	g$Şdgs
 = 
ex¶ode
(',',
$Şdg
);

191 
	g$gss
 = 
ex¶ode
(',',
$gs
);

192 
fÜ—ch
(
$gss
 
as
 
$g
)

194 
	g$g
 = 
Œim
(
$g
);

195 if(
is£t
(
$g
[12]è|| 
	g$g
!=
¡r¦ashes
($tag))

199 if(!
š_¬¿y
(
$g
,
$Şdgs
))

201 
In£¹OÃTag
(
$g
,
$id
);

204 
fÜ—ch
(
$Şdgs
 
as
 
$g
)

206 if(!
š_¬¿y
(
$g
,
$gss
))

208 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__taglist` WHERE‡id='$id' ANDag LIKE '$tag' ");

209 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__tagindex` SETotal=total-1 WHEREag LIKE '$tag' ");

213 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__taglist` SET `arcrank` = '$arcrank', `typeid` = '$typeid' WHEREag LIKE '$tag' ");

229 iàĞ! 
funùiÚ_exi¡s
('InsertTags'))

231 
funùiÚ
 
In£¹Tags
(
$g
, 
$aid
)

233 
	g$gs
 = 
ex¶ode
(',',
$g
);

234 
fÜ—ch
(
$gs
 
as
 
$g
)

236 
	g$g
 = 
Œim
(
$g
);

237 if(
is£t
(
$g
[20]è|| 
	g$g
!=
¡r¦ashes
($tag))

241 
In£¹OÃTag
(
$g
,
$aid
);

255 iàĞ! 
funùiÚ_exi¡s
('InsertOneTag'))

257 
funùiÚ
 
In£¹OÃTag
(
$g
, 
$aid
)

259 
glob®
 
	g$ty³id
,
	g$¬üªk
,
	g$dsql
;

260 
	g$g
 = 
Œim
(
$g
);

261 if(
	g$g
 == '')

265 if(
em±y
(
$ty³id
))

267 
	g$ty³id
 = 0;

269 if(
em±y
(
$¬üªk
))

271 
	g$¬üªk
 = 0;

273 
	g$rs
 = 
çl£
;

274 
	g$addtime
 = 
time
();

275 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__tagindex` WHEREag LIKE '$tag' ");

276 if(!
is_¬¿y
(
$row
))

278 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(" INSERT INTO `#@__tagindex`(`tag`,`typeid`,`count`,`total`,`weekcc`,`monthcc`,`weekup`,`monthup`,`addtime`) VALUES('$tag','$typeid','0','1','0','0','$addtime','$addtime','$addtime'); ");

279 
	g$tid
 = 
$dsql
->
G‘La¡ID
();

283 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(" UPDATE `#@__tagindex` SETotal=total+1,addtime=$addtime WHEREag LIKE '$tag' ");

284 
	g$tid
 = 
$row
['id'];

286 if(
	g$rs
)

288 
	g$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__taglist`(`tid`,`aid`,`arcrank`,`typeid` , `tag`) VALUES('$tid','$aid','$arcrank','$typeid' , '$tag'); ");

	@E:\web\weixun\functions\helpers\cache.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

17 iàĞ! 
funùiÚ_exi¡s
('GetCache'))

19 
funùiÚ
 
G‘Cache
(
$´efix
, 
$key
, 
$is_memÿche
 = 
TRUE
)

21 
glob®
 
$ÿche_h–³r_cÚfig
;

22 
	g$key
 = 
md5
 ( 
$key
 );

24 ià(
	g$is_memÿche
 ==ğ
TRUE
 && ! 
em±y
 ( 
$ÿche_h–³r_cÚfig
['memcache'] ) && $cache_helper_config['memcache'] ['is_mc_enable'] === 'Y')

26 
$mc_·th
 = 
em±y
 ( 
$ÿche_h–³r_cÚfig
['memÿche'] ['mc'] [
sub¡r
 ( 
$key
, 0, 1 )] ) ? 
	g$ÿche_h–³r_cÚfig
['memcache'] ['mc'] ['default'] : $cache_helper_config['memcache'] ['mc'] [substr ( $key, 0, 1 )];

27 
	g$mc_·th
 = 
·r£_u¾
 ( 
$mc_·th
 );

28 
	g$key
 = 
Érim
 ( 
$mc_·th
 ['·th'], '/' ) . '_' . 
	g$´efix
 . '_' . $key;

29 ià(
em±y
 ( 
$GLOBALS
 ['mc_' . 
$mc_·th
 ['host']] ))

31 
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']] = 
Ãw
 
Memÿche
 ( );

32 
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']]->
cÚÃù
 ( $mc_path ['host'], $mc_path ['port'] );

34  
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']]->
g‘
 ( 
$key
 );

36 
	g$key
 = 
sub¡r
 ( 
$key
, 0, 2 ) . '/' . substr ( $key, 2, 2 ) . '/' . substr ( $key, 4, 2 ) . '/' . $key;

37 
	g$»suÉ
 = @
fe_g‘_cÚ‹Ás
 ( 
XAKDATA
 . "/cache/$prefix/$key.php" );

39 ià(
	g$»suÉ
 ==ğ
çl£
)

41  
çl£
;

43 
	g$»suÉ
 = 
¡r_»¶aû
("<?ph°ex™('W¬nšg...');?>\n\r", "", 
$»suÉ
);

44 
	g$»suÉ
 = @
un£rŸlize
 ( 
$»suÉ
 );

45 if(
	g$»suÉ
 ['timeout'] !ğ0 && 
$»suÉ
 ['timeout'] < 
time
 ())

47  
çl£
;

49  
	g$»suÉ
 ['data'];

64 iàĞ! 
funùiÚ_exi¡s
('SetCache'))

66 
funùiÚ
 
S‘Cache
(
$´efix
, 
$key
, 
$v®ue
, 
$timeout
 = 3600, 
$is_memÿche
 = 
TRUE
)

68 
glob®
 
$ÿche_h–³r_cÚfig
;

69 
	g$key
 = 
md5
 ( 
$key
 );

71 ià(! 
em±y
 ( 
$ÿche_h–³r_cÚfig
['memÿche'] ) && 
	g$ÿche_h–³r_cÚfig
['memÿche'] ['is_mc_’abË'] ==ğ'Y' && 
$is_memÿche
 ==ğ
TRUE
)

73 
$mc_·th
 = 
em±y
 ( 
$ÿche_h–³r_cÚfig
['memÿche'] ['mc'] [
sub¡r
 ( 
$key
, 0, 1 )] ) ? 
	g$ÿche_h–³r_cÚfig
['memcache'] ['mc'] ['default'] : $cache_helper_config['memcache'] ['mc'] [substr ( $key, 0, 1 )];

74 
	g$mc_·th
 = 
·r£_u¾
 ( 
$mc_·th
 );

75 
	g$key
 = 
Érim
 ( 
$mc_·th
 ['·th'], '/' ) . '_' . 
	g$´efix
 . '_' . $key;

76 ià(
em±y
 ( 
$GLOBALS
 ['mc_' . 
$mc_·th
 ['host']] ))

78 
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']] = 
Ãw
 
Memÿche
 ( );

79 
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']]->
cÚÃù
 ( $mc_path ['host'], $mc_path ['port'] );

83 
	g$»suÉ
 = 
$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']]->
£t
 ( 
$key
, 
$v®ue
, 
MEMCACHE_COMPRESSED
, 
$timeout
 );

84  
	g$»suÉ
;

86 
	g$key
 = 
sub¡r
 ( 
$key
, 0, 2 ) . '/' . substr ( $key, 2, 2 ) . '/' . substr ( $key, 4, 2 ) . '/' . $key;

87 
	g$tmp
 ['d©a'] = 
$v®ue
;

88 
	g$tmp
 ['timeout'] = 
$timeout
 !ğ0 ? 
time
 () + ( ) $timeout : 0;

89 
	g$ÿche_d©a
 = "<?ph°ex™('W¬nšg...');?>\n\r".@
£rŸlize
 ( 
$tmp
 );

90  @
PutFe
 ( 
XAKDATA
 . "/ÿche/$´efix/$key.php", 
$ÿche_d©a
);

104 iàĞ! 
funùiÚ_exi¡s
('DelCache'))

107 
funùiÚ
 
D–Cache
(
$´efix
, 
$key
, 
$is_memÿche
 = 
TRUE
)

109 
glob®
 
$ÿche_h–³r_cÚfig
;

110 
	g$key
 = 
md5
 ( 
$key
 );

112 ià(! 
em±y
 ( 
$ÿche_h–³r_cÚfig
['memÿche'] ) && 
	g$ÿche_h–³r_cÚfig
['memÿche'] ['is_mc_’abË'] ==ğ
TRUE
 && 
$is_memÿche
 === TRUE)

114 
$mc_·th
 = 
em±y
 ( 
$ÿche_h–³r_cÚfig
['memÿche'] ['mc'] [
sub¡r
 ( 
$key
, 0, 1 )] ) ? 
	g$ÿche_h–³r_cÚfig
['memcache'] ['mc'] ['default'] : $cache_helper_config['memcache'] ['mc'] [substr ( $key, 0, 1 )];

115 
	g$mc_·th
 = 
·r£_u¾
 ( 
$mc_·th
 );

116 
	g$key
 = 
Érim
 ( 
$mc_·th
 ['·th'], '/' ) . '_' . 
	g$´efix
 . '_' . $key;

117 ià(
em±y
 ( 
$GLOBALS
 ['mc_' . 
$mc_·th
 ['host']] ))

119 
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']] = 
Ãw
 
Memÿche
 ( );

120 
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']]->
cÚÃù
 ( $mc_path ['host'], $mc_path ['port'] );

122  
	g$GLOBALS
 ['mc_' . 
$mc_·th
 ['ho¡']]->
d–‘e
 ( 
$key
 );

124 
	g$key
 = 
sub¡r
 ( 
$key
, 0, 2 ) . '/' . substr ( $key, 2, 2 ) . '/' . substr ( $key, 4, 2 ) . '/' . $key;

125  @
uÆšk
 ( 
XAKDATA
 . "/cache/$prefix/$key.php" );

	@E:\web\weixun\functions\helpers\channelunit.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

15 iàĞ! 
funùiÚ_exi¡s
('GetRankStar'))

17 
funùiÚ
 
G‘RªkSr
(
$¿nk
)

19 
	g$n¡¬
 = "";

20 
	g$i
=1;$i<=
$¿nk
;$i++)

22 
	g$n¡¬
 .= "â˜…";

24 
	g$i
;$i<=5;$i++)

26 
	g$n¡¬
 .= "â˜†";

28  
	g$n¡¬
;

53 iàĞ! 
funùiÚ_exi¡s
('GetFileUrl'))

55 
funùiÚ
 
G‘FeU¾
(
$aid
,
$ty³id
,
$tim‘ag
,
$t™Ë
,
$ismake
=0,
$¿nk
=0,
$Çm”uË
='',
$ty³dœ
='',

56 
$mÚey
=0, 
$f’ame
='',
$mÜes™e
=0,
$s™eu¾
='',
$s™•©h
='')

58 
$¬tişeU¾
 = 
G‘FeName
(
$aid
,
$ty³id
,
$tim‘ag
,
$t™Ë
,
$ismake
,
$¿nk
,
$Çm”uË
,
$ty³dœ
,
$mÚey
,
$f’ame
);

59 
	g$s™•©h
 = 
MfTy³dœ
(
$s™•©h
);

62 if(
	g$GLOBALS
['cfg_multi_site']=='Y')

64 if(
$s™eu¾
=='')

66 
$s™eu¾
 = 
$GLOBALS
['cfg_basehost'];

68 if(
	g$mÜes™e
==1)

70 
$¬tişeU¾
 = 
´eg_»¶aû
("#^".
$s™•©h
.'#', '', $articleUrl);

72 if(!
´eg_m©ch
("/h‰p:/", 
$¬tişeU¾
))

74 
	g$¬tişeU¾
 = 
$s™eu¾
.
$¬tişeU¾
;

78  
	g$¬tişeU¾
;

97 iàĞ! 
funùiÚ_exi¡s
('GetFileNewName'))

99 
funùiÚ
 
G‘FeNewName
(
$aid
,
$ty³id
,
$tim‘ag
,
$t™Ë
,
$ismake
=0,
$¿nk
=0,
$Çm”uË
='',
$ty³dœ
='',
$mÚey
=0,
$f’ame
='')

101 
glob®
 
$cfg_¬c_dœÇme
;

102 
	g$¬tiş’ame
 = 
G‘FeName
(
$aid
,
$ty³id
,
$tim‘ag
,
$t™Ë
,
$ismake
,
$¿nk
,
$Çm”uË
,
$ty³dœ
,
$mÚey
,
$f’ame
);

104 if(
´eg_m©ch
("/\?/", 
$¬tiş’ame
))

106  
	g$¬tiş’ame
;

109 if(
	g$cfg_¬c_dœÇme
=='Y' && 
´eg_m©ch
("/\/$/", 
$¬tiş’ame
))

111 
	g$¬tiş’ame
 = 
$¬tiş’ame
."index.html";

114 
	g$¦’
 = 
¡¾’
(
$¬tiş’ame
)-1;

115 
	g$i
=
$¦’
;$i>=0;$i--)

117 if(
	g$¬tiş’ame
[
$i
]=='/')

119 
$subpos
 = 
$i
;

123 
	g$okdœ
 = 
sub¡r
(
$¬tiş’ame
,0,
$subpos
);

124 
C»©eDœ
(
$okdœ
);

125  
	g$¬tiş’ame
;

146 iàĞ! 
funùiÚ_exi¡s
('GetFileName'))

148 
funùiÚ
 
G‘FeName
(
$aid
,
$ty³id
,
$tim‘ag
,
$t™Ë
,
$ismake
=0,
$¿nk
=0,
$Çm”uË
='',
$ty³dœ
='',
$mÚey
=0,
$f’ame
='')

150 
glob®
 
$cfg_»wr™e
, 
$cfg_cm¥©h
, 
$cfg_¬cdœ
, 
$cfg_¥ecŸl
, 
$cfg_¬c_dœÇme
;

152 if(
em±y
(
$Çm”uË
)) {

153 
	g$Çm”uË
 = 
$cfg_¥ecŸl
.'/arc-{aid}.html';

154 
	g$ty³id
 = -1;

156 if(
	g$¿nk
!=0 || 
$ismake
==-1 || 
$ty³id
==0 || 
$mÚey
>0)

159 if(
$cfg_»wr™e
 == 'Y')

161  
$GLOBALS
["cfg_¶us_dœ"]."/v›w-".
$aid
.'-1.html';

165  
	g$GLOBALS
['cfg_phpurl']."/view.php?aid=$aid";

170 
	g$¬tişeDœ
 = 
MfTy³dœ
(
$ty³dœ
);

171 
	g$¬tişeRuË
 = 
¡¹Şow”
(
$Çm”uË
);

172 if(
	g$¬tişeRuË
=='')

174 
$¬tişeRuË
 = 
¡¹Şow”
(
$GLOBALS
['cfg_df_namerule']);

176 if(
	g$ty³dœ
=='')

178 
$¬tişeDœ
 = 
$GLOBALS
['cfg_cmspath'].$GLOBALS['cfg_arcdir'];

180 
	g$dtime
 = 
G‘D©eMk
(
$tim‘ag
);

181 
li¡
(
$y
, 
$m
, 
$d
èğ
ex¶ode
('-', 
$dtime
);

182 
	g$¬r_½sourû
 = 
¬¿y
('{typedir}','{y}','{m}','{d}','{timestamp}','{aid}','{cc}');

183 
	g$¬r_½v®ues
 = 
¬¿y
(
$¬tişeDœ
,
$y
, 
$m
, 
$d
, 
$tim‘ag
, 
$aid
, 
dd2ch¬
($m.$d.$aid.$y));

184 if(
	g$f’ame
 != '')

186 
$¬tişeRuË
 = 
dœÇme
($¬tişeRuË).'/'.
$f’ame
.
$GLOBALS
['cfg_df_ext'];

188 
	g$¬tişeRuË
 = 
¡r_»¶aû
(
$¬r_½sourû
,
$¬r_½v®ues
,
$¬tişeRuË
);

189 if(
´eg_m©ch
("/\{p/", 
$¬tişeRuË
))

191 
	g$¬tişeRuË
 = 
¡r_»¶aû
('{pšyš}',
G‘Pšyš
(
$t™Ë
).'_'.
$aid
,
$¬tişeRuË
);

192 
	g$¬tişeRuË
 = 
¡r_»¶aû
('{py}',
G‘Pšyš
(
$t™Ë
,1).'_'.
$aid
,
$¬tişeRuË
);

194 
	g$¬tişeU¾
 = '/'.
´eg_»¶aû
("/^\//", '', 
$¬tişeRuË
);

195 if(
´eg_m©ch
("/šdex\.html/", 
$¬tişeU¾
è&& 
	g$cfg_¬c_dœÇme
=='Y')

197 
$¬tişeU¾
 = 
¡r_»¶aû
('index.html', '', $articleUrl);

199  
	g$¬tişeU¾
;

220 iàĞ! 
funùiÚ_exi¡s
('GetTypeUrl'))

222 
funùiÚ
 
G‘Ty³U¾
(
$ty³id
,
$ty³dœ
,
$isdeçuÉ
,
$deçuÉÇme
,
$i¥¬t
,
$Çm”uË2
,
$mÜes™e
=0,
$s™eu¾
='',
$s™•©h
='')

224 
glob®
 
$cfg_ty³dœ_df
;

225 
	g$ty³dœ
 = 
MfTy³dœ
(
$ty³dœ
);

226 
	g$s™•©h
 = 
MfTy³dœ
(
$s™•©h
);

229 if(
	g$isdeçuÉ
==2)

231 
glob®
 
$dsql
;

232 
	g$my_rows
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__arctype where„eid='$typeid' AND ishidden ='0' ORDER BY sortrank ASC");

235 if(
	g$isdeçuÉ
==-1)

238 
$»u¾
 = 
$GLOBALS
['cfg_phpu¾']."/li¡.php?tid=".
$ty³id
;

241 if(
	g$isdeçuÉ
==2 && 
is_¬¿y
(
$my_rows
))

243 
$»u¾
 = 
G‘OÃTy³U¾A
(
$my_rows
);

245 if(
	g$i¥¬t
==2)

248 
$»u¾
 = 
$ty³dœ
;

249  
	g$»u¾
;

253 if(
	g$isdeçuÉ
==0 && 
$i¥¬t
==0)

255 
$»u¾
 = 
¡r_»¶aû
("{·ge}","1",
$Çm”uË2
);

256 
	g$»u¾
 = 
¡r_»¶aû
("{tid}",
$ty³id
,
$»u¾
);

257 
	g$»u¾
 = 
¡r_»¶aû
("{ty³dœ}",
$ty³dœ
,
$»u¾
);

261 if(
	g$cfg_ty³dœ_df
=='N' || 
$isdeçuÉ
==0è
$»u¾
 = 
$ty³dœ
.'/'.
$deçuÉÇme
;

262 
	g$»u¾
 = 
$ty³dœ
.'/';

266 ifĞ!
´eg_m©ch
("/^h‰p:\/\//",
$»u¾
) ) {

267 
	g$»u¾
 = 
´eg_»¶aû
("/\/{1,}/i", '/', 
$»u¾
);

270 if(
	g$GLOBALS
['cfg_multi_site']=='Y')

272 if(
$s™eu¾
=='') {

273 
$s™eu¾
 = 
$GLOBALS
['cfg_basehost'];

275 if(
	g$mÜes™e
==1 ) {

276 
$»u¾
 = 
´eg_»¶aû
("#^".
$s™•©h
."#", '', $reurl);

278 ifĞ!
´eg_m©ch
("/^h‰p:\/\//", 
$»u¾
) ) {

279 
	g$»u¾
 = 
$s™eu¾
.
$»u¾
;

282  
	g$»u¾
;

293 iàĞ! 
funùiÚ_exi¡s
('MagicVar'))

295 
funùiÚ
 
MagicV¬
(
$v1
,
$v2
)

297  
	g$GLOBALS
['autošdex']%2==0 ? 
$v1
 : 
$v2
;

307 iàĞ! 
funùiÚ_exi¡s
('GetTopids'))

309 
funùiÚ
 
G‘Tİids
(
$tid
)

311 if(
is£t
(
$GLOBALS
['pTypeArrays']))

313 
un£t
(
$GLOBALS
['pTypeArrays']);

315 
	g$¬r
 = 
G‘P¬’tIds
(
$tid
);

316  
još
(',',
$¬r
);

329 iàĞ! 
funùiÚ_exi¡s
('GetParentIds'))

331 
funùiÚ
 
G‘P¬’tIds
(
$tid
)

333 
glob®
 
	g$cfg_Cs
;

334 
	g$GLOBALS
['pTy³A¼ays'][] = 
$tid
;

335 if(!
is_¬¿y
(
$cfg_Cs
))

337 
»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

339 if(!
is£t
(
$cfg_Cs
[
$tid
]è|| 
	g$cfg_Cs
[$tid][0]==0)

341  
$GLOBALS
['pTypeArrays'];

345  
G‘P¬’tIds
(
$cfg_Cs
[
$tid
][0]);

359 iàĞ! 
funùiÚ_exi¡s
('IsParent'))

361 
funùiÚ
 
IsP¬’t
(
$sid
, 
$pid
)

363 
	g$pTy³A¼ays
 = 
G‘P¬’tIds
(
$sid
);

364  
š_¬¿y
(
$pid
, 
$pTy³A¼ays
);

375 iàĞ! 
funùiÚ_exi¡s
('GetTopid'))

377 
funùiÚ
 
G‘Tİid
(
$tid
)

379 
glob®
 
	g$cfg_Cs
;

380 if(!
is_¬¿y
(
$cfg_Cs
))

382 
»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

384 if(!
is£t
(
$cfg_Cs
[
$tid
][0]è|| 
	g$cfg_Cs
[$tid][0]==0)

386  
$tid
;

390  
G‘Tİid
(
$cfg_Cs
[
$tid
][0]);

404 
funùiÚ
 
	$G‘SÚIds
(
$id
,
$chªÃl
=0,
$addthis
=
Œue
)

406 
glob®
 
$cfg_Cs
;

407 
$GLOBALS
['idA¼ay'] = 
	`¬¿y
();

408 ifĞ!
	`is_¬¿y
(
$cfg_Cs
) )

410 
	`»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

412 
	`G‘SÚIdsLogic
(
$id
,
$cfg_Cs
,
$chªÃl
,
$addthis
);

413 
$rqu”y
 = 
	`još
(',',
$GLOBALS
['idArray']);

414 
$rqu”y
 = 
	`´eg_»¶aû
("/,$/", '', $rquery);

415  
$rqu”y
;

416 
	}
}

419 
funùiÚ
 
	$G‘SÚIdsLogic
(
$id
,
$sA¼
,
$chªÃl
=0,
$addthis
=
çl£
)

421 if(
$id
!=0 && 
$addthis
)

423 
$GLOBALS
['idA¼ay'][
$id
] = $id;

425 if(
	`is_¬¿y
(
$sA¼
))

427 
	`fÜ—ch
(
$sA¼
 
as
 
$k
=>
$v
)

429 ifĞ
$v
[0]==
$id
 && (
$chªÃl
==0 || $v[1]==$channel ))

431 
	`G‘SÚIdsLogic
(
$k
,
$sA¼
,
$chªÃl
,
Œue
);

435 
	}
}

443 
funùiÚ
 
	$MfTy³dœ
(
$ty³dœ
)

445 if(
	`´eg_m©ch
("/^h‰p:|^áp:/i", 
$ty³dœ
))  $typedir;

446 
$ty³dœ
 = 
	`¡r_»¶aû
("{cm¥©h}",
$GLOBALS
['cfg_cmspath'],$typedir);

447 
$ty³dœ
 = 
	`´eg_»¶aû
("/\/{1,}/", "/", $typedir);

448  
$ty³dœ
;

449 
	}
}

457 
funùiÚ
 
	$MfTem¶‘
(
$tmpdœ
)

459 
$tmpdœ
 = 
	`¡r_»¶aû
("{¡yË}", 
$GLOBALS
['cfg_df_style'], $tmpdir);

460 
$tmpdœ
 = 
	`´eg_»¶aû
("/\/{1,}/", "/", $tmpdir);

461  
$tmpdœ
;

462 
	}
}

470 
funùiÚ
 
	$FÜm©Süt
(
$©me
)

472  
$©me
=='&nbsp;' ? '' : $atme;

473 
	}
}

482 
funùiÚ
 
	$FlA‰sDeçuÉ
(&
$©ts
, 
$©i¡
)

484 
$©i¡s
 = 
	`ex¶ode
(',', 
$©i¡
);

485 
$i
=0; 
	`is£t
(
$©i¡s
[$i]); $i++)

487 
	`li¡
(
$k
, 
$v
èğ
	`ex¶ode
('|', 
$©i¡s
[
$i
]);

488 if(!
	`is£t
(
$©ts
[
$k
]))

490 
$©ts
[
$k
] = 
$v
;

493 
	}
}

503 
funùiÚ
 
MakeOÃTag
(&
$d
, &
$»fObj
, 
$·rf›ld
='Y')

505 
glob®
 
$cfg_di§bË_gs
;

506 
	g$cfg_di§bË_gs
 = 
is£t
(
$cfg_di§bË_gs
)? $cfg_disable_tags : 'php';

507 
	g$di§bË_gs
 = 
ex¶ode
(',', 
$cfg_di§bË_gs
);

508 
	g$®Éags
 = 
¬¿y
();

509 
	g$d
->
£tRefObj
(
$»fObj
);

511 
	g$dh
 = 
dœ
(
XAKINC
.'/taglib');

512 
	g$f’ame
 = 
$dh
->
»ad
())

514 if(
´eg_m©ch
("/\.lib\./", 
$f’ame
))

516 
$®Éags
[] = 
¡r_»¶aû
('.lib.php','',
$f’ame
);

519 
	g$dh
->
Clo£
();

522 if(!
is_¬¿y
(
$d
->
CTags
))

526 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

528 
$gÇme
 = 
$ùag
->
G‘Name
();

529 if(
	g$gÇme
=='f›ld' && 
$·rf›ld
=='Y')

531 
$vÇme
 = 
$ùag
->
G‘A‰
('name');

532 ifĞ
	g$vÇme
=='¬¿y' && 
is£t
(
$»fObj
->
F›lds
) )

534 
$d
->
Assign
(
$gid
,
$»fObj
->
F›lds
);

536 if(
is£t
(
$»fObj
->
F›lds
[
$vÇme
]))

538 
	g$d
->
Assign
(
$gid
,
$»fObj
->
F›lds
[
$vÇme
]);

540 if(
	g$ùag
->
G‘A‰
('noteid') != '')

542 ifĞ
is£t
(
$»fObj
->
F›lds
[
$vÇme
.'_'.
$ùag
->
G‘A‰
('noteid')]) )

544 
$d
->
Assign
(
$gid
, 
$»fObj
->
F›lds
[
$vÇme
.'_'.
$ùag
->
G‘A‰
('noteid')]);

551 if(
´eg_m©ch
("/^×¹li¡|lik—¹|hÙ¬t|imgli¡|imgšfŞi¡|coŞ¬t|¥eÿ¹|autŞi¡)$/", 
$gÇme
))

553 
	g$gÇme
='arclist';

555 if(
	g$gÇme
=='friendlink')

557 
$gÇme
='flink';

559 if(
š_¬¿y
(
$gÇme
,
$®Éags
))

561 if(
š_¬¿y
(
$gÇme
, 
$di§bË_gs
))

563 
	gecho
 'E¼Ü:Tag di§bËd:"'.
	g$gÇme
;

564  
	gFALSE
;

566 ià(
	gDEBUG_LEVEL
==
TRUE
) {

567 
$‰t1
 = 
ExecTime
();

569 
	g$f’ame
 = 
XAKINC
.'/glib/'.
$gÇme
.'.lib.php';

570 
šşude_Úû
(
$f’ame
);

571 
	g$funúame
 = 'lib_'.
$gÇme
;

572 
	g$d
->
Assign
(
$gid
,
$funúame
(
$ùag
,
$»fObj
));

573 ià(
	gDEBUG_LEVEL
==
TRUE
) {

574 
$qu”yTime
 = 
ExecTime
(è- 
$‰t1
;

575 
	gecho
 'æ ‡ç­¾ï¼š'.
	g$gÇme
.'è½½å…¥èŠ±è´¹æ—¶é—´ï¼š'.
	g$qu”yTime
."<br />\r\n";

587 
funùiÚ
 
	$G‘OÃTy³U¾A
(
$ty³šfos
)

589  
	`G‘Ty³U¾
(
$ty³šfos
['id'],
	`MfTy³dœ
($typeinfos['typedir']),$typeinfos['isdefault'],$typeinfos['defaultname'],

590 
$ty³šfos
['ispart'],$typeinfos['namerule2'],$typeinfos['moresite'],$typeinfos['siteurl'],$typeinfos['sitepath']);

591 
	}
}

603 
funùiÚ
 
S‘SysEnv
(
$ty³id
=0,
$ty³Çme
='',
$aid
=0,
$t™Ë
='',
$curfe
='')

605 
glob®
 
$_sys_glob®s
;

606 if(
em±y
(
$_sys_glob®s
['curfile']))

608 
	g$_sys_glob®s
['curfe'] = 
$curfe
;

610 if(
em±y
(
$_sys_glob®s
['typeid']))

612 
	g$_sys_glob®s
['ty³id'] = 
$ty³id
;

614 if(
em±y
(
$_sys_glob®s
['typename']))

616 
	g$_sys_glob®s
['ty³Çme'] = 
$ty³Çme
;

618 if(
em±y
(
$_sys_glob®s
['aid']))

620 
	g$_sys_glob®s
['aid'] = 
$aid
;

632 
funùiÚ
 
	$G‘BookU¾
(
$bid
,
$t™Ë
,
$gdœ
=0)

634 
glob®
 
$cfg_cm¥©h
;

635 
$booku¾
 = 
$gdœ
==1 ?

636 "{$cfg_cm¥©h}/book/".
	`XakID2Dœ
(
$bid
è: "{$cfg_cm¥©h}/book/".XakID2Dœ($bid).'/'.
	`G‘Pšyš
(
$t™Ë
).'-'.$bid.'.html';

637  
$booku¾
;

638 
	}
}

646 
funùiÚ
 
	$XakID2Dœ
(
$aid
)

648 
$n
 = 
	`û
(
$aid
 / 1000);

649  
$n
;

650 
	}
}

662 
funùiÚ
 
	$G‘F»eLi¡U¾
(
$lid
,
$Çm”uË
,
$li¡dœ
,
$deçuÉ·ge
,
$nodeçuÉ
){

663 
$li¡dœ
 = 
	`¡r_»¶aû
('{cm¥©h}',
$GLOBALS
['cfg_cmspath'],$listdir);

664 if(
$nodeçuÉ
==1)

666 
$okfe
 = 
	`¡r_»¶aû
('{·ge}','1',
$Çm”uË
);

667 
$okfe
 = 
	`¡r_»¶aû
('{li¡id}',
$lid
,$okfile);

668 
$okfe
 = 
	`¡r_»¶aû
('{li¡dœ}',
$li¡dœ
,$okfile);

672 
$okfe
 = 
$GLOBALS
['cfg_phpurl']."/freelist.php?lid=$lid";

673  
$okfe
;

675 
$okfe
 = 
	`¡r_»¶aû
("\\","/",$okfile);

676 
$okfe
 = 
	`¡r_»¶aû
("//","/",$okfile);

677 
$ŒueFe
 = 
$GLOBALS
['cfg_ba£dœ'].
$okfe
;

678 if(!@
	`fe_exi¡s
(
$ŒueFe
))

680 
$okfe
 = 
$GLOBALS
['cfg_phpurl']."/freelist.php?lid=$lid";

682  
$okfe
;

683 
	}
}

695 
funùiÚ
 
G‘HÙKeywÜds
(&
$dsql
,
$num
=8,
$nday
=365,
$kËn
=16,
$Üd”by
='count')

697 
glob®
 
$cfg_phpu¾
,
$cfg_cm¥©h
;

698 
	g$nowtime
 = 
time
();

699 
	g$num
 = @
štv®
(
$num
);

700 
	g$nday
 = @
štv®
(
$nday
);

701 
	g$kËn
 = @
štv®
(
$kËn
);

702 if(
em±y
(
$nday
))

704 
	g$nday
 = 365;

706 if(
em±y
(
$num
))

708 
	g$num
 = 6;

710 if(
em±y
(
$kËn
))

712 
	g$kËn
 = 16;

714 
	g$kËn
 = 
$kËn
+1;

715 
	g$mštime
 = 
$nowtime
 - (
$nday
 * 24 * 3600);

716 if(
em±y
(
$Üd”by
))

718 
	g$Üd”by
 = 'count';

720 
	g$dsql
->
S‘Qu”y
("SELECT keyword FROM #@__search_keywords WHERE†asttime>$mintime AND†ength(keyword)<$klen ORDER BY $orderby DESC LIMIT 0,$num");

721 
	g$dsql
->
Execu‹
('hw');

722 
	g$hÙwÜd
 = "";

723 
	g$row
=
$dsql
->
G‘A¼ay
('hw'))

725 
$hÙwÜd
 .ğ"ã€€<¨h»f='".
$cfg_phpu¾
."/£¬ch.php?keywÜd=".
u¾’code
(
$row
['keyword'])."&searchtype=titlekeyword'>".$row['keyword']."</a> ";

727  
	g$hÙwÜd
;

736 
funùiÚ
 
	$Gm­u¾
(
$gu¾
)

738  
	`´eg_»¶aû
("/h‰p:\/\//i", 
$gu¾
è? $gu¾ : 
$GLOBALS
['cfg_basehost'].$gurl;

739 
	}
}

747 
funùiÚ
 
	$QuÙe_»¶aû
(
$quÙe
)

749 
$quÙe
 = 
	`¡r_»¶aû
('{quote}','<div class="decmt-box">',$quote);

750 
$quÙe
 = 
	`¡r_»¶aû
('{title}','<div class="decmt-title"><span class="username">',$quote);

751 
$quÙe
 = 
	`¡r_»¶aû
('{/title}','</span></div>',$quote);

752 
$quÙe
 = 
	`¡r_»¶aû
('&lt;br/&gt;','<br>',$quote);

753 
$quÙe
 = 
	`¡r_»¶aû
('&lt;', '<', $quote);

754 
$quÙe
 = 
	`¡r_»¶aû
('&gt;', '>', $quote);

755 
$quÙe
 = 
	`¡r_»¶aû
('{content}','<div class="decmt-content">',$quote);

756 
$quÙe
 = 
	`¡r_»¶aû
('{/content}','</div>',$quote);

757 
$quÙe
 = 
	`¡r_»¶aû
('{/quote}','</div>',$quote);

758  
$quÙe
;

759 
	}
}

767 
funùiÚ
 
	$G‘CacheBlock
(
$ÿcheid
)

769 
glob®
 
$cfg_pucÿche_time
;

770 
$ÿchefe
 = 
XAKDATA
.'/ÿche/'.
$ÿcheid
.'.inc';

771 if(!
	`fe_exi¡s
(
$ÿchefe
è|| 
	`fesize
($cachefile)==0 ||

772 
$cfg_pucÿche_time
==0 || 
	`time
(è- 
	`femtime
(
$ÿchefe
) > $cfg_puccache_time)

776 
$å
 = 
	`fİ’
(
$ÿchefe
, 'r');

777 
$¡r
 = @
	`ä—d
(
$å
, 
	`fesize
(
$ÿchefe
));

778 
	`fşo£
(
$å
);

779  
$¡r
;

780 
	}
}

789 
funùiÚ
 
	$Wr™eCacheBlock
(
$ÿcheid
, 
$¡r
)

791 
$ÿchefe
 = 
XAKDATA
.'/ÿche/'.
$ÿcheid
.'.inc';

792 
$å
 = 
	`fİ’
(
$ÿchefe
, 'w');

793 
$¡r
 = 
	`fwr™e
(
$å
, $str);

794 
	`fşo£
(
$å
);

795 
	}
}

	@E:\web\weixun\functions\helpers\charset.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 
	g$UC2GBTABLE
 = 
$CODETABLE
 = 
$BIG5_DATA
 = 
$GB_DATA
 = '';

11 
	g$GbkUniDic
 = 
nuÎ
;

20 iàĞ! 
funùiÚ_exi¡s
('utf82gb'))

22 
funùiÚ
 
utf82gb
(
$utf¡r
)

24 if(
funùiÚ_exi¡s
('iconv'))

26  
icÚv
('utf-8','gbk//ignÜe',
$utf¡r
);

28 
glob®
 
	g$UC2GBTABLE
;

29 
	g$ok¡r
 = "";

30 if(
Œim
(
$utf¡r
)=="")

32  
$utf¡r
;

34 if(
em±y
(
$UC2GBTABLE
))

36 
	g$f’ame
 = 
XAKINC
."/data/gb2312-utf8.dat";

37 
	g$å
 = 
fİ’
(
$f’ame
,"r");

38 
	g$l
 = 
fg‘s
(
$å
,15))

40 
	g$UC2GBTABLE
[
hexdec
(
sub¡r
(
$l
, 7, 6))] = hexdec(substr($l, 0, 6));

42 
fşo£
(
$å
);

44 
	g$ok¡r
 = "";

45 
	g$uËn
 = 
¡¾’
(
$utf¡r
);

46 
	g$i
=0;$i<
	g$uËn
;$i++)

48 
	g$c
 = 
$utf¡r
[
$i
];

49 
	g$cb
 = 
decbš
(
Üd
(
$utf¡r
[
$i
]));

50 if(
¡¾’
(
$cb
)==8)

52 
$csize
 = 
¡½os
(
decbš
(
Üd
(
$cb
)),"0");

53 
	g$j
=0;$j < 
	g$csize
;$j++)

55 
	g$i
++; 
	g$c
 .ğ
$utf¡r
[
$i
];

57 
	g$c
 = 
utf82u
(
$c
);

58 if(
is£t
(
$UC2GBTABLE
[
$c
]))

60 
	g$c
 = 
dechex
(
$UC2GBTABLE
[
$c
]+0x8080);

61 
	g$ok¡r
 .ğ
chr
(
hexdec
(
$c
[0].$c[1])).chr(hexdec($c[2].$c[3]));

65 
	g$ok¡r
 .ğ"&#".
$c
.";";

70 
	g$ok¡r
 .ğ
$c
;

73 
	g$ok¡r
 = 
Œim
(
$ok¡r
);

74  
	g$ok¡r
;

85 iàĞ! 
funùiÚ_exi¡s
('gb2utf8'))

87 
funùiÚ
 
gb2utf8
(
$gb¡r
)

89 if(
funùiÚ_exi¡s
('iconv'))

91  
icÚv
('gbk','utf-8//ignÜe',
$gb¡r
);

93 
glob®
 
	g$CODETABLE
;

94 if(
Œim
(
$gb¡r
)=="")

96  
$gb¡r
;

98 if(
em±y
(
$CODETABLE
))

100 
	g$f’ame
 = 
XAKINC
."/data/gb2312-utf8.dat";

101 
	g$å
 = 
fİ’
(
$f’ame
,"r");

102 
	g$l
 = 
fg‘s
(
$å
,15))

104 
	g$CODETABLE
[
hexdec
(
sub¡r
(
$l
, 0, 6))] = substr($l, 7, 6);

106 
fşo£
(
$å
);

108 
	g$»t
 = "";

109 
	g$utf8
 = "";

110 
	g$gb¡r
 != '')

112 ià(
Üd
(
sub¡r
(
$gb¡r
, 0, 1)) > 0x80)

114 
$thisW
 = 
sub¡r
(
$gb¡r
, 0, 2);

115 
	g$gb¡r
 = 
sub¡r
(
$gb¡r
, 2, 
¡¾’
($gbstr));

116 
	g$utf8
 = "";

117 @
	g$utf8
 = 
u2utf8
(
hexdec
(
$CODETABLE
[hexdec(
bš2hex
(
$thisW
)) - 0x8080]));

118 if(
	g$utf8
!="")

120 
$i
 = 0;
	g$i
 < 
¡¾’
(
$utf8
);$i += 3)

121 
$»t
 .ğ
chr
(
sub¡r
(
$utf8
, 
$i
, 3));

126 
	g$»t
 .ğ
sub¡r
(
$gb¡r
, 0, 1);

127 
	g$gb¡r
 = 
sub¡r
(
$gb¡r
, 1, 
¡¾’
($gbstr));

130  
	g$»t
;

141 iàĞ! 
funùiÚ_exi¡s
('u2utf8'))

143 
funùiÚ
 
u2utf8
(
$c
)

145 
	g$i
 = 0;$˜< 
couÁ
(
$c
);$i++)

147 
	g$¡r
 = "";

149 ià(
	g$c
 < 0x80)

151 
	g$¡r
 .ğ
$c
;

153 ià(
	g$c
 < 0x800)

155 
	g$¡r
 .ğ(0xC0 | 
$c
 >> 6);

156 
	g$¡r
 .ğ(0x80 | 
$c
 & 0x3F);

158 ià(
	g$c
 < 0x10000)

160 
	g$¡r
 .ğ(0xE0 | 
$c
 >> 12);

161 
	g$¡r
 .ğ(0x80 | 
$c
 >> 6 & 0x3F);

162 
	g$¡r
 .ğ(0x80 | 
$c
 & 0x3F);

164 ià(
	g$c
 < 0x200000)

166 
	g$¡r
 .ğ(0xF0 | 
$c
 >> 18);

167 
	g$¡r
 .ğ(0x80 | 
$c
 >> 12 & 0x3F);

168 
	g$¡r
 .ğ(0x80 | 
$c
 >> 6 & 0x3F);

169 
	g$¡r
 .ğ(0x80 | 
$c
 & 0x3F);

171  
	g$¡r
;

182 iàĞ! 
funùiÚ_exi¡s
('utf82u'))

184 
funùiÚ
 
utf82u
(
$c
)

186 
¡¾’
(
$c
))

189  
Üd
(
$c
);

191 
$n
 = (
Üd
(
$c
[0]) & 0x3f) << 6;

192 
	g$n
 +ğ
Üd
(
$c
[1]) & 0x3f;

193  
	g$n
;

195 
$n
 = (
Üd
(
$c
[0]) & 0x1f) << 12;

196 
	g$n
 +ğ(
Üd
(
$c
[1]) & 0x3f) << 6;

197 
	g$n
 +ğ
Üd
(
$c
[2]) & 0x3f;

198  
	g$n
;

200 
$n
 = (
Üd
(
$c
[0]) & 0x0f) << 18;

201 
	g$n
 +ğ(
Üd
(
$c
[1]) & 0x3f) << 12;

202 
	g$n
 +ğ(
Üd
(
$c
[2]) & 0x3f) << 6;

203 
	g$n
 +ğ
Üd
(
$c
[3]) & 0x3f;

204  
	g$n
;

216 iàĞ! 
funùiÚ_exi¡s
('big52gb'))

218 
funùiÚ
 
big52gb
(
$Text
)

220 if(
funùiÚ_exi¡s
('iconv'))

222  
icÚv
('big5','gbk//ignÜe',
$Text
);

224 
glob®
 
	g$BIG5_DATA
;

225 if(
em±y
(
$BIG5_DATA
))

227 
	g$f’ame
 = 
XAKINC
."/data/big5-gb.dat";

228 
	g$å
 = 
fİ’
(
$f’ame
, "rb");

229 
	g$BIG5_DATA
 = 
ä—d
(
$å
,
fesize
(
$f’ame
));

230 
fşo£
(
$å
);

232 
	g$max
 = 
¡¾’
(
$Text
)-1;

233 
	g$i
=0;$i<
	g$max
;$i++)

235 
	g$h
 = 
Üd
(
$Text
[
$i
]);

236 if(
	g$h
>=0x80)

238 
$l
 = 
Üd
(
$Text
[
$i
+1]);

239 if(
	g$h
==161 && 
$l
==64)

241 
$gb¡r
 = "ã€€";

245 
	g$p
 = (
$h
-160)*510+(
$l
-1)*2;

246 
	g$gb¡r
 = 
$BIG5_DATA
[
$p
].$BIG5_DATA[$p+1];

248 
	g$Text
[
$i
] = 
$gb¡r
[0];

249 
	g$Text
[
$i
+1] = 
$gb¡r
[1];

250 
	g$i
++;

253  
	g$Text
;

264 iàĞ! 
funùiÚ_exi¡s
('gb2big5'))

266 
funùiÚ
 
gb2big5
(
$Text
)

268 if(
funùiÚ_exi¡s
('iconv'))

270  
icÚv
('gbk','big5//ignÜe',
$Text
);

272 
glob®
 
	g$GB_DATA
;

273 if(
em±y
(
$GB_DATA
))

275 
	g$f’ame
 = 
XAKINC
."/data/gb-big5.dat";

276 
	g$å
 = 
fİ’
(
$f’ame
, "rb");

277 
	g$gb
 = 
ä—d
(
$å
,
fesize
(
$f’ame
));

278 
fşo£
(
$å
);

280 
	g$max
 = 
¡¾’
(
$Text
)-1;

281 
	g$i
=0;$i<
	g$max
;$i++)

283 
	g$h
 = 
Üd
(
$Text
[
$i
]);

284 if(
	g$h
>=0x80)

286 
$l
 = 
Üd
(
$Text
[
$i
+1]);

287 if(
	g$h
==161 && 
$l
==64)

289 
$big
 = "ã€€";

293 
	g$p
 = (
$h
-160)*510+(
$l
-1)*2;

294 
	g$big
 = 
$GB_DATA
[
$p
].$GB_DATA[$p+1];

296 
	g$Text
[
$i
] = 
$big
[0];

297 
	g$Text
[
$i
+1] = 
$big
[1];

298 
	g$i
++;

301  
	g$Text
;

312 iàĞ! 
funùiÚ_exi¡s
('UnicodeUrl2Gbk'))

314 
funùiÚ
 
UnicodeU¾2Gbk
(
$¡r
)

317 if(!
is£t
(
$GLOBALS
['GbkUniDic']))

319 
	g$å
 = 
fİ’
(
XAKINC
.'/data/gbk-unicode.dat','rb');

320 !
ãof
(
$å
))

322 
	g$GLOBALS
['GbkUniDic'][
bš2hex
(
ä—d
(
$å
,2))] = fread($fp,2);

324 
fşo£
(
$å
);

328 
	g$¡r
 = 
¡r_»¶aû
('$#$','+',
$¡r
);

329 
	g$gËn
 = 
¡¾’
(
$¡r
);

330 
	g$ok¡r
 = "";

331 
	g$i
=0; $˜< 
	g$gËn
; $i++)

333 if(
	g$gËn
-
	g$i
 > 4)

335 if(
	g$¡r
[
$i
]=='%' && 
$¡r
[$i+1]=='u')

337 
$uni
 = 
¡¹Şow”
(
sub¡r
(
$¡r
,
$i
+2,4));

338 
	g$i
 = 
$i
+5;

339 if(
is£t
(
$GLOBALS
['GbkUniDic'][
$uni
]))

341 
	g$ok¡r
 .ğ
$GLOBALS
['GbkUniDic'][
$uni
];

345 
	g$ok¡r
 .ğ"&#".
hexdec
('0x'.
$uni
).";";

350 
	g$ok¡r
 .ğ
$¡r
[
$i
];

355 
	g$ok¡r
 .ğ
$¡r
[
$i
];

358  
	g$ok¡r
;

369 iàĞ! 
funùiÚ_exi¡s
('AutoCharset'))

371 
funùiÚ
 
AutoCh¬£t
(
$fCÚ‹Ás
, 
$äom
='gbk', 
$to
='utf-8')

373 
$äom
 = 
¡¹ouµ”
($from)=='UTF8'? 'utf-8' : $from;

374 
	g$to
 = 
¡¹ouµ”
(
$to
)=='UTF8'? 'utf-8' : $to;

375 ifĞ
¡¹ouµ”
(
$äom
è==ğ¡¹ouµ”(
$to
è|| 
em±y
(
$fCÚ‹Ás
è|| (
is_sÿÏr
($fCÚ‹Ásè&& !
is_¡ršg
($fContents)) ){

377  
$fCÚ‹Ás
;

379 if(
is_¡ršg
(
$fCÚ‹Ás
) )

381 if(
funùiÚ_exi¡s
('mb_convert_encoding'))

383  
mb_cÚv”t_’codšg
 (
$fCÚ‹Ás
, 
$to
, 
$äom
);

384 } 
–£if
 (
funùiÚ_exi¡s
('iconv'))

386  
icÚv
(
$äom
, 
$to
, 
$fCÚ‹Ás
);

388  
	g$fCÚ‹Ás
;

391 
–£if
(
is_¬¿y
(
$fCÚ‹Ás
))

393 
fÜ—ch
 ( 
$fCÚ‹Ás
 
as
 
$key
 => 
$v®
 )

395 
$_key
 = 
AutoCh¬£t
(
$key
,
$äom
,
$to
);

396 
	g$fCÚ‹Ás
[
$_key
] = 
AutoCh¬£t
(
$v®
,
$äom
,
$to
);

397 if(
	g$key
 !ğ
$_key
 )

398 
un£t
(
$fCÚ‹Ás
[
$key
]);

400  
	g$fCÚ‹Ás
;

403  
	g$fCÚ‹Ás
;

	@E:\web\weixun\functions\helpers\cookie.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

18 iàĞ! 
funùiÚ_exi¡s
('PutCookie'))

20 
funùiÚ
 
PutCook›
(
$key
, 
$v®ue
, 
$k±ime
=0, 
$·
="/")

22 
glob®
 
$cfg_cook›_’code
,
$cfg_domaš_cook›
;

23 
£tcook›
(
$key
, 
$v®ue
, 
time
()+
$k±ime
, 
$·
,
$cfg_domaš_cook›
);

24 
£tcook›
(
$key
.'__ckMd5', 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$v®ue
),0,16), 
time
()+
$k±ime
, 
$·
,
$cfg_domaš_cook›
);

35 iàĞ! 
funùiÚ_exi¡s
('DropCookie'))

37 
funùiÚ
 
DrİCook›
(
$key
)

39 
glob®
 
	g$cfg_domaš_cook›
;

40 
£tcook›
(
$key
, '', 
time
()-360000, "/",
$cfg_domaš_cook›
);

41 
£tcook›
(
$key
.'__ckMd5', '', 
time
()-360000, "/",
$cfg_domaš_cook›
);

51 iàĞ! 
funùiÚ_exi¡s
('GetCookie'))

53 
funùiÚ
 
G‘Cook›
(
$key
)

55 
glob®
 
	g$cfg_cook›_’code
;

56 ifĞ!
is£t
(
$_COOKIE
[
$key
]) || !isset($_COOKIE[$key.'__ckMd5']) )

62 if(
	g$_COOKIE
[
$key
.'__ckMd5']!=
sub¡r
(
md5
(
$cfg_cook›_’code
.
$_COOKIE
[$key]),0,16))

68  
	g$_COOKIE
[
$key
];

	@E:\web\weixun\functions\helpers\debug.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

18 iàĞ! 
funùiÚ_exi¡s
('Dump'))

20 
funùiÚ
 
Dump
(
$v¬
, 
$echo
=
Œue
, 
$Ïb–
=
nuÎ
, 
$¡riù
=true)

22 
$Ïb–
 = ($Ïb–===
nuÎ
è? '' : 
¹rim
($label) . ' ';

23 if(!
	g$¡riù
) {

24 ià(
ši_g‘
('html_errors')) {

25 
	g$ouut
 = 
´št_r
(
$v¬
, 
Œue
);

26 
	g$ouut
 = "<´e>".
$Ïb–
.
html¥ecŸlch¬s
(
$ouut
,
ENT_QUOTES
)."</pre>";

28 
	g$ouut
 = 
$Ïb–
 . " : " . 
´št_r
(
$v¬
, 
Œue
);

31 
ob_¡¬t
();

32 
v¬_dump
(
$v¬
);

33 
	g$ouut
 = 
ob_g‘_ş—n
();

34 if(!
ex‹nsiÚ_lßded
('xdebug')) {

35 
	g$ouut
 = 
´eg_»¶aû
("/\]\=\>\n(\s+)/m", "] => ", 
$ouut
);

36 
	g$ouut
 = '<´e>'. 
$Ïb–
. 
html¥ecŸlch¬s
(
$ouut
, 
ENT_QUOTES
). '</pre>';

39 ià(
	g$echo
) {

40 
echo
(
$ouut
);

41  
	gnuÎ
;

43  
	g$ouut
;

56 iàĞ! 
funùiÚ_exi¡s
('ExecTime'))

58 
funùiÚ
 
ExecTime
()

60 
	g$time
 = 
ex¶ode
(" ", 
miüÙime
());

61 
	g$u£c
 = ()
$time
[0];

62 
	g$£c
 = ()
$time
[1];

63  
	g$£c
 + 
	g$u£c
;

	@E:\web\weixun\functions\helpers\downmix.helper.php

1 <?
php


15 iàĞ! 
funùiÚ_exi¡s
('RndString'))

17 
funùiÚ
 
RndSŒšg
(&
$body
)

20 
	g$maxpos
 = 1024;

23 
	g$fÚtCŞÜ
 = "#FFFFFF";

26 
	g$¡1
 = 
chr
(
mt_¿nd
(
Üd
('A'),ord('Z'))).chr(mt_rand(ord('a'),ord('z'))).chr(mt_rand(ord('a'),ord('z'))).mt_rand(100,999);

27 
	g$¡2
 = 
chr
(
mt_¿nd
(
Üd
('A'),ord('Z'))).chr(mt_rand(ord('a'),ord('z'))).chr(mt_rand(ord('a'),ord('z'))).mt_rand(100,999);

28 
	g$¡3
 = 
chr
(
mt_¿nd
(
Üd
('A'),ord('Z'))).chr(mt_rand(ord('a'),ord('z'))).chr(mt_rand(ord('a'),ord('z'))).mt_rand(100,999);

29 
	g$¡4
 = 
chr
(
mt_¿nd
(
Üd
('A'),ord('Z'))).chr(mt_rand(ord('a'),ord('z'))).chr(mt_rand(ord('a'),ord('z'))).mt_rand(100,999);

30 
	g$ºd¡yË
[1]['value'] = ".{$st1} { display:none; }";

31 
	g$ºd¡yË
[1]['Çme'] = 
$¡1
;

32 
	g$ºd¡yË
[2]['value'] = ".{$st2} { display:none; }";

33 
	g$ºd¡yË
[2]['Çme'] = 
$¡2
;

34 
	g$ºd¡yË
[3]['value'] = ".{$st3} { display:none; }";

35 
	g$ºd¡yË
[3]['Çme'] = 
$¡3
;

36 
	g$ºd¡yË
[4]['value'] = ".{$st4} { display:none; }";

37 
	g$ºd¡yË
[4]['Çme'] = 
$¡4
;

38 
	g$mdd
 = 
mt_¿nd
(1,4);

39 
	g$ºd¡yËV®ue
 = 
$ºd¡yË
[
$mdd
]['value'];

40 
	g$ºd¡yËName
 = 
$ºd¡yË
[
$mdd
]['name'];

41 
	g$»SŒšg
 = "<style> $rndstyleValue </style>\r\n";

44 
	g$ºdem
[1] = 'font';

45 
	g$ºdem
[2] = 'div';

46 
	g$ºdem
[3] = 'span';

47 
	g$ºdem
[4] = 'p';

50 
	g$å
 = 
fİ’
(
XAKDATA
.'/downmix.data.php','r');

51 
	g$¡¬t
 = 0;

52 
	g$tÙ®™em
 = 0;

54 !
ãof
(
$å
))

56 
	g$v
 = 
Œim
(
fg‘s
(
$å
,128));

57 if(
	g$¡¬t
==1)

59 if(
´eg_m©ch
("/#’d#/i", 
$v
))

63 if(
	g$v
!='')

65 
$tÙ®™em
++; 
	g$ºd¡ršg
[$tÙ®™em] = 
´eg_»¶aû
("/#,/", "", 
$v
);

68 if(
´eg_m©ch
("/#¡¬t#/i", 
$v
))

70 
	g$¡¬t
 = 1;

73 
fşo£
(
$å
);

76 
	g$bodyËn
 = 
¡¾’
(
$body
) - 1;

77 
	g$´•os
 = 0;

78 
	g$i
=0;$i<=
$bodyËn
;$i++)

80 if(
	g$i
+2 >ğ
$bodyËn
 || 
$i
<50)

82 
$»SŒšg
 .ğ
$body
[
$i
];

86 
	g$Áag
 = @
¡¹Şow”
(
$body
[
$i
].$body[$i+1].$body[$i+2]);

87 if(
	g$Áag
=='</p' || (
$Áag
=='<br' && 
$i
-
$´•os
>
$maxpos
) )

89 
$dd
 = 
mt_¿nd
(1,4);

90 
	g$emÇme
 = 
$ºdem
[
$dd
];

91 
	g$dd
 = 
mt_¿nd
(1,
$tÙ®™em
);

92 
	g$º¡r
 = 
$ºd¡ršg
[
$dd
];

93 if(
	g$emÇme
!='font')

95 
$º¡r
 = " <$emname class='$rndstyleName'>$rnstr</$emname> ";

99 
	g$º¡r
 = " <font color='$fontColor'>$rnstr</font> ";

101 
	g$»SŒšg
 .ğ
$º¡r
.
$body
[
$i
];

102 
	g$´•os
 = 
$i
;

106 
	g$»SŒšg
 .ğ
$body
[
$i
];

110  
	g$»SŒšg
;

	@E:\web\weixun\functions\helpers\extend.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

15 iàĞ! 
funùiÚ_exi¡s
('ParCv'))

17 
funùiÚ
 
P¬Cv
(
$n
)

19  
chr
(
$n
);

29 iàĞ! 
funùiÚ_exi¡s
('ParamError'))

31 
funùiÚ
 
P¬amE¼Ü
()

33 
ShowMsg
('å¯¹ä¸èµ·ï¼Œä½ è¾“å…¥çš„å‚æ•°æœ‰è¯¯ï¼','javascript:;');

34 
ex™
();

46 iàĞ! 
funùiÚ_exi¡s
('AttDef'))

48 
funùiÚ
 
A‰Def
(
$Şdv¬
, 
$nv
)

50  
em±y
(
$Şdv¬
è? 
	g$nv
 : $oldvar;

60 iàĞ! 
funùiÚ_exi¡s
('AjaxHead'))

62 
funùiÚ
 
AjaxH—d
()

64 @
h—d”
("Pragma:no-cache\r\n");

65 @
h—d”
("Cache-Control:no-cache\r\n");

66 @
h—d”
("Expires:0\r\n");

75 iàĞ! 
funùiÚ_exi¡s
('xak_strip_tags'))

77 
funùiÚ
 
xak_¡r_gs
(
$¡r
) {

78 
	g$¡rs
=
ex¶ode
('<',
$¡r
);

79 
	g$»s
=
$¡rs
[0];

80 
	g$i
=1;$i<
couÁ
(
$¡rs
);$i++)

82 if(!
¡½os
(
$¡rs
[
$i
],'>'))

83 
	g$»s
 = 
$»s
.'&É;'.
$¡rs
[
$i
];

85 
	g$»s
 = 
$»s
.'<'.
$¡rs
[
$i
];

87  
¡r_gs
(
$»s
);

	@E:\web\weixun\functions\helpers\file.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
	g$g_ápLšk
 = 
çl£
;

19 iàĞ! 
funùiÚ_exi¡s
('FtpMkdir'))

21 
funùiÚ
 
FMkdœ
(
$Œu•©h
,
$mmode
,
$isMkdœ
=
Œue
)

23 
glob®
 
$cfg_ba£dœ
,
$cfg_áp_roÙ
,
$g_ápLšk
;

24 
O³nF
();

25 
	g$á´oÙ
 = 
´eg_»¶aû
('/'.
$cfg_áp_roÙ
.'$/', '', 
$cfg_ba£dœ
);

26 
	g$mdœ
 = 
´eg_»¶aû
('/^'.
$á´oÙ
.'/', '', 
$Œu•©h
);

27 if(
	g$isMkdœ
)

29 
áp_mkdœ
(
$g_ápLšk
, 
$mdœ
);

31  
áp_s™e
(
$g_ápLšk
, "chmod $mmode $mdir");

42 iàĞ! 
funùiÚ_exi¡s
('FtpChmod'))

44 
funùiÚ
 
FChmod
(
$Œu•©h
, 
$mmode
)

46  
FMkdœ
(
$Œu•©h
, 
$mmode
, 
çl£
);

56 iàĞ! 
funùiÚ_exi¡s
('OpenFtp'))

58 
funùiÚ
 
O³nF
()

60 
glob®
 
	g$cfg_ba£dœ
,
	g$cfg_áp_ho¡
,
	g$cfg_áp_pÜt
, 
	g$cfg_áp_u£r
,
	g$cfg_áp_pwd
,
	g$cfg_áp_roÙ
,
	g$g_ápLšk
;

61 if(!
	g$g_ápLšk
)

63 if(
	g$cfg_áp_ho¡
=='')

65 
echo
 "ç”±äºä½ çš„ç«™ç‚¹çš„PHPé…ç½®å­˜åœ¨é™åˆ¶ï¼Œç¨‹åºå°è¯•ç”¨FTPè¿›è¡Œç›®å½•æ“ä½œï¼Œä½ å¿…é¡»åœ¨åå°æŒ‡å®šFTPç›¸å…³çš„å˜é‡ï¼";

66 
ex™
();

68 
	g$g_ápLšk
 = 
áp_cÚÃù
(
$cfg_áp_ho¡
,
$cfg_áp_pÜt
);

69 if(!
	g$g_ápLšk
)

71 
	gecho
 "è¿æ¥FTPå¤±è´¥ï¼";

72 
ex™
();

74 if(!
áp_logš
(
$g_ápLšk
,
$cfg_áp_u£r
,
$cfg_áp_pwd
))

76 
	gecho
 "ç™»é™†FTPå¤±è´¥ï¼";

77 
ex™
();

89 iàĞ! 
funùiÚ_exi¡s
('CloseFtp'))

91 
funùiÚ
 
Clo£F
()

93 
glob®
 
	g$g_ápLšk
;

94 if(
	g$g_ápLšk
)

96 @
áp_qu™
(
$g_ápLšk
);

109 iàĞ! 
funùiÚ_exi¡s
('MkdirAll'))

111 
funùiÚ
 
MkdœAÎ
(
$Œu•©h
,
$mmode
)

113 
glob®
 
	g$cfg_áp_mkdœ
,
	g$isSaãMode
,
	g$cfg_dœ_purv›w
;

114 ifĞ
	g$isSaãMode
 || 
	g$cfg_áp_mkdœ
=='Y' )

116  
FMkdœ
(
$Œu•©h
, 
$mmode
);

120 if(!
fe_exi¡s
(
$Œu•©h
))

122 
mkdœ
(
$Œu•©h
, 
$cfg_dœ_purv›w
);

123 
chmod
(
$Œu•©h
, 
$cfg_dœ_purv›w
);

124  
	gŒue
;

128  
	gŒue
;

142 iàĞ! 
funùiÚ_exi¡s
('ChmodAll'))

144 
funùiÚ
 
ChmodAÎ
(
$Œu•©h
,
$mmode
)

146 
glob®
 
	g$cfg_áp_mkdœ
,
	g$isSaãMode
;

147 ifĞ
	g$isSaãMode
 || 
	g$cfg_áp_mkdœ
=='Y' )

149  
FChmod
(
$Œu•©h
, 
$mmode
);

153  
chmod
(
$Œu•©h
, '0'.
$mmode
);

165 iàĞ! 
funùiÚ_exi¡s
('CreateDir'))

167 
funùiÚ
 
C»©eDœ
(
$¥©h
)

169 if(!
funùiÚ_exi¡s
('SpCreateDir'))

171 
»quœe_Úû
(
XAKINC
.'/inc/inc_fun_funAdmin.php');

173  
SpC»©eDœ
(
$¥©h
);

186 iàĞ! 
funùiÚ_exi¡s
('PutFile'))

188 
funùiÚ
 
PutFe
(
$fe
, 
$cÚ‹Á
, 
$æag
 = 0)

190 
$·thšfo
 = 
·thšfo
 ( 
$fe
 );

191 ià(! 
em±y
 ( 
$·thšfo
 ['dirname'] ))

193 ià(
fe_exi¡s
 ( 
$·thšfo
 ['dœÇme'] ) ==ğ
FALSE
)

195 ià(@
mkdœ
 ( 
$·thšfo
 ['dœÇme'], 0777, 
TRUE
 ) ==ğ
FALSE
)

197  
FALSE
;

201 ià(
	g$æag
 ==ğ
FILE_APPEND
)

203  @
fe_put_cÚ‹Ás
 ( 
$fe
, 
$cÚ‹Á
, 
FILE_APPEND
 );

207  @
fe_put_cÚ‹Ás
 ( 
$fe
, 
$cÚ‹Á
, 
LOCK_EX
 );

219 iàĞ! 
funùiÚ_exi¡s
('RmRecurse'))

221 
funùiÚ
 
RmRecur£
(
$fe
)

223 ià(
is_dœ
(
$fe
è&& !
is_lšk
($file))

225 
fÜ—ch
(
glob
(
$fe
 . '/*'è
as
 
$sf
)

227 ià(!
RmRecur£
(
$sf
))

229  
	gçl£
;

232  @
rmdœ
(
$fe
);

234  @
uÆšk
(
$fe
);

	@E:\web\weixun\functions\helpers\filter.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

22 iàĞ! 
funùiÚ_exi¡s
('HtmlReplace'))

24 
funùiÚ
 
HtmlR•Ïû
(
$¡r
,
$½ty³
=0)

26 
$¡r
 = 
¡r¦ashes
($str);

27 
	g$¡r
 = 
´eg_»¶aû
("/<[\/]{0,1}¡yË([^>]*)>(.*)<\/¡yË>/i", '', 
$¡r
);

28 if(
	g$½ty³
==0)

30 
$¡r
 = 
html¥ecŸlch¬s
($str);

32 if(
	g$½ty³
==1)

34 
$¡r
 = 
html¥ecŸlch¬s
($str);

35 
	g$¡r
 = 
¡r_»¶aû
("ã€€", ' ', 
$¡r
);

36 
	g$¡r
 = 
´eg_»¶aû
("/[\r\n\ˆ]{1,}/", ' ', 
$¡r
);

38 if(
	g$½ty³
==2)

40 
$¡r
 = 
html¥ecŸlch¬s
($str);

41 
	g$¡r
 = 
¡r_»¶aû
("ã€€", '', 
$¡r
);

42 
	g$¡r
 = 
´eg_»¶aû
("/[\r\n\ˆ]/", '', 
$¡r
);

46 
	g$¡r
 = 
´eg_»¶aû
("/[\r\n\ˆ]{1,}/", ' ', 
$¡r
);

47 
	g$¡r
 = 
´eg_»¶aû
('/süt/i', 'ï½“ï½ƒï½’ï½‰ï½ï½”', 
$¡r
);

48 
	g$¡r
 = 
´eg_»¶aû
("/<[\/]{0,1}Öšk|m‘a|iä|äa)[^>]*>/i", '', 
$¡r
);

50  
add¦ashes
(
$¡r
);

62 iàĞ! 
funùiÚ_exi¡s
('RemoveXSS'))

64 
funùiÚ
 
RemoveXSS
(
$v®
) {

65 
	g$v®
 = 
´eg_»¶aû
('/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/', '', 
$v®
);

66 
	g$£¬ch
 = 'abcdefghijklmnopqrstuvwxyz';

67 
	g$£¬ch
 .= 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

68 
	g$£¬ch
 .= '1234567890!@#$%^&*()';

69 
	g$£¬ch
 .= '~`";:?+/={}[]-_|\'\\';

70 
	g$i
 = 0; $˜< 
¡¾’
(
$£¬ch
); $i++) {

71 
	g$v®
 = 
´eg_»¶aû
('/(&#[xX]0{0,8}'.
dechex
(
Üd
(
$£¬ch
[
$i
])).';?)/i', $£¬ch[$i], 
$v®
);

72 
	g$v®
 = 
´eg_»¶aû
('/(&#0{0,8}'.
Üd
(
$£¬ch
[
$i
]).';?)/', $£¬ch[$i], 
$v®
);

75 
	g$¿1
 = 
¬¿y
('javascript', 'vbscript', 'expression', 'applet', 'meta', 'xml', 'blink', 'link', 'style', 'script', 'embed', 'object', 'iframe', 'frame', 'frameset', 'ilayer', 'layer', 'bgsound', 'title', 'base');

76 
	g$¿2
 = 
¬¿y
('onabort', 'onactivate', 'onafterprint', 'onafterupdate', 'onbeforeactivate', 'onbeforecopy', 'onbeforecut', 'onbeforedeactivate', 'onbeforeeditfocus', 'onbeforepaste', 'onbeforeprint', 'onbeforeunload', 'onbeforeupdate', 'onblur', 'onbounce', 'oncellchange', 'onchange', 'onclick', 'oncontextmenu', 'oncontrolselect', 'oncopy', 'oncut', 'ondataavailable', 'ondatasetchanged', 'ondatasetcomplete', 'ondblclick', 'ondeactivate', 'ondrag', 'ondragend', 'ondragenter', 'ondragleave', 'ondragover', 'ondragstart', 'ondrop', 'onerror', 'onerrorupdate', 'onfilterchange', 'onfinish', 'onfocus', 'onfocusin', 'onfocusout', 'onhelp', 'onkeydown', 'onkeypress', 'onkeyup', 'onlayoutcomplete', 'onload', 'onlosecapture', 'onmousedown', 'onmouseenter', 'onmouseleave', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onmousewheel', 'onmove', 'onmoveend', 'onmovestart', 'onpaste', 'onpropertychange', 'onreadystatechange', 'onreset', 'onresize', 'onresizeend', 'onresizestart', 'onrowenter', 'onrowexit', 'onrowsdelete', 'onrowsinserted', 'onscroll', 'onselect', 'onselectionchange', 'onselectstart', 'onstart', 'onstop', 'onsubmit', 'onunload');

77 
	g$¿
 = 
¬¿y_m”ge
(
$¿1
, 
$¿2
);

79 
	g$found
 = 
Œue
;

80 
	g$found
 =ğ
Œue
) {

81 
$v®_befÜe
 = 
$v®
;

82 
	g$i
 = 0; $˜< (
	g$¿
); $i++) {

83 
	g$·‰”n
 = '/';

84 
	g$j
 = 0; $j < 
¡¾’
(
$¿
[
$i
]); $j++) {

85 ià(
	g$j
 > 0) {

86 
	g$·‰”n
 .= '(';

87 
	g$·‰”n
 .= '(&#[xX]0{0,8}([9ab]);)';

88 
	g$·‰”n
 .= '|';

89 
	g$·‰”n
 .= '|(&#0{0,8}([9|10|13]);)';

90 
	g$·‰”n
 .= ')*';

92 
	g$·‰”n
 .ğ
$¿
[
$i
][
$j
];

94 
	g$·‰”n
 .= '/i';

95 
	g$»¶aûm’t
 = 
sub¡r
(
$¿
[
$i
], 0, 2).'<x>'.substr($ra[$i], 2);

96 
	g$v®
 = 
´eg_»¶aû
(
$·‰”n
, 
$»¶aûm’t
, 
$v®
);

97 ià(
	g$v®_befÜe
 =ğ
$v®
) {

98 
$found
 = 
çl£
;

102  
	g$v®
;

113 iàĞ! 
funùiÚ_exi¡s
('TrimMsg'))

115 
funùiÚ
 
TrimMsg
(
$msg
)

117 
	g$msg
 = 
Œim
(
¡r¦ashes
(
$msg
));

118 
	g$msg
 = 
Æ2br
(
html¥ecŸlch¬s
(
$msg
));

119 
	g$msg
 = 
¡r_»¶aû
(" ","&nb¥;&nb¥;",
$msg
);

120  
add¦ashes
(
$msg
);

130 iàĞ! 
funùiÚ_exi¡s
('FilterSearch'))

132 
funùiÚ
 
F‹rS—rch
(
$keywÜd
)

134 
glob®
 
	g$cfg_soá_Ïng
;

135 if(
	g$cfg_soá_Ïng
=='utf-8')

137 
$keywÜd
 = 
´eg_»¶aû
("/[\"\r\n\t\$\\><']/", '', $keyword);

138 if(
	g$keywÜd
 !ğ
¡r¦ashes
(
$keywÜd
))

144  
	g$keywÜd
;

149 
	g$»¡r
 = '';

150 
	g$i
=0;
is£t
(
$keywÜd
[
$i
]);$i++)

152 if(
Üd
(
$keywÜd
[
$i
]) > 0x80)

154 if(
is£t
(
$keywÜd
[
$i
+1]è&& 
Üd
($keyword[$i+1]) > 0x40)

156 
	g$»¡r
 .ğ
$keywÜd
[
$i
].$keyword[$i+1];

157 
	g$i
++;

161 
	g$»¡r
 .= ' ';

166 if(
´eg_m©ch
("/[^0-9a-z@#\.]/",
$keywÜd
[
$i
]))

168 
	g$»¡r
 .= ' ';

172 
	g$»¡r
 .ğ
$keywÜd
[
$i
];

177  
	g$»¡r
;

	@E:\web\weixun\functions\helpers\image.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

21 iàĞ! 
funùiÚ_exi¡s
('ImageResize'))

23 
funùiÚ
 
ImageResize
(
$¤cFe
, 
$toW
, 
$toH
, 
$toFe
="")

25 
glob®
 
$cfg_phÙo_ty³
;

26 if(
	g$toFe
==''è
$toFe
 = 
$¤cFe
;

27 
	g$šfo
 = '';

28 
	g$¤cInfo
 = 
G‘ImageSize
(
$¤cFe
,
$šfo
);

29 
	g$¤cInfo
[2])

32 if(!
$cfg_phÙo_ty³
['gif']è 
FALSE
;

33 
	g$im
 = 
imageü—‹äomgif
(
$¤cFe
);

36 if(!
$cfg_phÙo_ty³
['j³g']è 
FALSE
;

37 
	g$im
 = 
imageü—‹äomj³g
(
$¤cFe
);

40 if(!
$cfg_phÙo_ty³
['²g']è 
FALSE
;

41 
	g$im
 = 
imageü—‹äom²g
(
$¤cFe
);

44 if(!
$cfg_phÙo_ty³
['bmp']è 
FALSE
;

45 
	g$im
 = 
imageü—‹äomwbmp
(
$¤cFe
);

48 
	g$¤cW
=
ImageSX
(
$im
);

49 
	g$¤cH
=
ImageSY
(
$im
);

50 if(
	g$¤cW
<=
$toW
 && 
$¤cH
<=
$toH
 )  
TRUE
;

51 
	g$toWH
=
$toW
/
$toH
;

52 
	g$¤cWH
=
$¤cW
/
$¤cH
;

53 if(
	g$toWH
<=
$¤cWH
)

55 
$áoW
=
$toW
;

56 
	g$áoH
=
$áoW
*(
$¤cH
/
$¤cW
);

60 
	g$áoH
=
$toH
;

61 
	g$áoW
=
$áoH
*(
$¤cW
/
$¤cH
);

63 if(
	g$¤cW
>
	g$toW
||
	g$¤cH
>
	g$toH
)

65 if(
funùiÚ_exi¡s
("imagecreateTRUEcolor"))

67 @
	g$ni
 = 
imageü—‹TRUEcŞÜ
(
$áoW
,
$áoH
);

68 if(
	g$ni
)

70 
imagecİy»§m¶ed
(
$ni
,
$im
,0,0,0,0,
$áoW
,
$áoH
,
$¤cW
,
$¤cH
);

74 
	g$ni
=
imageü—‹
(
$áoW
,
$áoH
);

75 
imagecİy»sized
(
$ni
,
$im
,0,0,0,0,
$áoW
,
$áoH
,
$¤cW
,
$¤cH
);

80 
	g$ni
=
imageü—‹
(
$áoW
,
$áoH
);

81 
imagecİy»sized
(
$ni
,
$im
,0,0,0,0,
$áoW
,
$áoH
,
$¤cW
,
$¤cH
);

83 
	g$¤cInfo
[2])

86 
imagegif
(
$ni
,
$toFe
);

89 
imagej³g
(
$ni
,
$toFe
,85);

92 
imag•ng
(
$ni
,
$toFe
);

95 
imagebmp
(
$ni
,
$toFe
);

98  
FALSE
;

100 
imagede¡roy
(
$ni
);

102 
imagede¡roy
(
$im
);

103  
	gTRUE
;

115 iàĞ! 
funùiÚ_exi¡s
('gdversion'))

117 
funùiÚ
 
gdv”siÚ
()

120 if(!
funùiÚ_exi¡s
('phpinfo'))

122 if(
funùiÚ_exi¡s
('imagecreate'))

133 
ob_¡¬t
();

134 
phpšfo
(8);

135 
	g$moduË_šfo
 = 
ob_g‘_cÚ‹Ás
();

136 
ob_’d_ş—n
();

137 if(
´eg_m©ch
("/\bgd\s+v”siÚ\b[^\d\n\r]+?([\d\.]+)/i", 
$moduË_šfo
,
$m©ches
))

139 
	g$gdv”siÚ_h
 = 
$m©ches
[1];

143 
	g$gdv”siÚ_h
 = 0;

145  
	g$gdv”siÚ_h
;

159 iàĞ! 
funùiÚ_exi¡s
('WaterImg'))

161 
funùiÚ
 
W©”Img
(
$¤cFe
, 
$äomGo
='up')

164 
šşude
(
XAKDATA
.'/mark/inc_photowatermark_config.php');

165 
»quœe_Úû
(
XAKINC
.'/image.class.php');

166 ifĞ
is£t
(
$GLOBALS
['needwatermark']) )

168 
	g$phÙo_m¬kup
 = 
$phÙo_m¬kdown
 = 
em±y
(
$GLOBALS
['needwatermark']) ? '0' : '1';

170 if(
	g$phÙo_m¬kup
 !ğ'1' || (
$äomGo
=='cŞËù' && 
$phÙo_m¬kdown
!='1') )

174 
	g$šfo
 = '';

175 
	g$¤cInfo
 = @
g‘imagesize
(
$¤cFe
,
$šfo
);

176 
	g$¤cFe_w
 = 
$¤cInfo
[0];

177 
	g$¤cFe_h
 = 
$¤cInfo
[1];

179 if(
	g$¤cFe_w
 < 
	g$phÙo_wwidth
 || 
	g$¤cFe_h
 < 
	g$phÙo_wheight
)

183 if(
	g$äomGo
=='up' && 
$phÙo_m¬kup
=='0')

187 if(
	g$äomGo
=='down' && 
$phÙo_m¬kdown
=='0')

191 
	g$TRUEM¬kimg
 = 
XAKDATA
.'/m¬k/'.
$phÙo_m¬kimg
;

192 if(!
fe_exi¡s
(
$TRUEM¬kimg
è|| 
em±y
(
$phÙo_m¬kimg
))

194 
	g$TRUEM¬kimg
 = "";

196 if(
	g$phÙo_w©”pos
 == 0)

198 
$phÙo_w©”pos
 = 
¿nd
(1, 9);

200 
	g$cfg_w©”m¬k‹xt
 = 
¬¿y
();

201 if(
	g$phÙo_m¬kty³
 == '2')

203 if(
fe_exi¡s
(
XAKINC
.'/data/fonts/elephant.ttf'))

205 
$cfg_w©”m¬k‹xt
['fÚ©h'] = 
XAKINC
.'/data/fonts/elephant.ttf';

212 
	g$cfg_w©”m¬k‹xt
['‹xt'] = 
$phÙo_w©”‹xt
;

213 
	g$cfg_w©”m¬k‹xt
['size'] = 
$phÙo_fÚtsize
;

214 
	g$cfg_w©”m¬k‹xt
['angle'] = '0';

215 
	g$cfg_w©”m¬k‹xt
['color'] = '255,255,255';

216 
	g$cfg_w©”m¬k‹xt
['shadowx'] = '0';

217 
	g$cfg_w©”m¬k‹xt
['shadowy'] = '0';

218 
	g$cfg_w©”m¬k‹xt
['shadowcolor'] = '0,0,0';

219 
	g$phÙo_m¬kŒªs
 = 85;

220 
	g$img
 = 
Ãw
 
image
(
$¤cFe
,0, 
$cfg_w©”m¬k‹xt
, 
$phÙo_w©”pos
, 
$phÙo_dŸphªe™y
, 
$phÙo_wheight
, 
$phÙo_wwidth
, 
$phÙo_m¬kty³
, 
$phÙo_m¬kŒªs
,
$TRUEM¬kimg
);

221 
	g$img
->
w©”m¬k
(0);

236 iàĞ! 
funùiÚ_exi¡s
('ImageResizeNew'))

238 
funùiÚ
 
ImageResizeNew
(
$¤cFe
, 
$toW
, 
$toH
, 
$toFe
='', 
$is§ve
=
TRUE
)

240 
glob®
 
$cfg_phÙo_ty³
, 
$cfg_ddimg_bgcŞÜ
;

241 if(
	g$toFe
==''è
$toFe
 = 
$¤cFe
;

242 
	g$šfo
 = '';

243 
	g$¤cInfo
 = 
G‘ImageSize
(
$¤cFe
,
$šfo
);

244 
	g$¤cInfo
[2])

247 if(!
$cfg_phÙo_ty³
['gif']è 
FALSE
;

248 
	g$img
 = 
imageü—‹äomgif
(
$¤cFe
);

251 if(!
$cfg_phÙo_ty³
['j³g']è 
FALSE
;

252 
	g$img
 = 
imageü—‹äomj³g
(
$¤cFe
);

255 if(!
$cfg_phÙo_ty³
['²g']è 
FALSE
;

256 
	g$img
 = 
imageü—‹äom²g
(
$¤cFe
);

259 if(!
$cfg_phÙo_ty³
['bmp']è 
FALSE
;

260 
	g$img
 = 
imageü—‹äomwbmp
(
$¤cFe
);

264 
	g$width
 = 
imageSX
(
$img
);

265 
	g$height
 = 
imageSY
(
$img
);

267 ià(!
	g$width
 || !
	g$height
) {

268  
	gFALSE
;

271 
	g$rg‘_width
 = 
$toW
;

272 
	g$rg‘_height
 = 
$toH
;

273 
	g$rg‘_¿tio
 = 
$rg‘_width
 / 
$rg‘_height
;

275 
	g$img_¿tio
 = 
$width
 / 
$height
;

277 ià(
	g$rg‘_¿tio
 > 
	g$img_¿tio
) {

278 
	g$Ãw_height
 = 
$rg‘_height
;

279 
	g$Ãw_width
 = 
$img_¿tio
 * 
$rg‘_height
;

281 
	g$Ãw_height
 = 
$rg‘_width
 / 
$img_¿tio
;

282 
	g$Ãw_width
 = 
$rg‘_width
;

285 ià(
	g$Ãw_height
 > 
	g$rg‘_height
) {

286 
	g$Ãw_height
 = 
$rg‘_height
;

288 ià(
	g$Ãw_width
 > 
	g$rg‘_width
) {

289 
	g$Ãw_height
 = 
$rg‘_width
;

292 
	g$Ãw_img
 = 
ImageC»©eTrueCŞÜ
(
$rg‘_width
, 
$rg‘_height
);

294 if(
	g$cfg_ddimg_bgcŞÜ
==0è
$bgcŞÜ
 = 
ImageCŞÜAÎoÿ‹
(
$Ãw_img
, 0xff, 0xff, 0xff);

295 
	g$bgcŞÜ
 = 0;

297 ià(!@
imagefËd»ùªgË
(
$Ãw_img
, 0, 0, 
$rg‘_width
-1, 
$rg‘_height
-1, 
$bgcŞÜ
))

299  
	gFALSE
;

302 ià(!@
imagecİy»§m¶ed
(
$Ãw_img
, 
$img
, (
$rg‘_width
-
$Ãw_width
)/2, (
$rg‘_height
-
$Ãw_height
)/2, 0, 0, $Ãw_width, $Ãw_height, 
$width
, 
$height
))

304  
	gFALSE
;

308 if(
	g$is§ve
)

310 
	g$¤cInfo
[2])

313 
imagegif
(
$Ãw_img
, 
$toFe
);

316 
imagej³g
(
$Ãw_img
, 
$toFe
,100);

319 
imag•ng
(
$Ãw_img
, 
$toFe
);

322 
imagebmp
(
$Ãw_img
, 
$toFe
);

325  
FALSE
;

331 
	g$¤cInfo
[2])

334 
imagegif
(
$Ãw_img
);

337 
imagej³g
(
$Ãw_img
);

340 
imag•ng
(
$Ãw_img
);

343 
imagebmp
(
$Ãw_img
);

346  
FALSE
;

349 
imagede¡roy
(
$Ãw_img
);

350 
imagede¡roy
(
$img
);

351  
	gTRUE
;

	@E:\web\weixun\functions\helpers\smiley.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

2 
h–³r
('string');

3 
»quœe_Úû
(
XAKDATA
.'/smiley.data.php');

6 iàĞ! 
funùiÚ_exi¡s
('parseSmileys'))

8 
funùiÚ
 
·r£Smeys
(
$¡r
 = '', 
$image_u¾
 = '', 
$ubb
=
Œue
)

10 
glob®
 
$cfg_smeys
;

11 ià(
	g$image_u¾
 == '')

13  
$¡r
;

16 
	g$image_u¾
 = 
´eg_»¶aû
("/(.+?)\/*$/", "\\1/", 
$image_u¾
);

18 
fÜ—ch
 (
$cfg_smeys
 
as
 
$key
 => 
$v®
)

20 
$¡r
 = 
¡r_»¶aû
(
$key
, "<img src=\"".
$image_u¾
.
$cfg_smeys
[$key][0]."\" width=\"".$cfg_smileys[$key][1]."\" height=\"".$cfg_smileys[$key][2]."\"‡lt=\"".$cfg_smileys[$key][3]."\"/>", $str);

23  
	g$ubb
? 
ubb
(
$¡r
) : $str;

	@E:\web\weixun\functions\helpers\string.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
	g$pšyšs
 = 
A¼ay
();

21 iàĞ! 
funùiÚ_exi¡s
('cn_substrR'))

23 
funùiÚ
 
ú_sub¡rR
(
$¡r
, 
$¦’
, 
$¡¬tdd
=0)

25 
$¡r
 = 
ú_sub¡r
(
¡r¦ashes
($¡r), 
$¦’
, 
$¡¬tdd
);

26  
add¦ashes
(
$¡r
);

39 iàĞ! 
funùiÚ_exi¡s
('cn_substr'))

41 
funùiÚ
 
ú_sub¡r
(
$¡r
, 
$¦’
, 
$¡¬tdd
=0)

43 
glob®
 
$cfg_soá_Ïng
;

44 if(
	g$cfg_soá_Ïng
=='utf-8')

46  
ú_sub¡r_utf8
(
$¡r
, 
$¦’
, 
$¡¬tdd
);

48 
	g$»¡r
 = '';

49 
	g$c
 = '';

50 
	g$¡r_Ën
 = 
¡¾’
(
$¡r
);

51 if(
	g$¡r_Ën
 < 
	g$¡¬tdd
+1)

55 if(
	g$¡r_Ën
 < 
	g$¡¬tdd
 + 
	g$¦’
 || $slen==0)

57 
$¦’
 = 
$¡r_Ën
 - 
$¡¬tdd
;

59 
	g$’ddd
 = 
$¡¬tdd
 + 
$¦’
 - 1;

60 
	g$i
=0;$i<
	g$¡r_Ën
;$i++)

62 if(
	g$¡¬tdd
==0)

64 
$»¡r
 .ğ
$c
;

66 if(
	g$i
 > 
	g$¡¬tdd
)

68 
	g$»¡r
 .ğ
$c
;

71 if(
Üd
(
$¡r
[
$i
])>0x80)

73 if(
	g$¡r_Ën
>
	g$i
+1)

75 
	g$c
 = 
$¡r
[
$i
].$str[$i+1];

77 
	g$i
++;

81 
	g$c
 = 
$¡r
[
$i
];

84 if(
	g$i
 >ğ
$’ddd
)

86 if(
¡¾’
(
$»¡r
)+¡¾’(
$c
)>
$¦’
)

92 
	g$»¡r
 .ğ
$c
;

97  
	g$»¡r
;

110 iàĞ! 
funùiÚ_exi¡s
('cn_substr_utf8'))

112 
funùiÚ
 
ú_sub¡r_utf8
(
$¡r
, 
$Ëngth
, 
$¡¬t
=0)

114 if(
¡¾’
(
$¡r
è< 
$¡¬t
+1)

118 
´eg_m©ch_®l
("/./su", 
$¡r
, 
$¬
);

119 
	g$¡r
 = '';

120 
	g$t¡r
 = '';

123 
	g$i
=0; 
is£t
(
$¬
[0][
$i
]); $i++)

125 if(
¡¾’
(
$t¡r
è< 
	g$¡¬t
)

127 
	g$t¡r
 .ğ
$¬
[0][
$i
];

131 if(
¡¾’
(
$¡r
è< 
	g$Ëngth
 + sŒËn(
$¬
[0][
$i
]) )

133 
	g$¡r
 .ğ
$¬
[0][
$i
];

141  
	g$¡r
;

152 iàĞ! 
funùiÚ_exi¡s
('Html2Text'))

154 
funùiÚ
 
Html2Text
(
$¡r
,
$r
=0)

156 if(!
funùiÚ_exi¡s
('SpHtml2Text'))

158 
»quœe_Úû
(
XAKINC
."/inc/inc_fun_funString.php");

160 if(
	g$r
==0)

162  
SpHtml2Text
(
$¡r
);

166 
	g$¡r
 = 
SpHtml2Text
(
¡r¦ashes
(
$¡r
));

167  
add¦ashes
(
$¡r
);

179 iàĞ! 
funùiÚ_exi¡s
('Text2Html'))

181 
funùiÚ
 
Text2Html
(
$txt
)

183 
	g$txt
 = 
¡r_»¶aû
(" ", "ã€€", 
$txt
);

184 
	g$txt
 = 
¡r_»¶aû
("<", "&É;", 
$txt
);

185 
	g$txt
 = 
¡r_»¶aû
(">", "&gt;", 
$txt
);

186 
	g$txt
 = 
´eg_»¶aû
("/[\r\n]{1,}/isU", "<br/>\r\n", 
$txt
);

187  
	g$txt
;

197 iàĞ! 
funùiÚ_exi¡s
('GetAlabNum'))

199 
funùiÚ
 
G‘AÏbNum
(
$âum
)

201 
	g$nums
 = 
¬¿y
("ï¼","ï¼‘","ï¼’","ï¼“","ï¼”","ï¼•","ï¼–","ï¼—","ï¼˜","ï¼™");

203 
	g$âums
 = 
¬¿y
("0","1","2","3","4","5","6","7","8","9");

204 
	g$âum
 = 
¡r_»¶aû
(
$nums
, 
$âums
, 
$âum
);

205 
	g$âum
 = 
´eg_»¶aû
("/[^0-9\.-]/", '', 
$âum
);

206 if(
	g$âum
=='')

208 
$âum
=0;

210  
	g$âum
;

223 iàĞ! 
funùiÚ_exi¡s
('GetPinyin'))

225 
funùiÚ
 
G‘Pšyš
(
$¡r
, 
$ish—d
=0, 
$isşo£
=1)

227 
glob®
 
$cfg_soá_Ïng
;

228 if(!
funùiÚ_exi¡s
('SpGetPinyin'))

231 
»quœe_Úû
(
XAKINC
."/inc/inc_fun_funAdmin.php");

233 if(
	g$cfg_soá_Ïng
=='utf-8')

235  
SpG‘Pšyš
(
utf82gb
(
$¡r
), 
$ish—d
, 
$isşo£
);

239  
SpG‘Pšyš
(
$¡r
, 
$ish—d
, 
$isşo£
);

252 iàĞ! 
funùiÚ_exi¡s
('htmlspecialchars_decode'))

254 
funùiÚ
 
html¥ecŸlch¬s_decode
(
$¡r
, 
$İtiÚs
=
ENT_COMPAT
) {

255 
$Œªs
 = 
g‘_html_Œª¦©iÚ_bË
(
HTML_SPECIALCHARS
, 
$İtiÚs
);

257 
	g$decode
 = 
ARRAY
();

258 
fÜ—ch
 (
$Œªs
 
AS
 
$ch¬
=>
$’t™y
) {

259 
$decode
[
$’t™y
] = 
$ch¬
;

262 
	g$¡r
 = 
¡¹r
(
$¡r
, 
$decode
);

264  
	g$¡r
;

268 iàĞ! 
funùiÚ_exi¡s
('ubb'))

270 
funùiÚ
 
ubb
(
$Text
) {

271 
	g$Text
=
Œim
(
$Text
);

274 
	g$Text
=
´eg_»¶aû
("/\\t/is"," ",
$Text
);

275 
	g$Text
=
´eg_»¶aû
("/\[hr\]/is","<hr>",
$Text
);

276 
	g$Text
=
´eg_»¶aû
("/\[£·¿tÜ\]/is","<br/>",
$Text
);

277 
	g$Text
=
´eg_»¶aû
("/\[h1\](.+?)\[\/h1\]/is","<h1>\\1</h1>",
$Text
);

278 
	g$Text
=
´eg_»¶aû
("/\[h2\](.+?)\[\/h2\]/is","<h2>\\1</h2>",
$Text
);

279 
	g$Text
=
´eg_»¶aû
("/\[h3\](.+?)\[\/h3\]/is","<h3>\\1</h3>",
$Text
);

280 
	g$Text
=
´eg_»¶aû
("/\[h4\](.+?)\[\/h4\]/is","<h4>\\1</h4>",
$Text
);

281 
	g$Text
=
´eg_»¶aû
("/\[h5\](.+?)\[\/h5\]/is","<h5>\\1</h5>",
$Text
);

282 
	g$Text
=
´eg_»¶aû
("/\[h6\](.+?)\[\/h6\]/is","<h6>\\1</h6>",
$Text
);

283 
	g$Text
=
´eg_»¶aû
("/\[ûÁ”\](.+?)\[\/ûÁ”\]/is","<ûÁ”>\\1</ûÁ”>",
$Text
);

285 
	g$Text
=
´eg_»¶aû
("/\[u¾\](.+?)\[\/u¾\]/is","<¨h»f=\"\\1\"¬g‘='_bÏnk'>\\1</a>",
$Text
);

286 
	g$Text
=
´eg_»¶aû
("/\[u¾=(h‰p:\/\/.+?)\](.+?)\[\/u¾\]/is","<¨h»f='\\1'¬g‘='_bÏnk'>\\2</a>",
$Text
);

287 
	g$Text
=
´eg_»¶aû
("/\[u¾=(.+?)\](.+?)\[\/u¾\]/is","<¨h»f=\\1>\\2</a>",
$Text
);

288 
	g$Text
=
´eg_»¶aû
("/\[img\](.+?)\[\/img\]/is","<img src=\\1>",
$Text
);

289 
	g$Text
=
´eg_»¶aû
("/\[img\s(.+?)\](.+?)\[\/img\]/is","<img \\1 src=\\2>",
$Text
);

290 
	g$Text
=
´eg_»¶aû
("/\[cŞÜ=(.+?)\](.+?)\[\/cŞÜ\]/is","<fÚˆcŞÜ=\\1>\\2</fÚt>",
$Text
);

291 
	g$Text
=
´eg_»¶aû
("/\[cŞÜTxt\](.+?)\[\/cŞÜTxt\]/eis","cŞÜ_txt('\\1')",
$Text
);

292 
	g$Text
=
´eg_»¶aû
("/\[¡yË=(.+?)\](.+?)\[\/¡yË\]/is","<div cÏss='\\1'>\\2</div>",
$Text
);

293 
	g$Text
=
´eg_»¶aû
("/\[size=(.+?)\](.+?)\[\/size\]/is","<fÚˆsize=\\1>\\2</fÚt>",
$Text
);

294 
	g$Text
=
´eg_»¶aû
("/\[sup\](.+?)\[\/sup\]/is","<sup>\\1</sup>",
$Text
);

295 
	g$Text
=
´eg_»¶aû
("/\[sub\](.+?)\[\/sub\]/is","<sub>\\1</sub>",
$Text
);

296 
	g$Text
=
´eg_»¶aû
("/\[´e\](.+?)\[\/´e\]/is","<´e>\\1</´e>",
$Text
);

297 
	g$Text
=
´eg_»¶aû
("/\[emÙ\](.+?)\[\/emÙ\]/eis","emÙ('\\1')",
$Text
);

298 
	g$Text
=
´eg_»¶aû
("/\[ema\](.+?)\[\/ema\]/is","<¨h»f='mato:\\1'>\\1</a>",
$Text
);

299 
	g$Text
=
´eg_»¶aû
("/\[i\](.+?)\[\/i\]/is","<i>\\1</i>",
$Text
);

300 
	g$Text
=
´eg_»¶aû
("/\[u\](.+?)\[\/u\]/is","<u>\\1</u>",
$Text
);

301 
	g$Text
=
´eg_»¶aû
("/\[b\](.+?)\[\/b\]/is","<b>\\1</b>",
$Text
);

302 
	g$Text
=
´eg_»¶aû
("/\[quÙe\](.+?)\[\/quÙe\]/is","<blockquÙe>å¼•ç”¨:<div styË='bÜd”:1px sŞid sv”;background:#EFFFDF;cŞÜ:#393939;·ddšg:5px' >\\1</div></blockquÙe>", 
$Text
);

303 
	g$Text
=
´eg_»¶aû
("/\[sig\](.+?)\[\/sig\]/is","<div styË='‹xt-®ign:†eá; cŞÜ: d¬kg»’; m¬gš-Ëá: 5%'><br><br>--------------------------<br>\\1<br>--------------------------</div>", 
$Text
);

304  
	g$Text
;

	@E:\web\weixun\functions\helpers\test.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 iàĞ! 
funùiÚ_exi¡s
('HelloXak'))

12 
funùiÚ
 
H–loXak
()

14 
	gecho
 "Hello! Xak...";

	@E:\web\weixun\functions\helpers\time.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

16 iàĞ! 
funùiÚ_exi¡s
('MyDate'))

18 
funùiÚ
 
MyD©e
(
$fÜm©
='Y-m-d H:i:s', 
$time¡
=0)

20 
glob®
 
$cfg_şi_time
;

21 
	g$addtime
 = 
$cfg_şi_time
 * 3600;

22 if(
em±y
(
$fÜm©
))

24 
	g$fÜm©
 = 'Y-m-d H:i:s';

26  
gmd©e
 (
$fÜm©
, 
$time¡
+
$addtime
);

37 iàĞ! 
funùiÚ_exi¡s
('GetMkTime'))

39 
funùiÚ
 
G‘MkTime
(
$dtime
)

41 if(!
´eg_m©ch
("/[^0-9]/", 
$dtime
))

43  
	g$dtime
;

45 
	g$dtime
 = 
Œim
(
$dtime
);

46 
	g$dt
 = 
A¼ay
(1970, 1, 1, 0, 0, 0);

47 
	g$dtime
 = 
´eg_»¶aû
("/[\r\n\t]|æ—¥|ç§’/", " ", 
$dtime
);

48 
	g$dtime
 = 
¡r_»¶aû
("å¹´", "-", 
$dtime
);

49 
	g$dtime
 = 
¡r_»¶aû
("æœˆ", "-", 
$dtime
);

50 
	g$dtime
 = 
¡r_»¶aû
("æ—¶", ":", 
$dtime
);

51 
	g$dtime
 = 
¡r_»¶aû
("åˆ†", ":", 
$dtime
);

52 
	g$dtime
 = 
Œim
(
´eg_»¶aû
("/[ ]{1,}/", " ", 
$dtime
));

53 
	g$ds
 = 
ex¶ode
(" ", 
$dtime
);

54 
	g$ymd
 = 
ex¶ode
("-", 
$ds
[0]);

55 if(!
is£t
(
$ymd
[1]))

57 
	g$ymd
 = 
ex¶ode
(".", 
$ds
[0]);

59 if(
is£t
(
$ymd
[0]))

61 
	g$dt
[0] = 
$ymd
[0];

63 if(
is£t
(
$ymd
[1])è
	g$dt
[1] = $ymd[1];

64 if(
is£t
(
$ymd
[2])è
	g$dt
[2] = $ymd[2];

65 if(
¡¾’
(
$dt
[0])==2) $dt[0] = '20'.$dt[0];

66 if(
is£t
(
$ds
[1]))

68 
	g$hms
 = 
ex¶ode
(":", 
$ds
[1]);

69 if(
is£t
(
$hms
[0])è
	g$dt
[3] = $hms[0];

70 if(
is£t
(
$hms
[1])è
	g$dt
[4] = $hms[1];

71 if(
is£t
(
$hms
[2])è
	g$dt
[5] = $hms[2];

73 
fÜ—ch
(
$dt
 
as
 
$k
=>
$v
)

75 
$v
 = 
´eg_»¶aû
("/^0{1,}/", '', 
Œim
($v));

76 if(
	g$v
=='')

78 
$dt
[
$k
] = 0;

81 
	g$mt
 = 
mktime
(
$dt
[3], $dt[4], $dt[5], $dt[1], $dt[2], $dt[0]);

82 if(!
em±y
(
$mt
))

84  
	g$mt
;

88  
time
();

101 iàĞ! 
funùiÚ_exi¡s
('SubDay'))

103 
funùiÚ
 
SubDay
(
$Áime
, 
$ùime
)

105 
	g$day¡
 = 3600 * 24;

106 
	g$cday
 = 
û
((
$Áime
-
$ùime
)/
$day¡
);

107  
	g$cday
;

119 iàĞ! 
funùiÚ_exi¡s
('AddDay'))

121 
funùiÚ
 
AddDay
(
$Áime
, 
$aday
)

123 
	g$day¡
 = 3600 * 24;

124 
	g$oktime
 = 
$Áime
 + (
$aday
 * 
$day¡
);

125  
	g$oktime
;

136 iàĞ! 
funùiÚ_exi¡s
('GetDateTimeMk'))

138 
funùiÚ
 
G‘D©eTimeMk
(
$mktime
)

140  
MyD©e
('Y-m-d H:i:s',
$mktime
);

150 iàĞ! 
funùiÚ_exi¡s
('GetDateMk'))

152 
funùiÚ
 
G‘D©eMk
(
$mktime
)

154 if(
	g$mktime
=="0")  "æš‚æ— ";

155  
MyD©e
("Y-m-d", 
$mktime
);

166 iàĞ! 
funùiÚ_exi¡s
('FloorTime'))

168 
funùiÚ
 
FloÜTime
(
$£cÚds
)

170 
	g$times
 = '';

171 
	g$days
 = 
æoÜ
((
$£cÚds
/86400)%30);

172 
	g$hours
 = 
æoÜ
((
$£cÚds
/3600)%24);

173 
	g$mšu‹s
 = 
æoÜ
((
$£cÚds
/60)%60);

174 
	g$£cÚds
 = 
æoÜ
(
$£cÚds
%60);

175 if(
	g$£cÚds
 >ğ1è
$times
 .ğ
$£cÚds
.'ç§’';

176 if(
	g$mšu‹s
 >ğ1è
$times
 = 
$mšu‹s
.'åˆ†é’Ÿ '.$times;

177 if(
	g$hours
 >ğ1è
$times
 = 
$hours
.'å°æ—¶ '.$times;

178 if(
	g$days
 >ğ1è
$times
 = 
$days
.'å¤©';

179 if(
	g$days
 > 30è 
	gçl£
;

180 
	g$times
 .= 'å‰';

181  
¡r_»¶aû
(" ", '', 
$times
);

	@E:\web\weixun\functions\helpers\upload.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

21 iàĞ! 
funùiÚ_exi¡s
('AdminUpload'))

23 
funùiÚ
 
AdmšU¶ßd
(
$u¶ßdÇme
, 
$áy³
='image', 
$ºddd
=0, 
$w©”m¬k
=
TRUE
, 
$f‘y³
='' )

25 
glob®
 
$dsql
, 
$cu£rLogš
, 
$cfg_addÚ_§v‘y³
, 
$cfg_dœ_purv›w
;

26 
glob®
 
	g$cfg_ba£dœ
, 
	g$cfg_image_dœ
, 
	g$cfg_soá_dœ
, 
	g$cfg_Ùh”_medŸs
;

27 
glob®
 
	g$cfg_imgty³
, 
	g$cfg_soáty³
, 
	g$cfg_medŸty³
;

28 if(
	g$w©”m¬k
è
šşude_Úû
(
XAKINC
.'/image.func.php');

30 
	g$fe_tmp
 = 
is£t
(
$GLOBALS
[
$u¶ßdÇme
]) ? $GLOBALS[$uploadname] : '';

31 if(
	g$fe_tmp
=='' || !
is_u¶ßded_fe
(
$fe_tmp
) )

36 
	g$fe_tmp
 = 
$GLOBALS
[
$u¶ßdÇme
];

37 
	g$fe_size
 = 
fesize
(
$fe_tmp
);

38 
	g$fe_ty³
 = 
$f‘y³
=='' ? 
¡¹Şow”
(
Œim
(
$GLOBALS
[
$u¶ßdÇme
.'_type'])) : $filetype;

40 
	g$fe_Çme
 = 
is£t
(
$GLOBALS
[
$u¶ßdÇme
.'_name']) ? $GLOBALS[$uploadname.'_name'] : '';

41 
	g$fe_¢ames
 = 
ex¶ode
('.', 
$fe_Çme
);

42 
	g$fe_¢ame
 = 
¡¹Şow”
(
Œim
(
$fe_¢ames
[
couÁ
($file_snames)-1]));

44 if(
	g$áy³
=='image' || 
$áy³
=='imagelit')

46 
$f‘y³
 = '1';

47 
	g$¥¬r
 = 
A¼ay
('image/pjpeg', 'image/jpeg', 'image/gif', 'image/png', 'image/xpng', 'image/wbmp');

48 if(!
š_¬¿y
(
$fe_ty³
, 
$¥¬r
))  0;

49 if(
	g$fe_¢ame
=='')

51 if(
$fe_ty³
=='image/gif'è
$fe_¢ame
 = 'jpg';

52 if(
	g$fe_ty³
=='image/²g' || 
$fe_ty³
=='image/x²g'è
$fe_¢ame
 = 'png';

53 if(
	g$fe_ty³
=='image/wbmp'è
$fe_¢ame
 = 'bmp';

54 
	g$fe_¢ame
 = 'jpg';

56 
	g$fedœ
 = 
$cfg_image_dœ
.'/'.
MyD©e
(
$cfg_addÚ_§v‘y³
, 
time
());

58 if(
	g$áy³
=='media')

60 
$f‘y³
 = '3';

61 ifĞ!
´eg_m©ch
('/'.
$cfg_medŸty³
.'/', 
$fe_¢ame
) )  0;

62 
	g$fedœ
 = 
$cfg_Ùh”_medŸs
.'/'.
MyD©e
(
$cfg_addÚ_§v‘y³
, 
time
());

66 
	g$f‘y³
 = '4';

67 
	g$cfg_soáty³
 .ğ'|'.
$cfg_medŸty³
.'|'.
$cfg_imgty³
;

68 
	g$cfg_soáty³
 = 
¡r_»¶aû
('||', '|', 
$cfg_soáty³
);

69 ifĞ!
´eg_m©ch
('/'.
$cfg_soáty³
.'/', 
$fe_¢ame
) )  0;

70 
	g$fedœ
 = 
$cfg_soá_dœ
.'/'.
MyD©e
(
$cfg_addÚ_§v‘y³
, 
time
());

72 if(!
is_dœ
(
XAKROOT
.
$fedœ
))

74 
MkdœAÎ
(
$cfg_ba£dœ
.
$fedœ
, 
$cfg_dœ_purv›w
);

75 
Clo£F
();

77 
	g$f’ame
 = 
$cu£rLogš
->
g‘U£rID
().'-'.
dd2ch¬
(
MyD©e
('ymdHis', 
time
())).
	g$ºddd
;

78 if(
	g$áy³
=='imag–™'è
$f’ame
 .= '-L';

79 ifĞ
fe_exi¡s
(
$cfg_ba£dœ
.
$fedœ
.'/'.
$f’ame
.'.'.
$fe_¢ame
) )

81 
	g$i
=50; $i <= 5000; $i++)

83 ifĞ!
fe_exi¡s
(
$cfg_ba£dœ
.
$fedœ
.'/'.
$f’ame
.'-'.
$i
.'.'.
$fe_¢ame
) )

85 
	g$f’ame
 = 
$f’ame
.'-'.
$i
;

90 
	g$feu¾
 = 
$fedœ
.'/'.
$f’ame
.'.'.
$fe_¢ame
;

91 
	g$rs
 = 
move_u¶ßded_fe
(
$fe_tmp
, 
$cfg_ba£dœ
.
$feu¾
);

92 if(!
	g$rs
)  -2;

93 if(
	g$áy³
=='image' && 
$w©”m¬k
)

95 
W©”Img
(
$cfg_ba£dœ
.
$feu¾
, 'up');

99 
	g$t™Ë
 = 
$f’ame
.'.'.
$fe_¢ame
;

100 
	g$šqu”y
 = "INSERT INTO `#@__uploads`(title,url,mediatype,width,height,playtime,filesize,uptime,mid)

101 
VALUES
 ('$title','$fileurl','$filetype','0','0','0','".filesize($cfg_basedir.$fileurl)."','".time()."','".$cuserLogin->getUserID()."'); ";

102 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

103 
	g$fid
 = 
$dsql
->
G‘La¡ID
();

104 
AddMyAddÚ
(
$fid
, 
$feu¾
);

105  
	g$feu¾
;

113 iàĞ! 
funùiÚ_exi¡s
('MemberUploads'))

115 
funùiÚ
 
Memb”U¶ßds
(
$u²ame
,
$hªdÇme
,
$u£rid
=0,
$uty³
='image',
$exÇme
='',
$maxwidth
=0,
$maxheight
=0,
$w©”
=
çl£
,
$i§dmš
=false)

117 
glob®
 
$cfg_imgty³
,
$cfg_mb_addÚty³
,
$cfg_medŸty³
,
$cfg_u£r_dœ
,
$cfg_ba£dœ
,
$cfg_dœ_purv›w
;

120 if(
em±y
(
$u£rid
èè
	g$u£rid
 = 0;

121 if(!
is_dœ
(
$cfg_ba£dœ
.
$cfg_u£r_dœ
."/$userid"))

123 
MkdœAÎ
(
$cfg_ba£dœ
.
$cfg_u£r_dœ
."/$u£rid", 
$cfg_dœ_purv›w
);

124 
Clo£F
();

127 
	g$®lAÎowTy³
 = 
¡r_»¶aû
('||', '|', 
$cfg_imgty³
.'|'.
$cfg_medŸty³
.'|'.
$cfg_mb_addÚty³
);

128 if(!
em±y
(
$GLOBALS
[
$u²ame
]è&& 
is_u¶ßded_fe
($GLOBALS[$upname]))

130 
	g$nowtme
 = 
time
();

132 
	g$GLOBALS
[
$u²ame
.'_Çme'] = 
Œim
(
´eg_»¶aû
("#[ \r\n\t\*\%\\\/\?><\|\":]{1,}#",'',
$GLOBALS
[$upname.'_name']));

134 if(
	g$uty³
=='image')

136 if(!
´eg_m©ch
("/\.(".
$cfg_imgty³
.")$/", 
$GLOBALS
[
$u²ame
.'_name']))

138 
ShowMsg
("ä½ æ‰€ä¸Šä¼ çš„å›¾ç‰‡ç±»å‹ä¸åœ¨è®¸å¯åˆ—è¡¨ï¼Œè¯·ä¸Šä¼ {$cfg_imgtype}ç±»å‹ï¼",'-1');

139 
ex™
();

141 
	g$¥¬r
 = 
A¼ay
("image/pjpeg","image/jpeg","image/gif","image/png","image/xpng","image/wbmp");

142 
	g$imgfe_ty³
 = 
¡¹Şow”
(
Œim
(
$GLOBALS
[
$u²ame
.'_type']));

143 if(!
š_¬¿y
(
$imgfe_ty³
, 
$¥¬r
))

145 
ShowMsg
('ä¸Šä¼ çš„å›¾ç‰‡æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨JPEGã€GIFã€PNGã€WBMPæ ¼å¼çš„å…¶ä¸­ä¸€ç§ï¼', '-1');

146 
ex™
();

149 if(
	g$uty³
=='æash' && !
´eg_m©ch
("/\.swf$/", 
$GLOBALS
[
$u²ame
.'_name']))

151 
ShowMsg
('ä¸Šä¼ çš„æ–‡ä»¶å¿…é¡»ä¸ºflashæ–‡ä»¶ï¼', '-1');

152 
ex™
();

154 if(
	g$uty³
=='medŸ' && !
´eg_m©ch
("/\.(".
$cfg_medŸty³
.")$/",
$GLOBALS
[
$u²ame
.'_name']))

156 
ShowMsg
('ä½ æ‰€ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹å¿…é¡»ä¸ºï¼š'.
$cfg_medŸty³
, '-1');

157 
ex™
();

159 if(!
´eg_m©ch
("/\.(".
$®lAÎowTy³
.")$/", 
$GLOBALS
[
$u²ame
.'_name']))

161 
ShowMsg
("ä½ æ‰€ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ä¸è¢«å…è®¸ï¼",'-1');

162 
ex™
();

165 
	g$fs
 = 
ex¶ode
('.', 
$GLOBALS
[
$u²ame
.'_name']);

166 
	g$¢ame
 = 
$fs
[
couÁ
($fs)-1];

167 
	g$®Éy³s
 = 
ex¶ode
('|', 
$®lAÎowTy³
);

168 if(!
š_¬¿y
(
¡¹Şow”
(
$¢ame
), 
$®Éy³s
))

170 
ShowMsg
('ä½ æ‰€ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ä¸è¢«å…è®¸ï¼', '-1');

171 
ex™
();

174 if(
´eg_m©ch
("/×¥|php|¶|cgi|shtm|js)$/", 
$¢ame
))

176 
ShowMsg
('ä½ ä¸Šä¼ çš„æ–‡ä»¶ä¸ºç³»ç»Ÿç¦æ­¢çš„ç±»å‹ï¼', '-1');

177 
ex™
();

179 if(
	g$exÇme
=='')

181 
$f’ame
 = 
$cfg_u£r_dœ
."/$u£rid/".
dd2ch¬
(
$nowtme
.'-'.
mt_¿nd
(1000,9999)).'.'.
	g$¢ame
;

185 
	g$f’ame
 = 
$cfg_u£r_dœ
."/{$u£rid}/{$exÇme}.".
$¢ame
;

187 
move_u¶ßded_fe
(
$GLOBALS
[
$u²ame
], 
$cfg_ba£dœ
.
$f’ame
è
Ü
 
d›
("ä¸Šä¼ æ–‡ä»¶åˆ° {$filename} å¤±è´¥ï¼");

188 @
uÆšk
(
$GLOBALS
[
$u²ame
]);

190 if(@
fesize
(
$cfg_ba£dœ
.
$f’ame
è> 
	g$GLOBALS
['cfg_mb_upload_size'] * 1024)

192 @
uÆšk
(
$cfg_ba£dœ
.
$f’ame
);

193 
ShowMsg
('ä½ ä¸Šä¼ çš„æ–‡ä»¶è¶…å‡ºç³»ç»Ÿå¤§å°é™åˆ¶ï¼', '-1');

194 
ex™
();

198 if(
	g$uty³
=='image')

200 
šşude_Úû
(
XAKINC
.'/image.func.php');

201 if(
	g$maxwidth
>0 || 
	g$maxheight
>0)

203 
ImageResize
(
$cfg_ba£dœ
.
$f’ame
, 
$maxwidth
, 
$maxheight
);

205 if(
	g$w©”
)

207 
W©”Img
(
$cfg_ba£dœ
.
$f’ame
);

210  
	g$f’ame
;

216 if(
	g$hªdÇme
=='')

218  
$hªdÇme
;

220 if(
´eg_m©ch
("/\.×¥|php|¶|cgi|shtm|js)$/", 
$hªdÇme
))

222 
ex™
('Not‡llow filename for‚ot safe!');

224 ifĞ!
´eg_m©ch
("/\.(".
$®lAÎowTy³
.")$/", 
$hªdÇme
) )

226 
ex™
('Not‡llow filename for filetype!');

229 ifĞ!
´eg_m©ch
('#^h‰p:#', 
$hªdÇme
è&& !´eg_m©ch('#^'.
$cfg_u£r_dœ
.'/'.
$u£rid
."#", $hªdÇmeè&& !
	g$i§dmš
 )

231 
ex™
('Not‡llow filename for‚ot userdir!');

233  
	g$hªdÇme
;

	@E:\web\weixun\functions\helpers\util.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
defše
('T_NEW_LINE', -1);

11 ià(!
funùiÚ_exi¡s
('token_get_all_nl'))

13 
funùiÚ
 
tok’_g‘_®l_Æ
(
$sourû
)

15 
	g$Ãw_tok’s
 = 
¬¿y
();

18 
	g$tok’s
 = 
tok’_g‘_®l
(
$sourû
);

21 
fÜ—ch
 (
$tok’s
 
as
 
$tok’
)

23 
	g$tok’_Çme
 = 
is_¬¿y
(
$tok’
è? $tok’[0] : 
nuÎ
;

24 
	g$tok’_d©a
 = 
is_¬¿y
(
$tok’
) ? $token[1] : $token;

27 ià(
	g$tok’_Çme
 =ğ
T_CONSTANT_ENCAPSED_STRING
 || 
sub¡r
(
$tok’_d©a
, 0, 2) == '/*')

29 
$Ãw_tok’s
[] = 
¬¿y
(
$tok’_Çme
, 
$tok’_d©a
);

34 
	g$¥l™_d©a
 = 
´eg_¥l™
('#(\r\n|\n)#', 
$tok’_d©a
, -1, 
PREG_SPLIT_DELIM_CAPTURE
 | 
PREG_SPLIT_NO_EMPTY
);

36 
fÜ—ch
 (
$¥l™_d©a
 
as
 
$d©a
)

38 ià(
	g$d©a
 =ğ"\r\n" || 
$d©a
 == "\n")

41 
$Ãw_tok’s
[] = 
¬¿y
(
T_NEW_LINE
, 
$d©a
);

46 
	g$Ãw_tok’s
[] = 
is_¬¿y
(
$tok’
è? 
¬¿y
(
$tok’_Çme
, 
$d©a
) : $data;

51  
	g$Ãw_tok’s
;

55 ià(!
funùiÚ_exi¡s
('token_name_nl'))

57 
funùiÚ
 
tok’_Çme_Æ
(
$tok’
)

59 ià(
	g$tok’
 ==ğ
T_NEW_LINE
)

64  
tok’_Çme
(
$tok’
);

73 iàĞ! 
funùiÚ_exi¡s
('GetCurUrl'))

75 
funùiÚ
 
G‘CurU¾
()

77 if(!
em±y
(
$_SERVER
["REQUEST_URI"]))

79 
	g$sütName
 = 
$_SERVER
["REQUEST_URI"];

80 
	g$nowu¾
 = 
$sütName
;

84 
	g$sütName
 = 
$_SERVER
["PHP_SELF"];

85 if(
em±y
(
$_SERVER
["QUERY_STRING"]))

87 
	g$nowu¾
 = 
$sütName
;

91 
	g$nowu¾
 = 
$sütName
."?".
$_SERVER
["QUERY_STRING"];

94  
	g$nowu¾
;

103 iàĞ! 
funùiÚ_exi¡s
('GetIP'))

105 
funùiÚ
 
G‘IP
()

107 
	g$»®
 = 
NULL
;

108 ià(
	g$»®
 !=ğ
NULL
)

110  
$»®
;

112 ià(
is£t
(
$_SERVER
))

114 ià(
is£t
(
$_SERVER
['HTTP_X_FORWARDED_FOR']))

116 
	g$¬r
 = 
ex¶ode
(',', 
$_SERVER
['HTTP_X_FORWARDED_FOR']);

118 
fÜ—ch
 (
$¬r
 
as
 
$
)

120 
	g$
 = 
Œim
(
$
);

121 ià(
	g$
 != 'unknown')

123 
$»®
 = 
$
;

128 
–£if
 (
is£t
(
$_SERVER
['HTTP_CLIENT_IP']))

130 
	g$»®
 = 
$_SERVER
['HTTP_CLIENT_IP'];

134 ià(
is£t
(
$_SERVER
['REMOTE_ADDR']))

136 
	g$»®
 = 
$_SERVER
['REMOTE_ADDR'];

140 
	g$»®
 = '0.0.0.0';

146 ià(
g‘’v
('HTTP_X_FORWARDED_FOR'))

148 
	g$»®
 = 
g‘’v
('HTTP_X_FORWARDED_FOR');

150 
–£if
 (
g‘’v
('HTTP_CLIENT_IP'))

152 
	g$»®
 = 
g‘’v
('HTTP_CLIENT_IP');

156 
	g$»®
 = 
g‘’v
('REMOTE_ADDR');

159 
´eg_m©ch
("/[\d\.]{7,15}/", 
$»®
, 
$Úlše
);

160 
	g$»®
 = ! 
em±y
(
$Úlše
[0]) ? $onlineip[0] : '0.0.0.0';

161  
	g$»®
;

176 iàĞ! 
funùiÚ_exi¡s
('GetEditor'))

178 
funùiÚ
 
G‘Ed™Ü
(
$âame
, 
$fv®ue
, 
$nheight
="350", 
$‘y³
="Basic", 
$gty³
="´št", 
$isfuÎ·ge
="FALSE",
$bbcode
=
çl£
)

180 if(!
funùiÚ_exi¡s
('SpGetEditor'))

182 
»quœe_Úû
(
XAKINC
."/inc/inc_fun_funAdmin.php");

184  
SpG‘Ed™Ü
(
$âame
, 
$fv®ue
, 
$nheight
, 
$‘y³
, 
$gty³
, 
$isfuÎ·ge
, 
$bbcode
);

194 iàĞ! 
funùiÚ_exi¡s
('GetTemplets'))

196 
funùiÚ
 
G‘Tem¶‘s
(
$f’ame
)

198 if(
fe_exi¡s
(
$f’ame
))

200 
	g$å
 = 
fİ’
(
$f’ame
,"r");

201 
	g$r¡r
 = 
ä—d
(
$å
,
fesize
(
$f’ame
));

202 
fşo£
(
$å
);

203  
	g$r¡r
;

218 iàĞ! 
funùiÚ_exi¡s
('GetSysTemplets'))

220 
funùiÚ
 
G‘SysTem¶‘s
(
$f’ame
)

222  
G‘Tem¶‘s
(
$GLOBALS
['cfg_ba£dœ'].$GLOBALS['cfg_‹m¶‘s_dœ'].'/sy¡em/'.
$f’ame
);

231 iàĞ! 
funùiÚ_exi¡s
('GetNewInfo'))

233 
funùiÚ
 
G‘NewInfo
()

235 if(!
funùiÚ_exi¡s
('SpGetNewInfo'))

237 
»quœe_Úû
(
XAKINC
."/inc/inc_fun_funAdmin.php");

239  
SpG‘NewInfo
();

250 iàĞ! 
funùiÚ_exi¡s
('dd2char'))

252 
funùiÚ
 
dd2ch¬
(
$ddnum
)

254 
	g$ddnum
 = 
¡rv®
(
$ddnum
);

255 
	g$¦’
 = 
¡¾’
(
$ddnum
);

256 
	g$okdd
 = '';

257 
	g$Â
 = '';

258 
	g$i
=0;$i<
	g$¦’
;$i++)

260 if(
is£t
(
$ddnum
[
$i
+1]))

262 
	g$n
 = 
$ddnum
[
$i
].$ddnum[$i+1];

263 ifĞ(
	g$n
>96 && $n<123) || ($n>64 && $n<91) )

265 
	g$okdd
 .ğ
chr
(
$n
);

266 
	g$i
++;

270 
	g$okdd
 .ğ
$ddnum
[
$i
];

275 
	g$okdd
 .ğ
$ddnum
[
$i
];

278  
	g$okdd
;

289 ià(!
funùiÚ_exi¡s
('json_encode')) {

290 
funùiÚ
 
fÜm©_jsÚ_v®ue
(&
$v®ue
)

292 if(
is_boŞ
(
$v®ue
)) {

293 
	g$v®ue
 = 
$v®ue
?'TRUE':'FALSE';

294 } ià(
is_št
(
$v®ue
)) {

295 
	g$v®ue
 = 
štv®
(
$v®ue
);

296 } ià(
is_æßt
(
$v®ue
)) {

297 
	g$v®ue
 = 
æßtv®
(
$v®ue
);

298 } ià(
defšed
(
$v®ue
è&& 
	g$v®ue
 ==ğ
NULL
) {

299 
$v®ue
 = 
¡rv®
(
cÚ¡ªt
($value));

300 } ià(
is_¡ršg
(
$v®ue
)) {

301 
	g$v®ue
 = '"'.
add¦ashes
(
$v®ue
).'"';

303  
	g$v®ue
;

306 
funùiÚ
 
jsÚ_’code
(
$d©a
)

308 if(
is_objeù
(
$d©a
)) {

310 
	g$d©a
 = 
g‘_objeù_v¬s
(
$d©a
);

311 }if(!
is_¬¿y
(
$d©a
)) {

313  
fÜm©_jsÚ_v®ue
(
$d©a
);

316 if(
em±y
(
$d©a
è|| 
is_num”ic
(
im¶ode
('',
¬¿y_keys
($data)))) {

317 
	g$assoc
 = 
FALSE
;

319 
	g$assoc
 = 
TRUE
;

322 
	g$jsÚ
 = 
$assoc
 ? '{' : '[' ;

323 
fÜ—ch
(
$d©a
 
as
 
$key
=>
$v®
) {

324 if(!
is_NULL
(
$v®
)) {

325 if(
$assoc
) {

326 
$jsÚ
 .ğ"\"$key\":".
jsÚ_’code
(
$v®
).",";

328 
	g$jsÚ
 .ğ
jsÚ_’code
(
$v®
).",";

332 if(
¡¾’
(
$jsÚ
)>1) {

333 
	g$jsÚ
 = 
sub¡r
(
$jsÚ
,0,-1);

335 
	g$jsÚ
 .ğ
$assoc
 ? '}' : ']' ;

336  
	g$jsÚ
;

348 ià(!
funùiÚ_exi¡s
('json_decode')) {

349 
funùiÚ
 
jsÚ_decode
(
$jsÚ
, 
$assoc
=
FALSE
)

352 
$begš
 = 
sub¡r
(
$jsÚ
,0,1) ;

353 if(!
š_¬¿y
(
$begš
,
¬¿y
('{','[')))

355  
	g$jsÚ
;

356 
	g$·r£
 = 
sub¡r
(
$jsÚ
,1,-1);

357 
	g$d©a
 = 
ex¶ode
(',',
$·r£
);

358 if(
	g$æag
 = 
$begš
 =='{' ) {

360 
$»suÉ
 = 
Ãw
 
¡dCÏss
();

361 
fÜ—ch
(
$d©a
 
as
 
$v®
) {

362 
	g$™em
 = 
ex¶ode
(':',
$v®
);

363 
	g$key
 = 
sub¡r
(
$™em
[0],1,-1);

364 
	g$»suÉ
->
	g$key
 = 
jsÚ_decode
(
$™em
[1],
$assoc
);

366 if(
	g$assoc
)

367 
	g$»suÉ
 = 
g‘_objeù_v¬s
(
$»suÉ
);

370 
	g$»suÉ
 = 
¬¿y
();

371 
fÜ—ch
(
$d©a
 
as
 
$v®
)

372 
	g$»suÉ
[] = 
jsÚ_decode
(
$v®
,
$assoc
);

374  
	g$»suÉ
;

	@E:\web\weixun\functions\helpers\validate.helper.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 iàĞ! 
funùiÚ_exi¡s
('CheckEmail'))

12 
funùiÚ
 
CheckEma
(
$ema
)

14 ià(!
em±y
(
$ema
))

16  
´eg_m©ch
('/^[a-z0-9]+([\+_\-\.]?[a-z0-9]+)*@([a-z0-9]+[\-]?[a-z0-9]+\.)+[a-z]{2,6}$/i', 
$ema
);

18  
	gFALSE
;

	@E:\web\weixun\functions\image.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

7 şas 
	cimage


9 
v¬
 
	m$©chšfo
;

10 
v¬
 
	m$rg‘fe
;

11 
v¬
 
	m$imageü—‹äomfunc
;

12 
v¬
 
	m$imagefunc
;

13 
v¬
 
	m$©ch
;

14 
v¬
 
	m$ªim©edgif
;

15 
v¬
 
	m$w©”m¬kqu®™y
;

16 
v¬
 
	m$w©”m¬k‹xt
;

17 
v¬
 
	m$thumb¡©us
;

18 
v¬
 
	m$w©”m¬k¡©us
;

21 
funùiÚ
 
image
(
$rg‘fe
, 
$cfg_thumb
, 
$cfg_w©”m¬k‹xt
, 
$phÙo_w©”pos
, 
$phÙo_dŸphªe™y
, 
$phÙo_wheight
, 
$phÙo_wwidth
, 
$cfg_w©”m¬kty³
, 
$phÙo_m¬kŒªs
,
$ŒueM¬kimg
, 
$©ch
 = 
	$¬¿y
())

23 
$this
->
	`__cÚ¡ruù
(
$rg‘fe
, 
$cfg_thumb
, 
$cfg_w©”m¬k‹xt
, 
$phÙo_w©”pos
, 
$phÙo_dŸphªe™y
, 
$phÙo_wheight
, 
$phÙo_wwidth
, 
$cfg_w©”m¬kty³
, 
$phÙo_m¬kŒªs
,
$ŒueM¬kimg
, 
$©ch
);

27 
funùiÚ
 
	`__cÚ¡ruù
(
$rg‘fe
, 
$cfg_thumb
, 
$cfg_w©”m¬k‹xt
, 
$phÙo_w©”pos
, 
$phÙo_dŸphªe™y
, 
$phÙo_wheight
, 
$phÙo_wwidth
, 
$cfg_w©”m¬kty³
, 
$phÙo_m¬kŒªs
,
$ŒueM¬kimg
, 
$©ch
 = 
	$¬¿y
())

29 
$this
->
thumb¡©us
 = 
$cfg_thumb
;

30 
$this
->
w©”m¬k‹xt
 = 
$cfg_w©”m¬k‹xt
;

31 
$this
->
w©”m¬k¡©us
 = 
$phÙo_w©”pos
;

32 
$this
->
w©”m¬kqu®™y
 = 
$phÙo_m¬kŒªs
;

33 
$this
->
w©”m¬kmšwidth
 = 
$phÙo_wwidth
;

34 
$this
->
w©”m¬kmšheight
 = 
$phÙo_wheight
;

35 
$this
->
w©”m¬kty³
 = 
$cfg_w©”m¬kty³
;

36 
$this
->
w©”m¬kŒªs
 = 
$phÙo_dŸphªe™y
;

37 
$this
->
ªim©edgif
 = 0;

38 
$this
->
rg‘fe
 = 
$rg‘fe
;

39 
$this
->
©chšfo
 = @
	`g‘imagesize
(
$rg‘fe
);

40 
$this
->
©ch
 = 
$©ch
;

43 
$this
->
©chšfo
['mime'])

46 
$this
->
imageü—‹äomfunc
 = 
	`funùiÚ_exi¡s
('imagecreatefromjpeg') ? 'imagecreatefromjpeg' : '';

47 
$this
->
imagefunc
 = 
	`funùiÚ_exi¡s
('imagejpeg') ? 'imagejpeg' : '';

50 
$this
->
imageü—‹äomfunc
 = 
	`funùiÚ_exi¡s
('imagecreatefromgif') ? 'imagecreatefromgif' : '';

51 
$this
->
imagefunc
 = 
	`funùiÚ_exi¡s
('imagegif') ? 'imagegif' : '';

54 
$this
->
imageü—‹äomfunc
 = 
	`funùiÚ_exi¡s
('imagecreatefrompng') ? 'imagecreatefrompng' : '';

55 
$this
->
imagefunc
 = 
	`funùiÚ_exi¡s
('imagepng') ? 'imagepng' : '';

59 
$this
->
©ch
['size'] = 
	`em±y
($this->©ch['size']è? @
	`fesize
(
$rg‘fe
) : $this->attach['size'];

60 if(
$this
->
©chšfo
['mime'] == 'image/gif')

62 
$å
 = 
	`fİ’
(
$rg‘fe
, 'rb');

63 
$rg‘fecÚ‹Á
 = 
	`ä—d
(
$å
, 
$this
->
©ch
['size']);

64 
	`fşo£
(
$å
);

65 
$this
->
ªim©edgif
 = 
	`¡½os
(
$rg‘fecÚ‹Á
, 'NETSCAPE2.0'è==ğ
çl£
 ? 0 : 1;

67 
	}
}

78 
funùiÚ
 
	$thumb
(
$thumbwidth
, 
$thumbheight
, 
$´ev›w
 = 0)

80 
$this
->
	`thumb_gd
(
$thumbwidth
, 
$thumbheight
, 
$´ev›w
);

82 if(
$this
->
thumb¡©us
 =ğ2 && $this->
w©”m¬k¡©us
)

84 
$this
->
	`image
($this->
rg‘fe
, $this->
©ch
);

85 
$this
->
©ch
['size'] = 
	`fesize
($this->
rg‘fe
);

87 
	}
}

96 
funùiÚ
 
	$w©”m¬k
(
$´ev›w
 = 0)

98 if(
$this
->
w©”m¬kmšwidth
 && $this->
©chšfo
[0] <ğ$this->w©”m¬kmšwidth && $this->
w©”m¬kmšheight
 && $this->attachinfo[1] <= $this->watermarkminheight)

102 
$this
->
	`w©”m¬k_gd
(
$´ev›w
);

103 
	}
}

114 
funùiÚ
 
	$thumb_gd
(
$thumbwidth
, 
$thumbheight
, 
$´ev›w
 = 0)

117 if(
$this
->
thumb¡©us
 && 
	`funùiÚ_exi¡s
('imagecreatetruecolor') && function_exists('imagecopyresampled') && function_exists('imagejpeg'))

119 
$imageü—‹äomfunc
 = 
$this
->
imageü—‹äomfunc
;

120 
$imagefunc
 = 
$this
->
thumb¡©us
 =ğ1 ? 'imagej³g' : $this->
imagefunc
;

121 
	`li¡
(
$imagewidth
, 
$imageheight
èğ
$this
->
©chšfo
;

122 if(!
$this
->
ªim©edgif
 && (
$imagewidth
 >ğ
$thumbwidth
 || 
$imageheight
 >ğ
$thumbheight
))

124 
$©ch_phÙo
 = 
	`$imageü—‹äomfunc
(
$this
->
rg‘fe
);

125 
$x_¿tio
 = 
$thumbwidth
 / 
$imagewidth
;

126 
$y_¿tio
 = 
$thumbheight
 / 
$imageheight
;

127 if((
$x_¿tio
 * 
$imageheight
è< 
$thumbheight
)

129 
$thumb
['height'] = 
	`û
(
$x_¿tio
 * 
$imageheight
);

130 
$thumb
['width'] = 
$thumbwidth
;

134 
$thumb
['width'] = 
	`û
(
$y_¿tio
 * 
$imagewidth
);

135 
$thumb
['height'] = 
$thumbheight
;

137 
$rg‘fe
 = !
$´ev›w
 ? (
$this
->
thumb¡©us
 =ğ1 ? $this->
rg‘fe
.'.thumb.jpg' : $this->targetfile) : './watermark_tmp.jpg';

138 
$thumb_phÙo
 = 
	`imageü—‹ŒuecŞÜ
(
$thumb
['width'], $thumb['height']);

139 
	`imagecİy»§m¶ed
(
$thumb_phÙo
, 
$©ch_phÙo
, 0, 0, 0, 0, 
$thumb
['width'], $thumb['height'], 
$imagewidth
, 
$imageheight
);

140 if(
$this
->
©chšfo
['mime'] == 'image/jpeg')

142 
	`$imagefunc
(
$thumb_phÙo
, 
$rg‘fe
, 100);

146 
	`$imagefunc
(
$thumb_phÙo
, 
$rg‘fe
);

148 
$this
->
©ch
['thumb'] = $this->
thumb¡©us
 == 1 ? 1 : 0;

151 
	}
}

160 
funùiÚ
 
	$w©”m¬k_gd
(
$´ev›w
 = 0)

162 if(
$this
->
w©”m¬k¡©us
 && 
	`funùiÚ_exi¡s
('imagecopy') && function_exists('imagealphablending') && function_exists('imagecopymerge'))

164 
$imageü—‹func
 = 
$this
->
imageü—‹äomfunc
;

165 
$imagefunc
 = 
$this
->
imagefunc
;

166 
	`li¡
(
$imagewidth
, 
$imageheight
èğ
$this
->
©chšfo
;

167 if(
$this
->
w©”m¬kty³
 < 2)

169 
$w©”m¬k_fe
 = 
$this
->
w©”m¬kty³
 =ğ1 ? 
XAKDATA
.'/mark/mark.png' : XAKDATA.'/mark/mark.gif';

170 
$w©”m¬kšfo
 = @
	`g‘imagesize
(
$w©”m¬k_fe
);

171 
$w©”m¬k_logo
 = 
$this
->
w©”m¬kty³
 =ğ1 ? @
	`imageü—‹äom²g
(
$w©”m¬k_fe
è: @
	`imageü—‹äomgif
($watermark_file);

172 if(!
$w©”m¬k_logo
)

176 
	`li¡
(
$logowidth
, 
$logoheight
èğ
$w©”m¬kšfo
;

180 
$box
 = @
	`imag‘tfbbox
(
$this
->
w©”m¬k‹xt
['size'], $this->watermarktext['angle'], $this->watermarktext['fontpath'],$this->watermarktext['text']);

181 
$logowidth
 = 
	`max
(
$box
[2], $box[4]è- 
	`mš
($box[0], $box[6]);

182 
$logoheight
 = 
	`max
(
$box
[1], $box[3]è- 
	`mš
($box[5], $box[7]);

183 
$ax
 = 
	`mš
(
$box
[0], $box[6]) * -1;

184 
$ay
 = 
	`mš
(
$box
[5], $box[7]) * -1;

186 
$wmwidth
 = 
$imagewidth
 - 
$logowidth
;

187 
$wmheight
 = 
$imageheight
 - 
$logoheight
;

188 if((
$this
->
w©”m¬kty³
 < 2 && 
	`is_»adabË
(
$w©”m¬k_fe
è|| $this->w©”m¬kty³ =ğ2è&& 
$wmwidth
 > 10 && 
$wmheight
 > 10 && !$this->
ªim©edgif
)

190 
$this
->
w©”m¬k¡©us
)

194 
$x
 = +5;

195 
$y
 = +5;

198 
$x
 = (
$imagewidth
 - 
$logowidth
) / 2;

199 
$y
 = +5;

202 
$x
 = 
$imagewidth
 - 
$logowidth
 - 5;

203 
$y
 = +5;

206 
$x
 = +5;

207 
$y
 = (
$imageheight
 - 
$logoheight
) / 2;

210 
$x
 = (
$imagewidth
 - 
$logowidth
) / 2;

211 
$y
 = (
$imageheight
 - 
$logoheight
) / 2;

214 
$x
 = 
$imagewidth
 - 
$logowidth
 - 5;

215 
$y
 = (
$imageheight
 - 
$logoheight
) / 2;

218 
$x
 = +5;

219 
$y
 = 
$imageheight
 - 
$logoheight
 - 5;

222 
$x
 = (
$imagewidth
 - 
$logowidth
) / 2;

223 
$y
 = 
$imageheight
 - 
$logoheight
 - 5;

226 
$x
 = 
$imagewidth
 - 
$logowidth
 - 5;

227 
$y
 = 
$imageheight
 - 
$logoheight
 -5;

230 
$d¡_phÙo
 = @
	`imageü—‹ŒuecŞÜ
(
$imagewidth
, 
$imageheight
);

231 
$rg‘_phÙo
 = 
	`$imageü—‹func
(
$this
->
rg‘fe
);

232 
	`imagecİy
(
$d¡_phÙo
, 
$rg‘_phÙo
, 0, 0, 0, 0, 
$imagewidth
, 
$imageheight
);

233 if(
$this
->
w©”m¬kty³
 == 1)

235 
	`imagecİy
(
$d¡_phÙo
, 
$w©”m¬k_logo
, 
$x
, 
$y
, 0, 0, 
$logowidth
, 
$logoheight
);

237 
	`–£if
(
$this
->
w©”m¬kty³
 == 2)

239 if((
$this
->
w©”m¬k‹xt
['shadowx'] || $this->watermarktext['shadowy']) && $this->watermarktext['shadowcolor'])

241 
$shadowcŞÜrgb
 = 
	`ex¶ode
(',', 
$this
->
w©”m¬k‹xt
['shadowcolor']);

242 
$shadowcŞÜ
 = 
	`imagecŞÜ®loÿ‹
(
$d¡_phÙo
, 
$shadowcŞÜrgb
[0], $shadowcolorrgb[1], $shadowcolorrgb[2]);

243 
	`imag‘táext
(
$d¡_phÙo
, 
$this
->
w©”m¬k‹xt
['size'], $this->watermarktext['angle'],

244 
$x
 + 
$ax
 + 
$this
->
w©”m¬k‹xt
['shadowx'], 
$y
 + 
$ay
 + $this->w©”m¬k‹xt['shadowy'], 
$shadowcŞÜ
,

245 
$this
->
w©”m¬k‹xt
['fontpath'], $this->watermarktext['text']);

247 
$cŞÜrgb
 = 
	`ex¶ode
(',', 
$this
->
w©”m¬k‹xt
['color']);

248 
$cŞÜ
 = 
	`imagecŞÜ®loÿ‹
(
$d¡_phÙo
, 
$cŞÜrgb
[0], $colorrgb[1], $colorrgb[2]);

249 
	`imag‘táext
(
$d¡_phÙo
, 
$this
->
w©”m¬k‹xt
['size'], $this->watermarktext['angle'],

250 
$x
 + 
$ax
, 
$y
 + 
$ay
, 
$cŞÜ
, 
$this
->
w©”m¬k‹xt
['fontpath'], $this->watermarktext['text']);

254 
	`imag—ÍhabËndšg
(
$w©”m¬k_logo
, 
Œue
);

255 
	`imagecİym”ge
(
$d¡_phÙo
, 
$w©”m¬k_logo
, 
$x
, 
$y
, 0, 0, 
$logowidth
, 
$logoheight
, 
$this
->
w©”m¬kŒªs
);

257 
$rg‘fe
 = !
$´ev›w
 ? 
$this
->
rg‘fe
 : './watermark_tmp.jpg';

258 if(
$this
->
©chšfo
['mime'] == 'image/jpeg')

260 
	`$imagefunc
(
$d¡_phÙo
, 
$rg‘fe
, 
$this
->
w©”m¬kqu®™y
);

264 
	`$imagefunc
(
$d¡_phÙo
, 
$rg‘fe
);

266 
$this
->
©ch
['size'] = 
	`fesize
($this->
rg‘fe
);

269 
	}
}

	@E:\web\weixun\functions\image.func.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

9 
šşude
(
XAKDATA
.'/mark/inc_photowatermark_config.php');

11 
glob®
 
	g$cfg_phÙo_ty³
,
	g$cfg_phÙo_ty³Çmes
,
	g$cfg_phÙo_suµÜt
;

12 
	g$cfg_phÙo_ty³
['gif'] = 
FALSE
;

13 
	g$cfg_phÙo_ty³
['j³g'] = 
FALSE
;

14 
	g$cfg_phÙo_ty³
['²g'] = 
FALSE
;

15 
	g$cfg_phÙo_ty³
['wbmp'] = 
FALSE
;

16 
	g$cfg_phÙo_ty³Çmes
 = 
A¼ay
();

17 
	g$cfg_phÙo_suµÜt
 = '';

18 if(
funùiÚ_exi¡s
("imagecreatefromgif") && function_exists("imagegif"))

20 
	g$cfg_phÙo_ty³
["gif"] = 
TRUE
;

21 
	g$cfg_phÙo_ty³Çmes
[] = "image/gif";

22 
	g$cfg_phÙo_suµÜt
 .= "GIF ";

24 if(
funùiÚ_exi¡s
("imagecreatefromjpeg") && function_exists("imagejpeg"))

26 
	g$cfg_phÙo_ty³
["j³g"] = 
TRUE
;

27 
	g$cfg_phÙo_ty³Çmes
[] = "image/pjpeg";

28 
	g$cfg_phÙo_ty³Çmes
[] = "image/jpeg";

29 
	g$cfg_phÙo_suµÜt
 .= "JPEG ";

31 if(
funùiÚ_exi¡s
("imagecreatefrompng") && function_exists("imagepng"))

33 
	g$cfg_phÙo_ty³
["²g"] = 
TRUE
;

34 
	g$cfg_phÙo_ty³Çmes
[] = "image/png";

35 
	g$cfg_phÙo_ty³Çmes
[] = "image/xpng";

36 
	g$cfg_phÙo_suµÜt
 .= "PNG ";

38 if(
funùiÚ_exi¡s
("imagecreatefromwbmp") && function_exists("imagewbmp"))

40 
	g$cfg_phÙo_ty³
["wbmp"] = 
TRUE
;

41 
	g$cfg_phÙo_ty³Çmes
[] = "image/wbmp";

42 
	g$cfg_phÙo_suµÜt
 .= "WBMP ";

46 
h–³r
('image');

	@E:\web\weixun\functions\inc\inc_fun_funAdmin.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

17 
funùiÚ
 
	$SpG‘Pšyš
(
$¡r
, 
$ish—d
=0, 
$isşo£
=1)

19 
glob®
 
$pšyšs
;

20 
$»¡r
 = '';

21 
$¡r
 = 
	`Œim
($str);

22 
$¦’
 = 
	`¡¾’
(
$¡r
);

23 if(
$¦’
 < 2)

25  
$¡r
;

27 if(
	`couÁ
(
$pšyšs
) == 0)

29 
$å
 = 
	`fİ’
(
XAKINC
.'/data/pinyin.dat', 'r');

30 !
	`ãof
(
$å
))

32 
$lše
 = 
	`Œim
(
	`fg‘s
(
$å
));

33 
$pšyšs
[
$lše
[0].$lše[1]] = 
	`sub¡r
($lše, 3, 
	`¡¾’
($line)-3);

35 
	`fşo£
(
$å
);

37 
$i
=0; $i<
$¦’
; $i++)

39 if(
	`Üd
(
$¡r
[
$i
])>0x80)

41 
$c
 = 
$¡r
[
$i
].$str[$i+1];

42 
$i
++;

43 if(
	`is£t
(
$pšyšs
[
$c
]))

45 if(
$ish—d
==0)

47 
$»¡r
 .ğ
$pšyšs
[
$c
];

51 
$»¡r
 .ğ
$pšyšs
[
$c
][0];

55 
$»¡r
 .= "_";

57 }ifĞ
	`´eg_m©ch
("/[a-z0-9]/i", 
$¡r
[
$i
]) )

59 
$»¡r
 .ğ
$¡r
[
$i
];

63 
$»¡r
 .= "_";

66 if(
$isşo£
==0)

68 
	`un£t
(
$pšyšs
);

70  
$»¡r
;

71 
	}
}

81 
funùiÚ
 
	$SpC»©eDœ
(
$¥©h
)

83 
glob®
 
$cfg_dœ_purv›w
,
$cfg_ba£dœ
,
$cfg_áp_mkdœ
,
$isSaãMode
;

84 if(
$¥©h
=='')

86  
Œue
;

88 
$æšk
 = 
çl£
;

89 
$Œu•©h
 = 
$cfg_ba£dœ
;

90 
$Œu•©h
 = 
	`¡r_»¶aû
("\\","/",$truepath);

91 
$¥©hs
 = 
	`ex¶ode
("/",
$¥©h
);

92 
$¥©h
 = "";

93 
	`fÜ—ch
(
$¥©hs
 
as
 
$¥©h
)

95 if(
$¥©h
=="")

99 
$¥©h
 = 
	`Œim
($spath);

100 
$Œu•©h
 .ğ"/".
$¥©h
;

101 if(!
	`is_dœ
(
$Œu•©h
è|| !
	`is_wr™—bË
($truepath))

103 if(!
	`is_dœ
(
$Œu•©h
))

105 
$isok
 = 
	`MkdœAÎ
(
$Œu•©h
,
$cfg_dœ_purv›w
);

109 
$isok
 = 
	`ChmodAÎ
(
$Œu•©h
,
$cfg_dœ_purv›w
);

111 if(!
$isok
)

113 
echo
 "åˆ›å»ºæˆ–ä¿®æ”¹ç›®å½•ï¼š".
$Œu•©h
." å¤±è´¥ï¼<br>";

114 
	`Clo£F
();

115  
çl£
;

119 
	`Clo£F
();

120  
Œue
;

121 
	}
}

123 
funùiÚ
 
	$jsSüt
(
$js
)

125 
$out
 = "<scriptype=\"text/javascript\">";

126 
$out
 .= "//<![CDATA[\n";

127 
$out
 .ğ
$js
;

128 
$out
 .= "\n//]]>";

129 
$out
 .= "</script>\n";

131  
$out
;

132 
	}
}

146 
funùiÚ
 
SpG‘Ed™Ü
(
$âame
,
$fv®ue
,
$nheight
="350",
$‘y³
="Basic",
$gty³
="´št",
$isfuÎ·ge
="çl£",
$bbcode
=
çl£
)

148 
glob®
 
$cfg_cked™Ü_š™Ÿlized
;

149 if(!
is£t
(
$GLOBALS
['cfg_html_editor']))

151 
	g$GLOBALS
['cfg_html_editor']='fck';

153 if(
	g$gty³
=="")

155 
$gty³
 = "print";

157 if(
	g$GLOBALS
['cfg_html_editor']=='fck')

159 
»quœe_Úû
(
XAKINC
.'/FCKeditor/fckeditor.php');

160 
	g$fck
 = 
Ãw
 
FCKed™Ü
(
$âame
);

161 
	g$fck
->
	gBa£P©h
 = 
$GLOBALS
['cfg_cmspath'].'/functions/FCKeditor/' ;

162 
	g$fck
->
	gWidth
 = '100%' ;

163 
	g$fck
->
	gHeight
 = 
$nheight
 ;

164 
	g$fck
->
	gToŞb¬S‘
 = 
$‘y³
 ;

165 
	g$fck
->
	gCÚfig
['FuÎPage'] = 
$isfuÎ·ge
;

166 if(
	g$GLOBALS
['cfg_fck_xhtml']=='Y')

168 
$fck
->
CÚfig
['EnableXHTML'] = 'true';

169 
	g$fck
->
	gCÚfig
['EnableSourceXHTML'] = 'true';

171 
	g$fck
->
	gV®ue
 = 
$fv®ue
 ;

172 if(
	g$gty³
=="print")

174 
$fck
->
C»©e
();

178  
	g$fck
->
C»©eHtml
();

181 if(
	g$GLOBALS
['cfg_html_editor']=='ckeditor')

183 
»quœe_Úû
(
XAKINC
.'/ckeditor/ckeditor.php');

184 
	g$CKEd™Ü
 = 
Ãw
 
CKEd™Ü
();

185 
	g$CKEd™Ü
->
	gba£P©h
 = 
$GLOBALS
['cfg_cmspath'].'/functions/ckeditor/' ;

186 
	g$cÚfig
 = 
$ev’ts
 = 
¬¿y
();

187 
	g$cÚfig
['extraPlugins'] = 'xakpage,multipic,addon';

188 if(
	g$bbcode
)

190 
	g$CKEd™Ü
->
	gš™Ÿlized
 = 
Œue
;

191 
	g$cÚfig
['extraPlugins'] .= ',bbcode';

192 
	g$cÚfig
['fontSize_sizes'] = '30/30%;50/50%;100/100%;120/120%;150/150%;200/200%;300/300%';

193 
	g$cÚfig
['disableObjectResizing'] = 'true';

194 
	g$cÚfig
['smey_·th'] = 
$GLOBALS
['cfg_cmspath'].'/images/smiley/';

196 
»quœe_Úû
(
XAKDATA
.'/smiley.data.php');

197 
	g$jssüt
 = 
¬¿y
();

198 
fÜ—ch
(
$GLOBALS
['cfg_smeys'] 
as
 
$key
=>
$v®
)

200 
$cÚfig
['smey_images'][] = 
$v®
[0];

201 
	g$cÚfig
['smey_desütiÚs'][] = 
$v®
[3];

202 
	g$jssüt
[] = '"'.
$v®
[3].'":"'.
$key
.'"';

204 
	g$jssüt
 = 
im¶ode
(',', 
$jssüt
);

205 
echo
 
jsSüt
('CKEDITOR.cÚfig.ubb_smey = {'.
$jssüt
.'}');

208 
	g$GLOBALS
['toŞs'] = 
em±y
(
$toŞb¬
[
$‘y³
])? 
$GLOBALS
['tools'] : $toolbar[$etype] ;

209 
	g$cÚfig
['toŞb¬'] = 
$GLOBALS
['tools'];

210 
	g$cÚfig
['height'] = 
$nheight
;

211 
	g$cÚfig
['skin'] = 'kama';

212 
	g$CKEd™Ü
->
	g»tuºOuut
 = 
TRUE
;

213 
	g$code
 = 
$CKEd™Ü
->
ed™Ü
(
$âame
, 
$fv®ue
, 
$cÚfig
, 
$ev’ts
);

214 if(
	g$gty³
=="print")

216 
echo
 
$code
;

220  
	g$code
;

223 if(
	g$GLOBALS
['cfg_html_editor']=='kindeditor')

225 if(
em±y
(
$‘y³
))

227 
$‘y³
='Basic';

229 if(
	g$‘y³
=='Basic')

231 
$™ems
="['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'cut', 'copy', 'paste','plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright','justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript','superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/','formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image','flash','insertfile', 'table', 'hr', 'emoticons', 'map', 'link', 'unlink', 'pagebreak']";

233 if(
	g$‘y³
=='Default')

235 
$™ems
="['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'cut', 'copy', 'paste','plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright','justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript','superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/','formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image','flash','insertfile', 'table', 'hr', 'emoticons', 'map', 'link', 'unlink']";

237 if(
	g$‘y³
=='Small')

239 
$™ems
="['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'cut', 'copy', 'paste','plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright','justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript','superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/','formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image','table', 'hr', 'emoticons', 'map', 'link', 'unlink']";

241 if(
	g$‘y³
=='Member')

243 
$™ems
="['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'cut', 'copy', 'paste','plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright','justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript','superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/','formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 'table', 'hr', 'emoticons', 'map', 'link', 'unlink']";

245 if(
	g$‘y³
=='MemberLit')

247 
$™ems
="['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'cut', 'copy', 'paste','plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright','justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript','superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/','formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 'table', 'hr', 'emoticons', 'map', 'link', 'unlink']";

249 if(
	g$‘y³
=='Diy')

251 
$™ems
="['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'cut', 'copy', 'paste','plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright','justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript','superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/','formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 'table', 'hr', 'emoticons', 'map', 'link', 'unlink']";

253 if(
	g$‘y³
=='Feedback')

255 
$™ems
="['source', '|', 'undo', 'redo', '|','bold','italic', 'underline', 'fontsize', 'forecolor', 'link', 'unlink']";

259 
	g$ed·th
=
$GLOBALS
['cfg_cmspath'].'/include/kindeditor';

260 
	g$code
='<süˆch¬£t="utf-8" src="'.
$ed·th
.'/kindeditor-min.js"></script>

261 <
süt
 
ch¬£t
="utf-8" 
¤c
="'.$edpath.'/lang/zh_CN.js"></script>

262 <
süt
 
ch¬£t
="utf-8" 
¤c
="'.$edpath.'/plugins/code/prettify.js"></script>

263 <
süt
>

264 
KšdEd™Ü
.
»ady
(
funùiÚ
(
K
) {

265 
v¬
 
ed™Ü1
 = 
K
.
ü—‹
(\'‹x»a[Çme="'.
$âame
.'"]\', {

266 
cssP©h
 : \''.
$ed·th
.'/plugins/code/prettify.css\',

267 
u¶ßdJsÚ
 : \''.
$ed·th
.'/upload.php\',

268 
™ems
:'.$items.',

269 
feMªag”JsÚ
 : \''.
$ed·th
.'/file_manager.php\',

270 
®lowFeMªag”
 : 
Œue


272 
´‘tyPršt
();

274 </
	gsüt
>

275 <
‹x»a
 
	gÇme
="'.$âame.'" 
¡yË
="width:100%;height:'.$nheight.'px;visibility:hidden;">'.$fvalue.'</textarea>';

276 if(
$gty³
=="print")

278 
echo
 
$code
;

282  
	g$code
;

294 
funùiÚ
 
	$SpG‘NewInfo
()

296 
glob®
 
$cfg_v”siÚ
,
$dsql
;

297 
$nu¾
 = 
$_SERVER
['HTTP_HOST'];

298 ifĞ
	`´eg_m©ch
("#[a-z\-]{1,}\.[a-z]{2,}#i",
$nu¾
) ) {

299 
$nu¾
 = 
	`u¾’code
($nurl);

302 
$nu¾
 = "test";

304 
$phpv
 = 
	`phpv”siÚ
();

305 
$¥_os
 = 
PHP_OS
;

306 
$mysql_v”
 = 
$dsql
->
	`G‘V”siÚ
();

307 
$offU¾
 = "http://www.de"."decms.com/newinfov57.php?version={$cfg_version}&formurl={$nurl}&phpver={$phpv}&os={$sp_os}&mysqlver={$mysql_ver}";

308  
$offU¾
;

309 
	}
}

	@E:\web\weixun\functions\inc\inc_fun_funString.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

7 
funùiÚ
 
	$SpHtml2Text
(
$¡r
)

9 
$¡r
 = 
	`´eg_»¶aû
("/<sty(.*)\\/style>|<scr(.*)\\/script>|<!--(.*)-->/isU","",$str);

10 
$®Éext
 = "";

11 
$¡¬t
 = 1;

12 
$i
=0;$i<
	`¡¾’
(
$¡r
);$i++)

14 if(
$¡¬t
==0 && 
$¡r
[
$i
]==">")

16 
$¡¬t
 = 1;

18 if(
$¡¬t
==1)

20 if(
$¡r
[
$i
]=="<")

22 
$¡¬t
 = 0;

23 
$®Éext
 .= " ";

25 if(
	`Üd
(
$¡r
[
$i
])>31)

27 
$®Éext
 .ğ
$¡r
[
$i
];

31 
$®Éext
 = 
	`¡r_»¶aû
("ã€€"," ",$alltext);

32 
$®Éext
 = 
	`´eg_»¶aû
("/&([^;&]*)(;|&)/","",$alltext);

33 
$®Éext
 = 
	`´eg_»¶aû
("/[ ]+/s"," ",$alltext);

34  
$®Éext
;

35 
	}
}

	@E:\web\weixun\functions\inc\inc_stat.php

1 <?
php


2 
funùiÚ
 
	$SpUpd©eSt
()

4 
glob®
 
$cfg_v”siÚ
;

5 if(
	`em±y
(
$cfg_v”siÚ
))

7 
$cfg_v”siÚ
 = 'notknow';

9 
$¡©pÜt
 = 
	`¬¿y
(0x68,0x74,0x74,0x70,0x3a,0x2f,0x2f,0x77,0x77,0x77,0x2e,0x64,0x65,0x64,0x65,

12 
$¡©u¾
 = '';

13 
	`fÜ—ch
(
$¡©pÜt
 
as
 
$c
)

15 
$¡©u¾
 .ğ
	`chr
(
$c
);

17 
$¡©u¾
 = $¡©u¾.
	`u¾’code
(
$_SERVER
['HTTP_HOST']).'&v”='.u¾’code(
$cfg_v”siÚ
);

18 
$¡©
 = @
	`fe_g‘_cÚ‹Ás
(
$¡©u¾
);

19  
$¡©
;

20 
	}
}

	@E:\web\weixun\functions\json.class.php

1 <?
php


62 
defše
('SERVICES_JSON_SLICE', 1);

67 
defše
('SERVICES_JSON_IN_STR', 2);

72 
defše
('SERVICES_JSON_IN_ARR', 3);

77 
defše
('SERVICES_JSON_IN_OBJ', 4);

82 
defše
('SERVICES_JSON_IN_CMT', 5);

87 
defše
('SERVICES_JSON_LOOSE_TYPE', 16);

92 
defše
('SERVICES_JSON_SUPPRESS_ERRORS', 32);

115 şas 
	cS”viûs_JSON


133 
funùiÚ
 
	$S”viûs_JSON
(
$u£
 = 0)

135 
$this
->
u£
 = 
$u£
;

149 
funùiÚ
 
	$utf162utf8
(
$utf16
)

152 if(
	`funùiÚ_exi¡s
('mb_convert_encoding')) {

153  
	`mb_cÚv”t_’codšg
(
$utf16
, 'UTF-8', 'UTF-16');

156 
$by‹s
 = (
	`Üd
(
$utf16
{0}) << 8) | ord($utf16{1});

158 
Œue
) {

159 ((0x7F & 
$by‹s
) == $bytes):

162  
	`chr
(0x7F & 
$by‹s
);

164 (0x07FF & 
$by‹s
) == $bytes:

167  
	`chr
(0xC0 | ((
$by‹s
 >> 6) & 0x1F))

168 . 
	`chr
(0x80 | (
$by‹s
 & 0x3F));

170 (0xFFFF & 
$by‹s
) == $bytes:

173  
	`chr
(0xE0 | ((
$by‹s
 >> 12) & 0x0F))

174 . 
	`chr
(0x80 | ((
$by‹s
 >> 6) & 0x3F))

175 . 
	`chr
(0x80 | (
$by‹s
 & 0x3F));

180 
	}
}

193 
funùiÚ
 
	$utf82utf16
(
$utf8
)

196 if(
	`funùiÚ_exi¡s
('mb_convert_encoding')) {

197  
	`mb_cÚv”t_’codšg
(
$utf8
, 'UTF-16', 'UTF-8');

200 
	`¡¾’
(
$utf8
)) {

204  
$utf8
;

209  
	`chr
(0x07 & (
	`Üd
(
$utf8
{0}) >> 2))

210 . 
	`chr
((0xC0 & (
	`Üd
(
$utf8
{0}) << 6))

211 | (0x3F & 
	`Üd
(
$utf8
{1})));

216  
	`chr
((0xF0 & (
	`Üd
(
$utf8
{0}) << 4))

217 | (0x0F & (
	`Üd
(
$utf8
{1}) >> 2)))

218 . 
	`chr
((0xC0 & (
	`Üd
(
$utf8
{1}) << 6))

219 | (0x7F & 
	`Üd
(
$utf8
{2})));

224 
	}
}

237 
funùiÚ
 
	$’code
(
$v¬
)

239 
	`g‘ty³
(
$v¬
)) {

241  
$v¬
 ? 'true' : 'false';

247  (è
$v¬
;

251  (è
$v¬
;

255 
$ascii
 = '';

256 
$¡¾’_v¬
 = 
	`¡¾’
(
$v¬
);

262 
$c
 = 0; $ø< 
$¡¾’_v¬
; ++$c) {

264 
$Üd_v¬_c
 = 
	`Üd
(
$v¬
{
$c
});

266 
Œue
) {

267 
$Üd_v¬_c
 == 0x08:

268 
$ascii
 .= '\b';

270 
$Üd_v¬_c
 == 0x09:

271 
$ascii
 .= '\t';

273 
$Üd_v¬_c
 == 0x0A:

274 
$ascii
 .= '\n';

276 
$Üd_v¬_c
 == 0x0C:

277 
$ascii
 .= '\f';

279 
$Üd_v¬_c
 == 0x0D:

280 
$ascii
 .= '\r';

283 
$Üd_v¬_c
 == 0x22:

284 
$Üd_v¬_c
 == 0x2F:

285 
$Üd_v¬_c
 == 0x5C:

287 
$ascii
 .ğ'\\'.
$v¬
{
$c
};

290 ((
$Üd_v¬_c
 >= 0x20) && ($ord_var_c <= 0x7F)):

292 
$ascii
 .ğ
$v¬
{
$c
};

295 ((
$Üd_v¬_c
 & 0xE0) == 0xC0):

298 
$ch¬
 = 
	`·ck
('C*', 
$Üd_v¬_c
, 
	`Üd
(
$v¬
{
$c
 + 1}));

299 
$c
 += 1;

300 
$utf16
 = 
$this
->
	`utf82utf16
(
$ch¬
);

301 
$ascii
 .ğ
	`¥rštf
('\u%04s', 
	`bš2hex
(
$utf16
));

304 ((
$Üd_v¬_c
 & 0xF0) == 0xE0):

307 
$ch¬
 = 
	`·ck
('C*', 
$Üd_v¬_c
,

308 
	`Üd
(
$v¬
{
$c
 + 1}),

309 
	`Üd
(
$v¬
{
$c
 + 2}));

310 
$c
 += 2;

311 
$utf16
 = 
$this
->
	`utf82utf16
(
$ch¬
);

312 
$ascii
 .ğ
	`¥rštf
('\u%04s', 
	`bš2hex
(
$utf16
));

315 ((
$Üd_v¬_c
 & 0xF8) == 0xF0):

318 
$ch¬
 = 
	`·ck
('C*', 
$Üd_v¬_c
,

319 
	`Üd
(
$v¬
{
$c
 + 1}),

320 
	`Üd
(
$v¬
{
$c
 + 2}),

321 
	`Üd
(
$v¬
{
$c
 + 3}));

322 
$c
 += 3;

323 
$utf16
 = 
$this
->
	`utf82utf16
(
$ch¬
);

324 
$ascii
 .ğ
	`¥rštf
('\u%04s', 
	`bš2hex
(
$utf16
));

327 ((
$Üd_v¬_c
 & 0xFC) == 0xF8):

330 
$ch¬
 = 
	`·ck
('C*', 
$Üd_v¬_c
,

331 
	`Üd
(
$v¬
{
$c
 + 1}),

332 
	`Üd
(
$v¬
{
$c
 + 2}),

333 
	`Üd
(
$v¬
{
$c
 + 3}),

334 
	`Üd
(
$v¬
{
$c
 + 4}));

335 
$c
 += 4;

336 
$utf16
 = 
$this
->
	`utf82utf16
(
$ch¬
);

337 
$ascii
 .ğ
	`¥rštf
('\u%04s', 
	`bš2hex
(
$utf16
));

340 ((
$Üd_v¬_c
 & 0xFE) == 0xFC):

343 
$ch¬
 = 
	`·ck
('C*', 
$Üd_v¬_c
,

344 
	`Üd
(
$v¬
{
$c
 + 1}),

345 
	`Üd
(
$v¬
{
$c
 + 2}),

346 
	`Üd
(
$v¬
{
$c
 + 3}),

347 
	`Üd
(
$v¬
{
$c
 + 4}),

348 
	`Üd
(
$v¬
{
$c
 + 5}));

349 
$c
 += 5;

350 
$utf16
 = 
$this
->
	`utf82utf16
(
$ch¬
);

351 
$ascii
 .ğ
	`¥rštf
('\u%04s', 
	`bš2hex
(
$utf16
));

356  '"'.
$ascii
.'"';

378 ià(
	`is_¬¿y
(
$v¬
è&& 
	`couÁ
($v¬è&& (
	`¬¿y_keys
($v¬è!=ğ
	`¿nge
(0, ($var) - 1))) {

379 
$´İ”t›s
 = 
	`¬¿y_m­
(
	`¬¿y
(
$this
, 'name_value'),

380 
	`¬¿y_keys
(
$v¬
),

381 
	`¬¿y_v®ues
(
$v¬
));

383 
	`fÜ—ch
(
$´İ”t›s
 
as
 
$´İ”ty
) {

384 if(
S”viûs_JSON
::
	`isE¼Ü
(
$´İ”ty
)) {

385  
$´İ”ty
;

389  '{' . 
	`još
(',', 
$´İ”t›s
) . '}';

393 
$–em’ts
 = 
	`¬¿y_m­
(
	`¬¿y
(
$this
, '’code'), 
$v¬
);

395 
	`fÜ—ch
(
$–em’ts
 
as
 
$–em’t
) {

396 if(
S”viûs_JSON
::
	`isE¼Ü
(
$–em’t
)) {

397  
$–em’t
;

401  '[' . 
	`još
(',', 
$–em’ts
) . ']';

404 
$v¬s
 = 
	`g‘_objeù_v¬s
(
$v¬
);

406 
$´İ”t›s
 = 
	`¬¿y_m­
(
	`¬¿y
(
$this
, 'name_value'),

407 
	`¬¿y_keys
(
$v¬s
),

408 
	`¬¿y_v®ues
(
$v¬s
));

410 
	`fÜ—ch
(
$´İ”t›s
 
as
 
$´İ”ty
) {

411 if(
S”viûs_JSON
::
	`isE¼Ü
(
$´İ”ty
)) {

412  
$´İ”ty
;

416  '{' . 
	`još
(',', 
$´İ”t›s
) . '}';

419  (
$this
->
u£
 & 
SERVICES_JSON_SUPPRESS_ERRORS
)

421 : 
Ãw
 
	`S”viûs_JSON_E¼Ü
(
	`g‘ty³
(
$v¬
)." can‚ot beƒncoded‡s JSON string");

423 
	}
}

434 
funùiÚ
 
	$Çme_v®ue
(
$Çme
, 
$v®ue
)

436 
$’coded_v®ue
 = 
$this
->
	`’code
(
$v®ue
);

438 if(
S”viûs_JSON
::
	`isE¼Ü
(
$’coded_v®ue
)) {

439  
$’coded_v®ue
;

442  
$this
->
	`’code
(
	`¡rv®
(
$Çme
)è. ':' . 
$’coded_v®ue
;

443 
	}
}

453 
funùiÚ
 
	$»duû_¡ršg
(
$¡r
)

455 
$¡r
 = 
	`´eg_»¶aû
(
	`¬¿y
(

466 ), '', 
$¡r
);

469  
	`Œim
(
$¡r
);

470 
	}
}

484 
funùiÚ
 
	$decode
(
$¡r
)

486 
$¡r
 = 
$this
->
	`»duû_¡ršg
($str);

488 
	`¡¹Şow”
(
$¡r
)) {

490  
Œue
;

493  
çl£
;

496  
nuÎ
;

499 
$m
 = 
	`¬¿y
();

501 ià(
	`is_num”ic
(
$¡r
)) {

509  (()
$¡r
 =ğ(
š‹g”
)$str)

510 ? (
š‹g”
)
$¡r


511 : ()
$¡r
;

513 } 
	`–£if
 (
	`´eg_m©ch
('/^("|\').*(\1)$/s', 
$¡r
, 
$m
) && $m[1] == $m[2]) {

515 
$d–im
 = 
	`sub¡r
(
$¡r
, 0, 1);

516 
$chrs
 = 
	`sub¡r
(
$¡r
, 1, -1);

517 
$utf8
 = '';

518 
$¡¾’_chrs
 = 
	`¡¾’
(
$chrs
);

520 
$c
 = 0; $ø< 
$¡¾’_chrs
; ++$c) {

522 
$sub¡r_chrs_c_2
 = 
	`sub¡r
(
$chrs
, 
$c
, 2);

523 
$Üd_chrs_c
 = 
	`Üd
(
$chrs
{
$c
});

525 
Œue
) {

526 
$sub¡r_chrs_c_2
 == '\b':

527 
$utf8
 .ğ
	`chr
(0x08);

528 ++
$c
;

530 
$sub¡r_chrs_c_2
 == '\t':

531 
$utf8
 .ğ
	`chr
(0x09);

532 ++
$c
;

534 
$sub¡r_chrs_c_2
 == '\n':

535 
$utf8
 .ğ
	`chr
(0x0A);

536 ++
$c
;

538 
$sub¡r_chrs_c_2
 == '\f':

539 
$utf8
 .ğ
	`chr
(0x0C);

540 ++
$c
;

542 
$sub¡r_chrs_c_2
 == '\r':

543 
$utf8
 .ğ
	`chr
(0x0D);

544 ++
$c
;

547 
$sub¡r_chrs_c_2
 == '\\"':

548 
$sub¡r_chrs_c_2
 == '\\\'':

549 
$sub¡r_chrs_c_2
 == '\\\\':

550 
$sub¡r_chrs_c_2
 == '\\/':

551 ià((
$d–im
 =ğ'"' && 
$sub¡r_chrs_c_2
 != '\\\'') ||

552 (
$d–im
 =ğ"'" && 
$sub¡r_chrs_c_2
 != '\\"')) {

553 
$utf8
 .ğ
$chrs
{++
$c
};

557 
	`´eg_m©ch
('/\\\u[0-9A-F]{4}/i', 
	`sub¡r
(
$chrs
, 
$c
, 6)):

559 
$utf16
 = 
	`chr
(
	`hexdec
(
	`sub¡r
(
$chrs
, (
$c
 + 2), 2)))

560 . 
	`chr
(
	`hexdec
(
	`sub¡r
(
$chrs
, (
$c
 + 4), 2)));

561 
$utf8
 .ğ
$this
->
	`utf162utf8
(
$utf16
);

562 
$c
 += 5;

565 (
$Üd_chrs_c
 >= 0x20) && ($ord_chrs_c <= 0x7F):

566 
$utf8
 .ğ
$chrs
{
$c
};

569 (
$Üd_chrs_c
 & 0xE0) == 0xC0:

572 
$utf8
 .ğ
	`sub¡r
(
$chrs
, 
$c
, 2);

573 ++
$c
;

576 (
$Üd_chrs_c
 & 0xF0) == 0xE0:

579 
$utf8
 .ğ
	`sub¡r
(
$chrs
, 
$c
, 3);

580 
$c
 += 2;

583 (
$Üd_chrs_c
 & 0xF8) == 0xF0:

586 
$utf8
 .ğ
	`sub¡r
(
$chrs
, 
$c
, 4);

587 
$c
 += 3;

590 (
$Üd_chrs_c
 & 0xFC) == 0xF8:

593 
$utf8
 .ğ
	`sub¡r
(
$chrs
, 
$c
, 5);

594 
$c
 += 4;

597 (
$Üd_chrs_c
 & 0xFE) == 0xFC:

600 
$utf8
 .ğ
	`sub¡r
(
$chrs
, 
$c
, 6);

601 
$c
 += 5;

608  
$utf8
;

610 } 
	`–£if
 (
	`´eg_m©ch
('/^\[.*\]$/s', 
$¡r
) ||…reg_match('/^\{.*\}$/s', $str)) {

613 ià(
$¡r
{0} == '[') {

614 
$¡k
 = 
	`¬¿y
(
SERVICES_JSON_IN_ARR
);

615 
$¬r
 = 
	`¬¿y
();

617 ià(
$this
->
u£
 & 
SERVICES_JSON_LOOSE_TYPE
) {

618 
$¡k
 = 
	`¬¿y
(
SERVICES_JSON_IN_OBJ
);

619 
$obj
 = 
	`¬¿y
();

621 
$¡k
 = 
	`¬¿y
(
SERVICES_JSON_IN_OBJ
);

622 
$obj
 = 
Ãw
 
	`¡dCÏss
();

626 
	`¬¿y_push
(
$¡k
, 
	`¬¿y
('wh©' => 
SERVICES_JSON_SLICE
,

628 'd–im' => 
çl£
));

630 
$chrs
 = 
	`sub¡r
(
$¡r
, 1, -1);

631 
$chrs
 = 
$this
->
	`»duû_¡ršg
($chrs);

633 ià(
$chrs
 == '') {

634 ià(
	`»£t
(
$¡k
è=ğ
SERVICES_JSON_IN_ARR
) {

635  
$¬r
;

638  
$obj
;

645 
$¡¾’_chrs
 = 
	`¡¾’
(
$chrs
);

647 
$c
 = 0; $ø<ğ
$¡¾’_chrs
; ++$c) {

649 
$tİ
 = 
	`’d
(
$¡k
);

650 
$sub¡r_chrs_c_2
 = 
	`sub¡r
(
$chrs
, 
$c
, 2);

652 ià((
$c
 =ğ
$¡¾’_chrs
è|| ((
$chrs
{$c} =ğ','è&& (
$tİ
['wh©'] =ğ
SERVICES_JSON_SLICE
))) {

655 
$¦iû
 = 
	`sub¡r
(
$chrs
, 
$tİ
['wh”e'], (
$c
 - $top['where']));

656 
	`¬¿y_push
(
$¡k
, 
	`¬¿y
('wh©' => 
SERVICES_JSON_SLICE
, 'wh”e' => (
$c
 + 1), 'd–im' => 
çl£
));

659 ià(
	`»£t
(
$¡k
è=ğ
SERVICES_JSON_IN_ARR
) {

661 
	`¬¿y_push
(
$¬r
, 
$this
->
	`decode
(
$¦iû
));

663 } 
	`–£if
 (
	`»£t
(
$¡k
è=ğ
SERVICES_JSON_IN_OBJ
) {

668 
$·¹s
 = 
	`¬¿y
();

670 ià(
	`´eg_m©ch
('/^\s*(["\'].*[^\\\]["\'])\s*:\s*(\S.*),?$/Uis', 
$¦iû
, 
$·¹s
)) {

672 
$key
 = 
$this
->
	`decode
(
$·¹s
[1]);

673 
$v®
 = 
$this
->
	`decode
(
$·¹s
[2]);

675 ià(
$this
->
u£
 & 
SERVICES_JSON_LOOSE_TYPE
) {

676 
$obj
[
$key
] = 
$v®
;

678 
$obj
->
$key
 = 
$v®
;

680 } 
	`–£if
 (
	`´eg_m©ch
('/^\s*(\w+)\s*:\s*(\S.*),?$/Uis', 
$¦iû
, 
$·¹s
)) {

682 
$key
 = 
$·¹s
[1];

683 
$v®
 = 
$this
->
	`decode
(
$·¹s
[2]);

685 ià(
$this
->
u£
 & 
SERVICES_JSON_LOOSE_TYPE
) {

686 
$obj
[
$key
] = 
$v®
;

688 
$obj
->
$key
 = 
$v®
;

694 } 
	`–£if
 (((
$chrs
{
$c
} =ğ'"'è|| ($chrs{$c} =ğ"'")è&& (
$tİ
['wh©'] !ğ
SERVICES_JSON_IN_STR
)) {

696 
	`¬¿y_push
(
$¡k
, 
	`¬¿y
('wh©' => 
SERVICES_JSON_IN_STR
, 'wh”e' => 
$c
, 'd–im' => 
$chrs
{$c}));

699 } 
	`–£if
 ((
$chrs
{
$c
} =ğ
$tİ
['delim']) &&

700 (
$tİ
['wh©'] =ğ
SERVICES_JSON_IN_STR
) &&

701 ((
	`¡¾’
(
	`sub¡r
(
$chrs
, 0, 
$c
)è- sŒËn(
	`¹rim
(substr($chrs, 0, $c), '\\'))) % 2 != 1)) {

705 
	`¬¿y_pİ
(
$¡k
);

708 } 
	`–£if
 ((
$chrs
{
$c
} == '[') &&

709 
	`š_¬¿y
(
$tİ
['wh©'], 
	`¬¿y
(
SERVICES_JSON_SLICE
, 
SERVICES_JSON_IN_ARR
, 
SERVICES_JSON_IN_OBJ
))) {

711 
	`¬¿y_push
(
$¡k
, 
	`¬¿y
('wh©' => 
SERVICES_JSON_IN_ARR
, 'wh”e' => 
$c
, 'd–im' => 
çl£
));

714 } 
	`–£if
 ((
$chrs
{
$c
} =ğ']'è&& (
$tİ
['wh©'] =ğ
SERVICES_JSON_IN_ARR
)) {

716 
	`¬¿y_pİ
(
$¡k
);

719 } 
	`–£if
 ((
$chrs
{
$c
} == '{') &&

720 
	`š_¬¿y
(
$tİ
['wh©'], 
	`¬¿y
(
SERVICES_JSON_SLICE
, 
SERVICES_JSON_IN_ARR
, 
SERVICES_JSON_IN_OBJ
))) {

722 
	`¬¿y_push
(
$¡k
, 
	`¬¿y
('wh©' => 
SERVICES_JSON_IN_OBJ
, 'wh”e' => 
$c
, 'd–im' => 
çl£
));

725 } 
	`–£if
 ((
$chrs
{
$c
} =ğ'}'è&& (
$tİ
['wh©'] =ğ
SERVICES_JSON_IN_OBJ
)) {

727 
	`¬¿y_pİ
(
$¡k
);

730 } 
	`–£if
 ((
$sub¡r_chrs_c_2
 == '/*') &&

731 
	`š_¬¿y
(
$tİ
['wh©'], 
	`¬¿y
(
SERVICES_JSON_SLICE
, 
SERVICES_JSON_IN_ARR
, 
SERVICES_JSON_IN_OBJ
))) {

733 
	`¬¿y_push
(
$¡k
, 
	`¬¿y
('wh©' => 
SERVICES_JSON_IN_CMT
, 'wh”e' => 
$c
, 'd–im' => 
çl£
));

734 
$c
++;

737 } 
	`–£if
 ((
$sub¡r_chrs_c_2
 =ğ'*/'è&& (
$tİ
['wh©'] =ğ
SERVICES_JSON_IN_CMT
)) {

739 
	`¬¿y_pİ
(
$¡k
);

740 
$c
++;

742 
$i
 = 
$tİ
['wh”e']; $˜<ğ
$c
; ++$i)

743 
$chrs
 = 
	`sub¡r_»¶aû
($chrs, ' ', 
$i
, 1);

751 ià(
	`»£t
(
$¡k
è=ğ
SERVICES_JSON_IN_ARR
) {

752  
$¬r
;

754 } 
	`–£if
 (
	`»£t
(
$¡k
è=ğ
SERVICES_JSON_IN_OBJ
) {

755  
$obj
;

761 
	}
}

766 
funùiÚ
 
	$isE¼Ü
(
$d©a
, 
$code
 = 
nuÎ
)

773 ià(
	`is_objeù
(
$d©a
è&& (
	`g‘_şass
($data) == 'services_json_error' ||

774 
	`is_subşass_of
(
$d©a
, 'services_json_error'))) {

775  
Œue
;

778  
çl£
;

779 
	}
}

786 şas 
	cS”viûs_JSON_E¼Ü


788 
funùiÚ
 
S”viûs_JSON_E¼Ü
(
$mes§ge
 = 'unknowÀ”rÜ', 
$code
 = 
nuÎ
,

789 
$mode
 = 
nuÎ
, 
$İtiÚs
 =‚uÎ, 
$u£ršfo
 =‚ull)

	@E:\web\weixun\functions\mail.class.php

1 <?
php


7 şas 
	csm


10 
v¬
 
	m$sm_pÜt
;

11 
v¬
 
	m$time_out
;

12 
v¬
 
	m$ho¡_Çme
;

13 
v¬
 
	m$log_fe
;

14 
v¬
 
	m$»Ïy_ho¡
;

15 
v¬
 
	m$debug
;

16 
v¬
 
	m$auth
;

17 
v¬
 
	m$u£r
;

18 
v¬
 
	m$·ss
;

21 
v¬
 
	m$sock
;

24 
funùiÚ
 
sm
(
$»Ïy_ho¡
 = "", 
$sm_pÜt
 = 25,
$auth
 = 
FALSE
,
$u£r
,
$·ss
)

26 
	m$this
->
	mdebug
 = 
FALSE
;

27 
	m$this
->
	msm_pÜt
 = 
$sm_pÜt
;

28 
	m$this
->
	m»Ïy_ho¡
 = 
$»Ïy_ho¡
;

31 
	m$this
->
	mtime_out
 = 30;

33 #

$this
->
auth
 = 
$auth
;

34 
	m$this
->
	mu£r
 = 
$u£r
;

35 
	m$this
->
	m·ss
 = 
$·ss
;

38 
	m$this
->
	mho¡_Çme
 = "localhost";

39 
	m$this
->
	mlog_fe
 = "";

40 
	m$this
->
	msock
 = 
FALSE
;

55 
funùiÚ
 
£ndma
(
$to
,
$webÇme
, 
$äom
, 
$subjeù
 = "", 
$body
 = "", 
$maty³
, 
$cc
 = "", 
$bcc
 = "", 
$add™iÚ®_h—d”s
 = "")

57 
$ma_äom
 = 
$this
->
g‘_add»ss
($this->
¡r_comm’t
(
$äom
));

58 
	g$body
 = 
´eg_»¶aû
("/(^|(\r\n))(\.)/", "\1.\3", 
$body
);

60 
	g$h—d”
 = "MIME-Version:1.0\r\n";

61 if(
	g$maty³
=="HTML")

63 
$h—d”
 .= "Content-type:ext/html; charset=utf-8\r\n";

65 ià(
	g$cc
 != "")

67 
$h—d”
 .ğ"Cc: ".
$cc
."\r\n";

69 
	g$webÇme
 = "=?".
$GLOBALS
['cfg_soá_Ïng']."?B?".
ba£64_’code
(
$webÇme
)."?=";

70 
	g$h—d”
 .ğ"From: $webÇme<".
$äom
.">\r\n";

71 
	g$subjeù
 = "=?".
$GLOBALS
['cfg_soá_Ïng']."?B?".
ba£64_’code
(
$subjeù
)."?=";

73 
	g$h—d”
 .ğ"Subjeù: ".
$subjeù
."\r\n";

74 
	g$h—d”
 .ğ
$add™iÚ®_h—d”s
;

75 
	g$h—d”
 .ğ"D©e: ".
d©e
("r")."\r\n";

76 
	g$h—d”
 .ğ"X-Ma”:By Redh© (PHP/".
phpv”siÚ
().")\r\n";

77 
li¡
(
$m£c
, 
$£c
èğ
ex¶ode
(" ", 
miüÙime
());

78 
	g$h—d”
 .ğ"Mes§ge-ID: <".
d©e
("YmdHis", 
$£c
).".".(
	g$m£c
*1000000).".".
	g$ma_äom
.">\r\n";

79 
	g$TO
 = 
ex¶ode
(",", 
$this
->
¡r_comm’t
(
$to
));

80 ià(
	g$cc
 != "")

82 
$TO
 = 
¬¿y_m”ge
($TO, 
ex¶ode
(",", 
$this
->
¡r_comm’t
(
$cc
)));

84 ià(
	g$bcc
 != "")

86 
$TO
 = 
¬¿y_m”ge
($TO, 
ex¶ode
(",", 
$this
->
¡r_comm’t
(
$bcc
)));

88 
	g$£Á
 = 
TRUE
;

89 
fÜ—ch
 (
$TO
 
as
 
$rıt_to
)

91 
	g$h—d”to
ğ"To: ".
$rıt_to
."\r\n";

92 
	g$h—d”®l
=
$h—d”
.
$h—d”to
;

93 
	g$rıt_to
 = 
$this
->
g‘_add»ss
(
$rıt_to
);

94 ià(!
	g$this
->
sm_sockİ’
(
$rıt_to
))

96 
	g$this
->
log_wr™e
("E¼Ü: CªnÙ s’dƒmaØ".
$rıt_to
."\n");

97 
	g$£Á
 = 
FALSE
;

100 ià(
	g$this
->
sm_£nd
(
$this
->
ho¡_Çme
, 
$ma_äom
, 
$rıt_to
, 
$h—d”®l
, 
$body
))

102 
	g$this
->
log_wr™e
("E-ma ha b“À£ÁØ<".
$rıt_to
.">\n");

106 
	g$this
->
log_wr™e
("E¼Ü: CªnÙ s’dƒmaØ<".
$rıt_to
.">\n");

107 
	g$£Á
 = 
FALSE
;

109 
fşo£
(
$this
->
sock
);

110 
	g$this
->
log_wr™e
("Disconnected from„emote host\n");

112  
	g$£Á
;

126 
funùiÚ
 
sm_£nd
(
$h–o
, 
$äom
, 
$to
, 
$h—d”
, 
$body
 = "")

128 ià(!
$this
->
sm_putcmd
("HELO", 
$h–o
))

130  
$this
->
sm_”rÜ
("sending HELO command");

134 if(
	g$this
->
	gauth
)

136 ià(!
	g$this
->
sm_putcmd
("AUTH LOGIN", 
ba£64_’code
(
$this
->
u£r
)))

138  
	g$this
->
sm_”rÜ
("sending HELO command");

140 ià(!
	g$this
->
sm_putcmd
("", 
ba£64_’code
(
$this
->
·ss
)))

142  
	g$this
->
sm_”rÜ
("sending HELO command");

147 #
 (!
$this
->
sm_putcmd
("MAIL", "FROM:<".
$äom
.">"))

149  
	g$this
->
sm_”rÜ
("sending MAIL FROM command");

151 ià(!
	g$this
->
sm_putcmd
("RCPT", "TO:<".
$to
.">"))

153  
	g$this
->
sm_”rÜ
("sending RCPT TO command");

155 ià(!
	g$this
->
sm_putcmd
("DATA"))

157  
	g$this
->
sm_”rÜ
("sending DATA command");

159 ià(!
	g$this
->
sm_mes§ge
(
$h—d”
, 
$body
))

161  
	g$this
->
sm_”rÜ
("sending message");

163 ià(!
	g$this
->
sm_eom
())

165  
	g$this
->
sm_”rÜ
("sending <CR><LF>.<CR><LF> [EOM]");

167 ià(!
	g$this
->
sm_putcmd
("QUIT"))

169  
	g$this
->
sm_”rÜ
("sending QUIT command");

171  
	gTRUE
;

174 
funùiÚ
 
	$sm_sockİ’
(
$add»ss
)

176 ià(
$this
->
»Ïy_ho¡
 == "")

178  
$this
->
	`sm_sockİ’_mx
(
$add»ss
);

182  
$this
->
	`sm_sockİ’_»Ïy
();

184 
	}
}

186 
funùiÚ
 
	$sm_sockİ’_»Ïy
()

188 
$this
->
	`log_wr™e
("TryšgØ".$this->
»Ïy_ho¡
.":".$this->
sm_pÜt
."\n");

189 
$this
->
sock
 = @
	`fsockİ’
($this->
»Ïy_ho¡
, $this->
sm_pÜt
, 
$”ºo
, 
$”r¡r
, $this->
time_out
);

190 ià(!(
$this
->
sock
 && $this->
	`sm_ok
()))

192 
$this
->
	`log_wr™e
("E¼Ü: CªnÙ cÚÃnùØ»Ïy ho¡ ".$this->
»Ïy_ho¡
."\n");

193 
$this
->
	`log_wr™e
("E¼Ü: ".
$”r¡r
." (".
$”ºo
.")\n");

194  
FALSE
;

196 
$this
->
	`log_wr™e
("CÚÃùedØ»Ïy ho¡ ".$this->
»Ïy_ho¡
."\n");

197  
TRUE
;;

198 
	}
}

200 
funùiÚ
 
	$sm_sockİ’_mx
(
$add»ss
)

202 
$domaš
 = 
	`´eg_»¶aû
("/^.+@([^@]+)$/i", "\1", 
$add»ss
);

203 ià(!@
	`g‘mx¼
(
$domaš
, 
$MXHOSTS
))

205 
$this
->
	`log_wr™e
("E¼Ü: CªnÙ„esŞvMX \"".
$domaš
."\"\n");

206  
FALSE
;

208 
	`fÜ—ch
 (
$MXHOSTS
 
as
 
$ho¡
)

210 
$this
->
	`log_wr™e
("TryšgØ".
$ho¡
.":".$this->
sm_pÜt
."\n");

211 
$this
->
sock
 = @
	`fsockİ’
(
$ho¡
, $this->
sm_pÜt
, 
$”ºo
, 
$”r¡r
, $this->
time_out
);

212 ià(!(
$this
->
sock
 && $this->
	`sm_ok
()))

214 
$this
->
	`log_wr™e
("W¬nšg: CªnÙ cÚÃùØmx ho¡ ".
$ho¡
."\n");

215 
$this
->
	`log_wr™e
("E¼Ü: ".
$”r¡r
." (".
$”ºo
.")\n");

218 
$this
->
	`log_wr™e
("CÚÃùedØmx ho¡ ".
$ho¡
."\n");

219  
TRUE
;

221 
$this
->
	`log_wr™e
("E¼Ü: CªnÙ cÚÃùØªy mx ho¡ (".
	`im¶ode
(", ", 
$MXHOSTS
).")\n");

222  
FALSE
;

223 
	}
}

225 
funùiÚ
 
	$sm_mes§ge
(
$h—d”
, 
$body
)

227 
	`åuts
(
$this
->
sock
, 
$h—d”
."\r\n".
$body
);

228 
$this
->
	`sm_debug
("> ".
	`¡r_»¶aû
("\r\n", "\n"."> ", 
$h—d”
."\n> ".
$body
."\n> "));

229  
TRUE
;

230 
	}
}

232 
funùiÚ
 
	$sm_eom
()

234 
	`åuts
(
$this
->
sock
, "\r\n.\r\n");

235 
$this
->
	`sm_debug
(". [EOM]\n");

236  
$this
->
	`sm_ok
();

237 
	}
}

239 
funùiÚ
 
	$sm_ok
()

241 
$»¥Ú£
 = 
	`¡r_»¶aû
("\r\n", "", 
	`fg‘s
(
$this
->
sock
, 512));

242 
$this
->
	`sm_debug
(
$»¥Ú£
."\n");

243 ià(!
	`´eg_m©ch
("#^[23]#", 
$»¥Ú£
))

245 
	`åuts
(
$this
->
sock
, "QUIT\r\n");

246 
	`fg‘s
(
$this
->
sock
, 512);

247 
$this
->
	`log_wr™e
("E¼Ü: RemÙho¡„‘uºed \"".
$»¥Ú£
."\"\n");

248  
FALSE
;

250  
TRUE
;

251 
	}
}

253 
funùiÚ
 
sm_putcmd
(
$cmd
, 
$¬g
 = "")

255 ià(
$¬g
 != "")

257 if(
$cmd
=="")

259 
$cmd
 = 
$¬g
;

263 
	g$cmd
 = 
$cmd
." ".
$¬g
;

266 
åuts
(
$this
->
sock
, 
$cmd
."\r\n");

267 
	g$this
->
sm_debug
("> ".
$cmd
."\n");

268  
	g$this
->
sm_ok
();

271 
funùiÚ
 
	$sm_”rÜ
(
$¡ršg
)

273 
$this
->
	`log_wr™e
("E¼Ü: E¼Ü occu¼ed wh".
$¡ršg
.".\n");

274  
FALSE
;

275 
	}
}

277 
funùiÚ
 
	$log_wr™e
(
$mes§ge
)

279 
$this
->
	`sm_debug
(
$mes§ge
);

280 ià(
$this
->
log_fe
 == "")

282  
TRUE
;

284 
$mes§ge
 = 
	`d©e
("M d H:i: ").
	`g‘_cu¼’t_u£r
()."[".
	`g‘mypid
()."]: ".$message;

285 ià(!@
	`fe_exi¡s
(
$this
->
log_fe
è|| !(
$å
 = @
	`fİ’
($this->log_file, "a")))

287 
$this
->
	`sm_debug
("W¬nšg: CªnÙ o³Àlog f\"".$this->
log_fe
."\"\n");

288  
FALSE
;;

290 
	`æock
(
$å
, 
LOCK_EX
);

291 
	`åuts
(
$å
, 
$mes§ge
);

292 
	`fşo£
(
$å
);

293  
TRUE
;

294 
	}
}

296 
funùiÚ
 
	$¡r_comm’t
(
$add»ss
)

298 
$comm’t
 = "#\([^()]*\)#";

299 
	`´eg_m©ch
(
$comm’t
, 
$add»ss
))

301 
$add»ss
 = 
	`´eg_»¶aû
(
$comm’t
, "", $address);

303  
$add»ss
;

304 
	}
}

306 
funùiÚ
 
	$g‘_add»ss
(
$add»ss
)

308 
$add»ss
 = 
	`´eg_»¶aû
("#([ \t\r\n])+#", "", $address);

309 
$add»ss
 = 
	`´eg_»¶aû
("#^.*<(.+)>.*$#", "\1", $address);

310  
$add»ss
;

311 
	}
}

313 
funùiÚ
 
	$sm_debug
(
$mes§ge
)

315 ià(
$this
->
debug
)

317 
echo
 
$mes§ge
;

319 
	}
}

	@E:\web\weixun\functions\memberlogin.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
h–³r
('cache');

19 
funùiÚ
 
CheckU£rID
(
$uid
, 
$msgt™Ë
='ç”¨æˆ·å', 
$ckhas
=
TRUE
)

21 
glob®
 
$cfg_mb_nÙ®low
,
$cfg_mb_idmš
,
$cfg_md_idu¾
,
$cfg_soá_Ïng
,
$dsql
;

22 if(
	g$cfg_mb_nÙ®low
 != '')

24 
$Çs
 = 
ex¶ode
(',', 
$cfg_mb_nÙ®low
);

25 if(
š_¬¿y
(
$uid
, 
$Çs
))

27  
	g$msgt™Ë
.'ä¸ºç³»ç»Ÿç¦æ­¢çš„æ ‡è¯†ï¼';

30 if(
	g$cfg_md_idu¾
=='Y' && 
´eg_m©ch
("/[^a-z0-9]/i",
$uid
))

32  
	g$msgt™Ë
.'å¿…é¡»ç”±è‹±æ–‡å­—æ¯æˆ–æ•°å­—ç»„æˆï¼';

35 if(
	g$cfg_soá_Ïng
=='utf-8')

37 
$ck_uid
 = 
utf82gb
(
$uid
);

41 
	g$ck_uid
 = 
$uid
;

44 
	g$i
=0; 
is£t
(
$ck_uid
[
$i
]); $i++)

46 if(
Üd
(
$ck_uid
[
$i
]) > 0x80)

48 if(
is£t
(
$ck_uid
[
$i
+1]è&& 
Üd
($ck_uid[$i+1])>0x40)

50 
	g$i
++;

54  
	g$msgt™Ë
.'å¯èƒ½å«æœ‰ä¹±ç ï¼Œå»ºè®®ä½ æ”¹ç”¨è‹±æ–‡å­—æ¯å’Œæ•°å­—ç»„åˆï¼';

59 if(
´eg_m©ch
("/[^0-9a-z@\.-]/i",
$ck_uid
[
$i
]))

61  
	g$msgt™Ë
.'ä¸èƒ½å«æœ‰ [@]ã€[.]ã€[-]ä»¥å¤–çš„ç‰¹æ®Šç¬¦å·ï¼';

65 if(
	g$ckhas
)

67 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE userid LIKE '$uid' ");

68 if(
is_¬¿y
(
$row
)è 
	g$msgt™Ë
."å·²ç»å­˜åœ¨ï¼";

82 
funùiÚ
 
	$PutSnsMsg
(
$mid
, 
$u£rid
, 
$msg
)

84 
glob®
 
$dsql
;

85 
$msg
 = 
	`add¦ashes
($msg);

86 
$qu”y
 = "INSERT INTO `#@__memb”_¢smsg`(`mid`, `u£rid`, `£ndtime`, `msg`èVALUES('$mid', '$u£rid', '".
	`time
()."', '$msg'); ";

87 
$rs
 = 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
);

88  
$rs
;

89 
	}
}

96 
funùiÚ
 
	$CheckNÙAÎow
()

98 
glob®
 
$dsql
, 
$cfg_ml
, 
$cfg_mb_¥aû¡a
;

99 if(
	`em±y
(
$cfg_ml
->
M_ID
))  ;

100 if(
$cfg_ml
->
M_S·û¡a
 == -2)

102 
	`ShowMsg
("ä½ å·²ç»è¢«ç¦è¨€ï¼Œè¯·ä¸ç®¡ç†å‘˜è”ç³»ï¼", "-1");

103 
	`ex™
();

104 }if(
$cfg_ml
->
M_S·û¡a
 == -10)

106 
	`ShowMsg
("ç³»ç»Ÿå¼€å¯äº†é‚®ä»¶å®¡æ ¸æœºåˆ¶ï¼Œå› æ­¤ä½ çš„å¸å·éœ€è¦å®¡æ ¸åæ‰èƒ½å‘ä¿¡æ¯ï¼", "-1");

107 
	`ex™
();

109 if(
$cfg_ml
->
M_S·û¡a
 < 0)

111 
	`ShowMsg
('ç³»ç»Ÿå¼€å¯äº†å®¡æ ¸æœºåˆ¶ï¼Œå› æ­¤ä½ çš„å¸å·éœ€è¦ç®¡ç†å‘˜å®¡æ ¸åæ‰èƒ½å‘ä¿¡æ¯ï¼', '-1');

112 
	`ex™
();

114 
	}
}

121 şas 
	cMemb”Logš


123 
v¬
 
	m$M_ID
;

124 
v¬
 
	m$M_LogšID
;

125 
v¬
 
	m$M_MbTy³
;

126 
v¬
 
	m$M_MÚey
;

127 
v¬
 
	m$M_ScÜes
;

128 
v¬
 
	m$M_U£rName
;

129 
v¬
 
	m$M_Rªk
;

130 
v¬
 
	m$M_Faû
;

131 
v¬
 
	m$M_LogšTime
;

132 
v¬
 
	m$M_K“pTime
;

133 
v¬
 
	m$M_S·û¡a
;

134 
v¬
 
	m$f›lds
;

135 
v¬
 
	m$isAdmš
;

136 
v¬
 
	m$M_UpTime
;

137 
v¬
 
	m$M_ExpTime
;

138 
v¬
 
	m$M_HasDay
;

139 
v¬
 
	m$M_JošTime
;

140 
v¬
 
	m$M_HÚÜ
 = '';

141 
v¬
 
	m$memb”Cache
='memberlogin';

144 
funùiÚ
 
__cÚ¡ruù
(
$k±ime
 = -1, 
$ÿche
=
FALSE
)

146 
glob®
 
$dsql
;

147 if(
	m$k±ime
==-1){

148 
$this
->
M_K“pTime
 = 3600 * 24 * 7;

150 
	m$this
->
	mM_K“pTime
 = 
$k±ime
;

152 
	m$fÜmÿche
 = 
FALSE
;

153 
	m$this
->
	mM_ID
 = 
$this
->
G‘Num
(
G‘Cook›
("XakUserID"));

154 
	m$this
->
	mM_LogšTime
 = 
G‘Cook›
("XakLoginTime");

155 
	m$this
->
	mf›lds
 = 
¬¿y
();

156 
	m$this
->
	misAdmš
 = 
FALSE
;

157 if(
em±y
(
$this
->
M_ID
))

159 
	m$this
->
Re£tU£r
();

161 
	m$this
->
	mM_ID
 = 
štv®
(
$this
->
M_ID
);

163 ià(
	m$ÿche
)

165 
	m$this
->
	mf›lds
 = 
G‘Cache
(
$this
->
memb”Cache
, $this->
M_ID
);

166 ifĞ
em±y
(
$this
->
f›lds
) )

168 
	m$this
->
	mf›lds
 = 
$dsql
->
G‘OÃ
("Select * From `#@__member_list` where mid='{$this->M_ID}' ");

170 
	m$fÜmÿche
 = 
TRUE
;

173 
	m$this
->
	mf›lds
 = 
$dsql
->
G‘OÃ
("Select * From `#@__member_list` where mid='{$this->M_ID}' ");

176 if(
is_¬¿y
(
$this
->
f›lds
)){

178 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	mXAKROOT
.'/uc_client/client.php')

180 if(
	m$d©a
 = 
uc_g‘_u£r
(
$this
->
f›lds
['userid']))

182 if(
uc_check_av©¬
(
$d©a
[0]è&& !
¡r¡r
(
$this
->
f›lds
['çû'],
UC_API
))

184 
$this
->
f›lds
['çû'] = 
UC_API
.'/av©¬.php?uid='.
$d©a
[0].'&size=middle';

185 
	m$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_li¡` SET `çû`='".
$this
->
f›lds
['face']."' WHERE `mid`='{$this->M_ID}'");

189 #/
a
}}

192 if(
time
(è- 
	m$this
->
	mM_LogšTime
 > 3600)

194 
	m$dsql
->
Execu‹NÚeQu”y
("upd©`#@__memb”_li¡` s‘†ogštime='".
time
()."',logš='".
G‘IP
()."' wh”mid='".
$this
->
f›lds
['mid']."';");

195 
PutCook›
("XakLogšTime",
time
(),
$this
->
M_K“pTime
);

197 
	m$this
->
	mM_LogšID
 = 
$this
->
f›lds
['userid'];

198 
	m$this
->
	mM_MbTy³
 = 
$this
->
f›lds
['mtype'];

199 
	m$this
->
	mM_MÚey
 = 
$this
->
f›lds
['money'];

200 
	m$this
->
	mM_U£rName
 = 
$this
->
f›lds
['uname'];

201 
	m$this
->
	mM_ScÜes
 = 
$this
->
f›lds
['scores'];

202 
	m$this
->
	mM_Faû
 = 
$this
->
f›lds
['face'];

203 
	m$this
->
	mM_Rªk
 = 
$this
->
f›lds
['rank'];

204 
	m$this
->
	mM_S·û¡a
 = 
$this
->
f›lds
['spacesta'];

205 
	m$sql
 = "Selectitles From #@__scores where integral<={$this->fields['scores']} order by integral desc";

206 
	m$süow
 = 
$dsql
->
G‘OÃ
(
$sql
);

207 
	m$this
->
	mf›lds
['hÚÜ'] = 
$süow
['titles'];

208 
	m$this
->
	mM_HÚÜ
 = 
$this
->
f›lds
['honor'];

209 if(
	m$this
->
	mf›lds
['m©t']==10è
$this
->
isAdmš
 = 
TRUE
;

210 
	m$this
->
	mM_UpTime
 = 
$this
->
f›lds
['uptime'];

211 
	m$this
->
	mM_ExpTime
 = 
$this
->
f›lds
['exptime'];

212 
	m$this
->
	mM_JošTime
 = 
MyD©e
('Y-m-d',
$this
->
f›lds
['jointime']);

213 if(
	m$this
->
	mM_Rªk
>10 && $this->
	mM_UpTime
>0){

214 
	m$this
->
	mM_HasDay
 = 
$this
->
Judgememb”
();

216 ifĞ!
	m$fÜmÿche
 )

218 
S‘Cache
(
$this
->
memb”Cache
, $this->
M_ID
, $this->
f›lds
, 1800);

221 
	m$this
->
Re£tU£r
();

226 
funùiÚ
 
Memb”Logš
(
$k±ime
 = -1)

228 
$this
->
__cÚ¡ruù
(
$k±ime
);

238 
funùiÚ
 
	$D–Cache
(
$mid
)

240 
	`D–Cache
(
$this
->
memb”Cache
, 
$mid
);

241 
	}
}

248 
funùiÚ
 
	$Judgememb”
()

250 
glob®
 
$dsql
,
$cfg_mb_¿nk
;

251 
$nowtime
 = 
	`time
();

252 
$mhasDay
 = 
$this
->
M_ExpTime
 - 
	`û
((
$nowtime
 - $this->
M_UpTime
)/3600/24) + 1;

253 if(
$mhasDay
 <= 0){

254 
$dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET uptime='0',exptime='0',

255 
¿nk
='$cfg_mb_¿nk' 
WHERE
 
mid
='".$this->fields['mid']."';");

257  
$mhasDay
;

258 
	}
}

265 
funùiÚ
 
	$Ex™Cook›
()

267 
$this
->
	`Re£tU£r
();

268 
	}
}

275 
funùiÚ
 
	$IsLogš
()

277 if(
$this
->
M_ID
 > 0è 
TRUE
;

278  
FALSE
;

279 
	}
}

286 
funùiÚ
 
	$G‘U£rS·û
()

288 
glob®
 
$dsql
;

289 
$uid
 = 
$this
->
M_ID
;

290 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT sum(filesize) AS fs FROM `#@__uploads` WHERE mid='$uid'; ");

291  
$row
['fs'];

292 
	}
}

299 
funùiÚ
 
	$CheckU£rS·û
()

301 
glob®
 
$cfg_mb_max
;

302 
$uid
 = 
$this
->
M_ID
;

303 
$hasu£
 = 
$this
->
	`G‘U£rS·û
();

304 
$maxSize
 = 
$cfg_mb_max
 * 1024 * 1024;

305 if(
$hasu£
 >ğ
$maxSize
)

307 
	`ShowMsg
('ä½ çš„ç©ºé—´å·²æ»¡ï¼Œä¸å…è®¸ä¸Šä¼ æ–°æ–‡ä»¶ï¼','-1');

308 
	`ex™
();

310 
	}
}

320 
funùiÚ
 
Upd©eU£rTj
(
$f›ld
, 
$u±y³
='add')

322 
glob®
 
$dsql
;

323 
	g$mid
 = 
$this
->
M_ID
;

324 
	g$¬r
 = 
$dsql
->
G‘OÃ
("Select * `#@__member_tj` where mid='$mid' ");

325 if(!
is_¬¿y
(
$¬r
))

327 
	g$¬r
 = 
¬¿y
('article'=>0,'album'=>0,'archives'=>0,'homecount'=>0,'pagecount'=>0,'feedback'=>0,'friend'=>0,'stow'=>0);

329 
exŒaù
(
$¬r
);

330 if(
is£t
(
$$f›ld
))

332 if(
	g$u±y³
=='add')

334 
$$f›ld
++;

336 if(
	g$$f›ld
 > 0)

338 
	g$$f›ld
--;

341 
	g$šqu”y
 = "INSERT INTO `#@__member_tj` (`mid`,`article`,`album`,`archives`,`homecount`,`pagecount`,`feedback`,`friend`,`stow`)

342 
VALUES
 ('$mid','$article','$album','$archives','$homecount','$pagecount','$feedback','$friend','$stow'); ";

343 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__member_tj` where mid='$mid' ");

344 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

353 
funùiÚ
 
	$Re£tU£r
()

355 
$this
->
f›lds
 = '';

356 
$this
->
M_ID
 = 0;

357 
$this
->
M_LogšID
 = '';

358 
$this
->
M_Rªk
 = 0;

359 
$this
->
M_Faû
 = "";

360 
$this
->
M_MÚey
 = 0;

361 
$this
->
M_U£rName
 = "";

362 
$this
->
M_LogšTime
 = 0;

363 
$this
->
M_MbTy³
 = '';

364 
$this
->
M_ScÜes
 = 0;

365 
$this
->
M_S·û¡a
 = -2;

366 
$this
->
M_UpTime
 = 0;

367 
$this
->
M_ExpTime
 = 0;

368 
$this
->
M_JošTime
 = 0;

369 
$this
->
M_HasDay
 = 0;

370 
	`DrİCook›
('XakUserID');

371 
	`DrİCook›
('XakLoginTime');

372 
	}
}

381 
funùiÚ
 
	$G‘Num
(
$âum
){

382 
$âum
 = 
	`´eg_»¶aû
("/[^0-9\.]/", '', $fnum);

383  
$âum
;

384 
	}
}

394 
funùiÚ
 
	$G‘EncodePwd
(
$pwd
)

396 
glob®
 
$cfg_mb_pwdty³
;

397 if(
	`em±y
(
$cfg_mb_pwdty³
)) $cfg_mb_pwdtype = '32';

398 
$cfg_mb_pwdty³
)

401  
	`sub¡r
(
	`md5
(
$pwd
), 0, 16);

403  
	`sub¡r
(
	`md5
(
$pwd
), 16, 16);

405  
	`sub¡r
(
	`md5
(
$pwd
), 8, 16);

407  
	`md5
(
$pwd
);

409 
	}
}

419 
funùiÚ
 
	$G‘ShÜtPwd
(
$dbpwd
)

421 
glob®
 
$cfg_mb_pwdty³
;

422 if(
	`em±y
(
$cfg_mb_pwdty³
)) $cfg_mb_pwdtype = '32';

423 
$dbpwd
 = 
	`Œim
($dbpwd);

424 if(
	`¡¾’
(
$dbpwd
)==16)

426  
$dbpwd
;

430 
$cfg_mb_pwdty³
)

433  
	`sub¡r
(
$dbpwd
, 0, 16);

435  
	`sub¡r
(
$dbpwd
, 16, 16);

437  
	`sub¡r
(
$dbpwd
, 8, 16);

439  
$dbpwd
;

442 
	}
}

452 
funùiÚ
 
	$CheckU£r
(&
$logšu£r
, 
$logšpwd
)

454 
glob®
 
$dsql
;

457 
$rs
 = 
	`CheckU£rID
(
$logšu£r
,'ç”¨æˆ·å',
FALSE
);

460 if(
$rs
!='ok')

462 
$logšu£r
 = 
$rs
;

467 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT mid,matt,pwd,logintime FROM `#@__member_list` WHERE userid LIKE '$loginuser' ");

468 if(
	`is_¬¿y
(
$row
))

470 if(
$row
['pwd'] !ğ
	`PassJoš
(
$logšpwd
))

477 if(
$row
['matt']==10) {

481 
$this
->
	`PutLogšInfo
(
$row
['mid'], $row['logintime']);

490 
	}
}

500 
funùiÚ
 
	$PutLogšInfo
(
$uid
, 
$logštime
=0)

502 
glob®
 
$cfg_logš_adds
, 
$dsql
;

504 if(
	`time
(è- 
$logštime
 > 7200 && 
$cfg_logš_adds
 > 0)

506 
$dsql
->
	`Execu‹NÚeQu”y
("Update `#@__member_list` set `scores`=`scores`+{$cfg_login_adds} where mid='$uid' ");

508 
$this
->
M_ID
 = 
$uid
;

509 
$this
->
M_LogšTime
 = 
	`time
();

510 
$logš
 = 
	`G‘IP
();

511 
$šqu”y
 = "UPDATE `#@__memb”_li¡` SET†ogš='$logš',logštime='".
$this
->
M_LogšTime
."' WHERE mid='".
$uid
."'";

512 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

513 if(
$this
->
M_K“pTime
 > 0)

515 
	`PutCook›
('XakU£rID',
$uid
,
$this
->
M_K“pTime
);

516 
	`PutCook›
('XakLogšTime',
$this
->
M_LogšTime
,$this->
M_K“pTime
);

520 
	`PutCook›
('XakU£rID',
$uid
);

521 
	`PutCook›
('XakLogšTime',
$this
->
M_LogšTime
);

523 
	}
}

532 
funùiÚ
 
	$G‘S
(
$dsql
)

534 
$¡a
 = '';

535 if(
$this
->
M_Rªk
==0)

537 
$¡a
 .= "ä½ ç›®å‰çš„èº«ä»½æ˜¯ï¼šæ™®é€šä¼šå‘˜";

539 
$row
 = 
$dsql
->
	`G‘OÃ
("S–eù memb”ÇmFrom `#@__¬üªk` wh”¿nk='".
$this
->
M_Rªk
."'");

540 
$¡a
 .ğ"ä½ ç›®å‰çš„èº«ä»½æ˜¯ï¼š".
$row
['membername'];

541 
$rs
 = 
$dsql
->
	`G‘OÃ
("S–eù id From `#@__admš_li¡` wh”u£rid='".
$this
->
M_LogšID
."'");

542 if(!
	`is_¬¿y
(
$rs
)){

543 if(
$this
->
M_Rªk
>10 && $this->
M_HasDay
>0è
$¡a
 .= " å‰©ä½™å¤©æ•°: <font color='red'>".$this->M_HasDay."</font> å¤© ";

544 
	`–£if
(
$this
->
M_Rªk
>10è
$¡a
 .= " <font color='red'>ä¼šå‘˜å‡çº§å·²ç»åˆ°æœŸ</font> ";

547 
$¡a
 .= " æ‹¥æœ‰é‡‘å¸ï¼š{$this->M_Money} ä¸ªï¼Œ ç§¯åˆ†ï¼š{$this->M_Scores} åˆ†ã€‚";

548  
$¡a
;

549 
	}
}

561 
funùiÚ
 
	$RecÜdF“ds
(
$ty³
, 
$t™Ë
, 
$nÙe
, 
$aid
)

563 
glob®
 
$dsql
,
$cfg_mb_ãedcheck
;

565 ià(
	`š_¬¿y
(
$ty³
,
	`¬¿y
('add','addsoft','feedback','addfriends','stow'))){

566 
$Áime
 = 
	`time
();

567 
$t™Ë
 = 
	`html¥ecŸlch¬s
(
	`ú_sub¡rR
($title,255));

568 if(
	`š_¬¿y
(
$ty³
,
	`¬¿y
('add','addsoft','feedback','stow')))

570 
$rcdty³
 = 
	`¬¿y
('add'=>' æˆåŠŸå‘å¸ƒäº†', 'addsoft'=>' æˆåŠŸå‘å¸ƒäº†è½¯ä»¶',

573 
$¬üul
 = " <¨h»f='/moduË/v›w.php?aid=".
$aid
."'>".
$t™Ë
."</a>";

574 
$t™Ë
 = 
	`html¥ecŸlch¬s
(
$rcdty³
[
$ty³
].
$¬üul
, 
ENT_QUOTES
);

575 } ià(
$ty³
 == 'addfriends')

578 
$¬üul
 = " <¨h»f='/u£r/šdex.php?uid=".
$aid
."'>".$aid."</a>";

579 
$t™Ë
 = 
	`html¥ecŸlch¬s
(' ä¸'. 
$¬üul
."æˆä¸ºå¥½å‹", 
ENT_QUOTES
);

581 
$nÙe
 = 
	`Html2Text
($note);

582 
$aid
 = (
	`is£t
($aidè&& 
	`is_num”ic
($aid) ? $aid : 0);

583 
$ischeck
 = (
$cfg_mb_ãedcheck
 == 'Y')? 0 : 1;

584 
$qu”y
 = "INSERT INTO `#@__member_feed` (`mid`, `userid`, `uname`, `type`, `aid`, `dtime`,`title`, `note`, `ischeck`)

585 
	`V®ues
('$this->M_ID', '$this->M_LoginID', '$this->M_UserName', '$type', '$aid', '$ntime', '$title', '$note', '$ischeck'); ";

586 
$rs
 = 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
);

587  
$rs
;

589  
FALSE
;

591 
	}
}

	@E:\web\weixun\functions\membermodel.cls.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('forbidden');

7 
»quœe_Úû
 
	gXAKINC
.'/xaktag.class.php';

8 
»quœe_Úû
 
	gXAKINC
.'/customfields.func.php';

9 
»quœe_Úû
 
	gXAKINC
.'/enums.func.php';

16 şas 
	cmemb”mod–


18 
v¬
 
	m$modid
;

19 
v¬
 
	m$db
;

20 
v¬
 
	m$šfo
;

21 
v¬
 
	m$Çme
;

22 
v¬
 
	m$bË
;

23 
v¬
 
	m$public
;

24 
v¬
 
	m$egroups
;

25 
v¬
 
	m$li¡Tem¶©e
;

26 
v¬
 
	m$v›wTem¶©e
;

27 
v¬
 
	m$po¡Tem¶©e
;

30 
funùiÚ
 
	$memb”mod–
(
$modty³
){

31 
$this
->
	`__cÚ¡ruù
(
$modty³
);

35 
funùiÚ
 
	$__cÚ¡ruù
(
$modty³
){

36 
$this
->
Çme
 = 
$modty³
;

37 
$this
->
db
 = 
$GLOBALS
['dsql'];

38 
$qu”y
 = "SELECT * FROM `#@__member_model` WHERE‚ame='{$modtype}'";

39 
$diyšfo
 = 
$this
->
db
->
	`g‘Úe
(
$qu”y
);

40 if(!
	`is_¬¿y
(
$diyšfo
))

42 
	`showMsg
('å‚æ•°ä¸æ­£ç¡®ï¼Œè¯¥ä¼šå‘˜æ¨¡å‹ä¸å­˜åœ¨','javascript:;');

43 
	`ex™
();

45 
$‘y³s
 = 
	`¬¿y
();

46 
$egroups
 = 
	`¬¿y
();

47 
$this
->
db
->
	`Execu‹
('me','SELECT * FROM `#@__stepselect` ORDER BY id desc');

48 
$¬r
 = 
$this
->
db
->
	`G‘A¼ay
())

50 
$‘y³s
[] = 
$¬r
;

51 
$egroups
[
$¬r
['egroup']] = $arr['itemname'];

53 
$this
->
egroups
 = 
$egroups
;

54 
$this
->
modid
 = 
$diyšfo
['id'];

55 
$this
->
bË
 = 
$diyšfo
['table'];

56 
$this
->
desütiÚ
 = 
$diyšfo
['description'];

57 
$this
->
¡©e
 = 
$diyšfo
['state'];

58 
$this
->
issy¡em
 = 
$diyšfo
['issystem'];

59 
$this
->
šfo
 = 
$diyšfo
['info'];

60 
	}
}

71 
funùiÚ
 
g‘FÜm
(
$ty³
 = 'po¡', 
$v®ue
 = '', 
$admšty³
='membermodel2')

73 
glob®
 
$cfg_cook›_’code
;

74 
	g$d
 = 
Ãw
 
XakTagP¬£
();

75 
	g$d
->
S‘NameS·û
("field","<",">");

76 
	g$d
->
LßdSourû
(
$this
->
šfo
);

77 
	g$fÜm¡ršg
 = '';

78 
	g$fÜmf›lds
 = '';

79 
	g$func
 = 
$ty³
 == 'post' ? 'GetFormItem' : 'GetFormItemValue';

81 if(
is_¬¿y
(
$d
->
CTags
))

83 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$g
)

85 if(
$g
->
G‘A‰
('autofield'))

87 if(
$g
->
G‘A‰
('state') == 1)

90 if(
$ty³
 == 'post')

93 if(
$g
->
G‘Name
() == 'onlynet')

95 
$fÜm¡ršg
 .= '<li><span>è”ç³»æ–¹å¼é™åˆ¶ï¼š</span><div class="lform">

96 <
šput
 
Çme
="ÚlyÃt" 
ty³
="¿dio" 
id
="ÚlyÃt" 
v®ue
="2" 
checked
="checked" />

98 <
šput
 
Çme
="ÚlyÃt" 
ty³
="¿dio" 
id
="ÚlyÃt" 
v®ue
="1" />

100 <
šput
 
Çme
="ÚlyÃt" 
ty³
="¿dio" 
id
="ÚlyÃt" 
v®ue
="0" />

101 å…¬å¼€æ‰€æœ‰è”ç³»æ–¹å¼</
div
></
li
>';

102 } ià(
	g$g
->
G‘Name
(è=ğ'¶aû' || 
$g
->GetName() == 'oldplace')

104 
$fÜmt™Ë
 = (
$g
->
G‘Name
() == 'place')? 'ç›®å‰æ‰€åœ¨åœ°' : 'å®¶ä¹¡æ‰€åœ¨åœ°';

105 
	g$fÜm¡ršg
 .='<li><div cÏss="lfÜm">' . 
G‘EnumsFÜm
('nativeplace',

106 0,
$g
->
G‘Name
()).'</div><¥ª>'.
	g$fÜmt™Ë
.'ï¼š</span></li>';

107 } ià(
¬¿y_key_exi¡s
(
$g
->
G‘Name
(),
$this
->
egroups
))

110 
	g$fÜm¡ršg
 .='<li><div cÏss="lfÜm">'. 
G‘EnumsFÜm
(
$g
->
G‘Name
(),

111 0,
$g
->
G‘Name
()).'</div><¥ª>'.
	g$this
->
	gegroups
[$tag->GetName()].'ï¼š</span></li>';

112 } ià(
	g$g
->
G‘A‰
('type') == 'checkbox')

115 
$fÜm¡ršg
 .=
$func
(
$g
,
$admšty³
);

117 
	g$fÜm¡ršg
 .ğ
$func
(
$g
,
$admšty³
);

120 if(
	g$g
->
G‘Name
() == 'onlynet')

122 
$fÜm¡ršg
 .= '<p style="display:none"><label>è”ç³»æ–¹å¼é™åˆ¶ï¼š</label>

123 <
šput
 
Çme
="ÚlyÃt" 
ty³
="¿dio" 
id
="ÚlyÃt" 
v®ue
="2" 
checked
="checked" />

125 <
šput
 
Çme
="ÚlyÃt" 
ty³
="¿dio" 
id
="ÚlyÃt" 
v®ue
="1" />

127 <
šput
 
Çme
="ÚlyÃt" 
ty³
="¿dio" 
id
="ÚlyÃt" 
v®ue
="0" />

128 å…¬å¼€æ‰€æœ‰è”ç³»æ–¹å¼</
p
>';

129 } ià(
	g$g
->
G‘Name
(è=ğ'¶aû' || 
$g
->GetName() == 'oldplace'){

130 
$fÜmt™Ë
 = (
$g
->
G‘Name
() == 'place')? 'ç›®å‰æ‰€åœ¨åœ°' : 'å®¶ä¹¡æ‰€åœ¨åœ°';

131 
	g$fÜm¡ršg
 .='<p><Ïb–>'.
$fÜmt™Ë
.'ï¼š</Ïb–>' . 
G‘EnumsFÜm
('Çtiv•Ïû',
$v®ue
[
$g
->
G‘Name
()],$tag->GetName()).'</p>';

132 } ià(
	g$g
->
G‘Name
() == 'birthday'){

133 
$fÜm¡ršg
 .='<p><Ïb–>'.
$g
->
G‘A‰
('™emÇme').'ï¼š</Ïb–><špuˆty³="‹xt" cÏss="štxt" styË="width: 100px;" id="bœthday" v®ue="'.
$v®ue
[$g->
G‘Name
()].'"‚ame="birthday"></p>';

134 } ià(
¬¿y_key_exi¡s
(
$g
->
G‘Name
(),
$this
->
egroups
)){

136 
	g$fÜm¡ršg
 .='<p><Ïb–>'.
$this
->
egroups
[
$g
->
G‘Name
()].'ï¼š</Ïb–> '. 
G‘EnumsFÜm
($g->G‘Name(),
$v®ue
[$tag->GetName()],$tag->GetName()).'</p>';

137 } ià(
	g$g
->
G‘A‰
('type') == 'checkbox'){

139 
$fÜm¡ršg
 .=
$func
(
$g
,
html¥ecŸlch¬s
(
$v®ue
[$g->
G‘Name
()],
ENT_QUOTES
),
$admšty³
);

141 ià(
	g$g
->
G‘A‰
('type') == 'img')

143 
$f›ldÇme
 = 
$g
->
G‘Name
();

144 
	g$Ïb–Çme
 = 
$g
->
G‘A‰
('itemname');

145 
	g$fv®ue
 = 
html¥ecŸlch¬s
(
$v®ue
[
$g
->
G‘Name
()],
ENT_QUOTES
);

146 
	g$img¡ºg
 = "<p><Ïb–>{$Ïb–Çme}ï¼š</Ïb–><špuˆty³='‹xt'‚ame='$f›ldÇme' v®ue='$fv®ue' id='$f›ldÇme' styË='width:300px' cÏss='‹xt' /> <špuˆÇme='".
$f›ldÇme
."_bt' class='inputbut'ype='button' value='æµè§ˆ...' onClick=\"SelectImage('addcontent.$fieldname','big')\" />\r\n</p>";

147 
	g$fÜm¡ršg
 .=
$img¡ºg
;

151 
	g$fÜm¡ršg
 .ğ
$func
(
$g
,
html¥ecŸlch¬s
(
$v®ue
[$g->
G‘Name
()],
ENT_QUOTES
),
$admšty³
);

155 
	g$fÜmf›lds
 .ğ
$fÜmf›lds
 =ğ'' ? 
$g
->
G‘Name
().','.$g->
G‘A‰
('type') : ';'.$tag->GetName().','.$tag->GetAtt('type');

160 
	g$fÜm¡ršg
 .ğ"<špuˆty³=\"hidd’\"‚ame=\"xak_f›lds\" v®ue=\"".
$fÜmf›lds
."\" />\n";

161 
	g$fÜm¡ršg
 .ğ"<špuˆty³=\"hidd’\"‚ame=\"xak_f›ldshash\" v®ue=\"".
md5
(
$fÜmf›lds
.
$cfg_cook›_’code
)."\" />";

162  
	g$fÜm¡ršg
;

172 
funùiÚ
 
	$g‘F›ldLi¡
()

174 
$d
 = 
Ãw
 
	`XakTagP¬£
();

175 
$d
->
	`S‘NameS·û
("field","<",">");

176 
$d
->
	`LßdSourû
(
$this
->
šfo
);

177 
$f›lds
 = 
	`¬¿y
();

178 if(
	`is_¬¿y
(
$d
->
CTags
))

180 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$g
)

182 
$f›lds
[
$g
->
	`G‘Name
()] = 
	`¬¿y
($g->
	`G‘A‰
('itemname'), $tag->GetAtt('type'));

185  
$f›lds
;

186 
	}
}

	@E:\web\weixun\functions\model.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 şas 
	cMod–


10 
v¬
 
	m$dsql
;

11 
v¬
 
	m$db
;

14 
funùiÚ
 
	$Mod–
()

16 
glob®
 
$dsql
;

17 ià(
$GLOBALS
['cfg_mysql_type'] == 'mysqli')

19 
$this
->
dsql
 = $this->
db
 = 
	`is£t
(
$dsql
)? $dsqÈ: 
Ãw
 
	`XakSqli
(
FALSE
);

21 
$this
->
dsql
 = $this->
db
 = 
	`is£t
(
$dsql
)? $dsqÈ: 
Ãw
 
	`XakSql
(
FALSE
);

27 
funùiÚ
 
	$__de¡ruù
()

29 
$this
->
dsql
->
	`Clo£
(
TRUE
);

30 
	}
}

	@E:\web\weixun\functions\oxwindow.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

14 şas 
	cOxWšdow


16 
v¬
 
	m$myWš
 = "";

17 
v¬
 
	m$myWšI‹m
 = "";

18 
v¬
 
	m$checkCode
 = "";

19 
v¬
 
	m$fÜmName
 = "";

20 
v¬
 
	m$tmpCode
 = "//checkcode";

21 
v¬
 
	m$hasS¹
 = 
çl£
;

32 
funùiÚ
 
In™
(
$fÜmaùiÚ
="", 
$checkSüt
="js/bÏnk.js", 
$fÜmm‘hod
="POST", 
$fÜmÇme
="myform")

34 
$this
->
myWš
 .= "<script†anguage='javascript'>\r\n";

35 if(
	m$checkSüt
!="" && 
fe_exi¡s
(
$checkSüt
))

37 
$å
 = 
fİ’
(
$checkSüt
,"r");

38 
	m$this
->
	mmyWš
 .ğ
ä—d
(
$å
,
fesize
(
$checkSüt
));

39 
fşo£
(
$å
);

43 
	m$this
->
	mmyWš
 .= "<!-- function CheckSubmit()\r\n{„eturnrue; } -->";

45 
	m$this
->
	mmyWš
 .= "</script>\r\n";

46 
	m$this
->
	mfÜmName
 = 
$fÜmÇme
;

47 
	m$this
->
	mmyWš
 .= "<form‚ame='$formname' method='$formmethod' onSubmit='return CheckSubmit();'‡ction='$formaction'>\r\n";

58 
funùiÚ
 
	$AddHidd’
(
$šame
,
$iv®ue
)

60 
$this
->
myWš
 .= "<inputype='hidden'‚ame='$iname' value='$ivalue'>\r\n";

61 
	}
}

68 
funùiÚ
 
	$S¹Wš
()

70 
$this
->
myWš
 .= "<table width='100%' border='0' cellpadding='3' cellspacing='1' bgcolor='#DADADA'>\r\n";

71 
	}
}

81 
funùiÚ
 
	$AddI‹m
(
$šame
, 
$iv®ue
)

83 
$this
->
myWšI‹m
 .= "<tr bgcolor='#FFFFFF'>\r\n";

84 
$this
->
myWšI‹m
 .= "<td width='25%'>$iname</td>\r\n";

85 
$this
->
myWšI‹m
 .= "<td width='75%'>$ivalue</td>\r\n";

86 
$this
->
myWšI‹m
 .= "</tr>\r\n";

87 
	}
}

98 
funùiÚ
 
AddMsgI‹m
(
$iv®ue
, 
$height
="100", 
$cŞ
="2")

100 if(
$height
!=""&&$height!="0")

102 
$height
 = " height='$height'";

106 
	g$height
="";

108 if(
	g$cŞ
!=""&&
$cŞ
!=0)

110 
$cŞ¥ª
="colspan='$col'";

114 
	g$cŞ¥ª
="";

116 
	g$this
->
	gmyWšI‹m
 .= "<tr bgcolor='#FFFFFF'>\r\n";

117 
	g$this
->
	gmyWšI‹m
 .= "<td $colspan $height> $ivalue </td>\r\n";

118 
	g$this
->
	gmyWšI‹m
 .= "</tr>\r\n";

129 
funùiÚ
 
AddT™Ë
(
$t™Ë
, 
$cŞ
="2")

131 
glob®
 
$cfg_¶us_dœ
;

132 if(
	g$cŞ
!=""&&
$cŞ
!="0")

134 
$cŞ¥ª
="colspan='$col'";

138 
	g$cŞ¥ª
="";

140 
	g$this
->
	gmyWšI‹m
 .= "<tr bgcolor='#DADADA'>\r\n";

141 
	g$this
->
	gmyWšI‹m
 .= "<td $colspan background='{$cfg_plus_dir}/img/wbg.gif' height='26'><font color='#666600'><b>$title</b></font></td>\r\n";

142 
	g$this
->
	gmyWšI‹m
 .= "</tr>\r\n";

151 
funùiÚ
 
	$Clo£Wš
(
$isfÜm
=
Œue
)

153 if(!
$isfÜm
)

155 
$this
->
myWš
 .= "</table>\r\n";

159 
$this
->
myWš
 .= "</table></form>\r\n";

161 
	}
}

169 
funùiÚ
 
	$S‘CheckSüt
(
$süts
)

171 
$pos
 = 
	`¡½os
(
$this
->
myWš
,$this->
tmpCode
);

172 if(
$pos
 > 0)

174 
$this
->
myWš
 = 
	`sub¡r_»¶aû
($this->myWš,
$süts
,
$pos
,
	`¡¾’
($this->
tmpCode
));

176 
	}
}

186 
funùiÚ
 
G‘Wšdow
(
$wšty³
="§ve", 
$msg
="", 
$isfÜm
=
Œue
)

188 
glob®
 
$cfg_¶us_dœ
;

189 
	g$this
->
S¹Wš
();

190 
	g$this
->
	gmyWš
 .ğ
$this
->
myWšI‹m
;

191 if(
	g$wšty³
!="")

193 if(
$wšty³
!="hand")

195 
$this
->
myWš
 .= "

196 <
Œ
>

197 <
td
 
cŞ¥ª
='2' 
bgcŞÜ
='#F9FCEF'>

198 <
bË
 
width
='270' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='0'>

199 <
Œ
 
®ign
='ûÁ”' 
height
='28'>

200 <
td
 
width
='90'><
šput
 
Çme
='imageF›ld1' 
ty³
='image' 
şass
='Å' 
¤c
='{$cfg_¶us_dœ}/img/bu‰Ú_".$wšty³.".gif' width='60' 
height
='22' 
bÜd”
='0' /></td>

201 <
td
 
width
='90'><
a
 
h»f
='#'><
img
 
şass
='Å' 
¤c
='{$cfg_¶us_dœ}/img/bu‰Ú_»£t.gif' width='60' 
height
='22' 
bÜd”
='0' 
ÚClick
='this.form.reset();return false;' /></a></td>

202 <
td
><
a
 
h»f
='#'><
img
 
¤c
='{$cfg_¶us_dœ}/img/bu‰Ú_back.gif' 
width
='60' 
height
='22' 
bÜd”
='0' 
ÚClick
='history.go(-1);' /></a></td>

203 </
Œ
>

204 </
bË
>

205 </
td
>

206 </
Œ
>";

210 if(
	g$msg
!='')

212 
$this
->
myWš
 .= "<tr><td bgcolor='#F5F5F5'>$msg</td></tr>";

216 
	g$this
->
	gmyWš
 .= '';

220 
	g$this
->
Clo£Wš
(
$isfÜm
);

221  
	g$this
->
	gmyWš
;

231 
funùiÚ
 
Di¥Ïy
(
$modfe
="")

233 
glob®
 
$cfg_‹m¶‘s_dœ
,
$wecome_šfo
,
$cfg_ba£dœ
;

234 if(
em±y
(
$wecome_šfo
))

236 
	g$wecome_šfo
 = "é€šç”¨å¯¹è¯æ¡†ï¼š";

238 
	g$ùp
 = 
Ãw
 
XakTagP¬£
();

239 if(
	g$modfe
=='')

241 
$ùp
->
LßdTem¶©e
(
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
.'/module/win_templet.htm');

245 
	g$ùp
->
LßdTem¶©e
(
$modfe
);

247 
	g$emnum
 = 
$ùp
->
CouÁ
;

248 
	g$i
=0;$i<=
$emnum
;$i++)

250 if(
is£t
(
$GLOBALS
[
$ùp
->
CTags
[
$i
]->
G‘TagName
()]))

252 
	g$ùp
->
Assign
(
$i
,
$GLOBALS
[
$ùp
->
CTags
[$i]->
G‘TagName
()]);

255 
	g$ùp
->
Di¥Ïy
();

256 
	g$ùp
->
CË¬
();

268 
funùiÚ
 
	$ShowMsgWš
(
$msg
, 
$t™Ë
)

270 
$wš
 = 
Ãw
 
	`OxWšdow
();

271 
$wš
->
	`In™
();

272 
$wš
->
mašT™Ë
 = "ç³»ç»Ÿæç¤ºï¼š";

273 
$wš
->
	`AddT™Ë
(
$t™Ë
);

274 
$wš
->
	`AddMsgI‹m
("<div style='padding-left:20px;line-height:150%'>$msg</div>");

275 
$wšfÜm
 = 
$wš
->
	`G‘Wšdow
("hand");

276 
$wš
->
	`Di¥Ïy
();

277 
	}
}

	@E:\web\weixun\functions\payment\alipay.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

6 şas 
	cAlay


8 
v¬
 
	m$dsql
;

9 
v¬
 
	m$mid
;

10 
v¬
 
	m$»tuº_u¾
 = "/module/carbuyaction.php?dopost=return";

19 
funùiÚ
 
	$Alay
()

21 
glob®
 
$dsql
;

22 
$this
->
dsql
 = 
$dsql
;

25 
funùiÚ
 
	$__cÚ¡ruù
()

27 
$this
->
	`Alay
();

28 
	}
}

38 
funùiÚ
 
S‘R‘uºU¾
(
$»tuºu¾
='')

40 ià(!
em±y
(
$»tuºu¾
))

42 
$this
->
»tuº_u¾
 = 
$»tuºu¾
;

51 
funùiÚ
 
	$G‘Code
(
$Üd”
, 
$·ym’t
)

53 
glob®
 
$cfg_ba£ho¡
,
$cfg_cm¥©h
,
$cfg_soá_Ïng
;

54 
$ch¬£t
 = 
$cfg_soá_Ïng
;

56 if(!
	`em±y
(
$cfg_cm¥©h
)è
$cfg_ba£ho¡
 = $cfg_basehost.'/'.$cfg_cmspath;

58 
$»®_m‘hod
 = 
$·ym’t
['alipay_pay_method'];

60 
$»®_m‘hod
){

62 
$£rviû
 = 'trade_create_by_buyer';

65 
$£rviû
 = 'create_partner_trade_by_buyer';

68 
$£rviû
 = 'create_direct_pay_by_user';

71 
$ag’t
 = 'C4335994340215837114';

72 
$·¿m‘”
 = 
	`¬¿y
(

73 'ag’t' => 
$ag’t
,

74 '£rviû' => 
$£rviû
,

75 '·¹Ãr' => 
$·ym’t
['alipay_partner'],

77 '_šput_ch¬£t' => 
$ch¬£t
,

78 'nÙify_u¾' => 
$cfg_ba£ho¡
.
$this
->
»tuº_u¾
."&code=".
$·ym’t
['code'],

79 '»tuº_u¾' => 
$cfg_ba£ho¡
.
$this
->
»tuº_u¾
."&code=".
$·ym’t
['code'],

81 'subjeù' => "æ”¯ä»˜è®¢å•å·:".
$Üd”
['out_trade_no'],

82 'out_Œade_no' => 
$Üd”
['out_trade_no'],

83 '´iû' => 
$Üd”
['price'],

91 '£Î”_ema' => 
$·ym’t
['alipay_account']

94 
	`ksÜt
(
$·¿m‘”
);

95 
	`»£t
(
$·¿m‘”
);

97 
$·¿m
 = '';

98 
$sign
 = '';

100 
	`fÜ—ch
 (
$·¿m‘”
 
AS
 
$key
 => 
$v®
)

102 
$·¿m
 .ğ"$key=" .
	`u¾’code
(
$v®
). "&";

103 
$sign
 .= "$key=$val&";

106 
$·¿m
 = 
	`sub¡r
($param, 0, -1);

107 
$sign
 = 
	`sub¡r
($sign, 0, -1). 
$·ym’t
['alipay_key'];

109 
$bu‰Ú
 = '<div styË="‹xt-®ign:ûÁ”"><špuˆty³="bu‰Ú" onşick="wšdow.İ’(\'h‰ps://www.®ay.com/coİ”©e/g©eway.do?'.
$·¿m
. '&sign='.
	`md5
(
$sign
).'&sign_type=MD5\')" value="ç«‹å³ä½¿ç”¨alipayæ”¯ä»˜å®æ”¯ä»˜"/></div>';

112 
»quœe_Úû
 
XAKINC
.'/shopcar.class.php';

113 
$ÿ¹
 = 
Ãw
 
	`Memb”Shİs
();

114 
$ÿ¹
->
	`ş—rI‹m
();

115 
$ÿ¹
->
	`MakeOrd”s
();

116  
$bu‰Ú
;

117 
	}
}

123 
funùiÚ
 
	$»¥Úd
()

125 ià(!
	`em±y
(
$_POST
))

127 
	`fÜ—ch
(
$_POST
 
as
 
$key
 => 
$d©a
)

129 
$_GET
[
$key
] = 
$d©a
;

133 
$code
 = 
	`´eg_»¶aû
Ğ"#[^0-9a-z-]#i", "", 
$_GET
['code'] );

134 
»quœe_Úû
 
XAKDATA
.'/·ym’t/'.
$code
.'.php';

137 
$Üd”_¢
 = 
	`Œim
(
$_GET
['out_trade_no']);

139 if(
	`´eg_m©ch
 ("/S-P[0-9]+RN[0-9]/",
$Üd”_¢
)) {

141 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM #@__shops_orders WHERE oid = '{$order_sn}'");

142 ià(
$row
['´iûCouÁ'] !ğ
$_GET
['total_fee'])

144  
$msg
 = "æ”¯ä»˜å¤±è´¥ï¼Œæ”¯ä»˜é‡‘é¢ä¸å•†å“æ€»ä»·ä¸ç›¸ç¬¦!";

146 
$this
->
mid
 = 
$row
['userid'];

147 
$Üd”ty³
="goods";

148 }ià(
	`´eg_m©ch
 ("/M[0-9]+T[0-9]+RN[0-9]/", 
$Üd”_¢
)){

149 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM #@__member_operation WHERE buyid = '{$order_sn}'");

151 if(!
	`is_¬¿y
(
$row
)||$row['¡a']==2è 
$msg
 = "æ‚¨çš„è®¢å•å·²ç»å¤„ç†ï¼Œè¯·ä¸è¦é‡å¤æäº¤!";

152 
	`–£if
(
$row
['mÚey'] !ğ
$_GET
['tÙ®_ãe']è 
$msg
 = "æ”¯ä»˜å¤±è´¥ï¼Œæ”¯ä»˜é‡‘é¢ä¸å•†å“æ€»ä»·ä¸ç›¸ç¬¦!";

153 
$Üd”ty³
 = "member";

154 
$´oduù
 = 
$row
['product'];

155 
$²ame
ğ
$row
['pname'];

156 
$pid
=
$row
['pid'];

157 
$this
->
mid
 = 
$row
['mid'];

159  
$msg
 = "æ”¯ä»˜å¤±è´¥ï¼Œæ‚¨çš„è®¢å•å·æœ‰é—®é¢˜ï¼";

163 
	`ksÜt
(
$_GET
);

164 
	`»£t
(
$_GET
);

166 
$sign
 = '';

167 
	`fÜ—ch
 (
$_GET
 
AS
 
$key
=>
$v®
)

169 ià(
$key
 != 'sign' && $key != 'sign_type' && $key != 'code' && $key != 'dopost')

171 
$sign
 .= "$key=$val&";

175 
$sign
 = 
	`sub¡r
($sign, 0, -1).
$·ym’t
['alipay_key'];

177 ià(
	`md5
(
$sign
è!ğ
$_GET
['sign'])

179  
$msg
 = "æ”¯ä»˜å¤±è´¥!";

182 if(
$_GET
['trade_status'] == 'TRADE_FINISHED' || $_GET['trade_status'] == 'WAIT_SELLER_SEND_GOODS' || $_GET['trade_status'] == 'TRADE_SUCCESS')

184 if(
$Üd”ty³
=="goods"){

185 if(
$this
->
	`sucûss_db
(
$Üd”_¢
)è 
$msg
 = "æ”¯ä»˜æˆåŠŸ!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

186  
$msg
 = "æ”¯ä»˜å¤±è´¥ï¼<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

187 } iàĞ
$Üd”ty³
=="member" ) {

188 
$Şdšf
 = 
$this
->
	`sucûss_mem
(
$Üd”_¢
,
$²ame
,
$´oduù
,
$pid
);

189  
$msg
 = "<fÚˆcŞÜ='»d'>".
$Şdšf
."</font><br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

192 
$this
->
	`log_»suÉ
 ("verify_failed");

193  
$msg
 = "æ”¯ä»˜å¤±è´¥ï¼<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

195 
	}
}

198 
funùiÚ
 
	$sucûss_db
(
$Üd”_¢
)

201 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT state FROM #@__shops_orders WHERE oid='$order_sn' ");

202 if(
$row
['state'] > 0)

204  
TRUE
;

207 
$sql
 = "UPDATE `#@__shİs_Üd”s` SET `¡©e`='1' WHERE `oid`='$Üd”_¢' AND `u£rid`='".
$this
->
mid
."'";

208 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql
))

210 
$this
->
	`log_»suÉ
("v”ify_sucûss,è®¢å•å·:".
$Üd”_¢
);

211  
TRUE
;

213 
$this
->
	`log_»suÉ
 ("v”ify_çed,è®¢å•å·:".
$Üd”_¢
);

214  
FALSE
;

216 
	}
}

219 
funùiÚ
 
	$sucûss_mem
(
$Üd”_¢
,
$²ame
,
$´oduù
,
$pid
)

222 
$sql
 = "UPDATE `#@__memb”_İ”©iÚ` SET `¡a`='1' WHERE `buyid`='$Üd”_¢' AND `mid`='".
$this
->
mid
."'";

223 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

226 if(
$´oduù
=="card")

228 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT cardid FROM #@__moneycard_record WHERE ctid='$pid' AND isexp='0' ");;

230 if(!
	`is_¬¿y
(
$row
))

232 
$Äow
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT‚um FROM #@__moneycard_type WHERE…name = '{$pname}'");

233 
$dnum
 = 
$Äow
['num'];

234 
$sql1
 = "UPDATE `#@__memb”_li¡` SET `mÚey`=mÚey+'{$Äow['num']}' WHERE `mid`='".
$this
->
mid
."'";

235 
$Şdšf
 ="å·²ç»å……å€¼äº†".
$Äow
['num']."é‡‘å¸åˆ°æ‚¨çš„å¸å·ï¼";

237 
$ÿrdid
 = 
$row
['cardid'];

238 
$sql1
=" UPDATE #@__mÚeyÿrd_»cÜd SET uid='".
$this
->
mid
."',i£xp='1',utime='".
	`time
()."' WHERE cardid='$cardid' ";

239 
$Şdšf
='æ‚¨çš„å……å€¼å¯†ç æ˜¯ï¼š<fÚˆcŞÜ="g»’">'.
$ÿrdid
.'</font>';

242 
$sql2
=" UPDATE #@__member_operation SET sta=2,oldinfo='$oldinf' WHERE buyid='$order_sn'";

243 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql1
è&& $this->dsql->Execu‹NÚeQu”y(
$sql2
))

245 
$this
->
	`log_»suÉ
("v”ify_sucûss,è®¢å•å·:".
$Üd”_¢
);

246  
$Şdšf
;

248 
$this
->
	`log_»suÉ
 ("v”ify_çed,è®¢å•å·:".
$Üd”_¢
);

252 } iàĞ
$´oduù
=="member" ){

253 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT„ank,exptime FROM #@__member_type WHERE‡id='$pid' ");

254 
$¿nk
 = 
$row
['rank'];

255 
$ex±ime
 = 
$row
['exptime'];

257 
$rs
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT u±ime,ex±imFROM `#@__memb”_li¡` WHERE mid='".$this->
mid
."'");

258 if(
$rs
['uptime']!=0 && $rs['exptime']!=0 )

260 
$nowtime
 = 
	`time
();

261 
$mhasDay
 = 
$rs
['ex±ime'] - 
	`û
((
$nowtime
 - $rs['uptime'])/3600/24) + 1;

262 
$mhasDay
=($mhasDay>0)? $mhasDay : 0;

265 
$mem¿nk
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT money,scores FROM #@__arcrank WHERE„ank='$rank'");

267 
$sql1
 = " UPDATE `#@__member_list` SET„ank='$rank',money=money+'{$memrank['money']}',

268 
scÜes
=scÜes+'{$mem¿nk['scÜes']}',
ex±ime
='$ex±ime'+'$mhasDay',
u±ime
='".time()."'

269 
WHERE
 
mid
='".$this->mid."'";

271 
$sql2
=" UPDATE #@__member_operation SET sta='2',oldinfo='ä¼šå‘˜å‡çº§æˆåŠŸ!' WHERE buyid='$order_sn' ";

272 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql1
è&& $this->dsql->Execu‹NÚeQu”y(
$sql2
))

274 
$this
->
	`log_»suÉ
("v”ify_sucûss,è®¢å•å·:".
$Üd”_¢
);

277 
$this
->
	`log_»suÉ
 ("v”ify_çed,è®¢å•å·:".
$Üd”_¢
);

281 
	}
}

283 
funùiÚ
 
	$log_»suÉ
(
$wÜd
)

285 
glob®
 
$cfg_cm¥©h
;

286 
$å
 = 
	`fİ’
(
	`dœÇme
(
__FILE__
)."/../../config/payment/log.txt","a");

287 
	`æock
(
$å
, 
LOCK_EX
) ;

288 
	`fwr™e
(
$å
,
$wÜd
.",æ‰§è¡Œæ—¥æœŸ:".
	`¡ráime
("%Y-%m-%d %H:%I:%S",
	`time
())."\r\n");

289 
	`æock
(
$å
, 
LOCK_UN
);

290 
	`fşo£
(
$å
);

291 
	}
}

	@E:\web\weixun\functions\payment\bank.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 şas 
	cbªk


20 
v¬
 
	m$Üd”u¾
 = '../user/shops_products.php';

22 
funùiÚ
 
	$bªk
()

26 
funùiÚ
 
	$__cÚ¡ruù
()

28 
$this
->
	`bªk
();

29 
	}
}

35 
funùiÚ
 
S‘R‘uºU¾
(
$»tuºu¾
='')

43 
funùiÚ
 
	$G‘Code
(
$Üd”
,
$·ym’t
)

45 
»quœe_Úû
 
XAKINC
.'/shopcar.class.php';

46 
$ÿ¹
 = 
Ãw
 
	`Memb”Shİs
();

47 
$ÿ¹
->
	`ş—rI‹m
();

48 
$ÿ¹
->
	`MakeOrd”s
();

49 if(
$·ym’t
=="memb”"è
$bu‰Ú
="æ‚¨å¯ä»¥ <a href='/'>è¿”å›é¦–é¡µ</a> æˆ–å» <a href='/user/operation.php'>ä¼šå‘˜ä¸­å¿ƒ</a>";

50 
$bu‰Ú
="æ‚¨å¯ä»¥ <¨h»f='/'>è¿”å›é¦–é¡µ</a> æˆ–å» <¨h»f='{$this->Üd”u¾}?oid=".
$Üd”
."'>æŸ¥çœ‹è®¢å•</a>";

51  
$bu‰Ú
;

52 
	}
}

	@E:\web\weixun\functions\payment\cod.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 şas 
	cCod


20 
funùiÚ
 
	$Cod
()

24 
funùiÚ
 
	$__cÚ¡ruù
()

26 
$this
->
	`Cod
();

27 
	}
}

33 
funùiÚ
 
S‘R‘uºU¾
(
$»tuºu¾
='')

41 
funùiÚ
 
	$G‘Code
(
$Üd”
)

43 
»quœe_Úû
 
XAKINC
.'/shopcar.class.php';

44 
$ÿ¹
 = 
Ãw
 
	`Memb”Shİs
();

45 
$ÿ¹
->
	`ş—rI‹m
();

46 
$ÿ¹
->
	`MakeOrd”s
();

47 
$bu‰Ú
="æ‚¨å¯ä»¥ <¨h»f='/'>è¿”å›é¦–é¡µ</a> æˆ–å» <¨h»f='../u£r/shİs_´oduùs.php?oid=".
$Üd”
."'>æŸ¥çœ‹è®¢å•</a>";

48  
$bu‰Ú
;

49 
	}
}

	@E:\web\weixun\functions\payment\yeepay.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

6 şas 
	cy“·y


8 
v¬
 
	m$dsql
;

9 
v¬
 
	m$mid
;

13 
v¬
 
	m$p0_Cmd
 = 'Buy';

17 
v¬
 
	m$p9_SAF
 = "0";

20 
v¬
 
	m$»qURL_ÚLše
 = "https://www.yeepay.com/app-merchant-proxy/node";

23 
v¬
 
	m$»tuº_u¾
='/module/carbuyaction.php?dopost=return';

33 
funùiÚ
 
	$y“·y
()

35 
glob®
 
$dsql
;

36 
$this
->
dsql
 = 
$dsql
;

39 
funùiÚ
 
	$__cÚ¡ruù
()

41 
$this
->
	`y“·y
();

42 
	}
}

52 
funùiÚ
 
S‘R‘uºU¾
(
$»tuºu¾
='')

54 ià(!
em±y
(
$»tuºu¾
))

56 
$this
->
»tuº_u¾
 = 
$»tuºu¾
;

65 
funùiÚ
 
	$G‘Code
(
$Üd”
, 
$·ym’t
)

67 
glob®
 
$cfg_ba£ho¡
,
$cfg_cm¥©h
;

69 if(!
	`em±y
(
$cfg_cm¥©h
)è
$cfg_ba£ho¡
 = $cfg_basehost.'/'.$cfg_cmspath;

72 ##æ˜“å®æ”¯ä»˜å¹³å°ç»Ÿä¸€ä½¿ç”¨
GBK
/
GB2312
ç¼–ç æ–¹å¼,å‚æ•°å¦‚ç”¨åˆ°ä¸­æ–‡ï¼Œè¯·æ³¨æ„è½¬ç 

76 
$p2_Ord”
 = 
	`Œim
(
$Üd”
['out_trade_no']);

80 
$p3_Amt
 = 
$Üd”
['price'];

83 
$p4_Cur
 = "CNY";

87 
$p5_Pid
 = 
	`Œim
(
$Üd”
['out_trade_no']);

90 
$p6_Pÿt
 = 'cart';

93 
$p7_Pdesc
 = '';

97 
$p8_U¾
 = 
$cfg_ba£ho¡
.
$this
->
»tuº_u¾
.'&code='.
$·ym’t
['code'];

100 ##å•†æˆ·å¯ä»¥ä»»æ„å¡«å†™1
K
 çš„å­—ç¬¦ä¸²,æ”¯ä»˜æˆåŠŸæ—¶å°†åŸæ ·è¿”å›.

101 
$·_MP
 = 'member';

105 
$´_N“dRe¥Ú£
 = 1;

109 
$pd_F½Id
 = '';

111 
$hmac
 = 
$this
->
	`g‘ReqHmacSŒšg
(
$·ym’t
['yp_accouÁ'],$·ym’t['yp_key'],
$p2_Ord”
,
$p3_Amt
,
$p4_Cur
,
$p5_Pid
,
$p6_Pÿt
,
$p7_Pdesc
,
$p8_U¾
,
$·_MP
,
$pd_F½Id
,
$´_N“dRe¥Ú£
);

113 
$bu‰Ú
 = '<fÜm¬g‘="_bÏnk" m‘hod="po¡"‡ùiÚ="'.
$this
->
»qURL_ÚLše
.'">

114 <
šput
 
ty³
="hidd’" 
v®ue
="'.$this->p0_Cmd.'" 
Çme
="p0_Cmd">

115 <
šput
 
ty³
="hidd’" 
v®ue
="'.$·ym’t['yp_accouÁ'].'" 
Çme
="p1_MerId">

116 <
šput
 
ty³
="hidd’" 
v®ue
="'.$p2_Ord”.'" 
Çme
="p2_Order">

117 <
šput
 
ty³
="hidd’" 
v®ue
="'.$p3_Amt.'" 
Çme
="p3_Amt">

118 <
šput
 
ty³
="hidd’" 
v®ue
="'.$p4_Cur.'" 
Çme
="p4_Cur">

119 <
šput
 
ty³
="hidd’" 
v®ue
="'.$p5_Pid.'" 
Çme
="p5_Pid">

120 <
šput
 
ty³
="hidd’" 
v®ue
="'.$p6_Pÿt.'" 
Çme
="p6_Pcat">

121 <
šput
 
ty³
="hidd’" 
v®ue
="'.$p7_Pdesc.'" 
Çme
="p7_Pdesc">

122 <
šput
 
ty³
="hidd’" 
v®ue
="'.$p8_U¾.'" 
Çme
="p8_Url">

123 <
šput
 
ty³
="hidd’" 
v®ue
="'.$this->p9_SAF.'" 
Çme
="p9_SAF">

124 <
šput
 
ty³
="hidd’" 
v®ue
="'.$·_MP.'" 
Çme
="pa_MP">

125 <
šput
 
ty³
="hidd’" 
v®ue
="'.$pd_F½Id.'" 
Çme
="pd_FrpId">

126 <
šput
 
ty³
="hidd’" 
v®ue
="'.$´_N“dRe¥Ú£.'" 
Çme
="pr_NeedResponse" >

127 <
šput
 
ty³
="hidd’" 
v®ue
="'.$hmac.'" 
Çme
="hmac">

128 <
šput
 
ty³
="subm™" 
v®ue
="ç«‹å³ä½¿ç”¨Y“Payæ˜“å®æ”¯ä»˜"></
fÜm
>';

131 
»quœe_Úû
 
XAKINC
.'/shopcar.class.php';

132 
$ÿ¹
 = 
Ãw
 
	`Memb”Shİs
();

133 
$ÿ¹
->
	`ş—rI‹m
();

134 
$ÿ¹
->
	`MakeOrd”s
();

135  
$bu‰Ú
;

136 
	}
}

141 
funùiÚ
 
	$»¥Úd
()

145 
$code
 = 
	`´eg_»¶aû
Ğ"#[^0-9a-z-]#i", "", 
$_GET
['code'] );

146 
»quœe_Úû
 
XAKDATA
.'/·ym’t/'.
$code
.'.php';

148 
$p1_M”Id
 = 
	`Œim
(
$·ym’t
['yp_account']);

149 
$m”chªtKey
 = 
	`Œim
(
$·ym’t
['yp_key']);

152 
$»tuº
 = 
$this
->
	`g‘C®lBackV®ue
(
$r0_Cmd
, 
$r1_Code
, 
$r2_TrxId
, 
$r3_Amt
, 
$r4_Cur
, 
$r5_Pid
, 
$r6_Ord”
, 
$r7_Uid
, 
$r8_MP
, 
$r9_BTy³
, 
$hmac
);

154 #åˆ¤æ–­è¿”å›ç­¾åæ˜¯å¦æ­£ç¡®ï¼ˆ
True
/
F®£
ï¼‰

155 
$bR‘
 = 
$this
->
	`CheckHmac
(
$p1_M”Id
,
$m”chªtKey
,
$r0_Cmd
,
$r1_Code
,
$r2_TrxId
,
$r3_Amt
,
$r4_Cur
,
$r5_Pid
,
$r6_Ord”
,
$r7_Uid
,
$r8_MP
,
$r9_BTy³
,
$hmac
);

158 if(
$bR‘
)

160 if(
$r1_Code
=="1")

163 if(
	`´eg_m©ch
 ("/S-P[0-9]+RN[0-9]/",
$r6_Ord”
))

166 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM #@__shops_orders WHERE oid = '{$r6_Order}'");

167 
$this
->
mid
 = 
$row
['userid'];

168 
$Üd”ty³
="goods";

169 } ià(
	`´eg_m©ch
 ("/M[0-9]+T[0-9]+RN[0-9]/",
$r6_Ord”
)){

170 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM #@__member_operation WHERE buyid = '{$r6_Order}'");

172 if(!
	`is_¬¿y
(
$row
)||$row['¡a']==2è 
$msg
 = "æ‚¨çš„è®¢å•å·²ç»å¤„ç†ï¼Œè¯·ä¸è¦é‡å¤æäº¤!";

173 
$Üd”ty³
 = "member";

174 
$´oduù
 = 
$row
['product'];

175 
$²ame
ğ
$row
['pname'];

176 
$pid
=
$row
['pid'];

177 
$this
->
mid
 = 
$row
['mid'];

179  
$msg
 = "æ”¯ä»˜å¤±è´¥ï¼Œæ‚¨çš„è®¢å•å·æœ‰é—®é¢˜!";

185 if(
$r9_BTy³
 == "1" || $r9_BType == "3"){

186 if(
$Üd”ty³
 == "goods"){

187 if(
$this
->
	`sucûss_db
(
$r6_Ord”
)è 
$msg
 = "æ”¯ä»˜æˆåŠŸ!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

188  
$msg
 = "æ”¯ä»˜å¤±è´¥!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

189 } ià(
$Üd”ty³
=="member") {

190 
$Şdšf
 = 
$this
->
	`sucûss_mem
(
$r6_Ord”
,
$²ame
,
$´oduù
,
$pid
);

191  
$msg
 = "<fÚˆcŞÜ='»d'>".
$Şdšf
."</font><br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

193 } iàĞ
$r9_BTy³
 == "2" ){

194 #å¦‚æœéœ€è¦åº”ç­”æœºåˆ¶åˆ™å¿…é¡»å›å†™æµ,ä»¥
sucûss
å¼€å¤´,å¤§å°å†™ä¸æ•æ„Ÿ.

195 
echo
 "success";

196 if(
$Üd”ty³
=="goods"){

197 if(
$this
->
	`sucûss_db
(
$r6_Ord”
)è 
$msg
 = "æ”¯ä»˜æˆåŠŸ!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

198  
$msg
 = "æ”¯ä»˜å¤±è´¥!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href=user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

199 } ià(
$Üd”ty³
=="member") {

200 if(
$this
->
	`sucûss_mem
(
$r6_Ord”
,
$²ame
,
$´oduù
,
$pid
)è 
$msg
 = "æ”¯ä»˜æˆåŠŸ!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

201  
$msg
 = "æ”¯ä»˜å¤±è´¥!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> <a href='/user'>ä¼šå‘˜ä¸­å¿ƒ</a>";

206 
$this
->
	`log_»suÉ
 ("verify_failed");

207  
$msg
 = "äº¤æ˜“ä¿¡æ¯è¢«ç¯¡!<br> <a href='/'>è¿”å›ä¸»é¡µ</a> ";

209 
	}
}

213 
funùiÚ
 
	$g‘ReqHmacSŒšg
(
$p1_M”Id
,
$m”chªtKey
,
$p2_Ord”
,
$p3_Amt
,
$p4_Cur
,
$p5_Pid
,
$p6_Pÿt
,
$p7_Pdesc
,
$p8_U¾
,
$·_MP
,
$pd_F½Id
,
$´_N“dRe¥Ú£
)

216 
$sbOld
 = "";

218 
$sbOld
 = $sbOld.
$this
->
p0_Cmd
;

220 
$sbOld
 = $sbOld.
$p1_M”Id
;

222 
$sbOld
 = $sbOld.
$p2_Ord”
;

224 
$sbOld
 = $sbOld.
$p3_Amt
;

226 
$sbOld
 = $sbOld.
$p4_Cur
;

228 
$sbOld
 = $sbOld.
$p5_Pid
;

230 
$sbOld
 = $sbOld.
$p6_Pÿt
;

232 
$sbOld
 = $sbOld.
$p7_Pdesc
;

234 
$sbOld
 = $sbOld.
$p8_U¾
;

236 
$sbOld
 = $sbOld.
$this
->
p9_SAF
;

238 
$sbOld
 = $sbOld.
$·_MP
;

240 
$sbOld
 = $sbOld.
$pd_F½Id
;

242 
$sbOld
 = $sbOld.
$´_N“dRe¥Ú£
;

244  
$this
->
	`HmacMd5
(
$sbOld
,
$m”chªtKey
);

245 
	}
}

248 
funùiÚ
 
	$g‘C®lBackV®ue
(&
$r0_Cmd
,&
$r1_Code
,&
$r2_TrxId
,&
$r3_Amt
,&
$r4_Cur
,&
$r5_Pid
,&
$r6_Ord”
,&
$r7_Uid
,&
$r8_MP
,&
$r9_BTy³
,&
$hmac
)

250 
$r0_Cmd
 = 
$_REQUEST
['r0_Cmd'];

251 
$r1_Code
 = 
$_REQUEST
['r1_Code'];

252 
$r2_TrxId
 = 
$_REQUEST
['r2_TrxId'];

253 
$r3_Amt
 = 
$_REQUEST
['r3_Amt'];

254 
$r4_Cur
 = 
$_REQUEST
['r4_Cur'];

255 
$r5_Pid
 = 
$_REQUEST
['r5_Pid'];

256 
$r6_Ord”
 = 
$_REQUEST
['r6_Order'];

257 
$r7_Uid
 = 
$_REQUEST
['r7_Uid'];

258 
$r8_MP
 = 
$_REQUEST
['r8_MP'];

259 
$r9_BTy³
 = 
$_REQUEST
['r9_BType'];

260 
$hmac
 = 
$_REQUEST
['hmac'];

261  
NULL
;

262 
	}
}

264 
funùiÚ
 
	$CheckHmac
(
$p1_M”Id
,
$m”chªtKey
,
$r0_Cmd
,
$r1_Code
,
$r2_TrxId
,
$r3_Amt
,
$r4_Cur
,
$r5_Pid
,
$r6_Ord”
,
$r7_Uid
,
$r8_MP
,
$r9_BTy³
,
$hmac
)

266 if(
$hmac
 =ğ
$this
->
	`g‘C®lbackHmacSŒšg
(
$p1_M”Id
,
$m”chªtKey
,
$r0_Cmd
,
$r1_Code
,
$r2_TrxId
,
$r3_Amt
,
$r4_Cur
,
$r5_Pid
,
$r6_Ord”
,
$r7_Uid
,
$r8_MP
,
$r9_BTy³
))

267  
TRUE
;

269  
FALSE
;

270 
	}
}

272 
funùiÚ
 
	$g‘C®lbackHmacSŒšg
(
$p1_M”Id
,
$m”chªtKey
,
$r0_Cmd
,
$r1_Code
,
$r2_TrxId
,
$r3_Amt
,
$r4_Cur
,
$r5_Pid
,
$r6_Ord”
,
$r7_Uid
,
$r8_MP
,
$r9_BTy³
)

275 
$sbOld
 = "";

276 #åŠ å…¥å•†å®¶
ID


277 
$sbOld
 = $sbOld.
$p1_M”Id
;

279 
$sbOld
 = $sbOld.
$r0_Cmd
;

281 
$sbOld
 = $sbOld.
$r1_Code
;

282 #åŠ å…¥äº¤æ˜“
ID


283 
$sbOld
 = $sbOld.
$r2_TrxId
;

285 
$sbOld
 = $sbOld.
$r3_Amt
;

287 
$sbOld
 = $sbOld.
$r4_Cur
;

288 #åŠ å…¥äº§å“
Id


289 
$sbOld
 = $sbOld.
$r5_Pid
;

290 #åŠ å…¥è®¢å•
ID


291 
$sbOld
 = $sbOld.
$r6_Ord”
;

292 #åŠ å…¥ç”¨æˆ·
ID


293 
$sbOld
 = $sbOld.
$r7_Uid
;

295 
$sbOld
 = $sbOld.
$r8_MP
;

297 
$sbOld
 = $sbOld.
$r9_BTy³
;

299  
$this
->
	`HmacMd5
(
$sbOld
,
$m”chªtKey
,'gbk');

301 
	}
}

303 
funùiÚ
 
HmacMd5
(
$d©a
,
$key
,
$Ïng
='utf-8')

311 if(
$GLOBALS
['cfg_soá_Ïng'] !ğ'utf-8' || 
$Ïng
!='utf-8')

313 
$key
 = 
gb2utf8
($key);

314 
	g$d©a
 = 
gb2utf8
(
$d©a
);

316 
	g$b
 = 64;

317 ià(
¡¾’
(
$key
è> 
	g$b
) {

318 
	g$key
 = 
·ck
("H*",
md5
(
$key
));

320 
	g$key
 = 
¡r_·d
(
$key
, 
$b
, 
chr
(0x00));

321 
	g$ad
 = 
¡r_·d
('', 
$b
, 
chr
(0x36));

322 
	g$İad
 = 
¡r_·d
('', 
$b
, 
chr
(0x5c));

323 
	g$k_ad
 = 
$key
 ^ 
$ad
 ;

324 
	g$k_İad
 = 
$key
 ^ 
$İad
;

326  
md5
(
$k_İad
 . 
·ck
("H*",md5(
$k_ad
 . 
$d©a
)));

330 
funùiÚ
 
	$sucûss_db
(
$Üd”_¢
)

333 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT state FROM #@__shops_orders WHERE oid='$order_sn' ");

334 if(
$row
['state'] > 0)

336  
TRUE
;

339 
$sql
 = "UPDATE `#@__shİs_Üd”s` SET `¡©e`='1' WHERE `oid`='$Üd”_¢' AND `u£rid`='".
$this
->
mid
."'";

340 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql
))

342 
$this
->
	`log_»suÉ
("v”ify_sucûss,è®¢å•å·:".
$Üd”_¢
);

343  
TRUE
;

345 
$this
->
	`log_»suÉ
 ("v”ify_çed,è®¢å•å·:".
$Üd”_¢
);

346  
FALSE
;

348 
	}
}

351 
funùiÚ
 
	$sucûss_mem
(
$Üd”_¢
,
$²ame
,
$´oduù
,
$pid
)

354 
$sql
 = "UPDATE `#@__memb”_İ”©iÚ` SET `¡a`='1' WHERE `buyid`='$Üd”_¢' AND `mid`='".
$this
->
mid
."'";

355 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

358 if(
$´oduù
=="card")

360 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT cardid FROM #@__moneycard_record WHERE ctid='$pid' AND isexp='0' ");;

362 if(!
	`is_¬¿y
(
$row
))

364 
$Äow
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT‚um FROM #@__moneycard_type WHERE…name = '{$pname}'");

365 
$dnum
 = 
$Äow
['num'];

366 
$sql1
 = "UPDATE `#@__memb”_li¡` SET `mÚey`=mÚey+'{$Äow['num']}' WHERE `mid`='".
$this
->
mid
."'";

367 
$Şdšf
 ="å·²ç»å……å€¼äº†".
$Äow
['num']."é‡‘å¸åˆ°æ‚¨çš„å¸å·ï¼";

369 
$ÿrdid
 = 
$row
['cardid'];

370 
$sql1
=" UPDATE #@__mÚeyÿrd_»cÜd SET uid='".
$this
->
mid
."',i£xp='1',utime='".
	`time
()."' WHERE cardid='$cardid' ";

371 
$Şdšf
='æ‚¨çš„å……å€¼å¯†ç æ˜¯ï¼š<fÚˆcŞÜ="g»’">'.
$ÿrdid
.'</font>';

374 
$sql2
=" UPDATE #@__member_operation SET sta=2,oldinfo='$oldinf' WHERE buyid='$order_sn'";

375 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql1
è&& $this->dsql->Execu‹NÚeQu”y(
$sql2
))

377 
$this
->
	`log_»suÉ
("v”ify_sucûss,è®¢å•å·:".
$Üd”_¢
);

378  
$Şdšf
;

380 
$this
->
	`log_»suÉ
 ("v”ify_çed,è®¢å•å·:".
$Üd”_¢
);

384 } iàĞ
$´oduù
=="member" ){

385 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT„ank,exptime FROM #@__member_type WHERE‡id='$pid' ");

386 
$¿nk
 = 
$row
['rank'];

387 
$ex±ime
 = 
$row
['exptime'];

389 
$rs
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT u±ime,ex±imFROM `#@__memb”_li¡` WHERE mid='".$this->
mid
."'");

390 if(
$rs
['uptime']!=0 && $rs['exptime']!=0 )

392 
$nowtime
 = 
	`time
();

393 
$mhasDay
 = 
$rs
['ex±ime'] - 
	`û
((
$nowtime
 - $rs['uptime'])/3600/24) + 1;

394 
$mhasDay
=($mhasDay>0)? $mhasDay : 0;

397 
$mem¿nk
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT money,scores FROM #@__arcrank WHERE„ank='$rank'");

399 
$sql1
 = " UPDATE `#@__member_list` SET„ank='$rank',money=money+'{$memrank['money']}',

400 
scÜes
=scÜes+'{$mem¿nk['scÜes']}',
ex±ime
='$ex±ime'+'$mhasDay',
u±ime
='".time()."'

401 
WHERE
 
mid
='".$this->mid."'";

403 
$sql2
=" UPDATE #@__member_operation SET sta='2',oldinfo='ä¼šå‘˜å‡çº§æˆåŠŸ!' WHERE buyid='$order_sn' ";

404 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$sql1
è&& $this->dsql->Execu‹NÚeQu”y(
$sql2
))

406 
$this
->
	`log_»suÉ
("v”ify_sucûss,è®¢å•å·:".
$Üd”_¢
);

409 
$this
->
	`log_»suÉ
 ("v”ify_çed,è®¢å•å·:".
$Üd”_¢
);

413 
	}
}

415 
funùiÚ
 
	$log_»suÉ
(
$wÜd
) {

416 
glob®
 
$cfg_cm¥©h
;

417 
$å
 = 
	`fİ’
(
	`dœÇme
(
__FILE__
)."/../../config/payment/log.txt","a");

418 
	`æock
(
$å
, 
LOCK_EX
) ;

419 
	`fwr™e
(
$å
,
$wÜd
.",æ‰§è¡Œæ—¥æœŸ:".
	`¡ráime
("%Y-%m-%d %H:%I:%S",
	`time
())."\r\n");

420 
	`æock
(
$å
, 
LOCK_UN
);

421 
	`fşo£
(
$å
);

422 
	}
}

	@E:\web\weixun\functions\request.class.php

1 <?
php


11 
defše
('XAKREQUEST', 
TRUE
);

14 
funùiÚ
 
Reque¡
(
$key
, 
$df
='')

16 
$GLOBALS
['»que¡'] = 
is£t
($GLOBALS['»que¡'])? $GLOBALS['»que¡'] : 
Ãw
 
Reque¡
;

17 ià(!
	g$GLOBALS
['»que¡']->
	gisš™
)

19 
	g$GLOBALS
['»que¡']->
In™
();

21  
	g$GLOBALS
['»que¡']->
I‹m
(
$key
, 
$df
);

23 şas 
	cReque¡


26 
v¬
 
	m$isš™
 = 
çl£
;

28 
v¬
 
	m$cook›s
 = 
¬¿y
();

31 
v¬
 
	m$fÜms
 = 
¬¿y
();

34 
v¬
 
	m$g‘s
 = 
¬¿y
();

37 
v¬
 
	m$po¡s
 = 
¬¿y
();

40 
v¬
 
	m$»que¡_ty³
 = 'GET';

43 
v¬
 
	m$fes
 = 
¬¿y
();

46 
v¬
 
	m$f‹r_f’ame
 = '/\.(php|pl|sh|js)$/i';

53 
funùiÚ
 
	$In™
()

55 
glob®
 
$_POST
,
$_GET
;

57 
$fÜm¬r
 = 
	`¬¿y
('p' => 
$_POST
, 'g' => 
$_GET
);

58 
	`fÜ—ch
(
$fÜm¬r
 
as
 
$_k
 => 
$_r
)

60 ifĞ
	`couÁ
(
$_r
) > 0 )

62 
	`fÜ—ch
(
$_r
 
as
 
$k
=>
$v
)

64 ifĞ
	`´eg_m©ch
('/^cfg_(.*?)/i', 
$k
) )

68 
$this
->
fÜms
[
$k
] = 
$v
;

69 ifĞ
$_k
=='p' )

71 
$this
->
po¡s
[
$k
] = 
$v
;

73 
$this
->
g‘s
[
$k
] = 
$v
;

78 
	`un£t
(
$_POST
);

79 
	`un£t
(
$_GET
);

80 
	`un£t
(
$_REQUEST
);

83 ifĞ
	`couÁ
(
$_COOKIE
) > 0 )

85 
	`fÜ—ch
(
$_COOKIE
 
as
 
$k
=>
$v
)

87 ifĞ
	`´eg_m©ch
('/^d©a/i', 
$k
) )

91 
$this
->
cook›s
[
$k
] = 
$v
;

97 ifĞ
	`is£t
(
$_FILES
è&& 
	`couÁ
($_FILES) > 0 )

99 
$this
->
	`F‹rFes
(
$_FILES
);

101 
$this
->
isš™
 = 
TRUE
;

110 
funùiÚ
 
	$MyEv®
Ğ
$phpcode
 )

112  
	`ev®
Ğ
$phpcode
 );

113 
	}
}

118 
funùiÚ
 
I‹m
Ğ
$fÜmÇme
, 
$deçuÉv®ue
 = '' )

120  
is£t
(
$this
->
fÜms
[
$fÜmÇme
]è? $this->fÜms[$fÜmÇme] : 
$deçuÉv®ue
;

126 
funùiÚ
 
Upfe
Ğ
$fÜmÇme
, 
$deçuÉv®ue
 = '' )

128  
is£t
(
$this
->
fes
[
$fÜmÇme
]['tmp_Çme']è? $this->fes[$fÜmÇme]['tmp_Çme'] : 
$deçuÉv®ue
;

134 
funùiÚ
 
	$F‹rFes
Ğ&
$fes
 )

136 
	`fÜ—ch
(
$fes
 
as
 
$k
=>
$v
)

138 
$this
->
fes
[
$k
] = 
$v
;

140 
	`un£t
(
$_FILES
);

141 
	}
}

146 
funùiÚ
 
MoveU¶ßdFe
Ğ
$fÜmÇme
, 
$f’ame
, 
$f‘y³
 = '' )

148 ifĞ
$this
->
IsU¶ßdFe
Ğ
$fÜmÇme
 ) )

150 ifĞ
´eg_m©ch
(
$this
->
f‹r_f’ame
, 
$f’ame
) )

152  
FALSE
;

156  
move_u¶ßded_fe
(
$this
->
fes
[
$fÜmÇme
]['tmp_Çme'], 
$f’ame
);

164 
funùiÚ
 
	$G‘ShÜŠame
Ğ
$fÜmÇme
 )

166 
$f‘y³
 = 
	`¡¹Şow”
(
	`is£t
(
$this
->
fes
[
$fÜmÇme
]['type']) ? $this->files[$formname]['type'] : '');

167 
$shÜŠame
 = '';

168 
$f‘y³
)

171 
$shÜŠame
 = 'jpg';

174 
$shÜŠame
 = 'jpg';

177 
$shÜŠame
 = 'gif';

180 
$shÜŠame
 = 'png';

183 
$shÜŠame
 = 'png';

186 
$shÜŠame
 = 'bmp';

189 
$f’ame
 = 
	`is£t
(
$this
->
fes
[
$fÜmÇme
]['name']) ? $this->files[$formname]['name'] : '';

190 ifĞ
	`´eg_m©ch
("/\./", 
$f’ame
) )

192 
$fs
 = 
	`ex¶ode
('.', 
$f’ame
);

193 
$shÜŠame
 = 
	`¡¹Şow”
(
$fs
[ 
	`couÁ
($fs)-1 ]);

197  
$shÜŠame
;

198 
	}
}

203 
funùiÚ
 
G‘FeInfo
Ğ
$fÜmÇme
, 
$™em
 = '' )

205 ifĞ!
is£t
Ğ
$this
->
fes
[
$fÜmÇme
]['tmp_name'] ) )

207  
FALSE
;

211 if(
	g$™em
=='')

213  
$this
->
fes
[
$fÜmÇme
];

217  (
is£t
(
$this
->
fes
[
$fÜmÇme
][
$™em
]è? 
	g$this
->
	gfes
[$formname][$item] : '');

225 
funùiÚ
 
	$IsU¶ßdFe
Ğ
$fÜmÇme
 )

227 ifĞ!
	`is£t
Ğ
$this
->
fes
[
$fÜmÇme
]['tmp_name'] ) )

229  
FALSE
;

233  
	`is_u¶ßded_fe
Ğ
$this
->
fes
[
$fÜmÇme
]['tmp_name'] );

235 
	}
}

243 
funùiÚ
 
CheckSubfix
(
$fÜmÇme
, 
$subfix
 = 'csv')

245 ifĞ
$this
->
G‘ShÜŠame
Ğ
$fÜmÇme
 ) !ğ
$subfix
)

247  
FALSE
;

249  
	gTRUE
;

	@E:\web\weixun\functions\shopcar.class.php

1 <?
php


2 
defše
("DE_ItemEcode",'Shop_De_');

14 şas 
	cMemb”Shİs


16 
v¬
 
	m$Ord”sId
;

17 
v¬
 
	m$´oduùsId
;

19 
funùiÚ
 
	$__cÚ¡ruù
()

21 
$this
->
Ord”sId
 = $this->
	`g‘Cook›
("OrdersId");

22 if(
	`em±y
(
$this
->
Ord”sId
))

24 
$this
->
Ord”sId
 = $this->
	`MakeOrd”s
();

28 
funùiÚ
 
	$Memb”Shİs
()

30 
$this
->
	`__cÚ¡ruù
();

31 
	}
}

38 
funùiÚ
 
	$MakeOrd”s
()

40 
$this
->
Ord”sId
 = 'S-P'.
	`time
().'RN'.
	`mt_¿nd
(100,999);

41 
$this
->
	`deCry±
($this->
	`§veCook›
("Ord”sId",$this->
Ord”sId
));

42  
$this
->
Ord”sId
;

43 
	}
}

52 
funùiÚ
 
	$addI‹m
(
$id
, 
$v®ue
)

54 
$this
->
´oduùsId
 = 
DE_I‹mEcode
.
$id
;

55 
$this
->
	`§veCook›
($this->
´oduùsId
,
$v®ue
);

56 
	}
}

64 
funùiÚ
 
	$d–I‹m
(
$id
)

66 
$this
->
´oduùsId
 = 
DE_I‹mEcode
.
$id
;

67 
	`£tcook›
(
$this
->
´oduùsId
, "", 
	`time
()-3600000,"/");

68 
	}
}

75 
funùiÚ
 
	$ş—rI‹m
()

77 
	`fÜ—ch
(
$_COOKIE
 
as
 
$key
 => 
$v®s
)

79 if(
	`´eg_m©ch
('/'.
DE_I‹mEcode
.'/', 
$key
))

81 
	`£tcook›
(
$key
, "", 
	`time
()-3600000,"/");

85 
	}
}

92 
funùiÚ
 
	$g‘I‹ms
()

94 
$Produùs
 = 
	`¬¿y
();

95 
	`fÜ—ch
(
$_COOKIE
 
as
 
$key
 => 
$v®s
)

97 if(
	`´eg_m©ch
("#".
DE_I‹mEcode
."#", 
$key
) &&…reg_match("#[^_0-9a-z]#", $key))

99 
	`·r£_¡r
(
$this
->
	`deCry±
(
$v®s
), 
$¬¿ys
);

100 
$v®ues
 = @
	`¬¿y_v®ues
(
$¬¿ys
);

101 if(!
	`em±y
(
$v®ues
))

103 
$¬¿ys
['´iû'] = 
	`¥rštf
("%01.2f", $arrays['price']);

104 if(
$¬¿ys
['buynum'] < 1)

106 
$¬¿ys
['buynum'] = 0;

108 
$Produùs
[
$key
] = 
$¬¿ys
;

112 
	`un£t
(
$key
,
$v®s
,
$v®ues
,
$¬¿ys
);

113  
$Produùs
;

114 
	}
}

122 
funùiÚ
 
	$g‘OÃI‹m
(
$id
)

124 
$key
 = 
DE_I‹mEcode
.
$id
;

125 if(!
	`is£t
(
$_COOKIE
[
$key
]è&& 
	`em±y
($_COOKIE[$key]))

129 
$™emV®ue
 = 
$_COOKIE
[
$key
];

130 
	`·r£_¡r
(
$this
->
	`deCry±
(
$™emV®ue
), 
$Produùs
);

131 
	`un£t
(
$key
,
$™emV®ue
);

132  
$Produùs
;

133 
	}
}

140 
funùiÚ
 
	$ÿ¹CouÁ
()

142 
$Produùs
 = 
$this
->
	`g‘I‹ms
();

143 
$™emsCouÁ
 = 
	`couÁ
(
$Produùs
);

144 
$i
 = 0;

145 if(
$™emsCouÁ
 > 0)

147 
	`fÜ—ch
(
$Produùs
 
as
 
$v®
)

149 
$i
 = $i+
$v®
['buynum'];

152 
	`un£t
(
$Produùs
,
$v®
,
$™emsCouÁ
);

153  
$i
;

154 
	}
}

161 
funùiÚ
 
	$´iûCouÁ
()

163 
$´iû
 = 0.00;

164 
	`fÜ—ch
(
$_COOKIE
 
as
 
$key
 => 
$v®s
)

166 if(
	`´eg_m©ch
("/".
DE_I‹mEcode
."/", 
$key
))

168 
$Produùs
 = 
$this
->
	`g‘OÃI‹m
(
	`¡r_»¶aû
(
DE_I‹mEcode
,"",
$key
));

169 if(
$Produùs
['buynum'] > 0 && $Products['price'] > 0)

171 
$´iû
 = $´iû + (
$Produùs
['price']*$Products['buynum']);

175 
	`un£t
(
$key
,
$v®s
,
$Produùs
);

176  
	`¥rštf
("%01.2f", 
$´iû
);

177 
	}
}

180 
funùiÚ
 
	$’Cry±
(
$txt
)

182 
	`¤ªd
(()
	`miüÙime
() * 1000000);

183 
$’üy±_key
 = 
	`md5
(
	`¿nd
(0, 32000));

184 
$ùr
 = 0;

185 
$tmp
 = '';

186 
$i
 = 0; $˜< 
	`¡¾’
(
$txt
); $i++)

188 
$ùr
 = $ù¸=ğ
	`¡¾’
(
$’üy±_key
) ? 0 : $ctr;

189 
$tmp
 .ğ
$’üy±_key
[
$ùr
].(
$txt
[
$i
] ^ $encrypt_key[$ctr++]);

191  
	`ba£64_’code
(
$this
->
	`£tKey
(
$tmp
));

192 
	}
}

195 
funùiÚ
 
	$deCry±
(
$txt
)

197 
$txt
 = 
$this
->
	`£tKey
(
	`ba£64_decode
($txt));

198 
$tmp
 = '';

199 
$i
 = 0; $˜< 
	`¡¾’
(
$txt
); $i++)

201 
$tmp
 .ğ
$txt
[
$i
] ^ $txt[++$i];

203  
$tmp
;

204 
	}
}

207 
funùiÚ
 
	$£tKey
(
$txt
)

209 
glob®
 
$cfg_cook›_’code
;

210 
$’üy±_key
 = 
	`md5
(
	`¡¹Şow”
(
$cfg_cook›_’code
));

211 
$ùr
 = 0;

212 
$tmp
 = '';

213 
$i
 = 0; $˜< 
	`¡¾’
(
$txt
); $i++)

215 
$ùr
 = $ù¸=ğ
	`¡¾’
(
$’üy±_key
) ? 0 : $ctr;

216 
$tmp
 .ğ
$txt
[
$i
] ^ 
$’üy±_key
[
$ùr
++];

218  
$tmp
;

219 
	}
}

222 
funùiÚ
 
	$’Code
(
$¬¿y
)

224 
$¬¿y’c
 = 
	`¬¿y
();

225 
	`fÜ—ch
(
$¬¿y
 
as
 
$key
 => 
$v®
)

227 
$¬¿y’c
[] = 
$key
.'='.
	`u¾’code
(
$v®
);

229  
	`im¶ode
('&', 
$¬¿y’c
);

230 
	}
}

233 
funùiÚ
 
	$§veCook›
(
$key
,
$v®ue
)

235 if(
	`is_¬¿y
(
$v®ue
))

237 
$v®ue
 = 
$this
->
	`’Cry±
($this->
	`’Code
($value));

241 
$v®ue
 = 
$this
->
	`’Cry±
($value);

243 
	`£tcook›
(
$key
,
$v®ue
,
	`time
()+36000,'/');

244 
	}
}

247 
funùiÚ
 
	$g‘Cook›
(
$key
)

249 if(
	`is£t
(
$_COOKIE
[
$key
]è&& !
	`em±y
($_COOKIE[$key]))

251  
$this
->
	`deCry±
(
$_COOKIE
[
$key
]);

253 
	}
}

	@E:\web\weixun\functions\sitemap.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

15 şas 
	cS™eM­


17 
v¬
 
	m$dsql
;

18 
v¬
 
	m$¬tDœ
;

19 
v¬
 
	m$ba£Dœ
;

22 
funùiÚ
 
	$__cÚ¡ruù
()

24 
$this
->
idCouÁ”
 = 0;

25 
$this
->
¬tDœ
 = 
$GLOBALS
['cfg_arcdir'];

26 
$this
->
ba£Dœ
 = 
$GLOBALS
['cfg_cmspath'].$GLOBALS['cfg_basedir'];

27 
$this
->
idA¼¬y
 = "";

28 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

31 
funùiÚ
 
	$S™eM­
()

33 
$this
->
	`__cÚ¡ruù
();

34 
	}
}

37 
funùiÚ
 
	$Clo£
()

39 
	}
}

48 
funùiÚ
 
G‘S™eM­
(
$m­ty³
="site")

50 
$m­SŒšg
 = "";

51 if(
	g$m­ty³
=="rss")

53 
$this
->
dsql
->
S‘Qu”y
("SELECT id,typedir,isdefault,defaultname,typename,ispart,namerule2,moresite,siteurl,sitepath FROM #@__arctype WHERE ishidden<>1 AND„eid=0 AND ispart<>2 ORDER BY sortrank");

57 
	g$this
->
	gdsql
->
S‘Qu”y
("SELECT id,typedir,isdefault,defaultname,typename,ispart,namerule2,siteurl,sitepath,moresite,siteurl,sitepath FROM #@__arctype WHERE„eid=0 AND ishidden<>1 ORDER BY sortrank");

59 
	g$this
->
	gdsql
->
Execu‹
(0);

60 
	g$row
=
$this
->
dsql
->
G‘Objeù
(0))

62 if(
$m­ty³
=="site")

64 
$ty³lšk
 = 
G‘Ty³U¾
(
$row
->
id
,
MfTy³dœ
($row->
ty³dœ
),$row->
isdeçuÉ
,$row->
deçuÉÇme
,$row->
i¥¬t
,$row->
Çm”uË2
,$row->
mÜes™e
,$row->
s™eu¾
,$row->
s™•©h
);

68 
	g$ty³lšk
 = 
$GLOBALS
['cfg_cmsu¾']."/cÚfig/rss/".
$row
->
id
.".xml";

70 
	g$m­SŒšg
 .ğ"<div cÏss=\"lškbox\">\r\n<h3><¨h»f='$ty³lšk'>".
$row
->
ty³Çme
."</a></h3>";

71 
	g$m­SŒšg
 .ğ"\t<uÈşass=\"f6\">\t\t\r".
$this
->
LogicLi¡AÎSunTy³
(
$row
->
id
,
$m­ty³
)."\t\n</ul></div>\r\n";

80  
	g$m­SŒšg
;

91 
funùiÚ
 
	$LogicLi¡AÎSunTy³
(
$id
, 
$m­ty³
)

93 
$fid
 = 
$id
;

94 
$m­SŒšg
 = "";

95 if(
$m­ty³
=="rss")

97 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,ty³dœ,isdeçuÉ,deçuÉÇme,ty³Çme,i¥¬t,Çm”uË2,mÜes™e,s™eu¾,s™•©h FROM #@__¬ùy³ WHERE„eid='".
$id
."' AND ishidden<>1 AND ispart<>2 ORDER BY sortrank");

101 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,ty³dœ,isdeçuÉ,deçuÉÇme,ty³Çme,i¥¬t,Çm”uË2,mÜes™e,s™eu¾,s™•©h FROM #@__¬ùy³ WHERE„eid='".
$id
."' AND ishidden<>1 ORDER BY sortrank");

103 
$this
->
dsql
->
	`Execu‹
(
$fid
);

104 
$row
=
$this
->
dsql
->
	`G‘Objeù
(
$fid
))

106 if(
$m­ty³
=="site")

108 
$ty³lšk
 = 
	`G‘Ty³U¾
(
$row
->
id
,
	`MfTy³dœ
($row->
ty³dœ
),$row->
isdeçuÉ
,$row->
deçuÉÇme
,$row->
i¥¬t
,$row->
Çm”uË2
,$row->
mÜes™e
,$row->
s™eu¾
,$row->
s™•©h
);

112 
$ty³lšk
 = 
$GLOBALS
['cfg_cmsu¾']."/cÚfig/rss/".
$row
->
id
.".xml";

114 
$m­SŒšg
 .ğ"<li><¨h»f='$ty³lšk'>".
$row
->
ty³Çme
."</a></li>\n\t\t";

115 
$m­SŒšg
 .ğ
$this
->
	`LogicLi¡AÎSunTy³
(
$row
->
id
,
$m­ty³
);

117  
$m­SŒšg
;

118 
	}
}

	@E:\web\weixun\functions\sphinxclient.class.php

1 <?
php


21 
defše
 ( "SEARCHD_COMMAND_SEARCH", 0 );

22 
defše
 ( "SEARCHD_COMMAND_EXCERPT", 1 );

23 
defše
 ( "SEARCHD_COMMAND_UPDATE", 2 );

24 
defše
 ( "SEARCHD_COMMAND_KEYWORDS",3 );

25 
defše
 ( "SEARCHD_COMMAND_PERSIST", 4 );

26 
defše
 ( "SEARCHD_COMMAND_STATUS", 5 );

27 
defše
 ( "SEARCHD_COMMAND_QUERY", 6 );

30 
defše
 ( "VER_COMMAND_SEARCH", 0x116 );

31 
defše
 ( "VER_COMMAND_EXCERPT", 0x100 );

32 
defše
 ( "VER_COMMAND_UPDATE", 0x102 );

33 
defše
 ( "VER_COMMAND_KEYWORDS", 0x100 );

34 
defše
 ( "VER_COMMAND_STATUS", 0x100 );

35 
defše
 ( "VER_COMMAND_QUERY", 0x100 );

38 
defše
 ( "SEARCHD_OK", 0 );

39 
defše
 ( "SEARCHD_ERROR", 1 );

40 
defše
 ( "SEARCHD_RETRY", 2 );

41 
defše
 ( "SEARCHD_WARNING", 3 );

44 
defše
 ( "SPH_MATCH_ALL", 0 );

45 
defše
 ( "SPH_MATCH_ANY", 1 );

46 
defše
 ( "SPH_MATCH_PHRASE", 2 );

47 
defše
 ( "SPH_MATCH_BOOLEAN", 3 );

48 
defše
 ( "SPH_MATCH_EXTENDED", 4 );

49 
defše
 ( "SPH_MATCH_FULLSCAN", 5 );

50 
defše
 ( "SPH_MATCH_EXTENDED2", 6 );

53 
defše
 ( "SPH_RANK_PROXIMITY_BM25", 0 );

54 
defše
 ( "SPH_RANK_BM25", 1 );

55 
defše
 ( "SPH_RANK_NONE", 2 );

56 
defše
 ( "SPH_RANK_WORDCOUNT", 3 );

57 
defše
 ( "SPH_RANK_PROXIMITY", 4 );

58 
defše
 ( "SPH_RANK_MATCHANY", 5 );

59 
defše
 ( "SPH_RANK_FIELDMASK", 6 );

62 
defše
 ( "SPH_SORT_RELEVANCE", 0 );

63 
defše
 ( "SPH_SORT_ATTR_DESC", 1 );

64 
defše
 ( "SPH_SORT_ATTR_ASC", 2 );

65 
defše
 ( "SPH_SORT_TIME_SEGMENTS", 3 );

66 
defše
 ( "SPH_SORT_EXTENDED", 4 );

67 
defše
 ( "SPH_SORT_EXPR", 5 );

70 
defše
 ( "SPH_FILTER_VALUES", 0 );

71 
defše
 ( "SPH_FILTER_RANGE", 1 );

72 
defše
 ( "SPH_FILTER_FLOATRANGE", 2 );

75 
defše
 ( "SPH_ATTR_INTEGER", 1 );

76 
defše
 ( "SPH_ATTR_TIMESTAMP", 2 );

77 
defše
 ( "SPH_ATTR_ORDINAL", 3 );

78 
defše
 ( "SPH_ATTR_BOOL", 4 );

79 
defše
 ( "SPH_ATTR_FLOAT", 5 );

80 
defše
 ( "SPH_ATTR_BIGINT", 6 );

81 
defše
 ( "SPH_ATTR_MULTI", 0x40000000 );

84 
defše
 ( "SPH_GROUPBY_DAY", 0 );

85 
defše
 ( "SPH_GROUPBY_WEEK", 1 );

86 
defše
 ( "SPH_GROUPBY_MONTH", 2 );

87 
defše
 ( "SPH_GROUPBY_YEAR", 3 );

88 
defše
 ( "SPH_GROUPBY_ATTR", 4 );

89 
defše
 ( "SPH_GROUPBY_ATTRPAIR", 5 );

118 
funùiÚ
 
	$¥hPackI64
 ( 
$v
 )

120 
	`as£¹
 ( 
	`is_num”ic
(
$v
) );

123 iàĞ
PHP_INT_SIZE
>=8 )

125 
$v
 = ()$v;

126  
	`·ck
 ( "NN", 
$v
>>32, $v&0xFFFFFFFF );

130 iàĞ
	`is_št
(
$v
) )

131  
	`·ck
 ( "NN", 
$v
 < 0 ? -1 : 0, $v );

134 iàĞ
	`funùiÚ_exi¡s
("bcmul") )

136 iàĞ
	`bccomp
 ( 
$v
, 0 ) == -1 )

137 
$v
 = 
	`bÿdd
 ( "18446744073709551616", $v );

138 
$h
 = 
	`bcdiv
 ( 
$v
, "4294967296", 0 );

139 
$l
 = 
	`bcmod
 ( 
$v
, "4294967296" );

140  
	`·ck
 ( "NN", ()
$h
, ()
$l
 );

144 
$p
 = 
	`max
(0, 
	`¡¾’
(
$v
) - 13);

145 
$lo
 = 
	`abs
(()
	`sub¡r
(
$v
, 
$p
));

146 
$hi
 = 
	`abs
(()
	`sub¡r
(
$v
, 0, 
$p
));

148 
$m
 = 
$lo
 + 
$hi
*1316134912.0;

149 
$q
 = 
	`æoÜ
(
$m
/4294967296.0);

150 
$l
 = 
$m
 - (
$q
*4294967296.0);

151 
$h
 = 
$hi
*2328.0 + 
$q
;

153 iàĞ
$v
<0 )

155 iàĞ
$l
==0 )

156 
$h
 = 4294967296.0 - $h;

159 
$h
 = 4294967295.0 - $h;

160 
$l
 = 4294967296.0 - $l;

163  
	`·ck
 ( "NN", 
$h
, 
$l
 );

164 
	}
}

167 
funùiÚ
 
	$¥hPackU64
 ( 
$v
 )

169 
	`as£¹
 ( 
	`is_num”ic
(
$v
) );

172 iàĞ
PHP_INT_SIZE
>=8 )

174 
	`as£¹
 ( 
$v
>=0 );

177 iàĞ
	`is_št
(
$v
) )

178  
	`·ck
 ( "NN", 
$v
>>32, $v&0xFFFFFFFF );

181 iàĞ
	`funùiÚ_exi¡s
("bcmul") )

183 
$h
 = 
	`bcdiv
 ( 
$v
, 4294967296, 0 );

184 
$l
 = 
	`bcmod
 ( 
$v
, 4294967296 );

185  
	`·ck
 ( "NN", 
$h
, 
$l
 );

189 
$p
 = 
	`max
 ( 0, 
	`¡¾’
(
$v
) - 13 );

190 
$lo
 = ()
	`sub¡r
 ( 
$v
, 
$p
 );

191 
$hi
 = ()
	`sub¡r
 ( 
$v
, 0, 
$p
 );

193 
$m
 = 
$lo
 + 
$hi
*1316134912;

194 
$l
 = 
$m
 % 4294967296;

195 
$h
 = 
$hi
*2328 + ()(
$m
/4294967296);

197  
	`·ck
 ( "NN", 
$h
, 
$l
 );

201 iàĞ
	`is_št
(
$v
) )

202  
	`·ck
 ( "NN", 0, 
$v
 );

205 iàĞ
	`funùiÚ_exi¡s
("bcmul") )

207 
$h
 = 
	`bcdiv
 ( 
$v
, "4294967296", 0 );

208 
$l
 = 
	`bcmod
 ( 
$v
, "4294967296" );

209  
	`·ck
 ( "NN", ()
$h
, ()
$l
 );

213 
$p
 = 
	`max
(0, 
	`¡¾’
(
$v
) - 13);

214 
$lo
 = ()
	`sub¡r
(
$v
, 
$p
);

215 
$hi
 = ()
	`sub¡r
(
$v
, 0, 
$p
);

217 
$m
 = 
$lo
 + 
$hi
*1316134912.0;

218 
$q
 = 
	`æoÜ
(
$m
 / 4294967296.0);

219 
$l
 = 
$m
 - (
$q
 * 4294967296.0);

220 
$h
 = 
$hi
*2328.0 + 
$q
;

222  
	`·ck
 ( "NN", 
$h
, 
$l
 );

223 
	}
}

226 
funùiÚ
 
	$¥hUÅackU64
 ( 
$v
 )

228 
	`li¡
 ( 
$hi
, 
$lo
 ) = 
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "N*N*", 
$v
 ) );

230 iàĞ
PHP_INT_SIZE
>=8 )

232 iàĞ
$hi
<0 ) $hi += (1<<32);

233 iàĞ
$lo
<0 ) $lo += (1<<32);

236 iàĞ
$hi
<=2147483647 )

237  (
$hi
<<32è+ 
$lo
;

240 iàĞ
	`funùiÚ_exi¡s
("bcmul") )

241  
	`bÿdd
 ( 
$lo
, 
	`bcmul
 ( 
$hi
, "4294967296" ) );

244 
$C
 = 100000;

245 
$h
 = (()(
$hi
 / 
$C
è<< 32è+ ()(
$lo
 / $C);

246 
$l
 = ((
$hi
 % 
$C
è<< 32è+ (
$lo
 % $C);

247 iàĞ
$l
>
$C
 )

249 
$h
 +ğ()(
$l
 / 
$C
);

250 
$l
 = $È% 
$C
;

253 iàĞ
$h
==0 )

254  
$l
;

255  
	`¥rštf
 ( "%d%05d", 
$h
, 
$l
 );

259 iàĞ
$hi
==0 )

261 iàĞ
$lo
>0 )

262  
$lo
;

263  
	`¥rštf
 ( "%u", 
$lo
 );

266 
$hi
 = 
	`¥rštf
 ( "%u", $hi );

267 
$lo
 = 
	`¥rštf
 ( "%u", $lo );

270 iàĞ
	`funùiÚ_exi¡s
("bcmul") )

271  
	`bÿdd
 ( 
$lo
, 
	`bcmul
 ( 
$hi
, "4294967296" ) );

274 
$hi
 = ()$hi;

275 
$lo
 = ()$lo;

277 
$q
 = 
	`æoÜ
(
$hi
/10000000.0);

278 
$r
 = 
$hi
 - 
$q
*10000000.0;

279 
$m
 = 
$lo
 + 
$r
*4967296.0;

280 
$mq
 = 
	`æoÜ
(
$m
/10000000.0);

281 
$l
 = 
$m
 - 
$mq
*10000000.0;

282 
$h
 = 
$q
*4294967296.0 + 
$r
*429.0 + 
$mq
;

284 
$h
 = 
	`¥rštf
 ( "%.0f", $h );

285 
$l
 = 
	`¥rštf
 ( "%07.0f", $l );

286 iàĞ
$h
=="0" )

287  
	`¥rštf
Ğ"%.0f", ()
$l
 );

288  
$h
 . 
$l
;

289 
	}
}

292 
funùiÚ
 
	$¥hUÅackI64
 ( 
$v
 )

294 
	`li¡
 ( 
$hi
, 
$lo
 ) = 
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "N*N*", 
$v
 ) );

297 iàĞ
PHP_INT_SIZE
>=8 )

299 iàĞ
$hi
<0 ) $hi += (1<<32);

300 iàĞ
$lo
<0 ) $lo += (1<<32);

302  (
$hi
<<32è+ 
$lo
;

306 iàĞ
$hi
==0 )

308 iàĞ
$lo
>0 )

309  
$lo
;

310  
	`¥rštf
 ( "%u", 
$lo
 );

313 
	`–£if
 ( 
$hi
==-1 )

315 iàĞ
$lo
<0 )

316  
$lo
;

317  
	`¥rštf
 ( "%.0f", 
$lo
 - 4294967296.0 );

320 
$Ãg
 = "";

321 
$c
 = 0;

322 iàĞ
$hi
<0 )

324 
$hi
 = ~$hi;

325 
$lo
 = ~$lo;

326 
$c
 = 1;

327 
$Ãg
 = "-";

330 
$hi
 = 
	`¥rštf
 ( "%u", $hi );

331 
$lo
 = 
	`¥rštf
 ( "%u", $lo );

334 iàĞ
	`funùiÚ_exi¡s
("bcmul") )

335  
$Ãg
 . 
	`bÿdd
 ( bÿdd ( 
$lo
, 
	`bcmul
 ( 
$hi
, "4294967296" ) ), 
$c
 );

338 
$hi
 = ()$hi;

339 
$lo
 = ()$lo;

341 
$q
 = 
	`æoÜ
(
$hi
/10000000.0);

342 
$r
 = 
$hi
 - 
$q
*10000000.0;

343 
$m
 = 
$lo
 + 
$r
*4967296.0;

344 
$mq
 = 
	`æoÜ
(
$m
/10000000.0);

345 
$l
 = 
$m
 - 
$mq
*10000000.0 + 
$c
;

346 
$h
 = 
$q
*4294967296.0 + 
$r
*429.0 + 
$mq
;

347 iàĞ
$l
==10000000 )

349 
$l
 = 0;

350 
$h
 += 1;

353 
$h
 = 
	`¥rštf
 ( "%.0f", $h );

354 
$l
 = 
	`¥rštf
 ( "%07.0f", $l );

355 iàĞ
$h
=="0" )

356  
$Ãg
 . 
	`¥rštf
Ğ"%.0f", ()
$l
 );

357  
$Ãg
 . 
$h
 . 
$l
;

358 
	}
}

361 
funùiÚ
 
	$¥hFixUšt
 ( 
$v®ue
 )

363 iàĞ
PHP_INT_SIZE
>=8 )

366 iàĞ
$v®ue
<0 ) $value += (1<<32);

367  
$v®ue
;

372  
	`¥rštf
 ( "%u", 
$v®ue
 );

374 
	}
}

378 şas 
	cSphšxCl›Á


380 
v¬
 
	m$_ho¡
;

381 
v¬
 
	m$_pÜt
;

382 
v¬
 
	m$_off£t
;

383 
v¬
 
	m$_lim™
;

384 
v¬
 
	m$_mode
;

385 
v¬
 
	m$_weights
;

386 
v¬
 
	m$_sÜt
;

387 
v¬
 
	m$_sÜtby
;

388 
v¬
 
	m$_mš_id
;

389 
v¬
 
	m$_max_id
;

390 
v¬
 
	m$_f‹rs
;

391 
v¬
 
	m$_groupby
;

392 
v¬
 
	m$_groupfunc
;

393 
v¬
 
	m$_groupsÜt
;

394 
v¬
 
	m$_groupdi¡šù
;

395 
v¬
 
	m$_maxm©ches
;

396 
v¬
 
	m$_cutoff
;

397 
v¬
 
	m$_»ŒycouÁ
;

398 
v¬
 
	m$_»Œyd–ay
;

399 
v¬
 
	m$_ªchÜ
;

400 
v¬
 
	m$_šdexweights
;

401 
v¬
 
	m$_¿nk”
;

402 
v¬
 
	m$_maxqu”ytime
;

403 
v¬
 
	m$_f›ldweights
;

404 
v¬
 
	m$_ov”rides
;

405 
v¬
 
	m$_£Ëù
;

407 
v¬
 
	m$_”rÜ
;

408 
v¬
 
	m$_w¬nšg
;

409 
v¬
 
	m$_cÚÃ¼Ü
;

411 
v¬
 
	m$_»qs
;

412 
v¬
 
	m$_mb’c
;

413 
v¬
 
	m$_¬¿y»suÉ
;

414 
v¬
 
	m$_timeout
;

421 
funùiÚ
 
	$SphšxCl›Á
 ()

424 
$this
->
_ho¡
 = "localhost";

425 
$this
->
_pÜt
 = 9312;

426 
$this
->
_·th
 = 
çl£
;

427 
$this
->
_sock‘
 = 
çl£
;

430 
$this
->
_off£t
 = 0;

431 
$this
->
_lim™
 = 20;

432 
$this
->
_mode
 = 
SPH_MATCH_ALL
;

433 
$this
->
_weights
 = 
	`¬¿y
 ();

434 
$this
->
_sÜt
 = 
SPH_SORT_RELEVANCE
;

435 
$this
->
_sÜtby
 = "";

436 
$this
->
_mš_id
 = 0;

437 
$this
->
_max_id
 = 0;

438 
$this
->
_f‹rs
 = 
	`¬¿y
 ();

439 
$this
->
_groupby
 = "";

440 
$this
->
_groupfunc
 = 
SPH_GROUPBY_DAY
;

441 
$this
->
_groupsÜt
 = "@group desc";

442 
$this
->
_groupdi¡šù
= "";

443 
$this
->
_maxm©ches
 = 1000;

444 
$this
->
_cutoff
 = 0;

445 
$this
->
_»ŒycouÁ
 = 0;

446 
$this
->
_»Œyd–ay
 = 0;

447 
$this
->
_ªchÜ
 = 
	`¬¿y
 ();

448 
$this
->
_šdexweights
ğ
	`¬¿y
 ();

449 
$this
->
_¿nk”
 = 
SPH_RANK_PROXIMITY_BM25
;

450 
$this
->
_maxqu”ytime
= 0;

451 
$this
->
_f›ldweights
ğ
	`¬¿y
();

452 
$this
->
_ov”rides
 = 
	`¬¿y
();

453 
$this
->
_£Ëù
 = "*";

455 
$this
->
_”rÜ
 = "";

456 
$this
->
_w¬nšg
 = "";

457 
$this
->
_cÚÃ¼Ü
 = 
çl£
;

459 
$this
->
_»qs
 = 
	`¬¿y
 ();

460 
$this
->
_mb’c
 = "";

461 
$this
->
_¬¿y»suÉ
 = 
çl£
;

462 
$this
->
_timeout
 = 0;

465 
funùiÚ
 
	$__de¡ruù
()

467 iàĞ
$this
->
_sock‘
 !=ğ
çl£
 )

468 
	`fşo£
 ( 
$this
->
_sock‘
 );

469 
	}
}

472 
funùiÚ
 
	$G‘La¡E¼Ü
 ()

474  
$this
->
_”rÜ
;

475 
	}
}

478 
funùiÚ
 
	$G‘La¡W¬nšg
 ()

480  
$this
->
_w¬nšg
;

481 
	}
}

484 
funùiÚ
 
	$IsCÚÃùE¼Ü
()

486  
$this
->
_cÚÃ¼Ü
;

487 
	}
}

490 
funùiÚ
 
	$S‘S”v”
 ( 
$ho¡
, 
$pÜt
 = 0 )

492 
	`as£¹
 ( 
	`is_¡ršg
(
$ho¡
) );

493 iàĞ
$ho¡
[0] == '/')

495 
$this
->
_·th
 = 'unix://' . 
$ho¡
;

498 iàĞ
	`sub¡r
 ( 
$ho¡
, 0, 7 )=="unix://" )

500 
$this
->
_·th
 = 
$ho¡
;

504 
	`as£¹
 ( 
	`is_št
(
$pÜt
) );

505 
$this
->
_ho¡
 = 
$ho¡
;

506 
$this
->
_pÜt
 = 
$pÜt
;

507 
$this
->
_·th
 = '';

509 
	}
}

512 
funùiÚ
 
	$S‘CÚÃùTimeout
 ( 
$timeout
 )

514 
	`as£¹
 ( 
	`is_num”ic
(
$timeout
) );

515 
$this
->
_timeout
 = 
$timeout
;

516 
	}
}

519 
funùiÚ
 
	$_S’d
 ( 
$hªdË
, 
$d©a
, 
$Ëngth
 )

521 iàĞ
	`ãof
(
$hªdË
è|| 
	`fwr™e
 ( $hªdË, 
$d©a
, 
$Ëngth
 ) !== $length )

523 
$this
->
_”rÜ
 = 'connection unexpectedly closed (timed out?)';

524 
$this
->
_cÚÃ¼Ü
 = 
Œue
;

525  
çl£
;

527  
Œue
;

528 
	}
}

533 
funùiÚ
 
	$_MBPush
 ()

535 
$this
->
_mb’c
 = "";

536 iàĞ
	`ši_g‘
 ( "mbstring.func_overload" ) & 2 )

538 
$this
->
_mb’c
 = 
	`mb_š‹º®_’codšg
();

539 
	`mb_š‹º®_’codšg
 ( "latin1" );

541 
	}
}

544 
funùiÚ
 
	$_MBPİ
 ()

546 iàĞ
$this
->
_mb’c
 )

547 
	`mb_š‹º®_’codšg
 ( 
$this
->
_mb’c
 );

548 
	}
}

551 
funùiÚ
 
	$_CÚÃù
 ()

553 iàĞ
$this
->
_sock‘
!==
çl£
 )

557 iàĞ!@
	`ãof
 ( 
$this
->
_sock‘
 ) )

558  
$this
->
_sock‘
;

561 
$this
->
_sock‘
 = 
çl£
;

564 
$”ºo
 = 0;

565 
$”r¡r
 = "";

566 
$this
->
_cÚÃ¼Ü
 = 
çl£
;

568 iàĞ
$this
->
_·th
 )

570 
$ho¡
 = 
$this
->
_·th
;

571 
$pÜt
 = 0;

575 
$ho¡
 = 
$this
->
_ho¡
;

576 
$pÜt
 = 
$this
->
_pÜt
;

579 iàĞ
$this
->
_timeout
<=0 )

580 
$å
 = @
	`fsockİ’
 ( 
$ho¡
, 
$pÜt
, 
$”ºo
, 
$”r¡r
 );

582 
$å
 = @
	`fsockİ’
 ( 
$ho¡
, 
$pÜt
, 
$”ºo
, 
$”r¡r
, 
$this
->
_timeout
 );

584 iàĞ!
$å
 )

586 iàĞ
$this
->
_·th
 )

587 
$loÿtiÚ
 = 
$this
->
_·th
;

589 
$loÿtiÚ
 = "{$this->_host}:{$this->_port}";

591 
$”r¡r
 = 
	`Œim
 ( $errstr );

592 
$this
->
_”rÜ
 = "connectiono $location failed (errno=$errno, msg=$errstr)";

593 
$this
->
_cÚÃ¼Ü
 = 
Œue
;

594  
çl£
;

601 iàĞ!
$this
->
	`_S’d
 ( 
$å
, 
	`·ck
 ( "N", 1 ), 4 ) )

603 
	`fşo£
 ( 
$å
 );

604 
$this
->
_”rÜ
 = "failedo send client…rotocol version";

605  
çl£
;

609 
	`li¡
(,
$v
èğ
	`uÅack
 ( "N*", 
	`ä—d
 ( 
$å
, 4 ) );

610 
$v
 = ()$v;

611 iàĞ
$v
<1 )

613 
	`fşo£
 ( 
$å
 );

614 
$this
->
_”rÜ
 = "expected searchd…rotocol version 1+, got version '$v'";

615  
çl£
;

618  
$å
;

619 
	}
}

622 
funùiÚ
 
	$_G‘Re¥Ú£
 ( 
$å
, 
$ş›Á_v”
 )

624 
$»¥Ú£
 = "";

625 
$Ën
 = 0;

627 
$h—d”
 = 
	`ä—d
 ( 
$å
, 8 );

628 iàĞ
	`¡¾’
(
$h—d”
)==8 )

630 
	`li¡
 ( 
$¡©us
, 
$v”
, 
$Ën
 ) = 
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "n2a/Nb", 
$h—d”
 ) );

631 
$Ëá
 = 
$Ën
;

632  
$Ëá
>0 && !
	`ãof
(
$å
) )

634 
$chunk
 = 
	`ä—d
 ( 
$å
, 
$Ëá
 );

635 iàĞ
$chunk
 )

637 
$»¥Ú£
 .ğ
$chunk
;

638 
$Ëá
 -ğ
	`¡¾’
(
$chunk
);

642 iàĞ
$this
->
_sock‘
 ==ğ
çl£
 )

643 
	`fşo£
 ( 
$å
 );

646 
$»ad
 = 
	`¡¾’
 ( 
$»¥Ú£
 );

647 iàĞ!
$»¥Ú£
 || 
$»ad
!=
$Ën
 )

649 
$this
->
_”rÜ
 = 
$Ën


652  
çl£
;

656 iàĞ
$¡©us
==
SEARCHD_WARNING
 )

658 
	`li¡
(,
$wËn
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 0, 4 ) );

659 
$this
->
_w¬nšg
 = 
	`sub¡r
 ( 
$»¥Ú£
, 4, 
$wËn
 );

660  
	`sub¡r
 ( 
$»¥Ú£
, 4+
$wËn
 );

662 iàĞ
$¡©us
==
SEARCHD_ERROR
 )

664 
$this
->
_”rÜ
 = "£¬chdƒ¼Ü: " . 
	`sub¡r
 ( 
$»¥Ú£
, 4 );

665  
çl£
;

667 iàĞ
$¡©us
==
SEARCHD_RETRY
 )

669 
$this
->
_”rÜ
 = "‹mpÜ¬y s—rchdƒ¼Ü: " . 
	`sub¡r
 ( 
$»¥Ú£
, 4 );

670  
çl£
;

672 iàĞ
$¡©us
!=
SEARCHD_OK
 )

674 
$this
->
_”rÜ
 = "unknown status code '$status'";

675  
çl£
;

679 iàĞ
$v”
<
$ş›Á_v”
 )

681 
$this
->
_w¬nšg
 = 
	`¥rštf
 ( "searchd command v.%d.%d olderhan client's v.%d.%d, some options might‚ot work",

682 
$v”
>>8, $v”&0xff, 
$ş›Á_v”
>>8, $client_ver&0xff );

685  
$»¥Ú£
;

686 
	}
}

694 
funùiÚ
 
	$S‘Lim™s
 ( 
$off£t
, 
$lim™
, 
$max
=0, 
$cutoff
=0 )

696 
	`as£¹
 ( 
	`is_št
(
$off£t
) );

697 
	`as£¹
 ( 
	`is_št
(
$lim™
) );

698 
	`as£¹
 ( 
$off£t
>=0 );

699 
	`as£¹
 ( 
$lim™
>0 );

700 
	`as£¹
 ( 
$max
>=0 );

701 
$this
->
_off£t
 = 
$off£t
;

702 
$this
->
_lim™
 = 
$lim™
;

703 iàĞ
$max
>0 )

704 
$this
->
_maxm©ches
 = 
$max
;

705 iàĞ
$cutoff
>0 )

706 
$this
->
_cutoff
 = 
$cutoff
;

707 
	}
}

711 
funùiÚ
 
	$S‘MaxQu”yTime
 ( 
$max
 )

713 
	`as£¹
 ( 
	`is_št
(
$max
) );

714 
	`as£¹
 ( 
$max
>=0 );

715 
$this
->
_maxqu”ytime
 = 
$max
;

716 
	}
}

719 
funùiÚ
 
	$S‘M©chMode
 ( 
$mode
 )

721 
	`as£¹
 ( 
$mode
==
SPH_MATCH_ALL


722 || 
$mode
==
SPH_MATCH_ANY


723 || 
$mode
==
SPH_MATCH_PHRASE


724 || 
$mode
==
SPH_MATCH_BOOLEAN


725 || 
$mode
==
SPH_MATCH_EXTENDED


726 || 
$mode
==
SPH_MATCH_FULLSCAN


727 || 
$mode
==
SPH_MATCH_EXTENDED2
 );

728 
$this
->
_mode
 = 
$mode
;

729 
	}
}

732 
funùiÚ
 
	$S‘RªkšgMode
 ( 
$¿nk”
 )

734 
	`as£¹
 ( 
$¿nk”
==
SPH_RANK_PROXIMITY_BM25


735 || 
$¿nk”
==
SPH_RANK_BM25


736 || 
$¿nk”
==
SPH_RANK_NONE


737 || 
$¿nk”
==
SPH_RANK_WORDCOUNT


738 || 
$¿nk”
==
SPH_RANK_PROXIMITY
 );

739 
$this
->
_¿nk”
 = 
$¿nk”
;

740 
	}
}

743 
funùiÚ
 
S‘SÜtMode
 ( 
$mode
, 
$sÜtby
="" )

745 
as£¹
 (

746 
$mode
==
SPH_SORT_RELEVANCE
 ||

747 
$mode
==
SPH_SORT_ATTR_DESC
 ||

748 
$mode
==
SPH_SORT_ATTR_ASC
 ||

749 
$mode
==
SPH_SORT_TIME_SEGMENTS
 ||

750 
$mode
==
SPH_SORT_EXTENDED
 ||

751 
$mode
==
SPH_SORT_EXPR
 );

752 
as£¹
 ( 
is_¡ršg
(
$sÜtby
) );

753 
as£¹
 ( 
$mode
==
SPH_SORT_RELEVANCE
 || 
¡¾’
(
$sÜtby
)>0 );

755 
	g$this
->
	g_sÜt
 = 
$mode
;

756 
	g$this
->
	g_sÜtby
 = 
$sÜtby
;

761 
funùiÚ
 
	$S‘Weights
 ( 
$weights
 )

763 
	`as£¹
 ( 
	`is_¬¿y
(
$weights
) );

764 
	`fÜ—ch
 ( 
$weights
 
as
 
$weight
 )

765 
	`as£¹
 ( 
	`is_št
(
$weight
) );

767 
$this
->
_weights
 = 
$weights
;

768 
	}
}

771 
funùiÚ
 
	$S‘F›ldWeights
 ( 
$weights
 )

773 
	`as£¹
 ( 
	`is_¬¿y
(
$weights
) );

774 
	`fÜ—ch
 ( 
$weights
 
as
 
$Çme
=>
$weight
 )

776 
	`as£¹
 ( 
	`is_¡ršg
(
$Çme
) );

777 
	`as£¹
 ( 
	`is_št
(
$weight
) );

779 
$this
->
_f›ldweights
 = 
$weights
;

780 
	}
}

783 
funùiÚ
 
	$S‘IndexWeights
 ( 
$weights
 )

785 
	`as£¹
 ( 
	`is_¬¿y
(
$weights
) );

786 
	`fÜ—ch
 ( 
$weights
 
as
 
$šdex
=>
$weight
 )

788 
	`as£¹
 ( 
	`is_¡ršg
(
$šdex
) );

789 
	`as£¹
 ( 
	`is_št
(
$weight
) );

791 
$this
->
_šdexweights
 = 
$weights
;

792 
	}
}

796 
funùiÚ
 
	$S‘IDRªge
 ( 
$mš
, 
$max
 )

798 
	`as£¹
 ( 
	`is_num”ic
(
$mš
) );

799 
	`as£¹
 ( 
	`is_num”ic
(
$max
) );

800 
	`as£¹
 ( 
$mš
<=
$max
 );

801 
$this
->
_mš_id
 = 
$mš
;

802 
$this
->
_max_id
 = 
$max
;

803 
	}
}

807 
funùiÚ
 
	$S‘F‹r
 ( 
$©Œibu‹
, 
$v®ues
, 
$exşude
=
çl£
 )

809 
	`as£¹
 ( 
	`is_¡ršg
(
$©Œibu‹
) );

810 
	`as£¹
 ( 
	`is_¬¿y
(
$v®ues
) );

811 
	`as£¹
 ( 
	`couÁ
(
$v®ues
) );

813 iàĞ
	`is_¬¿y
(
$v®ues
è&& 
	`couÁ
($values) )

815 
	`fÜ—ch
 ( 
$v®ues
 
as
 
$v®ue
 )

816 
	`as£¹
 ( 
	`is_num”ic
(
$v®ue
) );

818 
$this
->
_f‹rs
[] = 
	`¬¿y
 ( "ty³"=>
SPH_FILTER_VALUES
, "©Œ"=>
$©Œibu‹
, "exşude"=>
$exşude
, "v®ues"=>
$v®ues
 );

820 
	}
}

824 
funùiÚ
 
	$S‘F‹rRªge
 ( 
$©Œibu‹
, 
$mš
, 
$max
, 
$exşude
=
çl£
 )

826 
	`as£¹
 ( 
	`is_¡ršg
(
$©Œibu‹
) );

827 
	`as£¹
 ( 
	`is_num”ic
(
$mš
) );

828 
	`as£¹
 ( 
	`is_num”ic
(
$max
) );

829 
	`as£¹
 ( 
$mš
<=
$max
 );

831 
$this
->
_f‹rs
[] = 
	`¬¿y
 ( "ty³"=>
SPH_FILTER_RANGE
, "©Œ"=>
$©Œibu‹
, "exşude"=>
$exşude
, "mš"=>
$mš
, "max"=>
$max
 );

832 
	}
}

836 
funùiÚ
 
	$S‘F‹rFlßtRªge
 ( 
$©Œibu‹
, 
$mš
, 
$max
, 
$exşude
=
çl£
 )

838 
	`as£¹
 ( 
	`is_¡ršg
(
$©Œibu‹
) );

839 
	`as£¹
 ( 
	`is_æßt
(
$mš
) );

840 
	`as£¹
 ( 
	`is_æßt
(
$max
) );

841 
	`as£¹
 ( 
$mš
<=
$max
 );

843 
$this
->
_f‹rs
[] = 
	`¬¿y
 ( "ty³"=>
SPH_FILTER_FLOATRANGE
, "©Œ"=>
$©Œibu‹
, "exşude"=>
$exşude
, "mš"=>
$mš
, "max"=>
$max
 );

844 
	}
}

849 
funùiÚ
 
	$S‘GeoAnchÜ
 ( 
$©ŒÏt
, 
$©ŒlÚg
, 
$Ït
, 
$lÚg
 )

851 
	`as£¹
 ( 
	`is_¡ršg
(
$©ŒÏt
) );

852 
	`as£¹
 ( 
	`is_¡ršg
(
$©ŒlÚg
) );

853 
	`as£¹
 ( 
	`is_æßt
(
$Ït
) );

854 
	`as£¹
 ( 
	`is_æßt
(
$lÚg
) );

856 
$this
->
_ªchÜ
 = 
	`¬¿y
 ( "©ŒÏt"=>
$©ŒÏt
, "©ŒlÚg"=>
$©ŒlÚg
, "Ït"=>
$Ït
, "lÚg"=>
$lÚg
 );

857 
	}
}

860 
funùiÚ
 
S‘GroupBy
 ( 
$©Œibu‹
, 
$func
, 
$groupsÜt
="@group desc" )

862 
as£¹
 ( 
is_¡ršg
(
$©Œibu‹
) );

863 
as£¹
 ( 
is_¡ršg
(
$groupsÜt
) );

864 
as£¹
 ( 
$func
==
SPH_GROUPBY_DAY


865 || 
$func
==
SPH_GROUPBY_WEEK


866 || 
$func
==
SPH_GROUPBY_MONTH


867 || 
$func
==
SPH_GROUPBY_YEAR


868 || 
$func
==
SPH_GROUPBY_ATTR


869 || 
$func
==
SPH_GROUPBY_ATTRPAIR
 );

871 
	g$this
->
	g_groupby
 = 
$©Œibu‹
;

872 
	g$this
->
	g_groupfunc
 = 
$func
;

873 
	g$this
->
	g_groupsÜt
 = 
$groupsÜt
;

877 
funùiÚ
 
	$S‘GroupDi¡šù
 ( 
$©Œibu‹
 )

879 
	`as£¹
 ( 
	`is_¡ršg
(
$©Œibu‹
) );

880 
$this
->
_groupdi¡šù
 = 
$©Œibu‹
;

881 
	}
}

884 
funùiÚ
 
	$S‘R‘r›s
 ( 
$couÁ
, 
$d–ay
=0 )

886 
	`as£¹
 ( 
	`is_št
(
$couÁ
) && $count>=0 );

887 
	`as£¹
 ( 
	`is_št
(
$d–ay
) && $delay>=0 );

888 
$this
->
_»ŒycouÁ
 = 
$couÁ
;

889 
$this
->
_»Œyd–ay
 = 
$d–ay
;

890 
	}
}

894 
funùiÚ
 
	$S‘A¼ayResuÉ
 ( 
$¬¿y»suÉ
 )

896 
	`as£¹
 ( 
	`is_boŞ
(
$¬¿y»suÉ
) );

897 
$this
->
_¬¿y»suÉ
 = 
$¬¿y»suÉ
;

898 
	}
}

903 
funùiÚ
 
	$S‘Ov”ride
 ( 
$©ŒÇme
, 
$©Œty³
, 
$v®ues
 )

905 
	`as£¹
 ( 
	`is_¡ršg
 ( 
$©ŒÇme
 ) );

906 
	`as£¹
 ( 
	`š_¬¿y
 ( 
$©Œty³
, 
	`¬¿y
 ( 
SPH_ATTR_INTEGER
, 
SPH_ATTR_TIMESTAMP
, 
SPH_ATTR_BOOL
, 
SPH_ATTR_FLOAT
, 
SPH_ATTR_BIGINT
 ) ) );

907 
	`as£¹
 ( 
	`is_¬¿y
 ( 
$v®ues
 ) );

909 
$this
->
_ov”rides
[
$©ŒÇme
] = 
	`¬¿y
 ( "©Œ"=>$©ŒÇme, "ty³"=>
$©Œty³
, "v®ues"=>
$v®ues
 );

910 
	}
}

913 
funùiÚ
 
	$S‘S–eù
 ( 
$£Ëù
 )

915 
	`as£¹
 ( 
	`is_¡ršg
 ( 
$£Ëù
 ) );

916 
$this
->
_£Ëù
 = 
$£Ëù
;

917 
	}
}

922 
funùiÚ
 
	$Re£tF‹rs
 ()

924 
$this
->
_f‹rs
 = 
	`¬¿y
();

925 
$this
->
_ªchÜ
 = 
	`¬¿y
();

926 
	}
}

929 
funùiÚ
 
	$Re£tGroupBy
 ()

931 
$this
->
_groupby
 = "";

932 
$this
->
_groupfunc
 = 
SPH_GROUPBY_DAY
;

933 
$this
->
_groupsÜt
 = "@group desc";

934 
$this
->
_groupdi¡šù
= "";

935 
	}
}

938 
funùiÚ
 
	$Re£tOv”rides
 ()

940 
$this
->
_ov”rides
 = 
	`¬¿y
 ();

941 
	}
}

947 
funùiÚ
 
Qu”y
 ( 
$qu”y
, 
$šdex
="*", 
$comm’t
="" )

949 
as£¹
 ( 
em±y
(
$this
->
_»qs
) );

951 
	g$this
->
AddQu”y
 ( 
$qu”y
, 
$šdex
, 
$comm’t
 );

952 
	g$»suÉs
 = 
$this
->
RunQu”›s
 ();

953 
	g$this
->
	g_»qs
 = 
¬¿y
 ();

955 iàĞ!
is_¬¿y
(
$»suÉs
) )

956  
	gçl£
;

958 
	g$this
->
	g_”rÜ
 = 
$»suÉs
[0]["error"];

959 
	g$this
->
	g_w¬nšg
 = 
$»suÉs
[0]["warning"];

960 iàĞ
	g$»suÉs
[0]["¡©us"]==
SEARCHD_ERROR
 )

961  
çl£
;

963  
	g$»suÉs
[0];

967 
funùiÚ
 
	$_PackFlßt
 ( 
$f
 )

969 
$t1
 = 
	`·ck
 ( "f", 
$f
 );

970 
	`li¡
(,
$t2
èğ
	`uÅack
 ( "L*", 
$t1
 );

971  
	`·ck
 ( "N", 
$t2
 );

972 
	}
}

976 
funùiÚ
 
AddQu”y
 ( 
$qu”y
, 
$šdex
="*", 
$comm’t
="" )

979 
$this
->
_MBPush
 ();

982 
	g$»q
 = 
·ck
 ( "NNNNN", 
$this
->
_off£t
, $this->
_lim™
, $this->
_mode
, $this->
_¿nk”
, $this->
_sÜt
 );

983 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$this
->
_sÜtby
èè. 
	g$this
->
	g_sÜtby
;

984 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$qu”y
èè. 
	g$qu”y
;

985 
	g$»q
 .ğ
·ck
 ( "N", 
couÁ
(
$this
->
_weights
) );

986 
fÜ—ch
 ( 
$this
->
_weights
 
as
 
$weight
 )

987 
	g$»q
 .ğ
·ck
 ( "N", ()
$weight
 );

988 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$šdex
èè. 
	g$šdex
;

989 
	g$»q
 .ğ
·ck
 ( "N", 1 );

990 
	g$»q
 .ğ
¥hPackU64
 ( 
$this
->
_mš_id
 ) . sphPackU64 ( $this->
_max_id
 );

993 
	g$»q
 .ğ
·ck
 ( "N", 
couÁ
(
$this
->
_f‹rs
) );

994 
fÜ—ch
 ( 
$this
->
_f‹rs
 
as
 
$f‹r
 )

996 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$f‹r
["©Œ"]èè. 
	g$f‹r
["attr"];

997 
	g$»q
 .ğ
·ck
 ( "N", 
$f‹r
["type"] );

998  
	g$f‹r
["type"] )

1000 
	gSPH_FILTER_VALUES
:

1001 
$»q
 .ğ
·ck
 ( "N", 
couÁ
(
$f‹r
["values"]) );

1002 
fÜ—ch
 ( 
$f‹r
["v®ues"] 
as
 
$v®ue
 )

1003 
	g$»q
 .ğ
¥hPackI64
 ( 
$v®ue
 );

1006 
	gSPH_FILTER_RANGE
:

1007 
$»q
 .ğ
¥hPackI64
 ( 
$f‹r
["min"] ) . sphPackI64 ( $filter["max"] );

1010 
	gSPH_FILTER_FLOATRANGE
:

1011 
$»q
 .ğ
$this
->
_PackFlßt
 ( 
$f‹r
["min"] ) . $this->_PackFloat ( $filter["max"] );

1015 
as£¹
 ( 0 && "internalƒrror: unhandled filterype" );

1017 
	g$»q
 .ğ
·ck
 ( "N", 
$f‹r
["exclude"] );

1021 
	g$»q
 .ğ
·ck
 ( "NN", 
$this
->
_groupfunc
, 
¡¾’
($this->
_groupby
èè. 
	g$this
->
	g_groupby
;

1022 
	g$»q
 .ğ
·ck
 ( "N", 
$this
->
_maxm©ches
 );

1023 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$this
->
_groupsÜt
èè. 
	g$this
->
	g_groupsÜt
;

1024 
	g$»q
 .ğ
·ck
 ( "NNN", 
$this
->
_cutoff
, $this->
_»ŒycouÁ
, $this->
_»Œyd–ay
 );

1025 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$this
->
_groupdi¡šù
èè. 
	g$this
->
	g_groupdi¡šù
;

1028 iàĞ
em±y
(
$this
->
_ªchÜ
) )

1030 
	g$»q
 .ğ
·ck
 ( "N", 0 );

1033 
	g$a
 =& 
$this
->
_ªchÜ
;

1034 
	g$»q
 .ğ
·ck
 ( "N", 1 );

1035 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$a
["©ŒÏt"]èè. 
	g$a
["attrlat"];

1036 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$a
["©ŒlÚg"]èè. 
	g$a
["attrlong"];

1037 
	g$»q
 .ğ
$this
->
_PackFlßt
 ( 
$a
["lat"] ) . $this->_PackFloat ( $a["long"] );

1041 
	g$»q
 .ğ
·ck
 ( "N", 
couÁ
(
$this
->
_šdexweights
) );

1042 
fÜ—ch
 ( 
$this
->
_šdexweights
 
as
 
$idx
=>
$weight
 )

1043 
$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$idx
èè. 
	g$idx
 .…ack ( "N", 
$weight
 );

1046 
	g$»q
 .ğ
·ck
 ( "N", 
$this
->
_maxqu”ytime
 );

1049 
	g$»q
 .ğ
·ck
 ( "N", 
couÁ
(
$this
->
_f›ldweights
) );

1050 
fÜ—ch
 ( 
$this
->
_f›ldweights
 
as
 
$f›ld
=>
$weight
 )

1051 
$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$f›ld
èè. 
	g$f›ld
 .…ack ( "N", 
$weight
 );

1054 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$comm’t
èè. 
	g$comm’t
;

1057 
	g$»q
 .ğ
·ck
 ( "N", 
couÁ
(
$this
->
_ov”rides
) );

1058 
fÜ—ch
 ( 
$this
->
_ov”rides
 
as
 
$key
 => 
$’Œy
 )

1060 
$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$’Œy
["©Œ"]èè. 
	g$’Œy
["attr"];

1061 
	g$»q
 .ğ
·ck
 ( "NN", 
$’Œy
["ty³"], 
couÁ
($entry["values"]) );

1062 
fÜ—ch
 ( 
$’Œy
["v®ues"] 
as
 
$id
=>
$v®
 )

1064 
as£¹
 ( 
is_num”ic
(
$id
) );

1065 
as£¹
 ( 
is_num”ic
(
$v®
) );

1067 
	g$»q
 .ğ
¥hPackU64
 ( 
$id
 );

1068  
	g$’Œy
["type"] )

1070 
	gSPH_ATTR_FLOAT
: 
$»q
 .ğ
$this
->
_PackFlßt
 ( 
$v®
 ); ;

1071 
	gSPH_ATTR_BIGINT
: 
$»q
 .ğ
¥hPackI64
 ( 
$v®
 ); ;

1072 : 
$»q
 .ğ
·ck
 ( "N", 
$v®
 ); ;

1078 
	g$»q
 .ğ
·ck
 ( "N", 
¡¾’
(
$this
->
_£Ëù
èè. 
	g$this
->
	g_£Ëù
;

1081 
	g$this
->
_MBPİ
 ();

1084 
	g$this
->
	g_»qs
[] = 
$»q
;

1085  
couÁ
(
$this
->
_»qs
)-1;

1089 
funùiÚ
 
	$RunQu”›s
 ()

1091 iàĞ
	`em±y
(
$this
->
_»qs
) )

1093 
$this
->
_”rÜ
 = "no queries defined, issue AddQuery() first";

1094  
çl£
;

1098 
$this
->
	`_MBPush
 ();

1100 ià(!Ğ
$å
 = 
$this
->
	`_CÚÃù
() ))

1102 
$this
->
	`_MBPİ
 ();

1103  
çl£
;

1107 
$Äeqs
 = 
	`couÁ
(
$this
->
_»qs
);

1108 
$»q
 = 
	`još
 ( "", 
$this
->
_»qs
 );

1109 
$Ën
 = 4+
	`¡¾’
(
$»q
);

1110 
$»q
 = 
	`·ck
 ( "ÂNN", 
SEARCHD_COMMAND_SEARCH
, 
VER_COMMAND_SEARCH
, 
$Ën
, 
$Äeqs
 ) . $req;

1112 iàĞ!Ğ
$this
->
	`_S’d
 ( 
$å
, 
$»q
, 
$Ën
+8 ) ) ||

1113 !Ğ
$»¥Ú£
 = 
$this
->
	`_G‘Re¥Ú£
 ( 
$å
, 
VER_COMMAND_SEARCH
 ) ) )

1115 
$this
->
	`_MBPİ
 ();

1116  
çl£
;

1120 
$this
->
_»qs
 = 
	`¬¿y
 ();

1123  
$this
->
	`_P¬£S—rchRe¥Ú£
 ( 
$»¥Ú£
, 
$Äeqs
 );

1124 
	}
}

1127 
funùiÚ
 
	$_P¬£S—rchRe¥Ú£
 ( 
$»¥Ú£
, 
$Äeqs
 )

1129 
$p
 = 0;

1130 
$max
 = 
	`¡¾’
(
$»¥Ú£
);

1132 
$»suÉs
 = 
	`¬¿y
 ();

1133  
$œes
=0; $œes<
$Äeqs
 && 
$p
<
$max
; $ires++ )

1135 
$»suÉs
[] = 
	`¬¿y
();

1136 
$»suÉ
 =& 
$»suÉs
[
$œes
];

1138 
$»suÉ
["error"] = "";

1139 
$»suÉ
["warning"] = "";

1142 
	`li¡
(,
$¡©us
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1143 
$»suÉ
["¡©us"] = 
$¡©us
;

1144 iàĞ
$¡©us
!=
SEARCHD_OK
 )

1146 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1147 
$mes§ge
 = 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 
$Ën
 ); $p += $len;

1149 iàĞ
$¡©us
==
SEARCHD_WARNING
 )

1151 
$»suÉ
["w¬nšg"] = 
$mes§ge
;

1154 
$»suÉ
["”rÜ"] = 
$mes§ge
;

1160 
$f›lds
 = 
	`¬¿y
 ();

1161 
$©Œs
 = 
	`¬¿y
 ();

1163 
	`li¡
(,
$nf›lds
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1164  
$nf›lds
-->0 && 
$p
<
$max
 )

1166 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1167 
$f›lds
[] = 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 
$Ën
 ); $p += $len;

1169 
$»suÉ
["f›lds"] = 
$f›lds
;

1171 
	`li¡
(,
$Ç‰rs
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1172  
$Ç‰rs
-->0 && 
$p
<
$max
 )

1174 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1175 
$©Œ
 = 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 
$Ën
 ); $p += $len;

1176 
	`li¡
(,
$ty³
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1177 
$©Œs
[
$©Œ
] = 
$ty³
;

1179 
$»suÉ
["©Œs"] = 
$©Œs
;

1182 
	`li¡
(,
$couÁ
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1183 
	`li¡
(,
$id64
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1186 
$idx
 = -1;

1187  
$couÁ
-->0 && 
$p
<
$max
 )

1190 
$idx
++;

1193 iàĞ
$id64
 )

1195 
$doc
 = 
	`¥hUÅackU64
 ( 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 8 ) ); $p += 8;

1196 
	`li¡
(,
$weight
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1200 
	`li¡
 ( 
$doc
, 
$weight
 ) = 
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "N*N*",

1201 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 8 ) ) );

1202 
$p
 += 8;

1203 
$doc
 = 
	`¥hFixUšt
($doc);

1205 
$weight
 = 
	`¥rštf
 ( "%u", $weight );

1208 iàĞ
$this
->
_¬¿y»suÉ
 )

1209 
$»suÉ
["m©ches"][
$idx
] = 
	`¬¿y
 ( "id"=>
$doc
, "weight"=>
$weight
 );

1211 
$»suÉ
["m©ches"][
$doc
]["weight"] = 
$weight
;

1214 
$©Œv®s
 = 
	`¬¿y
 ();

1215 
	`fÜ—ch
 ( 
$©Œs
 
as
 
$©Œ
=>
$ty³
 )

1218 iàĞ
$ty³
==
SPH_ATTR_BIGINT
 )

1220 
$©Œv®s
[
$©Œ
] = 
	`¥hUÅackI64
 ( 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 8 ) ); $p += 8;

1225 iàĞ
$ty³
==
SPH_ATTR_FLOAT
 )

1227 
	`li¡
(,
$uv®
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1228 
	`li¡
(,
$fv®
èğ
	`uÅack
 ( "f*", 
	`·ck
 ( "L", 
$uv®
 ) );

1229 
$©Œv®s
[
$©Œ
] = 
$fv®
;

1234 
	`li¡
(,
$v®
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1235 iàĞ
$ty³
 & 
SPH_ATTR_MULTI
 )

1237 
$©Œv®s
[
$©Œ
] = 
	`¬¿y
 ();

1238 
$nv®ues
 = 
$v®
;

1239  
$nv®ues
-->0 && 
$p
<
$max
 )

1241 
	`li¡
(,
$v®
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1242 
$©Œv®s
[
$©Œ
][] = 
	`¥hFixUšt
(
$v®
);

1246 
$©Œv®s
[
$©Œ
] = 
	`¥hFixUšt
(
$v®
);

1250 iàĞ
$this
->
_¬¿y»suÉ
 )

1251 
$»suÉ
["m©ches"][
$idx
]["©Œs"] = 
$©Œv®s
;

1253 
$»suÉ
["m©ches"][
$doc
]["©Œs"] = 
$©Œv®s
;

1256 
	`li¡
 ( 
$tÙ®
, 
$tÙ®_found
, 
$m£cs
, 
$wÜds
 ) =

1257 
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "N*N*N*N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 16 ) ) );

1258 
$»suÉ
["tÙ®"] = 
	`¥rštf
 ( "%u", 
$tÙ®
 );

1259 
$»suÉ
["tÙ®_found"] = 
	`¥rštf
 ( "%u", 
$tÙ®_found
 );

1260 
$»suÉ
["time"] = 
	`¥rštf
 ( "%.3f", 
$m£cs
/1000 );

1261 
$p
 += 16;

1263  
$wÜds
-->0 && 
$p
<
$max
 )

1265 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1266 
$wÜd
 = 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 
$Ën
 ); $p += $len;

1267 
	`li¡
 ( 
$docs
, 
$h™s
 ) = 
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "N*N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 8 ) ) ); $p += 8;

1268 
$»suÉ
["wÜds"][
$wÜd
] = 
	`¬¿y
 (

1269 "docs"=>
	`¥rštf
 ( "%u", 
$docs
 ),

1270 "h™s"=>
	`¥rštf
 ( "%u", 
$h™s
 ) );

1274 
$this
->
	`_MBPİ
 ();

1275  
$»suÉs
;

1276 
	}
}

1285 
funùiÚ
 
BudExû½ts
 ( 
$docs
, 
$šdex
, 
$wÜds
, 
$İts
=
	$¬¿y
() )

1287 
	`as£¹
 ( 
	`is_¬¿y
(
$docs
) );

1288 
	`as£¹
 ( 
	`is_¡ršg
(
$šdex
) );

1289 
	`as£¹
 ( 
	`is_¡ršg
(
$wÜds
) );

1290 
	`as£¹
 ( 
	`is_¬¿y
(
$İts
) );

1292 
$this
->
	`_MBPush
 ();

1294 ià(!Ğ
$å
 = 
$this
->
	`_CÚÃù
() ))

1296 
$this
->
	`_MBPİ
();

1297  
çl£
;

1304 iàĞ!
	`is£t
(
$İts
["before_match"]) ) $opts["before_match"] = "<b>";

1305 iàĞ!
	`is£t
(
$İts
["after_match"]) ) $opts["after_match"] = "</b>";

1306 iàĞ!
	`is£t
(
$İts
["chunk_separator"]) ) $opts["chunk_separator"] = " ... ";

1307 iàĞ!
	`is£t
(
$İts
["limit"]) ) $opts["limit"] = 256;

1308 iàĞ!
	`is£t
(
$İts
["around"]) ) $opts["around"] = 5;

1309 iàĞ!
	`is£t
(
$İts
["exaù_ph¿£"]èè$İts["exaù_ph¿£"] = 
çl£
;

1310 iàĞ!
	`is£t
(
$İts
["sšgË_·s§ge"]èè$İts["sšgË_·s§ge"] = 
çl£
;

1311 iàĞ!
	`is£t
(
$İts
["u£_bound¬›s"]èè$İts["u£_bound¬›s"] = 
çl£
;

1312 iàĞ!
	`is£t
(
$İts
["weight_Üd”"]èè$İts["weight_Üd”"] = 
çl£
;

1319 
$æags
 = 1;

1320 iàĞ
$İts
["exaù_ph¿£"] ) 
$æags
 |= 2;

1321 iàĞ
$İts
["sšgË_·s§ge"] ) 
$æags
 |= 4;

1322 iàĞ
$İts
["u£_bound¬›s"] ) 
$æags
 |= 8;

1323 iàĞ
$İts
["weight_Üd”"] ) 
$æags
 |= 16;

1324 
$»q
 = 
	`·ck
 ( "NN", 0, 
$æags
 );

1325 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$šdex
) ) . $index;

1326 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$wÜds
) ) . $words;

1329 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$İts
["before_match"]) ) . $opts["before_match"];

1330 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$İts
["after_match"]) ) . $opts["after_match"];

1331 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$İts
["chunk_separator"]) ) . $opts["chunk_separator"];

1332 
$»q
 .ğ
	`·ck
 ( "N", ()
$İts
["limit"] );

1333 
$»q
 .ğ
	`·ck
 ( "N", ()
$İts
["around"] );

1336 
$»q
 .ğ
	`·ck
 ( "N", 
	`couÁ
(
$docs
) );

1337 
	`fÜ—ch
 ( 
$docs
 
as
 
$doc
 )

1339 
	`as£¹
 ( 
	`is_¡ršg
(
$doc
) );

1340 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$doc
) ) . $doc;

1347 
$Ën
 = 
	`¡¾’
(
$»q
);

1348 
$»q
 = 
	`·ck
 ( "ÂN", 
SEARCHD_COMMAND_EXCERPT
, 
VER_COMMAND_EXCERPT
, 
$Ën
 ) . $req;

1349 iàĞ!Ğ
$this
->
	`_S’d
 ( 
$å
, 
$»q
, 
$Ën
+8 ) ) ||

1350 !Ğ
$»¥Ú£
 = 
$this
->
	`_G‘Re¥Ú£
 ( 
$å
, 
VER_COMMAND_EXCERPT
 ) ) )

1352 
$this
->
	`_MBPİ
 ();

1353  
çl£
;

1360 
$pos
 = 0;

1361 
$»s
 = 
	`¬¿y
 ();

1362 
$¾’
 = 
	`¡¾’
(
$»¥Ú£
);

1363  
$i
=0; $i<
	`couÁ
(
$docs
); $i++ )

1365 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, 4 ) );

1366 
$pos
 += 4;

1368 iàĞ
$pos
+
$Ën
 > 
$¾’
 )

1370 
$this
->
_”rÜ
 = "incomplete„eply";

1371 
$this
->
	`_MBPİ
 ();

1372  
çl£
;

1374 
$»s
[] = 
$Ën
 ? 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, $len ) : "";

1375 
$pos
 +ğ
$Ën
;

1378 
$this
->
	`_MBPİ
 ();

1379  
$»s
;

1380 
	}
}

1390 
funùiÚ
 
	$BudKeywÜds
 ( 
$qu”y
, 
$šdex
, 
$h™s
 )

1392 
	`as£¹
 ( 
	`is_¡ršg
(
$qu”y
) );

1393 
	`as£¹
 ( 
	`is_¡ršg
(
$šdex
) );

1394 
	`as£¹
 ( 
	`is_boŞ
(
$h™s
) );

1396 
$this
->
	`_MBPush
 ();

1398 ià(!Ğ
$å
 = 
$this
->
	`_CÚÃù
() ))

1400 
$this
->
	`_MBPİ
();

1401  
çl£
;

1409 
$»q
 = 
	`·ck
 ( "N", 
	`¡¾’
(
$qu”y
) ) . $query;

1410 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$šdex
) ) . $index;

1411 
$»q
 .ğ
	`·ck
 ( "N", ()
$h™s
 );

1417 
$Ën
 = 
	`¡¾’
(
$»q
);

1418 
$»q
 = 
	`·ck
 ( "ÂN", 
SEARCHD_COMMAND_KEYWORDS
, 
VER_COMMAND_KEYWORDS
, 
$Ën
 ) . $req;

1419 iàĞ!Ğ
$this
->
	`_S’d
 ( 
$å
, 
$»q
, 
$Ën
+8 ) ) ||

1420 !Ğ
$»¥Ú£
 = 
$this
->
	`_G‘Re¥Ú£
 ( 
$å
, 
VER_COMMAND_KEYWORDS
 ) ) )

1422 
$this
->
	`_MBPİ
 ();

1423  
çl£
;

1430 
$pos
 = 0;

1431 
$»s
 = 
	`¬¿y
 ();

1432 
$¾’
 = 
	`¡¾’
(
$»¥Ú£
);

1433 
	`li¡
(,
$nwÜds
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, 4 ) );

1434 
$pos
 += 4;

1435  
$i
=0; $i<
$nwÜds
; $i++ )

1437 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, 4 ) ); $pos += 4;

1438 
$tok’ized
 = 
$Ën
 ? 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, $len ) : "";

1439 
$pos
 +ğ
$Ën
;

1441 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, 4 ) ); $pos += 4;

1442 
$nÜm®ized
 = 
$Ën
 ? 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, $len ) : "";

1443 
$pos
 +ğ
$Ën
;

1445 
$»s
[] = 
	`¬¿y
 ( "tok’ized"=>
$tok’ized
, "nÜm®ized"=>
$nÜm®ized
 );

1447 iàĞ
$h™s
 )

1449 
	`li¡
(
$ndocs
,
$nh™s
èğ
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "N*N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$pos
, 8 ) ) );

1450 
$pos
 += 8;

1451 
$»s
 [
$i
]["docs"] = 
$ndocs
;

1452 
$»s
 [
$i
]["h™s"] = 
$nh™s
;

1455 iàĞ
$pos
 > 
$¾’
 )

1457 
$this
->
_”rÜ
 = "incomplete„eply";

1458 
$this
->
	`_MBPİ
 ();

1459  
çl£
;

1463 
$this
->
	`_MBPİ
 ();

1464  
$»s
;

1465 
	}
}

1467 
funùiÚ
 
	$Esÿ³SŒšg
 ( 
$¡ršg
 )

1469 
$äom
 = 
	`¬¿y
 ( '\\', '(',')','|','-','!','@','~','"','&', '/', '^', '$', '=' );

1470 
$to
 = 
	`¬¿y
 ( '\\\\', '\(','\)','\|','\-','\!','\@','\~','\"', '\&', '\/', '\^', '\$', '\=' );

1472  
	`¡r_»¶aû
 ( 
$äom
, 
$to
, 
$¡ršg
 );

1473 
	}
}

1481 
funùiÚ
 
	$Upd©eA‰ribu‹s
 ( 
$šdex
, 
$©Œs
, 
$v®ues
, 
$mva
=
çl£
 )

1484 
	`as£¹
 ( 
	`is_¡ršg
(
$šdex
) );

1485 
	`as£¹
 ( 
	`is_boŞ
(
$mva
) );

1487 
	`as£¹
 ( 
	`is_¬¿y
(
$©Œs
) );

1488 
	`fÜ—ch
 ( 
$©Œs
 
as
 
$©Œ
 )

1489 
	`as£¹
 ( 
	`is_¡ršg
(
$©Œ
) );

1491 
	`as£¹
 ( 
	`is_¬¿y
(
$v®ues
) );

1492 
	`fÜ—ch
 ( 
$v®ues
 
as
 
$id
=>
$’Œy
 )

1494 
	`as£¹
 ( 
	`is_num”ic
(
$id
) );

1495 
	`as£¹
 ( 
	`is_¬¿y
(
$’Œy
) );

1496 
	`as£¹
 ( 
	`couÁ
(
$’Œy
)==couÁ(
$©Œs
) );

1497 
	`fÜ—ch
 ( 
$’Œy
 
as
 
$v
 )

1499 iàĞ
$mva
 )

1501 
	`as£¹
 ( 
	`is_¬¿y
(
$v
) );

1502 
	`fÜ—ch
 ( 
$v
 
as
 
$vv
 )

1503 
	`as£¹
 ( 
	`is_št
(
$vv
) );

1505 
	`as£¹
 ( 
	`is_št
(
$v
) );

1510 
$»q
 = 
	`·ck
 ( "N", 
	`¡¾’
(
$šdex
) ) . $index;

1512 
$»q
 .ğ
	`·ck
 ( "N", 
	`couÁ
(
$©Œs
) );

1513 
	`fÜ—ch
 ( 
$©Œs
 
as
 
$©Œ
 )

1515 
$»q
 .ğ
	`·ck
 ( "N", 
	`¡¾’
(
$©Œ
) ) . $attr;

1516 
$»q
 .ğ
	`·ck
 ( "N", 
$mva
 ? 1 : 0 );

1519 
$»q
 .ğ
	`·ck
 ( "N", 
	`couÁ
(
$v®ues
) );

1520 
	`fÜ—ch
 ( 
$v®ues
 
as
 
$id
=>
$’Œy
 )

1522 
$»q
 .ğ
	`¥hPackU64
 ( 
$id
 );

1523 
	`fÜ—ch
 ( 
$’Œy
 
as
 
$v
 )

1525 
$»q
 .ğ
	`·ck
 ( "N", 
$mva
 ? 
	`couÁ
(
$v
) : $v );

1526 iàĞ
$mva
 )

1527 
	`fÜ—ch
 ( 
$v
 
as
 
$vv
 )

1528 
$»q
 .ğ
	`·ck
 ( "N", 
$vv
 );

1533 ià(!Ğ
$å
 = 
$this
->
	`_CÚÃù
() ))

1536 
$Ën
 = 
	`¡¾’
(
$»q
);

1537 
$»q
 = 
	`·ck
 ( "ÂN", 
SEARCHD_COMMAND_UPDATE
, 
VER_COMMAND_UPDATE
, 
$Ën
 ) . $req;

1538 iàĞ!
$this
->
	`_S’d
 ( 
$å
, 
$»q
, 
$Ën
+8 ) )

1541 ià(!Ğ
$»¥Ú£
 = 
$this
->
	`_G‘Re¥Ú£
 ( 
$å
, 
VER_COMMAND_UPDATE
 ) ))

1545 
	`li¡
(,
$upd©ed
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 0, 4 ) );

1546  
$upd©ed
;

1547 
	}
}

1553 
funùiÚ
 
	$O³n
()

1555 iàĞ
$this
->
_sock‘
 !=ğ
çl£
 )

1557 
$this
->
_”rÜ
 = 'already connected';

1558  
çl£
;

1560 iàĞ!
$å
 = 
$this
->
	`_CÚÃù
() )

1561  
çl£
;

1564 
$»q
 = 
	`·ck
 ( "ÂNN", 
SEARCHD_COMMAND_PERSIST
, 0, 4, 1 );

1565 iàĞ!
$this
->
	`_S’d
 ( 
$å
, 
$»q
, 12 ) )

1566  
çl£
;

1568 
$this
->
_sock‘
 = 
$å
;

1569  
Œue
;

1570 
	}
}

1572 
funùiÚ
 
	$Clo£
()

1574 iàĞ
$this
->
_sock‘
 ==ğ
çl£
 )

1576 
$this
->
_”rÜ
 = 'not connected';

1577  
çl£
;

1580 
	`fşo£
 ( 
$this
->
_sock‘
 );

1581 
$this
->
_sock‘
 = 
çl£
;

1583  
Œue
;

1584 
	}
}

1590 
funùiÚ
 
	$Stus
 ()

1592 
$this
->
	`_MBPush
 ();

1593 ià(!Ğ
$å
 = 
$this
->
	`_CÚÃù
() ))

1595 
$this
->
	`_MBPİ
();

1596  
çl£
;

1599 
$»q
 = 
	`·ck
 ( "ÂNN", 
SEARCHD_COMMAND_STATUS
, 
VER_COMMAND_STATUS
, 4, 1 );

1600 iàĞ!Ğ
$this
->
	`_S’d
 ( 
$å
, 
$»q
, 12 ) ) ||

1601 !Ğ
$»¥Ú£
 = 
$this
->
	`_G‘Re¥Ú£
 ( 
$å
, 
VER_COMMAND_STATUS
 ) ) )

1603 
$this
->
	`_MBPİ
 ();

1604  
çl£
;

1607 
$»s
 = 
	`sub¡r
 ( 
$»¥Ú£
, 4 );

1608 
$p
 = 0;

1609 
	`li¡
 ( 
$rows
, 
$cŞs
 ) = 
	`¬¿y_v®ues
 ( 
	`uÅack
 ( "N*N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 8 ) ) ); $p += 8;

1611 
$»s
 = 
	`¬¿y
();

1612  
$i
=0; $i<
$rows
; $i++ )

1613  
$j
=0; $j<
$cŞs
; $j++ )

1615 
	`li¡
(,
$Ën
èğ
	`uÅack
 ( "N*", 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 4 ) ); $p += 4;

1616 
$»s
[
$i
][] = 
	`sub¡r
 ( 
$»¥Ú£
, 
$p
, 
$Ën
 ); $p += $len;

1619 
$this
->
	`_MBPİ
 ();

1620  
$»s
;

1621 
	}
}

	@E:\web\weixun\functions\splitword.class.php

1 <?
php


15 
defše
('_SP_', 
chr
(0xFF).chr(0xFE));

16 
defše
('UCS2', 'ucs-2be');

17 şas 
	cS¶™WÜd


21 
v¬
 
	m$mask_v®ue
 = 0xFFFF;

24 
v¬
 
	m$sourûCh¬S‘
 = 'utf-8';

25 
v¬
 
	m$rg‘Ch¬S‘
 = 'utf-8';

28 
v¬
 
	m$»suÉTy³
 = 1;

31 
v¬
 
	m$nÙS¶™L’
 = 5;

34 
v¬
 
	m$toLow”
 = 
FALSE
;

37 
v¬
 
	m$difãrMax
 = 
FALSE
;

40 
v¬
 
	m$un™WÜd
 = 
TRUE
;

43 
v¬
 
	m$lßdIn™
 = 
TRUE
;

46 
v¬
 
	m$difãrF»q
 = 
FALSE
;

49 
v¬
 
	m$sourûSŒšg
 = '';

52 
v¬
 
	m$addÚDic
 = 
¬¿y
();

53 
v¬
 
	m$addÚDicFe
 = 'data/words_addons.dic';

56 
v¬
 
	m$dicSŒ
 = '';

57 
v¬
 
	m$mašDic
 = 
¬¿y
();

58 
v¬
 
	m$mašDicHªd
 = 
FALSE
;

59 
v¬
 
	m$mašDicInfos
 = 
¬¿y
();

60 
v¬
 
	m$mašDicFe
 = 'data/base_dic_full.dic';

62 
v¬
 
	m$mašDicFeZ
 = 'data/base_dic_full.zip';

63 
v¬
 
	m$isLßdAÎ
 = 
FALSE
;

64 
v¬
 
	m$isUÅacked
 = 
FALSE
;

67 
v¬
 
	m$dicWÜdMax
 = 14;

69 
v¬
 
	m$sim¶eResuÉ
 = 
¬¿y
();

71 
v¬
 
	m$fš®lyResuÉ
 = '';

74 
v¬
 
	m$isLßdDic
 = 
FALSE
;

76 
v¬
 
	m$ÃwWÜds
 = 
¬¿y
();

77 
v¬
 
	m$foundWÜdSŒ
 = '';

79 
v¬
 
	m$lßdTime
 = 0;

90 
funùiÚ
 
__cÚ¡ruù
(
$sourû_ch¬£t
='utf-8', 
$rg‘_ch¬£t
='utf-8', 
$lßd_®l
=
TRUE
, 
$sourû
='')

92 
$this
->
S‘Sourû
Ğ
$sourû
, 
$sourû_ch¬£t
, 
$rg‘_ch¬£t
 );

93 
	m$this
->
	misLßdAÎ
 = 
$lßd_®l
;

94 if(
fe_exi¡s
(
XAKINC
.'/'.
$this
->
mašDicFe
)è
	m$this
->
	misUÅacked
 = 
TRUE
;

95 if(
	m$this
->
	mlßdIn™
è$this->
LßdDiù
();

98 
funùiÚ
 
S¶™WÜd
(
$sourû_ch¬£t
='utf-8', 
$rg‘_ch¬£t
='utf-8', 
$lßd_®l
=
TRUE
, 
$sourû
='')

100 
$this
->
__cÚ¡ruù
(
$sourû_ch¬£t
, 
$rg‘_ch¬£t
, 
$lßd_®l
, 
$sourû
);

106 
funùiÚ
 
	$__de¡ruù
()

108 ifĞ
$this
->
mašDicHªd
 !=ğ
FALSE
 )

110 @
	`fşo£
Ğ
$this
->
mašDicHªd
 );

112 
	}
}

119 
funùiÚ
 
	$_g‘_šdex
Ğ
$key
 )

121 
$l
 = 
	`¡¾’
(
$key
);

122 
$h
 = 0x238f13af;

123 
$l
--)

125 
$h
 += ($h << 5);

126 
$h
 ^ğ
	`Üd
(
$key
[
$l
]);

127 
$h
 &= 0x7fffffff;

129  (
$h
 % 
$this
->
mask_v®ue
);

130 
	}
}

138 
funùiÚ
 
G‘WÜdInfos
Ğ
$key
, 
$ty³
='word' )

140 ifĞ!
$this
->
mašDicHªd
 )

142 
$this
->
mašDicHªd
 = 
fİ’
($this->
mašDicFe
, 'r');

144 
	g$p
 = 0;

145 
	g$keynum
 = 
$this
->
_g‘_šdex
Ğ
$key
 );

146 ifĞ
is£t
(
$this
->
mašDicInfos
[ 
$keynum
 ]) )

148 
	g$d©a
 = 
$this
->
mašDicInfos
[ 
$keynum
 ];

153 
	g$move_pos
 = 
$keynum
 * 8;

154 
f£ek
(
$this
->
mašDicHªd
, 
$move_pos
, 
SEEK_SET
);

155 
	g$d©
 = 
ä—d
(
$this
->
mašDicHªd
, 8);

156 
	g$¬r
 = 
uÅack
('I1s/n1l/n1c', 
$d©
);

157 ifĞ
	g$¬r
['l'] == 0 )

159  
FALSE
;

161 
f£ek
(
$this
->
mašDicHªd
, 
$¬r
['s'], 
SEEK_SET
);

162 
	g$d©a
 = @
un£rŸlize
(
ä—d
(
$this
->
mašDicHªd
, 
$¬r
['l']));

163 
	g$this
->
	gmašDicInfos
[ 
$keynum
 ] = 
$d©a
;

165 ifĞ!
is_¬¿y
(
$d©a
è|| !
is£t
($d©a[
$key
]) )

167  
	gFALSE
;

169  (
	g$ty³
=='wÜd' ? 
$d©a
[
$key
] : $data);

180 
funùiÚ
 
S‘Sourû
Ğ
$sourû
, 
$sourû_ch¬£t
='utf-8', 
$rg‘_ch¬£t
='utf-8' )

182 
$this
->
sourûCh¬S‘
 = 
¡¹Şow”
(
$sourû_ch¬£t
);

183 
	g$this
->
	grg‘Ch¬S‘
 = 
¡¹Şow”
(
$rg‘_ch¬£t
);

184 
	g$this
->
	gsim¶eResuÉ
 = 
¬¿y
();

185 
	g$this
->
	gfš®lyResuÉ
 = 
¬¿y
();

186 
	g$this
->
	gfš®lyIndex
 = 
¬¿y
();

187 ifĞ
	g$sourû
 != '' )

189 
$rs
 = 
TRUE
;

190 ifĞ
´eg_m©ch
("/^utf/", 
$sourû_ch¬£t
) ) {

191 
	g$this
->
	gsourûSŒšg
 = @
icÚv
('utf-8', 
UCS2
, 
$sourû
);

193 ifĞ
´eg_m©ch
("/^gb/", 
$sourû_ch¬£t
) ) {

194 
	g$this
->
	gsourûSŒšg
 = @
icÚv
('utf-8', 
UCS2
, icÚv('gb18030', 'utf-8', 
$sourû
));

196 ifĞ
´eg_m©ch
("/^big/", 
$sourû_ch¬£t
) ) {

197 
	g$this
->
	gsourûSŒšg
 = @
icÚv
('utf-8', 
UCS2
, icÚv('big5', 'utf-8', 
$sourû
));

200 
	g$rs
 = 
FALSE
;

205 
	g$rs
 = 
FALSE
;

207  
	g$rs
;

216 
funùiÚ
 
	$S‘ResuÉTy³
Ğ
$r¡y³
 )

218 
$this
->
»suÉTy³
 = 
$r¡y³
;

219 
	}
}

226 
funùiÚ
 
LßdDiù
Ğ
$mašdic
='' )

228 
$this
->
addÚDicFe
 = 
XAKINC
.'/'.$this->addonDicFile;

229 
	g$this
->
	gmašDicFe
 = 
XAKINC
.'/'.
$this
->
mašDicFe
;

230 
	g$this
->
	gmašDicFeZ
 = 
XAKINC
.'/'.
$this
->
mašDicFeZ
;

231 
	g$¡¬‰
 = 
miüÙime
(
TRUE
);

233 
	g$dicAddÚ
 = 
$this
->
addÚDicFe
;

234 if(
	g$mašdic
=='' || !
fe_exi¡s
(
$mašdic
) )

236 
$dicWÜds
 = 
$this
->
mašDicFe
 ;

240 
	g$dicWÜds
 = 
$mašdic
;

241 
	g$this
->
	gmašDicFe
 = 
$mašdic
;

245 if(
	g$this
->
	gisUÅacked
){

246 
	g$this
->
	gmašDicHªd
 = 
fİ’
(
$dicWÜds
, 'r');

248 
	g$this
->
IÅÜtDiù
(
$this
->
mašDicFeZ
);

252 
	g$hw
 = '';

253 
	g$ds
 = 
fe
(
$dicAddÚ
);

254 
fÜ—ch
(
$ds
 
as
 
$d
)

256 
	g$d
 = 
Œim
(
$d
);

257 if(
	g$d
=='') ;

258 
	g$e¡r
 = 
sub¡r
(
$d
, 1, 1);

259 ifĞ
	g$e¡r
==':' ) {

260 
$hw
 = 
sub¡r
(
$d
, 0, 1);

264 
	g$¥¡r
 = 
_SP_
;

265 
	g$¥¡r
 = 
icÚv
(
UCS2
, 'utf-8', 
$¥¡r
);

266 
	g$ws
 = 
ex¶ode
(',', 
$d
);

267 
	g$w®l
 = 
icÚv
('utf-8', 
UCS2
, 
još
(
$¥¡r
, 
$ws
));

268 
	g$ws
 = 
ex¶ode
(
_SP_
, 
$w®l
);

269 
fÜ—ch
(
$ws
 
as
 
$e¡r
)

271 
	g$this
->
	gaddÚDic
[
$hw
][
$e¡r
] = 
¡¾’
($estr);

275 
	g$this
->
	glßdTime
 = 
miüÙime
(
TRUE
è- 
$¡¬‰
;

276 
	g$this
->
	gisLßdDic
 = 
TRUE
;

282 
funùiÚ
 
	$IsWÜd
Ğ
$wÜd
 )

284 
$wšfos
 = 
$this
->
	`G‘WÜdInfos
Ğ
$wÜd
 );

285  (
$wšfos
 !=ğ
FALSE
);

286 
	}
}

293 
funùiÚ
 
	$G‘WÜdPrİ”ty
(
$wÜd
)

295 ifĞ
	`¡¾’
(
$wÜd
)<4 )

299 
$šfos
 = 
$this
->
	`G‘WÜdInfos
(
$wÜd
);

300  
	`is£t
(
$šfos
[1]) ? "/{$infos[1]}{$infos[0]}" : "/s";

301 
	}
}

309 
funùiÚ
 
	$S‘WÜdInfos
(
$wÜd
, 
$šfos
)

311 ifĞ
	`¡¾’
(
$wÜd
)<4 )

315 ifĞ
	`is£t
(
$this
->
mašDicInfos
[
$wÜd
]) )

317 
$this
->
ÃwWÜds
[
$wÜd
]++;

318 
$this
->
mašDicInfos
[
$wÜd
]['c']++;

322 
$this
->
ÃwWÜds
[
$wÜd
] = 1;

323 
$this
->
mašDicInfos
[
$wÜd
] = 
$šfos
;

325 
	}
}

332 
funùiÚ
 
	$S¹AÇlysis
(
$İtimize
=
TRUE
)

334 ifĞ!
$this
->
isLßdDic
 )

336 
$this
->
	`LßdDiù
();

338 
$this
->
sim¶eResuÉ
 = $this->
fš®lyResuÉ
 = 
	`¬¿y
();

339 
$this
->
sourûSŒšg
 .ğ
	`chr
(0).chr(32);

340 
$¦’
 = 
	`¡¾’
(
$this
->
sourûSŒšg
);

341 
$sbcA¼
 = 
	`¬¿y
();

342 
$j
 = 0;

344 
$i
=0xFF00; $i < 0xFF5F; $i++)

346 
$scb
 = 0x20 + 
$j
;

347 
$j
++;

348 
$sbcA¼
[
$i
] = 
$scb
;

351 
$Ú¡r
 = '';

352 
$Ï¡c
 = 1;

353 
$s
 = 0;

354 
$ªsiWÜdM©ch
 = "[0-9a-z@#%\+\.-]";

355 
$nÙNumb”M©ch
 = "[a-z@#%\+]";

356 
$i
=0; $˜< 
$¦’
; $i++)

358 
$c
 = 
$this
->
sourûSŒšg
[
$i
].$this->sourceString[++$i];

359 
$ú
 = 
	`hexdec
(
	`bš2hex
(
$c
));

360 
$ú
 = 
	`is£t
(
$sbcA¼
[$cn]) ? $sbcArr[$cn] : $cn;

362 if(
$ú
 < 0x80)

364 ifĞ
	`´eg_m©ch
('/'.
$ªsiWÜdM©ch
.'/i', 
	`chr
(
$ú
)) )

366 ifĞ
$Ï¡c
 !ğ2 && 
$Ú¡r
 != '') {

367 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$Ú¡r
;

368 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 
$Ï¡c
;

369 
$this
->
	`_d“p_ª®ysis
(
$Ú¡r
, 
$Ï¡c
, 
$s
, 
$İtimize
);

370 
$s
++;

371 
$Ú¡r
 = '';

373 
$Ï¡c
 = 2;

374 
$Ú¡r
 .ğ
	`chr
(0).chr(
$ú
);

378 ifĞ
$Ú¡r
 != '' )

380 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$Ú¡r
;

381 ifĞ
$Ï¡c
==2 )

383 ifĞ!
	`´eg_m©ch
('/'.
$nÙNumb”M©ch
.'/i', 
	`icÚv
(
UCS2
, 'utf-8', 
$Ú¡r
)èè
$Ï¡c
 = 4;

385 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 
$Ï¡c
;

386 ifĞ
$Ï¡c
 !ğ4 ) 
$this
->
	`_d“p_ª®ysis
(
$Ú¡r
, $Ï¡c, 
$s
, 
$İtimize
);

387 
$s
++;

389 
$Ú¡r
 = '';

390 
$Ï¡c
 = 3;

391 if(
$ú
 < 31)

397 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
	`chr
(0).chr(
$ú
);

398 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 3;

399 
$s
++;

407 ifĞ(
$ú
>0x3FFF && $cn < 0x9FA6) || ($cn>0xF8FF && $cn < 0xFA2D)

408 || (
$ú
>0xABFF && $cn < 0xD7A4) || ($cn>0x3040 && $cn < 0x312B) )

410 ifĞ
$Ï¡c
 !ğ1 && 
$Ú¡r
 != '')

412 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$Ú¡r
;

413 ifĞ
$Ï¡c
==2 )

415 ifĞ!
	`´eg_m©ch
('/'.
$nÙNumb”M©ch
.'/i', 
	`icÚv
(
UCS2
, 'utf-8', 
$Ú¡r
)èè
$Ï¡c
 = 4;

417 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 
$Ï¡c
;

418 ifĞ
$Ï¡c
 !ğ4 ) 
$this
->
	`_d“p_ª®ysis
(
$Ú¡r
, $Ï¡c, 
$s
, 
$İtimize
);

419 
$s
++;

420 
$Ú¡r
 = '';

422 
$Ï¡c
 = 1;

423 
$Ú¡r
 .ğ
$c
;

428 ifĞ
$Ú¡r
 != '' )

430 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$Ú¡r
;

431 ifĞ
$Ï¡c
==2 )

433 ifĞ!
	`´eg_m©ch
('/'.
$nÙNumb”M©ch
.'/i', 
	`icÚv
(
UCS2
, 'utf-8', 
$Ú¡r
)èè
$Ï¡c
 = 4;

435 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 
$Ï¡c
;

436 ifĞ
$Ï¡c
 !ğ4 ) 
$this
->
	`_d“p_ª®ysis
(
$Ú¡r
, $Ï¡c, 
$s
, 
$İtimize
);

437 
$s
++;

441 ifĞ
$ú
 == 0x300A )

443 
$tmpw
 = '';

444 
$n
 = 1;

445 
$isok
 = 
FALSE
;

446 
$ew
 = 
	`chr
(0x30).chr(0x0B);

447 
TRUE
)

449 if(!
	`is£t
(
$this
->
sourûSŒšg
[
$i
+
$n
]) && !isset($this->sourceString[$i+$n+1]))

451 
$w
 = 
$this
->
sourûSŒšg
[
$i
+
$n
].$this->sourceString[$i+$n+1];

452 ifĞ
$w
 =ğ
$ew
 )

454 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$c
;

455 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 5;

456 
$s
++;

458 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$tmpw
;

459 
$this
->
ÃwWÜds
[
$tmpw
] = 1;

460 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[
$tmpw
]) )

462 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
(
$tmpw
).'/nb, ';

463 
$this
->
	`S‘WÜdInfos
(
$tmpw
, 
	`¬¿y
('c'=>1, 'm'=>'nb'));

465 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 13;

467 
$s
++;

470 ifĞ
$this
->
difãrMax
 )

472 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$tmpw
;

473 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 21;

474 
$this
->
	`_d“p_ª®ysis
(
$tmpw
, 
$Ï¡c
, 
$s
, 
$İtimize
);

475 
$s
++;

478 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$ew
;

479 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 5;

480 
$s
++;

482 
$i
 = $˜+ 
$n
 + 1;

483 
$isok
 = 
TRUE
;

484 
$Ú¡r
 = '';

485 
$Ï¡c
 = 5;

490 
$n
 = $n+2;

491 
$tmpw
 .ğ
$w
;

492 ifĞ
	`¡¾’
(
$tmpw
) > 60 )

498 ifĞ!
$isok
 )

500 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$c
;

501 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 5;

502 
$s
++;

503 
$Ú¡r
 = '';

504 
$Ï¡c
 = 5;

509 
$Ú¡r
 = '';

510 
$Ï¡c
 = 5;

511 ifĞ
$ú
==0x3000 )

517 
$this
->
sim¶eResuÉ
[
$s
]['w'] = 
$c
;

518 
$this
->
sim¶eResuÉ
[
$s
]['t'] = 5;

519 
$s
++;

528 
$this
->
	`_sÜt_fš®ly_»suÉ
();

529 
	}
}

538 
funùiÚ
 
	$_d“p_ª®ysis
Ğ&
$¡r
, 
$ùy³
, 
$¥os
, 
$İtimize
=
TRUE
 )

542 ifĞ
$ùy³
==1 )

544 
$¦’
 = 
	`¡¾’
(
$¡r
);

546 ifĞ
$¦’
 < 
$this
->
nÙS¶™L’
 )

548 
$tmp¡r
 = '';

549 
$Ï¡Ty³
 = 0;

550 ifĞ
$¥os
 > 0 ) 
$Ï¡Ty³
 = 
$this
->
sim¶eResuÉ
[$spos-1]['t'];

551 if(
$¦’
 < 5)

554 ifĞ
$Ï¡Ty³
==4 && ( 
	`is£t
(
$this
->
addÚDic
['u'][
$¡r
]è|| is£t($this->addÚDic['u'][
	`sub¡r
($str, 0, 2)]) ) )

556 
$¡r2
 = '';

557 ifĞ!
	`is£t
(
$this
->
addÚDic
['u'][
$¡r
]è&& is£t($this->addÚDic['s'][
	`sub¡r
($str, 2, 2)]) )

559 
$¡r2
 = 
	`sub¡r
(
$¡r
, 2, 2);

560 
$¡r
 = 
	`sub¡r
($str, 0, 2);

562 
$ww
 = 
$this
->
sim¶eResuÉ
[
$¥os
 - 1]['w'].
$¡r
;

563 
$this
->
sim¶eResuÉ
[
$¥os
 - 1]['w'] = 
$ww
;

564 
$this
->
sim¶eResuÉ
[
$¥os
 - 1]['t'] = 4;

565 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[$this->
sim¶eResuÉ
[
$¥os
 - 1]['w']]) )

567 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
Ğ
$ww
 ).'/mu, ';

568 
$this
->
	`S‘WÜdInfos
(
$ww
, 
	`¬¿y
('c'=>1, 'm'=>'mu'));

570 
$this
->
sim¶eResuÉ
[
$¥os
]['w'] = '';

571 ifĞ
$¡r2
 != '' )

573 
$this
->
fš®lyResuÉ
[
$¥os
-1][] = 
$ww
;

574 
$this
->
fš®lyResuÉ
[
$¥os
-1][] = 
$¡r2
;

578 
$this
->
fš®lyResuÉ
[
$¥os
][] = 
$¡r
;

583 
$this
->
	`_d“p_ª®ysis_ú
Ğ
$¡r
, 
$ùy³
, 
$¥os
, 
$¦’
, 
$İtimize
 );

589 
$this
->
	`_d“p_ª®ysis_ú
Ğ
$¡r
, 
$ùy³
, 
$¥os
, 
$¦’
, 
$İtimize
 );

595 ifĞ
$this
->
toLow”
 ) {

596 
$this
->
fš®lyResuÉ
[
$¥os
][] = 
	`¡¹Şow”
(
$¡r
);

599 
$this
->
fš®lyResuÉ
[
$¥os
][] = 
$¡r
;

602 
	}
}

609 
funùiÚ
 
	$_d“p_ª®ysis_ú
Ğ&
$¡r
, 
$Ï¡ec
, 
$¥os
, 
$¦’
, 
$İtimize
=
TRUE
 )

611 
$quÙe1
 = 
	`chr
(0x20).chr(0x1C);

612 
$tm·¼
 = 
	`¬¿y
();

613 
$hasw
 = 0;

615 ifĞ
$¥os
 > 0 && 
$¦’
 < 11 && 
$this
->
sim¶eResuÉ
[$¥os-1]['w']==
$quÙe1
 )

617 
$tm·¼
[] = 
$¡r
;

618 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[
$¡r
]) )

620 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
(
$¡r
).'/nq, ';

621 
$this
->
	`S‘WÜdInfos
(
$¡r
, 
	`¬¿y
('c'=>1, 'm'=>'nq'));

623 ifĞ!
$this
->
difãrMax
 )

625 
$this
->
fš®lyResuÉ
[
$¥os
][] = 
$¡r
;

630 
$i
=
$¦’
-1; $i > 0; $i -= 2)

633 
$nc
 = 
$¡r
[
$i
-1].$str[$i];

635 ifĞ
$i
 <= 2 )

637 
$tm·¼
[] = 
$nc
;

638 
$i
 = 0;

641 
$isok
 = 
FALSE
;

642 
$i
 = $i + 1;

643 
$k
=
$this
->
dicWÜdMax
; $k>1; $k=$k-2)

645 if(
$i
 < 
$k
) ;

646 
$w
 = 
	`sub¡r
(
$¡r
, 
$i
-
$k
, $k);

647 ifĞ
	`¡¾’
(
$w
) <= 2 )

649 
$i
 = $i - 1;

652 ifĞ
$this
->
	`IsWÜd
Ğ
$w
 ) )

654 
$tm·¼
[] = 
$w
;

655 
$i
 = $˜- 
$k
 + 1;

656 
$isok
 = 
TRUE
;

662 if(!
$isok
è
$tm·¼
[] = 
$nc
;

664 
$wcouÁ
 = 
	`couÁ
(
$tm·¼
);

665 ifĞ
$wcouÁ
==0 )  ;

666 
$this
->
fš®lyResuÉ
[
$¥os
] = 
	`¬¿y_»v”£
(
$tm·¼
);

668 ifĞ
$İtimize
 )

670 
$this
->
	`_İtimize_»suÉ
Ğ$this->
fš®lyResuÉ
[
$¥os
], $spos );

672 
	}
}

680 
funùiÚ
 
	$_İtimize_»suÉ
Ğ&
$sm¬r
, 
$¥os
 )

682 
$Ãw¬r
 = 
	`¬¿y
();

683 
$´ePos
 = 
$¥os
 - 1;

684 
$¬Ën
 = 
	`couÁ
(
$sm¬r
);

685 
$i
 = 
$j
 = 0;

687 ifĞ
$´ePos
 > -1 && !
	`is£t
(
$this
->
fš®lyResuÉ
[$prePos]) )

689 
$Ï¡w
 = 
$this
->
sim¶eResuÉ
[
$´ePos
]['w'];

690 
$Ï¡t
 = 
$this
->
sim¶eResuÉ
[
$´ePos
]['t'];

691 ifĞ(
$Ï¡t
==4 || 
	`is£t
Ğ
$this
->
addÚDic
['c'][
$Ï¡w
] )è&& is£tĞ$this->addÚDic['u'][
$sm¬r
[0]] ) )

693 
$this
->
sim¶eResuÉ
[
$´ePos
]['w'] = 
$Ï¡w
.
$sm¬r
[0];

694 
$this
->
sim¶eResuÉ
[
$´ePos
]['t'] = 4;

695 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[ $this->
sim¶eResuÉ
[
$´ePos
]['w'] ]) )

697 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
Ğ$this->
sim¶eResuÉ
[
$´ePos
]['w'] ).'/mu, ';

698 
$this
->
	`S‘WÜdInfos
($this->
sim¶eResuÉ
[
$´ePos
]['w'], 
	`¬¿y
('c'=>1, 'm'=>'mu'));

700 
$sm¬r
[0] = '';

701 
$i
++;

704 ; 
$i
 < 
$¬Ën
; $i++)

707 ifĞ!
	`is£t
Ğ
$sm¬r
[
$i
+1] ) )

709 
$Ãw¬r
[
$j
] = 
$sm¬r
[
$i
];

712 
$cw
 = 
$sm¬r
[
$i
];

713 
$nw
 = 
$sm¬r
[
$i
+1];

714 
$ischeck
 = 
FALSE
;

716 ifĞ
	`is£t
Ğ
$this
->
addÚDic
['c'][
$cw
] ) && is£tĞ$this->addÚDic['u'][
$nw
] ) )

719 if(
$this
->
difãrMax
)

721 
$Ãw¬r
[
$j
] = 
	`chr
(0).chr(0x28);

722 
$j
++;

723 
$Ãw¬r
[
$j
] = 
$cw
;

724 
$j
++;

725 
$Ãw¬r
[
$j
] = 
$nw
;

726 
$j
++;

727 
$Ãw¬r
[
$j
] = 
	`chr
(0).chr(0x29);

728 
$j
++;

730 
$Ãw¬r
[
$j
] = 
$cw
.
$nw
;

731 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[
$Ãw¬r
[
$j
]]) )

733 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
Ğ
$Ãw¬r
[
$j
] ).'/mu, ';

734 
$this
->
	`S‘WÜdInfos
(
$Ãw¬r
[
$j
], 
	`¬¿y
('c'=>1, 'm'=>'mu'));

736 
$j
++; 
$i
++; 
$ischeck
 = 
TRUE
;

739 ifĞ
	`is£t
Ğ
$this
->
addÚDic
['n'][ 
$sm¬r
[
$i
] ] ) )

741 
$is_rs
 = 
FALSE
;

743 ifĞ
	`¡¾’
(
$nw
)==4 )

745 
$wšfos
 = 
$this
->
	`G‘WÜdInfos
(
$nw
);

746 if(
	`is£t
(
$wšfos
['m']) && ($winfos['m']=='r' || $winfos['m']=='c' || $winfos['c']>500) )

748 
$is_rs
 = 
TRUE
;

751 ifĞ!
	`is£t
(
$this
->
addÚDic
['s'][
$nw
]è&& 
	`¡¾’
($nw)<5 && !
$is_rs
 )

753 
$Ãw¬r
[
$j
] = 
$cw
.
$nw
;

756 ifĞ
	`¡¾’
(
$nw
)==2 && 
	`is£t
(
$sm¬r
[
$i
+2]è&& sŒËn($sm¬r[$i+2])==2 && !is£tĞ
$this
->
addÚDic
['s'][$smarr[$i+2]] ) )

758 
$Ãw¬r
[
$j
] .ğ
$sm¬r
[
$i
+2];

759 
$i
++;

761 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[
$Ãw¬r
[
$j
]]) )

763 
$this
->
	`S‘WÜdInfos
(
$Ãw¬r
[
$j
], 
	`¬¿y
('c'=>1, 'm'=>'nr'));

764 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
(
$Ãw¬r
[
$j
]).'/nr, ';

767 if(
	`¡¾’
(
$nw
)==4)

769 
$j
++;

770 
$Ãw¬r
[
$j
] = 
	`chr
(0).chr(0x28);

771 
$j
++;

772 
$Ãw¬r
[
$j
] = 
$cw
;

773 
$j
++;

774 
$Ãw¬r
[
$j
] = 
$nw
;

775 
$j
++;

776 
$Ãw¬r
[
$j
] = 
	`chr
(0).chr(0x29);

779 
$j
++; 
$i
++; 
$ischeck
 = 
TRUE
;

783 ifĞ
	`is£t
(
$this
->
addÚDic
['a'][
$nw
]) )

785 
$is_rs
 = 
FALSE
;

787 ifĞ
	`¡¾’
(
$cw
)>2 )

789 
$wšfos
 = 
$this
->
	`G‘WÜdInfos
(
$cw
);

790 if(
	`is£t
(
$wšfos
['m']) && ($winfos['m']=='a' || $winfos['m']=='r' || $winfos['m']=='c' || $winfos['c']>500) )

792 
$is_rs
 = 
TRUE
;

795 ifĞ!
	`is£t
(
$this
->
addÚDic
['s'][
$cw
]è&& !
$is_rs
 )

797 
$Ãw¬r
[
$j
] = 
$cw
.
$nw
;

798 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[
$Ãw¬r
[
$j
]]) )

800 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
(
$Ãw¬r
[
$j
]).'/na, ';

801 
$this
->
	`S‘WÜdInfos
(
$Ãw¬r
[
$j
], 
	`¬¿y
('c'=>1, 'm'=>'na'));

803 
$i
++; 
$j
++; 
$ischeck
 = 
TRUE
;

807 if(
$this
->
un™WÜd
)

809 if(
	`¡¾’
(
$cw
)==2 && sŒËn(
$nw
)==2

810 && !
	`is£t
(
$this
->
addÚDic
['s'][
$cw
]) && !isset($this->addonDic['t'][$cw]) && !isset($this->addonDic['a'][$cw])

811 && !
	`is£t
(
$this
->
addÚDic
['s'][
$nw
]) && !isset($this->addonDic['c'][$nw]))

813 
$Ãw¬r
[
$j
] = 
$cw
.
$nw
;

815 ifĞ
	`is£t
(
$sm¬r
[
$i
+2]è&& 
	`¡¾’
($sm¬r[$i+2])==2 && (is£tĞ
$this
->
addÚDic
['a'][$smarr[$i+2]] ) || isset( $this->addonDic['u'][$smarr[$i+2]] )) )

817 
$Ãw¬r
[
$j
] .ğ
$sm¬r
[
$i
+2];

818 
$i
++;

820 ifĞ!
	`is£t
(
$this
->
ÃwWÜds
[
$Ãw¬r
[
$j
]]) )

822 
$this
->
foundWÜdSŒ
 .ğ$this->
	`_out_¡ršg_’codšg
(
$Ãw¬r
[
$j
]).'/ms, ';

823 
$this
->
	`S‘WÜdInfos
(
$Ãw¬r
[
$j
], 
	`¬¿y
('c'=>1, 'm'=>'ms'));

825 
$i
++; 
$j
++; 
$ischeck
 = 
TRUE
;

830 ifĞ!
$ischeck
 )

832 
$Ãw¬r
[
$j
] = 
$cw
;

834 ifĞ
$this
->
difãrMax
 && !
	`is£t
($this->
addÚDic
['s'][
$cw
]è&& 
	`¡¾’
($cwè< 5 && sŒËn(
$nw
) < 7)

836 
$¦’
 = 
	`¡¾’
(
$nw
);

837 
$hasDiff
 = 
FALSE
;

838 
$y
=2; $y <ğ
$¦’
-2; $y=$y+2)

840 
$nh—d
 = 
	`sub¡r
(
$nw
, 
$y
-2, 2);

841 
$nfÚt
 = 
$cw
.
	`sub¡r
(
$nw
, 0, 
$y
-2);

842 ifĞ
$this
->
	`IsWÜd
Ğ
$nfÚt
.
$nh—d
 ) )

844 ifĞ
	`¡¾’
(
$cw
è> 2 ) 
$j
++;

845 
$hasDiff
 = 
TRUE
;

846 
$Ãw¬r
[
$j
] = 
$nfÚt
.
$nh—d
;

850 
$j
++;

854 
$sm¬r
 = 
$Ãw¬r
;

855 
	}
}

861 
funùiÚ
 
	$_sÜt_fš®ly_»suÉ
()

863 
$Ãw¬r
 = 
	`¬¿y
();

864 
$i
 = 0;

865 
	`fÜ—ch
(
$this
->
sim¶eResuÉ
 
as
 
$k
=>
$v
)

867 ifĞ
	`em±y
(
$v
['w']) ) ;

868 ifĞ
	`is£t
(
$this
->
fš®lyResuÉ
[
$k
]è&& 
	`couÁ
($this->finallyResult[$k]) > 0 )

870 
	`fÜ—ch
(
$this
->
fš®lyResuÉ
[
$k
] 
as
 
$w
)

872 if(!
	`em±y
(
$w
))

874 
$Ãw¬r
[
$i
]['w'] = 
$w
;

875 
$Ãw¬r
[
$i
]['t'] = 20;

876 
$i
++;

880 if(
$v
['t'] != 21)

882 
$Ãw¬r
[
$i
]['w'] = 
$v
['w'];

883 
$Ãw¬r
[
$i
]['t'] = 
$v
['t'];

884 
$i
++;

887 
$this
->
fš®lyResuÉ
 = 
$Ãw¬r
;

888 
$Ãw¬r
 = '';

889 
	}
}

896 
funùiÚ
 
	$_out_¡ršg_’codšg
Ğ&
$¡r
 )

898 
$rsc
 = 
$this
->
	`_sourû_»suÉ_ch¬£t
();

899 ifĞ
$rsc
==1 ) {

900 
$rs¡r
 = 
	`icÚv
(
UCS2
, 'utf-8', 
$¡r
);

902 ifĞ
$rsc
==2 ) {

903 
$rs¡r
 = 
	`icÚv
('utf-8', 'gb18030', icÚv(
UCS2
, 'utf-8', 
$¡r
) );

906 
$rs¡r
 = 
	`icÚv
('utf-8', 'big5', icÚv(
UCS2
, 'utf-8', 
$¡r
) );

908  
$rs¡r
;

909 
	}
}

915 
funùiÚ
 
G‘Fš®lyResuÉ
(
$¥wÜd
=' ', 
$wÜd_m—nšgs
=
FALSE
)

917 
$rs¡r
 = '';

918 
fÜ—ch
(
$this
->
fš®lyResuÉ
 
as
 
$v
)

920 ifĞ
	g$this
->
	g»suÉTy³
==2 && (
$v
['t']==3 || $v['t']==5) )

924 
	g$m
 = '';

925 ifĞ
	g$wÜd_m—nšgs
 )

927 
	g$m
 = 
$this
->
G‘WÜdPrİ”ty
(
$v
['w']);

929 
	g$w
 = 
$this
->
_out_¡ršg_’codšg
(
$v
['w']);

930 ifĞ
	g$w
 != ' ' )

932 if(
$wÜd_m—nšgs
) {

933 
$rs¡r
 .ğ
$¥wÜd
.
$w
.
$m
;

936 
	g$rs¡r
 .ğ
$¥wÜd
.
$w
;

940  
	g$rs¡r
;

947 
funùiÚ
 
	$G‘Sim¶eResuÉ
()

949 
$»¬r
 = 
	`¬¿y
();

950 
	`fÜ—ch
(
$this
->
sim¶eResuÉ
 
as
 
$k
=>
$v
)

952 ifĞ
	`em±y
(
$v
['w']) ) ;

953 
$w
 = 
$this
->
	`_out_¡ršg_’codšg
(
$v
['w']);

954 ifĞ
$w
 !ğ' ' ) 
$»¬r
[] = $w;

956  
$»¬r
;

957 
	}
}

963 
funùiÚ
 
	$G‘Sim¶eResuÉAÎ
()

965 
$»¬r
 = 
	`¬¿y
();

966 
	`fÜ—ch
(
$this
->
sim¶eResuÉ
 
as
 
$k
=>
$v
)

968 
$w
 = 
$this
->
	`_out_¡ršg_’codšg
(
$v
['w']);

969 ifĞ
$w
 != ' ' )

971 
$»¬r
[
$k
]['w'] = 
$w
;

972 
$»¬r
[
$k
]['t'] = 
$v
['t'];

975  
$»¬r
;

976 
	}
}

982 
funùiÚ
 
	$G‘Fš®lyIndex
()

984 
$»¬r
 = 
	`¬¿y
();

985 
	`fÜ—ch
(
$this
->
fš®lyResuÉ
 
as
 
$v
)

987 ifĞ
$this
->
»suÉTy³
==2 && (
$v
['t']==3 || $v['t']==5) )

991 
$w
 = 
$this
->
	`_out_¡ršg_’codšg
(
$v
['w']);

992 ifĞ
$w
 == ' ' )

996 ifĞ
	`is£t
(
$»¬r
[
$w
]) )

998 
$»¬r
[
$w
]++;

1002 
$»¬r
[
$w
] = 1;

1005  
$»¬r
;

1006 
	}
}

1012 
funùiÚ
 
	$_sourû_»suÉ_ch¬£t
()

1014 ifĞ
	`´eg_m©ch
("/^utf/", 
$this
->
rg‘Ch¬S‘
) ) {

1015 
$rs
 = 1;

1017 ifĞ
	`´eg_m©ch
("/^gb/", 
$this
->
rg‘Ch¬S‘
) ) {

1018 
$rs
 = 2;

1020 ifĞ
	`´eg_m©ch
("/^big/", 
$this
->
rg‘Ch¬S‘
) ) {

1021 
$rs
 = 3;

1024 
$rs
 = 4;

1026  
$rs
;

1027 
	}
}

1035 
funùiÚ
 
MakeDiù
Ğ
$sourû_fe
, 
$rg‘_fe
='' )

1037 
$rg‘_fe
 = ($rg‘_fe=='' ? 
$this
->
mašDicFe
 : $target_file);

1038 
	g$®lk
 = 
¬¿y
();

1039 
	g$å
 = 
fİ’
(
$sourû_fe
, 'r');

1040  
	g$lše
 = 
fg‘s
(
$å
, 512) )

1042 ifĞ
	g$lše
[0]=='@' ) ;

1043 
li¡
(
$w
, 
$r
, 
$a
èğ
ex¶ode
(',', 
$lše
);

1044 
	g$a
 = 
Œim
Ğ
$a
 );

1045 
	g$w
 = 
icÚv
('utf-8', 
UCS2
, 
$w
);

1046 
	g$k
 = 
$this
->
_g‘_šdex
Ğ
$w
 );

1047 ifĞ
is£t
(
$®lk
[ 
$k
 ]) )

1048 
	g$®lk
[ 
$k
 ][ 
$w
 ] = 
¬¿y
(
$r
, 
$a
);

1050 
	g$®lk
[ 
$k
 ][ 
$w
 ] = 
¬¿y
(
$r
, 
$a
);

1052 
fşo£
Ğ
$å
 );

1053 
	g$å
 = 
fİ’
(
$rg‘_fe
, 'w');

1054 
	g$h—de_¿¼
 = 
¬¿y
();

1055 
	g$®ld©
 = '';

1056 
	g$¡¬t_pos
 = 
$this
->
mask_v®ue
 * 8;

1057 
fÜ—ch
Ğ
$®lk
 
as
 
$k
 => 
$v
 )

1059 
$d©
 = 
£rŸlize
Ğ
$v
 );

1060 
	g$dËn
 = 
¡¾’
(
$d©
);

1061 
	g$®ld©
 .ğ
$d©
;

1063 
	g$h—de_¿¼
[ 
$k
 ][0] = 
$¡¬t_pos
;

1064 
	g$h—de_¿¼
[ 
$k
 ][1] = 
$dËn
;

1065 
	g$h—de_¿¼
[ 
$k
 ][2] = 
couÁ
Ğ
$v
 );

1067 
	g$¡¬t_pos
 +ğ
$dËn
;

1069 
un£t
Ğ
$®lk
 );

1070 
	g$i
=0; $˜< 
	g$this
->
	gmask_v®ue
; $i++)

1072 ifĞ!
is£t
(
$h—de_¿¼
[
$i
]) )

1074 
	g$h—de_¿¼
[
$i
] = 
¬¿y
(0, 0, 0);

1076 
fwr™e
(
$å
, 
·ck
("IÂ", 
$h—de_¿¼
[
$i
][0], $heade_rarr[$i][1], $heade_rarr[$i][2]));

1078 
fwr™e
Ğ
$å
, 
$®ld©
);

1079 
fşo£
Ğ
$å
 );

1087 
funùiÚ
 
	$ExpÜtDiù
Ğ
$rg‘fe
 )

1089 ifĞ!
$this
->
mašDicHªd
 )

1091 
$this
->
mašDicHªd
 = 
	`fİ’
($this->
mašDicFe
, 'rw');

1093 
$å
 = 
	`fİ’
(
$rg‘fe
, 'w');

1094 
$i
=0; $˜<ğ
$this
->
mask_v®ue
; $i++)

1096 
$move_pos
 = 
$i
 * 8;

1097 
	`f£ek
(
$this
->
mašDicHªd
, 
$move_pos
, 
SEEK_SET
);

1098 
$d©
 = 
	`ä—d
(
$this
->
mašDicHªd
, 8);

1099 
$¬r
 = 
	`uÅack
('I1s/n1l/n1c', 
$d©
);

1100 ifĞ
$¬r
['l'] == 0 )

1104 
	`f£ek
(
$this
->
mašDicHªd
, 
$¬r
['s'], 
SEEK_SET
);

1105 
$d©a
 = @
	`un£rŸlize
(
	`ä—d
(
$this
->
mašDicHªd
, 
$¬r
['l']));

1106 ifĞ!
	`is_¬¿y
(
$d©a
) ) ;

1107 
	`fÜ—ch
(
$d©a
 
as
 
$k
 => 
$v
)

1109 
$w
 = 
	`icÚv
(
UCS2
, 'utf-8', 
$k
);

1110 
	`fwr™e
(
$å
, "{$w},{$v[0]},{$v[1]}\n");

1113 
	`fşo£
Ğ
$å
 );

1114  
TRUE
;

1115 
	}
}

1117 
funùiÚ
 
	$IÅÜtDiù
Ğ
$rg‘fe
 )

1119 if(!
	`ši_£t
('memory_limit', '128M'))

1120 
	`ex™
('è®¾ç½®å†…å­˜é”™è¯¯!');

1121 
	`»quœe_Úû
(
XAKINC
.'/zip.class.php');

1122 
$z
 = 
Ãw
 
	`z
();

1124 
$uÅackagefe
 = 
	`¬¿y_keys
(
$z
->
	`ExŒaù
(
$rg‘fe
,
XAKINC
.'/data/'));

1126 
$this
->
	`MakeDiù
(
XAKINC
.'/d©a/'.
$uÅackagefe
[0]);

1127 
	`uÆšk
(
XAKINC
.'/d©a/'.
$uÅackagefe
[0]);

1128  
Œue
;

1129 
	}
}

	@E:\web\weixun\functions\taglib\ad.lib.php

1 <?
php


10 
funùiÚ
 
	$lib_ad
(&
$ùag
,&
$»fObj
)

12 
glob®
 
$dsql
;

14 
$©i¡
 = "name|";

15 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

16 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

17 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

19 
$likeTy³
 = '';

21 
$ÿcheid
 = 
	`Œim
($cacheid);

22 if(
$ÿcheid
 !='')

24 
$likeTy³
 = 
	`G‘CacheBlock
(
$ÿcheid
);

25 if(
$likeTy³
 != '')

26  
$likeTy³
;

30 
$ÃedR–
 = 
çl£
;

31 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

32 
$d2
->
	`S‘NameS·û
('field','[',']');

33 
$d2
->
	`LßdSourû
(
$šÃ¹ext
);

35 
$ty³sql
 = '';

36 ifĞ!
	`em±y
(
$»fObj
->
F›lds
['ty³id']èè
$ty³id
 = $refObj->Fields['typeid'];

37 if(
$ty³id
 > 0)

39 
$ty³sql
 = " Andy³id in(0,".
	`G‘Tİids
(
$ty³id
).") ";

43 
$ty³sql
 = " ANDypeid= 0";

46 
$sql
 = "SELECT * FROM `#@__rpad` WHEREagname†ike '$name' AND‡dtype != 'slide' $typesql order byypeid desc";

47 
$bªÃrInfo
 = 
$dsql
->
	`G‘OÃ
(
$sql
);

48 
$nÜm·¿ms
[0] = 
	`un£rŸlize
(
$bªÃrInfo
['normparams']);

51 
	`fÜ—ch
(
$nÜm·¿ms
 
as
 
$v®ue
)

53 if(
	`is_¬¿y
(
$d2
->
CTags
))

55 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
)

57 if(
$ùag
->
	`G‘Name
()=='array')

60 
$d2
->
	`Assign
(
$gid
, 
$v®ue
);

64 if(
	`is£t
(
$v®ue
[
$ùag
->
	`G‘Name
()])){

65 
$d2
->
	`Assign
(
$gid
,
$v®ue
[
$ùag
->
	`G‘Name
()]);

70 
$likeTy³
 .ğ
$d2
->
	`G‘ResuÉ
();

74 
$dsql
->
	`F»eResuÉ
();

75 if(
$ÿcheid
 !='') {

76 
	`Wr™eCacheBlock
(
$ÿcheid
, 
$likeTy³
);

79  
$likeTy³
;

80 
	}
}

	@E:\web\weixun\functions\taglib\adminname.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

17 
funùiÚ
 
	$lib_admšÇme
(&
$ùag
, &
$»fObj
)

19 
glob®
 
$dsql
;

20 if(
	`em±y
(
$»fObj
->
F›lds
['dutyadmin']))

22 
$dutyadmš
 = 
$GLOBALS
['cfg_df_dutyadmin'];

26 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT uname FROM `#@__admin_list` WHERE id='{$refObj->Fields['dutyadmin']}' ");

27 
$dutyadmš
 = 
	`is£t
(
$row
['uÇme']è? $row['uÇme'] : 
$GLOBALS
['cfg_df_dutyadmin'];

29  
$dutyadmš
;

30 
	}
}

	@E:\web\weixun\functions\taglib\arclist.lib.php

1 <?
php


3 if(!
defšed
('XAKINC')è
ex™
('Warning...');

22 
funùiÚ
 
	$lib_¬şi¡
Ğ&
$ùag
, &
$»fObj
 )

24 
glob®
 
$’vs
;

26 
$autİ¬tid
 = 0;

27 
$gid
 = '';

28 
$gÇme
 = 
$ùag
->
	`G‘TagName
();

29 
$chªÃlid
 = 
$ùag
->
	`G‘A‰
('channelid');

32 
$·gesize
 = 
$ùag
->
	`G‘A‰
('pagesize');

33 if(
$·gesize
 == '')

35 
$muÉi
 = 0;

37 
$gid
 = 
$ùag
->
	`G‘A‰
('tagid');

40 
$isweight
 = 
$ùag
->
	`G‘A‰
('isweight');

42 if(
$gÇme
=='imglist' || $tagname=='imginfolist') {

43 
$li¡ty³
 = 'image';

45 if(
$gÇme
=='specart') {

46 
$chªÃlid
 = -1;

47 
$li¡ty³
='';

49 if(
$gÇme
=='coolart') {

50 
$li¡ty³
 = 'commend';

52 if(
$gÇme
=='autolist') {

53 
$autİ¬tid
 = 
$ùag
->
	`G‘A‰
('partsort');

56 
$li¡ty³
 = 
$ùag
->
	`G‘A‰
('type');

60 if(
$ùag
->
	`G‘A‰
('sÜt')!=''è
$Üd”by
 = $ctag->GetAtt('sort');

61 if(
$gÇme
=='hÙ¬t'è
$Üd”by
 = 'click';

62 
$Üd”by
 = 
$ùag
->
	`G‘A‰
('orderby');

65 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
()è!ğ''è
$šÃ¹ext
 = $ctag->GetInnerText();

66 if(
$gÇme
=='imgli¡'è
$šÃ¹ext
 = 
	`G‘SysTem¶‘s
('part_imglist.htm');

67 if(
$gÇme
=='imgšfŞi¡'è
$šÃ¹ext
 = 
	`G‘SysTem¶‘s
('part_imginfolist.htm');

68 
$šÃ¹ext
 = 
	`G‘SysTem¶‘s
("part_arclist.htm");

71 if(
$ùag
->
	`G‘A‰
('t™ËËngth')!=''è
$t™ËËn
 = $ctag->GetAtt('titlelength');

72 
$t™ËËn
 = 
$ùag
->
	`G‘A‰
('titlelen');

75 if(
$ùag
->
	`G‘A‰
('šfŞ’gth')!=''è
$šfŞ’
 = $ctag->GetAtt('infolength');

76 
$šfŞ’
 = 
$ùag
->
	`G‘A‰
('infolen');

78 
$i¡y³id2
 = 
	`Œim
(
$ùag
->
	`G‘A‰
('istypeid2'));

80 
$ty³id
 = 
	`Œim
(
$ùag
->
	`G‘A‰
('typeid'));

81 if(
	`em±y
(
$ty³id
)) {

82 
$ty³id
 = ( 
	`is£t
(
$»fObj
->
F›lds
['ty³id']è? $»fObj->F›lds['ty³id'] : 
$’vs
['typeid'] );

85 if(
$li¡ty³
=='autolist') {

86 
$ty³id
 = 
	`lib_G‘AutoChªÃlID
(
$ùag
->
	`G‘A‰
('partsort'),$typeid);

89 if(
$ùag
->
	`G‘A‰
('att')=='') {

90 
$æag
 = 
$ùag
->
	`G‘A‰
('flag');

93 
$æag
 = 
$ùag
->
	`G‘A‰
('att');

96  
lib_¬şi¡DÚe


98 
$»fObj
, 
$ùag
, 
$ty³id
, $ùag->
	`G‘A‰
('row'), $ùag->G‘A‰('cŞ'), 
$t™ËËn
, 
$šfŞ’
,

99 
$ùag
->
	`G‘A‰
('imgwidth'), $ùag->G‘A‰('imgheight'), 
$li¡ty³
, 
$Üd”by
,

100 
$ùag
->
	`G‘A‰
('keywÜd'), 
$šÃ¹ext
, 
$’vs
['aid'], $ùag->G‘A‰('idli¡'), 
$chªÃlid
,

101 
$ùag
->
	`G‘A‰
('lim™'), 
$æag
,$ctag->GetAtt('orderway'), $ctag->GetAtt('subday'), $ctag->GetAtt('noflag'),

102 
$gid
,
$·gesize
,
$isweight
,
$i¡y³id2


104 
	}
}

136 
funùiÚ
 
lib_¬şi¡DÚe
(&
$»fObj
, &
$ùag
, 
$ty³id
=0, 
$row
=10, 
$cŞ
=1, 
$t™ËËn
=30, 
$šfŞ’
=160,

137 
$imgwidth
=120, 
$imgheight
=90, 
$li¡ty³
='®l', 
$Üd”by
='deçuÉ', 
$keywÜd
='',

138 
$šÃ¹ext
='', 
$¬cid
=0, 
$idli¡
='', 
$chªÃlid
=0, 
$lim™
='', 
$©t
='', 
$Üd”
='desc', 
$subday
=0, 
$noæag
='',
$gid
='', 
$·gesize
=0, 
$isweight
='N',
$i¡y³id2
=0)

140 
glob®
 
$dsql
,
$PubF›lds
,
$cfg_keywÜd_like
,
$cfg_šdex_ÿche
,
$_¬şi¡Env
,
$’vs
,
$cfg_ÿche_ty³
,
$cfg_digg_upd©e
;

141 
	g$row
 = 
A‰Def
(
$row
,10);

142 
	g$t™ËËn
 = 
A‰Def
(
$t™ËËn
,30);

143 
	g$šfŞ’
 = 
A‰Def
(
$šfŞ’
,160);

144 
	g$imgwidth
 = 
A‰Def
(
$imgwidth
,120);

145 
	g$imgheight
 = 
A‰Def
(
$imgheight
,120);

146 
	g$li¡ty³
 = 
A‰Def
(
$li¡ty³
,'all');

147 
	g$¬cid
 = 
A‰Def
(
$¬cid
,0);

148 
	g$chªÃlid
 = 
A‰Def
(
$chªÃlid
,0);

149 
	g$Üd”by
 = 
A‰Def
(
$Üd”by
,'default');

150 
	g$Üd”Way
 = 
A‰Def
(
$Üd”
,'desc');

151 
	g$subday
 = 
A‰Def
(
$subday
,0);

152 
	g$·gesize
 = 
A‰Def
(
$·gesize
,0);

153 
	g$lše
 = 
$row
;

154 
	g$Üd”by
 = 
¡¹Şow”
(
$Üd”by
);

155 
	g$keywÜd
 = 
Œim
(
$keywÜd
);

156 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

158 
	g$bËwidth
 = 
$ùag
->
G‘A‰
('tablewidth');

159 
	g$wr™”
 = 
$ùag
->
G‘A‰
('writer');

160 if(
	g$bËwidth
 =ğ""è
$bËwidth
 = 100;

161 if(
em±y
(
$cŞ
)è
	g$cŞ
 = 1;

162 
	g$cŞWidth
 = 
û
(100/
$cŞ
);

163 
	g$bËwidth
 = 
$bËwidth
."%";

164 
	g$cŞWidth
 = 
$cŞWidth
."%";

167 
	g$©¼ay
 = 
com·ù
("row", "titlelen", 'infolen', 'imgwidth', 'imgheight', 'listtype',

171 if(
	g$šÃ¹ext
==''è
$šÃ¹ext
 = 
G‘SysTem¶‘s
('part_arclist.htm');

172 ifĞ@
	g$ùag
->
G‘A‰
('g‘®l'è=ğ1 ) 
$g‘®l
 = 1;

173 
	g$g‘®l
 = 0;

175 if(
	g$©t
=='0'è
$©t
='';

176 if(
	g$©t
=='3'è
$©t
='f';

177 if(
	g$©t
=='1'è
$©t
='h';

179 
	g$Üwh”es
 = 
¬¿y
();

180 
	g$mašbË
 = '#@__archives';

182 if(
	g$idli¡
=='')

184 if(
$Üd”by
=='Ã¬' && 
$cfg_keywÜd_like
=='N'è{ 
$keywÜd
=''; }

186 if(
	g$wr™”
=='this') {

187 
$wmid
 = 
is£t
(
$»fObj
->
F›lds
['mid']) ? $refObj->Fields['mid'] : 0;

188 
	g$Üwh”es
[] = "‡rc.mid = '$wmid' ";

192 if(
	g$subday
 > 0)

194 
	g$Áime
 = 
gmmktime
(0, 0, 0, 
gmd©e
('m'), gmdate('d'), gmdate('Y'));

195 
	g$lim™day
 = 
$Áime
 - (
$subday
 * 24 * 3600);

196 
	g$Üwh”es
[] = "‡rc.senddate > $limitday ";

199 if(
	g$keywÜd
!='')

201 
$keywÜd
 = 
¡r_»¶aû
(',', '|', $keyword);

202 
	g$Üwh”es
[] = " CONCAT(arc.title,arc.keywords) REGEXP '$keyword' ";

205 if(
´eg_m©ch
('/comm’d/i', 
$li¡ty³
)è
	g$Üwh”es
[] = " FIND_IN_SET('c',‡rc.flag)>0 ";

206 if(
´eg_m©ch
('/image/i', 
$li¡ty³
)è
	g$Üwh”es
[] = " FIND_IN_SET('p',‡rc.flag)>0 ";

207 if(
	g$©t
 != '') {

208 
$æags
 = 
ex¶ode
(',', 
$©t
);

209 
	g$i
=0; 
is£t
(
$æags
[
$i
]); $i++è
	g$Üwh”es
[] = " FIND_IN_SET('{$flags[$i]}',‡rc.flag)>0 ";

212 if(!
em±y
(
$ty³id
è&& 
	g$ty³id
 != 'top')

215 ifĞ
´eg_m©ch
('#,#', 
$ty³id
) )

218 if(
$g‘®l
==1 || 
em±y
(
$»fObj
->
F›lds
['typeid']))

220 
$ty³ids
 = 
ex¶ode
(',', 
$ty³id
);

221 
fÜ—ch
(
$ty³ids
 
as
 
$‰id
) {

222 
	g$ty³idss
[] = 
G‘SÚIds
(
$‰id
);

224 
	g$ty³idSŒ
 = 
još
(',', 
$ty³idss
);

225 
	g$ty³idss
 = 
ex¶ode
(',', 
$ty³idSŒ
);

226 
	g$ty³idssok
 = 
¬¿y_unique
(
$ty³idss
);

227 
	g$ty³id
 = 
još
(',', 
$ty³idssok
);

230 if(
	g$i¡y³id2
)

232 
	g$viûwh”es
 = "";

233 
fÜ—ch
(
$ty³id
 
as
 
$tid
)

235 
	g$lik‘y³id2
 = ",".
$tid
.",";

236 
	g$viûwh”es
.= " or CONCAT(',',arc.typeid2,',')†ike '%$liketypeid2%' ";

239 if(
	g$viûwh”es
!="")

241 
$Üwh”es
[] = " (arc.typeid in ($typeid) $vicewheres) ";

245 
	g$Üwh”es
[] = "‡rc.typeid in ($typeid) ";

250 
	g$Üwh”es
[] = "‡rc.typeid IN ($typeid) ";

257 
	g$CrossID
 = '';

258 if(
	g$ùag
->
G‘A‰
('cross')=='1')

260 
$¬r
 = 
$dsql
->
G‘OÃ
("SELECT `id`,`topid`,`cross`,`crossid`,`ispart`,`typename` FROM `#@__arctype` WHERE id='$typeid' ");

261 ifĞ
	g$¬r
['üoss']==0 || ( 
$¬r
['üoss']==2 && 
Œim
($arr['crossid']=='') ) )

263 
$Üwh”es
[] = '‡rc.ty³id IN ('.
G‘SÚIds
(
$ty³id
).')';

267 
	g$£lqu”y
 = '';

268 if(
	g$¬r
['cross']==1) {

269 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHEREypename LIKE '{$arr['typename']}' AND id<>'{$typeid}' ANDopid<>'{$typeid}' ";

272 
	g$¬r
['üossid'] = 
´eg_»¶aû
('#[^0-9,]#', '', 
Œim
(
$¬r
['crossid']));

273 if(
	g$¬r
['üossid']!=''è
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHERE id IN('{$arr['crossid']}') AND id<>'{$typeid}' ANDopid<>'{$typeid}' ";

275 if(
	g$£lqu”y
!='')

277 
$dsql
->
S‘Qu”y
(
$£lqu”y
);

278 
	g$dsql
->
Execu‹
();

279 
	g$¬r
 = 
$dsql
->
G‘A¼ay
())

281 
$CrossID
 .ğ($CrossID=='' ? 
$¬r
['id'] : ','.$arr['id']);

287 if(
	g$i¡y³id2
)

289 
	g$viûwh”es
 = "";

290 
	g$ty³ids
 = 
ex¶ode
(",",
G‘SÚIds
(
$ty³id
));

291 if(
	g$CrossID
!='')

293 
$üossids
 = 
ex¶ode
(",",
$CrossID
);

294 
	g$ty³ids
 = 
¬¿y_m”ge
(
$ty³ids
,
$üossids
);

296 
	g$ty³ids
 = 
¬¿y_unique
(
$ty³ids
);

297 
fÜ—ch
(
$ty³ids
 
as
 
$tid
)

299 
	g$lik‘y³id2
 = ",".
$tid
.",";

300 
	g$viûwh”es
.= " OR CONCAT(',',arc.typeid2,',')†ike '%$liketypeid2%' ";

302 if(
	g$CrossID
=='')

304 if(
$viûwh”es
!="")

306 
$Üwh”es
[] = ' (¬c.ty³id iÀ('.
G‘SÚIds
(
$ty³id
).'è'.
$viûwh”es
.') ';

310 
	g$Üwh”es
[] = '‡rc.ty³id iÀ('.
G‘SÚIds
(
$ty³id
).') ';

315 if(
	g$viûwh”es
!="")

317 
$Üwh”es
[] = ' (¬c.ty³id iÀ('.
G‘SÚIds
(
$ty³id
).','.
$CrossID
.'è'.
$viûwh”es
.') ';

321 
	g$Üwh”es
[] = '‡rc.ty³id iÀ('.
G‘SÚIds
(
$ty³id
).','.
$CrossID
.') ';

328 if(
	g$CrossID
==''è
$Üwh”es
[] = '‡rc.ty³id IN ('.
G‘SÚIds
(
$ty³id
).')';

329 
	g$Üwh”es
[] = '‡rc.ty³id IN ('.
G‘SÚIds
(
$ty³id
).','.
$CrossID
.')';

335 if(
´eg_m©ch
('#¥ec#i', 
$li¡ty³
)è
	g$chªÃlid
==-1;

337 if(!
em±y
(
$chªÃlid
)è
	g$Üwh”es
[] = " And‡rc.channel = '$channelid' ";

339 if(!
em±y
(
$noæag
))

341 if(!
´eg_m©ch
('#,#', 
$noæag
))

343 
	g$Üwh”es
[] = " FIND_IN_SET('$noflag',‡rc.flag)<1 ";

347 
	g$noæags
 = 
ex¶ode
(',', 
$noæag
);

348 
fÜ—ch
(
$noæags
 
as
 
$noæag
) {

349 if(
Œim
(
$noæag
)=='') ;

350 
	g$Üwh”es
[] = " FIND_IN_SET('$noflag',‡rc.flag)<1 ";

355 
	g$Üwh”es
[] = '‡rc.arcrank > -1 ';

362 
	g$Üd”sql
 = '';

363 if(
	g$Üd”by
=='hÙ' || 
$Üd”by
=='şick'è
$Üd”sql
 = " ORDER BY‡rc.click $orderWay";

364 if(
	g$Üd”by
 =ğ'sÜŒªk' || 
$Üd”by
=='pubd©e'è
$Üd”sql
 = " ORDER BY‡rc.sortrank $orderWay";

365 if(
	g$Üd”by
 =ğ'id'è
$Üd”sql
 = " ORDER BY‡rc.id $orderWay";

366 if(
	g$Üd”by
 =ğ'Ã¬'è
$Üd”sql
 = " ORDER BY ABS×rc.id - ".
$¬cid
.")";

367 if(
	g$Üd”by
 =ğ'Ï¡po¡'è
$Üd”sql
 = " ORDER BY‡rc.lastpost $orderWay";

368 if(
	g$Üd”by
 =ğ'scÜes'è
$Üd”sql
 = " ORDER BY‡rc.scores $orderWay";

370 if(
	g$Üd”by
 =ğ'goodpo¡'è
$Üd”sql
 = " order by‡rc.goodpost $orderWay";

371 if(
	g$Üd”by
 =ğ'badpo¡'è
$Üd”sql
 = " order by‡rc.badpost $orderWay";

372 if(
	g$Üd”by
 =ğ'weight'è
$Üd”sql
 = " ORDER BY‡rc.weight DESC,arc.id DESC";

373 if(
	g$Üd”by
 =ğ'¿nd'è
$Üd”sql
 = " ORDER BY„and()";

374 
	g$Üd”sql
 = " ORDER BY‡rc.sortrank $orderWay";

377 
	g$lim™
 = 
Œim
(
´eg_»¶aû
('#lim™#is', '', 
$lim™
));

378 if(
	g$lim™
!='')

380 
$lim™sql
 = " LIMIT $limit ";

381 
	g$lim™¬r
 = 
ex¶ode
(',', 
$lim™
);

382 
	g$lše
 = 
is£t
(
$lim™¬r
[1])? $lim™¬r[1] : 
$lše
;

384 
	g$lim™sql
 = " LIMIT 0,$line ";

386 
	g$Üwh”e
 = '';

387 if(
is£t
(
$Üwh”es
[0])) {

388 
	g$Üwh”e
 = 
još
(' And ',
$Üwh”es
);

389 
	g$Üwh”e
 = 
´eg_»¶aû
("#^ And#is", '', 
$Üwh”e
);

390 
	g$Üwh”e
 = 
´eg_»¶aû
("#And[ ]{1,}And#is", 'And ', 
$Üwh”e
);

392 if(
	g$Üwh”e
!=''è
$Üwh”e
 = " WHERE $orwhere ";

395 
	g$addf›ld
 = 
Œim
(
$ùag
->
G‘A‰
('addfields'));

396 
	g$addf›ldsSql
 = '';

397 
	g$addf›ldsSqlJoš
 = '';

398 if(
	g$addf›ld
 !ğ'' && !
em±y
(
$chªÃlid
))

400 
$row
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

401 if(
is£t
(
$row
['addbË']è&& 
Œim
($row['addtable']) != '')

403 
$addbË
 = 
Œim
(
$row
['addtable']);

404 
	g$addf›lds
 = 
ex¶ode
(',', 
$addf›ld
);

405 
	g$row
['addbË'] = 
Œim
(
$row
['addtable']);

406 
	g$addf›ldsSql
 = ",addf.".
još
(',addf.', 
$addf›lds
);

407 
	g$addf›ldsSqlJoš
 = " LEFT JOIN `$addtable`‡ddf ON‡ddf.aid =‡rc.id ";

411 
	g$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,tp.namerule,

412 

.
Çm”uË2
,
	g
.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h


413 
$addf›ldsSql


414 
	gFROM
 `
	g$mašbË
` 
¬c
 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
Ú
 
	g¬c
.
	gty³id
ñp.
id


415 
$addf›ldsSqlJoš


416 
$Üwh”e
 
$Üd”sql
 
$lim™sql
";

420 
$ghash
 = 
md5
(
£rŸlize
(
$ùag
).
$ty³id
);

421 
	g$ÃedSaveCache
 = 
Œue
;

423 if(
	g$·gesize
 > 0è
	g$gid
 = 
A‰Def
(
$gid
,'g'.
$ghash
 );

425 if(
	g$idli¡
!='' || 
$GLOBALS
['_¬şi¡Env']=='šdex' || 
$cfg_šdex_ÿche
==0)

427 
$ÃedSaveCache
 = 
çl£
;

431 
	g$idli¡
 = 
G‘Arşi¡Cache
(
$ghash
);

432 if(
	g$idli¡
 != '') {

433 
$ÃedSaveCache
 = 
çl£
;

436 if(
	g$cfg_ÿche_ty³
=='cÚ‹Á' && 
$idli¡
 != '')

438 
$idli¡
 = ($idlist==0 ? '' : $idlist);

439  
	g$idli¡
;

444 if(
	g$idli¡
 != '')

446 
$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,

447 

.
mÜes™e
,
	g
.
	gs™eu¾
,.
s™•©h


448 
$addf›ldsSql


449 
	gFROM
 `
	g$mašbË
` 
¬c
 
Ëá
 
	gjoš
 `#@
	g__¬ùy³
` 

 
Ú
 
	g¬c
.
	gty³id
ñp.
id


450 
$addf›ldsSqlJoš


451 
WHERE
 
¬c
.
id
 
š
(
$idli¡
è
$Üd”sql
 ";

455 if(
	g$cfg_digg_upd©e
 > 0)

457 if(
	g$Üd”by
 =ğ'goodpo¡' || 
$Üd”by
 == 'badpost')

459 
$t1
 = 
ExecTime
();

460 
	g$po¡sql
 = "SELECT‡rc.id,arc.goodpost,arc.badpost,arc.scores

461 
FROM
 `
$mašbË
` 
¬c


462 
$Üwh”e
 
$Üd”sql
 
$lim™sql
";

464 if(
$idli¡
 != '')

466 
$po¡sql
 = "SELECT‡rc.id,arc.goodpost,arc.badpost,arc.scores

467 
FROM
 `
$mašbË
` 
¬c


468 
WHERE
 
¬c
.
id
 
š
(
$idli¡
è
$Üd”sql
 ";

470 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

471 
	g$dsql
->
Execu‹
('lit');

472 
	g$row
 = 
$dsql
->
G‘A¼ay
('lit')) {

473 
$´efix
 = 'diggCache';

474 
	g$key
 = 'aid-'.
$row
['id'];

475 
	g$ÿch”ow
 = 
G‘Cache
(
$´efix
, 
$key
);

476 
	g$£tsql
 = 
¬¿y
();

477 if(!
em±y
(
$ÿch”ow
['scÜes']è&& 
	g$ÿch”ow
['scÜes'] !ğ
$row
['scores'])

479 
$£tsql
[] = "scores = {$cacherow['scores']}";

481 if(!
em±y
(
$ÿch”ow
['goodpo¡']è&& 
	g$ÿch”ow
['goodpo¡'] !ğ
$row
['goodpost'])

483 
$£tsql
[] = "goodpost = {$cacherow['goodpost']}";

485 if(!
em±y
(
$ÿch”ow
['badpo¡']è&& 
	g$ÿch”ow
['badpo¡'] !ğ
$row
['badpost'])

487 
$£tsql
[] = "badpost = {$cacherow['badpost']}";

489 
	g$£tsql
 = 
im¶ode
(',', 
$£tsql
);

490 
	g$sql
 = "UPDATE `$maintable` SET {$setsql} WHERE id='{$row['id']}'";

491 if(!
em±y
(
$£tsql
))

493 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

500 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

501 
	g$dsql
->
Execu‹
('al');

503 
	g$¬i¡
 = '';

504 if(
	g$·gesize
 > 0è
	g$¬i¡
 .= " <div id='{$tagid}'>\r\n";

505 if(
	g$cŞ
 > 1è
	g$¬i¡
 = "<table width='$tablewidth' border='0' cellspacing='0' cellpadding='0'>\r\n";

506 
	g$d2
 = 
Ãw
 
XakTagP¬£
();

507 
	g$d2
->
S‘NameS·û
('field', '[', ']');

508 
	g$d2
->
LßdSŒšg
(
$šÃ¹ext
);

509 
	g$GLOBALS
['autoindex'] = 0;

510 
	g$ids
 = 
¬¿y
();

511 
	g$Üd”Weight
 = 
¬¿y
();

513 
	g$i
=0; $i<
	g$lše
; $i++)

515 if(
	g$cŞ
>1è
	g$¬i¡
 .= "<tr>\r\n";

516 
	g$j
=0; $j<
	g$cŞ
; $j++)

518 if(
	g$cŞ
>1è
	g$¬i¡
 .= " <td width='$colWidth'>\r\n";

519 if(
	g$row
 = 
$dsql
->
G‘A¼ay
("al"))

521 
$ids
[] = 
$row
['id'];

523 
	g$row
['šfo'] = 
$row
['šfos'] = 
ú_sub¡r
($row['desütiÚ'],
$šfŞ’
);

524 
	g$row
['id'] = 
$row
['id'];

526 if(
	g$row
['corank'] > 0 && $row['arcrank']==0)

528 
$row
['arcrank'] = $row['corank'];

531 
	g$row
['f’ame'] = 
$row
['¬cu¾'] = 
G‘FeU¾
($row['id'],$row['typeid'],$row['senddate'],$row['title'],$row['ismake'],

532 
$row
['arcrank'],$row['namerule'],$row['typedir'],$row['money'],$row['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

534 
	g$row
['ty³u¾'] = 
G‘Ty³U¾
(
$row
['typeid'],$row['typedir'],$row['isdefault'],$row['defaultname'],$row['ispart'],

535 
$row
['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

537 if(
	g$row
['l™pic'] =ğ'-' || 
$row
['litpic'] == '')

539 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

541 if(!
´eg_m©ch
("#^h‰p:\/\/#i", 
$row
['l™pic']è&& 
	g$GLOBALS
['cfg_multi_site'] == 'Y')

543 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

545 
	g$row
['piúame'] = 
$row
['litpic'];

546 
	g$row
['¡ime'] = 
G‘D©eMK
(
$row
['pubdate']);

547 
	g$row
['ty³lšk'] = "<¨h»f='".
$row
['typeurl']."'>".$row['typename']."</a>";

548 
	g$row
['image'] = "<img src='".
$row
['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
´eg_»¶aû
("#['><]#", "", $row['title'])."'>";

549 
	g$row
['imglšk'] = "<¨h»f='".
$row
['filename']."'>".$row['image']."</a>";

550 
	g$row
['fuÎt™Ë'] = 
$row
['title'];

551 
	g$row
['t™Ë'] = 
ú_sub¡r
(
$row
['t™Ë'], 
$t™ËËn
);

552 if(
	g$row
['cŞÜ']!=''è
$row
['title'] = "<font color='".$row['color']."'>".$row['title']."</font>";

553 if(
´eg_m©ch
('#b#', 
$row
['æag'])è
	g$row
['title'] = "<strong>".$row['title']."</strong>";

555 
	g$row
['‹xšk'] = "<¨h»f='".
$row
['filename']."'>".$row['title']."</a>";

557 
	g$row
['¶usu¾'] = 
$row
['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

558 
	g$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

559 
	g$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

561 if(
is_¬¿y
(
$d2
->
CTags
))

563 
fÜ—ch
(
$d2
->
CTags
 
as
 
$k
=>
$ùag
)

565 if(
$ùag
->
G‘Name
()=='array')

568 
$d2
->
Assign
(
$k
, 
$row
);

570 if(
is£t
(
$row
[
$ùag
->
G‘Name
()])è
	g$d2
->
Assign
(
$k
,$row[$ctag->GetName()]);

571 
	g$d2
->
Assign
(
$k
, '');

574 
	g$GLOBALS
['autoindex']++;

576 if(
	g$·gesize
 > 0)

578 if(
	g$GLOBALS
['autošdex'] <ğ
$·gesize
)

580 
$li¡¡r
 = 
$d2
->
G‘ResuÉ
();

581 
	g$¬i¡
 .ğ
$li¡¡r
."\r\n";

583 
	g$¬i¡
 .= "";

584 
	g$Üd”Weight
[] = 
¬¿y
(

585 'weight' => 
$row
['weight'],

590 
	g$li¡¡r
 = 
$d2
->
G‘ResuÉ
();

591 
	g$¬i¡
 .ğ
$li¡¡r
."\r\n";

593 
	g$Üd”Weight
[] = 
¬¿y
(

594 'weight' => 
$row
['weight'],

595 '¬şi¡' => 
$li¡¡r


599 
	g$¬i¡
 .= '';

604 
	g$isweight
 = 
¡¹Şow”
(
$isweight
);

605 iàĞ
	g$isweight
=='y' )

607 
$¬i¡
 = '';

608 
	g$Üd”Weight
 = 
li¡_sÜt_by
(
$Üd”Weight
, 'weight', 'asc');

610 
fÜ—ch
 (
$Üd”Weight
 
as
 
$vv
) {

611 
	g$¬i¡
 .ğ
$vv
['arclist'];

614 if(
	g$cŞ
>1è
	g$¬i¡
 .= " </td>\r\n";

616 if(
	g$cŞ
>1è
	g$i
 +ğ
$cŞ
 - 1;

617 if(
	g$cŞ
>1è
	g$¬i¡
 .= " </tr>\r\n";

619 if(
	g$cŞ
>1è
	g$¬i¡
 .= " </table>\r\n";

620 
	g$dsql
->
F»eResuÉ
("al");

621 
	g$ids¡r
 = 
još
(',', 
$ids
);

624 if(
	g$·gesize
 > 0)

626 
	g$¬i¡
 .= " </div>\r\n";

627 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECTagid FROM #@__arcmulti WHEREagid='$tagid'");

628 
	g$u±ime
 = 
time
();

629 
	g$©t¡r
 = 
add¦ashes
(
£rŸlize
(
$©¼ay
));

630 
	g$šÃ¹ext
 = 
add¦ashes
(
$šÃ¹ext
);

631 if(!
is_¬¿y
(
$row
))

633 
	g$qu”y
 = "

634 
INSERT
 
INTO
 #@
__¬cmuÉi
(
gid
,
u±ime
,
šÃ¹ext
,
·gesize
,
¬cids
,
Üd”sql
,
addf›ldsSql
,
addf›ldsSqlJoš
,
©t¡r
)

635 
VALUES
('$tagid','$uptime','$innertext','$pagesize','$idsstr','$ordersql','$addfieldsSql','$addfieldsSqlJoin','$attstr');

637 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

639 
	g$qu”y
 = "UPDATE `#@__arcmulti`

640 
SET


641 
u±ime
='$uptime',

642 
	gšÃ¹ext
='$innertext',

643 
	g·gesize
='$pagesize',

644 
	g¬cids
='$idsstr',

645 
	gÜd”sql
='$ordersql',

646 
	gaddf›ldsSql
='$addfieldsSql',

647 
	gaddf›ldsSqlJoš
='$addfieldsSqlJoin',

648 
	g©t¡r
='$attstr'

649 
WHERE
 
gid
='$tagid'

651 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

656 if(
	g$ÃedSaveCache
)

658 if(
	g$ids¡r
==''è
$ids¡r
 = '0';

659 if(
	g$cfg_ÿche_ty³
=='cÚ‹Á' && 
$ids¡r
!='0') {

660 
$ids¡r
 = 
add¦ashes
(
$¬i¡
);

662 
	g$šqu”y
 = "INSERT INTO `#@__¬cÿche`(`md5hash`,`u±ime`,`ÿched©a`èVALUES ('".
$ghash
."','".
time
()."', '$idsstr'); ";

663 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__¬cÿche` WHERE md5hash='".
$ghash
."' ");

664 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

666  
	g$¬i¡
;

676 
funùiÚ
 
	$G‘Arşi¡Cache
(
$md5hash
)

678 
glob®
 
$dsql
,
$’vs
,
$cfg_makesign_ÿche
,
$cfg_šdex_ÿche
,
$cfg_ÿche_ty³
;

679 if(
$cfg_šdex_ÿche
 <= 0)  '';

680 if(
	`is£t
(
$’vs
['makesign']è&& 
$cfg_makesign_ÿche
=='N')  '';

681 
$mštime
 = 
	`time
(è- 
$cfg_šdex_ÿche
;

682 
$¬r
 = 
$dsql
->
	`G‘OÃ
("SELECT cachedata,uptime FROM `#@__arccache` WHERE md5hash = '$md5hash' ");

683 if(!
	`is_¬¿y
(
$¬r
)) {

686 if(
$¬r
['u±ime'] < 
$mštime
) {

690  
$¬r
['cachedata'];

692 
	}
}

702 
funùiÚ
 
	$lib_G‘AutoChªÃlID
(
$sÜtid
, 
$tİid
)

704 
glob®
 
$dsql
;

705 if(
	`em±y
(
$sÜtid
)) $sortid = 1;

706 
$g‘¡¬t
 = 
$sÜtid
 - 1;

707 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id,typename FROM #@__arctype WHERE„eid='{$topid}' And ispart<2 And ishidden<>'1' ORDER BY sortrank‡sc†imit $getstart,1");

708 if(!
	`is_¬¿y
(
$row
))  0;

709  
$row
['id'];

710 
	}
}

722 
funùiÚ
 
li¡_sÜt_by
(
$li¡
, 
$f›ld
, 
$sÜtby
='asc') {

723 if(
is_¬¿y
(
$li¡
)){

724 
$»ãr
 = 
$»suÉS‘
 = 
¬¿y
();

725 
fÜ—ch
 (
$li¡
 
as
 
$i
 => 
$d©a
)

726 
$»ãr
[
$i
] = &
$d©a
[
$f›ld
];

727 
	g$sÜtby
) {

729 
asÜt
(
$»ãr
);

732 
¬sÜt
(
$»ãr
);

735 
Çtÿ£sÜt
(
$»ãr
);

738 
fÜ—ch
 ( 
$»ãr
 
as
 
$key
=> 
$v®
)

739 
$»suÉS‘
[] = &
$li¡
[
$key
];

740  
	g$»suÉS‘
;

742  
	gçl£
;

	@E:\web\weixun\functions\taglib\arclistsg.lib.php

1 <?
php


18 
funùiÚ
 
	$lib_¬şi¡sg
(&
$ùag
,&
$»fObj
)

20 
glob®
 
$dsql
,
$PubF›lds
,
$cfg_keywÜd_like
,
$cfg_šdex_ÿche
,
$_¬şi¡Env
,
$’vs
,
$_sys_glob®s
;

23 
$©i¡
="typeid|0,row|10,col|1,flag|,titlelen|30,sort|default,keyword|,innertext|,arcid|0,idlist|,channelid|0,limit|,orderway|desc,subday|0";

24 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

25 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

27 
$lše
 = 
$row
;

28 
$Üd”by
=
	`¡¹Şow”
(
$sÜt
);

29 if(
$cŞ
=='') $col = 1;

30 if(
	`em±y
(
$imgwidth
)) $imgwidth = "";

31 if(
	`em±y
(
$imgheight
)) $imgheight = "";

32 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

33 if(
$šÃ¹ext
==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("part_arclistsg.htm");

35 if(
	`em±y
(
$chªÃlid
è&& 
	`is£t
(
$GLOBALS
['envs']['channelid'])) {

36 
$chªÃlid
 = 
$GLOBALS
['envs']['channelid'];

39 if(
	`em±y
(
$ty³id
è&& !em±y(
$’vs
['typeid'])) {

40 
$ty³id
 = 
$’vs
['typeid'];

43 if(
	`em±y
(
$ty³id
è&&ƒm±y(
$chªÃlid
))

48 if(!
	`em±y
(
$chªÃlid
)è
$gqu”y
 = "SELECT‡ddtable,listfields FROM `#@__channeltype` WHERE id='$channelid' ";

49 
$gqu”y
 = "SELECT ch.addtable,listfields FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch ON ch.id=tp.channeltype WHERE id='$typeid'";

51 
$row
 = 
$dsql
->
	`G‘OÃ
(
$gqu”y
);

53 
$Üwh”es
 = 
	`¬¿y
();

54 
$mašbË
 = 
	`Œim
(
$row
['addtable']);

56 if(
$mašbË
=='')

62 
$li¡¬cs
 = 
	`¬¿y
('aid', 'typeid');

63 if(!
	`em±y
(
$row
['listfields']))

65 
$li¡f›lds
 = 
	`ex¶ode
(',', 
$row
['listfields']);

66 
	`fÜ—ch
(
$li¡f›lds
 
as
 
$v
)

68 if(!
	`š_¬¿y
(
$v
, 
$li¡¬cs
)) $listarcs[] = $v;

71 
$¬şi¡qu”y
 = 
	`još
(',', 
$li¡¬cs
);

72 
$¬şi¡qu”y
 .= ",arc.aid AS id,arc.senddate AS…ubdate";

75 if(
$idli¡
=='')

77 if(
$Üd”by
=='Ã¬' && 
$cfg_keywÜd_like
=='N'){ 
$keywÜd
=''; }

79 if(
$subday
>0)

82 
$Áime
 = 
	`gmmktime
(0, 0, 0, 
	`gmd©e
('m'), gmdate('d'), gmdate('Y'));

83 
$lim™day
 = 
$Áime
 - (
$subday
 * 24 * 3600);

84 
$Üwh”es
[] = "‡rc.senddate > $limitday ";

87 if(
$æag
!='')

89 
$æags
 = 
	`ex¶ode
(',',
$æag
);

90 
$i
=0;
	`is£t
(
$æags
[$i]);$i++è
$Üwh”es
[] = " FIND_IN_SET('{$flags[$i]}',flag)>0 ";

93 if(!
	`em±y
(
$ty³id
))

96 if(
	`´eg_m©ch
('#,#',
$ty³id
)è
$Üwh”es
[] = "ypeid IN ($typeid) ";

100 
$CrossID
 = '';

101 if((
	`is£t
(
$’vs
['üoss']è|| 
$ùag
->
	`G‘A‰
('cross')=='1' ) && $ctag->GetAtt('nocross')!='1')

103 
$¬r
 = 
$dsql
->
	`G‘OÃ
("SELECT `id`,`topid`,`cross`,`crossid`,`ispart`,`typename` FROM `#@__arctype` WHERE id='$typeid' ");

104 if(
$¬r
['üoss']==0 || ($¬r['üoss']==2 && 
	`Œim
($arr['crossid']=='')))

105 
$Üwh”es
[] = 'y³id IN ('.
	`G‘SÚIds
(
$ty³id
).')';

108 
$£lqu”y
 = '';

109 if(
$¬r
['cross']==1) {

110 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHEREypename†ike '{$arr['typename']}' AND id<>'{$typeid}' ANDopid<>'{$typeid}' ";

113 
$¬r
['üossid'] = 
	`´eg_»¶aû
('#[^0-9,]#', '', 
	`Œim
($arr['crossid']));

114 if(
$¬r
['üossid']!=''è
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHERE id IN('{$arr['crossid']}') AND id<>'{$typeid}' ANDopid<>'{$typeid}' ";

117 if(
$£lqu”y
!='')

119 
$dsql
->
	`S‘Qu”y
(
$£lqu”y
);

120 
$dsql
->
	`Execu‹
();

121 
$¬r
 = 
$dsql
->
	`G‘A¼ay
()) {

122 
$CrossID
 .ğ($CrossID=='' ? 
$¬r
['id'] : ','.$arr['id']);

127 if(
$CrossID
==''è
$Üwh”es
[] = 'y³id IN ('.
	`G‘SÚIds
(
$ty³id
).')';

128 
$Üwh”es
[] = 'y³id IN ('.
	`G‘SÚIds
(
$ty³id
).','.
$CrossID
.')';

133 if(!
	`em±y
(
$chªÃlid
)è
$Üwh”es
[] = " AND‡rc.channel = '$channelid' ";

139 
$Üd”sql
 = '';

140 if(
$Üd”by
=='hÙ'||$Üd”by=='şick'è
$Üd”sql
 = " ORDER BY‡rc.click $orderway";

141 if(
$Üd”by
=='id'è
$Üd”sql
 = " ORDER BY‡rc.aid $orderway";

142 if(
$Üd”by
=='Ã¬'è
$Üd”sql
 = " ORDER BY ABS×rc.id - ".
$¬cid
.")";

143 if(
$Üd”by
=='¿nd'è
$Üd”sql
 = " ORDER BY„and()";

144 
$Üd”sql
=" ORDER BY‡rc.aid $orderway";

146 
$lim™
 = 
	`Œim
(
	`´eg_»¶aû
('#limit#i', '', $limit));

147 if(
$lim™
!=''è
$lim™sql
 = " LIMIT $limit ";

148 
$lim™sql
 = " LIMIT 0,$line ";

150 
$Üwh”e
 = '';

151 if(
	`is£t
(
$Üwh”es
[0])) {

152 
$Üwh”e
 = 
	`još
(' AND ',
$Üwh”es
);

153 
$Üwh”e
 = 
	`´eg_»¶aû
("#^ AND#i", '', $orwhere);

154 
$Üwh”e
 = 
	`´eg_»¶aû
("#AND[ ]{1,}AND#i", 'AND ', $orwhere);

156 if(
$Üwh”e
!='') $orwhere = " WHERE $orwhere ";

158 
$qu”y
 = "SELECT $arclistquery,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,

159 

.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


160 
FROM
 `
$mašbË
` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
‡rc.
ty³id
ñp.
id


161 
$Üwh”e
 
AND
 
¬c
.
¬üªk
 > -1 
$Üd”sql
 
$lim™sql
";

163 
$md5hash
 = 
	`md5
(
$qu”y
);

164 
$Ãedÿche
 = 
TRUE
;

165 if(
$idli¡
!=''è
$Ãedÿche
 = 
FALSE
;

167 
$idli¡
 = 
	`G‘Arşi¡SgCache
(
$md5hash
);

168 if(
$idli¡
!=''è
$Ãedÿche
 = 
FALSE
;

171 if(
$idli¡
!='' && 
$_¬şi¡Env
 != 'index')

173 
$qu”y
 = "SELECT $arclistquery,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,

174 

.
mÜes™e
,.
s™eu¾
,.
s™•©h
 
FROM
 `
$mašbË
` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
`°
ON
‡rc.
ty³id
ñp.
id


175 
WHERE
 
¬c
.
aid
 
	`IN
(
$idli¡
è
$Üd”sql
 
$lim™sql
";

177 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

178 
$dsql
->
	`Execu‹
("al");

179 
$¬i¡
 = "";

180 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

181 
$d2
->
	`S‘NameS·û
("field","[","]");

182 
$d2
->
	`LßdSŒšg
(
$šÃ¹ext
);

183 
$GLOBALS
['autoindex'] = 0;

184 
$ids
 = 
	`¬¿y
();

185 
$i
=0;$i<
$lše
;$i++)

187 
$j
=0;$j<
$cŞ
;$j++)

189 if(
$cŞ
>1è
$¬i¡
 .= " <div>\r\n";

190 if(
$row
 = 
$dsql
->
	`G‘A¼ay
("al"))

192 
$ids
[] = 
$row
['aid'];

194 
$row
['f’ame'] = $row['¬cu¾'] = 
	`G‘FeU¾
($row['id'],$row['typeid'],$row['senddate'],$row['title'],1,

195 0,
$row
['namerule'],$row['typedir'],0,'',$row['moresite'],$row['siteurl'],$row['sitepath']);

197 
$row
['ty³u¾'] = 
	`G‘Ty³U¾
($row['typeid'],$row['typedir'],$row['isdefault'],$row['defaultname'],$row['ispart'],

198 
$row
['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

200 if(
$row
['litpic'] == '-' || $row['litpic'] == '')

202 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

204 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$row
['l™pic']è&& 
$GLOBALS
['cfg_multi_site'] == 'Y')

206 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

208 
$row
['picname'] = $row['litpic'];

210 
$row
['image'] = "<img src='".$row['piúame']."' bÜd”='0' width='{$imgwidth}' height='{$imgheight}'‡É='".
	`´eg_»¶aû
("#['><]#", "", $row['title'])."' />";

212 
$row
['imglink'] = "<a href='".$row['filename']."'>".$row['image']."</a>";

214 
$row
['¡ime'] = 
	`G‘D©eMK
($row['pubdate']);

215 
$row
['typelink'] = "<a href='".$row['typeurl']."'>".$row['typename']."</a>";

216 
$row
['fulltitle'] = $row['title'];

217 
$row
['t™Ë'] = 
	`ú_sub¡r
($row['t™Ë'],
$t™ËËn
);

218 
$row
['textlink'] = "<a href='".$row['filename']."'>".$row['title']."</a>";

219 
$row
['¶usu¾'] = $row['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

220 
$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

221 
$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

223 if(
	`is_¬¿y
(
$d2
->
CTags
))

225 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$k
=>
$ùag
)

227 if(
$ùag
->
	`G‘Name
()=='array')

230 
$d2
->
	`Assign
(
$k
,
$row
);

234 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])è
$d2
->
	`Assign
(
$k
,$row[$ctag->GetName()]);

235 
$d2
->
	`Assign
(
$k
,'');

238 
$GLOBALS
['autoindex']++;

241 
$¬i¡
 .ğ
$d2
->
	`G‘ResuÉ
()."\r\n";

244 
$¬i¡
 .= '';

246 if(
$cŞ
>1è
$¬i¡
 .= " </div>\r\n";

248 if(
$cŞ
>1è
$i
 += $col - 1;

250 
$dsql
->
	`F»eResuÉ
("al");

252 
$ids¡r
 = 
	`još
(',',
$ids
);

253 if(
$ids¡r
!='' && 
$Ãedÿche
 && 
$cfg_šdex_ÿche
>0)

255 
$mštime
 = 
	`time
(è- (
$cfg_šdex_ÿche
 * 3600);

256 
$šqu”y
 = "INSERT INTO `#@__¬cÿche`(`md5hash`,`u±ime`,`ÿched©a`èVALUES ('".
$md5hash
."', '".
	`time
()."', '$idsstr'); ";

257 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__¬cÿche` WHERE md5hash='".
$md5hash
."' or uptime < $mintime ");

258 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

260  
$¬i¡
;

261 
	}
}

264 
funùiÚ
 
	$G‘Arşi¡SgCache
(
$md5hash
)

266 
glob®
 
$dsql
,
$’vs
,
$cfg_makesign_ÿche
,
$cfg_šdex_ÿche
;

268 if(
$cfg_šdex_ÿche
<=0)  '';

270 if(
	`is£t
(
$’vs
['makesign']è&& 
$cfg_makesign_ÿche
=='N')  '';

272 
$mštime
 = 
	`time
(è- (
$cfg_šdex_ÿche
 * 3600);

273 
$¬r
 = 
$dsql
->
	`G‘OÃ
("SELECT cachedata,uptime FROM `#@__arccache` WHERE md5hash = '$md5hash' AND uptime > $mintime ");

275 if(!
	`is_¬¿y
(
$¬r
))  '';

277  
$¬r
['cachedata'];

278 
	}
}

280 
funùiÚ
 
	$lib_G‘AutoChªÃlID2
(
$sÜtid
,
$tİid
)

282 
glob®
 
$dsql
;

283 if(
	`em±y
(
$sÜtid
)) $sortid = 1;

284 
$g‘¡¬t
 = 
$sÜtid
 - 1;

285 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id,typename From #@__arctype WHERE„eid='{$topid}' AND ispart<2 AND ishidden<>'1' ORDER BY sortrank‡sc†imit $getstart,1");

286 if(!
	`is_¬¿y
(
$row
))  0;

287  
$row
['id'];

288 
	}
}

	@E:\web\weixun\functions\taglib\arcpagelist.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
funùiÚ
 
	$lib_¬ıag–i¡
(&
$ùag
, &
$»fObj
)

10 
glob®
 
$dsql
;

11 
$©i¡
 = "tagid|,style|1";

12 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

13 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

15 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__arcmulti WHEREagid='$tagid'");

16 if(
	`is_¬¿y
(
$row
))

18 
$ids
 = 
	`ex¶ode
(',', 
$row
['arcids']);

20 
$tÙ®num
 = 
	`couÁ
(
$ids
);

21 
$·ge¡r
 = '<div id="·ge_'.
$gid
.'">';

22 if(
$row
['·gesize'] < 
$tÙ®num
)

24 
$·ge¡r
 .ğ
	`muÉage
(
$tÙ®num
, 1, 
$row
['·gesize'], 
$gid
);

26 
$·ge¡r
 .= 'å…±1é¡µ';

28 
$·ge¡r
 .= '</div>';

29  
$·ge¡r
;

31 
$·ge¡r
 = '<div id="·ge_'.
$gid
.'">';

32 
$·ge¡r
 .= 'æ²¡æœ‰æ£€ç´¢åˆ°å¯¹åº”åˆ†é¡µ';

33 
$·ge¡r
 .= '</div>';

34  
$·ge¡r
;

36 
	}
}

48 
funùiÚ
 
muÉage
(
$®lI‹mTÙ®
, 
$cu¼PageNum
, 
$·geSize
, 
$gid
='')

50 ià(
$®lI‹mTÙ®
 == 0)  "";

53 
	g$·gesNum
 = 
û
(
$®lI‹mTÙ®
/
$·geSize
);

56 
	g$fœ¡Page
 = (
$cu¼PageNum
 <= 1) ? $currPageNum ."</b>&lt;&lt;" : "<a href='javascript:multi(1,\"{$tagid}\")'itle='ç¬¬1é¡µ'>1&lt;&lt;</a>";

59 
	g$Ï¡Page
 = (
$cu¼PageNum
 >ğ
$·gesNum
)? "&gt;&gt;". $currPageNum : "<a href='javascript:multi(". $pagesNum . ",\"{$tagid}\")'itle='ç¬¬". $pagesNum ."é¡µ'>&gt;&gt;". $pagesNum ."</a>";

62 
	g$´ePage
 = (
$cu¼PageNum
 <= 1) ? "ä¸Šé¡µ" : "<a href='javascript:multi(". ($currPageNum-1) . ",\"{$tagid}\")'‡ccesskey='p'itle='ä¸Šä¸€é¡µ'>[ä¸Šä¸€é¡µ]</a>";

65 
	g$ÃxtPage
 = (
$cu¼PageNum
 >ğ
$·gesNum
) ? "ä¸‹é¡µ" : "<a href='javascript:multi(". ($currPageNum+1) .",\"{$tagid}\")'itle='ä¸‹ä¸€é¡µ'>[ä¸‹ä¸€é¡µ]</a>";

68 
	g$li¡Nums
 = "";

69 
	g$i
=(
$cu¼PageNum
-4); $i<(
	g$cu¼PageNum
+9); $i++) {

70 ià(
	g$i
 < 1 || $˜> 
	g$·gesNum
) ;

71 ià(
	g$i
 =ğ
$cu¼PageNum
è
$li¡Nums
.ğ"<¨h»f='javasüt:void(0)' cÏss='thi¦šk'>".
$i
."</a>";

72 
	g$li¡Nums
.ğ" <¨h»f='javasüt:muÉi(". 
$i
 .",\"{$tagid}\")'itle='". $i ."'>". $i ."</a> ";

75 
	g$»tuºU¾
 = 
$li¡Nums
;

76  
	g$»tuºU¾
;

	@E:\web\weixun\functions\taglib\ask.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

7 
funùiÚ
 
	$lib_ask
(&
$ùag
,&
$»fObj
)

9 
glob®
 
$dsql
, 
$’vs
, 
$cfg_db´efix
, 
$cfg_cmsu¾
,
$cfg_ask_dœeùÜy
,
$cfg_ask_isdomaš
,
$cfg_ask_domaš
;

11 
$©i¡
="row|6,qtype|new,tid|0,titlelen|24";

12 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

13 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

15 ifĞ!
$dsql
->
	`IsTabË
("{$cfg_dbprefix}ask") )  'æ²¡å®‰è£…é—®ç­”æ¨¡å—';

18 if(
$cfg_ask_isdomaš
 == 'Y')

20 
$webu¾
 = 
$cfg_ask_domaš
.'/';

22 
$webu¾
 = 
$cfg_ask_dœeùÜy
.'/';

25 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

26 if(
	`Œim
(
$šÃ¹ext
)==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("asks.htm");

28 
$qty³Qu”y
 = '';

29 if(
$tid
 > 0) $tid = " (tid=$tid Orid2='$tid') AND ";

30 
$tid
 = '';

32 if(
$qty³
=='comm’d'è
$qty³Qu”y
 = " $tid digest=1 ORDER BY dateline DESC ";

34 if(
$qty³
=='ok'è
$qty³Qu”y
 = " $tid status=1 ORDER BY solvetime DESC ";

36 if(
$qty³
=='high'è
$qty³Qu”y
 = " $tid status=0 ORDER BY„eward DESC ";

38 
$qty³Qu”y
 = " $tid status=0 ORDER BY disorder DESC, dateline DESC ";

40 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

41 
$ùp
->
	`S‘NameS·û
('field', '[', ']');

43 
$sŞvšgask
 = '';

44 
$qu”y
 = "SELECT id,id,idname,id2,id2name,itle,dateline FROM `#@__ask` WHERE $qtypeQuery†imit 0, $row";

45 
$dsql
->
	`Execu‹
('me',
$qu”y
);

47 
$rs
 = 
$dsql
->
	`G‘A¼ay
('me'))

49 
$rs
['t™Ë'] = 
	`ú_sub¡r
($rs['t™Ë'], 
$t™ËËn
);

50 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

51 if(
$rs
['tid2name'] != '')

53 
$rs
['tid'] = $rs['tid2'];

54 
$rs
['tidname'] = $rs['tid2name'];

56 
$rs
['u¾'] = 
$webu¾
."?ct=question&askaid=".$rs['id'];

57 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
) {

58 if(!
	`em±y
(
$rs
[
	`¡¹Şow”
(
$ùag
->
	`G‘Name
())])) {

59 
$ùp
->
	`Assign
(
$gid
,
$rs
[
$ùag
->
	`G‘Name
()]);

62 
$sŞvšgask
 .ğ
$ùp
->
	`G‘ResuÉ
();

64  
$sŞvšgask
;

65 
	}
}

	@E:\web\weixun\functions\taglib\asktype.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
funùiÚ
 
	$lib_askty³
(&
$ùag
,&
$»fObj
)

10 
glob®
 
$dsql
, 
$’vs
, 
$cfg_db´efix
, 
$cfg_cmsu¾
,
$cfg_ask_dœeùÜy
,
$cfg_ask_isdomaš
,
$cfg_ask_domaš
;

12 
$©i¡
="tid|0,reid|0,name|24";

13 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

14 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

16 ifĞ!
$dsql
->
	`IsTabË
("{$cfg_dbprefix}ask") )  'æ²¡å®‰è£…é—®ç­”æ¨¡å—';

19 if(
$cfg_ask_isdomaš
 == 'Y')

21 
$webu¾
 = 
$cfg_ask_domaš
.'/';

23 
$webu¾
 = 
$cfg_ask_dœeùÜy
.'/';

26 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

27 if(
	`Œim
(
$šÃ¹ext
)==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("asks.htm");

29 if(
$tid
 > 0è
$qty³Qu”y
 = "WHERE„eid=$tid ";

30 
$qty³Qu”y
 = '';

31 if(
$»id
 > 0è
$qty³Qu”y
 = "WHERE„eid > 0 ";

33 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

34 
$ùp
->
	`S‘NameS·û
('field', '[', ']');

36 
$sŞvšgask
 = '';

37 
$qu”y
 = "SELECT id,name,reid FROM `#@__asktype` $qtypeQuery";

38 
$dsql
->
	`Execu‹
('me',
$qu”y
);

39 
$rs
 = 
$dsql
->
	`G‘A¼ay
('me'))

41 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

42 if(
$rs
['reid'] != '')

43 
$rs
['ty³u¾'] = 
$webu¾
."?ct=browser&tid2=".$rs['id'];

45 
$rs
['ty³u¾'] = 
$webu¾
."?ct=browser&tid=".$rs['id'];

46 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
) {

47 if(!
	`em±y
(
$rs
[
	`¡¹Şow”
(
$ùag
->
	`G‘Name
())])) {

48 
$ùp
->
	`Assign
(
$gid
,
$rs
[
$ùag
->
	`G‘Name
()]);

51 
$sŞvšgask
 .ğ
$ùp
->
	`G‘ResuÉ
();

53  
$sŞvšgask
;

54 
	}
}

	@E:\web\weixun\functions\taglib\autochannel.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 
funùiÚ
 
	$lib_autochªÃl
(&
$ùag
,&
$»fObj
)

12 
glob®
 
$dsql
;

14 
$©i¡
='partsort|0,typeid=-1';

15 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

16 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

18 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

19 
$tİid
 = 
$ty³id
;

20 
$sÜtid
 = 
$·¹sÜt
;

22 if(
$tİid
=='-1' || $topid=='')

24 
$tİid
 = ( 
	`is£t
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id']) ? $refObj->TypeLink->TypeInfos['id'] : 0);

27 if(
	`em±y
(
$sÜtid
)) $sortid = 1;

28 
$g‘¡¬t
 = 
$sÜtid
 - 1;

30 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id,typename FROM `#@__arctype` WHERE„eid='{$topid}' AND

31 
i¥¬t
<2 
AND
 
ishidd’
<>'1' 
ORDER
 
BY
 
sÜŒªk
 
asc
 
lim™
 
$g‘¡¬t
,1");

33 if(!
	`is_¬¿y
(
$row
) )  '';

34 
$ty³id
 = 
$row
['id'];

36 if(
	`Œim
(
$šÃ¹ext
)==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
('part_autochannel.htm');

38 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id,typedir,isdefault,defaultname,ispart,namerule2,typename,moresite,siteurl,sitepath

39 
FROM
 `#@
__¬ùy³
` 
WHERE
 
id
='$typeid' ");

40 if(!
	`is_¬¿y
(
$row
))  '';

42 
$d
 = 
Ãw
 
	`XakTagP¬£
();

43 
$d
->
	`S‘NameS·û
('field','[',']');

44 
$d
->
	`LßdSourû
(
$šÃ¹ext
);

45 if(!
	`is_¬¿y
(
$d
->
CTags
))

47 
	`un£t
(
$d
);

52 
$row
['ty³lšk'] = 
	`G‘Ty³U¾
($row['id'],
	`MfTy³dœ
($row['typedir']),$row['isdefault'],

53 
$row
['defaultname'],$row['ispart'],$row['namerule2'],$row['siteurl'],$row['sitepath']);

54 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

56 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])è
$d
->
	`Assign
(
$gid
,$row[$ctag->GetName()]);

58 
$»v®ue
 = 
$d
->
	`G‘ResuÉ
();

59 
	`un£t
(
$d
);

60  
$»v®ue
;

62 
	}
}

	@E:\web\weixun\functions\taglib\banner.lib.php

1 <?
php


9 
funùiÚ
 
	$lib_bªÃr
(&
$ùag
,&
$»fObj
)

11 
glob®
 
$dsql
;

13 
$©i¡
 = "name|'',row|7";

14 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

15 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

16 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

18 
$likeTy³
 = '';

20 
$ÿcheid
 = 
	`Œim
($cacheid);

21 if(
$ÿcheid
 !='') {

22 
$likeTy³
 = 
	`G‘CacheBlock
(
$ÿcheid
);

23 if(
$likeTy³
 != '')  $likeType;

27 
$ÃedR–
 = 
çl£
;

28 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

29 
$d2
->
	`S‘NameS·û
('field','[',']');

30 
$d2
->
	`LßdSourû
(
$šÃ¹ext
);

32 if(
	`Œim
(
$ty³id
)=='') $typeid=0;

33 ifĞ!
	`em±y
(
$»fObj
->
F›lds
['ty³id']è&& 
$ty³id
==0) $typeid = $refObj->Fields['typeid'];

35 
$ty³sql
 = 
$bªÃrInfo
 = '';

36 if(
$ty³id
 > 0è
$ty³sql
 = " Andy³id in(0,".
	`G‘Tİids
($typeid).") ";

37 
$ty³sql
 = " ANDypeid=0 ";

38 
$bªÃrInfo
 = 
$dsql
->
	`G‘OÃ
(" Select * From `#@__rpad` whereagname†ike '$name' $typesql order byypeid desc ");

40 
$nÜm·¿ms
 = 
	`un£rŸlize
(
$bªÃrInfo
['normparams']);

42 
$i
 = 0;$˜< 
$row
;$i++)

44 if(!
	`em±y
(
$nÜm·¿ms
['pic'][
$i
]))

46 if(
	`em±y
(
$nÜm·¿ms
['lšk'][
$i
]) || $normparams['link'][$i] =='#' )

48 
$nÜm·¿ms
['lšk'][
$i
] = 'javascript:void(0);';

49 
$bªÃrLi¡
[
$i
]['target'] = '';

53 if(
	`´eg_m©ch
("/h‰p:\/\//",
$nÜm·¿ms
['lšk'][
$i
]))

55 
$bªÃrLi¡
[
$i
]['target'] = 'arget="_blank"';

58 
$bªÃrLi¡
[
$i
]['pic'] = 
$nÜm·¿ms
['pic'][$i];

59 
$bªÃrLi¡
[
$i
]['lšk'] = 
$nÜm·¿ms
['link'][$i];

60 
$bªÃrLi¡
[
$i
]['‹xt'] = 
$nÜm·¿ms
['text'][$i];

61 
$bªÃrLi¡
[
$i
]['id'] = $i + 1;

66 
	`fÜ—ch
(
$bªÃrLi¡
 
as
 
$v®ue
){

67 if(
	`is_¬¿y
(
$d2
->
CTags
))

69 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
)

71 if(
	`is£t
(
$v®ue
[
$ùag
->
	`G‘Name
()])){

72 
$d2
->
	`Assign
(
$gid
,
$v®ue
[
$ùag
->
	`G‘Name
()]);

76 
$likeTy³
 .ğ
$d2
->
	`G‘ResuÉ
();

80 
$dsql
->
	`F»eResuÉ
();

81 if(
$ÿcheid
 !='') {

82 
	`Wr™eCacheBlock
(
$ÿcheid
, 
$likeTy³
);

85  
$likeTy³
;

86 
	}
}

	@E:\web\weixun\functions\taglib\bookcontentlist.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 
»quœe_Úû
(
XAKINC
.'/taglib/booklist.lib.php');

12 
funùiÚ
 
	$lib_bookcÚ‹Áli¡
(&
$ùag
, &
$»fObj
)

14 
glob®
 
$dsql
, 
$’vs
, 
$cfg_db´efix
, 
$cfg_cmsu¾
;

16 
$©i¡
="row|12,booktype|-1,titlelen|30,orderby|lastpost,author|,keyword|";

17 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

18 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

20 ifĞ!
$dsql
->
	`IsTabË
("{$cfg_dbprefix}story_books") )  'æ²¡å®‰è£…è¿è½½æ¨¡å—';

22  
	`lib_bookli¡
(
$ùag
, 
$»fObj
, 1);

24 
	}
}

	@E:\web\weixun\functions\taglib\booklist.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

19 
funùiÚ
 
	$lib_bookli¡
(&
$ùag
, &
$»fObj
, 
$g‘cÚ‹Á
=0)

21 
glob®
 
$dsql
, 
$’vs
, 
$cfg_db´efix
, 
$cfg_cmsu¾
;

24 
$©i¡
="row|12,booktype|-1,titlelen|30,orderby|lastpost,author|,keyword|";

25 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

26 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

28 ifĞ!
$dsql
->
	`IsTabË
("{$cfg_dbprefix}story_books") )  'æ²¡å®‰è£…è¿è½½æ¨¡å—';

29 
$addqu”y
 = '';

31 if(
	`em±y
(
$šÃ¹ext
))

33 if(
$g‘cÚ‹Á
==0è
$šÃ¹ext
 = 
	`G‘SysTem¶‘s
('booklist.htm');

34 
$šÃ¹ext
 = 
	`G‘SysTem¶‘s
('bookcontentlist.htm');

38 if(
$bookty³
!=-1) {

39 
$addqu”y
 .= " AND b.booktype='{$booktype}' ";

43 if(
$Üd”by
=='commend')

45 
$addqu”y
 .= " AND b.iscommend=1 ";

46 
$Üd”by
 = 'lastpost';

50 if(!
	`em±y
(
$authÜ
))

52 
$addqu”y
 .= " AND b.author LIKE '$author' ";

56 if(!
	`em±y
(
$keywÜd
))

58 
$keywÜds
 = 
	`ex¶ode
(',', 
$keywÜd
);

59 
$keywÜds
 = 
	`¬¿y_unique
($keywords);

60 if(
	`couÁ
(
$keywÜds
) > 0) {

61 
$addqu”y
 .= " AND (";

63 
	`fÜ—ch
(
$keywÜds
 
as
 
$v
) {

64 
$addqu”y
 .= " CONCAT(b.author,b.bookname,b.keywords) LIKE '%$v%' OR";

66 
$addqu”y
 = 
	`´eg_»¶aû
("# OR$#", "", $addquery);

67 
$addqu”y
 .= ")";

70 
$şi¡
 = '';

71 
$qu”y
 = "SELECT b.id,b.catid,b.ischeck,b.booktype,b.iscommend,b.click,b.bookname,b.lastpost,

72 
b
.
authÜ
,b.
mid
,b.
l™pic
,b.
pubd©e
,b.
w“kcc
,b.
mÚthcc
,b.
desütiÚ
,
c
.
şas¢ame
,c.şas¢am
as
 
ty³Çme
,c.
bookty³
‡ 
ÿlogty³


73 
FROM
 `#@
__¡Üy_books
` 
b
 
LEFT
 
JOIN
 `#@
__¡Üy_ÿlog
` 
c
 
ON
 c.
id
 = b.
ÿtid


74 
WHERE
 
b
.
po¡num
>0 
AND
 b.
ischeck
>0 
$addqu”y
 
ORDER
 
BY
 b.{
$Üd”by
} 
DESC
 
LIMIT
 0, 
$row
";

75 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

76 
$dsql
->
	`Execu‹
();

78 
$nd
 = 
Ãw
 
	`XakTagP¬£
();

79 
$nd
->
	`S‘NameS·û
('field', '[', ']');

80 
$GLOBALS
['autoindex'] = 0;

81 
$row
 = 
$dsql
->
	`G‘A¼ay
())

83 
$GLOBALS
['autoindex']++;

84 
$row
['title'] = $row['bookname'];

85 
$nd
->
	`LßdSŒšg
(
$šÃ¹ext
);

88 
$row
['contenttitle'] = '';

89 
$row
['contentid'] = '';

90 if(
$g‘cÚ‹Á
==1) {

91 
$Äow
 = 
$dsql
->
	`G‘OÃ
("SELECT id,title,chapterid FROM `#@__story_content` WHERE bookid='{$row['id']}' order by id desc ");

92 
$row
['cÚ‹Át™Ë'] = 
$Äow
['title'];

93 
$row
['cÚ‹Áid'] = 
$Äow
['id'];

95 if(
$row
['booktype']==1) {

96 
$row
['cÚ‹Áu¾'] = 
$cfg_cm¥©h
.'/book/show-photo.php?id='.$row['contentid'];

99 
$row
['cÚ‹Áu¾'] = 
$cfg_cm¥©h
.'/book/story.php?id='.$row['contentid'];

103 
$row
['dmbooku¾'] = 
$cfg_cm¥©h
.'/book/book.php?id='.$row['id'];

106 
$row
['booku¾'] = $row['u¾'] = 
	`G‘BookU¾
($row['id'],$row['bookname']);

107 
$row
['ÿlogu¾'] = 
$cfg_cm¥©h
.'/book/list.php?id='.$row['catid'];

108 
$row
['cataloglink'] = "<a href='{$row['catalogurl']}'>{$row['classname']}</a>";

109 
$row
['booklink'] = "<a href='{$row['bookurl']}'>{$row['bookname']}</a>";

110 
$row
['contentlink'] = "<a href='{$row['contenturl']}'>{$row['contenttitle']}</a>";

111 
$row
['imglink'] = "<a href='{$row['bookurl']}'><img src='{$row['litpic']}' width='$imgwidth' height='$imgheight' border='0' /></a>";

113 if(
$row
['ischeck']==2) $row['ischeck']='å·²å®Œæˆè¿è½½';

114 
$row
['ischeck']='è¿è½½ä¸­...';

116 if(
$row
['booktype']==0) $row['booktypename']='å°è¯´';

117 
$row
['booktypename']='æ¼«ç”»';

119 if(
	`is_¬¿y
(
$nd
->
CTags
))

121 
	`fÜ—ch
(
$nd
->
CTags
 
as
 
$gid
=>
$ùag
)

123 
$gÇme
 = 
$ùag
->
	`G‘TagName
();

124 if(
	`is£t
(
$row
[
$gÇme
])è
$nd
->
	`Assign
(
$gid
,$row[$tagname]);

125 
$nd
->
	`Assign
(
$gid
,'');

128 
$şi¡
 .ğ
$nd
->
	`G‘ResuÉ
();

131  
$şi¡
;

132 
	}
}

	@E:\web\weixun\functions\taglib\bshare.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

4 
funùiÚ
 
	$lib_bsh¬e
(&
$ùag
,&
$»fObj
)

6 
glob®
 
$dsql
,
$’vs
;

8 
$©i¡
='type|0';

9 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

10 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

11 
$bscodeFe
 = 
XAKDATA
.'/cache/bshare.code.inc';

12 ià(!
	`fe_exi¡s
(
$bscodeFe
))  '';

14 
$»v®
 = 
	`¡r¦ashes
(
	`fe_g‘_cÚ‹Ás
(
$bscodeFe
));

15  
$»v®
;

16 
	}
}

	@E:\web\weixun\functions\taglib\cattree.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
funùiÚ
 
	$lib_ÿ‰»e
(&
$ùag
, &
$»fObj
)

11 
glob®
 
$dsql
;

15 
$©i¡
="showall|,catid|0";

16 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

17 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

18 
$»v®ue
 = '';

20 if(
	`em±y
(
$ty³id
))

22 ifĞ
	`is£t
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id']) ) {

23 
$ty³id
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id'];

24 
$»id
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['reid'];

25 
$tİid
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['topid'];

26 
$chªÃÉy³
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['channeltype'];

27 
$i¥¬t
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['ispart'];

28 if(
$»id
==0è
$tİid
 = 
$ty³id
;

30 
$ty³id
 = 
$»id
 = 
$tİid
 = 
$chªÃÉy³
 = 
$i¥¬t
 = 0;

35 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT„eid,topid,channeltype,ispart FROM `#@__arctype` WHERE id='$typeid' ");

36 if(!
	`is_¬¿y
(
$row
))

38 
$ty³id
 = 
$»id
 = 
$tİid
 = 
$chªÃÉy³
 = 
$i¥¬t
 = 0;

40 
$»id
 = 
$row
['reid'];

41 
$tİid
 = 
$row
['topid'];

42 
$chªÃÉy³
 = 
$row
['channeltype'];

43 
$i¥¬t
 = 
$row
['ispart'];

46 ifĞ!
	`em±y
(
$ÿtid
) )

48 
$tİQu”y
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath FROM `#@__arctype` WHERE„eid='$catid' And ishidden<>1 ";

52 if(
$show®l
 == "yes" )

54 
$tİQu”y
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath FROM `#@__arctype` WHERE„eid='$topid' ";

58 if(
$show®l
=='')

60 ifĞ
$i¥¬t
 < 2 && !
	`em±y
(
$chªÃÉy³
èè
$show®l
 = $channeltype;

61 
$show®l
 = 6;

63 
$tİQu”y
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath FROM `#@__arctype` WHERE„eid='{$topid}' And channeltype='{$showall}' And ispart<2 And ishidden<>1 ";

66 
$dsql
->
	`Execu‹
('t', 
$tİQu”y
);

67 
$row
 = 
$dsql
->
	`G‘A¼ay
('t'))

69 
$row
['ty³lšk'] = 
	`G‘OÃTy³U¾A
($row);

70 
$»v®ue
 .= "<dl class='cattree'>\n";

71 
$»v®ue
 .= "<dt><a href='{$row['typelink']}'>{$row['typename']}</a></dt>\n";

72 
	`ÿ‰»eLi¡SÚ
(
$row
['id'], 
$»v®ue
);

73 
$»v®ue
 .= "</dl>\n";

75  
$»v®ue
;

76 
	}
}

78 
funùiÚ
 
	$ÿ‰»eLi¡SÚ
(
$id
, &
$»v®ue
)

80 
glob®
 
$dsql
;

81 
$qu”y
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath FROM `#@__arctype` WHERE„eid='{$id}' And ishidden<>1 ";

82 
$dsql
->
	`Execu‹
(
$id
, 
$qu”y
);

83 
$thisv
 = '';

84 
$row
 = 
$dsql
->
	`G‘A¼ay
(
$id
))

86 
$row
['ty³lšk'] = 
	`G‘OÃTy³U¾A
($row);

87 
$thisv
 .= " <dl class='cattree'>\n";

88 
$thisv
 .= " <dt><a href='{$row['typelink']}'>{$row['typename']}</a></dt>\n";

89 
	`ÿ‰»eLi¡SÚ
(
$row
['id'], 
$thisv
);

90 
$thisv
 .= " </dl>\n";

92 if(
$thisv
!=''è
$»v®ue
 .= " <dd>\n$thisv </dd>\n";

93 
	}
}

	@E:\web\weixun\functions\taglib\channel.lib.php

1 <?
php


10 
funùiÚ
 
	$lib_chªÃl
(&
$ùag
,&
$»fObj
)

12 
glob®
 
$dsql
;

14 
$©i¡
 = "typeid|0,reid|0,row|100,col|1,type|son,currentstyle|,cacheid|";

15 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

16 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

17 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

18 
$lše
 = 
	`em±y
(
$row
) ? 100 : $row;

20 
$likeTy³
 = '';

22 
$ÿcheid
 = 
	`Œim
($cacheid);

23 if(
$ÿcheid
 !='') {

24 
$likeTy³
 = 
	`G‘CacheBlock
(
$ÿcheid
);

25 if(
$likeTy³
 != '')  $likeType;

28 
$»id
 = 0;

29 
$tİid
 = 0;

31 if(
	`em±y
(
$Áİ
))

33 
$Áİ
 = 0;

39 if(
	`em±y
(
$ty³id
))

41 ifĞ
	`is£t
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id']) )

43 
$ty³id
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id'];

44 
$»id
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['reid'];

45 
$tİid
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['topid'];

48 
$ty³id
 = 0;

54 
$row2
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__arctype` WHERE id='$typeid' ");

55 
$ty³id
 = 
$row2
['id'];

56 
$»id
 = 
$row2
['reid'];

57 
$tİid
 = 
$row2
['topid'];

58 
$is£tInfos
 = 
Œue
;

61 if(
$ty³
=='' || $type=='sun') $type='son';

62 if(
$šÃ¹ext
==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("channel_list.htm");

64 if(
$ty³
=='top')

66 
$sql
 = "SELECT id,typename,typedir,seotitle,content,typepic,open_new,description,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

67 
From
 `#@
__¬ùy³
` 
WHERE
 
»id
=0 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0, 
$lše
 ";

69 if(
$ty³
=='son')

71 if(
$ty³id
==0)  '';

72 
$sql
 = "SELECT id,typename,typedir,seotitle,content,typepic,open_new,description,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

73 
From
 `#@
__¬ùy³
` 
WHERE
 
»id
='$ty³id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0, 
$lše
 ";

75 if(
$ty³
=='self')

77 if(
$»id
==0)  '';

78 
$sql
 = "SELECT id,typename,typedir,seotitle,content,typepic,open_new,description,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

79 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
='$»id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0, 
$lše
 ";

81 if(
$ty³
=='onlyson')

83 if(
$ty³id
==0)  '';

84 
$sql
 = "SELECT id,typename,typedir,seotitle,content,typepic,open_new,description,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

85 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
='$ty³id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0, 
$lše
 ";

88 
$ÃedR–
 = 
çl£
;

89 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

90 
$d2
->
	`S‘NameS·û
('field','[',']');

91 
$d2
->
	`LßdSourû
(
$šÃ¹ext
);

93 if(
	`´eg_m©ch
('#:»l#', 
$šÃ¹ext
)è
$ÃedR–
 = 
Œue
;

95 if(
	`em±y
(
$sql
))  '';

96 
$dsql
->
	`S‘Qu”y
(
$sql
);

97 
$dsql
->
	`Execu‹
();

99 
$tÙ®Row
 = 
$dsql
->
	`G‘TÙ®Row
();

103 if(
$Áİ
 == 0)

105 if(
$ty³
=='sÚ' && 
$»id
!=0 && 
$tÙ®Row
==0)

107 
$sql
 = "Select id,typename,seotitle,typedir,isdefault,ispart,typepic,open_new,defaultname,namerule2,moresite,siteurl,sitepath

108 
From
 `#@
__¬ùy³
` 
wh”e
 
»id
='$»id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0, 
$lše
 ";

109 
$dsql
->
	`S‘Qu”y
(
$sql
);

110 
$dsql
->
	`Execu‹
();

115 if(
$ty³
=='sÚ' && 
$»id
!=
$Áİ
 && 
$tÙ®Row
==0 && $reid !=0)

117 
$sql
 = "SELECT id,typename,typedir,seotitle,content,typepic,open_new,description,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

118 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
='$»id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0, 
$lše
 ";

119 
$dsql
->
	`S‘Qu”y
(
$sql
);

120 
$dsql
->
	`Execu‹
();

124 
$GLOBALS
['autoindex'] = 0;

125 
$i
=0;$˜< 
$lše
;$i++)

127 if(
$cŞ
>1è
$likeTy³
 .= "<dl>\r\n";

128 
$j
=0; $j<
$cŞ
; $j++)

130 if(
$cŞ
>1è
$likeTy³
 .= "<dd>\r\n";

131 if(
$row
=
$dsql
->
	`G‘A¼ay
())

133 
$row
['sonids'] = $row['rel'] = '';

134 if(
$ÃedR–
)

136 
$row
['sÚids'] = 
	`G‘SÚIds
($row['id'], 0, 
çl£
);

137 if(
$row
['sonids']=='') $row['rel'] = '';

138 
$row
['rel'] = "„el='dropmenu{$row['id']}'";

141 ià(
$row
['typepic'] =='')

143 
$row
['typepic'] = '';

147 ià(
$row
['open_new']==1){

148 
$row
['open_new'] ='arget="_blank"';

151 
$row
['open_new'] ='';

154 ifĞ(
$row
['id']==
$ty³id
 || (
$tİid
==$row['id'] && 
$ty³
=='tİ'èè&& 
$cu¼’t¡yË
!='' )

156 
$lškOk¡r
 = 
$cu¼’t¡yË
;

157 
$row
['ty³lšk'] = 
	`G‘OÃTy³U¾A
($row);

158 
$lškOk¡r
 = 
	`¡r_»¶aû
("~»l~",
$row
['rel'],$linkOkstr);

159 
$lškOk¡r
 = 
	`¡r_»¶aû
("~id~",
$row
['id'],$linkOkstr);

160 
$lškOk¡r
 = 
	`¡r_»¶aû
("~ty³lšk~",
$row
['typelink'],$linkOkstr);

161 
$lškOk¡r
 = 
	`¡r_»¶aû
("~ty³Çme~",
$row
['typename'],$linkOkstr);

162 
$lškOk¡r
 = 
	`¡r_»¶aû
("~autošdex~",
$GLOBALS
['autoindex'],$linkOkstr);

163 
$likeTy³
 .ğ
$lškOk¡r
;

167 
$row
['ty³lšk'] = $row['ty³u¾'] = 
	`G‘OÃTy³U¾A
($row);

168 if(
	`is_¬¿y
(
$d2
->
CTags
))

170 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
)

172 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])è
$d2
->
	`Assign
(
$gid
,$row[$ctag->GetName()]);

175 
$likeTy³
 .ğ
$d2
->
	`G‘ResuÉ
();

178 if(
$cŞ
>1è
$likeTy³
 .= "</dd>\r\n";

179 
$GLOBALS
['autoindex']++;

182 if(
$cŞ
>1)

184 
$i
 +ğ
$cŞ
 - 1;

185 
$likeTy³
 .= " </dl>\r\n";

189 
$dsql
->
	`F»eResuÉ
();

190 if(
$ÿcheid
 !='') {

191 
	`Wr™eCacheBlock
(
$ÿcheid
, 
$likeTy³
);

193  
$likeTy³
;

194 
	}
}

	@E:\web\weixun\functions\taglib\channel2.lib.php

1 <?
php


2 
funùiÚ
 
	$lib_chªÃl2
(&
$ùag
,&
$»fObj
)

4 
glob®
 
$_sys_glob®s
,
$’vs
,
$dsql
;

5 
$©i¡
 = "typeid|0,reid|0,row|100,col|1,type|son,currentstyle|";

6 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

7 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

8 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

9 
$ÿcheid
 = 
	`Œim
($cacheid);

10 if(
$ÿcheid
 !='') {

11 
$likeTy³
 = 
	`G‘CacheBlock
(
$ÿcheid
);

12 if(
$likeTy³
 != '')  $likeType;

14 
$»id
 = 0;

15 
$tİid
 = 0;

16 if(
	`em±y
(
$ty³id
è&& 
$’vs
['typeid']!=0)

18 
$ty³id
 = 
$’vs
['typeid'];

19 
$»id
 = 
$’vs
['reid'];

21 
$»id
=0;

23 if(
$ty³
==''||$type=='sun') $type="son";

24 if(
$šÃ¹ext
==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("channel_list.htm");

25 if(
$»id
==0 && 
$ty³id
>0)

27 
$dbrow
 = 
$dsql
->
	`G‘OÃ
("Select„eid From #@__arctype where id='$typeid' ");

28 if(
	`is_¬¿y
(
$dbrow
)è
$»id
 = $dbrow['reid'];

30 
$likeTy³
 = '';

31 if(
$ty³
=='top')

33 
$sql
 = "Select id,typename,seotitle,typedir,isdefault,ispart,typepic,open_new,defaultname,namerule2,moresite,siteurl,sitepath,description

34 
From
 #@
__¬ùy³
 
wh”e
 
»id
=0 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0,
$row
";

36 if(
$ty³
=="son")

39 if(
$ty³id
==0) {

42 
$sql
 = "Select id,typename,seotitle,typedir,isdefault,ispart,typepic,open_new,defaultname,namerule2,moresite,siteurl,sitepath,description

43 
From
 #@
__¬ùy³
 
wh”e
 
»id
='$ty³id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0,
$row
";

45 if(
$ty³
=="self")

47 if(
$»id
==0) {

50 
$sql
 = "Select id,typename,seotitle,typedir,isdefault,ispart,typepic,open_new,defaultname,namerule2,moresite,siteurl,sitepath,description

51 
From
 `#@
__¬ùy³
` 
wh”e
 
»id
='$»id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0,
$row
";

54 
$ÃedR–
 = 
çl£
;

55 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

56 
$d2
->
	`S‘NameS·û
("field","[","]");

57 
$d2
->
	`LßdSourû
(
$šÃ¹ext
);

58 
$dsql2
 = 
şÚe
 
$dsql
;

59 
$dsql
->
	`S‘Qu”y
(
$sql
);

60 
$dsql
->
	`Execu‹
();

61 
$lše
 = 
$row
;

63 if(
	`”eg
(':»l', 
$šÃ¹ext
)è
$ÃedR–
 = 
Œue
;

65 if(
	`em±y
(
$sql
))  '';

66 
$dsql
->
	`S‘Qu”y
(
$sql
);

67 
$dsql
->
	`Execu‹
();

69 
$tÙ®Row
 = 
$dsql
->
	`G‘TÙ®Row
();

72 if(
$ty³
=='sÚ' && 
$»id
!=0 && 
$tÙ®Row
==0)

74 
$sql
 = "Select id,typename,seotitle,typedir,isdefault,ispart,typepic,open_new,defaultname,namerule2,moresite,siteurl,sitepath

75 
From
 `#@
__¬ùy³
` 
wh”e
 
»id
='$»id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0, 
$lše
 ";

76 
$dsql
->
	`S‘Qu”y
(
$sql
);

77 
$dsql
->
	`Execu‹
();

80 
$GLOBALS
['autoindex'] = 0;

81 
$i
=0;$˜< 
$lše
;$i++)

83 if(
$cŞ
>1è
$likeTy³
 .= "<dl>\r\n";

84 
$j
=0;$j<
$cŞ
;$j++)

86 if(
$cŞ
>1è
$likeTy³
 .= "<dd>\r\n";

87 if(
$row
=
$dsql
->
	`G‘A¼ay
())

89 
$row
['sonids'] = $row['rel'] = '';

90 if(
$ÃedR–
)

92 
$row
['sÚids'] = 
	`G‘SÚIds
($row['id'], 0, 
çl£
);

93 if(
$row
['sonids']=='') $row['rel'] = '';

94 
$row
['rel'] = "„el='dropmenu{$row['id']}'";

97 ià(
$row
['open_new']==1){

98 
$row
['open_new'] ='arget="_blank"';

102 
$row
['open_new'] ='';

105 ifĞ(
$row
['id']==
$ty³id
 || (
$tİid
==$row['id'] && 
$ty³
=='tİ'èè&& 
$cu¼’t¡yË
!='' )

108 
$lškOk¡r
 = 
$cu¼’t¡yË
;

109 
$row
['ty³lšk'] = 
	`G‘OÃTy³U¾A
($row);

110 
$lškOk¡r
 = 
	`¡r_»¶aû
("~»l~",
$row
['rel'],$linkOkstr);

111 
$lškOk¡r
 = 
	`¡r_»¶aû
("~id~",
$row
['id'],$linkOkstr);

112 
$lškOk¡r
 = 
	`¡r_»¶aû
("~ty³lšk~",
$row
['typelink'],$linkOkstr);

113 
$lškOk¡r
 = 
	`¡r_»¶aû
("~ty³Çme~",
$row
['typename'],$linkOkstr);

114 
$likeTy³
 .ğ
$lškOk¡r
;

118 
$row
['ty³lšk'] = $row['ty³u¾'] = 
	`G‘OÃTy³U¾A
($row);

119 if(
	`is_¬¿y
(
$d2
->
CTags
))

121 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
){

122 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()]))

124 
$d2
->
	`Assign
(
$gid
,
$row
[
$ùag
->
	`G‘Name
()]);

126 
	`–£if
 (
	`´eg_m©ch
('/^sÚchªÃl[0-9]*$/',
$ùag
->
	`G‘Name
()))

128 
$d2
->
	`Assign
(
$gid
,
	`lib_chªÃl_sÚ
(
$ùag
,
$row
['id'],
$dsql2
));

132 
$likeTy³
 .ğ
$d2
->
	`G‘ResuÉ
();

135 if(
$cŞ
>1è
$likeTy³
 .= "</dd>\r\n";

136 
$GLOBALS
['autoindex']++;

138 if(
$cŞ
>1)

140 
$i
 +ğ
$cŞ
 - 1;

141 
$likeTy³
 .= " </dl>\r\n";

144 
	`»£t
(
$dsql2
);

145 
$dsql
->
	`F»eResuÉ
();

146  
$likeTy³
;

147 
	}
}

148 
funùiÚ
 
	$lib_chªÃl_sÚ
(
$ùag
,
$ty³id
 = 0,
$dsql2
)

150 
$©i¡
 = "row|100,col|1,currentstyle|";

151 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

152 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

153 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

154 
$dsql3
 = 
şÚe
 
$dsql2
;

155 
$likeTy³
 = '';

157 if(
$ty³id
==0) {

160 
$sql
 = "Select id,typename,seotitle,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath,description

161 
From
 #@
__¬ùy³
 
wh”e
 
»id
='$ty³id' 
And
 
ishidd’
<>1 
Üd”
 
by
 
sÜŒªk
 
asc
 
lim™
 0,
$row
";

163 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

164 
$d2
->
	`S‘NameS·û
("field","[","]");

165 
$d2
->
	`LßdSourû
(
$šÃ¹ext
);

166 
$dsql2
->
	`S‘Qu”y
(
$sql
);

167 
$dsql2
->
	`Execu‹
();

168 
$lše
 = 
$row
;

169 
$i
=0;$˜< 
$lše
;$i++)

171 if(
$cŞ
>1è
$likeTy³
 .= "<dl>\r\n";

172 
$j
=0;$j<
$cŞ
;$j++)

174 if(
$cŞ
>1è
$likeTy³
 .= "<dd>\r\n";

175 if(
$row
=
$dsql2
->
	`G‘A¼ay
())

177 
$row
['ty³lšk'] = $row['ty³u¾'] = 
	`G‘OÃTy³U¾A
($row);

178 if(
	`is_¬¿y
(
$d2
->
CTags
))

180 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
){

181 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()]))

183 
$d2
->
	`Assign
(
$gid
,
$row
[
$ùag
->
	`G‘Name
()]);

185 
	`–£if
 (
	`´eg_m©ch
('/^sÚchªÃl[0-9]*$/',
$ùag
->
	`G‘Name
()))

187 
$d2
->
	`Assign
(
$gid
,
	`lib_chªÃl_sÚ
(
$ùag
,
$row
['id'],
$dsql3
));

191 
$likeTy³
 .ğ
$d2
->
	`G‘ResuÉ
();

193 if(
$cŞ
>1è
$likeTy³
 .= "</dd>\r\n";

195 if(
$cŞ
>1)

197 
$i
 +ğ
$cŞ
 - 1;

198 
$likeTy³
 .= " </dl>\r\n";

201 
	`»£t
(
$dsql3
);

202 
$dsql2
->
	`F»eResuÉ
();

203  
$likeTy³
;

204 
	}
}

	@E:\web\weixun\functions\taglib\channel\img.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

12 
funùiÚ
 
ch_img
(
$fv®ue
,&
$¬cTag
,&
$»fObj
,
$âame
='')

14 
glob®
 
$cfg_®bum_width
,
$cfg_®bum_row
,
$cfg_®bum_cŞ
,
$cfg_®bum_·gesize
,
$cfg_®bum_¡yË
,
$cfg_®bum_ddwidth
,
$cfg_ba£ho¡
,
$cfg_muÉi_s™e
;

15 
	g$d
 = 
Ãw
 
XakTagP¬£
();

16 
	g$d
->
LßdSourû
(
$fv®ue
);

17 if(!
is_¬¿y
(
$d
->
CTags
))

19 
	g$d
->
CË¬
();

22 
	g$·ge¡yË
 = 
$cfg_®bum_¡yË
;

23 
	g$maxwidth
 = 
$cfg_®bum_width
;

24 
	g$ddmaxwidth
 = 
$cfg_®bum_ddwidth
;

25 
	g$·g•iúum
 = 
$cfg_®bum_·gesize
;

26 
	g$row
 = 
$cfg_®bum_row
;

27 
	g$icŞ
 = 
$cfg_®bum_cŞ
;

28 
	g$±ag
 = 
$d
->
G‘Tag
('pagestyle');

29 if(
is_objeù
(
$±ag
))

31 
	g$·ge¡yË
 = 
$±ag
->
G‘A‰
('value');

32 
	g$maxwidth
 = 
$±ag
->
G‘A‰
('maxwidth');

33 
	g$ddmaxwidth
 = 
$±ag
->
G‘A‰
('ddmaxwidth');

34 
	g$·g•iúum
 = 
$±ag
->
G‘A‰
('pagepicnum');

35 
	g$œow
 = 
$±ag
->
G‘A‰
('row');

36 
	g$icŞ
 = 
$±ag
->
G‘A‰
('col');

37 if(
em±y
(
$maxwidth
))

39 
	g$maxwidth
 = 
$cfg_®bum_width
;

44 
	g$mrow
 = 0;

45 
	g$mcŞ
 = 0;

46 
	g$images
 = 
¬¿y
();

47 
	g$šÃrTmp
 = 
$¬cTag
->
G‘IÂ”Text
();

48 if(
Œim
(
$šÃrTmp
)=='')

50 
$šÃrTmp
 = 
G‘SysTem¶‘s
("channel_article_image.htm");

53 if(
	g$·ge¡yË
==1)

55 
$·gesize
 = 
$·g•iúum
;

57 if(
	g$·ge¡yË
==2)

59 
$·gesize
 = 1;

63 
	g$·gesize
 = 
$œow
 * 
$icŞ
;

66 if(
is_objeù
(
$¬cTag
è&& 
	g$¬cTag
->
G‘A‰
('pagesize') > 0)

68 
	g$·gesize
 = 
$¬cTag
->
G‘A‰
('pagesize');

70 if(
em±y
(
$·gesize
))

72 
	g$·gesize
 = 12;

74 
	g$aid
 = 
$»fObj
->
ArcID
;

75 
	g$row
 = 
$»fObj
->
dsql
->
G‘OÃ
("SELECTitle FROM `#@__archives` WHERE `id` = '$aid';");

76 
	g$t™Ë
 = 
$row
['title'];

77 
	g$»v®ue
 = '';

78 
	g$GLOBAL
['photoid'] = 0;

79 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

81 if(
	g$ùag
->
G‘Name
()=="img")

83 
$f›lds
 = 
$ùag
->
CA‰ribu‹
->
I‹ms
;

84 
	g$f›lds
['‹xt'] = 
¡r_»¶aû
("'","",
$ùag
->
G‘A‰
('text'));

85 
	g$f›lds
['t™Ë'] = 
$t™Ë
;

86 
	g$f›lds
['img¤c'] = 
Œim
(
$ùag
->
G‘IÂ”Text
());

87 
	g$f›lds
['img¤ùrue'] = 
$f›lds
['imgsrc'];

88 if(
em±y
(
$f›lds
['ddimg']))

90 
	g$f›lds
['ddimg'] = 
$f›lds
['imgsrc'];

92 if(
	g$cfg_muÉi_s™e
=='Y')

95 ifĞ!
´eg_m©ch
('#^h‰p:#i', 
$f›lds
['imgsrc']) ) {

96 
$f›lds
['img¤c'] = 
$cfg_ba£ho¡
.$fields['imgsrc'];

98 ifĞ!
´eg_m©ch
('#^h‰p:#i', 
$f›lds
['ddimg']) ) {

99 
	g$f›lds
['ddimg'] = 
$cfg_ba£ho¡
.
$f›lds
['ddimg'];

102 if(
em±y
(
$f›lds
['width']))

104 
	g$f›lds
['width'] = 
$maxwidth
;

110 
	g$f›lds
['®‰ext'] = 
¡r_»¶aû
("'",'',
$f›lds
['text']);

111 
	g$f›lds
['·ge¡yË'] = 
$·ge¡yË
;

112 
	g$d2
 = 
Ãw
 
XakTagP¬£
();

113 
	g$d2
->
S‘NameS·û
("field","[","]");

114 
	g$d2
->
LßdSourû
(
$šÃrTmp
);

115 if(
	g$GLOBAL
['phÙoid']>0 && ($GLOBAL['phÙoid'] % 
	g$·gesize
)==0)

117 
$»v®ue
 .= "#p#åˆ†é¡µæ ‡é¢˜#e#";

119 if(
	g$·ge¡yË
==1)

121 
$f›lds
['imgwidth'] = '';

122 
	g$f›lds
['lšku¾'] = 
$f›lds
['imgsrc'];

123 
	g$f›lds
['textlink'] = "<br /><a href='{$fields['linkurl']}'arget='_blank'>{$fields['text']}</a>";

125 if(
	g$·ge¡yË
==2)

127 if(
$f›lds
['width'] > 
$maxwidth
) {

128 
$f›lds
['imgwidth'] = " width='$maxwidth' ";

131 
	g$f›lds
['imgwidth'] = " width='{$fields['width']}' ";

133 
	g$f›lds
['lšku¾'] = 
$f›lds
['imgsrc'];

134 if(
	g$f›lds
['text']!='') {

135 
$f›lds
['textlink'] = "<br /><a href='{$fields['linkurl']}'arget='_blank'>{$fields['text']}</a>\r\n";

138 
	g$f›lds
['textlink'] = '';

141 if(
	g$·ge¡yË
==3)

143 
$f›lds
['text'] = $fields['textlink'] = '';

144 
	g$f›lds
['img¤c'] = 
$f›lds
['ddimg'];

145 
	g$f›lds
['imgwidth'] = " width='$ddmaxwidth' ";

146 
	g$f›lds
['lšku¾'] = "{$GLOBALS['cfg_phpu¾']}/showphÙo.php?aid={$»fObj->ArcID}&¤c=".
u¾’code
(
$f›lds
['imgsrctrue'])."&npos={$GLOBAL['photoid']}";

148 if(
is_¬¿y
(
$d2
->
CTags
))

150 
fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
)

152 if(
is£t
(
$f›lds
[
$ùag
->
G‘Name
()]))

154 
$d2
->
Assign
(
$gid
,
$f›lds
[
$ùag
->
G‘Name
()]);

157 
	g$»v®ue
 .ğ
$d2
->
G‘ResuÉ
();

159 
	g$GLOBAL
['photoid']++;

162  
	g$»v®ue
;

	@E:\web\weixun\functions\taglib\channel\softlinks.lib.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

19 
funùiÚ
 
ch_soálšks
(
$fv®ue
, &
$ùag
, &
$»fObj
, 
$âame
='', 
$dowÆßd·ge
=
çl£
)

21 
glob®
 
$dsql
;

22 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__softconfig` ");

23 
	g$phµ©h
 = 
$GLOBALS
['cfg_phpurl'];

24 
	g$dowÆšks
 = '';

25 if(
	g$row
['dowÁy³']!='0' && !
$dowÆßd·ge
)

27 
$‹mpSŒ
 = 
G‘SysTem¶‘s
("channel_downlinkpage.htm");

28 
	g$lšks
 = 
$phµ©h
."/dowÆßd.php?İ’=0&aid=".
$»fObj
->
ArcID
."&cid=".$»fObj->
ChªÃlID
;

29 
	g$dowÆšks
 = 
¡r_»¶aû
("~lšk~", 
$lšks
, 
$‹mpSŒ
);

30  
	g$dowÆšks
;

34  
ch_soálšks_®l
(
$fv®ue
, 
$ùag
, 
$»fObj
, 
$row
);

39 
funùiÚ
 
	$ch_soálšks_®l
(
$fv®ue
, &
$ùag
, &
$»fObj
, &
$row
)

41 
glob®
 
$dsql
, 
$cfg_phpu¾
;

42 
$phµ©h
 = 
$cfg_phpu¾
;

43 
$i¦škty³
 = 
çl£
;

45 if(!
	`em±y
(
$lšk_ty³
)è
$i¦škty³
 = 
Œue
;

46 
$d
 = 
Ãw
 
	`XakTagP¬£
();

47 
$d
->
	`LßdSourû
(
$fv®ue
);

48 ifĞ!
	`is_¬¿y
(
$d
->
CTags
) )

50 
$d
->
	`CË¬
();

54 ià(!
	`em±y
(
$row
['sites']))

56 
$£¹y³_¬r
 = 
	`¬¿y
();

57 
$row
['s™es'] = 
	`´eg_»¶aû
("#[\r\n]{1,}#", "\n", $row['sites']);

58 
$s™es
 = 
	`ex¶ode
("\n", 
	`Œim
(
$row
['sites']));

59 
	`fÜ—ch
(
$s™es
 
as
 
$s™e
)

61 if(
	`Œim
(
$s™e
)=='') ;

62 
	`li¡
(
$lšk
,
$£rv”Name
,
$£rv”Ty³
èğ
	`ex¶ode
('|', 
$s™e
);

63 
$£¹y³_¬r
[
	`Œim
(
$£rv”Name
)] =rim(
$£rv”Ty³
);

67 
$‹mpSŒ
 = 
	`G‘SysTem¶‘s
('channel_downlinks.htm');

68 
$dowÆšks
 = '';

69 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

71 if(
$ùag
->
	`G‘Name
()=='link')

73 
$lšk
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

74 
$£rv”Name
 = 
	`Œim
(
$ùag
->
	`G‘A‰
('text'));

75 
$i¦oÿl
 = 
	`Œim
(
$ùag
->
	`G‘A‰
('islocal'));

76 ià(
	`is£t
(
$£¹y³_¬r
[
$£rv”Name
]è&& 
$i¦škty³
 && $£¹y³_¬r[$£rv”Name] !ğ
$lšk_ty³
) ;

79 if(!
	`is£t
(
$fœ¡Lšk
è&& 
$i¦oÿl
==1è$fœ¡Lšk = 
$lšk
;

80 if(
$i¦oÿl
==1 && 
$row
['islocal'] != 1) ;

83 if(!
	`´eg_m©ch
("#^h‰p:\/\/|^thund”:\/\/|^áp:\/\/|^æashg‘:\/\/#i", 
$lšk
))

85 
$lšk
 = 
$GLOBALS
['cfg_mainsite'].$link;

87 
$dowÆßds
 = 
	`g‘DowÆßds
(
$lšk
);

88 
$uhash
 = 
	`sub¡r
(
	`md5
(
$lšk
), 0, 24);

89 if(
$row
['gotojump']==1)

91 
$lšk
 = 
$phµ©h
."/download.php?open=2&id={$refObj->ArcID}&uhash={$uhash}";

93 
$‹mp
 = 
	`¡r_»¶aû
("~lšk~",
$lšk
,
$‹mpSŒ
);

94 
$‹mp
 = 
	`¡r_»¶aû
("~£rv”~",
$£rv”Name
,$temp);

95 
$‹mp
 = 
	`¡r_»¶aû
("~dowÆßds~",
$dowÆßds
,$temp);

96 
$dowÆšks
 .ğ
$‹mp
;

99 
$d
->
	`CË¬
();

102 
$lškCouÁ
 = 1;

103 if(
$row
['ismÜes™e']==1 && $row['mÜes™edo']==1 && 
	`Œim
($row['s™es'])!='' && 
	`is£t
(
$fœ¡Lšk
))

105 
$fœ¡Lšk
 = 
	`´eg_»¶aû
("#http:\/\/([^\/]*)\/#i", '/', $firstLink);

107 
	`fÜ—ch
(
$s™es
 
as
 
$s™e
)

109 if(
	`Œim
(
$s™e
)=='') ;

110 
	`li¡
(
$lšk
,
$£rv”Name
,
$£rv”Ty³
èğ
	`ex¶ode
('|', 
$s™e
);

111 ià(!
	`em±y
(
$lšk_ty³
è&& $lšk_ty³ !ğ
	`Œim
(
$£rv”Ty³
)) ;

113 
$lšk
 = 
	`Œim
Ğ
	`´eg_»¶aû
("#\/$#", "", $lškè).
$fœ¡Lšk
;

114 
$dowÆßds
 = 
	`g‘DowÆßds
(
$lšk
);

115 
$uhash
 = 
	`sub¡r
(
	`md5
(
$lšk
), 0, 24);

116 if(
$row
['gotojump']==1)

118 
$lšk
 = 
$phµ©h
."/download.php?open=2&id={$refObj->ArcID}&uhash={$uhash}";

120 
$‹mp
 = 
	`¡r_»¶aû
("~lšk~", 
$lšk
, 
$‹mpSŒ
);

121 
$‹mp
 = 
	`¡r_»¶aû
("~£rv”~", 
$£rv”Name
, $temp);

122 
$‹mp
 = 
	`¡r_»¶aû
("~dowÆßds~", 
$dowÆßds
, $temp);

123 
$dowÆšks
 .ğ
$‹mp
;

126  
$dowÆšks
;

127 
	}
}

129 
funùiÚ
 
	$g‘DowÆßds
(
$u¾
)

131 
glob®
 
$dsql
;

132 
$hash
 = 
	`md5
(
$u¾
);

133 
$qu”y
 = "SELECT downloads FROM `#@__downloads` WHERE hash='$hash' ";

134 
$row
 = 
$dsql
->
	`G‘OÃ
(
$qu”y
);

135 if(
	`is_¬¿y
(
$row
))

137 
$dowÆßds
 = 
$row
['downloads'];

141 
$dowÆßds
 = 0;

143  
$dowÆßds
;

144 
	}
}

	@E:\web\weixun\functions\taglib\channel\specialtopic.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
funùiÚ
 
ch_¥ecŸÉİic
(
$nÙešfo
, 
$¬cTag
, 
$»fObj
, 
$âame
='')

10 
»quœe_Úû
(
XAKINC
.'/taglib/arclist.lib.php');

11 if(
	g$nÙešfo
=='')  '';

12 
	g$nÙeid
 = 
$¬cTag
->
G‘A‰
('noteid');

13 
	g$rv®ue
 = '';

14 
	g$‹mpSŒ
 = 
G‘SysTem¶‘s
('channel_spec_note.htm');

15 
	g$d
 = 
Ãw
 
XakTagP¬£
();

16 
	g$d
->
LßdSourû
(
$nÙešfo
);

17 if(
is_¬¿y
(
$d
->
CTags
))

19 
fÜ—ch
(
$d
->
CTags
 
as
 
$k
=>
$ùag
)

21 
$nÙ’ame
 = 
$ùag
->
G‘A‰
('name');

23 if(
	g$nÙeid
 !ğ'' && 
$ùag
->
G‘A‰
('nÙeid'è!ğ
$nÙeid
)

27 
	g$i§uto
 = 
$ùag
->
G‘A‰
('isauto');

28 
	g$idli¡
 = 
Œim
(
$ùag
->
G‘A‰
('idlist'));

29 
	g$rownum
 = 
Œim
(
$ùag
->
G‘A‰
('rownum'));

30 
	g$keywÜds
 = '';

31 
	g$¡y³id
 = 0;

32 if(
em±y
(
$rownum
)è
	g$rownum
 = 40;

35 if(
	g$i§uto
==1)

37 
$idli¡
 = '';

38 
	g$keywÜds
 = 
Œim
(
$ùag
->
G‘A‰
('keywords'));

39 
	g$¡y³id
 = 
$ùag
->
G‘A‰
('typeid');

42 
	g$li¡Tem¶‘
 = 
Œim
(
$ùag
->
G‘IÂ”Text
())!='' ? $ùag->G‘IÂ”Text(è: 
G‘SysTem¶‘s
('spec_arclist.htm');

44 
	g$idv®ue
 = 
lib_¬şi¡DÚe


46 
$»fObj
, 
	g$ùag
, 
	g$¡y³id
, 
	g$rownum
, $ùag->
G‘A‰
('col'), $ctag->GetAtt('titlelen'),$ctag->GetAtt('infolen'),

47 
	g$ùag
->
G‘A‰
('imgwidth'), $ùag->G‘A‰('imgheight'), '®l', 'deçuÉ', 
	g$keywÜds
, 
	g$li¡Tem¶‘
, 0, 
	g$idli¡
,

48 
	g$ùag
->
G‘A‰
('channel'), '', $ctag->GetAtt('att')

50 
	g$nÙe¡r
 = 
¡r_»¶aû
('~nÙ’ame~', 
$nÙ’ame
, 
$‹mpSŒ
);

51 
	g$nÙe¡r
 = 
¡r_»¶aû
('~¥ec_¬şi¡~', 
$idv®ue
, 
$nÙe¡r
);

52 
	g$rv®ue
 .ğ
$nÙe¡r
;

53 if(
	g$nÙeid
 !ğ'' && 
$ùag
->
G‘A‰
('nÙeid')==
$nÙeid
) ;

56 
	g$d
->
CË¬
();

57  
	g$rv®ue
;

	@E:\web\weixun\functions\taglib\channel\stepselect.lib.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
("Warning...");

4 
funùiÚ
 
ch_¡•£Ëù
(
$fv®ue
,&
$¬cTag
,&
$»fObj
,
$âame
='')

6  
G‘EnumsV®ue2
(
$âame
,
$fv®ue
);

14 
funùiÚ
 
	$G‘EnumsV®ue2
(
$egroup
,
$ev®ue
=0)

16 ifĞ!
	`is£t
(
$GLOBALS
['em_'.
$egroup
.'s']) )

18 
$ÿchefe
 = 
XAKDATA
.'/’ums/'.
$egroup
.'.php';

19 if(!
	`fe_exi¡s
(
$ÿchefe
))

21 
	`»quœe_Úû
(
XAKINC
.'/enums.func.php');

22 
	`Wr™eEnumsCache
();

24 if(!
	`fe_exi¡s
(
$ÿchefe
))

30 
	`»quœe_Úû
(
$ÿchefe
);

33 if(
$ev®ue
>=500)

35 if(
$ev®ue
 % 500 == 0)

37  (
	`is£t
(
$GLOBALS
['em_'.
$egroup
.'s'][
$ev®ue
]) ? $GLOBALS['em_'.$egroup.'s'][$evalue] : '');

39 ià(
	`´eg_m©ch
("#([0-9]{1,})\.([0-9]{1,})#", 
$ev®ue
, 
$m©chs
))

41 
$esÚv®ue
 = 
$m©chs
[1];

42 
$‘İv®ue
 = 
$esÚv®ue
 - ($esonvalue % 500);

43 
$e£cv®ue
 = 
$ev®ue
;

44 
$GLOBALS
['em_'.
$egroup
.'s'][
$‘İv®ue
] = 
	`em±y
($GLOBALS['em_'.$egroup.'s'][$etopvalue])? ''

45 : 
$GLOBALS
['em_'.
$egroup
.'s'][
$‘İv®ue
];

46 
$GLOBALS
['em_'.
$egroup
.'s'][
$esÚv®ue
] = 
	`em±y
($GLOBALS['em_'.$egroup.'s'][$esonvalue])? ''

47 : 
$GLOBALS
['em_'.
$egroup
.'s'][
$esÚv®ue
];

48 
$GLOBALS
['em_'.
$egroup
.'s'][
$e£cv®ue
] = 
	`em±y
($GLOBALS['em_'.$egroup.'s'][$esecvalue])? ''

49 : 
$GLOBALS
['em_'.
$egroup
.'s'][
$e£cv®ue
];

50  
$GLOBALS
['em_'.
$egroup
.'s'][
$‘İv®ue
].' -- '.$GLOBALS['em_'.$egroup.'s'][
$esÚv®ue
].' -- '.$GLOBALS['em_'.$egroup.'s'][
$e£cv®ue
];

54 
$–im™
 = 
$ev®ue
 % 500;

55 
$”ev®ue
 = 
$ev®ue
 - 
$–im™
;

56 
$GLOBALS
['em_'.
$egroup
.'s'][
$”ev®ue
] = 
	`em±y
($GLOBALS['em_'.$egroup.'s'][$erevalue])? ''

57 : 
$GLOBALS
['em_'.
$egroup
.'s'][
$”ev®ue
];

58 
$GLOBALS
['em_'.
$egroup
.'s'][
$ev®ue
] = 
	`em±y
($GLOBALS['em_'.$egroup.'s'][$evalue])? ''

59 : 
$GLOBALS
['em_'.
$egroup
.'s'][
$ev®ue
];

60  
$GLOBALS
['em_'.
$egroup
.'s'][
$”ev®ue
].' -- '.$GLOBALS['em_'.$egroup.'s'][
$ev®ue
];

63 
	}
}

	@E:\web\weixun\functions\taglib\channelartlist.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
»quœe_Úû
(
XAKINC
.'/arc.partview.class.php');

11 
funùiÚ
 
	$lib_chªÃÏ¹li¡
(&
$ùag
,&
$»fObj
)

13 
glob®
 
$dsql
,
$’vs
,
$_sys_glob®s
;

16 
$©i¡
 = 'typeid|0,row|20,cacheid|';

17 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

18 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

19 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

20 
$¬i¡
 = '';

22 
$ÿcheid
 = 
	`Œim
($cacheid);

23 if(
$ÿcheid
 !='') {

24 
$¬i¡
 = 
	`G‘CacheBlock
(
$ÿcheid
);

25 if(
$¬i¡
!='')  $artlist;

28 if(
	`em±y
(
$ty³id
))

30 
$ty³id
 = ( !
	`em±y
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id']) ? $refObj->TypeLink->TypeInfos['id'] : 0 );

33 if(
$šÃ¹ext
==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
('part_channelartlist.htm');

34 
$tÙ®num
 = 
$row
;

35 if(
	`em±y
(
$tÙ®num
)) $totalnum = 20;

38 
$ty³ids
 = 
	`¬¿y
();

39 if(
$ty³id
==0 || $typeid=='top') {

40 
$sql
 = "„eid=0 AND ispart<>2 AND ishidden<>1 AND channeltype>0 ";

44 if(!
	`´eg_m©ch
('#,#', 
$ty³id
)) {

45 
$sql
 = "„eid='$typeid' AND ispart<>2 AND ishidden<>1 ";

48 
$sql
 = " id IN($typeid) AND ispart<>2 AND ishidden<>1 ";

51 
$dsql
->
	`S‘Qu”y
("SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

52 
FROM
 `#@
__¬ùy³
` 
WHERE
 
$sql
 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
LIMIT
 
$tÙ®num
");

53 
$dsql
->
	`Execu‹
();

54 
$row
 = 
$dsql
->
	`G‘A¼ay
()) {

55 
$ty³ids
[] = 
$row
;

58 if(!
	`is£t
(
$ty³ids
[0]))  '';

60 
$GLOBALS
['itemindex'] = 0;

61 
$GLOBALS
['itemparity'] = 1;

62 
$i
=0;
	`is£t
(
$ty³ids
[$i]);$i++)

64 
$GLOBALS
['itemindex']++;

65 
$pv
 = 
Ãw
 
	`P¬tV›w
(
$ty³ids
[
$i
]['id']);

66 
$pv
->
F›lds
['ty³u¾'] = 
	`G‘OÃTy³U¾A
(
$ty³ids
[
$i
]);

67 
$pv
->
	`S‘Tem¶‘
(
$šÃ¹ext
,'string');

68 
$¬i¡
 .ğ
$pv
->
	`G‘ResuÉ
();

69 
$GLOBALS
['itemparity'] = ($GLOBALS['itemparity']==1 ? 2 : 1);

72 
$GLOBALS
['’vs']['ty³id'] = 
$_sys_glob®s
['typeid'];

73 
$GLOBALS
['envs']['reid'] = '';

74 if(
$ÿcheid
 !='') {

75 
	`Wr™eCacheBlock
(
$ÿcheid
, 
$¬i¡
);

77  
$¬i¡
;

78 
	}
}

	@E:\web\weixun\functions\taglib\channeltitle.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

17 
funùiÚ
 
	$lib_chªÃÉ™Ë
(&
$ùag
,&
$»fObj
)

19 
glob®
 
$dsql
,
$’vs
;

22 
$©i¡
="order|forward,character|-";

23 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

24 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

25 
$»v®ue
 = '';

26 
$curID
 = 
$’vs
['typeid'];

27 
$Ty³Lšk
 = 
Ãw
 
	`Ty³Lšk
(
$curID
);

30 
$Tem´ev®ue
 = 
	`”eg_»¶aû
("[<>-]",
$ch¬aù”
,
$Ty³Lšk
->
	`G‘Pos™iÚLšk
(
çl£
));

31 if(
$Üd”
 =="forward")

33 
$»v®ue
 = 
$Tem´ev®ue
;

37 
$»v®u—¼ays
 = 
	`ex¶ode
(
$ch¬aù”
,
$Tem´ev®ue
);

38 
	`fÜ—ch
(
$»v®u—¼ays
 
as
 
$key
 => 
$»v®u—¼ay
)

40 (
$key
 =ğ0)? 
$Tem´e
 = 
	`Œim
(
$»v®u—¼ay
):$Tem´ğŒim($»v®u—¼ay).
$ch¬aù”
.$Tempre;

42 
$»v®ue
 = 
$Tem´e
;

44 
$Ïng
=
	`¬¿y
('ä¸­æ–‡','English','ç®€ä½“ä¸­æ–‡','æ—¥æœ¬è¯­','En');

45 
	`fÜ—ch
(
$Ïng
 
as
 
$key
 => 
$v®
)

47 
$»v®ue
 =
	`¡r_»¶aû
(
$ch¬aù”
.
$v®
,'',$revalue);

50  
$»v®ue
;

51 
	}
}

	@E:\web\weixun\functions\taglib\demotag.lib.php

1 <?
php


2 if(!
defšed
('XAKINC')){

3 
ex™
("Warning...");

12 
funùiÚ
 
	$lib_demÙag
(&
$ùag
,&
$»fObj
)

14 
glob®
 
$dsql
,
$’vs
;

17 
$©i¡
="row|12,titlelen|24";

18 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

19 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

20 
$»v®ue
 = '';

25 
$»v®ue
 = 'Hello Word!';

28  
$»v®ue
;

29 
	}
}

	@E:\web\weixun\functions\taglib\feedback.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

14 
funùiÚ
 
	$lib_ãedback
(&
$ùag
,&
$»fObj
)

16 
glob®
 
$dsql
;

17 
$©i¡
="row|12,titlelen|24,infolen|100";

18 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

19 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

20 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

21 
$tÙ®row
 = 
$row
;

22 
$»v®ue
 = '';

23 if(
	`em±y
(
$šÃ¹ext
))

25 
$šÃ¹ext
 = 
	`G‘SysTem¶‘s
('tag_feedback.htm');

27 
$wsql
 = " where ischeck=1 ";

28 
$equ”y
 = "SELECT * FROM `#@__feedback` $wsql ORDER BY id DESC LIMIT 0 , $totalrow";

29 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

30 
$ùp
->
	`S‘NameS·û
('field','[',']');

31 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

33 
$dsql
->
	`Execu‹
('fb',
$equ”y
);

34 
$¬r
=
$dsql
->
	`G‘A¼ay
('fb'))

36 
$¬r
['t™Ë'] = 
	`ú_sub¡r
($¬r['¬ù™Ë'],
$t™ËËn
);

37 
$¬r
['msg'] = 
	`jsTrim
(
	`Html2Text
($¬r['msg']),
$šfŞ’
);

38 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

40 if(!
	`em±y
(
$¬r
[
$ùag
->
	`G‘Name
()]))

42 
$ùp
->
	`Assign
(
$gid
,
$¬r
[
$ùag
->
	`G‘Name
()]);

45 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

47  
$»v®ue
;

48 
	}
}

50 
funùiÚ
 
	$jsTrim
(
$¡r
,
$Ën
)

52 
$¡r
 = 
	`´eg_»¶aû
("/{quote}(.*){\/quote}/is",'',$str);

53 
$¡r
 = 
	`¡r_»¶aû
('&lt;br/&gt;',' ',$str);

54 
$¡r
 = 
	`ú_sub¡r
($¡r,
$Ën
);

55 
$¡r
 = 
	`´eg_»¶aû
("#['\"\r\n]#", "", $str);

56  
$¡r
;

57 
	}
}

	@E:\web\weixun\functions\taglib\flink.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

13 
funùiÚ
 
	$lib_æšk
(&
$ùag
,&
$»fObj
)

16 
glob®
 
$dsql
,
$cfg_soá_Ïng
;

17 
$©i¡
="type|textall,row|24,titlelen|24,linktype|1,typeid|0";

18 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

19 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

20 
$tÙ®row
 = 
$row
;

21 
$»v®ue
 = '';

22 ià(
	`is£t
(
$GLOBALS
['envs']['flinkid']))

24 
$ty³id
 = 
$GLOBALS
['envs']['flinkid'];

27 
$wsql
 = " where ischeck >= '$linktype' ";

29 if(
$ty³id
 == 0)

31 
$wsql
 .= '';

35 
$wsql
 .= "Andypeid = '$typeid'";

37 if(
$ty³
=='image')

39 
$wsql
 .= " And†ogo<>'' ";

41 if(
$ty³
=='text')

43 
$wsql
 .= " And†ogo='' ";

46 
$equ”y
 = "SELECT * FROM #@__flink $wsql order by sortrank‡sc†imit 0,$totalrow";

48 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())==''è
$šÃ¹ext
 = "<li>[field:link /]</li>";

49 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

51 
$dsql
->
	`S‘Qu”y
(
$equ”y
);

52 
$dsql
->
	`Execu‹
();

54 
$dbrow
=
$dsql
->
	`G‘Objeù
())

56 if(
$ty³
=='text'||$type=='textall')

58 
$lšk
 = "<¨h»f='".
$dbrow
->
u¾
."'¬g‘='_bÏnk'>".
	`ú_sub¡r
($dbrow->
webÇme
,
$t™ËËn
)."</a> ";

60 if(
$ty³
=='image')

62 
$lšk
 = "<¨h»f='".
$dbrow
->
u¾
."'¬g‘='_bÏnk'><img src='".$dbrow->
logo
."' width='88' height='31' border='0'></a> ";

66 if(
$dbrow
->
logo
=='')

68 
$lšk
 = "<¨h»f='".
$dbrow
->
u¾
."'¬g‘='_bÏnk'>".
	`ú_sub¡r
($dbrow->
webÇme
,
$t™ËËn
)."</a> ";

72 
$lšk
 = "<¨h»f='".
$dbrow
->
u¾
."'¬g‘='_bÏnk'><img src='".$dbrow->
logo
."' width='88' height='31' border='0'></a> ";

75 
$rb‹xt
 = 
	`´eg_»¶aû
("/\[f›ld:u¾([\/\s]{0,})\]/isU", 
$row
['u¾'], 
$šÃ¹ext
);

76 
$rb‹xt
 = 
	`´eg_»¶aû
("/\[f›ld:webÇme([\/\s]{0,})\]/isU", 
$row
['webname'], $rbtext);

77 
$rb‹xt
 = 
	`´eg_»¶aû
("/\[f›ld:logo([\/\s]{0,})\]/isU", 
$row
['logo'], $rbtext);

78 
$rb‹xt
 = 
	`´eg_»¶aû
("/\[f›ld:lšk([\/\s]{0,})\]/isU", 
$lšk
, $rbtext);

79 
$»v®ue
 .ğ
$rb‹xt
;

81  
$»v®ue
;

82 
	}
}

	@E:\web\weixun\functions\taglib\flinktype.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

6 
»quœe_Úû
(
XAKINC
."/taglib/flink.lib.php");

15 
funùiÚ
 
	$lib_æškty³
(&
$ùag
,&
$»fObj
)

17 
glob®
 
$dsql
;

18 
$©i¡
="row|24,titlelen|24";

19 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

20 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

22 
$tÙ®row
 = 
$row
;

23 
$»v®ue
 = '';

25 
$equ”y
 = "SELECT * FROM #@__flinktype order by id‡sc†imit 0,$totalrow";

27 if(
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())==''è
$šÃ¹ext
 = "<li>[field:typename /]</li>";

28 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

29 if(!
	`is£t
(
$ty³
)) $type = '';

30 
$d
 = 
Ãw
 
	`XakTagP¬£
();

31 
$d
->
	`S‘NameS·û
("xak","{","}");

32 
$d
->
	`LßdSŒšg
(
$šÃ¹ext
);

34 
$dsql
->
	`S‘Qu”y
(
$equ”y
);

35 
$dsql
->
	`Execu‹
();

36 
$rs
 = '';

37 
$row
 = 
	`¬¿y
();

38 
$dbrow
=
$dsql
->
	`G‘Objeù
())

40 
$row
[] = 
$dbrow
;

43 
	`fÜ—ch
 (
$row
 
as
 
$key
 => 
$v®ue
) {

44 ià(
	`is_¬¿y
(
$d
->
CTags
))

46 
$GLOBALS
['’vs']['æškid'] = 
$v®ue
->
id
;

47 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

49 
$gÇme
 = 
$ùag
->
	`G‘Name
();

50 if(
$gÇme
=="æšk"è
$d
->
	`Assign
(
$gid
, 
	`lib_æšk
(
$ùag
, 
$»fObj
));

53 
$rs
 = 
$d
->
	`G‘ResuÉ
();

54 
$rs
 = 
	`´eg_»¶aû
("/\[f›ld:id([\/\s]{0,})\]/isU", 
$v®ue
->
id
, $rs);

55 
$rs
 = 
	`´eg_»¶aû
("/\[f›ld:ty³Çme([\/\s]{0,})\]/isU", 
$v®ue
->
ty³Çme
, $rs);

56 
$»v®ue
 .ğ
$rs
;

59  
$»v®ue
;

60 
	}
}

	@E:\web\weixun\functions\taglib\group.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
funùiÚ
 
	$lib_group
(&
$ùag
,&
$»fObj
)

10 
glob®
 
$dsql
, 
$’vs
, 
$cfg_db´efix
, 
$cfg_cmsu¾
;

12 
$©i¡
="row|6,orderby|threads,titlelen|30";

13 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

14 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

16 ifĞ!
$dsql
->
	`IsTabË
("{$cfg_dbprefix}groups") )  'æ²¡å®‰è£…åœˆå­æ¨¡å—';

18 if(!
	`´eg
("#\/$#", 
$cfg_cmsu¾
)è
$cfg_group_u¾
 = $cfg_cmsurl.'/group';

19 
$cfg_group_u¾
 = 
$cfg_cmsu¾
.'group';

21 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

22 if(
	`Œim
(
$šÃ¹ext
)==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("groups.htm");

24 
$li¡
 = '';

25 
$dsql
->
	`S‘Qu”y
("SELECT groupimg,groupid,groupname FROM `#@__groups` WHERE ishidden=0 ORDER BY $orderby DESC LIMIT 0,{$row}");

26 
$dsql
->
	`Execu‹
();

27 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

28 
$ùp
->
	`S‘NameS·û
('field', '[', ']');

29 
$rs
 = 
$dsql
->
	`G‘A¼ay
())

31 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

32 
$rs
['grou²ame'] = 
	`ú_sub¡r
($rs['grou²ame'], 
$t™ËËn
);

33 
$rs
['u¾'] = 
$cfg_group_u¾
."/group.php?id={$rs['groupid']}";

34 
$rs
['icon'] = $rs['groupimg'];

35 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

37 ifĞ!
	`em±y
(
$rs
[
	`¡¹Şow”
(
$ùag
->
	`G‘Name
())]) ) {

38 
$ùp
->
	`Assign
(
$gid
,
$rs
[
$ùag
->
	`G‘Name
()]);

41 
$li¡
 .ğ
$ùp
->
	`G‘ResuÉ
();

43  
$li¡
;

44 
	}
}

	@E:\web\weixun\functions\taglib\groupthread.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
funùiÚ
 
	$lib_grou±h»ad
(&
$ùag
,&
$»fObj
)

11 
glob®
 
$dsql
, 
$’vs
, 
$cfg_db´efix
, 
$cfg_cmsu¾
;

13 
$©i¡
="gid|0,orderby|dateline,orderway|desc,row|12,titlelen|30";

14 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

15 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

17 ifĞ!
$dsql
->
	`IsTabË
("{$cfg_dbprefix}groups") )  'æ²¡å®‰è£…åœˆå­æ¨¡å—';

19 if(!
	`´eg_m©ch
("#\/$#", 
$cfg_cmsu¾
)è
$cfg_group_u¾
 = $cfg_cmsurl."/group";

20 
$cfg_group_u¾
 = 
$cfg_cmsu¾
."group";

22 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

23 if(
	`Œim
(
$šÃ¹ext
)==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
('groupthreads.htm');

25 
$Wh”eSql
 = " WHERE.closed=0 ";

26 
$Üd”by
 = 't.'.$orderby;

27 if(
$gid
 > 0è
$Wh”eSql
 .= " AND.gid='$gid' ";

29 
$qu”y
 = "SELECT.subject,t.gid,t.tid,t.lastpost,g.groupname FROM `#@__group_threads`

30 
LEFT
 
JOIN
 `#@
__groups
` 
g
 
ON
 g.
groupid
=
t
.
gid


31 
$Wh”eSql
 
ORDER
 
BY
 
$Üd”by
 
$Üd”way
 
LIMIT
 0,{
$row
}";

33 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

34 
$dsql
->
	`Execu‹
();

35 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

36 
$ùp
->
	`S‘NameS·û
('field', '[', ']');

37 if(!
	`is£t
(
$li¡
)) $list = '';

38 
$rs
 = 
$dsql
->
	`G‘A¼ay
())

40 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

41 
$rs
['subjeù'] = 
	`ú_sub¡r
($rs['subjeù'], 
$t™ËËn
);

42 
$rs
['u¾'] = 
$cfg_group_u¾
."/viewthread.php?id={$rs['gid']}&tid={$rs['tid']}";

43 
$rs
['groupu¾'] = 
$cfg_group_u¾
."/group.php?id={$rs['gid']}";

44 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
) {

45 if(!
	`em±y
(
$rs
[
	`¡¹Şow”
(
$ùag
->
	`G‘Name
())]))

47 
$ùp
->
	`Assign
(
$gid
, 
$rs
[
$ùag
->
	`G‘Name
()]);

50 
$li¡
 .ğ
$ùp
->
	`G‘ResuÉ
();

52  
$li¡
;

53 
	}
}

	@E:\web\weixun\functions\taglib\hotwords.lib.php

1 <?
php


10 
funùiÚ
 
	$lib_hÙwÜds
(&
$ùag
,&
$»fObj
)

12 
glob®
 
$cfg_phpu¾
,
$dsql
;

14 
$©i¡
="num|6,subday|365,maxlength|16";

15 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

16 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

18 
$nowtime
 = 
	`time
();

19 if(
	`em±y
(
$subday
)) $subday = 365;

20 if(
	`em±y
(
$num
)) $num = 6;

21 if(
	`em±y
(
$maxËngth
)) $maxlength = 20;

22 
$maxËngth
 = $maxlength+1;

23 
$mštime
 = 
$nowtime
 - (
$subday
 * 24 * 3600);

25 
$dsql
->
	`S‘Qu”y
("SELECT keyword FROM `#@__search_keywords` WHERE†asttime>$mintime AND†ength(keyword)<$maxlength ORDER BY count DESC LIMIT 0,$num");

26 
$dsql
->
	`Execu‹
('hw');

27 
$hÙwÜd
 = '';

28 
$row
=
$dsql
->
	`G‘A¼ay
('hw')){

29 
$hÙwÜd
 .ğ"ã€€<¨h»f='".
$cfg_phpu¾
."/£¬ch.php?keywÜd=".
	`u¾’code
(
$row
['keyword'])."'>".$row['keyword']."</a> ";

31  
$hÙwÜd
;

32 
	}
}

	@E:\web\weixun\functions\taglib\infoguide.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
funùiÚ
 
	$lib_šfoguide
(&
$ùag
,&
$»fObj
)

11 
glob®
 
$dsql
,
$Çtiv•Ïû
,
$šfÙy³
,
$hasS‘EnumJs
,
$cfg_cm¥©h
,
$cfg_mašs™e
;

18 
$cm¥©h
 = ( (
	`em±y
(
$cfg_cm¥©h
è|| 
	`´eg_m©ch
('#[/$]#', $cfg_cmspath)) ? $cfg_cmspath.'/' : $cfg_cmspath );

20 if(
	`em±y
(
$»fObj
->
F›lds
['typeid']))

22 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id FROM `#@__arctype` WHERE channeltype='-8' And„eid = '0' ");

23 
$ty³id
 = (
	`is_¬¿y
(
$row
) ? $row['id'] : 0);

24 if(
	`em±y
(
$ty³id
))

31 
$ty³id
 = 
$»fObj
->
F›lds
['typeid'];

34 
$šÃrText
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

35 if(
	`em±y
(
$šÃrText
)è$šÃrTexˆğ
	`G‘SysTem¶‘s
("info_guide.htm");

36 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

37 
$ùp
->
	`S‘NameS·û
('field','[',']');

38 
$ùp
->
	`LßdSourû
(
$šÃrText
);

40 
$»v®ue
 = 
$£li
 = '';

42 
$f›lds
 = 
	`¬¿y
('Çtiv•Ïû'=>'','šfÙy³'=>'','ty³id'=>
$ty³id
);

44 if(
$hasS‘EnumJs
 !='has' )

46 
$»v®ue
 .ğ'<süˆÏnguage="javasüt"y³="‹xt/javasüt" src="'.
$cfg_mašs™e
.
$cm¥©h
.'images/enums.js"></script>'."\r\n";

47 
$GLOBALS
['hasSetEnumJs'] = 'hasset';

50 
$f›lds
['nativeplace'] = $fields['infotype'] = '';

52 if(
	`em±y
(
$Çtiv•Ïû
)) $nativeplace = 0;

53 if(
	`em±y
(
$šfÙy³
)) $infotype = 0;

55 
$f›lds
['nativeplace'] .= "<inputype='hidden' id='hidden_nativeplace'‚ame='nativeplace' value='{$nativeplace}' />\r\n";

56 
$f›lds
['nativeplace'] .= "<span class='infosearchtxt'>åœ°åŒºï¼š</span><span id='span_nativeplace'></span>\r\n";

57 
$f›lds
['nativeplace'] .= "<span id='span_nativeplace_son'></span>\r\n<span id='span_nativeplace_sec'></span><br />\r\n";

58 
$f›lds
['nativeplace'] .= "<script†anguage='javascript'ype='text/javascript' src='{$cfg_mainsite}{$cmspath}data/enums/nativeplace.js'></script>\r\n";

59 
$f›lds
['Çtiv•Ïû'] .ğ'<süˆÏnguage="javasüt">MakeTİS–eù("Çtiv•Ïû", '.
$Çtiv•Ïû
.');</script>'."\r\n";

61 
$f›lds
['infotype'] .= "<inputype='hidden' id='hidden_infotype'‚ame='infotype' value='{$infotype}' />\r\n";

62 
$f›lds
['infotype'] .= "<span class='infosearchtxt'>ç±»å‹ï¼š</span><span id='span_infotype'></span>\r\n";

63 
$f›lds
['infotype'] .= "<span id='span_infotype_son'></span><span id='span_infotype_sec'></span><br />\r\n";

64 
$f›lds
['infotype'] .= "<script†anguage='javascript'ype='text/javascript' src='{$cfg_mainsite}{$cmspath}data/enums/infotype.js'></script>\r\n";

65 
$f›lds
['šfÙy³'] .ğ'<süˆÏnguage="javasüt">MakeTİS–eù("šfÙy³", '.
$šfÙy³
.');</script>'."\r\n";

67 if(
	`is_¬¿y
(
$ùp
->
CTags
))

69 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

71 if(
	`is£t
(
$f›lds
[
$ùag
->
	`G‘Name
()])) {

72 
$ùp
->
	`Assign
(
$gid
,
$f›lds
[
$ùag
->
	`G‘Name
()]);

75 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

78  
$»v®ue
;

79 
	}
}

	@E:\web\weixun\functions\taglib\infolink.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
»quœe_Úû
(
XAKINC
.'/enums.func.php');

10 
»quœe_Úû
(
XAKDATA
.'/enums/nativeplace.php');

11 
»quœe_Úû
(
XAKDATA
.'/enums/infotype.php');

13 
funùiÚ
 
	$lib_šfŞšk
(&
$ùag
,&
$»fObj
)

15 
glob®
 
$dsql
,
$Çtiv•Ïû
,
$šfÙy³
,
$hasS‘EnumJs
,
$cfg_cm¥©h
,
$cfg_mašs™e
;

16 
glob®
 
$em_Çtiv•Ïûs
,
$em_šfÙy³s
;

23 
$cm¥©h
 = ( (
	`em±y
(
$cfg_cm¥©h
è|| !
	`´eg_m©ch
("#\/$#", $cfg_cmspath)) ? $cfg_cmspath.'/' : $cfg_cmspath );

24 
$ba£u¾
 = 
	`´eg_»¶aû
("#\/$#", '', 
$cfg_mašs™e
).
$cm¥©h
;

26 
$sm®Éy³s
 = '';

27 ifĞ!
	`em±y
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['smalltypes']) ) {

28 
$sm®Éy³s
 = 
	`ex¶ode
(',', 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['smalltypes']);

31 if(
	`em±y
(
$»fObj
->
F›lds
['typeid'])) {

32 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id FROM `#@__arctype` WHERE channeltype='-8' And„eid = '0' ");

33 
$ty³id
 = (
	`is_¬¿y
(
$row
) ? $row['id'] : 0);

36 
$ty³id
 = 
$»fObj
->
F›lds
['typeid'];

39 
$šÃrText
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

40 if(
	`em±y
(
$šÃrText
)è$šÃrTexˆğ
	`G‘SysTem¶‘s
("info_link.htm");

41 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

42 
$ùp
->
	`S‘NameS·û
('field','[',']');

43 
$ùp
->
	`LßdSourû
(
$šÃrText
);

45 
$»v®ue
 = 
$£li
 = '';

46 
$chªÃlid
 = ( 
	`em±y
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['channeltype']) ? -8 : $refObj->TypeLink->TypeInfos['channeltype'] );

48 
$f›lds
 = 
	`¬¿y
('Çtiv•Ïû'=>'','šfÙy³'=>'','ty³id'=>
$ty³id
,

49 'chªÃlid'=>
$chªÃlid
,'linkallplace'=>'','linkalltype'=>'');

51 
$f›lds
['nativeplace'] = $fields['infotype'] = '';

53 
$f›lds
['linkallplace'] = "<a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&infotype={$infotype}'>ä¸é™</a>";

54 
$f›lds
['linkalltype'] = "<a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&nativeplace={$nativeplace}'>ä¸é™</a>";

57 if(
	`em±y
(
$Çtiv•Ïû
))

59 
	`fÜ—ch
(
$em_Çtiv•Ïûs
 
as
 
$eid
=>
$em
)

61 if(
$eid
 % 500 != 0) ;

62 
$f›lds
['nativeplace'] .= " <a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&nativeplace={$eid}&infotype={$infotype}'>{$em}</a>\r\n";

67 
$sÚty³
 = ( (
$Çtiv•Ïû
 % 500 != 0) ? $nativeplace : 0 );

68 
$tİty³
 = ( (
$Çtiv•Ïû
 % 500 == 0) ? $nativeplace : ( $nativeplace-($nativeplace%500) ) );

70 
$f›lds
['nativeplace'] = "<a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&nativeplace={$toptype}&infotype={$infotype}'> <b>{$em_nativeplaces[$toptype]}</b></a> &gt;&gt; ";

71 
	`fÜ—ch
(
$em_Çtiv•Ïûs
 
as
 
$eid
=>
$em
)

73 if(
$eid
 < 
$tİty³
+1 || $eid > $toptype+499) ;

74 if(
$eid
 =ğ
$Çtiv•Ïû
) {

75 
$f›lds
['nativeplace'] .= " <b>{$em}</b>\r\n";

78 
$f›lds
['nativeplace'] .= " <a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&nativeplace={$eid}&infotype={$infotype}'>{$em}</a>\r\n";

83 if(
	`em±y
(
$šfÙy³
è|| 
	`is_¬¿y
(
$sm®Éy³s
))

86 
	`fÜ—ch
(
$em_šfÙy³s
 
as
 
$eid
=>
$em
)

88 if(!
	`is_¬¿y
(
$sm®Éy³s
è&& 
$eid
 % 500 != 0) ;

89 if(
	`is_¬¿y
(
$sm®Éy³s
è&& !
	`š_¬¿y
(
$eid
, $smalltypes)) ;

90 if(
$eid
 =ğ
$šfÙy³
)

92 
$f›lds
['infotype'] .= " <b>{$em}</b>\r\n";

95 
$f›lds
['infotype'] .= " <a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&infotype={$eid}&nativeplace={$nativeplace}'>{$em}</a>\r\n";

101 
$sÚty³
 = ( (
$šfÙy³
 % 500 != 0) ? $infotype : 0 );

102 
$tİty³
 = ( (
$šfÙy³
 % 500 == 0) ? $infotype : ( $infotype-($infotype%500) ) );

103 
$f›lds
['infotype'] .= "<a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&infotype={$toptype}&nativeplace={$nativeplace}'><b>{$em_infotypes[$toptype]}</b></a> &gt;&gt; ";

104 
	`fÜ—ch
(
$em_šfÙy³s
 
as
 
$eid
=>
$em
)

106 if(
$eid
 < 
$tİty³
+1 || $eid > $toptype+499) ;

107 if(
$eid
 =ğ
$šfÙy³
) {

108 
$f›lds
['infotype'] .= " <b>{$em}</b>\r\n";

111 
$f›lds
['infotype'] .= " <a href='{$baseurl}module/list.php?channelid={$channelid}&tid={$typeid}&infotype={$eid}&nativeplace={$nativeplace}'>{$em}</a>\r\n";

117 if(
	`is_¬¿y
(
$ùp
->
CTags
))

119 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

121 if(
	`is£t
(
$f›lds
[
$ùag
->
	`G‘Name
()])) {

122 
$ùp
->
	`Assign
(
$gid
,
$f›lds
[
$ùag
->
	`G‘Name
()]);

125 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

128  
$»v®ue
;

129 
	}
}

	@E:\web\weixun\functions\taglib\json.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

6 
»quœe_Úû
(
dœÇme
(
__fe__
).'/../json.class.php');

8 
funùiÚ
 
	$lib_jsÚ
(&
$ùag
,&
$»fObj
)

10 
glob®
 
$dsql
,
$sqlCt
,
$cfg_soá_Ïng
;

11 
$©i¡
="url|";

12 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

13 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

15 
$IÂ”‹xt
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

17 if(
$u¾
=='' || 
$IÂ”‹xt
=='')  '';

19 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

20 
$ùp
->
	`S‘NameS·û
('field','[',']');

21 
$ùp
->
	`LßdSourû
(
$IÂ”‹xt
);

23 
$mÿche
 = 
Ãw
 
MšiCache
;

25 
$GLOBALS
['autoindex'] = 0;

26 
$chash
 = 
	`md5
(
$u¾
);

28 if(!
$row
 = 
$mÿche
->
	`G‘
(
$chash
))

30 
$cÚ‹Á
 = @
	`fe_g‘_cÚ‹Ás
(
$u¾
);

32 
$jsÚ
 = 
Ãw
 
	`S”viûs_JSON
(
SERVICES_JSON_LOOSE_TYPE
);

33 
$row
 = 
$jsÚ
->
	`decode
(
$cÚ‹Á
);

35 if(
$cfg_soá_Ïng
 != 'utf-8')

37 
$row
 = 
	`AutoCh¬£t
($row, 'utf-8', 'gb2312');

39 
$mÿche
->
	`Save
(
$chash
, 
$row
, 
$ÿche
);

42 
$»v®ue
 = "";

44 
	`fÜ—ch
(
$row
 
as
 
$key
 => 
$v®ue
)

46 
$GLOBALS
['autoindex']++;

47 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

49 if(
$ùag
->
	`G‘Name
()=='array')

51 
$ùp
->
	`Assign
(
$gid
,
$v®ue
);

55 ifĞ!
	`em±y
(
$v®ue
[
$ùag
->
	`G‘Name
()]))

57 
$ùp
->
	`Assign
(
$gid
,
$v®ue
[
$ùag
->
	`G‘Name
()]);

59 
$ùp
->
	`Assign
(
$gid
,"");

63 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

66  
$»v®ue
;

67 
	}
}

70 şas 
	cMšiCache


72 
v¬
 
	m$_ÿche_·th
;

74 
funùiÚ
 
	$__cÚ¡ruù
()

76 
$this
->
_ÿche_·th
 = 
XAKDATA
.'/cache/json/';

80 
funùiÚ
 
	$G‘
(
$id
)

82 iàĞ! 
	`fe_exi¡s
(
$this
->
_ÿche_·th
.
$id
))

84  
FALSE
;

87 
$d©a
 = 
$this
->
	`_R—dFe
($this->
_ÿche_·th
.
$id
);

88 
$d©a
 = 
	`un£rŸlize
($data);

90 ià(
	`time
(è> 
$d©a
['time'] + $data['ttl'])

92 
	`uÆšk
(
$this
->
_ÿche_·th
.
$id
);

93  
FALSE
;

96  
$d©a
['data'];

97 
	}
}

100 
funùiÚ
 
	$CËª
()

102  
$this
->
	`_D–‘eFes
($this->
_ÿche_·th
);

103 
	}
}

106 
funùiÚ
 
	$Save
(
$id
, 
$d©a
, 
$‰l
 = 60)

108 
$cÚ‹Ás
 = 
	`¬¿y
(

109 'time' => 
	`time
(),

110 '‰l' => 
$‰l
,

111 'd©a' => 
$d©a


114 ià(
	`PutFe
(
$this
->
_ÿche_·th
.
$id
, 
	`£rŸlize
(
$cÚ‹Ás
)))

116 @
	`chmod
(
$this
->
_ÿche_·th
.
$id
, 0777);

117  
TRUE
;

120  
FALSE
;

121 
	}
}

124 
funùiÚ
 
	$D–‘e
(
$id
)

126  
	`uÆšk
(
$this
->
_ÿche_·th
.
$id
);

127 
	}
}

130 
funùiÚ
 
	$_D–‘eFes
(
$·th
, 
$d–_dœ
 = 
FALSE
, 
$Ëv–
 = 0)

133 
$·th
 = 
	`¹rim
($·th, 
DIRECTORY_SEPARATOR
);

135 iàĞ! 
$cu¼’t_dœ
 = @
	`İ’dœ
(
$·th
))

137  
FALSE
;

140 
FALSE
 !=ğ(
$f’ame
 = @
	`»addœ
(
$cu¼’t_dœ
)))

142 ià(
$f’ame
 !ğ"." 
ªd
 $filename != "..")

144 ià(
	`is_dœ
(
$·th
.
DIRECTORY_SEPARATOR
.
$f’ame
))

147 ià(
	`sub¡r
(
$f’ame
, 0, 1) != '.')

149 
	`d–‘e_fes
(
$·th
.
DIRECTORY_SEPARATOR
.
$f’ame
, 
$d–_dœ
, 
$Ëv–
 + 1);

154 
	`uÆšk
(
$·th
.
DIRECTORY_SEPARATOR
.
$f’ame
);

158 @
	`şo£dœ
(
$cu¼’t_dœ
);

160 ià(
$d–_dœ
 =ğ
TRUE
 
AND
 
$Ëv–
 > 0)

162  @
	`rmdœ
(
$·th
);

165  
TRUE
;

166 
	}
}

168 
funùiÚ
 
	$_R—dFe
(
$fe
)

170 iàĞ! 
	`fe_exi¡s
(
$fe
)è 
FALSE
;

171 ià(
	`funùiÚ_exi¡s
('fe_g‘_cÚ‹Ás')è 
	`fe_g‘_cÚ‹Ás
(
$fe
);

172 iàĞ! 
$å
 = @
	`fİ’
(
$fe
, 
FOPEN_READ
)è 
FALSE
;

174 
	`æock
(
$å
, 
LOCK_SH
);

176 
$d©a
 = '';

177 ià(
	`fesize
(
$fe
è> 0è
$d©a
 =& 
	`ä—d
(
$å
, filesize($file));

179 
	`æock
(
$å
, 
LOCK_UN
);

180 
	`fşo£
(
$å
);

182  
$d©a
;

183 
	}
}

	@E:\web\weixun\functions\taglib\likearticle.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
funùiÚ
 
	$lib_lik—¹işe
(&
$ùag
,&
$»fObj
)

11 
glob®
 
$dsql
;

14 
$©i¡
="row|12,titlelen|28,infolen|150,col|1,tablewidth|100,mytypeid|0,byabs|0,imgwidth|120,imgheight|90";

15 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

16 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

17 
$»v®ue
 = '';

19 if(
	`em±y
(
$bËwidth
)) $tablewidth = 100;

20 if(
	`em±y
(
$cŞ
)) $col = 1;

21 
$cŞWidth
 = 
	`û
(100/
$cŞ
);

22 
$bËwidth
 = $tablewidth."%";

23 
$cŞWidth
 = $colWidth."%";

25 
$ids
 = 
	`¬¿y
();

26 
$tids
 = 
	`¬¿y
();

28 if(!
	`em±y
(
$»fObj
->
F›lds
['tags'])) {

29 
$keywÜd
 = 
$»fObj
->
F›lds
['tags'];

32 
$keywÜd
 = ( !
	`em±y
(
$»fObj
->
F›lds
['keywords']) ? $refObj->Fields['keywords'] : '' );

35 
$ty³id
 = ( !
	`em±y
(
$myty³id
) ? $mytypeid : 0 );

36 if(
	`em±y
(
$ty³id
))

38 if(!
	`em±y
(
$»fObj
->
Ty³lšk
->
Ty³Infos
['reid'])) {

39 
$ty³id
 = 
$»fObj
->
Ty³lšk
->
Ty³Infos
['reid'];

42 if(!
	`em±y
(
$»fObj
->
F›lds
['ty³id'])è
$ty³id
 = $refObj->Fields['typeid'];

46 ifĞ!
	`em±y
(
$ty³id
è&& !
	`´eg_m©ch
('#,#', $typeid) ) {

47 
$ty³id
 = 
	`G‘SÚIds
($typeid);

50 
$lim™Row
 = 
$row
 - 
	`couÁ
(
$ids
);

51 
$keywÜd
 = '';

52 if(!
	`em±y
(
$»fObj
->
F›lds
['keywords']))

54 
$keywÜds
 = 
	`ex¶ode
(',' , 
	`Œim
(
$»fObj
->
F›lds
['keywords']));

55 
$keywÜd
 = '';

56 
$n
 = 1;

57 
	`fÜ—ch
(
$keywÜds
 
as
 
$k
)

59 if(
$n
 > 3) ;

61 if(
	`Œim
(
$k
)=='') ;

62 
$k
 = 
	`add¦ashes
($k);

64 
$keywÜd
 .= ($keyword=='' ? " CONCAT(arc.keywords,' ',arc.title) LIKE '%$k%' " : " OR CONCAT(arc.keywords,' ',arc.title) LIKE '%$k%' ");

65 
$n
++;

68 
$¬cid
 = (!
	`em±y
(
$»fObj
->
F›lds
['id']) ? $refObj->Fields['aid'] : 0);

69 ifĞ
	`em±y
(
$¬cid
è|| 
$byabs
==0 )

71 
$Üd”qu”y
 = " ORDER BY‡rc.id desc ";

74 
$Üd”qu”y
 = " ORDER BY ABS×rc.id - ".
$¬cid
.") ";

76 if(
$keywÜd
 != '')

78 if(!
	`em±y
(
$ty³id
)) {

79 
$ty³id
 = " AND‡rc.typeid IN($typeid) AND‡rc.id<>$arcid ";

81 
$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,tp.namerule,

82 

.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


83 
FROM
 `#@
__¬chives
` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
‡rc.
ty³id
ñp.
id


84 
wh”e
 
¬c
.
¬üªk
>-1 
	`AND
 (
$keywÜd
è
$ty³id
 
$Üd”qu”y
 
lim™
 0, 
$row
";

88 if(!
	`em±y
(
$ty³id
)) {

89 
$ty³id
 = "‡rc.typeid IN($typeid) AND‡rc.id<>$arcid ";

91 
$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,tp.namerule,

92 

.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


93 
FROM
 `#@
__¬chives
` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
‡rc.
ty³id
ñp.
id


94 
WHERE
 
¬c
.
¬üªk
>-1 
AND
 
$ty³id
 
$Üd”qu”y
 
lim™
 0, 
$row
";

97 
$šÃ¹ext
 = 
	`Œim
Ğ
$ùag
->
	`G‘IÂ”Text
() );

98 if(
$šÃ¹ext
==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
('part_arclist.htm');

100 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

101 
$dsql
->
	`Execu‹
('al');

102 
$¬i¡
 = '';

103 if(
$cŞ
 > 1) {

104 
$¬i¡
 = "<table width='$tablewidth' border='0' cellspacing='0' cellpadding='0'>\r\n";

106 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

107 
$d2
->
	`S‘NameS·û
('field', '[', ']');

108 
$d2
->
	`LßdSŒšg
(
$šÃ¹ext
);

109 
$GLOBALS
['autoindex'] = 0;

110 
$lše
 = 
$row
;

111 
$i
=0; $˜< 
$lše
; $i++)

113 if(
$cŞ
>1è
$¬i¡
 .= "<tr>\r\n";

114 
$j
=0; $j < 
$cŞ
; $j++)

116 if(
$cŞ
>1è
$¬i¡
 .= " <td width='$colWidth'>\r\n";

117 if(
$row
 = 
$dsql
->
	`G‘A¼ay
("al"))

119 
$ids
[] = 
$row
['id'];

121 
$row
['šfo'] = $row['šfos'] = 
	`ú_sub¡r
($row['desütiÚ'],
$šfŞ’
);

122 
$row
['id'] = $row['id'];

124 if(
$row
['corank'] > 0 && $row['arcrank']==0)

126 
$row
['arcrank'] = $row['corank'];

129 
$row
['f’ame'] = $row['¬cu¾'] = 
	`G‘FeU¾
($row['id'],$row['typeid'],$row['senddate'],$row['title'],$row['ismake'],

130 
$row
['arcrank'],$row['namerule'],$row['typedir'],$row['money'],$row['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

132 
$row
['ty³u¾'] = 
	`G‘Ty³U¾
($row['typeid'],$row['typedir'],$row['isdefault'],$row['defaultname'],$row['ispart'],

133 
$row
['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

135 if(
$row
['litpic'] == '-' || $row['litpic'] == '')

137 
$row
['l™pic'] = 
$GLOBALS
['cfg_cmspath'].'/images/defaultpic.gif';

139 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$row
['l™pic']è&& 
$GLOBALS
['cfg_multi_site'] == 'Y')

141 
$row
['l™pic'] = 
$GLOBALS
['cfg_mainsite'].$row['litpic'];

143 
$row
['picname'] = $row['litpic'];

144 
$row
['¡ime'] = 
	`G‘D©eMK
($row['pubdate']);

145 
$row
['typelink'] = "<a href='".$row['typeurl']."'>".$row['typename']."</a>";

146 
$row
['image'] = "<img src='".$row['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
	`´eg_»¶aû
("#['><]#","",$row['title'])."'>";

147 
$row
['imglink'] = "<a href='".$row['filename']."'>".$row['image']."</a>";

148 
$row
['fulltitle'] = $row['title'];

149 
$row
['t™Ë'] = 
	`ú_sub¡r
($row['t™Ë'], 
$t™ËËn
);

150 if(
$row
['color']!='') $row['title'] = "<font color='".$row['color']."'>".$row['title']."</font>";

151 if(
	`´eg_m©ch
('#b#', 
$row
['flag'])) $row['title'] = "<strong>".$row['title']."</strong>";

152 
$row
['textlink'] = "<a href='".$row['filename']."'>".$row['title']."</a>";

153 
$row
['¶usu¾'] = $row['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

154 
$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

155 
$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

157 if(
	`is_¬¿y
(
$d2
->
CTags
))

159 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$k
=>
$ùag
)

161 if(
$ùag
->
	`G‘Name
()=='array') {

162 
$d2
->
	`Assign
(
$k
,
$row
);

165 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])è
$d2
->
	`Assign
(
$k
,$row[$ctag->GetName()]);

166 
$d2
->
	`Assign
(
$k
,'');

169 
$GLOBALS
['autoindex']++;

172 
$¬i¡
 .ğ
$d2
->
	`G‘ResuÉ
()."\r\n";

177 
$¬i¡
 .= '';

179 if(
$cŞ
>1è
$¬i¡
 .= " </td>\r\n";

182 if(
$cŞ
>1è
$i
 += $col - 1;

183 if(
$cŞ
>1è
$¬i¡
 .= " </tr>\r\n";

186 if(
$cŞ
>1è
$¬i¡
 .= " </table>\r\n";

187 
$dsql
->
	`F»eResuÉ
("al");

188  
$¬i¡
;

189 
	}
}

	@E:\web\weixun\functions\taglib\likepage.lib.php

1 <?
php


10 if(!
defšed
('XAKINC')è
ex™
('Warning...');

11 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/likesgpage.lib.php');

13 
funùiÚ
 
	$lib_lik•age
(&
$ùag
,&
$»fObj
)

15  
	`lib_likesg·ge
(
$ùag
, 
$»fObj
);

16 
	}
}

	@E:\web\weixun\functions\taglib\likesgpage.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 
funùiÚ
 
	$lib_likesg·ge
(&
$ùag
,&
$»fObj
)

12 
glob®
 
$dsql
;

15 
$©i¡
="row|8";

16 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

17 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

18 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

20 
$aid
 = (
	`is£t
(
$»fObj
->
F›lds
['aid']) ? $refObj->Fields['aid'] : 0);

22 
$»v®ue
 = '';

23 if(
$šÃ¹ext
==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("part_likesgpage.htm");

25 
$likeid
 = (
	`em±y
(
$»fObj
->
F›lds
['likeid']) ? 'all' : $refObj->Fields['likeid']);

27 
$dsql
->
	`S‘Qu”y
("SELECT‡id,title,filename FROM `#@__sgpage` WHERE†ikeid LIKE '$likeid' LIMIT 0,$row");

28 
$dsql
->
	`Execu‹
();

29 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

30 
$ùp
->
	`S‘NameS·û
('field','[',']');

31 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

32 
$row
 = 
$dsql
->
	`G‘A¼ay
())

34 if(
$aid
 !ğ
$row
['aid'])

36 
$row
['u¾'] = 
$GLOBALS
['cfg_cmsurl'].'/'.$row['filename'];

37 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
) {

38 if(!
	`em±y
(
$row
[
$ùag
->
	`G‘Name
()])è
$ùp
->
	`Assign
(
$gid
,$row[$ctag->GetName()]);

40 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

44 
$»v®ue
 .ğ'<dd cÏss="cur"><¥ª>'.
$row
['title'].'</span></dd>';

47  
$»v®ue
;

48 
	}
}

	@E:\web\weixun\functions\taglib\loop.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

12 
»quœe_Úû
(
XAKINC
.'/xakvote.class.php');

13 
funùiÚ
 
	$lib_loİ
(&
$ùag
,&
$»fObj
)

15 
glob®
 
$dsql
;

16 
$©i¡
="table|,tablename|,row|8,sort|,if|,ifcase|,orderway|desc";

17 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

18 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

20 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”‹xt
());

21 
$»v®ue
 = '';

22 if(!
	`em±y
(
$bË
)è
$bËÇme
 = $table;

24 if(
$bËÇme
==''||
$šÃ¹ext
=='')  '';

25 if(
$if
!=''è
$ifÿ£
 = $if;

27 if(
$sÜt
!='') $sort = " ORDER BY $sort $orderway ";

28 if(
$ifÿ£
!='') $ifcase=" WHERE $ifcase ";

29 
$dsql
->
	`S‘Qu”y
("SELECT * FROM $tablename $ifcase $sort LIMIT 0,$row");

30 
$dsql
->
	`Execu‹
();

31 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

32 
$ùp
->
	`S‘NameS·û
("field","[","]");

33 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

34 
$GLOBALS
['autoindex'] = 0;

35 
$row
 = 
$dsql
->
	`G‘A¼ay
())

37 
$GLOBALS
['autoindex']++;

38 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

40 if(
$ùag
->
	`G‘Name
()=='array')

42 
$ùp
->
	`Assign
(
$gid
, 
$row
);

46 ifĞ!
	`em±y
(
$row
[
$ùag
->
	`G‘Name
()])è
$ùp
->
	`Assign
(
$gid
,$row[$ctag->GetName()]);

49 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

51  
$»v®ue
;

52 
	}
}

	@E:\web\weixun\functions\taglib\memberinfos.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

13 
funùiÚ
 
	$lib_memb”šfos
(&
$ùag
,&
$»fObj
)

15 
glob®
 
$dsql
,
$sqlCt
;

16 
$©i¡
="mid|0";

17 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

18 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

20 if(
	`em±y
(
$mid
))

22 if(!
	`em±y
(
$»fObj
->
F›lds
['mid'])è
$mid
 = $refObj->Fields['mid'];

23 
$mid
 = 1;

27 
$mid
 = 
	`štv®
($mid);

30 
$»v®ue
 = '';

31 
$šÃrText
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

32 if(
	`em±y
(
$šÃrText
)è$šÃrTexˆğ
	`G‘SysTem¶‘s
('memberinfos.htm');

34 
$sql
 = "SELECT mb.*,ms.spacename,ms.sign,ar.membername‡s„ankname FROM `#@__member_list` mb

35 
LEFT
 
JOIN
 `#@
__memb”_¥aû
` 
ms
 
ON
 ms.
mid
 = 
mb
.mid

36 
LEFT
 
JOIN
 `#@
__¬üªk
` 
¬
 
ON
‡r.
¿nk
 = 
mb
.rank

37 
WHERE
 
mb
.
mid
='{$mid}' 
LIMIT
 0,1 ";

39 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

40 
$ùp
->
	`S‘NameS·û
('field','[',']');

41 
$ùp
->
	`LßdSourû
(
$šÃrText
);

43 
$dsql
->
	`Execu‹
('mb',
$sql
);

44 
$row
 = 
$dsql
->
	`G‘A¼ay
('mb'))

46 if(
$row
['matt']==10)  '';

47 
$row
['¥aûu¾'] = 
$GLOBALS
['cfg_basehost'].'/user/index.php?uid='.$row['userid'];

48 if(
	`em±y
(
$row
['face'])) {

49 
$row
['çû']=($row['£x']=='å¥³')? 
$GLOBALS
['cfg_memberurl'].'/templets/images/dfgirl.png' : $GLOBALS['cfg_memberurl'].'/templets/images/dfboy.png';

51 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

53 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])){ 
$ùp
->
	`Assign
(
$gid
,$row[$ctag->GetName()]); }

55 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

57  
$»v®ue
;

58 
	}
}

	@E:\web\weixun\functions\taglib\memberlist.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

14 
funùiÚ
 
	$lib_memb”li¡
(&
$ùag
, &
$»fObj
)

16 
glob®
 
$dsql
,
$sqlCt
;

17 
$©i¡
="row|6,iscommend|0,orderby|logintime,signlen|50";

18 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

19 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

21 
$»v®ue
 = '';

22 
$šÃrText
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

23 if(
	`em±y
(
$šÃrText
)è$šÃrTexˆğ
	`G‘SysTem¶‘s
('memberlist.htm');

25 
$wh”esql
 = ' WHERE mb.spacesta>-1 AND mb.matt<10 ';

27 if(
$iscomm’d
 > 0è
$wh”esql
 .= " AND mb.matt='$iscommend' ";

29 
$sql
 = "SELECT mb.*,ms.spacename,ms.sign FROM `#@__member_list` mb

30 
LEFT
 
JOIN
 `#@
__memb”_¥aû
` 
ms
 
ON
 ms.
mid
 = 
mb
.mid

31 
$wh”esql
 
Üd”
 
by
 
mb
.{
$Üd”by
} 
DESC
 
LIMIT
 0,
$row
 ";

33 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

34 
$ùp
->
	`S‘NameS·û
('field','[',']');

35 
$ùp
->
	`LßdSourû
(
$šÃrText
);

37 
$dsql
->
	`Execu‹
('mb',
$sql
);

38 
$row
 = 
$dsql
->
	`G‘A¼ay
('mb'))

40 
$row
['¥aûu¾'] = 
$GLOBALS
['cfg_basehost'].'/user/index.php?uid='.$row['userid'];

41 if(
	`em±y
(
$row
['face'])){

42 
$row
['çû']=($row['£x']=='å¥³')? 
$GLOBALS
['cfg_memberurl'].'/templets/images/dfgirl.png' : $GLOBALS['cfg_memberurl'].'/templets/images/dfboy.png';

44 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
){

45 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])){ 
$ùp
->
	`Assign
(
$gid
,$row[$ctag->GetName()]); }

47 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

50  
$»v®ue
;

51 
	}
}

	@E:\web\weixun\functions\taglib\myad.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

10 
»quœe_Úû
(
XAKINC
.'/taglib/mytag.lib.php');

12 
funùiÚ
 
	$lib_myad
(&
$ùag
, &
$»fObj
)

14 
$©i¡
 = "typeid|0,name|";

15 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

16 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

18 
$body
 = 
	`lib_G‘MyTagT
(
$»fObj
, 
$ty³id
, 
$Çme
, '#@__myad');

20  
$body
;

21 
	}
}

	@E:\web\weixun\functions\taglib\mynews.lib.php

1 <?
php


9 
funùiÚ
 
	$lib_myÃws
(&
$ùag
,&
$»fObj
)

11 
glob®
 
$dsql
,
$’vs
;

13 
$©i¡
="row|1,titlelen|24";

14 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

15 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

17 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

18 if(
	`em±y
(
$row
)) $row=1;

19 if(
	`em±y
(
$t™ËËn
)) $titlelen=30;

20 if(
	`em±y
(
$šÃ¹ext
)è$šÃ¹exˆğ
	`G‘SysTem¶‘s
('mynews.htm');

22 
$idsql
 = '';

23 if(
$’vs
['ty³id'] > 0è
$idsql
 = " WHEREy³id='".
	`G‘Tİid
(
$this
->
Ty³ID
)."' ";

24 
$dsql
->
	`S‘Qu”y
("SELECT * FROM #@__mynews $idsql ORDER BY senddate DESC LIMIT 0,$row");

25 
$dsql
->
	`Execu‹
();

26 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

27 
$ùp
->
	`S‘NameS·û
('field','[',']');

28 
$ùp
->
	`LßdSourû
(
$šÃ¹ext
);

29 
$»v®ue
 = '';

30 
$row
 = 
$dsql
->
	`G‘A¼ay
())

32 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
){

33 @
$ùp
->
	`Assign
(
$gid
,
$row
[
$ùag
->
	`G‘Name
()]);

35 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

37  
$»v®ue
;

38 
	}
}

	@E:\web\weixun\functions\taglib\mytag.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
funùiÚ
 
	$lib_myg
(&
$ùag
, &
$»fObj
)

11 
$©i¡
 = "typeid|0,name|,ismake|no";

12 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

13 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

15 if(
	`Œim
(
$ismake
)=='') $ismake = 'no';

16 
$body
 = 
	`lib_G‘MyTagT
(
$»fObj
, 
$ty³id
, 
$Çme
, '#@__mytag');

18 if(
$ismake
=='yes')

20 
	`»quœe_Úû
(
XAKINC
.'/arc.partview.class.php');

21 
$pvCİy
 = 
Ãw
 
	`P¬tV›w
(
$ty³id
);

22 
$pvCİy
->
	`S‘Tem¶‘
(
$body
,"string");

23 
$body
 = 
$pvCİy
->
	`G‘ResuÉ
();

25  
$body
;

26 
	}
}

28 
funùiÚ
 
	$lib_G‘MyTagT
(&
$»fObj
, 
$ty³id
,
$gÇme
,
$bËÇme
)

30 
glob®
 
$dsql
;

31 if(
$gÇme
=='')  '';

32 if(
	`Œim
(
$ty³id
)=='') $typeid=0;

33 ifĞ!
	`em±y
(
$»fObj
->
F›lds
['ty³id']è&& 
$ty³id
==0) $typeid = $refObj->Fields['typeid'];

35 
$ty³sql
 = 
$row
 = '';

36 if(
$ty³id
 > 0è
$ty³sql
 = " Andy³id IN(0,".
	`G‘Tİids
($typeid).") ";

38 
$row
 = 
$dsql
->
	`G‘OÃ
(" SELECT * FROM $tablename WHEREagname LIKE '$tagname' $typesql ORDER BYypeid DESC ");

39 if(!
	`is_¬¿y
(
$row
))  '';

41 
$nowtime
 = 
	`time
();

42 if(
$row
['timeset']==1

43 && (
$nowtime
<
$row
['starttime'] || $nowtime>$row['endtime']) )

45 
$body
 = 
$row
['expbody'];

49 
$body
 = 
$row
['normbody'];

52  
$body
;

53 
	}
}

	@E:\web\weixun\functions\taglib\php.lib.php

1 <?
php


2 ià(!
defšed
('XAKINC'))

3 
ex™
('Warning...');

11 
funùiÚ
 
	$lib_php
(&
$ùag
, &
$»fObj
)

13 
glob®
 
$dsql
;

14 
glob®
 
$db
;

15 
$phpcode
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

16 ià(
$phpcode
 == '')

18 
	`ob_¡¬t
();

19 
	`exŒaù
(
$GLOBALS
, 
EXTR_SKIP
);

20 @
	`ev®
(
$phpcode
);

21 
$»v®ue
 = 
	`ob_g‘_cÚ‹Ás
();

22 
	`ob_ş—n
();

23  
$»v®ue
;

24 
	}
}

	@E:\web\weixun\functions\taglib\productimagelist.lib.php

1 <?
	gphp


2 !
defšed
('XAKINC'è&& 
ex™
("403 Forbidden!");

9 
funùiÚ
 
	$lib_´oduùimag–i¡
(&
$ùag
, &
$»fObj
)

11 
glob®
 
$dsql
,
$sqlCt
;

12 
$©i¡
="desclen|80";

13 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

14 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

16 if(!
	`is£t
(
$»fObj
->
addTabËRow
['imgurls']))  ;

18 
$»v®ue
 = '';

19 
$šÃrText
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

20 if(
	`em±y
(
$šÃrText
)è$šÃrTexˆğ
	`G‘SysTem¶‘s
('productimagelist.htm');

22 
$d
 = 
Ãw
 
	`XakTagP¬£
();

23 
$d
->
	`LßdSourû
(
$»fObj
->
addTabËRow
['imgurls']);

25 
$images
 = 
	`¬¿y
();

26 if(
	`is_¬¿y
(
$d
->
CTags
))

28 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

30 if(
$ùag
->
	`G‘Name
()=="img")

32 
$row
 = 
	`¬¿y
();

33 
$row
['img¤c'] = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

34 
$row
['‹xt'] = 
$ùag
->
	`G‘A‰
('text');

35 
$images
[] = 
$row
;

39 
$d
->
	`CË¬
();

41 
$»v®ue
 = '';

42 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

43 
$ùp
->
	`S‘NameS·û
('field','[',']');

44 
$ùp
->
	`LßdSourû
(
$šÃrText
);

46 
	`fÜ—ch
(
$images
 
as
 
$row
)

48 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

50 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])){ 
$ùp
->
	`Assign
(
$gid
,$row[$ctag->GetName()]); }

52 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

54  
$»v®ue
;

55 
	}
}

	@E:\web\weixun\functions\taglib\rpad.lib.php

1 <?
php


3 if(!
defšed
('XAKINC')è
ex™
('Warning...');

4 
»quœe_Úû
(
XAKINC
.'/taglib/mytag.lib.php');

5 
»quœe_Úû
(
XAKROOT
.'/module/rpad/rpad_func.php');

7 
funùiÚ
 
	$lib_½ad
(&
$ùag
, &
$»fObj
)

9 
$©i¡
 = "typeid|0,name|";

10 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

11 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

13 
glob®
 
$dsql
;

14 if(
$Çme
=='')  '';

15 if(
	`Œim
(
$ty³id
)=='') $typeid=0;

16 ifĞ!
	`em±y
(
$»fObj
->
F›lds
['ty³id']è&& 
$ty³id
==0) $typeid = $refObj->Fields['typeid'];

18 
$ty³sql
 = 
$row
 = '';

19 if(
$ty³id
 > 0è
$ty³sql
 = " Andy³id in(0,".
	`G‘Tİids
($typeid).") ";

20 
$ty³sql
 = " ANDypeid=0 ";

21 
$row
 = 
$dsql
->
	`G‘OÃ
(" Select * From `#@__rpad` whereagname†ike '$name' $typesql order byypeid desc ");

22 if(!
	`is_¬¿y
(
$row
))  '';

24 
$body
='';

25 
$nowtime
 = 
	`time
();

26 if(
$row
['time£t']==1 && (
$nowtime
<$row['starttime'] || $nowtime>$row['endtime']) )

28 
$body
 = 
$row
['expbody'];

32 
$body
 = 
	`½adP¬£r
(
$row
['adtype'],$row['normparams']);

35  
$body
;

36 
	}
}

	@E:\web\weixun\functions\taglib\softmsg.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

14 
funùiÚ
 
	$lib_soámsg
(&
$ùag
,&
$»fObj
)

16 
glob®
 
$dsql
;

20 
$»v®ue
 = '';

21 
$row
 = 
$dsql
->
	`G‘OÃ
(" SELECT * FROM `#@__softconfig` ");

22 if(
	`is_¬¿y
(
$row
)è
$»v®ue
 = $row['downmsg'];

23  
$»v®ue
;

24 
	}
}

	@E:\web\weixun\functions\taglib\sonchannel.lib.php

1 <?
php


10 
funùiÚ
 
	$lib_sÚchªÃl
(&
$ùag
,&
$»fObj
)

12 
glob®
 
$_sys_glob®s
,
$dsql
;

14 
$©i¡
 = "row|100,nosonmsg|,col|1";

15 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

16 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

17 
$šÃ¹ext
 = 
$ùag
->
	`G‘IÂ”Text
();

19 
$ty³id
 = 
$_sys_glob®s
['typeid'];

20 if(
	`em±y
(
$ty³id
))

22  
$ùag
->
	`G‘A‰
('nosonmsg');

25 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

26 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
='$ty³id' 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
LIMIT
 0,
$row
";

29 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

30 
$d2
->
	`S‘NameS·û
("field","[","]");

31 
$d2
->
	`LßdSourû
(
$šÃ¹ext
);

32 
$dsql
->
	`S‘Qu”y
(
$sql
);

33 
$dsql
->
	`Execu‹
();

34 
$lše
 = 
$row
;

35 
$GLOBALS
['autoindex'] = 0;

36 
$likeTy³
 = '';

37 
$i
=0;$˜< 
$lše
;$i++)

39 if(
$cŞ
>1è
$likeTy³
 .= "<dl>\r\n";

40 
$j
=0;$j<
$cŞ
;$j++)

42 if(
$cŞ
>1è
$likeTy³
 .= "<dd>\r\n";

43 if(
$row
=
$dsql
->
	`G‘A¼ay
())

45 
$row
['ty³lšk'] = $row['ty³u¾'] = 
	`G‘OÃTy³U¾A
($row);

46 if(
	`is_¬¿y
(
$d2
->
CTags
))

48 
	`fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
){

49 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])è
$d2
->
	`Assign
(
$gid
,$row[$ctag->GetName()]);

52 
$likeTy³
 .ğ
$d2
->
	`G‘ResuÉ
();

54 if(
$cŞ
>1è
$likeTy³
 .= "</dd>\r\n";

55 
$GLOBALS
['autoindex']++;

57 if(
$cŞ
>1)

59 
$i
 +ğ
$cŞ
 - 1;

60 
$likeTy³
 .= " </dl>\r\n";

63 
$dsql
->
	`F»eResuÉ
();

64  
$likeTy³
;

65 
	}
}

	@E:\web\weixun\functions\taglib\sql.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

13 
funùiÚ
 
	$lib_sql
(&
$ùag
,&
$»fObj
)

15 
glob®
 
$dsql
,
$sqlCt
,
$cfg_soá_Ïng
;

16 
$©i¡
="sql|appname";

17 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

18 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

21 
	`´eg_m©ch_®l
("/~([A-Za-z0-9]+)~/s", 
$sql
, 
$cÚd™iÚs
);

22 
$­²ame
 = 
	`em±y
($appname)? 'default' : $appname;

23 if(
	`is_¬¿y
(
$cÚd™iÚs
))

25 
	`fÜ—ch
 (
$cÚd™iÚs
[1] 
as
 
$key
 => 
$v®ue
)

27 if(
	`is£t
(
$»fObj
->
F›lds
[
$v®ue
]))

29 
$sql
 = 
	`¡r_»¶aû
(
$cÚd™iÚs
[0][
$key
], "'".
	`add¦ashes
(
$»fObj
->
F›lds
[
$v®ue
])."'", $sql);

34 
$»v®ue
 = '';

35 
$IÂ”‹xt
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

37 if(
$sql
=='' || 
$IÂ”‹xt
=='')  '';

38 if(
	`em±y
(
$sqlCt
)) $sqlCt = 0;

40 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

41 
$ùp
->
	`S‘NameS·û
('field','[',']');

42 
$ùp
->
	`LßdSourû
(
$IÂ”‹xt
);

43 
$thi¤s
 = 'sq'.
$sqlCt
;

44 
$GLOBALS
['autoindex'] = 0;

47 ià(
$­²ame
 != 'default')

49 
	`»quœe_Úû
(
XAKDATA
.'/tag/sql.inc.php');

50 
glob®
 
$sqÉag
;

51 
$cÚfig
 = 
$sqÉag
[
$­²ame
];

52 ià(!
	`is£t
(
$cÚfig
['dbname']))  '';

55 
$lškid
 = @
	`mysql_cÚÃù
(
$cÚfig
['dbhost'], $config['dbuser'], $config['dbpwd']);

56 if(!
$lškid
)  '';

57 @
	`mysql_£Ëù_db
(
$cÚfig
['dbname']);

58 
$mysqlv”
 = 
	`ex¶ode
('.',
$dsql
->
	`G‘V”siÚ
());

59 
$mysqlv”
 = $mysqlver[0].'.'.$mysqlver[1];

62 if(
$mysqlv”
 > 4.0)

64 @
	`mysql_qu”y
("SET NAMES '".
$cÚfig
['dbÏnguage']."', ch¬aù”_£t_ş›Á=bš¬y, sql_mode='', iÁ”aùive_timeout=3600 ;", 
$lškid
);

67 
$´efix
="#@__";

68 
$sql
 = 
	`¡r_»¶aû
(
$´efix
, 
$cÚfig
['dbprefix'], $sql);

71 
$sql
 = 
	`CheckSql
($sql);

72 
$rs
 = @
	`mysql_qu”y
(
$sql
, 
$lškid
);

73 
$row
 = 
	`mysql_ãtch_¬¿y
(
$rs
,
MYSQL_ASSOC
))

75 
$sqlCt
++;

76 
$GLOBALS
['autoindex']++;

79 ià(
	`sub¡r
(
$cfg_soá_Ïng
, 0, 2è!ğsub¡r(
$cÚfig
['dblanguage'], 0, 2))

81 
$row
 = 
	`AutoCh¬£t
($row, 
$cÚfig
['dbÏnguage'], 
$cfg_soá_Ïng
);

84 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

86 if(
$ùag
->
	`G‘Name
()=='array')

88 
$ùp
->
	`Assign
(
$gid
, 
$row
);

92 ifĞ!
	`em±y
(
$row
[
$ùag
->
	`G‘Name
()]))

94 
$ùp
->
	`Assign
(
$gid
, 
$row
[
$ùag
->
	`G‘Name
()]);

96 
$ùp
->
	`Assign
(
$gid
, "");

100 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

102 @
	`mysql_ä“_»suÉ
(
$rs
);

105 
$dsql
->
	`Execu‹
(
$thi¤s
, 
$sql
);

106 
$row
 = 
$dsql
->
	`G‘A¼ay
(
$thi¤s
))

108 
$sqlCt
++;

109 
$GLOBALS
['autoindex']++;

110 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

112 if(
$ùag
->
	`G‘Name
()=='array')

114 
$ùp
->
	`Assign
(
$gid
,
$row
);

118 ifĞ!
	`em±y
(
$row
[
$ùag
->
	`G‘Name
()]))

120 
$ùp
->
	`Assign
(
$gid
,
$row
[
$ùag
->
	`G‘Name
()]);

122 
$ùp
->
	`Assign
(
$gid
,"");

126 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

129  
$»v®ue
;

130 
	}
}

	@E:\web\weixun\functions\taglib\tag.lib.php

1 <?
php


9 
funùiÚ
 
	$lib_g
(&
$ùag
,&
$»fObj
)

11 
glob®
 
$dsql
,
$’vs
,
$cfg_cmsu¾
;

13 
$©i¡
="row|30,sort|new,getall|0,typeid|0";

14 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

15 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

17 
$IÂ”Text
 = 
$ùag
->
	`G‘IÂ”Text
();

18 if(
	`Œim
(
$IÂ”Text
)==''è$IÂ”Texˆğ
	`G‘SysTem¶‘s
('tag_one.htm');

19 
$»v®ue
 = '';

21 
$Éy³
 = 
$sÜt
;

22 
$num
 = 
$row
;

24 
$addsql
 = '';

26 if(
$g‘®l
==0 && 
	`is£t
(
$»fObj
->
F›lds
['gs']è&& !
	`em±y
($refObj->Fields['aid']))

28 
$dsql
->
	`S‘Qu”y
("SELECTid FROM `#@__taglist` WHERE‡id = '{$refObj->Fields['aid']}' ");

29 
$dsql
->
	`Execu‹
();

30 
$ids
 = '';

31 
$row
 = 
$dsql
->
	`G‘A¼ay
())

33 
$ids
 .ğĞ$ids=='' ? 
$row
['tid'] : ','.$row['tid'] );

35 if(
$ids
 != '')

37 
$addsql
 = " WHERE id IN($ids) ";

39 if(
$addsql
=='')  '';

43 if(!
	`em±y
(
$ty³id
))

45 
$addsql
 = " WHEREypeid='$typeid' ";

49 if(
$Éy³
=='¿nd'è
$Üd”by
 = 'rand() ';

50 if(
$Éy³
=='w“k'è
$Üd”by
=' weekcc DESC ';

51 if(
$Éy³
=='mÚth'è
$Üd”by
=' monthcc DESC ';

52 if(
$Éy³
=='hÙ'è
$Üd”by
=' count DESC ';

53 if(
$Éy³
=='tÙ®'è
$Üd”by
='otal DESC ';

54 
$Üd”by
 = 'addtime DESC ';

56 
$dsql
->
	`S‘Qu”y
("SELECT * FROM `#@__tagindex` $addsql ORDER BY $orderby LIMIT 0,$num");

57 
$dsql
->
	`Execu‹
();

59 
$ùp
 = 
Ãw
 
	`XakTagP¬£
();

60 
$ùp
->
	`S‘NameS·û
('field','[',']');

61 
$ùp
->
	`LßdSourû
(
$IÂ”Text
);

62 
$row
 = 
$dsql
->
	`G‘A¼ay
())

64 
$row
['keyword'] = $row['tag'];

65 
$row
['g'] = 
	`html¥ecŸlch¬s
($row['tag']);

66 
$row
['lšk'] = 
$cfg_cmsu¾
."/gs.php?/".
	`u¾’code
($row['keyword'])."/";

67 
$row
['highlight'] = 0;

68 if(
$row
['monthcc']>1000 || $row['weekcc']>300 )

70 
$row
['highlight'] = 
	`mt_¿nd
(3,4);

72 if(
$row
['count']>3000)

74 
$row
['highlight'] = 
	`mt_¿nd
(5,6);

78 
$row
['highlight'] = 
	`mt_¿nd
(1,2);

80 
	`fÜ—ch
(
$ùp
->
CTags
 
as
 
$gid
=>
$ùag
)

82 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()]))

84 
$ùp
->
	`Assign
(
$gid
,
$row
[
$ùag
->
	`G‘Name
()]);

87 
$»v®ue
 .ğ
$ùp
->
	`G‘ResuÉ
();

89  
$»v®ue
;

90 
	}
}

	@E:\web\weixun\functions\taglib\type.lib.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
funùiÚ
 
	$lib_ty³
(&
$ùag
,&
$»fObj
)

10 
glob®
 
$dsql
,
$’vs
;

12 
$©i¡
='typeid|0';

13 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

14 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

15 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

17 if(
$ty³id
==0) {

18 
$ty³id
 = ( 
	`is£t
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id']è? $»fObj->Ty³Lšk->Ty³Infos['id'] : 
$’vs
['typeid'] );

21 if(
	`em±y
(
$ty³id
))  '';

23 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id,typename,typedir,seotitle,content,typepic,open_new,description,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

24 
FROM
 `#@
__¬ùy³
` 
WHERE
 
id
='$typeid' ");

25 if(!
	`is_¬¿y
(
$row
))  '';

26 if(
	`Œim
(
$šÃ¹ext
)==''è$šÃ¹exˆğ
	`G‘SysTem¶‘s
("part_type_list.htm");

28 
$d
 = 
Ãw
 
	`XakTagP¬£
();

29 
$d
->
	`S‘NameS·û
('field','[',']');

30 
$d
->
	`LßdSourû
(
$šÃ¹ext
);

31 if(!
	`is_¬¿y
(
$d
->
CTags
))

33 
	`un£t
(
$d
);

38 
$row
['ty³lšk'] = $row['ty³u¾'] = 
	`G‘OÃTy³U¾A
($row);

40 ià(
$row
['open_new']==1){

41 
$row
['open_new'] ='arget="_blank"';

45 
$row
['open_new'] ='';

47 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

49 if(
	`is£t
(
$row
[
$ùag
->
	`G‘Name
()])è
$d
->
	`Assign
(
$gid
,$row[$ctag->GetName()]);

51 
$»v®ue
 = 
$d
->
	`G‘ResuÉ
();

52 
	`un£t
(
$d
);

53  
$»v®ue
;

55 
	}
}

	@E:\web\weixun\functions\taglib\vote.lib.php

1 <?
php


2 if(!
defšed
('XAKINC'))

4 
ex™
("Warning...");

14 
»quœe_Úû
(
XAKINC
.'/xakvote.class.php');

15 
funùiÚ
 
	$lib_vÙe
(&
$ùag
,&
$»fObj
)

17 
glob®
 
$dsql
;

18 
$©i¡
="id|0,lineheight|24,tablewidth|100%,titlebgcolor|#333,titlebackgroup|,tablebg|#FFFFFF";

19 
	`FlA‰sDeçuÉ
(
$ùag
->
CA‰ribu‹
->
I‹ms
,
$©i¡
);

20 
	`exŒaù
(
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

22 if(
	`em±y
(
$id
)) $id=0;

23 if(
$id
==0)

25 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT‡id FROM `#@__vote` ORDER BY‡id DESC LIMIT 0,1");

26 if(!
	`is£t
(
$row
['aid']))  '';

27 
$id
=
$row
['aid'];

29 
$vt
 = 
Ãw
 
	`XakVÙe
(
$id
);

30  
$vt
->
	`G‘VÙeFÜm
(
$lšeheight
,
$bËwidth
,
$t™ËbgcŞÜ
,
$t™Ëbackgroup
,
$bËbg
);

31 
	}
}

	@E:\web\weixun\functions\tpllib\plus_ask.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
funùiÚ
 
	$¶us_ask
(&
$©ts
,&
$»fObj
,&
$f›lds
)

11 
glob®
 
$dsql
,
$_v¬s
;

13 
$©i¡
 = "titlelen=40,row=8,typeid=0,sort=";

14 
	`FlA‰s
(
$©ts
,
$©i¡
);

15 
	`FlF›lds
(
$©ts
,
$f›lds
,
$»fObj
);

16 
	`exŒaù
(
$©ts
, 
EXTR_OVERWRITE
);

18 
$wh”esql
 = ' 1 ';

19 if(
$sÜt
=='')

21 
$Üd”by
 = 'ORDER BY id DESC';

23 if(
$sÜt
=='commend')

25 
$wh”esql
 .= ' And digest=1';

26 
$Üd”by
 = ' ORDER BY dateline DESC';

28 if(
$sÜt
=='ok')

30 
$wh”esql
 .= ' And status=1 ';

31 
$Üd”by
 = ' ORDER BY solvetime DESC';

33 if(
$sÜt
=='expiredtime')

35 
$wh”esql
 .= ' And status=0 ';

36 
$Üd”by
 = ' ORDER BYƒxpiredtime ASC, dateline DESC';

38 if(
$sÜt
=='reward')

40 
$wh”esql
 .= ' And status=0 ';

41 
$Üd”by
 = ' ORDER BY„eward DESC';

45 
$wh”esql
 .= ' And status=0 ';

46 
$Üd”by
 = ' ORDER BY disorder DESC, dateline DESC';

48 
$qu”y
 = "SELECT id,id,idname,id2,id2name,itle FROM `#@__ask` WHERE $wheresql $orderby LIMIT $row";

49 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

50 
$dsql
->
	`Execu‹
('an');

51 
$»¬r
 = 
	`¬¿y
();

52 
$row
 = 
$dsql
->
	`G‘A¼ay
('an'))

54 if(
$row
['tid2'] != 0)

55 
$row
['typelink'] = $row['typedata'] = " <a href='browser.php?tid2={$row['tid2']}'>{$row['tid2name']}</a>\r\n";

57 
$row
['typelink'] = $row['typedata'] = " <a href='browser.php?tid={$row['tid']}'>{$row['tidname']}</a>\r\n";

58 
$row
['t™Ë'] = 
	`ú_sub¡r
($row['t™Ë'],
$t™ËËn
);

59 
$»¬r
[] = 
$row
;

61  
$»¬r
;

62 
	}
}

	@E:\web\weixun\functions\tpllib\plus_channel.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

3 
»quœe_Úû
(
XAKINC
.'/channelunit.func.php');

10 
funùiÚ
 
	$¶us_chªÃl
(&
$©ts
, &
$»fObj
, &
$f›lds
)

12 
glob®
 
$dsql
,
$_v¬s
;

14 
$©i¡
 = "typeid=0,reid=0,row=100,type=son,currentstyle=";

15 
	`FlA‰s
(
$©ts
,
$©i¡
);

16 
	`FlF›lds
(
$©ts
,
$f›lds
,
$»fObj
);

17 
	`exŒaù
(
$©ts
, 
EXTR_OVERWRITE
);

19 
$lše
 = 
	`em±y
(
$row
) ? 100 : $row;

20 
$»A¼ay
 = 
	`¬¿y
();

21 
$»id
 = 0;

22 
$tİid
 = 0;

25 if(
	`em±y
(
$ty³id
))

27 ifĞ
	`is£t
(
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id']) )

29 
$ty³id
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['id'];

30 
$»id
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['reid'];

31 
$tİid
 = 
$»fObj
->
Ty³Lšk
->
Ty³Infos
['topid'];

34 
$ty³id
 = 0;

40 
$row2
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__arctype` WHERE id='$typeid' ");

41 
$ty³id
 = 
$row2
['id'];

42 
$»id
 = 
$row2
['reid'];

43 
$tİid
 = 
$row2
['topid'];

44 
$is£tInfos
 = 
Œue
;

47 if(
$ty³
=='' || $type=='sun') $type='son';

49 if(
$ty³
=='top')

51 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

52 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
=0 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
LIMIT
 0, 
$lše
 ";

54 if(
$ty³
=='son')

56 if(
$ty³id
==0è 
$»A¼ay
;

57 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

58 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
='$ty³id' 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
LIMIT
 0, 
$lše
 ";

60 if(
$ty³
=='self')

62 if(
$»id
==0è 
$»A¼ay
;

63 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

64 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
='$»id' 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
LIMIT
 0, 
$lše
 ";

68 
$ÃedR–
 = 
Œue
;

70 if(
	`em±y
(
$sql
)è 
$»A¼ay
;

72 
$dsql
->
	`Execu‹
('me',
$sql
);

73 
$tÙ®Row
 = 
$dsql
->
	`G‘TÙ®Row
('me');

76 if(
$ty³
=='sÚ' && 
$»id
!=0 && 
$tÙ®Row
==0)

78 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl,sitepath

79 
FROM
 `#@
__¬ùy³
` 
WHERE
 
»id
='$»id' 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
LIMIT
 0, 
$lše
 ";

80 
$dsql
->
	`Execu‹
('me', 
$sql
);

82 
$GLOBALS
['autoindex'] = 0;

83 
$row
=
$dsql
->
	`G‘A¼ay
())

85 
$row
['currentstyle'] = $row['sonids'] = $row['rel'] = '';

86 if(
$ÃedR–
)

88 
$row
['sÚids'] = 
	`G‘SÚIds
($row['id'], 0, 
çl£
);

89 if(
$row
['sonids']=='') $row['rel'] = '';

90 
$row
['rel'] = "„el='dropmenu{$row['id']}'";

93 ifĞ(
$row
['id']==
$ty³id
 || (
$tİid
==$row['id'] && 
$ty³
=='tİ'èè&& 
$cu¼’t¡yË
!='' )

95 
$row
['cu¼’t¡yË'] = 
$cu¼’t¡yË
;

97 
$row
['ty³lšk'] = $row['ty³u¾'] = 
	`G‘OÃTy³U¾A
($row);

98 
$»A¼ay
[] = 
$row
;

99 
$GLOBALS
['autoindex']++;

102 
$dsql
->
	`F»eResuÉ
();

103  
$»A¼ay
;

104 
	}
}

	@E:\web\weixun\functions\tpllib\plus_memberlist.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
funùiÚ
 
	$¶us_memb”li¡
(&
$©ts
,&
$»fObj
,&
$f›lds
)

10 
glob®
 
$dsql
,
$_v¬s
;

11 
$©i¡
 = "row=6,iscommend=0,orderby=logintime,signlen=50";

12 
	`FlA‰s
(
$©ts
,
$©i¡
);

13 
	`FlF›lds
(
$©ts
,
$f›lds
,
$»fObj
);

14 
	`exŒaù
(
$©ts
, 
EXTR_OVERWRITE
);

16 
$»¬¿y
 = 
	`¬¿y
();

18 
$wh”esql
 = ' WHERE mb.spacesta > -1 AND mb.matt != 10';

20 if(
$iscomm’d
 > 0è
$wh”esql
 .= " AND mb.matt='$iscommend' ";

22 
$sql
 = "SELECT mb.*,ms.spacename,ms.sign FROM `#@__member_list` mb

23 
LEFT
 
JOIN
 `#@
__memb”_¥aû
` 
ms
 
ON
 ms.
mid
 = 
mb
.mid 
$wh”esql
 
ORDER
 
BY
 mb.{
$Üd”by
} 
DESC
 
LIMIT
 0,
$row
 ";

25 
$dsql
->
	`Execu‹
('mb',
$sql
);

26 
$row
 = 
$dsql
->
	`G‘A¼ay
('mb'))

28 
$row
['¥aûu¾'] = 
$GLOBALS
['cfg_basehost'].'/user/index.php?uid='.$row['userid'];

29 if(
	`em±y
(
$row
['face']))

31 
$row
['çû']=($row['£x']=='?')? 
$GLOBALS
['cfg_memberurl'].'/templets/images/dfgirl.png' : $GLOBALS['cfg_memberurl'].'/templets/images/dfboy.png';

33 
$»¬¿y
[] = 
$row
;

35  
$»¬¿y
;

36 
	}
}

	@E:\web\weixun\functions\tpllib\plus_newvisitor.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
funùiÚ
 
	$¶us_Ãwvis™Ü
(&
$©ts
,&
$»fObj
,&
$f›lds
)

10 
glob®
 
$dsql
,
$_v¬s
,
$cfg_memb”u¾
;

12 
$©i¡
 = "titlelen=30,infolen=200,row=6";

13 
	`FlA‰s
(
$©ts
,
$©i¡
);

14 
	`FlF›lds
(
$©ts
,
$f›lds
,
$»fObj
);

15 
	`exŒaù
(
$©ts
, 
EXTR_OVERWRITE
);

16 
$mid
 = 
$_v¬s
['mid'];

18 
$qu”y
 = "SELECT h.*,mb.face,mb.sex,mb.userid AS†oginid,mb.uname,s.sign FROM `#@__member_vhistory` h

19 
LEFT
 
JOIN
 `#@
__memb”_li¡
` 
mb
 
ON
 mb.
mid
 = 
h
.
vid


20 
LEFT
 
JOIN
 `#@
__memb”_¥aû
` 
s
 
ON
 s.
mid
 = 
h
.
vid


21 
WHERE
 
h
.
mid
='$mid' 
ORDER
 
BY
 h.
vtime
 
DESC
 
LIMIT
 0,
$row
";

23 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

24 
$dsql
->
	`Execu‹
("al");

25 
$»¬r
 = 
	`¬¿y
();

26 
$row
 = 
$dsql
->
	`G‘A¼ay
("al"))

28 
$row
['u¾'] = 
$cfg_memb”u¾
."/index.php?uid=".$row['loginid'];

29 if(
	`em±y
(
$row
['face']))

31 
$row
['çû']=($row['£x']=='?')? 
$cfg_memb”u¾
.'/templets/images/dfgirl.png' : $cfg_memberurl.'/templets/images/dfboy.png';

33 
$»¬r
[] = 
$row
;

35 
$dsql
->
	`F»eResuÉ
("al");

36  
$»¬r
;

37 
	}
}

	@E:\web\weixun\functions\tpllib\plus_spacenewart.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
funùiÚ
 
	$¶us_¥aûÃw¬t
(&
$©ts
,&
$»fObj
,&
$f›lds
)

10 
glob®
 
$dsql
,
$_v¬s
;

12 
$©i¡
 = "channel=1,titlelen=30,infolen=200,row=8,imgwidth=120,imgheight=90";

13 
	`FlA‰s
(
$©ts
,
$©i¡
);

14 
	`FlF›lds
(
$©ts
,
$f›lds
,
$»fObj
);

15 
	`exŒaù
(
$©ts
, 
EXTR_OVERWRITE
);

17 
$qu”y
 = "Select‡rc.*,mt.mtypename,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,

18 

.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


19 
äom
 `#@
__¬chives
` 
¬c


20 
Ëá
 
još
 `#@
__¬ùy³
` 

 
Ú
 
¬c
.
ty³id
ñp.
id


21 
Ëá
 
još
 `#@
__mty³s
` 
mt
 
Ú
 mt.
mty³id
=
¬c
.
mty³


22 
wh”e
 
¬c
.
mid
='{$_v¬s['mid']}' 
ªd
‡rc.
chªÃl
=
$chªÃl


23 
Üd”
 
by
 
id
 
desc
 
lim™
 0,
$row
";

25 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

26 
$dsql
->
	`Execu‹
("al");

27 
$¬i¡
 = '';

28 
$»¬r
 = 
	`¬¿y
();

29 
$row
 = 
$dsql
->
	`G‘A¼ay
("al"))

32 
$row
['šfos'] = 
	`ú_sub¡r
($row['desütiÚ'],
$šfŞ’
);

33 
$row
['id'] = $row['id'];

35 
$row
['¬cu¾'] = 
	`G‘FeU¾
($row['id'],$row['typeid'],$row['senddate'],$row['title'],$row['ismake'],

36 
$row
['arcrank'],$row['namerule'],$row['typedir'],$row['money'],$row['filename'],$row['moresite'],$row['siteurl'],$row['sitepath']);

38 
$row
['ty³u¾'] = 
	`G‘Ty³U¾
($row['typeid'],$row['typedir'],$row['isdefault'],$row['defaultname'],$row['ispart'],

39 
$row
['namerule2'],$row['moresite'],$row['siteurl'],$row['sitepath']);

41 if(
$row
['litpic']=='')

43 
$row
['litpic'] = '/images/defaultpic.gif';

45 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$row
['litpic']))

47 
$row
['piúame'] = $row['l™pic'] = 
$GLOBALS
['cfg_cmsurl'].$row['litpic'];

51 
$row
['picname'] = $row['litpic'] = $row['litpic'];

53 
$row
['¡ime'] = 
	`G‘D©eMK
($row['pubdate']);

54 
$row
['typelink'] = "<a href='".$row['typeurl']."'>".$row['typename']."</a>";

55 
$row
['image'] = "<img src='".$row['piúame']."' bÜd”='0' width='$imgwidth' height='$imgheight'‡É='".
	`´eg_»¶aû
("#['><]#", "", $row['title'])."'>";

56 
$row
['imglink'] = "<a href='".$row['filename']."'>".$row['image']."</a>";

57 
$row
['fulltitle'] = $row['title'];

58 
$row
['t™Ë'] = 
	`ú_sub¡r
($row['t™Ë'],
$t™ËËn
);

59 if(
$row
['color']!='') {

60 
$row
['title'] = "<font color='".$row['color']."'>".$row['title']."</font>";

62 if(
	`´eg_m©ch
('#b#', 
$row
['flag']))

64 
$row
['title'] = "<strong>".$row['title']."</strong>";

68 
$row
['textlink'] = "<a href='".$row['filename']."'>".$row['title']."</a>";

70 
$row
['¶usu¾'] = $row['phpu¾'] = 
$GLOBALS
['cfg_phpurl'];

71 
$row
['memb”u¾'] = 
$GLOBALS
['cfg_memberurl'];

72 
$row
['‹m¶‘u¾'] = 
$GLOBALS
['cfg_templeturl'];

74 
$»¬r
[] = 
$row
;

76 
$dsql
->
	`F»eResuÉ
("al");

77  
$»¬r
;

78 
	}
}

	@E:\web\weixun\functions\typelink.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

15 şas 
	cTy³Lšk


17 
v¬
 
	m$ty³Dœ
;

18 
v¬
 
	m$dsql
;

19 
v¬
 
	m$Ty³ID
;

20 
v¬
 
	m$ba£Dœ
;

21 
v¬
 
	m$modDœ
;

22 
v¬
 
	m$šdexU¾
;

23 
v¬
 
	m$šdexName
;

24 
v¬
 
	m$Ty³Infos
;

25 
v¬
 
	m$S¶™SymbŞ
;

26 
v¬
 
	m$v®uePos™iÚ
;

27 
v¬
 
	m$v®uePos™iÚName
;

28 
v¬
 
	m$O±iÚA¼ayLi¡
;

32 
funùiÚ
 
	$__cÚ¡ruù
(
$ty³id
)

34 
$this
->
šdexU¾
 = 
$GLOBALS
['cfg_basehost'].$GLOBALS['cfg_indexurl'];

35 
$this
->
šdexName
 = 
$GLOBALS
['cfg_indexname'];

36 
$this
->
ba£Dœ
 = 
$GLOBALS
['cfg_basedir'];

37 
$this
->
modDœ
 = 
$GLOBALS
['cfg_templets_dir'];

38 
$this
->
S¶™SymbŞ
 = 
$GLOBALS
['cfg_list_symbol'];

39 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

40 
$this
->
Ty³ID
 = 
$ty³id
;

41 
$this
->
v®uePos™iÚ
 = '';

42 
$this
->
v®uePos™iÚName
 = '';

43 
$this
->
ty³Dœ
 = '';

44 
$this
->
O±iÚA¼ayLi¡
 = '';

47 
$qu”y
 = "SELECTp.*,ch.typename‡s ctypename,ch.addtable,ch.issystem FROM `#@__arctype`p†eft join `#@__channeltype` ch

48 
Ú
 
ch
.
id
=

.
chªÃÉy³
 
WHERE
p.id='$typeid' ";

49 if(
$ty³id
 > 0)

51 
$this
->
Ty³Infos
 = $this->
dsql
->
	`G‘OÃ
(
$qu”y
);

52 if(
	`is_¬¿y
(
$this
->
Ty³Infos
))

54 
$this
->
Ty³Infos
['‹mpšdex'] = 
	`MfTem¶‘
($this->TypeInfos['tempindex']);

55 
$this
->
Ty³Infos
['‹m¶i¡'] = 
	`MfTem¶‘
($this->TypeInfos['templist']);

56 
$this
->
Ty³Infos
['‹m·¹işe'] = 
	`MfTem¶‘
($this->TypeInfos['temparticle']);

63 
funùiÚ
 
	$Ty³Lšk
(
$ty³id
)

65 
$this
->
	`__cÚ¡ruù
(
$ty³id
);

66 
	}
}

69 
funùiÚ
 
	$Clo£
()

71 
	}
}

74 
funùiÚ
 
	$S‘Ty³ID
(
$ty³id
)

76 
$this
->
Ty³ID
 = 
$ty³id
;

77 
$this
->
v®uePos™iÚ
 = "";

78 
$this
->
v®uePos™iÚName
 = "";

79 
$this
->
ty³Dœ
 = "";

80 
$this
->
O±iÚA¼ayLi¡
 = "";

83 
$qu”y
 = "

84 
SELECT
 #@
__¬ùy³
.*,#@
__chªÃÉy³
.
ty³Çme
 
as
 
ùy³Çme


85 
FROM
 #@
__¬ùy³
 
Ëá
 
još
 #@
__chªÃÉy³


86 
Ú
 #@
__chªÃÉy³
.
id
=#@
__¬ùy³
.
chªÃÉy³
 
WHERE
 #@__arctype.id='$typeid' ";

87 
$this
->
dsql
->
	`S‘Qu”y
(
$qu”y
);

88 
$this
->
Ty³Infos
 = $this->
dsql
->
	`G‘OÃ
();

89 
	}
}

92 
funùiÚ
 
	$G‘Ty³Dœ
()

94 if(
	`em±y
(
$this
->
Ty³Infos
['typedir']))

96  
$GLOBALS
['cfg_cmspath'].$GLOBALS['cfg_arcdir'];

100  
$this
->
Ty³Infos
['typedir'];

102 
	}
}

106 
funùiÚ
 
	$G‘Pos™iÚLšk
(
$i¦šk
=
Œue
)

108 
$šdex·ge
 = "<¨h»f='".
$this
->
šdexU¾
."'>".$this->
šdexName
."</a>";

109 if(
$this
->
v®uePos™iÚ
!="" && 
$i¦šk
)

111  
$this
->
v®uePos™iÚ
;

113 if(
$this
->
v®uePos™iÚName
!="" && !
$i¦šk
)

115  
$this
->
v®uePos™iÚName
;

117 if(
$this
->
Ty³ID
==0)

119 if(
$i¦šk
)

121  
$šdex·ge
;

130 if(
$i¦šk
)

132 
$this
->
v®uePos™iÚ
 = $this->
	`G‘OÃTy³Lšk
($this->
Ty³Infos
);

133 if(
$this
->
Ty³Infos
['reid']!=0)

136 
$this
->
	`LogicG‘Pos™iÚ
($this->
Ty³Infos
['»id'],
Œue
);

138 
$this
->
v®uePos™iÚ
 = 
$šdex·ge
.$this->
S¶™SymbŞ
.$this->valuePosition;

139  
$this
->
v®uePos™iÚ
;

143 
$this
->
v®uePos™iÚName
 = $this->
Ty³Infos
['typename'];

144 if(
$this
->
Ty³Infos
['reid']!=0)

147 
$this
->
	`LogicG‘Pos™iÚ
($this->
Ty³Infos
['»id'],
çl£
);

149  
$this
->
v®uePos™iÚName
;

152 
	}
}

155 
funùiÚ
 
	$G‘Pos™iÚLšk2
(
$i¦šk
=
Œue
,
$cu¼ID
)

157 
$šdex·ge
 = "<¨h»f='".
$this
->
šdexU¾
."'>".$this->
šdexName
."</a>";

158 if(
$this
->
v®uePos™iÚ
!="" && 
$i¦šk
)

160  
$this
->
v®uePos™iÚ
;

162 if(
$this
->
v®uePos™iÚName
!="" && !
$i¦šk
)

164  
$this
->
v®uePos™iÚName
;

166 if(
$this
->
Ty³ID
==0)

168 if(
$i¦šk
)

170  
$šdex·ge
;

179 if(
$i¦šk
)

181 
$this
->
v®uePos™iÚ
 = $this->
	`G‘OÃTy³Lšk
($this->
Ty³Infos
);

182 if(
$this
->
Ty³Infos
['»id']!=
$cu¼ID
)

185 
$this
->
	`LogicG‘Pos™iÚ
($this->
Ty³Infos
['»id'],
Œue
,1);

187 
$this
->
v®uePos™iÚ
 = 
$šdex·ge
.$this->
S¶™SymbŞ
.$this->valuePosition;

188  
$this
->
v®uePos™iÚ
;

192 
$this
->
v®uePos™iÚName
 = $this->
Ty³Infos
['typename'];

193 if(
$this
->
Ty³Infos
['»id']!=
$cu¼ID
)

196 
$this
->
	`LogicG‘Pos™iÚ
($this->
Ty³Infos
['»id'],
çl£
,1);

198  
$this
->
v®uePos™iÚName
;

201 
	}
}

203 
funùiÚ
 
	$G‘Pos™iÚName
()

205  
$this
->
	`G‘Pos™iÚLšk
(
çl£
);

206 
	}
}

209 
funùiÚ
 
	$LogicG‘Pos™iÚ
(
$id
,
$i¦šk
,
$tİid
 = 0)

211 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,»id,ty³Çme,ty³dœ,isdeçuÉ,i¥¬t,deçuÉÇme,Çm”uË2,mÜes™e,s™eu¾,s™•©h FROM #@__¬ùy³ WHERE id='".
$id
."'");

212 
$tšfos
 = 
$this
->
dsql
->
	`G‘OÃ
();

213 if(
$i¦šk
)

215 
$this
->
v®uePos™iÚ
 = $this->
	`G‘OÃTy³Lšk
(
$tšfos
).$this->
S¶™SymbŞ
.$this->valuePosition;

219 
$this
->
v®uePos™iÚName
 = 
$tšfos
['ty³Çme'].$this->
S¶™SymbŞ
.$this->valuePositionName;

221 if(
$tšfos
['»id']>
$tİid
)

223 
$this
->
	`LogicG‘Pos™iÚ
(
$tšfos
['»id'],
$i¦šk
);

230 
	}
}

233 
funùiÚ
 
	$G‘OÃTy³Lšk
(
$ty³šfos
)

235 
$ty³·ge
 = 
$this
->
	`G‘OÃTy³U¾
(
$ty³šfos
);

236 
$ty³lšk
 = "<¨h»f='".
$ty³·ge
."'>".
$ty³šfos
['typename']."</a>";

237  
$ty³lšk
;

238 
	}
}

241 
funùiÚ
 
	$G‘OÃTy³U¾
(
$ty³šfos
)

243  
	`G‘Ty³U¾
(
$ty³šfos
['id'],
	`MfTy³dœ
($typeinfos['typedir']),$typeinfos['isdefault'],$typeinfos['defaultname'],

244 
$ty³šfos
['ispart'],$typeinfos['namerule2'],$typeinfos['moresite'],$typeinfos['siteurl'],$typeinfos['sitepath']);

245 
	}
}

251 
funùiÚ
 
	$G‘O±iÚA¼ay
(
$hid
=0,
$İ”
=0,
$chªÃÉy³
=0,
$u£rsg
=0)

253  
$this
->
	`G‘O±iÚLi¡
(
$hid
,
$İ”
,
$chªÃÉy³
,
$u£rsg
);

254 
	}
}

256 
funùiÚ
 
	$G‘O±iÚLi¡
(
$hid
=0,
$İ”
=0,
$chªÃÉy³
=0,
$u£rsg
=0)

258 
glob®
 
$cfg_admš_chªÃl
;

259 if(
	`em±y
(
$cfg_admš_chªÃl
)) $cfg_admin_channel = 'all';

261 if(!
$this
->
dsql
è$this->dsqÈğ
$GLOBALS
['dsql'];

262 
$this
->
O±iÚA¼ayLi¡
 = '';

264 if(
$hid
>0)

266 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT id,typename,ispart,channeltype FROM #@__arctype WHERE id='$hid'");

269 if(
$row
['ispart']==1) {

270 
$this
->
O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
['id']."' style='background-color:#DFDFDB;color:#888888' selected>".$row['typename']."</option>\r\n";

273 
$this
->
O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
['id']."' selected>".$row['typename']."</option>\r\n";

277 if(
$chªÃÉy³
==0è
$ùsql
 = '';

278 
$ùsql
=" AND channeltype='$channeltype' ";

281 if(
	`is_¬¿y
(
$İ”
è&& 
$cfg_admš_chªÃl
 != 'all')

283 ifĞ
	`couÁ
(
$İ”
) == 0 )

285 
$qu”y
 = "SELECT id,typename,ispart FROM `#@__arctype` WHERE 1=2 ";

289 
$admš_ÿlog_tmp
 = 
$admš_ÿlog
 = 
	`još
(',', 
$İ”
);

290 
$this
->
dsql
->
	`S‘Qu”y
("SELECT„eid FROM `#@__arctype` WHERE id in($admin_catalog) GROUP BY„eid ");

291 
$this
->
dsql
->
	`Execu‹
();

292 
$tİid¡r
 = '';

293 
$row
 = 
$this
->
dsql
->
	`G‘Objeù
())

295 if(
$row
->
»id
==0) ;

296 
$tİid¡r
 .ğ($tİid¡r=='' ? 
$row
->
»id
 : ','.$row->reid);

298 
$admš_ÿlog
 .ğ','.
$tİid¡r
;

299 
$admš_ÿlogs
 = 
	`ex¶ode
(',', 
$admš_ÿlog
);

300 
$admš_ÿlogs
 = 
	`¬¿y_unique
($admin_catalogs);

301 
$admš_ÿlog
 = 
	`još
(',', 
$admš_ÿlogs
);

302 
$admš_ÿlog
 = 
	`´eg_»¶aû
("/,$/", '', $admin_catalog);

303 
$qu”y
 = "SELECT id,typename,ispart FROM `#@__arctype` WHERE ispart<>2 AND id in({$admin_catalog}) AND„eid=0 $ctsql";

308 
$qu”y
 = "SELECT id,typename,ispart FROM `#@__arctype` WHERE ispart<>2 AND„eid=0 $ctsql ORDER BY sortrank ASC";

311 
$this
->
dsql
->
	`S‘Qu”y
(
$qu”y
);

312 
$this
->
dsql
->
	`Execu‹
();

313 
$row
=
$this
->
dsql
->
	`G‘Objeù
())

315 if(
$row
->
id
!=
$hid
)

317 if(
$row
->
i¥¬t
==1) {

318 
$this
->
O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' styË='background-cŞÜ:#EFEFEF;cŞÜ:#666666'>".$row->
ty³Çme
."</option>\r\n";

321 
$this
->
O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."'>".$row->
ty³Çme
."</option>\r\n";

324 
$this
->
	`LogicG‘O±iÚA¼ay
(
$row
->
id
, "â”€", 
$İ”
);

326  
$this
->
O±iÚA¼ayLi¡
;

327 
	}
}

338 
funùiÚ
 
	$LogicG‘O±iÚA¼ay
(
$id
, 
$¡•
, 
$İ”
=0)

340 
glob®
 
$cfg_admš_chªÃl
;

341 if(
	`em±y
(
$cfg_admš_chªÃl
)) $cfg_admin_channel = 'all';

343 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,ty³Çme,i¥¬ˆFROM #@__¬ùy³ WHERE„eid='".
$id
."' AND ispart<>2 ORDER BY sortrank ASC");

344 
$this
->
dsql
->
	`Execu‹
(
$id
);

345 
$row
=
$this
->
dsql
->
	`G‘Objeù
(
$id
))

347 if(
	`is_¬¿y
(
$İ”
è&& 
$cfg_admš_chªÃl
 != 'all')

349 if(!
	`š_¬¿y
(
$row
->
id
, 
$İ”
)) ;

351 if(
$row
->
i¥¬t
==1) {

352 
$this
->
O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' styË='background-cŞÜ:#EFEFEF;cŞÜ:#666666'>$¡•".$row->
ty³Çme
."</option>\r\n";

355 
$this
->
O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."'>$¡•".$row->
ty³Çme
."</option>\r\n";

357 
$this
->
	`LogicG‘O±iÚA¼ay
(
$row
->
id
, 
$¡•
."â”€", 
$İ”
);

359 
	}
}

376 
funùiÚ
 
G‘ChªÃlLi¡
(
$ty³id
=0, 
$»id
=0, 
$row
=8, 
$ty³ty³
='sun', 
$šÃ¹ext
='',

377 
$cŞ
=1, 
$bËwidth
=100, 
$myšÃ¹ext
='')

379 if(
$ty³id
==0è$ty³id = 
$this
->
Ty³ID
;

380 if(
	g$row
==""è
$row
 = 8;

381 if(
	g$»id
==""è
$»id
 = 0;

382 if(
	g$cŞ
==""è
$cŞ
 = 1;

384 
	g$bËwidth
 = 
¡r_»¶aû
("%","",
$bËwidth
);

385 if(
	g$bËwidth
==""è
$bËwidth
=100;

386 if(
	g$cŞ
==""è
$cŞ
 = 1;

388 
	g$cŞWidth
 = 
û
(100/
$cŞ
);

389 
	g$bËwidth
 = 
$bËwidth
."%";

390 
	g$cŞWidth
 = 
$cŞWidth
."%";

391 if(
	g$ty³ty³
==""è
$ty³ty³
="sun";

393 if(
	g$šÃ¹ext
==""è
$šÃ¹ext
 = 
G‘SysTem¶‘s
("channel_list.htm");

395 if(
	g$»id
==0 && 
$ty³id
>0)

397 
$dbrow
 = 
$this
->
dsql
->
G‘OÃ
("SELECT„eid FROM #@__arctype WHERE id='$typeid' ");

398 if(
is_¬¿y
(
$dbrow
))

400 
	g$»id
 = 
$dbrow
['reid'];

403 
	g$likeTy³
 = "";

404 if(
	g$ty³ty³
=="top")

406 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl

407 
FROM
 #@
__¬ùy³
 
WHERE
 
»id
=0 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
lim™
 0,
	g$row
";

409 if(
	g$ty³ty³
=="sun"||
$ty³ty³
=="son")

411 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl

412 
FROM
 #@
__¬ùy³
 
WHERE
 
»id
='$ty³id' 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
lim™
 0,
	g$row
";

414 if(
	g$ty³ty³
=="self")

416 
$sql
 = "SELECT id,typename,typedir,isdefault,ispart,defaultname,namerule2,moresite,siteurl

417 
FROM
 #@
__¬ùy³
 
WHERE
 
»id
='$»id' 
AND
 
ishidd’
<>1 
ORDER
 
BY
 
sÜŒªk
 
ASC
 
lim™
 0,
	g$row
";

421 
	g$d2
 = 
Ãw
 
XakTagP¬£
();

422 
	g$d2
->
S‘NameS·û
("field","[","]");

423 
	g$d2
->
LßdSourû
(
$šÃ¹ext
);

424 
	g$this
->
	gdsql
->
S‘Qu”y
(
$sql
);

425 
	g$this
->
	gdsql
->
Execu‹
();

426 
	g$lše
 = 
$row
;

427 
	g$GLOBALS
['autoindex'] = 0;

428 if(
	g$cŞ
>1)

430 
	g$likeTy³
 = "<table width='$tablewidth' border='0' cellspacing='0' cellpadding='0'>\r\n";

432 
	g$i
=0;$i<
	g$lše
;$i++)

434 if(
	g$cŞ
>1)

436 
	g$likeTy³
 .= "<tr>\r\n";

438 
	g$j
=0;$j<
	g$cŞ
;$j++)

440 if(
	g$cŞ
>1è
	g$likeTy³
 .= " <td width='$colWidth'>\r\n";

441 if(
	g$row
=
$this
->
dsql
->
G‘A¼ay
())

444 if(
$row
['id']=="$ty³id" && 
$myšÃ¹ext
 != '')

446 
$lškOk¡r
 = 
$myšÃ¹ext
;

447 
	g$row
['ty³lšk'] = 
$this
->
G‘OÃTy³U¾
(
$row
);

448 
	g$lškOk¡r
 = 
¡r_»¶aû
("~ty³lšk~", 
$row
['ty³lšk'], 
$lškOk¡r
);

449 
	g$lškOk¡r
 = 
¡r_»¶aû
("~ty³Çme~", 
$row
['ty³Çme'], 
$lškOk¡r
);

450 
	g$likeTy³
 .ğ
$lškOk¡r
;

455 
	g$row
['ty³lšk'] = 
$this
->
G‘OÃTy³U¾
(
$row
);

456 if(
is_¬¿y
(
$d2
->
CTags
))

458 
fÜ—ch
(
$d2
->
CTags
 
as
 
$gid
=>
$ùag
)

460 if(
is£t
(
$row
[
$ùag
->
G‘Name
()]))

462 
$d2
->
Assign
(
$gid
, 
$row
[
$ùag
->
G‘Name
()]);

466 
	g$likeTy³
 .ğ
$d2
->
G‘ResuÉ
();

469 if(
	g$cŞ
>1)

471 
	g$likeTy³
 .= " </td>\r\n";

473 
	g$GLOBALS
['autoindex']++;

476 if(
	g$cŞ
>1)

478 
	g$i
 +ğ
$cŞ
 - 1;

480 if(
	g$cŞ
>1)

482 
	g$likeTy³
 .= " </tr>\r\n";

486 if(
	g$cŞ
>1)

488 
	g$likeTy³
 .= " </table>\r\n";

490 
	g$this
->
	gdsql
->
F»eResuÉ
();

491  
	g$likeTy³
;

	@E:\web\weixun\functions\typeunit.class.admin.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

15 şas 
	cTy³Un™


17 
v¬
 
	m$dsql
;

18 
v¬
 
	m$¬tDœ
;

19 
v¬
 
	m$ba£Dœ
;

20 
v¬
 
	m$idCouÁ”
;

21 
v¬
 
	m$idA¼¬y
;

22 
v¬
 
	m$shÜtName
;

23 
v¬
 
	m$C©®ogNums
;

26 
funùiÚ
 
	$__cÚ¡ruù
()

28 
$this
->
idCouÁ”
 = 0;

29 
$this
->
¬tDœ
 = 
$GLOBALS
['cfg_cmspath'].$GLOBALS['cfg_arcdir'];

30 
$this
->
ba£Dœ
 = 
$GLOBALS
['cfg_basedir'];

31 
$this
->
shÜtName
 = 
$GLOBALS
['art_shortname'];

32 
$this
->
idA¼¬y
 = '';

33 
$this
->
dsql
 = 0;

36 
funùiÚ
 
	$Ty³Un™
()

38 
$this
->
	`__cÚ¡ruù
();

39 
	}
}

42 
funùiÚ
 
	$Clo£
()

44 
	}
}

47 
funùiÚ
 
	$Upd©eC©®ogNum
()

49 
$this
->
dsql
->
	`S‘Qu”y
("SELECTypeid,count(typeid)‡s dd FROM `#@__arctiny` WHERE‡rcrank <>-2 group byypeid");

50 
$this
->
dsql
->
	`Execu‹
();

51 
$row
 = 
$this
->
dsql
->
	`G‘A¼ay
())

53 
$this
->
C©®ogNums
[
$row
['typeid']] = $row['dd'];

55 
	}
}

57 
funùiÚ
 
	$G‘TÙ®Arc
(
$tid
)

59 if(!
	`is_¬¿y
(
$this
->
C©®ogNums
))

61 
$this
->
	`Upd©eC©®ogNum
();

63 if(!
	`is£t
(
$this
->
C©®ogNums
[
$tid
]))

69 
$tÙ®num
 = 0;

70 
$ids
 = 
	`ex¶ode
(',',
	`G‘SÚIds
(
$tid
));

71 
	`fÜ—ch
(
$ids
 
as
 
$tid
)

73 if(
	`is£t
(
$this
->
C©®ogNums
[
$tid
]))

75 
$tÙ®num
 +ğ
$this
->
C©®ogNums
[
$tid
];

78  
$tÙ®num
;

80 
	}
}

90 
funùiÚ
 
	$Li¡AÎTy³
(
$chªÃl
=0,
$nowdœ
=0)

92 
glob®
 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
;

93 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

96 if(
$cfg_admš_chªÃl
=='array')

98 
$admš_ÿlog
 = 
	`još
(',', 
$admš_ÿlogs
);

99 
$this
->
dsql
->
	`S‘Qu”y
("SELECT„eid FROM `#@__arctype` WHERE id in($admin_catalog) group by„eid ");

100 
$this
->
dsql
->
	`Execu‹
();

101 
$tİid¡r
 = '';

102 
$row
 = 
$this
->
dsql
->
	`G‘Objeù
())

104 if(
$row
->
»id
==0) ;

105 
$tİid¡r
 .ğ($tİid¡r=='' ? 
$row
->
»id
 : ','.$row->reid);

107 
$admš_ÿlog
 .ğ','.
$tİid¡r
;

108 
$admš_ÿlogs
 = 
	`ex¶ode
(',', 
$admš_ÿlog
);

109 
$admš_ÿlogs
 = 
	`¬¿y_unique
($admin_catalogs);

112 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,typedir,typename,ispart,sortrank,ishidden FROM `#@__arctype` WHERE„eid=0 order by sortrank");

113 
$this
->
dsql
->
	`Execu‹
(0);

114 
$row
 = 
$this
->
dsql
->
	`G‘Objeù
(0))

116 ifĞ
$cfg_admš_chªÃl
=='¬¿y' && !
	`š_¬¿y
(
$row
->
id
, 
$admš_ÿlogs
) )

120 
$ty³Dœ
 = 
$row
->
ty³dœ
;

121 
$ty³Name
 = 
$row
->
ty³Çme
;

122 
$i¥¬t
 = 
$row
->
i¥¬t
;

123 
$id
 = 
$row
->
id
;

124 
$¿nk
 = 
$row
->
sÜŒªk
;

125 if(
$row
->
ishidd’
=='1')

127 
$nss
 = "<font color='red'>[éš]</font>";

131 
$nss
 = '';

133 
echo
 "<table width='100%' border='0' cellspacing='0' cellpadding='2'>\r\n";

135 if(
$i¥¬t
==0)

137 
echo
 " <tr>\r\n";

138 
echo
 " <td styË='background-cŞÜ:#FBFCE2;' width='2%' cÏss='blše'><img styË='cursÜ:poš‹r' id='img".
$id
."' onClick=\"LoadSuns('suns".$id."',$id);\" src='images/explode.gif' width='11' height='11'></td>\r\n";

139 
echo
 " <td styË='background-cŞÜ:#FBFCE2;' cÏss='blše'><bË width='98%' bÜd”='0' c–l¥acšg='0' c–Íaddšg='0'><Œ><td width='50%'><špuˆşass='Å'y³='checkbox'‚ame='tids[]' v®ue='{$id}'><¨h»f='ÿlog_do.php?cid=".
$id
."&dİo¡öi¡Archives' oncÚ‹xtm’u=\"CommÚM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\">{$nss}".$ty³Name."[ID:".$id."]</a>(æ–‡æ¡£ï¼š".
$this
->
	`G‘TÙ®Arc
($id).") <a onclick=\"AlertMsg('å¿«æ·ç¼–è¾‘çª—å£','$id');\" href=\"javascript:;\"><img src='images/write2.gif'/></a>";

140 
echo
 " </td><td‡lign='right'>";

141 
echo
 "<a href='{$GLOBALS['cfg_phpurl']}/list.php?tid={$id}'arget='_blank'>é¢„è§ˆ</a>";

142 
echo
 "|<a href='catalog_do.php?cid={$id}&dopost=listArchives'>å†…å®¹</a>";

143 
echo
 "|<a href='catalog_add.php?id={$id}'>å¢åŠ å­ç±»</a>";

144 
echo
 "|<a href='catalog_edit.php?id={$id}'>æ›´æ”¹</a>";

145 
echo
 "|<a href='catalog_do.php?dopost=moveCatalog&typeid={$id}'>ç§»åŠ¨</a>";

146 
echo
 "|<¨h»f='ÿlog_d–.php?id={$id}&ty³ŞdÇme=".
	`u¾’code
(
$ty³Name
)."'>åˆ é™¤</a>";

147 
echo
 "&nbsp; <inputype='text'‚ame='sortrank{$id}' value='{$rank}' style='width:25px;height:20px'></td></tr></table></td></tr>\r\n";

150 if(
$i¥¬t
==1)

152 
echo
 " <tr >\r\n";

153 
echo
 " <td styË='background-cŞÜ:#FBFCE2;' width='2%' cÏss='blše'><img styË='cursÜ:poš‹r' id='img".
$id
."' onClick=\"LoadSuns('suns".$id."',$id);\" src='images/explode.gif' width='11' height='11'></td>\r\n";

154 
echo
 " <td styË='background-cŞÜ:#FBFCE2;' cÏss='blše'><bË width='98%' bÜd”='0' c–l¥acšg='0' c–Íaddšg='0'><Œ><td width='50%'><špuˆşass='Å'y³='checkbox'‚ame='tids[]' v®ue='{$id}'><¨h»f='ÿlog_do.php?cid=".
$id
."&dİo¡öi¡Archives' oncÚ‹xtm’u=\"CommÚM’uP¬tÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\">{$nss}".$typeName."[ID:".$id."]</a> <a onclick=\"AlertMsg('å¿«æ·ç¼–è¾‘çª—å£','$id');\" href=\"javascript:;\"> <img src='images/write2.gif'/> </a>";

155 
echo
 " </td><td‡lign='right'>";

156 
echo
 "<a href='{$GLOBALS['cfg_phpurl']}/list.php?tid={$id}'arget='_blank'>é¢„è§ˆ</a>";

157 
echo
 "|<a href='catalog_do.php?cid={$id}&dopost=listArchives'>å†…å®¹</a>";

158 
echo
 "|<a href='catalog_add.php?id={$id}'>å¢åŠ å­ç±»</a>";

159 
echo
 "|<a href='catalog_edit.php?id={$id}'>æ›´æ”¹</a>";

160 
echo
 "|<a href='catalog_do.php?dopost=moveCatalog&typeid={$id}'>ç§»åŠ¨</a>";

161 
echo
 "|<¨h»f='ÿlog_d–.php?id={$id}&ty³ŞdÇme=".
	`u¾’code
(
$ty³Name
)."'>åˆ é™¤</a>";

162 
echo
 "&nbsp; <inputype='text'‚ame='sortrank{$id}' value='{$rank}' style='width:25px;height:20px'></td></tr></table></td></tr>\r\n";

165 if(
$i¥¬t
==2)

167 
echo
 " <tr height='24' bgcolor='#FBFCE2'>\r\n";

168 
echo
 " <td width='2%' cÏss='blše2'><img styË='cursÜ:poš‹r' id='img".
$id
."' onClick=\"LoadSuns('suns".$id."',$id);\" src='images/explode.gif' width='11' height='11'></td>\r\n";

169 
echo
 " <td cÏss='blše2'><bË width='98%' bÜd”='0' c–l¥acšg='0' c–Íaddšg='0'><Œ><td width='50%'><špuˆşass='Å'y³='checkbox'‚ame='tids[]' v®ue='{$id}'><¨h»f='ÿlog_ed™.php?id=".
$id
."' oncÚ‹xtm’u=\"SšgËM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\">{$nss}".$typeName."[ID:".$id."]</a> <a onclick=\"AlertMsg('å¿«æ·ç¼–è¾‘çª—å£','$id');\" href=\"javascript:;\"><img src='images/write2.gif'/></a>";

170 
echo
 " </td><td‡lign='right'>";

171 
echo
 "<a href='{$typeDir}'arget='_blank'>é¢„è§ˆ</a>";

172 
echo
 "|<a href='catalog_edit.php?id={$id}'>æ›´æ”¹</a>";

173 
echo
 "|<a href='catalog_do.php?dopost=moveCatalog&typeid={$id}'>ç§»åŠ¨</a>";

174 
echo
 "|<¨h»f='ÿlog_d–.php?id={$id}&ty³ŞdÇme=".
	`u¾’code
(
$ty³Name
)."'>åˆ é™¤</a>";

175 
echo
 "&nbsp; <inputype='text'‚ame='sortrank{$id}' value='{$rank}' style='width:25px;height:20px'></td></tr></table></td></tr>\r\n";

177 
echo
 " <Œ><td cŞ¥ª='2' id='suns".
$id
."'>";

178 
$Ï¡id
 = 
	`G‘Cook›
('lastCid');

179 if(
$chªÃl
==
$id
 || 
$Ï¡id
==$id || 
	`is£t
(
$GLOBALS
['ex®lù']è|| 
$cfg_admš_chªÃl
=='array')

181 
echo
 " <table width='100%' border='0' cellspacing='0' cellpadding='0'>\r\n";

182 
$this
->
	`LogicLi¡AÎSunTy³
(
$id
,"ã€€");

183 
echo
 " </table>\r\n";

185 
echo
 "</td></tr>\r\n</table>\r\n";

187 
	}
}

197 
funùiÚ
 
	$LogicLi¡AÎSunTy³
(
$id
, 
$¡•
)

199 
glob®
 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
;

200 
$fid
 = 
$id
;

201 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,»id,ty³dœ,ty³Çme,i¥¬t,sÜŒªk,ishidd’ FROM `#@__¬ùy³` WHERE„eid='".
$id
."' order by sortrank");

202 
$this
->
dsql
->
	`Execu‹
(
$fid
);

203 if(
$this
->
dsql
->
	`G‘TÙ®Row
(
$fid
)>0)

205 
$row
 = 
$this
->
dsql
->
	`G‘Objeù
(
$fid
))

207 if(
$cfg_admš_chªÃl
=='¬¿y' && !
	`š_¬¿y
(
$row
->
id
, 
$admš_ÿlogs
) )

211 
$ty³Dœ
 = 
$row
->
ty³dœ
;

212 
$ty³Name
 = 
$row
->
ty³Çme
;

213 
$»id
 = 
$row
->
»id
;

214 
$id
 = 
$row
->
id
;

215 
$i¥¬t
 = 
$row
->
i¥¬t
;

216 if(
$¡•
=="ã€€")

218 
$¡•dd
 = 2;

222 
$¡•dd
 = 3;

224 
$¿nk
 = 
$row
->
sÜŒªk
;

225 if(
$row
->
ishidd’
=='1')

227 
$nss
 = "<font color='red'>[éš]</font>";

231 
$nss
 = '';

235 if(
$i¥¬t
==0)

237 
echo
 "<Œ height='24' oncÚ‹xtm’u=\"CommÚM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\">\r\n";

238 
echo
 "<td class='nbline'>";

239 
echo
 "<table width='98%' border='0' cellspacing='0' cellpadding='0'>";

240 
echo
 "<tr onMouseMove=\"javascript:this.bgColor='#FAFCE0';\" onMouseOut=\"javascript:this.bgColor='#FFFFFF';\"><td width='50%'>";

241 
echo
 "<špuˆşass='Å'y³='checkbox'‚ame='tids[]' v®ue='{$id}'>$¡• <img styË='cursÜ:poš‹r' id='img".
$id
."' onClick=\"LßdSuns('suns".$id."',$id);\" src='images/ex¶ode.gif' width='11' height='11'> <¨h»f='ÿlog_do.php?cid=".$id."&dİo¡öi¡Archives'>{$nss}".
$ty³Name
."[ID:".$id."]</a>(æ–‡æ¡£ï¼š".
$this
->
	`G‘TÙ®Arc
($id).") <a onclick=\"AlertMsg('å¿«æ·ç¼–è¾‘çª—å£','$id');\" href=\"javascript:;\"><img src='images/write2.gif'/></a>";

242 
echo
 "</td><td‡lign='right'>";

243 
echo
 "<a href='{$GLOBALS['cfg_phpurl']}/list.php?tid={$id}'arget='_blank'>é¢„è§ˆ</a>";

244 
echo
 "|<a href='catalog_do.php?cid={$id}&dopost=listArchives'>å†…å®¹</a>";

245 
echo
 "|<a href='catalog_add.php?id={$id}'>å¢åŠ å­ç±»</a>";

246 
echo
 "|<a href='catalog_edit.php?id={$id}'>æ›´æ”¹</a>";

247 
echo
 "|<a href='catalog_do.php?dopost=moveCatalog&typeid={$id}'>ç§»åŠ¨</a>";

248 
echo
 "|<¨h»f='ÿlog_d–.php?id={$id}&ty³ŞdÇme=".
	`u¾’code
(
$ty³Name
)."'>åˆ é™¤</a>";

249 
echo
 "&nbsp; <inputype='text'‚ame='sortrank{$id}' value='{$rank}' style='width:25px;height:20px'></td></tr></table></td></tr>\r\n";

253 if(
$i¥¬t
==1)

255 
echo
 " <Œ height='24' oncÚ‹xtm’u=\"CommÚM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\">\r\n";

256 
echo
 "<td class='nbline'><table width='98%' border='0' cellspacing='0' cellpadding='0'><tr onMouseMove=\"javascript:this.bgColor='#FAFCE0';\" onMouseOut=\"javascript:this.bgColor='#FFFFFF';\"><td width='50%'>";

257 
echo
 "<špuˆşass='Å'y³='checkbox'‚ame='tids[]' v®ue='{$id}'>$¡• <img styË='cursÜ:poš‹r' id='img".
$id
."' onClick=\"LßdSuns('suns".$id."',$id);\" src='images/ex¶ode.gif' width='11' height='11'> <¨h»f='ÿlog_do.php?cid=".$id."&dİo¡öi¡Archives'>{$nss}".
$ty³Name
."[ID:".$id."]</a> <a onclick=\"AlertMsg('å¿«æ·ç¼–è¾‘çª—å£','$id');\" href=\"javascript:;\"><img src='images/write2.gif'/></a>";

258 
echo
 "</td><td‡lign='right'>";

259 
echo
 "<a href='{$GLOBALS['cfg_phpurl']}/list.php?tid={$id}'arget='_blank'>é¢„è§ˆ</a>";

260 
echo
 "|<a href='catalog_do.php?cid={$id}&dopost=listArchives'>å†…å®¹</a>";

261 
echo
 "|<a href='catalog_add.php?id={$id}'>å¢åŠ å­ç±»</a>";

262 
echo
 "|<a href='catalog_edit.php?id={$id}'>æ›´æ”¹</a>";

263 
echo
 "|<a href='catalog_do.php?dopost=moveCatalog&typeid={$id}'>ç§»åŠ¨</a>";

264 
echo
 "|<¨h»f='ÿlog_d–.php?id={$id}&ty³ŞdÇme=".
	`u¾’code
(
$ty³Name
)."'>åˆ é™¤</a>";

265 
echo
 "&nbsp; <inputype='text'‚ame='sortrank{$id}' value='{$rank}' style='width:25px;height:20px'></td></tr></table></td></tr>\r\n";

269 if(
$i¥¬t
==2)

271 
echo
 "<Œ height='24' oncÚ‹xtm’u=\"SšgËM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\">\r\n";

272 
echo
 "<td class='bline2'><table width='98%' border='0' cellspacing='0' cellpadding='0'>";

273 
echo
 "<tr onMouseMove=\"javascript:this.bgColor='#FAFCE0';\" onMouseOut=\"javascript:this.bgColor='#FFFFFF';\"><td width='50%'>";

274 
echo
 "<špuˆşass='Å'y³='checkbox'‚ame='tids[]' v®ue='{$id}'>$¡• <img styË='cursÜ:poš‹r' id='img".
$id
."' onClick=\"LßdSuns('suns".$id."',$id);\" src='images/ex¶ode.gif' width='11' height='11'> <¨h»f='ÿlog_do.php?cid=".$id."&dİo¡öi¡Archives'>{$nss}".
$ty³Name
."[ID:".$id."]</a> <a onclick=\"AlertMsg('å¿«æ·ç¼–è¾‘çª—å£','$id');\" href=\"javascript:;\"><img src='images/write2.gif'/></a>";

275 
echo
 "</td><td‡lign='right'>";

276 
echo
 "<a href='{$typeDir}'arget='_blank'>é¢„è§ˆ</a>";

277 
echo
 "|<a href='catalog_edit.php?id={$id}'>æ›´æ”¹</a>";

278 
echo
 "|<a href='catalog_do.php?dopost=moveCatalog&typeid={$id}'>ç§»åŠ¨</a>";

279 
echo
 "|<¨h»f='ÿlog_d–.php?id={$id}&ty³ŞdÇme=".
	`u¾’code
(
$ty³Name
)."'>åˆ é™¤</a>";

280 
echo
 "&nbsp; <inputype='text'‚ame='sortrank{$id}' value='{$rank}' style='width:25px;height:20px'></td></tr></table></td></tr>\r\n";

282 
echo
 " <Œ><td id='suns".
$id
."' style='display:none'><table width='100%' border='0' cellspacing='0' cellpadding='0'>";

283 
$this
->
	`LogicLi¡AÎSunTy³
(
$id
,
$¡•
."ã€€");

284 
echo
 "</table></td></tr>\r\n";

287 
	}
}

297 
funùiÚ
 
	$G‘SunTy³s
(
$id
, 
$chªÃl
=0)

299 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

300 
$this
->
idA¼ay
[$this->
idCouÁ”
]=
$id
;

301 
$this
->
idCouÁ”
++;

302 
$fid
 = 
$id
;

303 if(
$chªÃl
!=0)

305 
$csql
 = " And channeltype=$channel ";

309 
$csql
 = "";

311 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id FROM `#@__arctype` WHERE„eid=$id $csql");

312 
$this
->
dsql
->
	`Execu‹
("gs".
$fid
);

316 
$row
=
$this
->
dsql
->
	`G‘Objeù
("gs".
$fid
))

318 
$nid
 = 
$row
->
id
;

319 
$this
->
	`G‘SunTy³s
(
$nid
,
$chªÃl
);

322  
$this
->
idA¼ay
;

323 
	}
}

333 
funùiÚ
 
	$D–Ty³
(
$id
, 
$isD–Fe
)

335 
$this
->
idCouÁ”
 = 0;

336 
$this
->
idA¼ay
 = "";

337 
$this
->
	`G‘SunTy³s
(
$id
);

338 
$qu”y
 = "

339 
SELECT
 #@
__¬ùy³
.*,#@
__chªÃÉy³
.
ty³Çme
 
AS
 
ùy³Çme
,

340 #@
__chªÃÉy³
.
addbË


341 
FROM
 `#@
__¬ùy³
` 
LEFT
 
JOIN
 #@
__chªÃÉy³


342 
ON
 #@
__chªÃÉy³
.
id
=#@
__¬ùy³
.
chªÃÉy³


343 
WHERE
 #@
__¬ùy³
.
id
='$id'

345 
$ty³šfos
 = 
$this
->
dsql
->
	`G‘OÃ
(
$qu”y
);

346 
$tİšfos
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT mÜes™e,s™eu¾ FROM `#@__¬ùy³` WHERE id='".
$ty³šfos
['topid']."'");

347 if(!
	`is_¬¿y
(
$ty³šfos
))

349  
FALSE
;

351 
$šdœ
 = 
$ty³šfos
['typedir'];

352 
$addbË
 = 
$ty³šfos
['addtable'];

353 
$i¥¬t
 = 
$ty³šfos
['ispart'];

354 
$deçuÉÇme
 = 
$ty³šfos
['defaultname'];

357 
	`fÜ—ch
(
$this
->
idA¼ay
 
as
 
$id
)

359 
$myrow
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__arctype` WHERE id='$id'");

360 if(
$myrow
['topid']>0)

362 
$mytİrow
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT mÜes™e,s™eu¾ FROM `#@__¬ùy³` WHERE id='".
$myrow
['topid']."'");

363 if(
	`is_¬¿y
(
$mytİrow
è&& !
	`em±y
($mytoprow))

365 
	`fÜ—ch
(
$mytİrow
 
as
 
$k
=>
$v
)

367 if(!
	`´eg_m©ch
("/[0-9]/",
$k
))

369 
$myrow
[
$k
] = 
$v
;

377 if(
$myrow
['ispart']==2 && $myrow['typedir']=='')

379 ifĞ
	`is_fe
(
$this
->
ba£Dœ
.'/'.
$myrow
['defaultname']) )

381 @
	`uÆšk
(
$this
->
ba£Dœ
.'/'.
$myrow
['defaultname']);

386 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__arctype` WHERE id='$id'");

388 if(
$isD–Fe
){

389 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHEREypeid='$id'");

390 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHEREypeid='$id'");

391 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__spec` WHEREypeid='$id'");

392 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__feedback` WHEREypeid='$id'");

393 if(
$addbË
!="")

395 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM $addtable WHEREypeid='$id'");

402 if(
$i¥¬t
==2 && 
$šdœ
=="")

404 ifĞ
	`is_fe
(
$this
->
ba£Dœ
."/".
$deçuÉÇme
) )

406 @
	`uÆšk
(
$this
->
ba£Dœ
."/".
$deçuÉÇme
);

409 @
	`»£t
(
$this
->
idA¼ay
);

410 
$this
->
idCouÁ”
 = 0;

411  
TRUE
;

412 
	}
}

421 
funùiÚ
 
	$RmDœFe
(
$šdœ
)

423 if(!
	`fe_exi¡s
(
$šdœ
)) ;

424 
$dh
 = 
	`dœ
(
$šdœ
);

425 
$fe
 = 
$dh
->
	`»ad
())

427 if(
$fe
 == "." || $file == "..")

431 if(
	`is_fe
("$indir/$file"))

433 @
	`uÆšk
("$indir/$file");

437 
$this
->
	`RmDœFe
("$indir/$file");

439 if(
	`is_dœ
("$indir/$file"))

441 @
	`rmdœ
("$indir/$file");

444 
$dh
->
	`şo£
();

446 
	}
}

	@E:\web\weixun\functions\typeunit.class.menu.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

14 şas 
	cTy³Un™


16 
v¬
 
	m$dsql
;

17 
v¬
 
	m$aChªÃls
;

18 
v¬
 
	m$isAdmšAÎ
;

21 
funùiÚ
 
__cÚ¡ruù
(
$ÿogs
='')

23 
glob®
 
$cfg_Cs
;

24 
	m$this
->
	mdsql
 = 
$GLOBALS
['dsql'];

25 
	m$this
->
	maChªÃls
 = 
A¼ay
();

26 
	m$this
->
	misAdmšAÎ
 = 
çl£
;

27 if(!
em±y
(
$ÿogs
è&& 
	m$ÿogs
!='-1')

29 
$this
->
aChªÃls
 = 
ex¶ode
(',',
$ÿogs
);

30 
fÜ—ch
(
$this
->
aChªÃls
 
as
 
$cid
)

32 if(
	m$cfg_Cs
[
$cid
][0]==0)

34 
$this
->
dsql
->
S‘Qu”y
("Select id,ispart From `#@__arctype` where„eid=$cid");

35 
	m$this
->
	mdsql
->
Execu‹
();

36 
	m$row
 = 
$this
->
dsql
->
G‘Objeù
())

39 
$this
->
aChªÃls
[] = 
$row
->
id
;

46 
	m$this
->
	misAdmšAÎ
 = 
Œue
;

50 
funùiÚ
 
Ty³Un™
(
$ÿogs
='')

52 
$this
->
__cÚ¡ruù
(
$ÿogs
);

56 
funùiÚ
 
	$Clo£
()

58 
	}
}

68 
funùiÚ
 
	$Li¡AÎTy³
(
$chªÃl
=0, 
$nowdœ
=0)

71 
glob®
 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
;

74 if(
$cfg_admš_chªÃl
=='array')

76 
$admš_ÿlog
 = 
	`još
(',', 
$admš_ÿlogs
);

77 
$this
->
dsql
->
	`S‘Qu”y
("SELECT„eid FROM `#@__arctype` WHERE id IN($admin_catalog) GROUP BY„eid ");

78 
$this
->
dsql
->
	`Execu‹
();

79 
$tİid¡r
 = '';

80 
$row
 = 
$this
->
dsql
->
	`G‘Objeù
())

82 if(
$row
->
»id
==0) ;

83 
$tİid¡r
 .ğ($tİid¡r=='' ? 
$row
->
»id
 : ','.$row->reid);

85 
$admš_ÿlog
 .ğ','.
$tİid¡r
;

86 
$admš_ÿlogs
 = 
	`ex¶ode
(',', 
$admš_ÿlog
);

87 
$admš_ÿlogs
 = 
	`¬¿y_unique
($admin_catalogs);

90 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,typedir,typename,ispart,channeltype FROM `#@__arctype` WHERE„eid=0 ORDER BY sortrank");

92 
$this
->
dsql
->
	`Execu‹
(0);

93 
$Ï¡id
 = 
	`G‘Cook›
('lastCidMenu');

94 
$row
=
$this
->
dsql
->
	`G‘Objeù
(0))

96 ifĞ
$cfg_admš_chªÃl
=='¬¿y' && !
	`š_¬¿y
(
$row
->
id
, 
$admš_ÿlogs
) )

101 
$ty³Dœ
 = 
$row
->
ty³dœ
;

102 
$ty³Name
 = 
$row
->
ty³Çme
;

103 
$i¥¬t
 = 
$row
->
i¥¬t
;

104 
$id
 = 
$row
->
id
;

105 
$chªÃÉy³
 = 
$row
->
chªÃÉy³
;

108 if(
$i¥¬t
==0)

110 
$sm’u
 = " oncÚ‹xtm’u=\"CommÚM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\"";

113 if(
$i¥¬t
==1)

115 
$sm’u
 = " oncÚ‹xtm’u=\"CommÚM’uP¬tÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\"";

126 
$sm’u
 = " oncÚ‹xtm’u=\"JumpM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\" ";

128 
echo
 "<dl class='topcc'>\r\n";

129 
echo
 " <dd class='dlf'><img style='cursor:pointer' onClick=\"LoadSuns('suns{$id}',{$id});\" src='images/tree_explode.gif' width='11' height='11'></dd>\r\n";

130 
echo
 " <dd cÏss='dÌ'><¨h»f='ÿlog_do.php?cid=".
$id
."&dİo¡öi¡Archives'{$sm’u}>".
$ty³Name
."</a></dd>\r\n";

131 
echo
 "</dl>\r\n";

132 
echo
 "<div id='suns".
$id
."' class='sunct'>";

133 if(
$Ï¡id
==
$id
 || 
$cfg_admš_chªÃl
=='array')

135 
$this
->
	`LogicLi¡AÎSunTy³
(
$id
, "ã€€");

137 
echo
 "</div>\r\n";

139 
	}
}

150 
funùiÚ
 
	$LogicLi¡AÎSunTy³
(
$id
,
$¡•
,
$Ãedcheck
=
Œue
)

152 
glob®
 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
;

153 
$fid
 = 
$id
;

154 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,»id,ty³dœ,ty³Çme,i¥¬t,chªÃÉy³ FROM `#@__¬ùy³` WHERE„eid='".
$id
."' ORDER BY sortrank");

155 
$this
->
dsql
->
	`Execu‹
(
$fid
);

156 if(
$this
->
dsql
->
	`G‘TÙ®Row
(
$fid
)>0)

158 
$row
=
$this
->
dsql
->
	`G‘Objeù
(
$fid
))

160 if(
$cfg_admš_chªÃl
=='¬¿y' && !
	`š_¬¿y
(
$row
->
id
, 
$admš_ÿlogs
) )

164 
$ty³Dœ
 = 
$row
->
ty³dœ
;

165 
$ty³Name
 = 
$row
->
ty³Çme
;

166 
$»id
 = 
$row
->
»id
;

167 
$id
 = 
$row
->
id
;

168 
$i¥¬t
 = 
$row
->
i¥¬t
;

169 
$chªÃÉy³
 = 
$row
->
chªÃÉy³
;

170 if(
$¡•
=="ã€€")

172 
$¡•dd
 = 2;

176 
$¡•dd
 = 3;

180 if(
	`š_¬¿y
(
$id
,
$this
->
aChªÃls
è|| 
$Ãedcheck
===
çl£
 || $this->
isAdmšAÎ
===
Œue
)

183 if(
$i¥¬t
==0||
	`em±y
($ispart))

185 
$sm’u
 = " oncÚ‹xtm’u=\"CommÚM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\"";

186 
$timg
 = " <img src='images/tree_page.gif'> ";

190 if(
$i¥¬t
==1)

192 
$sm’u
 = " oncÚ‹xtm’u=\"CommÚM’uP¬tÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\"";

193 
$timg
 = " <img src='images/tree_part.gif'> ";

207 
$timg
 = " <img src='img/tree_page.gif'> ";

208 
$sm’u
 = " oncÚ‹xtm’u=\"JumpM’uÓv’t,this,$id,'".
	`u¾’code
(
$ty³Name
)."')\" ";

210 
echo
 " <table class='sunlist'>\r\n";

211 
echo
 " <tr>\r\n";

212 
echo
 " <td‡lign='Ëá'>".
$¡•
.
$timg
."<¨h»f='ÿlog_do.php?cid=".
$id
."&dİo¡öi¡Archives'{$sm’u}>".
$ty³Name
."</a></td>\r\n";

213 
echo
 " </tr>\r\n";

214 
echo
 " </table>\r\n";

215 
$this
->
	`LogicLi¡AÎSunTy³
(
$id
,
$¡•
."ã€€",
çl£
);

219 
	}
}

	@E:\web\weixun\functions\typeunit.class.selector.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

7 
»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

14 şas 
	cTy³Un™S–eùÜ


16 
v¬
 
	m$dsql
;

19 
funùiÚ
 
	$__cÚ¡ruù
()

21 
glob®
 
$cfg_Cs
;

22 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

25 
funùiÚ
 
	$Ty³Un™S–eùÜ
()

27 
$this
->
	`__cÚ¡ruù
();

28 
	}
}

31 
funùiÚ
 
	$Clo£
(è{ 
	}
}

40 
funùiÚ
 
	$Li¡AÎTy³
(
$chªÃl
=0)

43 
glob®
 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
, 
$rg‘id
, 
$Şdv®ue
;

45 
$Şdv®ues
 = 
	`¬¿y
();

46 if(!
	`em±y
(
$Şdv®ue
)è
$Şdv®ues
 = 
	`ex¶ode
(',', $oldvalue);

48 if(
$cfg_admš_chªÃl
=='array')

50 
$admš_ÿlog
 = 
	`još
(',', 
$admš_ÿlogs
);

51 
$this
->
dsql
->
	`S‘Qu”y
("SELECT„eid FROM `#@__arctype` WHERE id IN($admin_catalog) GROUP BY„eid ");

52 
$this
->
dsql
->
	`Execu‹
();

53 
$tİid¡r
 = '';

54 
$row
 = 
$this
->
dsql
->
	`G‘Objeù
())

56 if(
$row
->
»id
==0) ;

57 
$tİid¡r
 .ğ($tİid¡r=='' ? 
$row
->
»id
 : ','.$row->reid);

59 
$admš_ÿlog
 .ğ','.
$tİid¡r
;

60 
$admš_ÿlogs
 = 
	`ex¶ode
(',', 
$admš_ÿlog
);

61 
$admš_ÿlogs
 = 
	`¬¿y_unique
($admin_catalogs);

64 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,typedir,typename,ispart,channeltype FROM `#@__arctype` WHERE„eid=0 ORDER BY sortrank");

66 
$this
->
dsql
->
	`Execu‹
(0);

67 
$Ï¡id
 = 
	`G‘Cook›
('lastCidMenu');

68 
$row
=
$this
->
dsql
->
	`G‘Objeù
(0))

70 ifĞ
$cfg_admš_chªÃl
=='¬¿y' && !
	`š_¬¿y
(
$row
->
id
, 
$admš_ÿlogs
) )

74 
$ty³Dœ
 = 
$row
->
ty³dœ
;

75 
$ty³Name
 = 
$row
->
ty³Çme
;

76 
$i¥¬t
 = 
$row
->
i¥¬t
;

77 
$id
 = 
$row
->
id
;

78 
$chªÃÉy³
 = 
$row
->
chªÃÉy³
;

79 
$ischeck
 = 
	`š_¬¿y
(
$id
, 
$Şdv®ues
) ? ' checked' : '';

80 
$chackRadio
 = "<inputype='radio'‚ame='seltypeid' value='{$id}' $ischeck />";

81 if(
$rg‘id
=='ty³id2'è
$chackRadio
 = "<inputype='checkbox'‚ame='seltypeid' id='seltypeid{$id}' value='{$id}' $ischeck />";

82 if((!
	`em±y
(
$chªÃl
è&& 
$chªÃÉy³
 !=$chªÃlè|| 
$i¥¬t
!=0)

84 
$chackRadio
 = '';

86 
$sÚÿt
 = '';

87 
$this
->
	`LogicLi¡AÎSunTy³
(
$id
, 
$chªÃl
, 
$sÚÿt
);

88 if(
$chackRadio
=='' && 
$sÚÿt
=='') ;

89 
echo
 "<div class='quickselItem'>\r\n";

90 
echo
 " <div class='topcat'>{$chackRadio}{$typeName}</div>\r\n";

91 if(
$sÚÿt
!=''è
echo
 " <div class='soncat'>{$soncat}</div>\r\n";

92 
echo
 "</div>\r\n";

94 
	}
}

105 
funùiÚ
 
	$LogicLi¡AÎSunTy³
(
$id
, 
$chªÃl
=0, &
$sÚÿt
)

107 
glob®
 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
, 
$rg‘id
, 
$Şdv®ue
;

108 
$fid
 = 
$id
;

109 
$Şdv®ues
 = 
	`¬¿y
();

110 if(!
	`em±y
(
$Şdv®ue
)è
$Şdv®ues
 = 
	`ex¶ode
(',', $oldvalue);

111 
$this
->
dsql
->
	`S‘Qu”y
("SELECT id,»id,ty³dœ,ty³Çme,i¥¬t,chªÃÉy³ FROM `#@__¬ùy³` WHERE„eid='".
$id
."' ORDER BY sortrank");

112 
$this
->
dsql
->
	`Execu‹
(
$fid
);

113 
$row
=
$this
->
dsql
->
	`G‘Objeù
(
$fid
))

115 if(
$cfg_admš_chªÃl
=='¬¿y' && !
	`š_¬¿y
(
$row
->
id
, 
$admš_ÿlogs
) )

119 
$ty³Dœ
 = 
$row
->
ty³dœ
;

120 
$ty³Name
 = 
$row
->
ty³Çme
;

121 
$»id
 = 
$row
->
»id
;

122 
$id
 = 
$row
->
id
;

123 
$i¥¬t
 = 
$row
->
i¥¬t
;

124 
$chªÃÉy³
 = 
$row
->
chªÃÉy³
;

125 
$ischeck
 = 
	`š_¬¿y
(
$id
, 
$Şdv®ues
) ? ' checked' : '';

126 
$chackRadio
 = "<inputype='radio'‚ame='seltypeid' value='{$row->id}' $ischeck />";

127 if(
$rg‘id
=='ty³id2'è
$chackRadio
 = "<inputype='checkbox'‚ame='seltypeid' id='seltypeid{$id}' value='{$id}' $ischeck />";

128 if(
$i¥¬t
!=0)

130 
$chackRadio
 = '';

132 if(
$chªÃÉy³
!=
$chªÃl
 && !
	`em±y
($channel))

136 if(
$chackRadio
 !='' )

138 
$sÚÿt
 .ğ" <div cÏss='™em'>".
$chackRadio
.
$ty³Name
."</div>\r\n";

139 
$this
->
	`LogicLi¡AÎSunTy³
(
$id
, 
$chªÃl
, 
$sÚÿt
);

143 
$sÚÿt
 .ğ" <b¸¡yË='ş—r:bÙh' /><div cÏss='™em'><b>".
$ty³Name
."ï¼š</b></div>\r\n";

144 
$this
->
	`LogicLi¡AÎSunTy³
(
$id
, 
$chªÃl
, 
$sÚÿt
);

145 
$sÚÿt
 .= " <br style='clear:both' />";

148 
	}
}

	@E:\web\weixun\functions\uploadsafe.inc.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

4 if(
is£t
(
$_FILES
['GLOBALS'])è
ex™
('Request‚ot‡llow!');

8 
	g$cfg_nÙ_®low®l
 = "php|pl|cgi|asp|aspx|jsp|php3|shtm|shtml";

9 
	g$key¬r
 = 
¬¿y
('name', 'type', 'tmp_name', 'size');

10 ià(
	g$GLOBALS
['cfg_html_ed™Ü']=='cked™Ü' && 
is£t
(
$_FILES
['upload']))

12 
$_FILES
['imgfile'] = $_FILES['upload'];

13 
	g$CKU¶ßd
 = 
TRUE
;

14 
un£t
(
$_FILES
['upload']);

16 
fÜ—ch
(
$_FILES
 
as
 
$_key
=>
$_v®ue
)

18 
fÜ—ch
(
$key¬r
 
as
 
$k
)

20 if(!
is£t
(
$_FILES
[
$_key
][
$k
]))

22 
ex™
('Warning...');

25 ifĞ
´eg_m©ch
('#^(cfg_|GLOBALS)#', 
$_key
) )

27 
ex™
('Request var‚ot‡llow for uploadsafe!');

29 
	g$$_key
 = 
$_FILES
[
$_key
]['tmp_Çme'] = 
¡r_»¶aû
("\\\\", "\\", $_FILES[$_key]['tmp_name']);

30 
	g$
{
	g$_key
.'_Çme'} = 
$_FILES
[
$_key
]['name'];

31 
	g$
{
	g$_key
.'_ty³'} = 
$_FILES
[
$_key
]['ty³'] = 
´eg_»¶aû
('#[^0-9a-z\./]#i', '', $_FILES[$_key]['type']);

32 
	g$
{
	g$_key
.'_size'} = 
$_FILES
[
$_key
]['size'] = 
´eg_»¶aû
('#[^0-9]#','',$_FILES[$_key]['size']);

33 if(!
em±y
(
$
{
$_key
.'_Çme'}è&& (
´eg_m©ch
("#\.(".
$cfg_nÙ_®low®l
.")$#i",${$_key.'_name'}) || !preg_match("#\.#", ${$_key.'_name'})) )

35 if(!
defšed
('XAKADMIN'))

37 
ex™
('Not Admin Upload filetype‚ot‡llow !');

40 if(
em±y
(
$
{
$_key
.'_size'}))

42 
	g$
{
	g$_key
.'_size'} = @
fesize
(
$$_key
);

45 
	g$imty³s
 = 
¬¿y


51 if(
š_¬¿y
(
¡¹Şow”
(
Œim
(
$
{
$_key
.'_ty³'})), 
$imty³s
))

53 
	g$image_dd
 = @
g‘imagesize
(
$$_key
);

54 ià(!
is_¬¿y
(
$image_dd
))

56 
ex™
('Upload filetype‚ot‡llow !');

	@E:\web\weixun\functions\userlogin.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

7 
£ssiÚ_¡¬t
();

17 
funùiÚ
 
	$Te¡Purv›w
(
$n
)

19 
$rs
 = 
FALSE
;

20 
$purv›w
 = 
$GLOBALS
['cu£rLogš']->
	`g‘Purv›w
();

21 if(
	`´eg_m©ch
('/admš_AÎowAÎ/i',
$purv›w
))

23  
TRUE
;

25 if(
$n
=='')

27  
TRUE
;

29 if(!
	`is£t
(
$GLOBALS
['groupRanks']))

31 
$GLOBALS
['groupRªks'] = 
	`ex¶ode
(' ',
$purv›w
);

33 
$ns
 = 
	`ex¶ode
(',',
$n
);

34 
	`fÜ—ch
(
$ns
 
as
 
$n
)

37 if(
$n
=='')

41 if(
	`š_¬¿y
(
$n
,
$GLOBALS
['groupRanks']))

43 
$rs
 = 
TRUE
; ;

46  
$rs
;

47 
	}
}

56 
funùiÚ
 
	$CheckPurv›w
(
$n
)

58 if(!
	`Te¡Purv›w
(
$n
))

60 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œï¼<br/><br/><a href='javascript:history.go(-1);'>ç‚¹å‡»æ­¤è¿”å›ä¸Šä¸€é¡µ&gt;&gt;</a>",'javascript:;');

61 
	`ex™
();

63 
	}
}

72 
funùiÚ
 
	$Te¡Admš
()

74 
$purv›w
 = 
$GLOBALS
['cu£rLogš']->
	`g‘Purv›w
();

75 if(
	`´eg_m©ch
('/admš_AÎowAÎ/i',
$purv›w
))

77  
TRUE
;

81  
FALSE
;

83 
	}
}

85 
	g$XakU£rC©®ogs
 = 
A¼ay
();

95 
funùiÚ
 
	$CheckC©®og
(
$cid
, 
$msg
)

97 
glob®
 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
;

98 if(
$cfg_admš_chªÃl
=='®l' || 
	`Te¡Admš
())

100  
TRUE
;

102 ifĞ!
	`š_¬¿y
(
$cid
, 
$admš_ÿlogs
) )

104 
	`ShowMsg
(" $msg <br/><br/><a href='javascript:history.go(-1);'>ç‚¹å‡»æ­¤è¿”å›ä¸Šä¸€é¡µ&gt;&gt;</a>",'javascript:;');

105 
	`ex™
();

107  
TRUE
;

108 
	}
}

119 
funùiÚ
 
	$AddMyAddÚ
(
$fid
, 
$f’ame
)

121 
$ÿcheFe
 = 
XAKDATA
.'/ÿche/addÚ-'.
	`£ssiÚ_id
().'.inc';

122 if(!
	`fe_exi¡s
(
$ÿcheFe
))

124 
$å
 = 
	`fİ’
(
$ÿcheFe
, 'w');

125 
	`fwr™e
(
$å
, '<'.'?php'."\r\n");

126 
	`fwr™e
(
$å
, "\$myaddons =‡rray();\r\n");

127 
	`fwr™e
(
$å
, "\$maNum = 0;\r\n");

128 
	`fşo£
(
$å
);

130 
	`šşude
(
$ÿcheFe
);

131 
$å
 = 
	`fİ’
(
$ÿcheFe
, 'a');

132 
$¬rPos
 = 
$maNum
;

133 
$maNum
++;

134 
	`fwr™e
(
$å
, "\$myaddons[\$maNum] =‡rray('$fid', '$filename');\r\n");

135 
	`fwr™e
(
$å
, "\$maNum = $maNum;\r\n");

136 
	`fşo£
(
$å
);

137 
	}
}

147 
funùiÚ
 
CË¬MyAddÚ
(
$aid
=0, 
$t™Ë
='')

149 
glob®
 
$dsql
;

150 
	g$ÿcheFe
 = 
XAKDATA
.'/ÿche/addÚ-'.
£ssiÚ_id
().'.inc';

151 
	g$_SESSION
['bigfe_šfo'] = 
¬¿y
();

152 
	g$_SESSION
['fe_šfo'] = 
¬¿y
();

153 if(!
fe_exi¡s
(
$ÿcheFe
))

159 if(!
em±y
(
$aid
))

161 
šşude
(
$ÿcheFe
);

162 
fÜ—ch
(
$myaddÚs
 
as
 
$addÚs
)

164 if(!
em±y
(
$t™Ë
)) {

165 
	g$dsql
->
Execu‹NÚeQu”y
("Update `#@__uploads` set‡rcid='$aid',title='$title' where‡id='{$addons[0]}'");

168 
	g$dsql
->
Execu‹NÚeQu”y
("Update `#@__uploads` set‡rcid='$aid' where‡id='{$addons[0]}' ");

172 @
uÆšk
(
$ÿcheFe
);

180 şas 
	cu£rLogš


182 
v¬
 
	m$u£rName
 = '';

183 
v¬
 
	m$u£rPwd
 = '';

184 
v¬
 
	m$u£rID
 = '';

185 
v¬
 
	m$admšDœ
 = '';

186 
v¬
 
	m$u£rTy³
 = '';

187 
v¬
 
	m$u£rChªÃl
 = '';

188 
v¬
 
	m$u£rPurv›w
 = '';

189 
v¬
 
	m$k“pU£rIDTag
 = 'admin_id';

190 
v¬
 
	m$k“pU£rTy³Tag
 = 'admin_type';

191 
v¬
 
	m$k“pU£rChªÃlTag
 = 'admin_channel';

192 
v¬
 
	m$k“pU£rNameTag
 = 'admin_name';

193 
v¬
 
	m$k“pU£rPurv›wTag
 = 'admin_purview';

194 
v¬
 
	m$k“pAdmšStyËTag
 = 'admin_style';

195 
v¬
 
	m$admšStyË
 = 'xak.cn';

198 
funùiÚ
 
__cÚ¡ruù
(
$admšdœ
='')

200 
glob®
 
$admš_·th
;

201 if(
is£t
(
$_SESSION
[
$this
->
k“pU£rIDTag
]))

203 
	m$this
->
	mu£rID
 = 
$_SESSION
[
$this
->
k“pU£rIDTag
];

204 
	m$this
->
	mu£rTy³
 = 
$_SESSION
[
$this
->
k“pU£rTy³Tag
];

205 
	m$this
->
	mu£rChªÃl
 = 
$_SESSION
[
$this
->
k“pU£rChªÃlTag
];

206 
	m$this
->
	mu£rName
 = 
$_SESSION
[
$this
->
k“pU£rNameTag
];

207 
	m$this
->
	mu£rPurv›w
 = 
$_SESSION
[
$this
->
k“pU£rPurv›wTag
];

208 
	m$this
->
	madmšStyË
 = 
$_SESSION
[
$this
->
k“pAdmšStyËTag
];

211 if(
	m$admšdœ
!='')

213 
$this
->
admšDœ
 = 
$admšdœ
;

217 
	m$this
->
	madmšDœ
 = 
$admš_·th
;

221 
funùiÚ
 
u£rLogš
(
$admšdœ
='')

223 
$this
->
__cÚ¡ruù
(
$admšdœ
);

234 
funùiÚ
 
	$checkU£r
(
$u£ºame
, 
$u£½wd
)

236 
glob®
 
$dsql
;

239 
$this
->
u£rName
 = 
	`´eg_»¶aû
("/[^0-9a-zA-Z_@!\.-]/", '', 
$u£ºame
);

240 
$this
->
u£rPwd
 = 
	`´eg_»¶aû
("/[^0-9a-zA-Z_@!\.-]/", '', 
$u£½wd
);

242 
$pwd
 = 
	`PassJoš
(
$this
->
u£rPwd
);

244 
$dsql
->
	`S‘Qu”y
("SELECT‡dmš.*,©y³.purv›w FROM `#@__admš_li¡`‡dmš LEFT JOIN `#@__admšty³`‡ty³ ON‡ty³.¿nk÷dmš.u£¹y³ WHERE‡dmš.u£rid LIKE '".
$this
->
u£rName
."' LIMIT 0,1");

245 
$dsql
->
	`Execu‹
();

246 
$row
 = 
$dsql
->
	`G‘Objeù
();

247 if(!
	`is£t
(
$row
->
pwd
))

251 if(
$pwd
!=
$row
->
pwd
)

257 
$logš
 = 
	`G‘IP
();

258 
$this
->
u£rID
 = 
$row
->
id
;

259 
$this
->
u£rTy³
 = 
$row
->
u£¹y³
;

260 
$this
->
u£rChªÃl
 = 
$row
->
ty³id
;

261 
$this
->
u£rName
 = 
$row
->
uÇme
;

262 
$this
->
u£rPurv›w
 = 
$row
->
purv›ws
;

263 
$šqu”y
 = "UPDATE `#@__admš_li¡` SET†ogš='$logš',logštime='".
	`time
()."' WHERE id='".
$row
->
id
."'";

264 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

265 
$sql
 = "UPDATE `#@__memb”_li¡` SET†ogštime=".
	`time
().",†ogš='$logš' WHERE mid=".
$row
->
id
;

266 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

269 
	}
}

277 
funùiÚ
 
	$k“pU£r
()

279 if(
$this
->
u£rID
 !ğ'' && $this->
u£rTy³
 != '')

281 
glob®
 
$admšÿchefe
,
$admš¡yË
;

282 if(
	`em±y
(
$admš¡yË
)) $adminstyle = 'xak.cn';

284 @
	`£ssiÚ_»gi¡”
(
$this
->
k“pU£rIDTag
);

285 
$_SESSION
[
$this
->
k“pU£rIDTag
] = $this->
u£rID
;

287 @
	`£ssiÚ_»gi¡”
(
$this
->
k“pU£rTy³Tag
);

288 
$_SESSION
[
$this
->
k“pU£rTy³Tag
] = $this->
u£rTy³
;

290 @
	`£ssiÚ_»gi¡”
(
$this
->
k“pU£rChªÃlTag
);

291 
$_SESSION
[
$this
->
k“pU£rChªÃlTag
] = $this->
u£rChªÃl
;

293 @
	`£ssiÚ_»gi¡”
(
$this
->
k“pU£rNameTag
);

294 
$_SESSION
[
$this
->
k“pU£rNameTag
] = $this->
u£rName
;

296 @
	`£ssiÚ_»gi¡”
(
$this
->
k“pU£rPurv›wTag
);

297 
$_SESSION
[
$this
->
k“pU£rPurv›wTag
] = $this->
u£rPurv›w
;

299 @
	`£ssiÚ_»gi¡”
(
$this
->
k“pAdmšStyËTag
);

300 
$_SESSION
[
$this
->
k“pAdmšStyËTag
] = 
$admš¡yË
;

302 
	`PutCook›
('XakU£rID', 
$this
->
u£rID
, 3600 * 24, '/');

303 
	`PutCook›
('XakLogšTime', 
	`time
(), 3600 * 24, '/');

305 
$this
->
	`ReWr™eAdmšChªÃl
();

313 
	}
}

321 
funùiÚ
 
	$ReWr™eAdmšChªÃl
()

324 
$ÿcheFe
 = 
XAKDATA
.'/ÿche/admšÿt_'.
$this
->
u£rID
.'.inc';

326 
$ty³id
 = 
	`Œim
(
$this
->
u£rChªÃl
);

327 ifĞ
	`em±y
(
$ty³id
è|| 
$this
->
	`g‘U£rTy³
() >= 10 ) {

328 
$fœ¡CÚfig
 = "\$cfg_admin_channel = 'all';\r\n\$admin_catalogs =‡rray();\r\n";

331 
$fœ¡CÚfig
 = "\$cfg_admin_channel = 'array';\r\n";

333 
$å
 = 
	`fİ’
(
$ÿcheFe
, 'w');

334 
	`fwr™e
(
$å
, '<'.'?php'."\r\n");

335 
	`fwr™e
(
$å
, 
$fœ¡CÚfig
);

336 ifĞ!
	`em±y
(
$ty³id
) )

338 
$ty³ids
 = 
	`ex¶ode
(',', 
$ty³id
);

339 
$ty³id
 = '';

340 
	`fÜ—ch
(
$ty³ids
 
as
 
$tid
)

342 
$ty³id
 .ğĞ$ty³id=='' ? 
	`G‘SÚIdsUL
(
$tid
) : ','.GetSonIdsUL($tid) );

344 
$ty³ids
 = 
	`ex¶ode
(',', 
$ty³id
);

345 
$ty³id¢ew
 = 
	`¬¿y_unique
(
$ty³ids
);

346 
$ty³id
 = 
	`još
(',', 
$ty³id¢ew
);

347 
	`fwr™e
(
$å
, "\$admin_catalogs =‡rray($typeid);\r\n");

349 
	`fwr™e
(
$å
, '?'.'>');

350 
	`fşo£
(
$å
);

351 
	}
}

360 
funùiÚ
 
	$ex™U£r
()

362 
	`CË¬MyAddÚ
();

363 @
	`£ssiÚ_uÄegi¡”
(
$this
->
k“pU£rIDTag
);

364 @
	`£ssiÚ_uÄegi¡”
(
$this
->
k“pU£rTy³Tag
);

365 @
	`£ssiÚ_uÄegi¡”
(
$this
->
k“pU£rChªÃlTag
);

366 @
	`£ssiÚ_uÄegi¡”
(
$this
->
k“pU£rNameTag
);

367 @
	`£ssiÚ_uÄegi¡”
(
$this
->
k“pU£rPurv›wTag
);

368 
	`DrİCook›
('XakAdmindir');

369 
	`DrİCook›
('XakUserID');

370 
	`DrİCook›
('XakLoginTime');

371 
$_SESSION
 = 
	`¬¿y
();

372 
	}
}

380 
funùiÚ
 
	$g‘U£rChªÃl
()

382 if(
$this
->
u£rChªÃl
 != '')

384  
$this
->
u£rChªÃl
;

390 
	}
}

398 
funùiÚ
 
	$g‘U£rTy³
()

400 if(
$this
->
u£rTy³
 != '')

402  
$this
->
u£rTy³
;

408 
	}
}

416 
funùiÚ
 
	$g‘U£rRªk
()

418  
$this
->
	`g‘U£rTy³
();

419 
	}
}

427 
funùiÚ
 
	$g‘U£rID
()

429 if(
$this
->
u£rID
 != '')

431  
$this
->
u£rID
;

437 
	}
}

445 
funùiÚ
 
	$g‘U£rName
()

447 if(
$this
->
u£rName
 != '')

449  
$this
->
u£rName
;

455 
	}
}

463 
funùiÚ
 
	$g‘Purv›w
()

465  
$this
->
u£rPurv›w
;

466 
	}
}

478 
funùiÚ
 
	$G‘SÚIdsUL
(
$id
, 
$chªÃl
=0, 
$addthis
=
TRUE
)

480 
glob®
 
$cfg_Cs
;

481 
$GLOBALS
['idA¼ay'] = 
	`¬¿y
();

482 ifĞ!
	`is_¬¿y
(
$cfg_Cs
) )

484 
	`»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

486 
	`G‘SÚIdsLogicUL
(
$id
,
$cfg_Cs
,
$chªÃl
,
$addthis
);

487 
$rqu”y
 = 
	`još
(',', 
$GLOBALS
['idArray']);

488  
$rqu”y
;

489 
	}
}

501 
funùiÚ
 
	$G‘SÚIdsLogicUL
(
$id
,
$sA¼
,
$chªÃl
=0,
$addthis
=
FALSE
)

503 if(
$id
!=0 && 
$addthis
)

505 
$GLOBALS
['idA¼ay'][
$id
] = $id;

507 
	`fÜ—ch
(
$sA¼
 
as
 
$k
=>
$v
)

509 ifĞ
$v
[0]==
$id
 && (
$chªÃl
==0 || $v[1]==$channel ))

511 
	`G‘SÚIdsLogicUL
(
$k
,
$sA¼
,
$chªÃl
,
TRUE
);

514 
	}
}

	@E:\web\weixun\functions\vdimgck.php

1 <?
php


7 
»quœe_Úû
 (
dœÇme
(
__FILE__
).'/common.inc.php');

8 
»quœe_Úû
 (
XAKDATA
.'/safe/inc_safe_config.php');

9 
»quœe_Úû
 (
XAKDATA
.'/config.cache.inc.php');

11 
	g$cÚfig
 = 
¬¿y
(

13 'img_height' => 
$§ã_wheight
,

14 'wÜd_ty³' => ()
$§ã_cod‘y³
,

15 'img_width' => 
$§ã_wwidth
,

16 'fÚt_fe' => 
dœÇme
(
__FILE__
).'/data/fonts/elephant.ttf',

17 'wÜdli¡_fe' => 
dœÇme
(
__FILE__
).'/data/words/words.txt');

21 if(
is£t
(
$ewidth
è&& 
	g$ewidth
 > 0)

23 
	g$cÚfig
['img_width'] = 
$ewidth
;

27 if(
is£t
(
$eheight
è&& 
	g$eheight
 > 0)

29 
	g$cÚfig
['img_height'] = 
$eheight
;

33 if(
is£t
(
$efÚtsize
è&& 
	g$efÚtsize
 > 0)

35 
	g$cÚfig
['fÚt_size'] = 
$efÚtsize
;

39 
	g$£ssSaveP©h
 = 
XAKDATA
."/sessions/";

42 if(
is_wr™—bË
(
$£ssSaveP©h
è&& 
	$is_»adabË
(
$£ssSaveP©h
)){ 
	`£ssiÚ_§ve_·th
($£ssSaveP©h); 
	}
}

43 if(!
	$em±y
(
$cfg_domaš_cook›
)è
	`£ssiÚ_£t_cook›_·¿ms
(0,'/',$cfg_domain_cookie);

45 ià(!
	$echo_v®id©e_image
(
$cÚfig
))

48 @
	`£ssiÚ_¡¬t
();

49 
$_SESSION
['£curimage_code_v®ue'] = 
	`¡¹Şow”
('abcd');

50 
$im
 = @
	`imageü—‹äomj³g
(
	`dœÇme
(
__FILE__
).'/data/vdcode.jpg');

51 
	`h—d”
("Pragma:no-cache\r\n");

52 
	`h—d”
("Cache-Control:no-cache\r\n");

53 
	`h—d”
("Expires:0\r\n");

54 
	`imagej³g
(
$im
);

55 
	`imagede¡roy
(
$im
);

56 
	}
}

58 
funùiÚ
 
echo_v®id©e_image
Ğ
$cÚfig
 = 
	$¬¿y
() )

60 @
	`£ssiÚ_¡¬t
();

63 
$fÚt_size
 = 
	`is£t
(
$cÚfig
['font_size']) ? $config['font_size'] : 14;

64 
$img_height
 = 
	`is£t
(
$cÚfig
['img_height']) ? $config['img_height'] : 30;

65 
$img_width
 = 
	`is£t
(
$cÚfig
['img_width']) ? $config['img_width'] : 80;

66 
$fÚt_fe
 = 
	`is£t
(
$cÚfig
['fÚt_fe']è? $cÚfig['fÚt_fe'] : 
PATH_DATA
.'/data/fonts/elephant.ttf';

67 
$wÜd_ty³
 = 
	`is£t
(
$cÚfig
['word_type']) ? $config['word_type'] : 3;

70 
$ch¬£t
 = 
	`¬¿y
(

76 
$im
 = @
	`imageü—‹ŒuecŞÜ
(
$img_width
,
$img_height
);

79 
$ºd¡ršg
 = '';

80 
$ch¬£t_Ën
 = 
	`¡¾’
(
$ch¬£t
[
$wÜd_ty³
])-1;

81 
$i
=0; $i<4; $i++)

83 
$ºd¡ršg
 .ğ
$ch¬£t
[
$wÜd_ty³
][
	`¿nd
(1,
$ch¬£t_Ën
)];

86 
$_SESSION
['£curimage_code_v®ue'] = 
	`¡¹Şow”
(
$ºd¡ršg
);

87 
$ºdcod–’
 = 
	`¡¾’
(
$ºd¡ršg
);

91 
$background
 = '#EDF7FF';

92 
$background
 = 
	`imagecŞÜ®loÿ‹
(
$im
,
	`hexdec
(
	`sub¡r
($background, 1,2)),hexdec(substr($background, 3,2)),hexdec(substr($background, 5,2)));

94 
	`imagefËd»ùªgË
(
$im
,0,
$img_height
,
$img_width
,0,
$background
);

97 
$fÚt_cŞÜ
 = 
	`imagecŞÜ®loÿ‹
(
$im
, 
	`¿nd
(0,156),„and(0,156),„and(0,156));

98 
$x
 = 
$img_width
/4;

99 
$i
=0; $i<4; $i++)

101 
$ºd¡ršg
[
$i
] = 
	`¡¹ouµ”
($rndstring[$i]);

102 @
	`imag‘táext
(
$im
, 
$fÚt_size
, 
	`¿nd
(-20,20), 
$x
*
$i
+¿nd(0,2), 
$img_height
/1.4, 
$fÚt_cŞÜ
, 
$fÚt_fe
, 
$ºd¡ršg
[$i]);

106 @
	`image£‰hickÃss
(
$im
, 3);

107 
$xpos
 = (
$fÚt_size
 * 2è+ 
	`¿nd
(-5, 5);

108 
$width
 = 
$img_width
 / 2.66 + 
	`¿nd
(3, 10);

109 
$height
 = 
$fÚt_size
 * 2.14;

111 iàĞ
	`¿nd
(0,100) % 2 == 0 )

113 
$¡¬t
 = 
	`¿nd
(0,66);

114 
$ypos
 = 
$img_height
 / 2 - 
	`¿nd
(10, 30);

115 
$xpos
 +ğ
	`¿nd
(5, 15);

117 
$¡¬t
 = 
	`¿nd
(180, 246);

118 
$ypos
 = 
$img_height
 / 2 + 
	`¿nd
(10, 30);

121 
$’d
 = 
$¡¬t
 + 
	`¿nd
(75, 110);

123 
	`imag—rc
(
$im
, 
$xpos
, 
$ypos
, 
$width
, 
$height
, 
$¡¬t
, 
$’d
, 
$fÚt_cŞÜ
);

125 iàĞ
	`¿nd
(1,75) % 2 == 0 ) {

126 
$¡¬t
 = 
	`¿nd
(45, 111);

127 
$ypos
 = 
$img_height
 / 2 - 
	`¿nd
(10, 30);

128 
$xpos
 +ğ
	`¿nd
(5, 15);

130 
$¡¬t
 = 
	`¿nd
(200, 250);

131 
$ypos
 = 
$img_height
 / 2 + 
	`¿nd
(10, 30);

134 
$’d
 = 
$¡¬t
 + 
	`¿nd
(75, 100);

136 
	`imag—rc
(
$im
, 
$img_width
 * .75, 
$ypos
, 
$width
, 
$height
, 
$¡¬t
, 
$’d
, 
$fÚt_cŞÜ
);

138 
	`h—d”
("Pragma:no-cache\r\n");

139 
	`h—d”
("Cache-Control:no-cache\r\n");

140 
	`h—d”
("Expires:0\r\n");

143 if(
	`funùiÚ_exi¡s
("imagejpeg"))

145 
	`h—d”
("content-type:image/jpeg\r\n");

146 
	`imagej³g
(
$im
);

150 
	`h—d”
("content-type:image/png\r\n");

151 
	`imag•ng
(
$im
);

153 
	`imagede¡roy
(
$im
);

154 
	`ex™
();

155 
	}
}

	@E:\web\weixun\functions\wap.inc.php

1 <?
php


2 if(!
defšed
('XAKINC')è
ex™
('Warning...');

4 
»quœe_Úû
(
XAKINC
.'/channelunit.class.php');

9 
funùiÚ
 
	$html2wml
(
$cÚ‹Á
)

12 
	`´eg_m©ch_®l
("/<img([^>]*)>/isU", 
$cÚ‹Á
, 
$img¬r
);

13 if(
	`is£t
(
$img¬r
[0]è&& 
	`couÁ
($imgarr[0])>0 )

15 
	`fÜ—ch
(
$img¬r
[0] 
as
 
$k
=>
$v
è
$cÚ‹Á
 = 
	`¡r_»¶aû
($v, "WAP-IMG::{$k}", $content);

18 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<style .*?<\/style>/is", "", $content);

19 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<script .*?<\/script>/is", "", $content);

21 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<br \s*\/?\/>/i", "\n", $content);

22 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<\/?p>/i", "\n", $content);

23 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<\/?td>/i", "\n", $content);

24 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<\/?div>/i", "\n", $content);

25 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<\/?blockquote>/i", "\n", $content);

26 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/<\/?li>/i", "\n", $content);

28 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/\&nbsp\;/i", " ", $content);

29 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/\&nbsp/i", " ", $content);

31 
$cÚ‹Á
 = 
	`¡r_gs
($content);

33 
$cÚ‹Á
 = 
	`html_’t™y_decode
($cÚ‹Á, 
ENT_QUOTES
, "GB2312");

35 
$cÚ‹Á
 = 
	`´eg_»¶aû
('/\&\#.*?\;/i', '', $content);

37 
$cÚ‹Á
 = 
	`¡r_»¶aû
('$', '$$', $content);

38 
$cÚ‹Á
 = 
	`¡r_»¶aû
("\r\n", "\n", 
	`html¥ecŸlch¬s
($content));

39 
$cÚ‹Á
 = 
	`ex¶ode
("\n", $content);

40 
$i
 = 0; $˜< 
	`couÁ
(
$cÚ‹Á
); $i++)

42 
$cÚ‹Á
[
$i
] = 
	`Œim
($content[$i]);

44 ià(
	`¡r_»¶aû
('ã€€', '', 
$cÚ‹Á
[
$i
]) == '') $content[$i] = '';

46 
$cÚ‹Á
 = 
	`¡r_»¶aû
("<p><b¸/></p>\n", "", '<p>'.
	`im¶ode
("<br /></p>\n<p>", $content)."<br /></p>\n");

49 if(
	`is£t
(
$img¬r
[0]è&& 
	`couÁ
($imgarr[0])>0 )

51 
	`fÜ—ch
(
$img¬r
[0] 
as
 
$k
=>
$v
)

53 
$©t¡r
 = (
	`´eg_m©ch
('#/$#', 
$img¬r
[1][
$k
])) ? '<img '.$imgarr[1][$k].'>' : '<img '.$imgarr[1][$k].' />';

54 
$cÚ‹Á
 = 
	`¡r_»¶aû
("WAP-IMG::{$k}", 
$©t¡r
, $content);

58 
$cÚ‹Á
 = 
	`´eg_»¶aû
("/&amp;[a-z]{3,10};/isU", ' ', $content);

60  
$cÚ‹Á
;

61 
	}
}

63 
funùiÚ
 
	$‹xt2wml
(
$cÚ‹Á
)

65 
$cÚ‹Á
 = 
	`¡r_»¶aû
('$', '$$', $content);

66 
$cÚ‹Á
 = 
	`¡r_»¶aû
("\r\n", "\n", 
	`html¥ecŸlch¬s
($content));

67 
$cÚ‹Á
 = 
	`ex¶ode
("\n", $content);

68 
$i
 = 0; $˜< 
	`couÁ
(
$cÚ‹Á
); $i++)

71 
$cÚ‹Á
[
$i
] = 
	`Œim
($content[$i]);

73 ià(
	`¡r_»¶aû
("ã€€", "", 
$cÚ‹Á
[
$i
]) == "") $content[$i] = "";

76 
$cÚ‹Á
 = 
	`¡r_»¶aû
("<p><b¸/></p>\n", "", "<p>".
	`im¶ode
("<br /></p>\n<p>", $content)."<br /></p>\n");

77  
$cÚ‹Á
;

78 
	}
}

83 
funùiÚ
 
	$CÚv”tCh¬£t
(
$v¬li¡
)

85 
glob®
 
$cfg_soá_Ïng
;

86 if(
	`´eg_m©ch
('#utf#i',
$cfg_soá_Ïng
))  0;

87 
$v¬li¡s
 = 
	`ex¶ode
(',',
$v¬li¡
);

88 
$num¬gs
=
	`couÁ
(
$v¬li¡s
);

89 
$i
 = 0; $˜< 
$num¬gs
; $i++)

91 if(
	`is£t
(
$GLOBALS
[
$v¬li¡s
[
$i
]]))

93 
$GLOBALS
[
$v¬li¡s
[
$i
]] = 
	`gb2utf8
($GLOBALS[$varlists[$i]]);

97 
	}
}

102 
funùiÚ
 
	$CÚv”tSŒ
(
$¡r
)

104 
$¡r
 = 
	`¡r_»¶aû
("&amp;","##amp;",$str);

105 
$¡r
 = 
	`¡r_»¶aû
("&","&amp;",$str);

106 
$¡r
 = 
	`´eg_»¶aû
("#[\"><']#","",$str);

107 
$¡r
 = 
	`¡r_»¶aû
("##amp;","&amp;",$str);

108  
$¡r
;

109 
	}
}

	@E:\web\weixun\functions\xakatt.class.php

1 <?
php


15 şas 
	cXakA‰


17 
v¬
 
	m$CouÁ
 = -1;

18 
v¬
 
	m$I‹ms
 = "";

27 
funùiÚ
 
	$G‘A‰
(
$¡r
)

29 if(
$¡r
=="")

33 if(
	`is£t
(
$this
->
I‹ms
[
$¡r
]))

35  
$this
->
I‹ms
[
$¡r
];

44 
funùiÚ
 
	$G‘A‰ribu‹
(
$¡r
)

46  
$this
->
	`G‘A‰
(
$¡r
);

47 
	}
}

56 
funùiÚ
 
	$IsA‰ribu‹
(
$¡r
)

58  
	`is£t
(
$this
->
I‹ms
[
$¡r
]è? 
TRUE
 : 
FALSE
;

59 
	}
}

67 
funùiÚ
 
	$G‘TagName
()

69  
$this
->
	`G‘A‰
("tagname");

70 
	}
}

78 
funùiÚ
 
	$G‘CouÁ
()

80  
$this
->
CouÁ
+1;

81 
	}
}

90 şas 
	cXakA‰P¬£


92 
v¬
 
	m$SourûSŒšg
 = "";

93 
v¬
 
	m$SourûMaxSize
 = 1024;

94 
v¬
 
	m$CA‰
 = "";

95 
v¬
 
	m$Ch¬ToLow
 = 
TRUE
;

104 
funùiÚ
 
S‘Sourû
(
$¡r
="")

106 
$this
->
CA‰
 = 
Ãw
 
XakA‰
();

107 
	m$¡rL’
 = 0;

108 
	m$this
->
	mSourûSŒšg
 = 
Œim
(
´eg_»¶aû
("/[ \t\r\n]{1,}/"," ",
$¡r
));

109 
	m$¡rL’
 = 
¡¾’
(
$this
->
SourûSŒšg
);

110 if(
	m$¡rL’
>0&&$¡rL’<=
$this
->
SourûMaxSize
)

112 
$this
->
P¬£A‰
();

122 
funùiÚ
 
	$P¬£A‰
()

124 
$d
 = "";

125 
$tm·‰
="";

126 
$tmpv®ue
="";

127 
$¡¬tdd
=-1;

128 
$ddg
="";

129 
$nÙA‰ribu‹
=
TRUE
;

130 
$¡rL’
 = 
	`¡¾’
(
$this
->
SourûSŒšg
);

135 
$i
=0;$i<
$¡rL’
;$i++)

137 
$d
 = 
	`sub¡r
(
$this
->
SourûSŒšg
,
$i
,1);

138 if(
$d
==' ')

140 
$this
->
CA‰
->
CouÁ
++;

141 if(
$this
->
Ch¬ToLow
)

143 
$this
->
CA‰
->
I‹ms
["gÇme"]=
	`¡¹Şow”
(
	`Œim
(
$tmpv®ue
));

147 
$this
->
CA‰
->
I‹ms
["gÇme"]=
	`Œim
(
$tmpv®ue
);

149 
$tmpv®ue
 = "";

150 
$nÙA‰ribu‹
 = 
FALSE
;

155 
$tmpv®ue
 .ğ
$d
;

160 if(
$nÙA‰ribu‹
)

162 
$this
->
CA‰
->
CouÁ
++;

163 
$this
->
CA‰
->
I‹ms
["gÇme"]ğ($this->
Ch¬ToLow
 ? 
	`¡¹Şow”
(
	`Œim
(
$tmpv®ue
)) :rim($tmpvalue));

167 if(!
$nÙA‰ribu‹
)

169 
$i
;$i<
$¡rL’
;$i++)

171 
$d
 = 
	`sub¡r
(
$this
->
SourûSŒšg
,
$i
,1);

172 if(
$¡¬tdd
==-1)

174 if(
$d
!="=")

176 
$tm·‰
 .ğ
$d
;

180 if(
$this
->
Ch¬ToLow
)

182 
$tm·‰
 = 
	`¡¹Şow”
(
	`Œim
($tmpatt));

186 
$tm·‰
 = 
	`Œim
($tmpatt);

188 
$¡¬tdd
=0;

191 if(
$¡¬tdd
==0)

193 
$d
)

199 
$ddg
='\'';

200 
$¡¬tdd
=1;

203 
$ddg
='"';

204 
$¡¬tdd
=1;

207 
$tmpv®ue
.=
$d
;

208 
$ddg
=' ';

209 
$¡¬tdd
=1;

213 if(
$¡¬tdd
==1)

215 if(
$d
==
$ddg
)

217 
$this
->
CA‰
->
CouÁ
++;

218 
$this
->
CA‰
->
I‹ms
[
$tm·‰
] = 
	`Œim
(
$tmpv®ue
);

219 
$tm·‰
 = "";

220 
$tmpv®ue
 = "";

221 
$¡¬tdd
=-1;

225 
$tmpv®ue
.=
$d
;

229 if(
$tm·‰
!="")

231 
$this
->
CA‰
->
CouÁ
++;

232 
$this
->
CA‰
->
I‹ms
[
$tm·‰
]=
	`Œim
(
$tmpv®ue
);

237 
	}
}

	@E:\web\weixun\functions\xakcollection.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

8 
»quœe_Úû
(
XAKINC
."/xakcollection.func.php");

9 
»quœe_Úû
(
XAKINC
."/image.func.php");

10 
»quœe_Úû
(
XAKINC
."/xakhtml2.class.php");

11 @
£t_time_lim™
(0);

19 şas 
	cXakCŞËùiÚ


21 
v¬
 
	m$¬tNÙes
 = 
¬¿y
();

22 
v¬
 
	m$¥NÙes
 = 
¬¿y
();

23 
v¬
 
	m$li¡s
 = 
¬¿y
();

24 
v¬
 
	m$nÙeInfos
 = 
¬¿y
();

25 
v¬
 
	m$dsql
 = '';

26 
v¬
 
	m$nÙeId
 = '';

27 
v¬
 
	m$cXakHtml
 = '';

28 
v¬
 
	m$cH‰pDown
 = '';

29 
v¬
 
	m$medŸCouÁ
 = 0;

30 
v¬
 
	m$tmpUn™V®ue
 = '';

31 
v¬
 
	m$tmpLšks
 = 
¬¿y
();

32 
v¬
 
	m$tmpHtml
 = '';

33 
v¬
 
	m$b»Image
 = '';

34 
v¬
 
	m$”rSŒšg
 = '';

37 
funùiÚ
 
	$__cÚ¡ruù
()

39 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

40 
$this
->
cH‰pDown
 = 
Ãw
 
	`XakH‰pDown
();

41 
$this
->
cXakHtml
 = 
Ãw
 
	`XakHtml2
();

44 
funùiÚ
 
	$XakCŞËùiÚ
()

46 
$this
->
	`__cÚ¡ruù
();

47 
	}
}

50 
funùiÚ
 
	$Clo£
()

52 
	}
}

61 
funùiÚ
 
	$LßdNÙe
(
$nid
)

63 
$this
->
nÙeId
 = 
$nid
;

64 
$row
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__co_note` WHERE‚id='$nid'");

65 
$this
->
	`LßdLi¡CÚfig
(
$row
['listconfig']);

66 
$this
->
	`LßdI‹mCÚfig
(
$row
['itemconfig']);

67 
	}
}

76 
funùiÚ
 
	$LßdLi¡CÚfig
(
$cÚfigSŒšg
)

78 
$d
 = 
Ãw
 
	`XakTagP¬£
();

79 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

80 
$d
->
	`LßdSŒšg
(
$cÚfigSŒšg
);

81 
$i
=0; $i<=
$d
->
CouÁ
; $i++)

83 
$ùag
 = 
$d
->
CTags
[
$i
];

87 if(
$ùag
->
	`G‘Name
()=="noteinfo")

89 
$this
->
nÙeInfos
['nÙ’ame'] = 
$ùag
->
	`G‘A‰
('notename');

90 
$this
->
nÙeInfos
['m©chty³'] = 
$ùag
->
	`G‘A‰
('matchtype');

91 
$this
->
nÙeInfos
['chªÃlid'] = 
$ùag
->
	`G‘A‰
('channelid');

92 
$this
->
nÙeInfos
['»fu¾'] = 
$ùag
->
	`G‘A‰
('refurl');

93 
$this
->
nÙeInfos
['sourûÏng'] = 
$ùag
->
	`G‘A‰
('sourcelang');

94 
$this
->
nÙeInfos
['cosÜt'] = 
$ùag
->
	`G‘A‰
('cosort');

95 
$this
->
nÙeInfos
['i¤ef'] = 
$ùag
->
	`G‘A‰
('isref');

96 
$this
->
nÙeInfos
['ex±ime'] = 
$ùag
->
	`G‘A‰
('exptime');

101 if(
$ùag
->
	`G‘Name
()=="listrule")

103 
$this
->
li¡s
['sourûty³'] = 
$ùag
->
	`G‘A‰
('sourcetype');

104 
$this
->
li¡s
['rssu¾'] = 
$ùag
->
	`G‘A‰
('rssurl');

105 
$this
->
li¡s
['»gxu¾'] = 
$ùag
->
	`G‘A‰
('regxurl');

106 
$this
->
li¡s
['¡¬tid'] = 
$ùag
->
	`G‘A‰
('startid');

107 
$this
->
li¡s
['’did'] = 
$ùag
->
	`G‘A‰
('endid');

108 
$this
->
li¡s
['addv'] = 
$ùag
->
	`G‘A‰
('addv');

109 
$this
->
li¡s
['u¾ruË'] = 
$ùag
->
	`G‘A‰
('urlrule');

110 
$this
->
li¡s
['mu¡has'] = 
$ùag
->
	`G‘A‰
('musthas');

111 
$this
->
li¡s
['nÙhas'] = 
$ùag
->
	`G‘A‰
('nothas');

112 
$this
->
li¡s
['li¡pic'] = 
$ùag
->
	`G‘A‰
('listpic');

113 
$this
->
li¡s
['u£mÜe'] = 
$ùag
->
	`G‘A‰
('usemore');

114 
$d2
->
	`LßdSŒšg
(
$ùag
->
	`G‘IÂ”Text
());

115 
$j
=0; $j<=
$d2
->
CouÁ
; $j++)

117 
$ùag2
 = 
$d2
->
CTags
[
$j
];

118 
$Šame
 = 
$ùag2
->
	`G‘Name
();

119 if(
$Šame
=='addurls')

121 
$this
->
li¡s
['addu¾s'] = 
	`Œim
(
$ùag2
->
	`G‘IÂ”Text
());

123 if(
$Šame
=='regxrule')

125 
$this
->
li¡s
['»gxruË'] = 
	`Œim
(
$ùag2
->
	`G‘IÂ”Text
());

127 if(
$Šame
=='areastart')

129 
$this
->
li¡s
['¬—¡¬t'] = 
	`Œim
(
$ùag2
->
	`G‘IÂ”Text
());

131 if(
$Šame
=='areaend')

133 
$this
->
li¡s
['¬—’d'] = 
	`Œim
(
$ùag2
->
	`G‘IÂ”Text
());

135 if(
$Šame
=='batchrule')

137 
$this
->
li¡s
['b©chruË'] = 
	`Œim
(
$ùag2
->
	`G‘IÂ”Text
());

142 if(
$this
->
li¡s
['sourcetype'] != 'rss')

144 
$this
->
li¡s
['u¾'] = 
	`G‘U¾FromLi¡RuË
($this->lists['regxurl'],$this->lists['addurls'],

145 
$this
->
li¡s
['startid'],$this->lists['endid'],$this->lists['addv'],$this->lists['usemore'],$this->lists['batchrule']);

149 
$this
->
li¡s
['url'] = $this->lists['rssurl'];

154 
$d
->
	`CË¬
();

155 
$d2
->
	`CË¬
();

156 
	}
}

165 
funùiÚ
 
	$LßdI‹mCÚfig
(
$cÚfigSŒšg
)

167 
$d
 = 
Ãw
 
	`XakTagP¬£
();

168 
$d2
 = 
Ãw
 
	`XakTagP¬£
();

169 
$d
->
	`LßdSŒšg
(
$cÚfigSŒšg
);

170 
$i
=0; $i<=
$d
->
CouÁ
; $i++)

172 
$ùag
 = 
$d
->
CTags
[
$i
];

173 if(
$ùag
->
	`G‘Name
()=='sppage')

175 
$this
->
¬tNÙes
['¥·ge'] = 
$ùag
->
	`G‘IÂ”Text
();

176 
$this
->
¬tNÙes
['¥ty³'] = 
$ùag
->
	`G‘A‰
('sptype');

177 
$this
->
¥NÙes
['¤ul'] = 
$ùag
->
	`G‘A‰
('srul');

178 
$this
->
¥NÙes
['”ul'] = 
$ùag
->
	`G‘A‰
('erul');

180 if(
$ùag
->
	`G‘Name
()=='previewurl')

182 
$this
->
¬tNÙes
['´ev›wu¾'] = 
$ùag
->
	`G‘IÂ”Text
();

184 if(
$ùag
->
	`G‘Name
()=='keywordtrim')

186 
$this
->
¬tNÙes
['keywÜdŒim'] = 
$ùag
->
	`G‘IÂ”Text
();

188 if(
$ùag
->
	`G‘Name
()=='descriptiontrim')

190 
$this
->
¬tNÙes
['desütiÚŒim'] = 
$ùag
->
	`G‘IÂ”Text
();

192 if(
$ùag
->
	`G‘Name
()=='item')

194 
$f›ld
 = 
$ùag
->
	`G‘A‰
('field');

195 if(
$f›ld
 == '')

199 
$this
->
¬tNÙes
[
$f›ld
]['v®ue'] = 
$ùag
->
	`G‘A‰
('value');

200 
$this
->
¬tNÙes
[
$f›ld
]['isun™'] = 
$ùag
->
	`G‘A‰
('isunit');

201 
$this
->
¬tNÙes
[
$f›ld
]['isdown'] = 
$ùag
->
	`G‘A‰
('isdown');

202 
$this
->
¬tNÙes
[
$f›ld
]['Œim'] = 
	`¬¿y
();

203 
$this
->
¬tNÙes
[
$f›ld
]['match'] = '';

204 
$this
->
¬tNÙes
[
$f›ld
]['function'] = '';

205 
$t
 = 0;

206 
$d2
->
	`LßdSŒšg
(
$ùag
->
	`G‘IÂ”Text
());

207 
$k
=0; $k<=
$d2
->
CouÁ
; $k++)

209 
$ùag2
 = 
$d2
->
CTags
[
$k
];

210 if(
$ùag2
->
	`G‘Name
()=='trim')

212 
$this
->
¬tNÙes
[
$f›ld
]['Œim'][
$t
][0] = 
	`¡r_»¶aû
('#n#','&nb¥;',
$ùag2
->
	`G‘IÂ”Text
());

213 
$this
->
¬tNÙes
[
$f›ld
]['Œim'][
$t
][1] = 
$ùag2
->
	`G‘A‰
('replace');

214 
$t
++;

216 if(
$ùag2
->
	`G‘Name
()=='match')

218 
$this
->
¬tNÙes
[
$f›ld
]['m©ch'] = 
	`¡r_»¶aû
('#n#','&nb¥;',
$ùag2
->
	`G‘IÂ”Text
());

220 if(
$ùag2
->
	`G‘Name
()=='function')

222 
$this
->
¬tNÙes
[
$f›ld
]['funùiÚ'] = 
$ùag2
->
	`G‘IÂ”Text
();

228 
$d
->
	`CË¬
();

229 
$d2
->
	`CË¬
();

230 
	}
}

242 
funùiÚ
 
DownU¾
(
$aid
, 
$dou¾
, 
$l™pic
='', 
$is§ve
=
TRUE
)

244 
$this
->
tmpLšks
 = 
¬¿y
();

245 
	g$this
->
	gtmpUn™V®ue
 = '';

246 
	g$this
->
	gb»Image
 = '';

247 
	g$this
->
	gtmpHtml
 = 
$this
->
DownOÃPage
(
$dou¾
);

250 if(!
em±y
(
$this
->
¬tNÙes
['sppage']))

252 
	g$nÙeid
 = '';

253 
fÜ—ch
(
$this
->
¬tNÙes
 
as
 
$k
=>
$§¼
)

255 if(
is£t
(
$§¼
['isunit']) && $sarr['isunit']==1)

257 
$nÙeid
 = 
$k
;

262 
	g$this
->
G‘SpPage
(
$dou¾
, 
$nÙeid
, 
$this
->
tmpHtml
);

264 if(
´eg_m©ch
("/#p#/i", 
$this
->
tmpUn™V®ue
))

266 ià(
	g$this
->
	g¬tNÙes
["sptype"] != 'diyrule')

268 
$this
->
tmpUn™V®ue
 = 'å‰¯æ ‡é¢˜#e#'.$this->tmpUnitValue;

274 
	g$body
 = 
$this
->
G‘PageF›lds
(
$dou¾
, 
$is§ve
, 
$l™pic
);

277 if(
	g$is§ve
)

279 
	g$qu”y
 = " UPDATE `#@__co_htmls` SET dtime='".
time
()."',»suÉ='".
add¦ashes
(
$body
)."',isdown='1' WHERE‡id='$aid' ";

280 if(!
	g$this
->
	gdsql
->
Execu‹NÚeQu”y
(
$qu”y
))

282 
echo
 
	g$this
->
	gdsql
->
G‘E¼Ü
();

284  
	g$body
;

286  
	g$body
;

290 
funùiÚ
 
	$G‘U¾
(
$uri
)

292 
$¬r
 = 
$tmp
 = 
	`¬¿y
();

295 
$x
 = 
	`¬¿y_·d
Ğ
	`ex¶ode
Ğ'?', 
$uri
 ), 2, 
çl£
 );

296 
$¬r
['qu”y'] = ( 
$x
[1] )? $x[1] : '' ;

299 
$x
 = 
	`¬¿y_·d
Ğ
	`ex¶ode
Ğ'/', $x[0] ), 2, 
çl£
 );

300 
$x_Ï¡
 = 
	`¬¿y_pİ
Ğ
$x
 );

301 ifĞ
	`¡½os
Ğ
$x_Ï¡
, '.' ) ==ğ
çl£
 )

303 
$¬r
['resource'] = '';

304 
$x
[] = 
$x_Ï¡
;

308 
$¬r
['»sourû'] = 
$x_Ï¡
;

309 
$tmp
 = @
	`ex¶ode
('.', 
$¬r
['resource']);

310 
$¬r
['fe'] = @
$tmp
[0];

311 
$¬r
['ext'] = '.'.@
$tmp
[1];

315 
$¬r
['·th'] = 
	`im¶ode
Ğ'/', 
$x
 );

316 ifĞ
	`sub¡r
Ğ
$¬r
['path'], -1 ) !== '/' ) $arr['path'] .= '/';

319 
$¬r
['u¾'] = 
$uri
;

321  
$¬r
;

322 
	}
}

334 
funùiÚ
 
	$G‘SpPage
(
$dou¾
, 
$nÙeid
, 
$html
, 
$¡•
=0)

336 
$§¼
 = 
$this
->
¬tNÙes
[
$nÙeid
];

338 
$lšk¬—Html
 = 
$this
->
	`G‘HtmlA»a
('[å†…å®¹]', $this->
¬tNÙes
['¥·ge'], 
$html
);

339 if(
$lšk¬—Html
=='')

341 if(
$this
->
tmpUn™V®ue
=='')

343 
$this
->
tmpUn™V®ue
 .ğ$this->
	`G‘HtmlA»a
('[å†…å®¹]', 
$§¼
['m©ch'], 
$html
);

347 
$this
->
tmpUn™V®ue
 .ğ"#p#å‰¯æ ‡é¢˜#e#".$this->
	`G‘HtmlA»a
('[å†…å®¹]', 
$§¼
['m©ch'], 
$html
);

349 ià(
$this
->
¬tNÙes
["sptype"] != 'diyrule') ;

355 if(
$this
->
¬tNÙes
["sptype"]=='full' || $this->artNotes["sptype"]=='')

357 
$this
->
tmpUn™V®ue
 .ğ$this->
	`G‘HtmlA»a
('[å†…å®¹]', 
$§¼
['m©ch'], 
$html
);

358 
$this
->
cXakHtml
->
G‘LškTy³
 = "link";

359 
$this
->
cXakHtml
->
	`S‘Sourû
(
$lšk¬—Html
, 
$dou¾
, 'link');

360 
	`fÜ—ch
(
$this
->
cXakHtml
->
Lšks
 
as
 
$k
=>
$t
)

362 
$k
 = 
$this
->
cXakHtml
->
	`FlU¾
($k);

363 if(
$k
==
$dou¾
)

367 
$nhtml
 = 
$this
->
	`DownOÃPage
(
$k
);

368 if(
$nhtml
!='')

370 
$ù
 = 
	`Œim
(
$this
->
	`G‘HtmlA»a
('[å†…å®¹]', 
$§¼
['m©ch'], 
$nhtml
));

371 if(
$ù
!='')

373 
$this
->
tmpUn™V®ue
 .ğ"#p#å‰¯æ ‡é¢˜#e#".
$ù
;

378 ià(
$this
->
¬tNÙes
["sptype"] == 'diyrule')

380 
$max·ge
 = 10;

381 
$u¾šfo
 = 
$this
->
	`G‘U¾
(
$dou¾
);

382 
$‹¡u¾
 = 
	`¡r_»¶aû
(
	`¬¿y_keys
(
$u¾šfo
), 
	`¬¿y_v®ues
($u¾šfo), 
$this
->
¬tNÙes
['sppage']);

383 
$‹¡u¾
 = 
	`¡r_œ•Ïû
('{p}', '~p~', $testurl);

384 
$‹¡u¾
 = 
	`¡r_»¶aû
(
	`¬¿y
('{', '}'), '', $testurl);

385 
$Ï¡chash
 = 
	`md5
(
$html
);

386 
$i
=
$this
->
¥NÙes
['srul']; $i <= $this->spNotes['erul']; $i++)

388 
$‹mpu¾
 = 
	`¡r_»¶aû
('~p~', 
$i
, 
$‹¡u¾
);

389 
$‹mpu¾
 = 
$this
->
cXakHtml
->
	`FlU¾
($tempurl);

391 
$nhtml
 = 
$this
->
	`DownOÃPage
(
$‹mpu¾
);

392 
$Ãwchash
 = 
	`md5
(
$nhtml
);

393 ià(
$Ãwchash
 =ğ
$Ï¡chash
) ;

394 
$Ï¡chash
 = 
$Ãwchash
;

396 if(
$nhtml
!='')

398 
$ù
 = 
	`Œim
(
$this
->
	`G‘HtmlA»a
('[å†…å®¹]', 
$§¼
['m©ch'], 
$nhtml
));

399 if(
$ù
!='')

401 
$this
->
tmpUn™V®ue
 .ğ"#p#å‰¯æ ‡é¢˜#e#".
$ù
;

410 if(
$¡•
>50)

414 if(
$¡•
==0)

416 
$this
->
tmpUn™V®ue
 .ğ$this->
	`G‘HtmlA»a
('[å†…å®¹]', 
$§¼
['m©ch'], 
$html
);

418 
$this
->
cXakHtml
->
G‘LškTy³
 = "link";

419 
$this
->
cXakHtml
->
	`S‘Sourû
(
$lšk¬—Html
, 
$dou¾
, 'link');

420 
$hasLšk
 = 
FALSE
;

421 
	`fÜ—ch
(
$this
->
cXakHtml
->
Lšks
 
as
 
$k
=>
$t
)

423 
$k
 = 
$this
->
cXakHtml
->
	`FlU¾
($k);

424 if(
	`š_¬¿y
(
$k
, 
$this
->
tmpLšks
))

426 
CONTINUE
;

429 
$nhtml
 = 
$this
->
	`DownOÃPage
(
$k
);

430 if(
$nhtml
!='')

432 
$ù
 = 
	`Œim
(
$this
->
	`G‘HtmlA»a
('[å†…å®¹]',
$§¼
['m©ch'],
$nhtml
));

433 if(
$ù
!='')

435 
$this
->
tmpUn™V®ue
 .ğ"#p#å‰¯æ ‡é¢˜#e#".
$ù
;

438 
$hasLšk
 = 
TRUE
;

439 
$this
->
tmpLšks
[] = 
$k
;

440 
$dou¾
 = 
$k
;

441 
$¡•
++;

444 if(
$hasLšk
)

446 
$this
->
	`G‘SpPage
(
$dou¾
, 
$nÙeid
, 
$nhtml
, 
$¡•
);

449 
	}
}

460 
funùiÚ
 
	$G‘HtmlA»a
(
$¥g
, &
$¬—RuË
, &
$html
)

463 if(
$this
->
nÙeInfos
['matchtype']=='regex')

465 
$¬—RuË
 = 
	`¡r_»¶aû
("/", "\\/", $areaRule);

466 
$¬—RuËs
 = 
	`ex¶ode
(
$¥g
, 
$¬—RuË
);

467 
$¬r
 = 
	`¬¿y
();

468 if(
$html
==''||
$¬—RuËs
[0]=='')

472 
	`´eg_m©ch
('#'.
$¬—RuËs
[0]."(.*)".$¬—RuËs[1]."#isU", 
$html
, 
$¬r
);

473  
	`em±y
(
$¬r
[1]è? '' : 
	`Œim
($arr[1]);

479 
$¬—RuËs
 = 
	`ex¶ode
(
$¥g
,
$¬—RuË
);

480 if(
$html
=='' || 
$¬—RuËs
[0]=='')

484 
$pos¡¬t
 = @
	`¡½os
(
$html
,
$¬—RuËs
[0]);

485 if(
$pos¡¬t
===
FALSE
)

489 
$pos¡¬t
 = $pos¡¬ˆ+ 
	`¡¾’
(
$¬—RuËs
[0]);

490 
$po£nd
 = @
	`¡½os
(
$html
,
$¬—RuËs
[1],
$pos¡¬t
);

491 if(
$po£nd
 > 
$pos¡¬t
 && $po£nd!==
FALSE
)

494  
	`sub¡r
(
$html
,
$pos¡¬t
,
$po£nd
-$posstart);

501 
	}
}

509 
funùiÚ
 
	$DownOÃPage
(
$dou¾
)

511 
$this
->
cH‰pDown
->
	`O³nU¾
(
$dou¾
);

512 
$html
 = 
$this
->
cH‰pDown
->
	`G‘Html
();

513 
$this
->
cH‰pDown
->
	`Clo£
();

514 
$this
->
	`ChªgeCode
(
$html
);

515  
$html
;

516 
	}
}

527 
funùiÚ
 
DownMedŸ
(
$dou¾
, 
$mty³
='img', 
$i¦™pic
=
FALSE
)

529 
glob®
 
$nÙckpic
;

530 if(
em±y
(
$nÙckpic
))

532 
	g$nÙckpic
 = 0;

536 
	g$wi
 = 
FALSE
;

537 
	g$tofe
 = 
$f’ame
 = '';

538 if(
	g$nÙckpic
==0)

540 
$row
 = 
$this
->
dsql
->
G‘OÃ
("SELECT hash,tofFROM `#@__co_medŸu¾s` WHERE‚id='{$this->nÙeId}' AND hash='".
md5
(
$dou¾
)."' ");

541 if(
is£t
(
$row
['tofile']))

543 
	g$tofe
 = 
$f’ame
 = 
$row
['tofile'];

548 if(
	g$tofe
=='' || !
fe_exi¡s
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
))

550 
$f’ame
 = 
$this
->
G‘RndName
(
$dou¾
,
$mty³
);

551 if(!
´eg_m©ch
("#^\/#", 
$f’ame
))

553 
	g$f’ame
 = "/".
$f’ame
;

557 if(
	g$this
->
	gnÙeInfos
['i¤ef']=='yes' && 
$this
->
nÙeInfos
['refurl']!='')

559 if(
$this
->
nÙeInfos
['exptime']=='')

561 
$this
->
nÙeInfos
['exptime'] = 10;

563 
DownImageK“p
(
$dou¾
,
$this
->
nÙeInfos
['»fu¾'],
$GLOBALS
['cfg_ba£dœ'].
$f’ame
,'',0,$this->
I‹m
['exptime']);

569 
	g$this
->
	gcH‰pDown
->
O³nU¾
(
$dou¾
);

570 
	g$this
->
	gcH‰pDown
->
SaveToBš
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
);

571 
	g$this
->
	gcH‰pDown
->
Clo£
();

575 if(
fe_exi¡s
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
))

577 if(
	g$tofe
=='')

579 
$qu”y
 = "INSERT INTO `#@__co_medŸu¾s`Òid,hash,tofeèVALUES ('".
$this
->
nÙeId
."', '".
md5
(
$dou¾
)."', '".
add¦ashes
(
$f’ame
)."');";

583 
	g$qu”y
 = "UPDATE `#@__co_medŸu¾s` SETofe='".
add¦ashes
(
$f’ame
)."' WHERE hash='".
md5
(
$dou¾
)."' ";

585 
	g$this
->
	gdsql
->
Execu‹NÚeQu”y
(
$qu”y
);

590 if(!
fe_exi¡s
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
))

592  
	g$dou¾
;

596 if(
	g$mty³
=='img' && !
$i¦™pic
 && 
$this
->
b»Image
=='')

598 
$this
->
b»Image
 = 
$f’ame
;

599 if(!
´eg_m©ch
("#^h‰p:\/\/#", 
$this
->
b»Image
è&& 
fe_exi¡s
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
))

601 
	g$f’ames
 = 
ex¶ode
('/',
$f’ame
);

602 
	g$f’amed
 = 
$f’ames
[
couÁ
($filenames)-1];

603 
	g$nf’ame
 = 
¡r_»¶aû
('.','_l™.',
$f’amed
);

604 
	g$nf’ame
 = 
¡r_»¶aû
(
$f’amed
,
$nf’ame
,
$f’ame
);

605 if(@
cİy
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
, $GLOBALS['cfg_ba£dœ'].
$nf’ame
))

607 
ImageResize
(
$GLOBALS
['cfg_ba£dœ'].
$nf’ame
,$GLOBALS['cfg_ddimg_width'],$GLOBALS['cfg_ddimg_height']);

608 
	g$this
->
	gb»Image
 = 
$nf’ame
;

612 if(
	g$mty³
=='img' && !
$i¦™pic
)

614 @
W©”Img
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
,'collect');

616  
	g$f’ame
;

627 
funùiÚ
 
	$G‘RndName
(
$u¾
, 
$v
)

629 
glob®
 
$cfg_image_dœ
,
$cfg_dœ_purv›w
;

630 
$this
->
medŸCouÁ
++;

631 
$mnum
 = 
$this
->
medŸCouÁ
;

632 
$timedœ
 = "c".
	`MyD©e
("ymd",
	`time
());

634 
$fuÎu¾
 = 
	`´eg_»¶aû
("#\/{1,}#", "/", 
$cfg_image_dœ
."/");

635 if(!
	`is_dœ
(
$GLOBALS
['cfg_basedir']."/$fullurl"))

637 
	`MkdœAÎ
(
$GLOBALS
['cfg_ba£dœ']."/$fuÎu¾", 
$cfg_dœ_purv›w
);

640 
$fuÎu¾
 = $fuÎu¾.
$timedœ
."/";

641 if(!
	`is_dœ
(
$GLOBALS
['cfg_basedir']."/$fullurl"))

643 
	`MkdœAÎ
(
$GLOBALS
['cfg_ba£dœ']."/$fuÎu¾", 
$cfg_dœ_purv›w
);

647 
$tim’ame
 = 
	`¡r_»¶aû
('.','', 
	`ExecTime
());

648 
$th»adnum
 = 0;

649 if(
	`is£t
(
$_GET
['threadnum']))

651 
$th»adnum
 = 
	`štv®
(
$_GET
['threadnum']);

653 
$f’ame
 = 
	`dd2ch¬
(
$tim’ame
.
$th»adnum
.'-'.
$mnum
.
	`mt_¿nd
(1000,9999));

656 
$u¾s
 = 
	`ex¶ode
('.',
$u¾
);

657 if(
$v
=='img')

659 
$shÜŠame
 = '.jpg';

660 if(
	`´eg_m©ch
("#\.gif$#i", 
$u¾
))

662 
$shÜŠame
 = '.gif';

664 if(
	`´eg_m©ch
("#\.²g$#i", 
$u¾
))

666 
$shÜŠame
 = '.png';

669 if(
$v
=='embed')

671 
$shÜŠame
 = '.swf';

675 
$shÜŠame
 = '';

677 
$fuÎÇme
 = 
$fuÎu¾
.
$f’ame
.
$shÜŠame
;

678  
	`´eg_»¶aû
("#\/{1,}#", "/", 
$fuÎÇme
);

679 
	}
}

690 
funùiÚ
 
G‘PageF›lds
(
$dou¾
, 
$ÃedDown
, 
$l™pic
='')

692 
glob®
 
$cfg_auÙ_desütiÚ
;

693 if(
	g$this
->
	gtmpHtml
 == '')

697 
	g$¬t™em
 = '';

698 
	g$isPutUn™
 = 
FALSE
;

699 
	g$tmpLtKeys
 = 
¬¿y
();

700 
	g$š¬r
 = 
¬¿y
();

703 
´eg_m©ch
("#<m‘a[\s]+Çme=['\"]keywÜds['\"] cÚ‹Á=['\"](.*)['\"]#isU", 
$this
->
tmpHtml
, 
$š¬r
);

704 
´eg_m©ch
("#<m‘a[\s]+cÚ‹Á=['\"](.*)['\"]‚ame=['\"]keywÜds['\"]#isU", 
$this
->
tmpHtml
, 
$š¬r2
);

705 if(!
is£t
(
$š¬r
[1]è&& is£t(
$š¬r2
[1]))

707 
	g$š¬r
[1] = 
$š¬r2
[1];

709 if(
is£t
(
$š¬r
[1]))

711 
	g$keywÜds
 = 
Œim
(
ú_sub¡r
(
html2‹xt
(
$š¬r
[1]),30));

712 
	g$keywÜds
 = 
´eg_»¶aû
("#".
$this
->
¬tNÙes
['keywÜdŒim']."#isU",'',
$keywÜds
);

713 if(!
´eg_m©ch
("#,#", 
$keywÜds
))

715 
	g$keywÜds
 = 
¡r_»¶aû
(' ', ',', 
$keywÜds
);

717 
	g$¬t™em
 .ğ"{xak:f›ld‚ame='keywÜds'}".
$keywÜds
."{/xak:field}\r\n";

721 
	g$¬t™em
 .= "{xak:field‚ame='keywords'}{/xak:field}\r\n";

725 
´eg_m©ch
("#<m‘a[\s]+Çme=['\"]desütiÚ['\"][\s]+cÚ‹Á=['\"]([^>]*?)['\"]#iU", 
$this
->
tmpHtml
, 
$š¬r
);

726 
´eg_m©ch
("#<m‘a[\s]+cÚ‹Á=['\"]([^>]*?)['\"][\s]+Çme=['\"]desütiÚ['\"]#iU", 
$this
->
tmpHtml
, 
$š¬r2
);

727 if(!
is£t
(
$š¬r
[1]è&& is£t(
$š¬r2
[1]))

729 
	g$š¬r
[1] = 
$š¬r2
[1];

731 if(
is£t
(
$š¬r
[1]))

733 
	g$desütiÚ
 = 
Œim
(
ú_sub¡r
(
html2‹xt
(
$š¬r
[1]),
$cfg_auÙ_desütiÚ
));

734 
	g$desütiÚ
 = 
´eg_»¶aû
("/".
$this
->
¬tNÙes
['desütiÚŒim']."/isU",'',
$desütiÚ
);

735 
	g$¬t™em
 .ğ"{xak:f›ld‚ame='desütiÚ'}".
$desütiÚ
."{/xak:field}\r\n";

739 
	g$¬t™em
 .= "{xak:field‚ame='description'}{/xak:field}\r\n";

742 
fÜ—ch
(
$this
->
¬tNÙes
 
as
 
$k
=>
$§¼
)

745 if(
$k
=='sppage' || $k=='sptype')

749 if(!
is_¬¿y
(
$§¼
))

755 if(
	g$§¼
['m©ch']=='' || 
Œim
(
$§¼
['match'])=='[å†…å®¹]')

757 if(
$§¼
['value']!='[å†…å®¹]')

759 
$v
 = 
Œim
(
$§¼
['value']);

763 
	g$v
 = '';

769 if(
	g$this
->
	gtmpUn™V®ue
!='' && !
$isPutUn™
 && 
$§¼
['isunit']==1)

771 
$v
 = 
$this
->
tmpUn™V®ue
;

772 
	g$isPutUn™
 = 
TRUE
;

776 
	g$v
 = 
$this
->
G‘HtmlA»a
('[å†…å®¹]',
$§¼
['m©ch'],$this->
tmpHtml
);

780 if(
is£t
(
$§¼
['Œim']è&& 
	g$v
!='')

782 
fÜ—ch
(
$§¼
['Œim'] 
as
 
$nv
)

784 if(
$nv
[0]=='')

788 
	g$nvs
 = 
¡r_»¶aû
("/", "\\/", 
$nv
[0]);

789 
	g$v
 = 
´eg_»¶aû
("#".
$nvs
."#isU", 
$nv
[1], 
$v
);

794 if(
	g$ÃedDown
)

796 if(
	g$§¼
['isdown'] == '1')

798 
$v
 = 
$this
->
DownMedŸs
($v, 
$dou¾
);

803 if(
	g$§¼
['isdown'] == '1')

805 
$v
 = 
$this
->
MedŸsR•Ïû
($v, 
$dou¾
);

809 
	g$v
 = 
Œim
(
$v
);

812 if(
	g$§¼
['function'] != '')

814 
$tmpLtKeys
[
$k
]['v'] = 
$v
;

815 
	g$tmpLtKeys
[
$k
]['f'] = 
$§¼
['function'];

819 
	g$v
 = 
´eg_»¶aû
("#(ã€€)$#", '', 
$v
);

820 
	g$v
 = 
´eg_»¶aû
("#[\r\n\ˆ]{1,}$#", '', 
$v
);

821 
	g$¬t™em
 .= "{xak:field‚ame='$k'}$v{/xak:field}\r\n";

826 
fÜ—ch
(
$tmpLtKeys
 
as
 
$k
=>
$§¼
)

828 
$v
 = 
$this
->
RunPHP
(
$§¼
['v'],$sarr['f']);

829 
	g$v
 = 
´eg_»¶aû
("#(ã€€)$#", '', 
$v
);

830 
	g$v
 = 
´eg_»¶aû
("#[\r\n\ˆ]{1,}$#", '', 
$v
);

831 
	g$¬t™em
 .= "{xak:field‚ame='$k'}$v{/xak:field}\r\n";

833 if(
	g$l™pic
!='' && 
$this
->
li¡s
['listpic']==1)

835 
$¬t™em
 .ğ"{xak:f›ld‚ame='l™pic'}".
$this
->
DownMedŸ
(
$l™pic
,'img',
TRUE
)."{/xak:field}\r\n";

839 
	g$¬t™em
 .ğ"{xak:f›ld‚ame='l™pic'}".
$this
->
b»Image
."{/xak:field}\r\n";

841  
	g$¬t™em
;

852 
funùiÚ
 
	$DownMedŸs
(&
$html
, 
$u¾
)

854 
$this
->
cXakHtml
->
	`S‘Sourû
(
$html
,
$u¾
,'media');

857 
	`fÜ—ch
(
$this
->
cXakHtml
->
MedŸs
 
as
 
$k
=>
$v
)

859 
$fu¾
 = 
$this
->
cXakHtml
->
	`FlU¾
(
$k
);

860 if(
$v
=='embed' && !
	`´eg_m©ch
("#\.(swf)\?(.*)$#i", 
$k
)&& !preg_match("#\.(swf)$#i", $k))

864 
$oku¾
 = 
$this
->
	`DownMedŸ
(
$fu¾
, 
$v
);

865 
$html
 = 
	`¡r_»¶aû
(
$k
, 
$oku¾
, $html);

869 
	`fÜ—ch
(
$this
->
cXakHtml
->
Lšks
 
as
 
$v
=>
$k
)

871 if(
	`´eg_m©ch
("#\.(jpg|gif|²g)\?(.*)$#i",
$v
) ||…reg_match("#\.(jpg|gif|png)$#i", $v))

873 
$m
 = "img";

875 if(
	`´eg_m©ch
("#\.(swf)\?(.*)$#i", 
$v
) ||…reg_match("#\.(swf)$#i", $v))

877 
$m
 = "embed";

883 
$fu¾
 = 
$this
->
cXakHtml
->
	`FlU¾
(
$v
);

884 
$oku¾
 = 
$this
->
	`DownMedŸ
(
$fu¾
, 
$m
);

885 
$html
 = 
	`¡r_»¶aû
(
$v
, 
$oku¾
, $html);

887  
$html
;

888 
	}
}

898 
funùiÚ
 
	$MedŸsR•Ïû
(&
$html
, 
$dou¾
)

900 
$this
->
cXakHtml
->
	`S‘Sourû
(
$html
, 
$dou¾
, 'media');

901 
	`fÜ—ch
(
$this
->
cXakHtml
->
MedŸs
 
as
 
$k
=>
$v
)

903 
$k
 = 
	`Œim
($k);

904 
$oku¾
 = 
$this
->
cXakHtml
->
	`FlU¾
(
$k
);

905 
$html
 = 
	`¡r_»¶aû
(
$k
, 
$oku¾
, $html);

907  
$html
;

908 
	}
}

911 
funùiÚ
 
	$Te¡li¡s
(&
$dou¾
)

913 
$lšks
 = 
	`¬¿y
();

916 if(
$this
->
li¡s
['sourcetype']=='rss')

918 
$dou¾
 = 
$this
->
li¡s
['rssurl'];

919 
$lšks
 = 
	`G‘RssLšks
(
$dou¾
);

920  
$lšks
;

924 if(
	`is£t
(
$this
->
li¡s
['url'][0][0]))

926 
$dou¾
 = 
$this
->
li¡s
['url'][0][0];

930 
$dou¾
 = '';

931 
$this
->
”rSŒšg
 = "é…ç½®ä¸­æŒ‡å®šåˆ—è¡¨çš„ç½‘å€é”™è¯¯!\r\n";

932  
$lšks
;

934 
$dhtml
 = 
Ãw
 
	`XakHtml2
();

935 
$html
 = 
$this
->
	`DownOÃPage
(
$dou¾
);

936 if(
$html
=='')

938 
$this
->
”rSŒšg
 = "è¯»å–ç½‘å€ï¼š $dourl æ—¶å¤±è´¥ï¼\r\n";

939  
$lšks
;

941 ifĞ
	`Œim
(
$this
->
li¡s
['areastart']) !='' &&rim($this->lists['areaend']) != '' )

943 
$¬—body
 = 
$this
->
li¡s
['areastart'].'[var:åŒºåŸŸ]'.$this->lists['areaend'];

944 
$html
 = 
$this
->
	`G‘HtmlA»a
('[v¬:åŒºåŸŸ]',
$¬—body
,$html);

946 
$t1
 = 
	`ExecTime
();

947 
$dhtml
->
	`S‘Sourû
(
$html
,
$dou¾
,'link');

948 
$this
->
li¡s
['mu¡has'] = 
	`¡r_»¶aû
('/', '\/', $this->lists['musthas']);

949 
	`fÜ—ch
(
$dhtml
->
Lšks
 
as
 
$s
)

951 if(
$this
->
li¡s
['nothas']!='')

953 ifĞ
	`´eg_m©ch
("#".
$this
->
li¡s
['nÙhas']."#i", 
$s
['link']) )

958 if(
$this
->
li¡s
['musthas']!='')

960 ifĞ!
	`´eg_m©ch
("#".
$this
->
li¡s
['mu¡has']."#i", 
$s
['link']) )

965 
$lšks
[] = 
$s
;

967  
$lšks
;

968 
	}
}

977 
funùiÚ
 
	$Te¡A¹
(
$dou¾
)

979  
$this
->
	`DownU¾
(0, 
$dou¾
, '', 
FALSE
);

980 
	}
}

991 
funùiÚ
 
	$G‘SourûU¾
(
$i¦i¡’
=0, 
$gl¡¬t
=0, 
$·gesize
=10)

995 if(
$gl¡¬t
==0)

998 if(
$i¦i¡’
 == -1)

1000 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__co_u¾s` WHERE‚id='".$this->
nÙeId
."'");

1001 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__co_htmls` WHERE‚id='".$this->
nÙeId
."' ");

1006 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__co_htmls` WHERE‚id='".$this->
nÙeId
."' AND isexport=1 ");

1011 if(
$this
->
li¡s
['sourcetype']=='rss')

1013 
$lšks
 = 
	`G‘RssLšks
(
$this
->
li¡s
['rssurl']);

1015 
$tm¶šk
 = 
	`krsÜt
(
$lšks
);

1016 
$lk
 = 0;

1017 
	`fÜ—ch
(
$lšks
 
as
 
$v
)

1019 if(
$i¦i¡’
==1)

1021 
$Ìow
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__co_u¾s` WHERE‚id='{$this->nÙeId}' AND hash='".
	`md5
(
$v
['link'])."' ");

1022 if(
	`is_¬¿y
(
$Ìow
))

1027 
$lk
++;

1028 if(
$mytÙ®
 > 0 && 
$lk
 >= $mytotal) ;

1029 
$šqu”y
 = "INSERT INTO `#@__co_htmls` (`nid` ,`typeid`, `title` , `litpic` , `url` , `dtime` , `isdown` , `isexport` , `result`)

1030 
	`VALUES
 ('{$this->nÙeId}' , '0', '".add¦ashes($v['
t™Ë
'])."' , '".add¦ashes($v['
image
'])."' , '".add¦ashes($v['
lšk
'])."' , 'dtime' , '0' , '0' , ''); ";

1031 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

1033 
$šqu”y
 = "INSERT INTO `#@__co_u¾s`(hash,nidèVALUES ('".
	`md5
(
$v
['link'])."','{$this->noteId}');";

1034 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

1040 
$tm¶šk
 = 
	`¬¿y
();

1041 
$¬rS¹
 = 0;

1042 
$mov›Po¡iÚ
 = 0;

1043 
$’dpos
 = 
$gl¡¬t
 + 
$·gesize
;

1044 
$tÙ®Ën
 = 
	`couÁ
(
$this
->
li¡s
['url']);

1046 
	`fÜ—ch
(
$this
->
li¡s
['u¾'] 
as
 
$k
=>
$curu¾s
)

1049 
$u¾num
 = 0;

1050 
$curu¾
 = 
$curu¾s
[0];

1051 
$ty³id
 = (
	`em±y
(
$curu¾s
[1]) ? 0 : $cururls[1]);

1052 
$mov›Po¡iÚ
++;

1054 if(
$mov›Po¡iÚ
 > 
$’dpos
)

1058 if(
$mov›Po¡iÚ
 > 
$gl¡¬t
)

1060 
$html
 = 
$this
->
	`DownOÃPage
(
$curu¾
);

1061 ifĞ
	`Œim
(
$this
->
li¡s
['areastart']) !='' &&rim($this->lists['areaend']) != '' )

1063 
$¬—body
 = 
$this
->
li¡s
['areastart'].'[var:åŒºåŸŸ]'.$this->lists['areaend'];

1064 
$html
 = 
$this
->
	`G‘HtmlA»a
('[v¬:åŒºåŸŸ]',
$¬—body
,$html);

1066 
$this
->
cXakHtml
->
	`S‘Sourû
(
$html
, 
$curu¾
, 'link');

1067 
$lk
 = 0;

1068 
	`fÜ—ch
(
$this
->
cXakHtml
->
Lšks
 
as
 
$k
=>
$v
)

1070 if(
$this
->
li¡s
['nothas']!='')

1072 ifĞ
	`´eg_m©ch
("#".
$this
->
li¡s
['nÙhas']."#", 
$v
['link']) )

1077 if(
$this
->
li¡s
['musthas']!='')

1079 ifĞ!
	`´eg_m©ch
("#".
$this
->
li¡s
['mu¡has']."#i", 
$v
['link']) )

1084 
$tm¶šk
[
$¬rS¹
][0] = 
$v
;

1085 
$tm¶šk
[
$¬rS¹
][1] = 
$ty³id
;

1086 
$¬rS¹
++;

1087 
$lk
++;

1089 
$this
->
cXakHtml
->
	`CË¬
();

1094 
	`krsÜt
(
$tm¶šk
);

1095 
$unum
 = 
	`couÁ
(
$tm¶šk
);

1096 if(
$unum
>0)

1099 
	`fÜ—ch
(
$tm¶šk
 
as
 
$vs
)

1101 
$v
 = 
$vs
[0];

1102 
$ty³id
 = 
$vs
[1];

1103 if(
$i¦i¡’
==1)

1105 
$Ìow
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__co_u¾s` WHERE‚id='{$this->nÙeId}' AND hash='".
	`md5
(
$v
['link'])."' ");

1106 if(
	`is_¬¿y
(
$Ìow
))

1111 
$šqu”y
 = "INSERT INTO `#@__co_htmls` (`nid` ,`typeid`, `title` , `litpic` , `url` , `dtime` , `isdown` , `isexport` , `result`)

1112 
	`VALUES
 ('{$this->nÙeId}' ,'$ty³id', '".add¦ashes($v['
t™Ë
'])."' , '".add¦ashes($v['
image
'])."' , '".add¦ashes($v['
lšk
'])."' , '".time()."' , '0' , '0' , ''); ";

1113 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

1115 
$šqu”y
 = "INSERT INTO `#@__co_u¾s`(hash,nidèVALUES ('".
	`md5
(
$v
['link'])."','{$this->noteId}');";

1116 
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

1118 if(
$’dpos
 >ğ
$tÙ®Ën
)

1124  (
$tÙ®Ën
-
$’dpos
);

1130 if(
$gl¡¬t
==0)

1136 if(
$’dpos
 >ğ
$tÙ®Ën
)

1142  (
$tÙ®Ën
-
$’dpos
);

1146 
	}
}

1156 
funùiÚ
 
	$RunPHP
(
$fv®ue
, 
$phpcode
)

1158 
$XakMeV®ue
 = 
$fv®ue
;

1159 
$phpcode
 = 
	`´eg_»¶aû
("#'@me'|\"@me\"|@me#isU", '$XakMeValue', $phpcode);

1160 if(
	`´eg_m©ch
("#@body#i", 
$phpcode
))

1162 
$XakBodyV®ue
 = 
$this
->
tmpHtml
;

1163 
$phpcode
 = 
	`´eg_»¶aû
("#'@body'|\"@body\"|@body#isU", '$XakBodyValue', $phpcode);

1165 if(
	`´eg_m©ch
("#@l™pic#i", 
$phpcode
))

1167 
$XakL™PicV®ue
 = 
$this
->
b»Image
;

1168 
$phpcode
 = 
	`´eg_»¶aû
("#'@litpic'|\"@litpic\"|@litpic#isU", '$XakLitPicValue', $phpcode);

1170 
	`ev®
(
$phpcode
.";");

1171  
$XakMeV®ue
;

1172 
	}
}

1181 
funùiÚ
 
	$ChªgeCode
(&
$¡r
)

1183 
glob®
 
$cfg_soá_Ïng
;

1184 if(
$cfg_soá_Ïng
=='utf-8')

1186 if(
$this
->
nÙeInfos
["sourcelang"]=="gb2312")

1188 
$¡r
 = 
	`gb2utf8
($str);

1190 if(
$this
->
nÙeInfos
["sourcelang"]=="big5")

1192 
$¡r
 = 
	`gb2utf8
(
	`big52gb
($str));

1197 if(
$this
->
nÙeInfos
["sourcelang"]=="utf-8")

1199 
$¡r
 = 
	`utf82gb
($str);

1201 if(
$this
->
nÙeInfos
["sourcelang"]=="big5")

1203 
$¡r
 = 
	`big52gb
($str);

1206 
	}
}

	@E:\web\weixun\functions\xakcollection.func.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

9 
»quœe_Úû
(
XAKINC
."/xakhttpdown.class.php");

10 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

11 
»quœe_Úû
(
XAKINC
."/charset.func.php");

26 
funùiÚ
 
DownImageK“p
(
$gu¾
, 
$rfu¾
, 
$f’ame
, 
$gcook›
="", 
$JumpCouÁ
=0, 
$maxtime
=30)

28 
$u¾šfos
 = 
G‘Ho¡Info
(
$gu¾
);

29 
	g$gho¡
 = 
Œim
(
$u¾šfos
['host']);

30 if(
	g$gho¡
=='')

32  
FALSE
;

34 
	g$gqu”y
 = 
$u¾šfos
['query'];

35 if(
	g$gcook›
=="" && !
em±y
(
$rfu¾
))

37 
$gcook›
 = 
Refu¾Cook›
(
$rfu¾
);

39 
	g$£ssiÚQu”y
 = "GET $gquery HTTP/1.1\r\n";

40 
	g$£ssiÚQu”y
 .= "Host: $ghost\r\n";

41 
	g$£ssiÚQu”y
 .= "Referer: $rfurl\r\n";

42 
	g$£ssiÚQu”y
 .= "Accept: */*\r\n";

43 
	g$£ssiÚQu”y
 .= "User-Agent: Mozilla/4.0 (compatible; MSIE 5.00; Windows 98)\r\n";

44 if(
	g$gcook›
!="" && !
´eg_m©ch
("/[\r\n]/", 
$gcook›
))

46 
	g$£ssiÚQu”y
 .ğ
$gcook›
."\r\n";

48 
	g$£ssiÚQu”y
 .= "Connection: Keep-Alive\r\n\r\n";

49 
	g$”ºo
 = "";

50 
	g$”r¡r
 = "";

51 
	g$m_å
 = 
fsockİ’
(
$gho¡
, 80, 
$”ºo
, 
$”r¡r
,10);

52 
fwr™e
(
$m_å
,
$£ssiÚQu”y
);

53 
	g$Êum
 = 0;

56 
	g$m_h‰ph—d
 = 
A¼ay
();

57 
	g$h‰p¡as
 = 
ex¶ode
(" ",
fg‘s
(
$m_å
,256));

58 
	g$m_h‰ph—d
["h‰p-ed™iÚ"] = 
Œim
(
$h‰p¡as
[0]);

59 
	g$m_h‰ph—d
["h‰p-¡©e"] = 
Œim
(
$h‰p¡as
[1]);

60 !
ãof
(
$m_å
))

62 
	g$lše
 = 
Œim
(
fg‘s
(
$m_å
,256));

63 if(
	g$lše
 =ğ"" || 
$Êum
>100)

67 
	g$hkey
 = "";

68 
	g$hv®ue
 = "";

69 
	g$v
 = 0;

70 
	g$i
=0; $i<
¡¾’
(
$lše
); $i++)

72 if(
	g$v
==1)

74 
$hv®ue
 .ğ
$lše
[
$i
];

76 if(
	g$lše
[
$i
]==":")

78 
$v
 = 1;

80 if(
	g$v
==0)

82 
$hkey
 .ğ
$lše
[
$i
];

85 
	g$hkey
 = 
Œim
(
$hkey
);

86 if(
	g$hkey
!="")

88 
$m_h‰ph—d
[
¡¹Şow”
(
$hkey
)] = 
Œim
(
$hv®ue
);

93 if(
´eg_m©ch
("/^3/", 
$m_h‰ph—d
["http-state"]))

95 if(
is£t
(
$m_h‰ph—d
["loÿtiÚ"]è&& 
	g$JumpCouÁ
<3)

97 
	g$JumpCouÁ
++;

98 
DownImageK“p
(
$gu¾
,
$rfu¾
,
$f’ame
,
$gcook›
,
$JumpCouÁ
);

102  
	gFALSE
;

105 if(!
´eg_m©ch
("/^2/", 
$m_h‰ph—d
["http-state"]))

107  
	gFALSE
;

109 if(!
is£t
(
$m_h‰ph—d
))

111  
	gFALSE
;

113 
	g$cÚ‹ÁL’gth
 = 
$m_h‰ph—d
['content-length'];

116 
	g$å
 = 
fİ’
(
$f’ame
,"w"è
Ü
 
d›
("å†™å…¥æ–‡ä»¶ï¼š{$filename} å¤±è´¥ï¼");

117 
	g$i
=0;

118 
	g$okd©a
 = "";

119 
	g$¡¬‰ime
 = 
time
();

120 !
ãof
(
$m_å
))

122 
	g$okd©a
 .ğ
fg‘c
(
$m_å
);

123 
	g$i
++;

126 if(
time
()-
	g$¡¬‰ime
>
	g$maxtime
)

132 if(
	g$i
 >ğ
$cÚ‹ÁL’gth
)

137 if(
	g$okd©a
!="")

139 
fwr™e
(
$å
,
$okd©a
);

141 
fşo£
(
$å
);

142 if(
	g$okd©a
=="")

144 @
uÆšk
(
$f’ame
);

145 
fşo£
(
$m_å
);

146  
	gFALSE
;

148 
fşo£
(
$m_å
);

149  
	gTRUE
;

159 
funùiÚ
 
	$Refu¾Cook›
(
$gu¾
)

161 
glob®
 
$gcook›
,
$Ï¡Rfu¾
;

162 
$gu¾
 = 
	`Œim
($gurl);

163 if(!
	`em±y
(
$gcook›
è&& 
$Ï¡Rfu¾
==
$gu¾
)

165  
$gcook›
;

169 
$Ï¡Rfu¾
=
$gu¾
;

171 if(
	`Œim
(
$gu¾
)=='')

175 
$u¾šfos
 = 
	`G‘Ho¡Info
(
$gu¾
);

176 
$gho¡
 = 
$u¾šfos
['host'];

177 
$gqu”y
 = 
$u¾šfos
['query'];

178 
$£ssiÚQu”y
 = "GET $gquery HTTP/1.1\r\n";

179 
$£ssiÚQu”y
 .= "Host: $ghost\r\n";

180 
$£ssiÚQu”y
 .= "Accept: */*\r\n";

181 
$£ssiÚQu”y
 .= "User-Agent: Mozilla/4.0 (compatible; MSIE 5.00; Windows 98)\r\n";

182 
$£ssiÚQu”y
 .= "Connection: Close\r\n\r\n";

183 
$”ºo
 = "";

184 
$”r¡r
 = "";

185 
$m_å
 = 
	`fsockİ’
(
$gho¡
, 80, 
$”ºo
, 
$”r¡r
,10è
Ü
 
	`d›
($ghost.'<br />');

186 
	`fwr™e
(
$m_å
,
$£ssiÚQu”y
);

187 
$Êum
 = 0;

190 
$gcook›
 = "";

191 !
	`ãof
(
$m_å
))

193 
$lše
 = 
	`Œim
(
	`fg‘s
(
$m_å
,256));

194 if(
$lše
 =ğ"" || 
$Êum
>100)

200 if(
	`´eg_m©ch
("/^cook›/i", 
$lše
))

202 
$gcook›
 = 
$lše
;

207 
	`fşo£
(
$m_å
);

208  
$gcook›
;

209 
	}
}

218 
funùiÚ
 
	$G‘Ho¡Info
(
$gu¾
)

220 
$gu¾
 = 
	`´eg_»¶aû
("/^h‰p:\/\//i", "", 
	`Œim
($gurl));

221 
$g¬r
['ho¡'] = 
	`´eg_»¶aû
("/\/(.*)$/i", "", 
$gu¾
);

222 
$g¬r
['qu”y'] = "/".
	`´eg_»¶aû
("/^([^\/]*)\//i", "", 
$gu¾
);

223  
$g¬r
;

224 
	}
}

233 
funùiÚ
 
	$TuºImageTag
(&
$body
)

235 
glob®
 
$cfg_®bum_width
,
$cfg_ddimg_width
;

236 if(
	`em±y
(
$cfg_®bum_width
))

238 
$cfg_®bum_width
 = 800;

240 if(
	`em±y
(
$cfg_ddimg_width
))

242 
$cfg_ddimg_width
 = 150;

244 
$·‰’
 = "/<\\s*img\\s.*?src\\s*=\\s*([\"\\'])?(?(1)(.*?)\\1|([^\\s\\>\"\\']+))/isx";

245 
	`´eg_m©ch_®l
(
$·‰’
,
$body
,
$images
);

246 
$»tuºA¼ay1
 = 
$images
[2];

247 
$»tuºA¼ay2
 = 
$images
[3];

248 
	`fÜ—ch
 ( 
$»tuºA¼ay1
 
as
 
$key
 => 
$v®ue
 )

250 ià(
$v®ue
)

252 
$‰x
 .ğ"{xak:img ddimg='$l™piúame'ext='å›¾ ".(
$key
+1)."'}".
$v®ue
."{/xak:img}"."\r\n";

256 
$‰x
 .ğ"{xak:img ddimg='$l™piúame'ext='å›¾ ".(
$key
+1)."'}".
$»tuºA¼ay2
[$key]."{/xak:img}"."\r\n";

259 
$‰x
 = "\r\n{xak:pagestyle maxwidth='{$cfg_album_width}' ddmaxwidth='{$cfg_ddimg_width}'„ow='3' col='3' value='2'/}\r\n{xak:comments}å›¾é›†ç±»å‹ä¼šé‡‡é›†æ—¶ç”Ÿæˆæ­¤é…ç½®æ˜¯æ­£å¸¸çš„ï¼Œä¸è¿‡å¦‚æœåé¢æ²¡æœ‰è·Ÿç€imgæ ‡è®°åˆ™è¡¨ç¤ºè§„åˆ™æ— æ•ˆ{/xak:comments}\r\n".$ttx;

260  
$‰x
;

261 
	}
}

270 
funùiÚ
 
	$TuºLškTag
(&
$body
)

272 
$‰x
 = '';

273 
$hªdid
 = 'æœåŠ¡å™¨';

274 
	`´eg_m©ch_®l
("/<¨h»f=['\"](.+?)['\"]([^>]+?)>(.+?)<\/a>/is",
$body
,
$m©ch
);

275 if(
	`is_¬¿y
(
$m©ch
[1]è&& 
	`couÁ
($match[1])>0)

277 
$i
=0;
	`is£t
(
$m©ch
[1][$i]);$i++)

279 
$£rv”Çme
 = (
	`is£t
(
$m©ch
[3][
$i
]è? 
	`¡r_»¶aû
("'","`",$m©ch[3][$i]è: 
$hªdid
.($i+1));

280 if(
	`´eg_m©ch
("/[<>]/", 
$£rv”Çme
è|| 
	`¡¾’
($servername)>40)

282 
$£rv”Çme
 = 
$hªdid
.(
$i
+1);

284 
$‰x
 .= "{xak:linkext='$servername'} {$match[1][$i]} {/xak:link}\r\n";

287  
$‰x
;

288 
	}
}

297 
funùiÚ
 
	$RpCd©a
(
$¡r
)

299 
$¡r
 = 
	`¡r_»¶aû
('<![CDATA[', '', $str);

300 
$¡r
 = 
	`¡r_»¶aû
(']]>', '', $str);

301  
$¡r
;

302 
	}
}

311 
funùiÚ
 
	$G‘RssLšks
(
$rssu¾
)

313 
glob®
 
$cfg_soá_Ïng
;

314 
$dhd
 = 
Ãw
 
	`XakH‰pDown
();

315 
$dhd
->
	`O³nU¾
(
$rssu¾
);

316 
$rsshtml
 = 
$dhd
->
	`G‘Html
();

319 
	`´eg_m©ch
("/’codšg=[\"']([^\"']*)[\"']/is",
$rsshtml
,
$šfos
);

320 if(
	`is£t
(
$šfos
[1]))

322 
$pcode
 = 
	`¡¹Şow”
(
	`Œim
(
$šfos
[1]));

326 
$pcode
 = 
	`¡¹Şow”
(
$cfg_soá_Ïng
);

328 if(
$cfg_soá_Ïng
=='gb2312')

330 if(
$pcode
=='utf-8')

332 
$rsshtml
 = 
	`utf82gb
($rsshtml);

334 if(
$pcode
=='big5')

336 
$rsshtml
 = 
	`big52gb
($rsshtml);

339 if(
$cfg_soá_Ïng
=='utf-8')

341 if(
$pcode
=='gbk'||$pcode=='gb2312')

343 
$rsshtml
 = 
	`gb2utf8
($rsshtml);

345 if(
$pcode
=='big5')

347 
$rsshtml
 = 
	`gb2utf8
(
	`big52gb
($rsshtml));

350 
$r§¼
 = 
	`¬¿y
();

351 
	`´eg_m©ch_®l
("/<™em(.*)<t™Ë>(.*)<\/t™Ë>/isU",
$rsshtml
,
$t™Ës
);

352 
	`´eg_m©ch_®l
("/<™em(.*)<lšk>(.*)<\/lšk>/isU",
$rsshtml
,
$lšks
);

353 
	`´eg_m©ch_®l
("/<™em(.*)<desütiÚ>(.*)<\/desütiÚ>/isU",
$rsshtml
,
$desütiÚs
);

354 if(!
	`is£t
(
$lšks
[2]))

358 
	`fÜ—ch
(
$lšks
[2] 
as
 
$k
=>
$v
)

360 
$r§¼
[
$k
]['lšk'] = 
	`RpCd©a
(
$v
);

362 if(
	`is£t
(
$t™Ës
[2][
$k
]))

364 
$r§¼
[
$k
]['t™Ë'] = 
	`RpCd©a
(
$t™Ës
[2][$k]);

368 
$r§¼
[
$k
]['t™Ë'] = 
	`´eg_»¶aû
("/^(.*)\//i", "", 
	`RpCd©a
(
$t™Ës
[2][$k]));

370 if(
	`is£t
(
$desütiÚs
[2][
$k
]))

372 
$r§¼
[
$k
]['image'] = 
	`G‘ddImgFromRss
(
$desütiÚs
[2][$k],
$rssu¾
);

376 
$r§¼
[
$k
]['image'] = '';

379  
$r§¼
;

380 
	}
}

390 
funùiÚ
 
	$G‘ddImgFromRss
(
$desütiÚs
,
$»fu¾
)

392 if(
$desütiÚs
=='')

396 
	`´eg_m©ch_®l
("/<img(.*)¤c=[\"']{0,1}(.*)[\"']{0,1}[> \r\n\t]{1,}/isU",
$desütiÚs
,
$imgs
);

397 if(
	`is£t
(
$imgs
[2][0]))

399 
$imgs
[2][0] = 
	`´eg_»¶aû
("/[\"']/", '', $imgs[2][0]);

400 
$imgs
[2][0] = 
	`´eg_»¶aû
("/\/{1,}/", '/', $imgs[2][0]);

401  
	`FlU¾
(
$»fu¾
,
$imgs
[2][0]);

407 
	}
}

417 
funùiÚ
 
	$FlU¾
(
$»fu¾
,
$su¾
)

419 
$i
 = 
$·thS‹p
 = 0;

420 
$d¡r
 = 
$p¡r
 = 
$oku¾
 = '';

421 
$»fu¾
 = 
	`Œim
($refurl);

422 
$su¾
 = 
	`Œim
($surl);

423 
$u¾s
 = @
	`·r£_u¾
(
$»fu¾
);

424 
$ba£ho¡
 = ( (!
	`is£t
(
$u¾s
['port']) || $urls['port']=='80') ? $urls['host'] : $urls['host'].':'.$urls['port']);

428 
$ba£·th
 = 
$ba£ho¡
;

429 
$·ths
 = 
	`ex¶ode
('/',
	`´eg_»¶aû
("/^h‰p:\/\//i", "", 
$»fu¾
));

430 
$n
 = 
	`couÁ
(
$·ths
);

431 
$i
=1;$˜< (
$n
-1);$i++)

433 if(!
	`´eg_m©ch
("/[\?]/", 
$·ths
[
$i
])è
$ba£·th
 .= '/'.$paths[$i];

435 if(!
	`´eg_m©ch
("/[\?\.]/", 
$·ths
[
$n
-1]))

437 
$ba£·th
 .ğ'/'.
$·ths
[
$n
-1];

439 if(
$su¾
=='')

441  
$ba£·th
;

443 
$pos
 = 
	`¡½os
(
$su¾
, "#");

444 if(
$pos
>0)

446 
$su¾
 = 
	`sub¡r
($su¾, 0, 
$pos
);

450 if(
$su¾
[0]=='/')

452 
$oku¾
 = 
$ba£ho¡
.
$su¾
;

454 if(
$su¾
[0]=='.')

456 if(
	`¡¾’
(
$su¾
)<=2)

460 if(
$su¾
[1]=='/')

462 
$oku¾
 = 
$ba£·th
.
	`´eg_»¶aû
('/^./', '', 
$su¾
);

466 
$oku¾
 = 
$ba£·th
.'/'.
$su¾
;

471 ifĞ
	`¡¾’
(
$su¾
) < 7 )

473 
$oku¾
 = 
$ba£·th
.'/'.
$su¾
;

475 ifĞ
	`´eg_m©ch
("/^h‰p:\/\//i",
$su¾
) )

477 
$oku¾
 = 
$su¾
;

481 
$oku¾
 = 
$ba£·th
.'/'.
$su¾
;

484 
$oku¾
 = 
	`´eg_»¶aû
("/^http:\/\//i", '', $okurl);

485 
$oku¾
 = 'h‰p://'.
	`´eg_»¶aû
("/\/{1,}/", '/', $okurl);

486  
$oku¾
;

487 
	}
}

502 
funùiÚ
 
G‘U¾FromLi¡RuË
(
$»gxu¾
='',
$hªdu¾
='',
$¡¬tid
=0,
$’did
=0,
$addv
=1,
$u£mÜe
=0,
$b©chruË
='')

504 
glob®
 
$dsql
,
$i¦i¡’
;

506 
	g$li¡s
 = 
¬¿y
();

507 
	g$n
 = 0;

508 
	g$i¦i¡’
 = (
em±y
(
$i¦i¡’
) ? 0 : $islisten);

509 if(
	g$hªdu¾
!='')

511 
$hªdu¾s
 = 
ex¶ode
("\n",
$hªdu¾
);

512 
fÜ—ch
(
$hªdu¾s
 
as
 
$hªdu¾
)

514 
	g$hªdu¾
 = 
Œim
(
$hªdu¾
);

515 if(
´eg_m©ch
("/^h‰p:\/\//i", 
$hªdu¾
))

517 
	g$li¡s
[
$n
][0] = 
$hªdu¾
;

518 
	g$li¡s
[
$n
][1] = 0;

519 
	g$n
++;

520 if(
	g$i¦i¡’
==1)

527 if(
	g$»gxu¾
!='')

530 if(!
´eg_m©ch
("/\(\*\)/i", 
$»gxu¾
) && !preg_match("/\(#\)/", $regxurl))

532 
$li¡s
[
$n
][0] = 
$»gxu¾
;

533 
	g$li¡s
[
$n
][1] = 0;

534 
	g$n
++;

538 if(
	g$addv
 <= 0)

540 
$addv
 = 1;

544 if(
	g$u£mÜe
==0)

546 
$¡¬tid
 <ğ
$’did
)

548 
$li¡s
[
$n
][0] = 
¡r_»¶aû
("(*)",
¥rštf
('%0'.
¡¾’
(
$¡¬tid
).'d',$¡¬tid),
$»gxu¾
);

549 
	g$li¡s
[
$n
][1] = 0;

550 
	g$¡¬tid
 = 
¥rštf
('%0'.
¡¾’
(
$¡¬tid
).'d',$¡¬tid + 
$addv
);

551 
	g$n
++;

552 if(
	g$n
>2000 || 
	g$i¦i¡’
==1)

563 
	g$ÄuËs
 = 
ex¶ode
(']',
Œim
(
$b©chruË
));

564 
fÜ—ch
(
$ÄuËs
 
as
 
$ÄuË
)

566 
	g$ÄuË
 = 
Œim
(
$ÄuË
);

567 
	g$ÄuË
 = 
´eg_»¶aû
("/^\[|\]$/", '', 
$ÄuË
);

568 
	g$ÄuËs
 = 
ex¶ode
(';',
$ÄuË
);

569 if(
couÁ
(
$ÄuËs
)<3)

573 
	g$b¹ag
 = '';

574 
	g$¡¬tid
 = 0;

575 
	g$’did
 = 0;

576 
	g$ty³id
 = 0;

577 
	g$addu¾s
 = 
¬¿y
();

578 
fÜ—ch
(
$ÄuËs
 
as
 
$ÄuË
)

580 
	g$ÄuË
 = 
Œim
(
$ÄuË
);

581 
li¡
(
$k
,
$v
èğ
ex¶ode
('=>',
$ÄuË
);

582 if(
Œim
(
$k
)=='(#)')

584 
$b¹ag
 = 
Œim
(
$v
);

586 if(
Œim
(
$k
)=='typeid')

588 
$ty³id
 = 
Œim
(
$v
);

590 if(
Œim
(
$k
)=='addurl')

592 
$addu¾
 = 
Œim
(
$v
);

593 
	g$addu¾s
 = 
ex¶ode
('|',
$addu¾
);

595 if(
Œim
(
$k
)=='(*)')

597 
$v
 = 
´eg_»¶aû
("/[ \r\n\t]/", '', 
Œim
($v));

598 
li¡
(
$¡¬tid
,
$’did
èğ
ex¶ode
('-',
$v
);

603 if(
´eg_m©ch
('/[^0-9]/', 
$ty³id
))

605 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__arctype` WHEREypename LIKE '$typeid' ");

606 if(
is_¬¿y
(
$¬r
))

608 
	g$ty³id
 = 
$¬r
['id'];

612 
	g$ty³id
 = 0;

617 
	g$mjj
 = 0;

618 if(
is£t
(
$addu¾s
[0]))

620 
fÜ—ch
(
$addu¾s
 
as
 
$addu¾
)

622 
	g$addu¾
 = 
Œim
(
$addu¾
);

623 if(
	g$addu¾
=='')

627 
	g$li¡s
[
$n
][0] = 
$addu¾
;

628 
	g$li¡s
[
$n
][1] = 
$ty³id
;

629 
	g$n
++;

630 
	g$mjj
++;

631 if(
	g$i¦i¡’
==1)

639 if(
	g$i¦i¡’
!=1 || 
$mjj
==0 )

642 
$¡¬tid
 <ğ
$’did
)

644 
$li¡s
[
$n
][0] = 
¡r_»¶aû
("(#)",
$b¹ag
,
$»gxu¾
);

645 
	g$li¡s
[
$n
][0] = 
¡r_»¶aû
("(*)",
¥rštf
('%0'.
¡¾’
(
$¡¬tid
).'d',$¡¬tid),
$li¡s
[$n][0]);

646 
	g$li¡s
[
$n
][1] = 
$ty³id
;

647 
	g$¡¬tid
 = 
¥rštf
('%0'.
¡¾’
(
$¡¬tid
).'d',$¡¬tid + 
$addv
);

648 
	g$n
++;

649 if(
	g$i¦i¡’
==1)

653 if(
	g$n
>20000)

666  
	g$li¡s
;

	@E:\web\weixun\functions\xakhtml2.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

15 şas 
	cXakHtml2


17 
v¬
 
	m$CA‰
;

18 
v¬
 
	m$SourûHtml
;

19 
v¬
 
	m$T™Ë
;

20 
v¬
 
	m$MedŸs
;

21 
v¬
 
	m$MedŸInfos
;

22 
v¬
 
	m$Lšks
;

23 
v¬
 
	m$Ch¬S‘
;

24 
v¬
 
	m$Ba£U¾
;

25 
v¬
 
	m$Ba£U¾P©h
;

26 
v¬
 
	m$HomeU¾
;

27 
v¬
 
	m$IsH—d
;

28 
v¬
 
	m$ImgHeight
;

29 
v¬
 
	m$ImgWidth
;

30 
v¬
 
	m$G‘LškTy³
;

33 
funùiÚ
 
	$__cÚ¡ruù
()

35 
$this
->
CA‰
 = '';

36 
$this
->
SourûHtml
 = '';

37 
$this
->
T™Ë
 = '';

38 
$this
->
MedŸs
 = 
	`A¼ay
();

39 
$this
->
MedŸInfos
 = 
	`A¼ay
();

40 
$this
->
Lšks
 = 
	`A¼ay
();

41 
$this
->
Ba£U¾
 = '';

42 
$this
->
Ba£U¾P©h
 = '';

43 
$this
->
HomeU¾
 = '';

44 
$this
->
IsH—d
 = 
çl£
;

45 
$this
->
ImgHeight
 = 30;

46 
$this
->
ImgWidth
 = 50;

47 
$this
->
G‘LškTy³
 = 'link';

50 
funùiÚ
 
	$XakHtml2
()

52 
$this
->
	`__cÚ¡ruù
();

53 
	}
}

64 
funùiÚ
 
S‘Sourû
(&
$html
, 
$u¾
 = '', 
$lškty³
='')

66 
$this
->
__cÚ¡ruù
();

67 
	g$this
->
	gCA‰
 = 
Ãw
 
XakA‰ribu‹2
();

68 
	g$u¾
 = 
Œim
(
$u¾
);

69 
	g$this
->
	gSourûHtml
 = 
$html
;

70 
	g$this
->
	gBa£U¾
 = 
$u¾
;

72 
	g$u¾s
 = @
·r£_u¾
(
$u¾
);

73 
	g$this
->
	gHomeU¾
 = 
$u¾s
['host'];

74 
	g$this
->
	gBa£U¾P©h
 = 
$this
->
HomeU¾
.
$u¾s
['path'];

75 
	g$this
->
	gBa£U¾P©h
 = 
´eg_»¶aû
("/\/([^\/]*)\.(.*)$/","/",
$this
->
Ba£U¾P©h
);

76 
	g$this
->
	gBa£U¾P©h
 = 
´eg_»¶aû
("/\/$/",'',
$this
->
Ba£U¾P©h
);

77 if(
	g$lškty³
!='')

79 
$this
->
G‘LškTy³
 = 
$lškty³
;

81 if(
	g$html
 != '')

83 
$this
->
AÇly£r
();

93 
funùiÚ
 
	$AÇly£r
()

95 
$cA‰
 = 
Ãw
 
	`XakA‰ribu‹2
();

96 
$cA‰
->
IsTagName
 = 
çl£
;

97 
$c
 = '';

98 
$i
 = 0;

99 
$¡¬tPos
 = 0;

100 
$’dPos
 = 0;

101 
$wt
 = 0;

102 
$ht
 = 0;

103 
$sütdd
 = 0;

104 
$©tSŒ
 = '';

105 
$tmpV®ue
 = '';

106 
$tmpV®ue2
 = '';

107 
$gName
 = '';

108 
$hash—d
 = 0;

109 
$¦’
 = 
	`¡¾’
(
$this
->
SourûHtml
);

110 if(
$this
->
G‘LškTy³
=='link' || $this->GetLinkType=='')

112 
$ÃedTags
 = 
	`¬¿y
('a');

114 if(
$this
->
G‘LškTy³
=='media')

116 
$ÃedTags
 = 
	`¬¿y
('img','embed','a');

117 
$this
->
IsH—d
 = 
Œue
;

119 
$gb»aks
 = 
	`¬¿y
(' ','<','>',"\r","\n","\t");

120 ;
	`is£t
(
$this
->
SourûHtml
[
$i
]);$i++)

122 if(
$this
->
SourûHtml
[
$i
]=='<')

124 
$gName
 = '';

125 
$j
 = 0;

126 
$i
=$i+1; 
	`is£t
(
$this
->
SourûHtml
[$i]); $i++)

128 if(
$j
>10)

132 
$j
++;

133 ifĞ
	`š_¬¿y
(
$this
->
SourûHtml
[
$i
],
$gb»aks
) )

139 
$gName
 .ğ
$this
->
SourûHtml
[
$i
];

142 
$gName
 = 
	`¡¹Şow”
($tagName);

145 if(
$gName
=='!--')

147 
$’dPos
 = 
	`¡½os
(
$this
->
SourûHtml
,'-->',
$i
);

148 if(
$’dPos
 !=ğ
çl£
)

150 
$i
=
$’dPos
+3;

156 ifĞ
	`š_¬¿y
(
$gName
,
$ÃedTags
) )

158 
$¡¬tPos
 = 
$i
;

159 
$’dPos
 = 
	`¡½os
(
$this
->
SourûHtml
,'>',
$i
+1);

160 if(
$’dPos
===
çl£
)

164 
$©tSŒ
 = 
	`sub¡r
(
$this
->
SourûHtml
,
$i
+1,
$’dPos
-
$¡¬tPos
-1);

165 
$cA‰
->
	`S‘Sourû
(
$©tSŒ
);

166 if(
$gName
=='img')

168 
$this
->
	`In£¹MedŸ
(
$cA‰
->
	`G‘A‰
('src'),'img');

170 if(
$gName
=='embed')

172 
$ru¾
 = 
$this
->
	`In£¹MedŸ
(
$cA‰
->
	`G‘A‰
('src'),'embed');

173 if(
$ru¾
 != '')

175 
$this
->
MedŸInfos
[
$ru¾
][0] = 
$cA‰
->
	`G‘A‰
('width');

176 
$this
->
MedŸInfos
[
$ru¾
][1] = 
$cA‰
->
	`G‘A‰
('height');

179 if(
$gName
=='a')

181 
$this
->
	`In£¹Lšk
($this->
	`FlU¾
(
$cA‰
->
	`G‘A‰
('h»f')),$this->
	`G‘IÂ”Text
(
$i
,'a'));

188 
$i
--;

193 if(
$this
->
T™Ë
 == '')

195 
$this
->
T™Ë
 = $this->
Ba£U¾
;

197 
	}
}

205 
funùiÚ
 
	$CË¬
()

207 
$this
->
CA‰
 = '';

208 
$this
->
SourûHtml
 = '';

209 
$this
->
T™Ë
 = '';

210 
$this
->
Lšks
 = '';

211 
$this
->
MedŸs
 = '';

212 
$this
->
Ba£U¾
 = '';

213 
$this
->
Ba£U¾P©h
 = '';

214 
	}
}

224 
funùiÚ
 
	$In£¹MedŸ
(
$u¾
, 
$mty³
)

226 ifĞ
	`´eg_m©ch
("/^(javasüt:|#|'|\")/", 
$u¾
) )

230 if(
$u¾
 == '')

234 
$this
->
MedŸs
[
$u¾
]=
$mty³
;

235  
$u¾
;

236 
	}
}

246 
funùiÚ
 
	$In£¹Lšk
(
$u¾
, 
$©™Ë
)

248 ifĞ
	`´eg_m©ch
("/^(javasüt:|#|'|\")/", 
$u¾
) )

252 if(
$u¾
 == '')

256 ifĞ
	`´eg_m©ch
('/^img:/', 
$©™Ë
) )

258 
	`li¡
(
$aimg
, 
$©™Ë
èğ
	`ex¶ode
(':txt:', $atitle);

259 if(!
	`is£t
(
$this
->
Lšks
[
$u¾
]))

261 if(
$©™Ë
 != '')

263 
$this
->
Lšks
[
$u¾
]['t™Ë'] = 
	`ú_sub¡r
(
$©™Ë
,50);

267 
$this
->
Lšks
[
$u¾
]['t™Ë'] = 
	`´eg_»¶aû
('/img:/', '', 
$aimg
);

269 
$this
->
Lšks
[
$u¾
]['link'] = $url;

271 
$this
->
Lšks
[
$u¾
]['image'] = 
	`´eg_»¶aû
('/img:/', '', 
$aimg
);

272 
$this
->
	`In£¹MedŸ
($this->
Lšks
[
$u¾
]['image'], 'img');

276 if(!
	`is£t
(
$this
->
Lšks
[
$u¾
]))

278 
$this
->
Lšks
[
$u¾
]['image'] = '';

279 
$this
->
Lšks
[
$u¾
]['t™Ë'] = 
$©™Ë
;

280 
$this
->
Lšks
[
$u¾
]['link'] = $url;

284 if(
	`¡¾’
(
$this
->
Lšks
[
$u¾
]['t™Ë']è< sŒËn(
$©™Ë
)) $this->Links[$url]['title'] = $atitle;

287  
$u¾
;

288 
	}
}

297 
funùiÚ
 
	$P¬Ch¬S‘
(
$©t
)

299 
$¡¬tdd
=0;

300 
$gËn
=0;

301 
$¡¬tdd
 = 
	`¡½os
(
$©t
,'=');

302 if(
$¡¬tdd
===
çl£
)

308 
$gËn
 = 
	`¡¾’
(
$©t
)-
$¡¬tdd
-1;

309 if(
$gËn
<=0)

313  
	`Œim
(
	`sub¡r
(
$©t
, 
$¡¬tdd
+1, 
$gËn
));

315 
	}
}

324 
funùiÚ
 
	$FlU¾
(
$su¾
)

326 
$i
 = 
$·thS‹p
 = 0;

327 
$d¡r
 = 
$p¡r
 = 
$oku¾
 = '';

329 
$su¾
 = 
	`Œim
($surl);

330 if(
$su¾
 == '')

334 
$pos
 = 
	`¡½os
(
$su¾
,'#');

335 if(
$pos
>0)

337 
$su¾
 = 
	`sub¡r
($su¾,0,
$pos
);

339 if(
$su¾
[0]=='/')

341 
$oku¾
 = 
$this
->
HomeU¾
.'/'.
$su¾
;

343 if(
$su¾
[0]=='.')

345 if(!
	`is£t
(
$su¾
[2]))

349 if(
$su¾
[0]=='/')

351 
$oku¾
 = 
$this
->
Ba£U¾P©h
."/".
	`sub¡r
(
$su¾
,2,
	`¡¾’
($surl)-2);

355 
$u¾s
 = 
	`ex¶ode
('/',
$su¾
);

356 
	`fÜ—ch
(
$u¾s
 
as
 
$u
)

358 if(
$u
=='..')

360 
$·thS‹p
++;

362 if(
$i
<
	`couÁ
(
$u¾s
)-1)

364 
$d¡r
 .ğ
$u¾s
[
$i
].'/';

368 
$d¡r
 .ğ
$u¾s
[
$i
];

370 
$i
++;

372 
$u¾s
 = 
	`ex¶ode
('/',
$this
->
Ba£U¾P©h
);

373 if(
	`couÁ
(
$u¾s
è<ğ
$·thS‹p
)

379 
$p¡r
 = '';

380 
$i
=0;$i<
	`couÁ
(
$u¾s
)-
$·thS‹p
;$i++){ 
$p¡r
 .= $urls[$i].'/'; }

381 
$oku¾
 = 
$p¡r
.
$d¡r
;

387 ifĞ
	`¡¾’
(
$su¾
) < 7 )

389 
$oku¾
 = 
$this
->
Ba£U¾P©h
.'/'.
$su¾
;

391 ifĞ
	`¡¹Şow”
(
	`sub¡r
(
$su¾
,0,7))=='http://' )

393 
$oku¾
 = 
	`´eg_»¶aû
('/^h‰p:\/\//i', '', 
$su¾
);

397 
$oku¾
 = 
$this
->
Ba£U¾P©h
.'/'.
$su¾
;

400 
$oku¾
 = 
	`´eg_»¶aû
('/\/{1,}/i', '/', $okurl);

401  'h‰p://'.
$oku¾
;

402 
	}
}

412 
funùiÚ
 
	$G‘IÂ”Text
(&
$pos
,
$gÇme
)

414 
$¡¬tPos
=0;

415 
$’dPos
=0;

416 
$‹xtL’
=0;

417 
$¡r
 = '';

418 
$¡¬tPos
 = 
	`¡½os
(
$this
->
SourûHtml
,'>',
$pos
);

420 if(
$gÇme
=='title')

422 
$’dPos
 = 
	`¡½os
(
$this
->
SourûHtml
,'<',
$¡¬tPos
);

426 
$’dPos1
 = 
	`¡½os
(
$this
->
SourûHtml
,'</a',
$¡¬tPos
);

427 
$’dPos2
 = 
	`¡½os
(
$this
->
SourûHtml
,'</A',
$¡¬tPos
);

428 if(
$’dPos1
===
çl£
)

430 
$’dPos
 = 
$’dPos2
;

432 if(
$’dPos2
===
çl£
)

434 
$’dPos
 = 
$’dPos1
;

438 
$’dPos
 = (
$’dPos1
 < 
$’dPos2
 ? $endPos1 : $endPos2 );

441 if(
$’dPos
 > 
$¡¬tPos
)

443 
$‹xtL’
 = 
$’dPos
-
$¡¬tPos
;

444 
$¡r
 = 
	`sub¡r
(
$this
->
SourûHtml
,
$¡¬tPos
+1,
$‹xtL’
-1);

446 
$pos
 = 
$¡¬tPos
 + 
$‹xtL’
 + 
	`¡¾’
("</".
$gÇme
) + 1;

447 if(
$gÇme
=='title')

449  
	`Œim
(
$¡r
);

453 
	`´eg_m©ch_®l
("/<img(.*)¤c=[\"']{0,1}(.*)[\"']{0,1}[> \r\n\t]{1,}/isU",
$¡r
,
$imgs
);

454 if(
	`is£t
(
$imgs
[2][0]))

456 
$txt
 = 
	`Œim
(
	`Html2Text
(
$¡r
));

457 
$imgs
[2][0] = 
	`´eg_»¶aû
("/[\"']/",'',$imgs[2][0]);

458  "img:".
$this
->
	`FlU¾
(
$imgs
[2][0]).':txt:'.
$txt
;

462 
$¡r
 = 
	`¡r_gs
($str);

465  
$¡r
;

468 
	}
}

475 şas 
	cXakA‰ribu‹2


477 
v¬
 
	m$SourûSŒšg
 = '';

478 
v¬
 
	m$SourûMaxSize
 = 1024;

479 
v¬
 
	m$Ch¬ToLow
 = 
FALSE
;

480 
v¬
 
	m$IsTagName
 = 
TRUE
;

481 
v¬
 
	m$CouÁ
 = -1;

482 
v¬
 
	m$I‹ms
 = '';

485 
funùiÚ
 
S‘Sourû
(
$¡r
 = '')

487 
$this
->
CouÁ
 = -1;

488 
	m$this
->
	mI‹ms
 = '';

489 
	m$¡rL’
 = 0;

490 
	m$this
->
	mSourûSŒšg
 = 
Œim
(
´eg_»¶aû
("/[ \t\r\n]{1,}/"," ",
$¡r
));

491 
	m$¡rL’
 = 
¡¾’
(
$this
->
SourûSŒšg
);

492 
	m$this
->
	mSourûSŒšg
 .= " ";

493 if(
	m$¡rL’
>0&&$¡rL’<=
$this
->
SourûMaxSize
)

495 
$this
->
Priv©eA‰P¬£
();

500 
funùiÚ
 
	$G‘A‰
(
$¡r
)

502 if(
$¡r
 == '')

506 
$¡r
 = 
	`¡¹Şow”
($str);

507 if(
	`is£t
(
$this
->
I‹ms
[
$¡r
]))

509  
$this
->
I‹ms
[
$¡r
];

515 
	}
}

518 
funùiÚ
 
	$IsA‰
(
$¡r
)

520 if(
$¡r
 == '')

522  
çl£
;

524 
$¡r
 = 
	`¡¹Şow”
($str);

525 if(
	`is£t
(
$this
->
I‹ms
[
$¡r
]))

527  
Œue
;

531  
çl£
;

533 
	}
}

536 
funùiÚ
 
	$G‘TagName
()

538  
$this
->
	`G‘A‰
("tagname");

539 
	}
}

542 
funùiÚ
 
	$G‘CouÁ
()

544  
$this
->
CouÁ
+1;

545 
	}
}

548 
funùiÚ
 
	$Priv©eA‰P¬£
()

550 
$d
 = '';

551 
$tm·‰
 = '';

552 
$tmpv®ue
 = '';

553 
$¡¬tdd
 = -1;

554 
$ddg
 = '';

555 
$¡rL’
 = 
	`¡¾’
(
$this
->
SourûSŒšg
);

556 
$j
 = 0;

559 if(
$this
->
IsTagName
)

562 if(
	`is£t
(
$this
->
SourûSŒšg
[2]))

564 if(
$this
->
SourûSŒšg
[0].$this->SourceString[1].$this->SourceString[2]=='!--')

566 
$this
->
I‹ms
['tagname'] = '!--';

570 
$i
=0;$i<
$¡rL’
;$i++)

572 
$d
 = 
$this
->
SourûSŒšg
[
$i
];

573 
$j
++;

574 if(
	`´eg_m©ch
("/[ '\"\r\n\t]/i", 
$d
))

576 
$this
->
CouÁ
++;

577 
$this
->
I‹ms
["gÇme"]=
	`¡¹Şow”
(
	`Œim
(
$tmpv®ue
));

578 
$tmpv®ue
 = ''; ;

582 
$tmpv®ue
 .ğ
$d
;

585 if(
$j
>0)

587 
$j
 = $j-1;

592 
$i
=
$j
;$i<
$¡rL’
;$i++)

594 
$d
 = 
$this
->
SourûSŒšg
[
$i
];

596 if(
$¡¬tdd
==-1)

598 if(
$d
!='=')

600 
$tm·‰
 .ğ
$d
;

604 
$tm·‰
 = 
	`¡¹Şow”
(
	`Œim
($tmpatt));

605 
$¡¬tdd
=0;

610 if(
$¡¬tdd
==0)

612 
$d
)

618 
$ddg
='\'';

619 
$¡¬tdd
=1;

622 
$ddg
='"';

623 
$¡¬tdd
=1;

626 
$tmpv®ue
.=
$d
;

627 
$ddg
=' ';

628 
$¡¬tdd
=1;

634 if(
$¡¬tdd
==1)

636 if(
$d
==
$ddg
)

638 
$this
->
CouÁ
++;

639 if(
$this
->
Ch¬ToLow
)

641 
$this
->
I‹ms
[
$tm·‰
] = 
	`¡¹Şow”
(
	`Œim
(
$tmpv®ue
));

645 
$this
->
I‹ms
[
$tm·‰
] = 
	`Œim
(
$tmpv®ue
);

647 
$tm·‰
 = '';

648 
$tmpv®ue
 = '';

649 
$¡¬tdd
=-1;

653 
$tmpv®ue
.=
$d
;

659 if(
$tm·‰
 != '')

661 
$this
->
I‹ms
[
$tm·‰
] = '';

663 
	}
}

	@E:\web\weixun\functions\xakhttpdown.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 @
£t_time_lim™
(0);

9 şas 
	cXakH‰pDown


11 
v¬
 
	m$m_u¾
 = '';

12 
v¬
 
	m$m_u¾·th
 = '';

13 
v¬
 
	m$m_scheme
 = 'http';

14 
v¬
 
	m$m_ho¡
 = '';

15 
v¬
 
	m$m_pÜt
 = '80';

16 
v¬
 
	m$m_u£r
 = '';

17 
v¬
 
	m$m_·ss
 = '';

18 
v¬
 
	m$m_·th
 = '/';

19 
v¬
 
	m$m_qu”y
 = '';

20 
v¬
 
	m$m_å
 = '';

21 
v¬
 
	m$m_”rÜ
 = '';

22 
v¬
 
	m$m_h‰ph—d
 = '';

23 
v¬
 
	m$m_html
 = '';

24 
v¬
 
	m$m_puth—d
 = '';

25 
v¬
 
	m$Ba£U¾P©h
 = '';

26 
v¬
 
	m$HomeU¾
 = '';

27 
v¬
 
	m$»Try
 = 0;

28 
v¬
 
	m$JumpCouÁ
 = 0;

37 
funùiÚ
 
	$Priv©eIn™
(
$u¾
)

39 if(
$u¾
=='') {

42 
$u¾s
 = '';

43 
$u¾s
 = @
	`·r£_u¾
(
$u¾
);

44 
$this
->
m_u¾
 = 
$u¾
;

45 if(
	`is_¬¿y
(
$u¾s
))

47 
$this
->
m_ho¡
 = 
$u¾s
["host"];

48 if(!
	`em±y
(
$u¾s
["scheme"]))

50 
$this
->
m_scheme
 = 
$u¾s
["scheme"];

52 if(!
	`em±y
(
$u¾s
["user"]))

54 
$this
->
m_u£r
 = 
$u¾s
["user"];

56 if(!
	`em±y
(
$u¾s
["pass"]))

58 
$this
->
m_·ss
 = 
$u¾s
["pass"];

60 if(!
	`em±y
(
$u¾s
["port"]))

62 
$this
->
m_pÜt
 = 
$u¾s
["port"];

64 if(!
	`em±y
(
$u¾s
["path"]))

66 
$this
->
m_·th
 = 
$u¾s
["path"];

68 
$this
->
m_u¾·th
 = $this->
m_·th
;

69 if(!
	`em±y
(
$u¾s
["query"]))

71 
$this
->
m_qu”y
 = 
$u¾s
["query"];

72 
$this
->
m_u¾·th
 .ğ"?".$this->
m_qu”y
;

74 
$this
->
HomeU¾
 = 
$u¾s
["host"];

75 
$this
->
Ba£U¾P©h
 = $this->
HomeU¾
.
$u¾s
["path"];

76 
$this
->
Ba£U¾P©h
 = 
	`´eg_»¶aû
("/\/([^\/]*)\.(.*)$/","/",$this->BaseUrlPath);

77 
$this
->
Ba£U¾P©h
 = 
	`´eg_»¶aû
("/\/$/","",$this->BaseUrlPath);

87 
funùiÚ
 
	$Re£tAny
()

89 
$this
->
m_u¾
 = "";

90 
$this
->
m_u¾·th
 = "";

91 
$this
->
m_scheme
 = "http";

92 
$this
->
m_ho¡
 = "";

93 
$this
->
m_pÜt
 = "80";

94 
$this
->
m_u£r
 = "";

95 
$this
->
m_·ss
 = "";

96 
$this
->
m_·th
 = "/";

97 
$this
->
m_qu”y
 = "";

98 
$this
->
m_”rÜ
 = "";

99 
	}
}

109 
funùiÚ
 
O³nU¾
(
$u¾
,
$»que¡Ty³
="GET")

111 
$this
->
Re£tAny
();

112 
	g$this
->
	gJumpCouÁ
 = 0;

113 
	g$this
->
	gm_h‰ph—d
 = 
A¼ay
() ;

114 
	g$this
->
	gm_html
 = '';

115 
	g$this
->
	g»Try
 = 0;

116 
	g$this
->
Clo£
();

119 
	g$this
->
Priv©eIn™
(
$u¾
);

120 
	g$this
->
Priv©eS¹SessiÚ
(
$»que¡Ty³
);

130 
funùiÚ
 
	$JumpO³nU¾
(
$u¾
)

132 
$this
->
	`Re£tAny
();

133 
$this
->
JumpCouÁ
++;

134 
$this
->
m_h‰ph—d
 = 
	`A¼ay
() ;

135 
$this
->
m_html
 = "";

136 
$this
->
	`Clo£
();

139 
$this
->
	`Priv©eIn™
(
$u¾
);

140 
$this
->
	`Priv©eS¹SessiÚ
('GET');

141 
	}
}

149 
funùiÚ
 
	$´štE¼Ü
()

151 
echo
 "é”™è¯¯ä¿¡æ¯ï¼š".
$this
->
m_”rÜ
;

152 
echo
 "<br/>å…·ä½“è¿”å›å¤´ï¼š<br/>";

153 
	`fÜ—ch
(
$this
->
m_h‰ph—d
 
as
 
$k
=>
$v
){ 
echo
 "$k => $v <br/>\r\n"; }

154 
	}
}

162 
funùiÚ
 
	$IsG‘OK
()

164 ifĞ
	`´eg_m©ch
("/^2/",
$this
->
	`G‘H—d
("http-state")) )

166  
TRUE
;

170 
$this
->
m_”rÜ
 .ğ$this->
	`G‘H—d
("http-state")." - ".$this->GetHead("http-describe")."<br/>";

171  
FALSE
;

173 
	}
}

181 
funùiÚ
 
	$IsText
()

183 ifĞ
	`´eg_m©ch
("/^2/",
$this
->
	`G‘H—d
("http-state")) &&…reg_match("/text|xml/i",$this->GetHead("content-type")) )

185  
TRUE
;

189 
$this
->
m_”rÜ
 .= "å†…å®¹ä¸ºéæ–‡æœ¬ç±»å‹æˆ–ç½‘å€é‡å®šå‘<br/>";

190  
FALSE
;

192 
	}
}

201 
funùiÚ
 
	$IsCÚ‹ÁTy³
(
$ùy³
)

203 if(
	`´eg_m©ch
("/^2/",
$this
->
	`G‘H—d
("http-state"))

204 && 
$this
->
	`G‘H—d
("cÚ‹Á-ty³")==
	`¡¹Şow”
(
$ùy³
))

205 {  
TRUE
; }

208 
$this
->
m_”rÜ
 .ğ"ç±»å‹ä¸å¯¹ ".$this->
	`G‘H—d
("content-type")."<br/>";

209  
FALSE
;

211 
	}
}

220 
funùiÚ
 
	$SaveToBš
(
$§vef’ame
)

222 if(!
$this
->
	`IsG‘OK
())

224  
FALSE
;

226 if(@
	`ãof
(
$this
->
m_å
))

228 
$this
->
m_”rÜ
 = "è¿æ¥å·²ç»å…³é—­ï¼";  
FALSE
;

230 
$å
 = 
	`fİ’
(
$§vef’ame
,"w");

231 !
	`ãof
(
$this
->
m_å
))

233 
	`fwr™e
(
$å
, 
	`ä—d
(
$this
->
m_å
, 1024));

235 
	`fşo£
(
$this
->
m_å
);

236 
	`fşo£
(
$å
);

237  
TRUE
;

238 
	}
}

247 
funùiÚ
 
	$SaveToText
(
$§vef’ame
)

249 if(
$this
->
	`IsText
())

251 
$this
->
	`SaveBšFe
(
$§vef’ame
);

257 
	}
}

265 
funùiÚ
 
	$G‘Html
()

267 if(!
$this
->
	`IsText
())

271 if(
$this
->
m_html
!='')

273  
$this
->
m_html
;

275 if(!
$this
->
m_å
||@
	`ãof
($this->m_fp))

279 !
	`ãof
(
$this
->
m_å
))

281 
$this
->
m_html
 .ğ
	`fg‘s
($this->
m_å
,256);

283 @
	`fşo£
(
$this
->
m_å
);

284  
$this
->
m_html
;

285 
	}
}

294 
funùiÚ
 
Priv©eS¹SessiÚ
(
$»que¡Ty³
="GET")

296 if(!
$this
->
Priv©eO³nHo¡
())

298 
$this
->
m_”rÜ
 .= "æ‰“å¼€è¿œç¨‹ä¸»æœºå‡ºé”™!";

299  
	gFALSE
;

301 
	g$this
->
	g»Try
++;

302 if(
	g$this
->
G‘H—d
("http-edition")=="HTTP/1.1")

304 
$h‰pv
 = "HTTP/1.1";

308 
	g$h‰pv
 = "HTTP/1.0";

310 
	g$ps
 = 
ex¶ode
('?',
$this
->
m_u¾·th
);

312 
	g$h—dSŒšg
 = '';

315 if(
	g$»que¡Ty³
=="GET")

317 
$h—dSŒšg
 .ğ"GET ".
$this
->
m_u¾·th
." $httpv\r\n";

321 
	g$h—dSŒšg
 .ğ"POST ".
$ps
[0]." $httpv\r\n";

323 
	g$this
->
	gm_puth—d
["Ho¡"] = 
$this
->
m_ho¡
;

326 if(!
is£t
(
$this
->
m_puth—d
["Accept"]))

328 
	g$this
->
	gm_puth—d
["Accept"] = "*/*";

330 if(!
is£t
(
$this
->
m_puth—d
["User-Agent"]))

332 
	g$this
->
	gm_puth—d
["User-Agent"] = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2)";

334 if(!
is£t
(
$this
->
m_puth—d
["Refer"]))

336 
	g$this
->
	gm_puth—d
["Reãr"] = "h‰p://".
$this
->
m_puth—d
["Host"];

339 
fÜ—ch
(
$this
->
m_puth—d
 
as
 
$k
=>
$v
)

341 
$k
 = 
Œim
($k);

342 
	g$v
 = 
Œim
(
$v
);

343 if(
	g$k
!=""&&
$v
!="")

345 
$h—dSŒšg
 .= "$k: $v\r\n";

348 
åuts
(
$this
->
m_å
, 
$h—dSŒšg
);

349 if(
	g$»que¡Ty³
=="POST")

351 
$po¡d©a
 = "";

352 if(
couÁ
(
$ps
)>1)

354 
	g$i
=1;$i<
couÁ
(
$ps
);$i++)

356 
	g$po¡d©a
 .ğ
$ps
[
$i
];

361 
	g$po¡d©a
 = "OK";

363 
	g$¶’
 = 
¡¾’
(
$po¡d©a
);

364 
åuts
(
$this
->
m_å
,"Content-Type:‡pplication/x-www-form-urlencoded\r\n");

365 
åuts
(
$this
->
m_å
,"Content-Length: $plen\r\n");

370 if(
	g$h‰pv
=="HTTP/1.1")

372 
åuts
(
$this
->
m_å
,"Connection: Close\r\n\r\n");

376 
åuts
(
$this
->
m_å
,"\r\n");

378 if(
	g$»que¡Ty³
=="POST")

380 
åuts
(
$this
->
m_å
,
$po¡d©a
);

384 
	g$h‰p¡as
 = 
ex¶ode
(" ",
fg‘s
(
$this
->
m_å
,256));

385 
	g$this
->
	gm_h‰ph—d
["h‰p-ed™iÚ"] = 
Œim
(
$h‰p¡as
[0]);

386 
	g$this
->
	gm_h‰ph—d
["h‰p-¡©e"] = 
Œim
(
$h‰p¡as
[1]);

387 
	g$this
->
	gm_h‰ph—d
["http-describe"] = "";

388 
	g$i
=2;$i<
couÁ
(
$h‰p¡as
);$i++)

390 
	g$this
->
	gm_h‰ph—d
["h‰p-desüibe"] .ğ" ".
Œim
(
$h‰p¡as
[
$i
]);

394 !
ãof
(
$this
->
m_å
))

396 
	g$lše
 = 
Œim
(
fg‘s
(
$this
->
m_å
,256));

397 if(
	g$lše
 == "")

401 
	g$hkey
 = "";

402 
	g$hv®ue
 = "";

403 
	g$v
 = 0;

404 
	g$i
=0;$i<
¡¾’
(
$lše
);$i++)

406 if(
	g$v
==1)

408 
$hv®ue
 .ğ
$lše
[
$i
];

410 if(
	g$lše
[
$i
]==":")

412 
$v
 = 1;

414 if(
	g$v
==0)

416 
$hkey
 .ğ
$lše
[
$i
];

419 
	g$hkey
 = 
Œim
(
$hkey
);

420 if(
	g$hkey
!="")

422 
$this
->
m_h‰ph—d
[
¡¹Şow”
(
$hkey
)] = 
Œim
(
$hv®ue
);

427 if(
ãof
(
$this
->
m_å
))

429 if(
	g$this
->
	g»Try
 > 10)

431  
	gFALSE
;

433 
	g$this
->
Priv©eS¹SessiÚ
(
$»que¡Ty³
);

437 if(
´eg_m©ch
("/^3/",
$this
->
m_h‰ph—d
["http-state"]))

439 if(
	g$this
->
	gJumpCouÁ
 > 3)

443 if(
is£t
(
$this
->
m_h‰ph—d
["location"]))

445 
	g$Ãwu¾
 = 
$this
->
m_h‰ph—d
["location"];

446 if(
´eg_m©ch
("/^h‰p/i",
$Ãwu¾
))

448 
	g$this
->
JumpO³nU¾
(
$Ãwu¾
);

452 
	g$Ãwu¾
 = 
$this
->
FlU¾
(
$Ãwu¾
);

453 
	g$this
->
JumpO³nU¾
(
$Ãwu¾
);

458 
	g$this
->
	gm_”rÜ
 = "æ— æ³•è¯†åˆ«çš„ç­”å¤ï¼";

470 
funùiÚ
 
	$G‘H—d
(
$h—dÇme
)

472 
$h—dÇme
 = 
	`¡¹Şow”
($headname);

473  
	`is£t
(
$this
->
m_h‰ph—d
[
$h—dÇme
]) ? $this->m_httphead[$headname] : '';

474 
	}
}

484 
funùiÚ
 
	$S‘H—d
(
$skey
,
$sv®ue
)

486 
$this
->
m_puth—d
[
$skey
] = 
$sv®ue
;

487 
	}
}

495 
funùiÚ
 
	$Priv©eO³nHo¡
()

497 if(
$this
->
m_ho¡
=="")

499  
FALSE
;

501 
$”ºo
 = "";

502 
$”r¡r
 = "";

503 
$this
->
m_å
 = @
	`fsockİ’
($this->
m_ho¡
, $this->
m_pÜt
, 
$”ºo
, 
$”r¡r
,10);

504 if(!
$this
->
m_å
)

506 
$this
->
m_”rÜ
 = 
$”r¡r
;

507  
FALSE
;

511  
TRUE
;

513 
	}
}

521 
funùiÚ
 
	$Clo£
()

523 @
	`fşo£
(
$this
->
m_å
);

524 
	}
}

533 
funùiÚ
 
	$FlU¾
(
$su¾
)

535 
$i
 = 0;

536 
$d¡r
 = "";

537 
$p¡r
 = "";

538 
$oku¾
 = "";

539 
$·thS‹p
 = 0;

540 
$su¾
 = 
	`Œim
($surl);

541 if(
$su¾
=="")

545 
$pos
 = 
	`¡½os
(
$su¾
,"#");

546 if(
$pos
>0)

548 
$su¾
 = 
	`sub¡r
($su¾,0,
$pos
);

550 if(
$su¾
[0]=="/")

552 
$oku¾
 = "h‰p://".
$this
->
HomeU¾
.
$su¾
;

554 if(
$su¾
[0]==".")

556 if(
	`¡¾’
(
$su¾
)<=1)

560 if(
$su¾
[1]=="/")

562 
$oku¾
 = "h‰p://".
$this
->
Ba£U¾P©h
."/".
	`sub¡r
(
$su¾
,2,
	`¡¾’
($surl)-2);

566 
$u¾s
 = 
	`ex¶ode
("/",
$su¾
);

567 
	`fÜ—ch
(
$u¾s
 
as
 
$u
)

569 if(
$u
=="..")

571 
$·thS‹p
++;

573 if(
$i
<
	`couÁ
(
$u¾s
)-1)

575 
$d¡r
 .ğ
$u¾s
[
$i
]."/";

579 
$d¡r
 .ğ
$u¾s
[
$i
];

581 
$i
++;

583 
$u¾s
 = 
	`ex¶ode
("/",
$this
->
Ba£U¾P©h
);

584 if(
	`couÁ
(
$u¾s
è<ğ
$·thS‹p
)

590 
$p¡r
 = "http://";

591 
$i
=0;$i<
	`couÁ
(
$u¾s
)-
$·thS‹p
;$i++)

593 
$p¡r
 .ğ
$u¾s
[
$i
]."/";

595 
$oku¾
 = 
$p¡r
.
$d¡r
;

601 if(
	`¡¾’
(
$su¾
)<7)

603 
$oku¾
 = "h‰p://".
$this
->
Ba£U¾P©h
."/".
$su¾
;

605 if(
	`¡¹Şow”
(
	`sub¡r
(
$su¾
,0,7))=="http://")

607 
$oku¾
 = 
$su¾
;

611 
$oku¾
 = "h‰p://".
$this
->
Ba£U¾P©h
."/".
$su¾
;

614 
$oku¾
 = 
	`´eg_»¶aû
("/^(http:\/\/)/i","",$okurl);

615 
$oku¾
 = 
	`´eg_»¶aû
("/\/{1,}/", "/", $okurl);

616  "h‰p://".
$oku¾
;

617 
	}
}

	@E:\web\weixun\functions\xakmodule.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

8 
»quœe_Úû
(
XAKINC
.'/charset.func.php');

9 
»quœe_Úû
(
XAKINC
.'/xakatt.class.php');

10 
»quœe_Úû
(
XAKINC
.'/xakhttpdown.class.php');

12 şas 
	cXakModuË


14 
v¬
 
	m$moduËsP©h
;

15 
v¬
 
	m$moduËsU¾
;

16 
v¬
 
	m$moduËs
;

17 
v¬
 
	m$feLi¡Names
;

18 
v¬
 
	m$sysLªg
;

19 
v¬
 
	m$moduËLªg
;

20 
funùiÚ
 
__cÚ¡ruù
(
$moduË¥©h
='',
$moduËsU¾
='')

22 
glob®
 
$cfg_soá_Ïng
;

23 
	m$this
->
	msysLªg
 = 
$this
->
moduËLªg
 = 
$cfg_soá_Ïng
;

24 
	m$this
->
	mfeLi¡Names
 = 
¬¿y
();

25 
	m$this
->
	mmoduËsP©h
 = 
$moduË¥©h
;

26 
	m$this
->
	mmoduËsU¾
 = 
$moduËsU¾
;

28 
funùiÚ
 
XakModuË
(
$moduË¥©h
='')

30 
$this
->
__cÚ¡ruù
(
$moduË¥©h
);

40 
funùiÚ
 
G‘ModuËLi¡
(
$moduËty³
='')

42 if(
is_¬¿y
(
$this
->
moduËs
))  $this->modules;

44 
	g$dh
 = 
dœ
(
$this
->
moduËsP©h
è
Ü
 
d›
("æ²¡æ‰¾åˆ°æ¨¡å—ç›®å½•ï¼š({$this->modulesPath})ï¼");

46 
	g$å
 = @
fİ’
(
$this
->
moduËsP©h
.'/moduËsÿche.php','w'è
Ü
 
d›
('è¯»å–æ–‡ä»¶æƒé™å‡ºé”™,ç›®å½•æ–‡ä»¶'.$this->modulesPath.'/modulescache.phpä¸å¯å†™!');

48 
fwr™e
(
$å
, "<"."?php\r\n");

49 
fwr™e
(
$å
, "global \$allmodules;\r\n");

50 
	g$f’ame
 = 
$dh
->
»ad
())

52 if(
´eg_m©ch
("/\.xml$/i", 
$f’ame
))

54 
$mšfos
 = 
$this
->
G‘ModuËInfo
(
¡r_»¶aû
('.xml','',
$f’ame
));

55 if(
is£t
(
$mšfos
['moduËty³']è&& 
	g$moduËty³
!='' && 
$moduËty³
!=$minfos['moduletype'])

59 if(
	g$mšfos
['hash']!='')

61 
$this
->
moduËs
[
$mšfos
['hash']] = $minfos;

62 
fwr™e
(
$å
, '$'."GLOBALS['allmodules']['{$minfos['hash']}']='{$filename}';\r\n");

66 
fwr™e
(
$å
,'?'.'>');

67 
fşo£
(
$å
);

68 
	g$dh
->
Clo£
();

69  
	g$this
->
	gmoduËs
;

79 
funùiÚ
 
G‘ModuËU¾Li¡
(
$moduËty³
='',
$u¾
='')

81 
$dh
 = 
dœ
(
$this
->
moduËsP©h
è
Ü
 
d›
("æ²¡æ‰¾åˆ°æ¨¡å—ç›®å½•ï¼š({$this->modulesPath})ï¼");

82 
	g$å
 = @
fİ’
(
$this
->
moduËsP©h
.'/moduËsÿche.php','w'è
Ü
 
d›
('è¯»å–æ–‡ä»¶æƒé™å‡ºé”™,ç›®å½•æ–‡ä»¶'.$this->modulesPath.'/modulescache.phpä¸å¯å†™!');

83 
	g$ÿchefe
 = 
XAKDATA
.'/module/moduleurllist.txt';

84 
	g$»mÙ–i¡
 = '';

85 if(
fe_exi¡s
(
$ÿchefe
è&& (
femtime
($ÿchefeè+ 60 * 30è> 
time
())

88 
	g$»mÙ–i¡
 = 
fe_g‘_cÚ‹Ás
(
$ÿchefe
);

90 
	g$d–
 = 
Ãw
 
XakH‰pDown
();

91 
	g$d–
->
O³nU¾
(
$u¾
);

92 
	g$»mÙ–i¡
 = 
$d–
->
G‘Html
();

93 
PutFe
(
$ÿchefe
, 
$»mÙ–i¡
);

95 if(
em±y
(
$»mÙ–i¡
)è 
	gçl£
;

97 
	g$moduËs
 = 
un£rŸlize
(
$»mÙ–i¡
);

98 if(
em±y
(
$moduËty³
)){

99  
	g$moduËs
;

101 
	g$»tuº
 = 
¬¿y
();

102 
fÜ—ch
(
$moduËs
 
as
 
$¬row
=>
$d©a
) {

103 if(
$d©a
['moduËty³']==
$moduËty³
)

104 
$»tuº
[] = 
$d©a
;

106  
	g$»tuº
;

115 
funùiÚ
 
	$AµCode
(&
$¡r
)

117 if(
$this
->
moduËLªg
==$this->
sysLªg
)

119  
$¡r
;

123 if(
$this
->
sysLªg
=='utf-8')

125 if(
$this
->
moduËLªg
=='gbk'è 
	`gb2utf8
(
$¡r
);

126 if(
$this
->
moduËLªg
=='big5'è 
	`gb2utf8
(
	`big52gb
(
$¡r
));

128 if(
$this
->
sysLªg
=='gbk')

130 if(
$this
->
moduËLªg
=='utf-8'è 
	`utf82gb
(
$¡r
);

131 if(
$this
->
moduËLªg
=='big5'è 
	`big52gb
(
$¡r
);

133 if(
$this
->
sysLªg
=='big5')

135 if(
$this
->
moduËLªg
=='utf-8'è 
	`gb2big5
(
	`utf82gb
(
$¡r
));

136 if(
$this
->
moduËLªg
=='gbk'è 
	`gb2big5
(
$¡r
);

140  
$¡r
;

143 
	}
}

152 
funùiÚ
 
	$G‘HashFe
(
$hash
)

154 
	`šşude_Úû
(
$this
->
moduËsP©h
.'/modulescache.php');

155 if(
	`is£t
(
$GLOBALS
['®lmoduËs'][
$hash
]))  $GLOBALS['allmodules'][$hash];

156  
$hash
.'.xml';

157 
	}
}

167 
funùiÚ
 
G‘ModuËInfo
(
$hash
, 
$áy³
='hash')

169 if(
$áy³
=='fe'è
$f’ame
 = 
$hash
;

170 if(!
em±y
(
$this
->
moduËsU¾
)) {

171 
	g$f’ame
 = 
$this
->
moduËsU¾
.
$hash
.'.xml';

172 }
	g$f’ame
 = 
$this
->
moduËsP©h
.'/'.$this->
G‘HashFe
(
$hash
);

173 
	g$¡¬t
 = 0;

174 
	g$mšfos
 = 
¬¿y
();

175 
	g$mšfos
['Çme']=
$mšfos
['team']=$minfos['time']=$minfos['email']=$minfos['url']='';

176 
	g$mšfos
['hash']=
$mšfos
['indexname']=$minfos['indexurl']='';

177 
	g$mšfos
['ismemb”']=
$mšfos
['autosetup']=$minfos['autodel']=0;

179 if(
em±y
(
$this
->
moduËsU¾
)){

180 
	g$mšfos
['fesize'] = 
fesize
(
$f’ame
)/1024;

181 
	g$mšfos
['fesize'] = 
numb”_fÜm©
(
$mšfos
['filesize'],2,'.','').' Kb';

183 
	g$å
 = 
fİ’
(
$f’ame
,'r'è
Ü
 
d›
("æ–‡ä»¶ {$filename} ä¸å­˜åœ¨æˆ–ä¸å¯è¯»!");

184 
	g$n
 = 0;

185 !
ãof
(
$å
))

187 
	g$n
++;

188 if(
	g$n
 > 30) ;

189 
	g$lše
 = 
fg‘s
(
$å
,256);

190 if(
	g$¡¬t
==0)

191 { if(
´eg_m©ch
("/<ba£šfo/is",
$lše
)è
$¡¬t
 = 1; }

194 if(
´eg_m©ch
("/<\/ba£šfo/is",
$lše
)) ;

195 
	g$lše
 = 
Œim
(
$lše
);

196 
li¡
(
$skey
,
$sv®ue
èğ
ex¶ode
('=',
$lše
);

197 
	g$skey
 = 
Œim
(
$skey
);

198 
	g$mšfos
[
$skey
] = 
$sv®ue
;

201 
fşo£
(
$å
);

203 if(
is£t
(
$mšfos
['Ïng'])è
	g$this
->
	gmoduËLªg
 = 
Œim
($minfos['lang']);

204 
	g$this
->
	gmoduËLªg
 = 'gbk';

206 if(
	g$this
->
	gsysLªg
=='gb2312'è
$this
->
sysLªg
 = 'gbk';

207 if(
	g$this
->
	gmoduËLªg
=='gb2312'è
$this
->
moduËLªg
 = 'gbk';

209 if(
	g$this
->
	gsysLªg
 !ğ
$this
->
moduËLªg
)

211 
fÜ—ch
(
$mšfos
 
as
 
$k
=>
$v
è$mšfos[$k] = 
$this
->
AµCode
($v);

214  
	g$mšfos
;

225 
funùiÚ
 
G‘FeXml
(
$hash
, 
$áy³
='hash')

227 if(
$áy³
=='fe'è
$f’ame
 = 
$hash
;

228 
	g$f’ame
 = 
$this
->
moduËsP©h
.'/'.$this->
G‘HashFe
(
$hash
);

229 
	g$fexml
 = '';

230 
	g$å
 = 
fİ’
(
$f’ame
,'r'è
Ü
 
d›
("æ–‡ä»¶ {$filename} ä¸å­˜åœ¨æˆ–ä¸å¯è¯»!");

231 
	g$¡¬t
 = 0;

232 !
ãof
(
$å
))

234 
	g$lše
 = 
fg‘s
(
$å
,1024);

235 if(
	g$¡¬t
==0)

237 if(
´eg_m©ch
("/<moduËfes/is",
$lše
))

239 
$fexml
 .ğ
$lše
;

240 
	g$¡¬t
 = 1;

246 
	g$fexml
 .ğ
$lše
;

249 
fşo£
(
$å
);

250  
	g$fexml
;

263 
funùiÚ
 
	$G‘Sy¡emFe
(
$hashcode
, 
$Áy³
, 
$’Code
=
TRUE
)

265 
$this
->
	`G‘ModuËInfo
(
$hashcode
,
$Áy³
);

266 
$¡¬t
 = 
FALSE
;

267 
$f’ame
 = 
$this
->
moduËsP©h
.'/'.$this->
	`G‘HashFe
(
$hashcode
);

268 
$å
 = 
	`fİ’
(
$f’ame
,'r'è
Ü
 
	`d›
("æ–‡ä»¶ {$filename} ä¸å­˜åœ¨æˆ–ä¸å¯è¯»!");

269 
$okd©a
 = '';

270 !
	`ãof
(
$å
))

272 
$lše
 = 
	`fg‘s
(
$å
,1024);

273 if(!
$¡¬t
)

276 if(
	`´eg_m©ch
("#<{$Áy³}>#i", 
$lše
)è
$¡¬t
 = 
TRUE
;

280 if(
	`´eg_m©ch
("#<\/{$Áy³}#i", 
$lše
)) ;

281 
$okd©a
 .ğ
$lše
;

282 
	`un£t
(
$lše
);

285 
	`fşo£
(
$å
);

286 
$okd©a
 = 
	`Œim
($okdata);

287 if(!
	`em±y
(
$okd©a
è&& 
$’Code
è$okd©¨ğ
	`ba£64_decode
($okdata);

288 
$okd©a
 = 
$this
->
	`AµCode
($okdata);

289  
$okd©a
;

290 
	}
}

300 
funùiÚ
 
	$Wr™eSy¡emFe
(
$hashcode
, 
$Áy³
)

302 
$f’ame
 = 
$hashcode
."-{$ntype}.php";

303 
$âame
 = 
$this
->
moduËsP©h
.'/'.
$f’ame
;

304 
$feù
 = 
$this
->
	`G‘Sy¡emFe
(
$hashcode
,
$Áy³
);

305 
$å
 = 
	`fİ’
(
$âame
,'w'è
Ü
 
	`d›
('ç”Ÿæˆ {$ntype} æ–‡ä»¶å¤±è´¥ï¼');

306 
	`fwr™e
(
$å
,
$feù
);

307 
	`fşo£
(
$å
);

308  
$f’ame
;

309 
	}
}

319 
funùiÚ
 
	$D–Sy¡emFe
(
$hashcode
,
$Áy³
)

321 
$f’ame
 = 
$this
->
moduËsP©h
.'/'.
$hashcode
."-{$ntype}.php";

322 
	`uÆšk
(
$f’ame
);

323 
	}
}

332 
funùiÚ
 
	$HasModuË
(
$hashcode
)

334 
$moduËfe
 = 
$this
->
moduËsP©h
.'/'.$this->
	`G‘HashFe
(
$hashcode
);

335 if(
	`fe_exi¡s
(
$moduËfe
è&& !
	`is_dœ
($moduËfe)è 
TRUE
;

336  
FALSE
;

337 
	}
}

347 
funùiÚ
 
	$G‘EncodeFe
(
$f’ame
,
$i¤emove
=
FALSE
)

349 
$å
 = 
	`fİ’
(
$f’ame
,'r'è
Ü
 
	`d›
("æ–‡ä»¶ {$filename} ä¸å­˜åœ¨æˆ–ä¸å¯è¯»!");

350 
$¡r
 = @
	`ä—d
(
$å
,
	`fesize
(
$f’ame
));

351 
	`fşo£
(
$å
);

352 if(
$i¤emove
è@
	`uÆšk
(
$f’ame
);

353 if(!
	`em±y
(
$¡r
)è 
	`ba£64_’code
($str);

355 
	}
}

364 
funùiÚ
 
	$G‘FeLi¡s
(
$hashcode
)

366 
$d­
 = 
Ãw
 
	`XakA‰P¬£
();

367 
$f–i¡s
 = 
	`¬¿y
();

368 
$moduËfe
 = 
$this
->
moduËsP©h
.'/'.$this->
	`G‘HashFe
(
$hashcode
);

369 
$å
 = 
	`fİ’
(
$moduËfe
,'r'è
Ü
 
	`d›
("æ–‡ä»¶ {$modulefile} ä¸å­˜åœ¨æˆ–ä¸å¯è¯»!");

370 
$i
 = 0;

371 !
	`ãof
(
$å
))

373 
$lše
 = 
	`fg‘s
(
$å
,1024);

374 if(
	`´eg_m©ch
("/^[\s]{0,}<fe/i",
$lše
))

376 
$i
++;

377 
$lše
 = 
	`Œim
(
	`´eg_»¶aû
("/[><]/","",$line));

378 
$d­
->
	`S‘Sourû
(
$lše
);

379 
$f–i¡s
[
$i
]['ty³'] = 
$d­
->
CA‰
->
	`G‘A‰
('type');

380 
$f–i¡s
[
$i
]['Çme'] = 
$d­
->
CA‰
->
	`G‘A‰
('name');

383 
	`fşo£
(
$å
);

384  
$f–i¡s
;

385 
	}
}

395 
funùiÚ
 
	$D–‘eFes
(
$hashcode
,
$i¤•Ïû
=0)

397 if(
$i¤•Ïû
==0è 
TRUE
;

400 
$d­
 = 
Ãw
 
	`XakA‰P¬£
();

401 
$moduËfe
 = 
$this
->
moduËsP©h
.'/'.$this->
	`G‘HashFe
(
$hashcode
);

402 
$å
 = 
	`fİ’
(
$moduËfe
,'r'è
Ü
 
	`d›
("æ–‡ä»¶ {$modulefile} ä¸å­˜åœ¨æˆ–ä¸å¯è¯»!");

403 
$i
 = 0;

404 
$dœs
 = '';

405 !
	`ãof
(
$å
))

407 
$lše
 = 
	`fg‘s
(
$å
,1024);

408 if(
	`´eg_m©ch
("/^[\s]{0,}<fe/i",
$lše
))

410 
$i
++;

411 
$lše
 = 
	`Œim
(
	`´eg_»¶aû
("/[><]/","",$line));

412 
$d­
->
	`S‘Sourû
(
$lše
);

413 
$f‘y³
 = 
$d­
->
CA‰
->
	`G‘A‰
('type');

414 
$f’ame
 = 
$d­
->
CA‰
->
	`G‘A‰
('name');

415 
$f’ame
 = 
	`¡r_»¶aû
("\\","/",$filename);

416 if(
$f‘y³
=='dœ'){ 
$dœs
[] = 
$f’ame
; }

417 { @
	`uÆšk
(
$f’ame
); }

420 
$okdœs
 = 
	`¬¿y
();

421 if(
	`is_¬¿y
(
$dœs
)){

422 
$¡
 = 
	`couÁ
(
$dœs
) -1;

423 
$i
=
$¡
;$i>=0;$i--){ @
	`rmdœ
(
$dœs
[$i]); }

425 
	`fşo£
(
$å
);

427  
TRUE
;

428 
	}
}

438 
funùiÚ
 
	$Wr™eFes
(
$hashcode
, 
$i¤•Ïû
=3)

440 
glob®
 
$AdmšBa£Dœ
;

441 
$d­
 = 
Ãw
 
	`XakA‰P¬£
();

442 
$moduËfe
 = 
$this
->
moduËsP©h
.'/'.$this->
	`G‘HashFe
(
$hashcode
);

443 
$å
 = 
	`fİ’
(
$moduËfe
,'r'è
Ü
 
	`d›
("æ–‡ä»¶ {$modulefile} ä¸å­˜åœ¨æˆ–ä¸å¯è¯»!");

444 
$i
 = 0;

445 !
	`ãof
(
$å
))

447 
$lše
 = 
	`fg‘s
(
$å
,1024);

448 ifĞ
	`´eg_m©ch
("/^[\s]{0,}<fe/i",
$lše
) )

450 
$i
++;

451 
$lše
 = 
	`Œim
(
	`´eg_»¶aû
("/[><]/","",$line));

452 
$d­
->
	`S‘Sourû
(
$lše
);

453 
$f‘y³
 = 
$d­
->
CA‰
->
	`G‘A‰
('type');

454 
$f’ame
 = 
$d­
->
CA‰
->
	`G‘A‰
('name');

455 
$f’ame
 = 
	`¡r_»¶aû
("\\","/",$filename);

456 if(!
	`em±y
(
$AdmšBa£Dœ
)è
$f’ame
 = $AdminBaseDir.$filename;

457 if(
$f‘y³
=='dir')

459 if(!
	`is_dœ
(
$f’ame
))

461 @
	`mkdœ
(
$f’ame
,
$GLOBALS
['cfg_dir_purview']);

463 @
	`chmod
(
$f’ame
,
$GLOBALS
['cfg_dir_purview']);

467 
$this
->
	`Te¡Dœ
(
$f’ame
);

468 if(
$i¤•Ïû
==0) ;

469 if(
$i¤•Ïû
==3)

471 if(
	`is_fe
(
$f’ame
))

473 
$cİyÇme
 = @
	`´eg_»¶aû
("/([^\/]{1,}$)/","bak-$1",
$f’ame
);

474 @
	`cİy
(
$f’ame
,
$cİyÇme
);

477 if(!
	`em±y
(
$f’ame
))

479 
$fw
 = 
	`fİ’
(
$f’ame
,'w'è
Ü
 
	`d›
("å†™å…¥æ–‡ä»¶ {$filename} å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç›¸å…³ç›®å½•çš„æƒé™ï¼");

480 
$ù
 = '';

481 !
	`ãof
(
$å
))

483 
$l
 = 
	`fg‘s
(
$å
,1024);

484 if(
	`´eg_m©ch
("/^[\s]{0,}<\/fe/i",
	`Œim
(
$l
))){ ; }

485 
$ù
 .ğ
$l
;

487 
$ù
 = 
	`ba£64_decode
($ct);

488 if(
$this
->
sysLªg
!=$this->
moduËLªg
)

491 if(
	`´eg_m©ch
('/\.(xml|php|šc|txt|htm|html|shtml|l|css)$/', 
$f’ame
))

493 
$ù
 = 
$this
->
	`AµCode
($ct);

496 if(
	`´eg_m©ch
('/\.Õhp|htm|html|shtml|šc|l)$/i', 
$f’ame
))

498 if(
$this
->
sysLªg
=='big5'è
$ch¬£t
 = 'charset=big5';

499 if(
$this
->
sysLªg
=='utf-8'è
$ch¬£t
 = 'charset=gb2312';

500 
$ch¬£t
 = 'charset=gb2312';

501 
$ù
 = 
	`´eg_m©ch
("/ch¬£t=([a-z0-9-]*)/i", 
$ch¬£t
, $ct);

504 
	`fwr™e
(
$fw
,
$ù
);

505 
	`fşo£
(
$fw
);

510 
	`fşo£
(
$å
);

511  
TRUE
;

512 
	}
}

521 
funùiÚ
 
	$Te¡Dœ
(
$f’ame
)

523 
$fs
 = 
	`ex¶ode
('/',
$f’ame
);

524 
$â
 = 
	`couÁ
(
$fs
) - 1 ;

525 
$ndœ
 = '';

526 
$i
=0;$˜< 
$â
;$i++)

528 if(
$ndœ
!=''è$ndœ = $ndœ.'/'.
$fs
[
$i
];

529 
$ndœ
 = 
$fs
[
$i
];

530 
$rs
 = @
	`is_dœ
(
$ndœ
);

531 ifĞ!
$rs
 ) {

532 @
	`mkdœ
(
$ndœ
,
$GLOBALS
['cfg_dir_purview']);

533 @
	`chmod
(
$ndœ
,
$GLOBALS
['cfg_dir_purview']);

536  
TRUE
;

537 
	}
}

548 
funùiÚ
 
	$MakeEncodeFe
(
$ba£dœ
,
$f
,
$å
)

550 
$this
->
feLi¡Names
 = 
	`¬¿y
();

551 
$this
->
	`MakeEncodeFeRun
(
$ba£dœ
,
$f
,
$å
);

552  
TRUE
;

553 
	}
}

563 
funùiÚ
 
	$MakeEncodeFeTe¡
(
$ba£dœ
,
$f
)

565 
$this
->
feLi¡Names
 = 
	`¬¿y
();

566 
$this
->
	`MakeEncodeFeRunTe¡
(
$ba£dœ
,
$f
);

567  
TRUE
;

568 
	}
}

578 
funùiÚ
 
	$MakeEncodeFeRunTe¡
(
$ba£dœ
,
$f
)

580 
$f’ame
 = 
$ba£dœ
.'/'.
$f
;

581 if(
	`is£t
(
$this
->
feLi¡Names
[
$f
])) ;

582 if(
	`´eg_m©ch
("/Thumbs\.db/i",
$f
)) ;

583 
$this
->
feLi¡Names
[
$f
] = 1;

584 
$feLi¡
 = '';

585 if(!
	`fe_exi¡s
(
$f’ame
))

587 
	`ShowMsg
("æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹: {$filename} ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œç¼–è¯‘!","-1");

588 
	`ex™
();

590 if(
	`is_dœ
(
$f’ame
))

592 
$dh
 = 
	`dœ
(
$f’ame
);

593 
$f’ame
 = 
$dh
->
	`»ad
())

595 if(
$f’ame
[0]=='.' || 
	`¡¹Şow”
($filename)=='cvs') ;

596 
$nf’ame
 = 
$f
.'/'.
$f’ame
;

597 
$this
->
	`MakeEncodeFeRunTe¡
(
$ba£dœ
,
$nf’ame
);

600 
	}
}

611 
funùiÚ
 
	$MakeEncodeFeRun
(
$ba£dœ
,
$f
,
$å
)

613 
$f’ame
 = 
$ba£dœ
.'/'.
$f
;

614 if(
	`is£t
(
$this
->
feLi¡Names
[
$f
])) ;

615 if(
	`´eg_m©ch
("#Thumbs\.db#i", 
$f
)) ;

616 
$this
->
feLi¡Names
[
$f
] = 1;

617 
$feLi¡
 = '';

618 if(
	`is_dœ
(
$f’ame
))

620 
$feLi¡
 .= "<fileype='dir'‚ame='$f'>\r\n";

621 
$feLi¡
 .= "</file>\r\n";

622 
	`fwr™e
(
$å
,
$feLi¡
);

623 
$dh
 = 
	`dœ
(
$f’ame
);

624 
$f’ame
 = 
$dh
->
	`»ad
())

626 if(
$f’ame
[0]=='.' || 
	`¡¹Şow”
($filename)=='cvs') ;

627 
$nf’ame
 = 
$f
.'/'.
$f’ame
;

628 
$this
->
	`MakeEncodeFeRun
(
$ba£dœ
,
$nf’ame
,
$å
);

633 
$feLi¡
 .= "<fileype='file'‚ame='$f'>\r\n";

634 
$feLi¡
 .ğ
$this
->
	`G‘EncodeFe
(
$f’ame
);

635 
$feLi¡
 .= "\r\n</file>\r\n";

636 
	`fwr™e
(
$å
,
$feLi¡
);

638 
	}
}

646 
funùiÚ
 
	$CË¬
()

648 
	`un£t
(
$this
->
moduËs
);

649 
	`un£t
(
$this
->
feLi¡
);

650 
	`un£t
(
$this
->
feLi¡Names
);

651 
	}
}

	@E:\web\weixun\functions\xaksql.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

4 
	g$dsql
 = 
$db
 = 
Ãw
 
XakSql
(
FALSE
);

8 şas 
	cXakSql


10 
v¬
 
	m$lškID
;

11 
v¬
 
	m$dbHo¡
;

12 
v¬
 
	m$dbU£r
;

13 
v¬
 
	m$dbPwd
;

14 
v¬
 
	m$dbName
;

15 
v¬
 
	m$dbP»fix
;

16 
v¬
 
	m$»suÉ
;

17 
v¬
 
	m$qu”ySŒšg
;

18 
v¬
 
	m$·¿m‘”s
;

19 
v¬
 
	m$isClo£
;

20 
v¬
 
	m$§ãCheck
;

21 
v¬
 
	m$»cÜdLog
=
çl£
;

22 
v¬
 
	m$isIn™
=
çl£
;

23 
v¬
 
	m$pcÚÃù
=
çl£
;

27 
funùiÚ
 
	$__cÚ¡ruù
(
$pcÚÃù
=
FALSE
,
$ncÚÃù
=FALSE)

29 
$this
->
isClo£
 = 
FALSE
;

30 
$this
->
§ãCheck
 = 
çl£
;

31 
$this
->
pcÚÃù
 = 
$pcÚÃù
;

32 if(
$ncÚÃù
)

34 
$this
->
	`In™
(
$pcÚÃù
);

38 
funùiÚ
 
	$XakSql
(
$pcÚÃù
=
FALSE
,
$ncÚÃù
=
TRUE
)

40 
$this
->
	`__cÚ¡ruù
(
$pcÚÃù
,
$ncÚÃù
);

41 
	}
}

43 
funùiÚ
 
	$In™
(
$pcÚÃù
=
FALSE
)

45 
$this
->
lškID
 = 0;

48 
$this
->
dbHo¡
 = 
$GLOBALS
['cfg_dbhost'];

49 
$this
->
dbU£r
 = 
$GLOBALS
['cfg_dbuser'];

50 
$this
->
dbPwd
 = 
$GLOBALS
['cfg_dbpwd'];

51 
$this
->
dbName
 = 
$GLOBALS
['cfg_dbname'];

52 
$this
->
dbP»fix
 = 
$GLOBALS
['cfg_dbprefix'];

53 
$this
->
»suÉ
["me"] = 0;

54 
$this
->
	`O³n
(
$pcÚÃù
);

55 
	}
}

58 
funùiÚ
 
S‘Sourû
(
$ho¡
,
$u£ºame
,
$pwd
,
$dbÇme
,
$db´efix
="xak_")

60 
$this
->
dbHo¡
 = 
$ho¡
;

61 
	g$this
->
	gdbU£r
 = 
$u£ºame
;

62 
	g$this
->
	gdbPwd
 = 
$pwd
;

63 
	g$this
->
	gdbName
 = 
$dbÇme
;

64 
	g$this
->
	gdbP»fix
 = 
$db´efix
;

65 
	g$this
->
	g»suÉ
["me"] = 0;

67 
funùiÚ
 
	$S–eùDB
(
$dbÇme
)

69 
	`mysql_£Ëù_db
(
$dbÇme
);

70 
	}
}

73 
funùiÚ
 
	$S‘P¬am‘”
(
$key
,
$v®ue
)

75 
$this
->
·¿m‘”s
[
$key
]=
$v®ue
;

76 
	}
}

79 
funùiÚ
 
	$O³n
(
$pcÚÃù
=
FALSE
)

81 
glob®
 
$dsql
;

83 if(
$dsql
 && !$dsql->
isClo£
 && $dsql->
isIn™
)

85 
$this
->
lškID
 = 
$dsql
->linkID;

89 
$i
 = 0;

91 !
$this
->
lškID
)

93 ià(
$i
 > 100) ;

95 if(!
$pcÚÃù
)

97 
$this
->
lškID
 = @
	`mysql_cÚÃù
($this->
dbHo¡
,$this->
dbU£r
,$this->
dbPwd
);

101 
$this
->
lškID
 = @
	`mysql_pcÚÃù
($this->
dbHo¡
,$this->
dbU£r
,$this->
dbPwd
);

103 
$i
++;

107 
	`CİySQLPošt
(
$this
);

111 if(!
$this
->
lškID
)

113 
$this
->
	`Di¥ÏyE¼Ü
("<font color='red'>è¿æ¥æ•°æ®åº“å¤±è´¥ï¼Œå¯èƒ½æ•°æ®åº“å¯†ç ä¸å¯¹æˆ–æ•°æ®åº“æœåŠ¡å™¨å‡ºé”™ï¼</font>");

114 
	`ex™
();

116 
$this
->
isIn™
 = 
TRUE
;

117 @
	`mysql_£Ëù_db
(
$this
->
dbName
);

118 
$mysqlv”
 = 
	`ex¶ode
('.',
$this
->
	`G‘V”siÚ
());

119 
$mysqlv”
 = $mysqlver[0].'.'.$mysqlver[1];

121 if(
$mysqlv”
>4.0)

123 @
	`mysql_qu”y
("SET NAMES '".
$GLOBALS
['cfg_db_Ïnguage']."', ch¬aù”_£t_ş›Á=bš¬y, sql_mode='', iÁ”aùive_timeout=3600 ;", 
$this
->
lškID
);

126  
TRUE
;

127 
	}
}

130 
funùiÚ
 
	$S‘LÚgLšk
()

132 @
	`mysql_qu”y
("SET iÁ”aùive_timeout=3600, wa™_timeout=3600 ;", 
$this
->
lškID
);

133 
	}
}

136 
funùiÚ
 
	$G‘E¼Ü
()

138 
$¡r
 = 
	`mysql_”rÜ
();

139  
$¡r
;

140 
	}
}

145 
funùiÚ
 
	$Clo£
(
$isok
=
FALSE
)

147 
$this
->
	`F»eResuÉAÎ
();

148 if(
$isok
)

150 @
	`mysql_şo£
(
$this
->
lškID
);

151 
$this
->
isClo£
 = 
TRUE
;

152 
$GLOBALS
['dsql'] = 
NULL
;

154 
	}
}

157 
funùiÚ
 
	$CË¬E¼Lšk
()

159 
	}
}

162 
funùiÚ
 
	$Clo£Lšk
(
$dblšk
)

164 @
	`mysql_şo£
(
$dblšk
);

165 
	}
}

167 
funùiÚ
 
	$Esc
Ğ
$_¡r
 )

169 iàĞ
	`v”siÚ_com·»
Ğ
	`phpv”siÚ
(), '4.3.0', '>=' ) )

171  @
	`mysql_»®_esÿ³_¡ršg
Ğ
$_¡r
 );

173  @
	`mysql_esÿ³_¡ršg
Ğ
$_¡r
 );

175 
	}
}

178 
funùiÚ
 
Execu‹NÚeQu”y
(
$sql
='')

180 
glob®
 
$dsql
;

181 if(!
	g$dsql
->
	gisIn™
)

183 
	g$this
->
In™
(
$this
->
pcÚÃù
);

185 if(
	g$dsql
->
	gisClo£
)

187 
	g$this
->
O³n
(
FALSE
);

188 
	g$dsql
->
	gisClo£
 = 
FALSE
;

190 if(!
em±y
(
$sql
))

192 
	g$this
->
S‘Qu”y
(
$sql
);

194  
	gFALSE
;

196 if(
is_¬¿y
(
$this
->
·¿m‘”s
))

198 
fÜ—ch
(
$this
->
·¿m‘”s
 
as
 
$key
=>
$v®ue
)

200 
$this
->
qu”ySŒšg
 = 
¡r_»¶aû
("@".
$key
,"'$value'",$this->queryString);

204 if(
	g$this
->
	g§ãCheck
è
CheckSql
(
$this
->
qu”ySŒšg
,'update');

205 
	g$t1
 = 
ExecTime
();

206 
	g$rs
 = 
mysql_qu”y
(
$this
->
qu”ySŒšg
,$this->
lškID
);

209 if(
	g$this
->
	g»cÜdLog
) {

210 
	g$qu”yTime
 = 
ExecTime
(è- 
$t1
;

211 
	g$this
->
RecÜdLog
(
$qu”yTime
);

214  
	g$rs
;

219 
funùiÚ
 
Execu‹NÚeQu”y2
(
$sql
='')

221 
glob®
 
$dsql
;

222 if(!
	g$dsql
->
	gisIn™
)

224 
	g$this
->
In™
(
$this
->
pcÚÃù
);

226 if(
	g$dsql
->
	gisClo£
)

228 
	g$this
->
O³n
(
FALSE
);

229 
	g$dsql
->
	gisClo£
 = 
FALSE
;

232 if(!
em±y
(
$sql
))

234 
	g$this
->
S‘Qu”y
(
$sql
);

236 if(
is_¬¿y
(
$this
->
·¿m‘”s
))

238 
fÜ—ch
(
$this
->
·¿m‘”s
 
as
 
$key
=>
$v®ue
)

240 
$this
->
qu”ySŒšg
 = 
¡r_»¶aû
("@".
$key
,"'$value'",$this->queryString);

243 
	g$t1
 = 
ExecTime
();

244 
mysql_qu”y
(
$this
->
qu”ySŒšg
,$this->
lškID
);

247 if(
	g$this
->
	g»cÜdLog
) {

248 
	g$qu”yTime
 = 
ExecTime
(è- 
$t1
;

249 
	g$this
->
RecÜdLog
(
$qu”yTime
);

253  
mysql_afãùed_rows
(
$this
->
lškID
);

256 
funùiÚ
 
ExecNÚeQu”y
(
$sql
='')

258  
$this
->
Execu‹NÚeQu”y
(
$sql
);

261 
funùiÚ
 
G‘F‘chRow
(
$id
='me')

263  @
mysql_ãtch_row
(
$this
->
»suÉ
[
$id
]);

266 
funùiÚ
 
	$G‘AfãùedRows
()

268  
	`mysql_afãùed_rows
(
$this
->
lškID
);

269 
	}
}

272 
funùiÚ
 
Execu‹
(
$id
="me", 
$sql
='')

274 
glob®
 
$dsql
;

275 if(!
	g$dsql
->
	gisIn™
)

277 
	g$this
->
In™
(
$this
->
pcÚÃù
);

279 if(
	g$dsql
->
	gisClo£
)

281 
	g$this
->
O³n
(
FALSE
);

282 
	g$dsql
->
	gisClo£
 = 
FALSE
;

284 if(!
em±y
(
$sql
))

286 
	g$this
->
S‘Qu”y
(
$sql
);

290 if(
	g$this
->
	g§ãCheck
)

292 
CheckSql
(
$this
->
qu”ySŒšg
);

295 
	g$t1
 = 
ExecTime
();

297 
	g$this
->
	g»suÉ
[
$id
] = 
mysql_qu”y
(
$this
->
qu”ySŒšg
,$this->
lškID
);

299 if(
	g$this
->
	g»cÜdLog
) {

300 
	g$qu”yTime
 = 
ExecTime
(è- 
$t1
;

301 
	g$this
->
RecÜdLog
(
$qu”yTime
);

304 if(!
em±y
(
$this
->
»suÉ
[
$id
]è&& 
	g$this
->
	g»suÉ
[$id]===
FALSE
)

306 
$this
->
Di¥ÏyE¼Ü
(
mysql_”rÜ
()." <b¸/>E¼Ü sql: <fÚˆcŞÜ='»d'>".$this->
qu”ySŒšg
."</font>");

310 
funùiÚ
 
Qu”y
(
$id
="me",
$sql
='')

312 
$this
->
Execu‹
(
$id
,
$sql
);

316 
funùiÚ
 
G‘OÃ
(
$sql
='',
$acùy³
=
MYSQL_ASSOC
)

318 
glob®
 
$dsql
;

319 if(!
	g$dsql
->
	gisIn™
)

321 
	g$this
->
In™
(
$this
->
pcÚÃù
);

323 if(
	g$dsql
->
	gisClo£
)

325 
	g$this
->
O³n
(
FALSE
);

326 
	g$dsql
->
	gisClo£
 = 
FALSE
;

328 if(!
em±y
(
$sql
))

330 if(!
´eg_m©ch
("/LIMIT/i",
$sql
)è
	g$this
->
S‘Qu”y
(
´eg_»¶aû
("/[,;]$/i", '', 
Œim
($sql))." LIMIT 0,1;");

331 
	g$this
->
S‘Qu”y
(
$sql
);

333 
	g$this
->
Execu‹
("one");

334 
	g$¬r
 = 
$this
->
G‘A¼ay
("Úe",
$acùy³
);

335 if(!
is_¬¿y
(
$¬r
))

341 @
mysql_ä“_»suÉ
(
$this
->
»suÉ
["Úe"]); (
	g$¬r
);

346 
funùiÚ
 
Execu‹SaãQu”y
(
$sql
,
$id
="me")

348 
glob®
 
$dsql
;

349 if(!
	g$dsql
->
	gisIn™
)

351 
	g$this
->
In™
(
$this
->
pcÚÃù
);

353 if(
	g$dsql
->
	gisClo£
)

355 
	g$this
->
O³n
(
FALSE
);

356 
	g$dsql
->
	gisClo£
 = 
FALSE
;

358 
	g$this
->
	g»suÉ
[
$id
] = @
mysql_qu”y
(
$sql
,
$this
->
lškID
);

363 
funùiÚ
 
G‘A¼ay
(
$id
="me",
$acùy³
=
MYSQL_ASSOC
)

365 if(
$this
->
»suÉ
[
$id
]==0)

367  
FALSE
;

371  
mysql_ãtch_¬¿y
(
$this
->
»suÉ
[
$id
],
$acùy³
);

375 
funùiÚ
 
G‘Objeù
(
$id
="me")

377 if(
$this
->
»suÉ
[
$id
]==0)

379  
FALSE
;

383  
mysql_ãtch_objeù
(
$this
->
»suÉ
[
$id
]);

387 
funùiÚ
 
	$g‘CŞ
(
$sql
)

389 
$this
->
	`S‘Qu”y
(
$sql
);

390 
$this
->
	`Execu‹
("col");

392 ià(
$this
->
»suÉ
["col"])

394 
$¬r
 = 
	`¬¿y
();

395 
$row
 = 
	`mysql_ãtch_row
(
$this
->
»suÉ
["col"]))

397 
$¬r
[] = 
$row
[0];

400  
$¬r
;

404  
çl£
;

406 
	}
}

408 
funùiÚ
 
autoExecu‹
(
$bË
, 
$f›ld_v®ues
, 
$mode
 = 'INSERT', 
$wh”e
 = '')

410 
$f›ld_Çmes
 = 
$this
->
g‘CŞ
('DESC ' . 
$bË
);

412 
	g$sql
 = '';

413 ià(
	g$mode
 == 'INSERT')

415 
$f›lds
 = 
$v®ues
 = 
¬¿y
();

416 
fÜ—ch
 (
$f›ld_Çmes
 
AS
 
$v®ue
)

418 ià(
¬¿y_key_exi¡s
(
$v®ue
, 
$f›ld_v®ues
è=ğ
Œue
)

420 
$f›lds
[] = 
$v®ue
;

421 
	g$v®ues
[] = "'" . 
$f›ld_v®ues
[
$v®ue
] . "'";

425 ià(!
em±y
(
$f›lds
))

427 
	g$sql
 = 'INSERT INTO ' . 
$bË
 . ' (' . 
im¶ode
(', ', 
$f›lds
è. 'èVALUES (' . im¶ode(', ', 
$v®ues
) . ')';

432 
	g$£ts
 = 
¬¿y
();

433 
fÜ—ch
 (
$f›ld_Çmes
 
AS
 
$v®ue
)

435 ià(
¬¿y_key_exi¡s
(
$v®ue
, 
$f›ld_v®ues
è=ğ
Œue
)

437 
$£ts
[] = 
$v®ue
 . " = '" . 
$f›ld_v®ues
[$value] . "'";

441 ià(!
em±y
(
$£ts
))

443 
	g$sql
 = 'UPDATE ' . 
$bË
 . ' SET ' . 
im¶ode
(', ', 
$£ts
è. ' WHERE ' . 
	g$wh”e
;

447 ià(
	g$sql
)

449  
	g$this
->
Execu‹NÚeQu”y
(
$sql
);

453  
	gçl£
;

458 
funùiÚ
 
	$IsTabË
(
$tbÇme
)

460 
glob®
 
$dsql
;

461 if(!
$dsql
->
isIn™
)

463 
$this
->
	`In™
($this->
pcÚÃù
);

465 
$´efix
="#@__";

466 
$tbÇme
 = 
	`¡r_»¶aû
(
$´efix
, 
$GLOBALS
['cfg_dbprefix'], $tbname);

467 ifĞ
	`mysql_num_rows
Ğ@
	`mysql_qu”y
("SHOW TABLES LIKE '".
$tbÇme
."'", 
$this
->
lškID
)))

469  
TRUE
;

471  
FALSE
;

472 
	}
}

475 
funùiÚ
 
	$G‘V”siÚ
(
$isfÜm©
=
TRUE
)

477 
glob®
 
$dsql
;

478 if(!
$dsql
->
isIn™
)

480 
$this
->
	`In™
($this->
pcÚÃù
);

482 if(
$dsql
->
isClo£
)

484 
$this
->
	`O³n
(
FALSE
);

485 
$dsql
->
isClo£
 = 
FALSE
;

488 
$rs
 = @
	`mysql_qu”y
("SELECT VERSION();",
$this
->
lškID
);

489 
$row
 = @
	`mysql_ãtch_¬¿y
(
$rs
);

490 
$mysql_v”siÚ
 = 
$row
[0];

491 @
	`mysql_ä“_»suÉ
(
$rs
);

492 if(
$isfÜm©
)

494 
$mysql_v”siÚs
 = 
	`ex¶ode
(".",
	`Œim
(
$mysql_v”siÚ
));

495 
$mysql_v”siÚ
 = 
	`numb”_fÜm©
(
$mysql_v”siÚs
[0].".".$mysql_versions[1],2);

497  
$mysql_v”siÚ
;

498 
	}
}

501 
funùiÚ
 
G‘TabËF›lds
(
$tbÇme
,
$id
="me")

503 
glob®
 
$dsql
;

504 if(!
	g$dsql
->
	gisIn™
)

506 
	g$this
->
In™
(
$this
->
pcÚÃù
);

508 
	g$this
->
	g»suÉ
[
$id
] = 
mysql_li¡_f›lds
(
$this
->
dbName
,
$tbÇme
,$this->
lškID
);

512 
funùiÚ
 
G‘F›ldObjeù
(
$id
="me")

514  
mysql_ãtch_f›ld
(
$this
->
»suÉ
[
$id
]);

518 
funùiÚ
 
G‘TÙ®Row
(
$id
="me")

520 if(
$this
->
»suÉ
[
$id
]==0)

526  
mysql_num_rows
(
$this
->
»suÉ
[
$id
]);

531 
funùiÚ
 
	$G‘La¡ID
()

538  
	`mysql_š£¹_id
(
$this
->
lškID
);

539 
	}
}

542 
funùiÚ
 
F»eResuÉ
(
$id
="me")

544 @
mysql_ä“_»suÉ
(
$this
->
»suÉ
[
$id
]);

546 
funùiÚ
 
	$F»eResuÉAÎ
()

548 if(!
	`is_¬¿y
(
$this
->
»suÉ
))

552 
	`fÜ—ch
(
$this
->
»suÉ
 
as
 
$kk
 => 
$vv
)

554 if(
$vv
)

556 @
	`mysql_ä“_»suÉ
(
$vv
);

559 
	}
}

562 
funùiÚ
 
	$S‘Qu”y
(
$sql
)

564 
$´efix
="#@__";

565 
$sql
 = 
	`¡r_»¶aû
(
$´efix
,
$GLOBALS
['cfg_dbprefix'],$sql);

566 
$this
->
qu”ySŒšg
 = 
$sql
;

567 
	}
}

569 
funùiÚ
 
	$S‘Sql
(
$sql
)

571 
$this
->
	`S‘Qu”y
(
$sql
);

572 
	}
}

574 
funùiÚ
 
	$RecÜdLog
(
$ruÁime
=0)

576 
$RecÜdLogFe
 = 
	`dœÇme
(
__FILE__
).'/../config/mysqli_record_log.inc';

577 
$u¾
 = 
$this
->
	`G‘CurU¾
();

578 
$§vemsg
 = <<<
EOT


581 
SQL
:{
$this
->
qu”ySŒšg
}

582 
Page
:
$u¾


583 
RuÁime
:
$ruÁime


584 
EOT
;

585 
$å
 = @
	`fİ’
(
$RecÜdLogFe
, 'a');

586 @
	`fwr™e
(
$å
, 
$§vemsg
);

587 @
	`fşo£
(
$å
);

588 
	}
}

591 
funùiÚ
 
	$Di¥ÏyE¼Ü
(
$msg
)

593 
$”rÜT¿ckFe
 = 
	`dœÇme
(
__FILE__
).'/../config/mysql_error_trace.inc';

594 ifĞ
	`fe_exi¡s
(
	`dœÇme
(
__FILE__
).'/../config/mysql_error_trace.php') )

596 @
	`uÆšk
(
	`dœÇme
(
__FILE__
).'/../config/mysql_error_trace.php');

598 
$emsg
 = 'Mysql Error Warning!';

599 
echo
 
$emsg
;

601 
$§vemsg
 = 'Page: '.
$this
->
	`G‘CurU¾
()."\r\nE¼Ü: ".
$msg
."\r\nTime".
	`d©e
('Y-m-d H:i:s');

603 
$å
 = @
	`fİ’
(
$”rÜT¿ckFe
, 'a');

604 @
	`fwr™e
(
$å
, '<'.'?phpƒxit();'."\r\n/*\r\n{$savemsg}\r\n*/\r\n?".">\r\n");

605 @
	`fşo£
(
$å
);

606 
	}
}

609 
funùiÚ
 
	$G‘CurU¾
()

611 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

613 
$sütName
 = 
$_SERVER
["REQUEST_URI"];

614 
$nowu¾
 = 
$sütName
;

618 
$sütName
 = 
$_SERVER
["PHP_SELF"];

619 if(
	`em±y
(
$_SERVER
["QUERY_STRING"])) {

620 
$nowu¾
 = 
$sütName
;

623 
$nowu¾
 = 
$sütName
."?".
$_SERVER
["QUERY_STRING"];

626  
$nowu¾
;

627 
	}
}

633 
funùiÚ
 
	$CİySQLPošt
(&
$ndsql
)

635 
$GLOBALS
['dsql'] = 
$ndsql
;

636 
	}
}

639 ià(!
funùiÚ_exi¡s
('CheckSql'))

641 
funùiÚ
 
CheckSql
(
$db_¡ršg
,
$qu”yty³
='select')

643 
glob®
 
$cfg_cook›_’code
;

644 
	g$ş—n
 = '';

645 
	g$”rÜ
='';

646 
	g$Şd_pos
 = 0;

647 
	g$pos
 = -1;

648 
	g$log_fe
 = 
XAKINC
.'/../cÚfig/'.
md5
(
$cfg_cook›_’code
).'_safe.txt';

649 
	g$u£rIP
 = 
G‘IP
();

650 
	g$g‘U¾
 = 
G‘CurU¾
();

653 if(
	g$qu”yty³
=='select')

655 
$nÙ®low1
 = "[^0-9a-z@\._-]{1,}(union|sleep|benchmark|load_file|outfile)[^0-9a-z@\.-]{1,}";

658 if(
´eg_m©ch
("/".
$nÙ®low1
."/i", 
$db_¡ršg
))

660 
åuts
(
fİ’
(
$log_fe
,'a+'),"$userIP||$getUrl||$db_string||SelectBreak\r\n");

661 
ex™
("<font size='5' color='red'>Safe Alert: Request Error step 1 !</font>");

666 
	gTRUE
)

668 
	g$pos
 = 
¡½os
(
$db_¡ršg
, '\'', 
$pos
 + 1);

669 ià(
	g$pos
 ==ğ
FALSE
)

673 
	g$ş—n
 .ğ
sub¡r
(
$db_¡ršg
, 
$Şd_pos
, 
$pos
 - $old_pos);

674 
	gTRUE
)

676 
	g$pos1
 = 
¡½os
(
$db_¡ršg
, '\'', 
$pos
 + 1);

677 
	g$pos2
 = 
¡½os
(
$db_¡ršg
, '\\', 
$pos
 + 1);

678 ià(
	g$pos1
 ==ğ
FALSE
)

682 
–£if
 (
$pos2
 =ğ
FALSE
 || $pos2 > 
$pos1
)

684 
$pos
 = 
$pos1
;

687 
	g$pos
 = 
$pos2
 + 1;

689 
	g$ş—n
 .= '$s$';

690 
	g$Şd_pos
 = 
$pos
 + 1;

692 
	g$ş—n
 .ğ
sub¡r
(
$db_¡ršg
, 
$Şd_pos
);

693 
	g$ş—n
 = 
Œim
(
¡¹Şow”
(
´eg_»¶aû
(
¬¿y
('~\s+~s' ),‡¼ay(' '), 
$ş—n
)));

696 ià(
¡½os
(
$ş—n
, 'uniÚ'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])union($|[^[a-z])~s', $clean) != 0)

698 
$ç
 = 
TRUE
;

699 
	g$”rÜ
="union detect";

703 
–£if
 (
¡½os
(
$ş—n
, '/*'è> 2 || sŒpos($ş—n, '--'è!=ğ
FALSE
 || strpos($clean, '#') !== FALSE)

705 
$ç
 = 
TRUE
;

706 
	g$”rÜ
="comment detect";

710 
–£if
 (
¡½os
(
$ş—n
, '¦“p'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])sleep($|[^[a-z])~s', $clean) != 0)

712 
$ç
 = 
TRUE
;

713 
	g$”rÜ
="slown down detect";

715 
–£if
 (
¡½os
(
$ş—n
, 'b’chm¬k'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])benchmark($|[^[a-z])~s', $clean) != 0)

717 
$ç
 = 
TRUE
;

718 
	g$”rÜ
="slown down detect";

720 
–£if
 (
¡½os
(
$ş—n
, 'lßd_fe'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])load_file($|[^[a-z])~s', $clean) != 0)

722 
$ç
 = 
TRUE
;

723 
	g$”rÜ
="file fun detect";

725 
–£if
 (
¡½os
(
$ş—n
, 'štØoutfe'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])into\s+outfile($|[^[a-z])~s', $clean) != 0)

727 
$ç
 = 
TRUE
;

728 
	g$”rÜ
="file fun detect";

732 
–£if
 (
´eg_m©ch
('~\([^)]*?£Ëù~s', 
$ş—n
) != 0)

734 
$ç
 = 
TRUE
;

735 
	g$”rÜ
="sub select detect";

737 ià(!
em±y
(
$ç
))

739 
åuts
(
fİ’
(
$log_fe
,'a+'),"$userIP||$getUrl||$db_string||$error\r\n");

740 
ex™
("<font size='5' color='red'>Safe Alert: Request Error step 2!</font>");

744  
	g$db_¡ršg
;

	@E:\web\weixun\functions\xaksqli.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

3 @
£t_time_lim™
(0);

5 
	g$dsql
 = 
$dsqli
 = 
$db
 = 
Ãw
 
XakSqli
(
FALSE
);

9 şas 
	cXakSqli


11 
v¬
 
	m$lškID
;

12 
v¬
 
	m$dbHo¡
;

13 
v¬
 
	m$dbU£r
;

14 
v¬
 
	m$dbPwd
;

15 
v¬
 
	m$dbName
;

16 
v¬
 
	m$dbP»fix
;

17 
v¬
 
	m$»suÉ
;

18 
v¬
 
	m$qu”ySŒšg
;

19 
v¬
 
	m$·¿m‘”s
;

20 
v¬
 
	m$isClo£
;

21 
v¬
 
	m$§ãCheck
;

22 
v¬
 
	m$»cÜdLog
=
çl£
;

23 
v¬
 
	m$isIn™
=
çl£
;

24 
v¬
 
	m$pcÚÃù
=
çl£
;

27 
funùiÚ
 
	$__cÚ¡ruù
(
$pcÚÃù
=
FALSE
,
$ncÚÃù
=FALSE)

29 
$this
->
isClo£
 = 
FALSE
;

30 
$this
->
§ãCheck
 = 
TRUE
;

31 
$this
->
pcÚÃù
 = 
$pcÚÃù
;

32 if(
$ncÚÃù
)

34 
$this
->
	`In™
(
$pcÚÃù
);

38 
funùiÚ
 
	$XakSql
(
$pcÚÃù
=
FALSE
,
$ncÚÃù
=
TRUE
)

40 
$this
->
	`__cÚ¡ruù
(
$pcÚÃù
,
$ncÚÃù
);

41 
	}
}

43 
funùiÚ
 
	$In™
(
$pcÚÃù
=
FALSE
)

45 
$this
->
lškID
 = 0;

48 
$this
->
dbHo¡
 = 
$GLOBALS
['cfg_dbhost'];

49 
$this
->
dbU£r
 = 
$GLOBALS
['cfg_dbuser'];

50 
$this
->
dbPwd
 = 
$GLOBALS
['cfg_dbpwd'];

51 
$this
->
dbName
 = 
$GLOBALS
['cfg_dbname'];

52 
$this
->
dbP»fix
 = 
$GLOBALS
['cfg_dbprefix'];

53 
$this
->
»suÉ
["me"] = 0;

54 
$this
->
	`O³n
(
$pcÚÃù
);

55 
	}
}

58 
funùiÚ
 
S‘Sourû
(
$ho¡
,
$u£ºame
,
$pwd
,
$dbÇme
,
$db´efix
="xak_")

60 
$this
->
dbHo¡
 = 
$ho¡
;

61 
	g$this
->
	gdbU£r
 = 
$u£ºame
;

62 
	g$this
->
	gdbPwd
 = 
$pwd
;

63 
	g$this
->
	gdbName
 = 
$dbÇme
;

64 
	g$this
->
	gdbP»fix
 = 
$db´efix
;

65 
	g$this
->
	g»suÉ
["me"] = 0;

67 
funùiÚ
 
	$S–eùDB
(
$dbÇme
)

69 
	`mysql_£Ëù_db
(
$dbÇme
);

70 
	}
}

73 
funùiÚ
 
	$S‘P¬am‘”
(
$key
,
$v®ue
)

75 
$this
->
·¿m‘”s
[
$key
]=
$v®ue
;

76 
	}
}

79 
funùiÚ
 
	$O³n
(
$pcÚÃù
=
FALSE
)

81 
glob®
 
$dsqli
;

83 if(
$dsqli
 && !$dsqli->
isClo£
 && $dsqli->
isIn™
)

85 
$this
->
lškID
 = 
$dsqli
->linkID;

89 
$i
 = 0;

90 @
	`li¡
(
$dbho¡
, 
$dbpÜt
èğ
	`ex¶ode
(':', 
$this
->
dbHo¡
);

91 !
$dbpÜt
 && $dbport = 3306;

93 
$this
->
lškID
 = 
	`mysqli_š™
();

94 
	`mysqli_»®_cÚÃù
(
$this
->
lškID
, 
$dbho¡
, $this->
dbU£r
, $this->
dbPwd
, 
çl£
, 
$dbpÜt
);

95 
	`mysqli_”ºo
(
$this
->
lškID
è!ğ0 && $this->
	`Di¥ÏyE¼Ü
('é”™è¯¯è­¦å‘Šï¼š é“¾æ¥('.$this->
pcÚÃù
.') åˆ°MySQLå‘ç”Ÿé”™è¯¯');

99 
	`CİySQLiPošt
(
$this
);

103 if(!
$this
->
lškID
)

105 
$this
->
	`Di¥ÏyE¼Ü
("<font color='red'>è¿æ¥æ•°æ®åº“å¤±è´¥ï¼Œå¯èƒ½æ•°æ®åº“å¯†ç ä¸å¯¹æˆ–æ•°æ®åº“æœåŠ¡å™¨å‡ºé”™ï¼</font>");

106 
	`ex™
();

108 
$this
->
isIn™
 = 
TRUE
;

109 
$£rv”šfo
 = 
	`mysqli_g‘_£rv”_šfo
(
$this
->
lškID
);

110 ià(
$£rv”šfo
 > '4.1' && 
$GLOBALS
['cfg_db_language'])

112 
	`mysqli_qu”y
(
$this
->
lškID
, "SET ch¬aù”_£t_cÚÃùiÚ=" . 
$GLOBALS
['cfg_db_language'] . ",character_set_results=" . $GLOBALS['cfg_db_language'] . ",character_set_client=binary");

114 ià(
$£rv”šfo
 > '5.0') {

115 
	`mysqli_qu”y
(
$this
->
lškID
, "SET sql_mode=''");

117 ià(
$this
->
dbName
 && !@
	`mysqli_£Ëù_db
($this->
lškID
, $this->dbName)) {

118 
$this
->
	`Di¥ÏyE¼Ü
('æ— æ³•ä½¿ç”¨æ•°æ®åº“');

120  
TRUE
;

121 
	}
}

124 
funùiÚ
 
	$S‘LÚgLšk
()

126 @
	`mysqli_qu”y
("SET iÁ”aùive_timeout=3600, wa™_timeout=3600 ;", 
$this
->
lškID
);

127 
	}
}

130 
funùiÚ
 
	$G‘E¼Ü
()

132 
$¡r
 = 
	`mysql_”rÜ
();

133  
$¡r
;

134 
	}
}

139 
funùiÚ
 
	$Clo£
(
$isok
=
FALSE
)

141 
$this
->
	`F»eResuÉAÎ
();

142 if(
$isok
)

144 @
	`mysqli_şo£
(
$this
->
lškID
);

145 
$this
->
isClo£
 = 
TRUE
;

146 
$GLOBALS
['dsql'] = 
NULL
;

148 
	}
}

151 
funùiÚ
 
	$CË¬E¼Lšk
()

153 
	}
}

156 
funùiÚ
 
	$Clo£Lšk
(
$dblšk
)

158 @
	`mysqli_şo£
(
$dblšk
);

159 
	}
}

161 
funùiÚ
 
	$Esc
Ğ
$_¡r
 )

163 iàĞ
	`v”siÚ_com·»
Ğ
	`phpv”siÚ
(), '4.3.0', '>=' ) )

165  @
	`mysqli_»®_esÿ³_¡ršg
(
$this
->
lškID
, 
$_¡r
 );

167  @
	`mysqli_esÿ³_¡ršg
 (
$this
->
lškID
, 
$_¡r
 );

169 
	}
}

172 
funùiÚ
 
Execu‹NÚeQu”y
(
$sql
='')

174 
glob®
 
$dsqli
;

175 if(!
	g$dsqli
->
	gisIn™
)

177 
	g$this
->
In™
(
$this
->
pcÚÃù
);

179 if(
	g$dsqli
->
	gisClo£
)

181 
	g$this
->
O³n
(
FALSE
);

182 
	g$dsqli
->
	gisClo£
 = 
FALSE
;

184 if(!
em±y
(
$sql
))

186 
	g$this
->
S‘Qu”y
(
$sql
);

188  
	gFALSE
;

190 if(
is_¬¿y
(
$this
->
·¿m‘”s
))

192 
fÜ—ch
(
$this
->
·¿m‘”s
 
as
 
$key
=>
$v®ue
)

194 
$this
->
qu”ySŒšg
 = 
¡r_»¶aû
("@".
$key
,"'$value'",$this->queryString);

198 if(
	g$this
->
	g§ãCheck
è
CheckSql
(
$this
->
qu”ySŒšg
,'update');

200 
	g$t1
 = 
ExecTime
();

201 
	g$rs
 = 
mysqli_qu”y
(
$this
->
lškID
, $this->
qu”ySŒšg
);

204 if(
	g$this
->
	g»cÜdLog
) {

205 
	g$qu”yTime
 = 
ExecTime
(è- 
$t1
;

206 
	g$this
->
RecÜdLog
(
$qu”yTime
);

209  
	g$rs
;

214 
funùiÚ
 
Execu‹NÚeQu”y2
(
$sql
='')

216 
glob®
 
$dsqli
;

217 if(!
	g$dsqli
->
	gisIn™
)

219 
	g$this
->
In™
(
$this
->
pcÚÃù
);

221 if(
	g$dsqli
->
	gisClo£
)

223 
	g$this
->
O³n
(
FALSE
);

224 
	g$dsqli
->
	gisClo£
 = 
FALSE
;

227 if(!
em±y
(
$sql
))

229 
	g$this
->
S‘Qu”y
(
$sql
);

231 if(
is_¬¿y
(
$this
->
·¿m‘”s
))

233 
fÜ—ch
(
$this
->
·¿m‘”s
 
as
 
$key
=>
$v®ue
)

235 
$this
->
qu”ySŒšg
 = 
¡r_»¶aû
("@".
$key
,"'$value'",$this->queryString);

238 
	g$t1
 = 
ExecTime
();

239 
mysqli_qu”y
(
$this
->
lškID
, $this->
qu”ySŒšg
);

242 if(
	g$this
->
	g»cÜdLog
) {

243 
	g$qu”yTime
 = 
ExecTime
(è- 
$t1
;

244 
	g$this
->
RecÜdLog
(
$qu”yTime
);

248  
mysqli_afãùed_rows
(
$this
->
lškID
);

251 
funùiÚ
 
ExecNÚeQu”y
(
$sql
='')

253  
$this
->
Execu‹NÚeQu”y
(
$sql
);

256 
funùiÚ
 
G‘F‘chRow
(
$id
='me')

258  @
mysqli_ãtch_row
(
$this
->
»suÉ
[
$id
]);

261 
funùiÚ
 
	$G‘AfãùedRows
()

263  
	`mysqli_afãùed_rows
(
$this
->
lškID
);

264 
	}
}

267 
funùiÚ
 
Execu‹
(
$id
="me", 
$sql
='')

269 
glob®
 
$dsqli
;

270 if(!
	g$dsqli
->
	gisIn™
)

272 
	g$this
->
In™
(
$this
->
pcÚÃù
);

274 if(
	g$dsqli
->
	gisClo£
)

276 
	g$this
->
O³n
(
FALSE
);

277 
	g$dsqli
->
	gisClo£
 = 
FALSE
;

279 if(!
em±y
(
$sql
))

281 
	g$this
->
S‘Qu”y
(
$sql
);

284 if(
	g$this
->
	g§ãCheck
)

286 
CheckSql
(
$this
->
qu”ySŒšg
);

289 
	g$t1
 = 
ExecTime
();

291 
	g$this
->
	g»suÉ
[
$id
] = 
mysqli_qu”y
(
$this
->
lškID
, $this->
qu”ySŒšg
);

295 if(
	g$this
->
	g»cÜdLog
) {

296 
	g$qu”yTime
 = 
ExecTime
(è- 
$t1
;

297 
	g$this
->
RecÜdLog
(
$qu”yTime
);

301 if(
	g$this
->
	g»suÉ
[
$id
]===
FALSE
)

303 
$this
->
Di¥ÏyE¼Ü
(
mysqli_”rÜ
($this->
lškID
)." <b¸/>E¼Ü sql: <fÚˆcŞÜ='»d'>".$this->
qu”ySŒšg
."</font>");

307 
funùiÚ
 
Qu”y
(
$id
="me",
$sql
='')

309 
$this
->
Execu‹
(
$id
,
$sql
);

313 
funùiÚ
 
G‘OÃ
(
$sql
='',
$acùy³
=
MYSQLI_ASSOC
)

315 
glob®
 
$dsqli
;

316 if(!
	g$dsqli
->
	gisIn™
)

318 
	g$this
->
In™
(
$this
->
pcÚÃù
);

320 if(
	g$dsqli
->
	gisClo£
)

322 
	g$this
->
O³n
(
FALSE
);

323 
	g$dsqli
->
	gisClo£
 = 
FALSE
;

325 if(!
em±y
(
$sql
))

327 if(!
´eg_m©ch
("/LIMIT/i",
$sql
)è
	g$this
->
S‘Qu”y
(
´eg_»¶aû
("/[,;]$/i", '', 
Œim
($sql))." LIMIT 0,1;");

328 
	g$this
->
S‘Qu”y
(
$sql
);

330 
	g$this
->
Execu‹
("one");

331 
	g$¬r
 = 
$this
->
G‘A¼ay
("Úe", 
$acùy³
);

332 if(!
is_¬¿y
(
$¬r
))

338 @
mysqli_ä“_»suÉ
(
$this
->
»suÉ
["Úe"]); (
	g$¬r
);

343 
funùiÚ
 
Execu‹SaãQu”y
(
$sql
,
$id
="me")

345 
glob®
 
$dsqli
;

346 if(!
	g$dsqli
->
	gisIn™
)

348 
	g$this
->
In™
(
$this
->
pcÚÃù
);

350 if(
	g$dsqli
->
	gisClo£
)

352 
	g$this
->
O³n
(
FALSE
);

353 
	g$dsqli
->
	gisClo£
 = 
FALSE
;

355 
	g$this
->
	g»suÉ
[
$id
] = @
mysqli_qu”y
(
$sql
,
$this
->
lškID
);

360 
funùiÚ
 
G‘A¼ay
(
$id
="me",
$acùy³
=
MYSQLI_ASSOC
)

363 if(
$this
->
»suÉ
[
$id
]===0)

365  
FALSE
;

369  @
mysqli_ãtch_¬¿y
(
$this
->
»suÉ
[
$id
], 
$acùy³
);

373 
funùiÚ
 
G‘Objeù
(
$id
="me")

375 if(
$this
->
»suÉ
[
$id
]===0)

377  
FALSE
;

381  
mysqli_ãtch_objeù
(
$this
->
»suÉ
[
$id
]);

385 
funùiÚ
 
	$g‘CŞ
(
$sql
)

387 
$this
->
	`S‘Qu”y
(
$sql
);

388 
$this
->
	`Execu‹
("col");

390 ià(
$this
->
»suÉ
["col"])

392 
$¬r
 = 
	`¬¿y
();

393 
$row
 = 
	`mysqli_ãtch_row
(
$this
->
»suÉ
["col"]))

395 
$¬r
[] = 
$row
[0];

398  
$¬r
;

402  
çl£
;

404 
	}
}

406 
funùiÚ
 
autoExecu‹
(
$bË
, 
$f›ld_v®ues
, 
$mode
 = 'INSERT', 
$wh”e
 = '')

408 
$f›ld_Çmes
 = 
$this
->
g‘CŞ
('DESC ' . 
$bË
);

410 
	g$sql
 = '';

411 ià(
	g$mode
 == 'INSERT')

413 
$f›lds
 = 
$v®ues
 = 
¬¿y
();

414 
fÜ—ch
 (
$f›ld_Çmes
 
AS
 
$v®ue
)

416 ià(
¬¿y_key_exi¡s
(
$v®ue
, 
$f›ld_v®ues
è=ğ
Œue
)

418 
$f›lds
[] = 
$v®ue
;

419 
	g$v®ues
[] = "'" . 
$f›ld_v®ues
[
$v®ue
] . "'";

423 ià(!
em±y
(
$f›lds
))

425 
	g$sql
 = 'INSERT INTO ' . 
$bË
 . ' (' . 
im¶ode
(', ', 
$f›lds
è. 'èVALUES (' . im¶ode(', ', 
$v®ues
) . ')';

430 
	g$£ts
 = 
¬¿y
();

431 
fÜ—ch
 (
$f›ld_Çmes
 
AS
 
$v®ue
)

433 ià(
¬¿y_key_exi¡s
(
$v®ue
, 
$f›ld_v®ues
è=ğ
Œue
)

435 
$£ts
[] = 
$v®ue
 . " = '" . 
$f›ld_v®ues
[$value] . "'";

439 ià(!
em±y
(
$£ts
))

441 
	g$sql
 = 'UPDATE ' . 
$bË
 . ' SET ' . 
im¶ode
(', ', 
$£ts
è. ' WHERE ' . 
	g$wh”e
;

445 ià(
	g$sql
)

447  
	g$this
->
Execu‹NÚeQu”y
(
$sql
);

451  
	gçl£
;

456 
funùiÚ
 
	$IsTabË
(
$tbÇme
)

458 
glob®
 
$dsqli
;

459 if(!
$dsqli
->
isIn™
)

461 
$this
->
	`In™
($this->
pcÚÃù
);

463 
$´efix
="#@__";

464 
$tbÇme
 = 
	`¡r_»¶aû
(
$´efix
, 
$GLOBALS
['cfg_dbprefix'], $tbname);

465 ifĞ
	`mysqli_num_rows
Ğ@
	`mysqli_qu”y
(
$this
->
lškID
, "SHOW TABLES LIKE '".
$tbÇme
."'")))

467  
TRUE
;

469  
FALSE
;

470 
	}
}

473 
funùiÚ
 
	$G‘V”siÚ
(
$isfÜm©
=
TRUE
)

475 
glob®
 
$dsqli
;

476 if(!
$dsqli
->
isIn™
)

478 
$this
->
	`In™
($this->
pcÚÃù
);

480 if(
$dsqli
->
isClo£
)

482 
$this
->
	`O³n
(
FALSE
);

483 
$dsqli
->
isClo£
 = 
FALSE
;

485 
$rs
 = 
	`mysqli_qu”y
(
$this
->
lškID
, "SELECT VERSION();");

486 
$row
 = 
	`mysqli_ãtch_¬¿y
(
$rs
);

487 
$mysql_v”siÚ
 = 
$row
[0];

488 
	`mysqli_ä“_»suÉ
(
$rs
);

489 if(
$isfÜm©
)

491 
$mysql_v”siÚs
 = 
	`ex¶ode
(".",
	`Œim
(
$mysql_v”siÚ
));

492 
$mysql_v”siÚ
 = 
	`numb”_fÜm©
(
$mysql_v”siÚs
[0].".".$mysql_versions[1],2);

494  
$mysql_v”siÚ
;

495 
	}
}

498 
funùiÚ
 
G‘TabËF›lds
(
$tbÇme
, 
$id
="me")

500 
glob®
 
$dsqli
;

501 if(!
	g$dsqli
->
	gisIn™
)

503 
	g$this
->
In™
(
$this
->
pcÚÃù
);

505 
	g$´efix
="#@__";

506 
	g$tbÇme
 = 
¡r_»¶aû
(
$´efix
, 
$GLOBALS
['cfg_db´efix'], 
$tbÇme
);

507 
	g$qu”y
 = "SELECT * FROM {$tbname} LIMIT 0,1";

508 
	g$this
->
	g»suÉ
[
$id
] = 
mysqli_qu”y
(
$this
->
lškID
, 
$qu”y
);

512 
funùiÚ
 
G‘F›ldObjeù
(
$id
="me")

514  
mysqli_ãtch_f›ld
(
$this
->
»suÉ
[
$id
]);

518 
funùiÚ
 
G‘TÙ®Row
(
$id
="me")

520 if(
$this
->
»suÉ
[
$id
]===0)

526  @
mysqli_num_rows
(
$this
->
»suÉ
[
$id
]);

531 
funùiÚ
 
	$G‘La¡ID
()

538  
	`mysqli_š£¹_id
(
$this
->
lškID
);

539 
	}
}

542 
funùiÚ
 
F»eResuÉ
(
$id
="me")

544 @
mysqli_ä“_»suÉ
(
$this
->
»suÉ
[
$id
]);

546 
funùiÚ
 
	$F»eResuÉAÎ
()

548 if(!
	`is_¬¿y
(
$this
->
»suÉ
))

552 
	`fÜ—ch
(
$this
->
»suÉ
 
as
 
$kk
 => 
$vv
)

554 if(
$vv
)

556 @
	`mysqli_ä“_»suÉ
(
$vv
);

559 
	}
}

562 
funùiÚ
 
	$S‘Qu”y
(
$sql
)

564 
$´efix
="#@__";

565 
$sql
 = 
	`¡r_»¶aû
(
$´efix
,
$GLOBALS
['cfg_dbprefix'],$sql);

566 
$this
->
qu”ySŒšg
 = 
$sql
;

567 
	}
}

569 
funùiÚ
 
	$S‘Sql
(
$sql
)

571 
$this
->
	`S‘Qu”y
(
$sql
);

572 
	}
}

574 
funùiÚ
 
	$RecÜdLog
(
$ruÁime
=0)

576 
$RecÜdLogFe
 = 
	`dœÇme
(
__FILE__
).'/../config/mysqli_record_log.inc';

577 
$u¾
 = 
$this
->
	`G‘CurU¾
();

578 
$§vemsg
 = <<<
EOT


581 
SQL
:{
$this
->
qu”ySŒšg
}

582 
Page
:
$u¾


583 
RuÁime
:
$ruÁime


584 
EOT
;

585 
$å
 = @
	`fİ’
(
$RecÜdLogFe
, 'a');

586 @
	`fwr™e
(
$å
, 
$§vemsg
);

587 @
	`fşo£
(
$å
);

588 
	}
}

591 
funùiÚ
 
	$Di¥ÏyE¼Ü
(
$msg
)

593 
$”rÜT¿ckFe
 = 
	`dœÇme
(
__FILE__
).'/../config/mysqli_error_trace.inc';

594 ifĞ
	`fe_exi¡s
(
	`dœÇme
(
__FILE__
).'/../config/mysqli_error_trace.php') )

596 @
	`uÆšk
(
	`dœÇme
(
__FILE__
).'/../config/mysqli_error_trace.php');

598 
$emsg
 = 'Mysql Error Warning!';

601 
echo
 
$emsg
;

603 
$§vemsg
 = 'Page: '.
$this
->
	`G‘CurU¾
()."\r\nE¼Ü: ".
$msg
."\r\nTime".
	`d©e
('Y-m-d H:i:s');

605 
$å
 = @
	`fİ’
(
$”rÜT¿ckFe
, 'a');

606 @
	`fwr™e
(
$å
, '<'.'?phpƒxit();'."\r\n/*\r\n{$savemsg}\r\n*/\r\n?".">\r\n");

607 @
	`fşo£
(
$å
);

608 
	}
}

611 
funùiÚ
 
	$G‘CurU¾
()

613 if(!
	`em±y
(
$_SERVER
["REQUEST_URI"]))

615 
$sütName
 = 
$_SERVER
["REQUEST_URI"];

616 
$nowu¾
 = 
$sütName
;

620 
$sütName
 = 
$_SERVER
["PHP_SELF"];

621 if(
	`em±y
(
$_SERVER
["QUERY_STRING"])) {

622 
$nowu¾
 = 
$sütName
;

625 
$nowu¾
 = 
$sütName
."?".
$_SERVER
["QUERY_STRING"];

628  
$nowu¾
;

629 
	}
}

634 
funùiÚ
 
	$CİySQLiPošt
(&
$ndsql
)

636 
$GLOBALS
['dsqli'] = 
$ndsql
;

637 
	}
}

640 ià(!
funùiÚ_exi¡s
('CheckSql'))

642 
funùiÚ
 
CheckSql
(
$db_¡ršg
,
$qu”yty³
='select')

644 
glob®
 
$cfg_cook›_’code
;

645 
	g$ş—n
 = '';

646 
	g$”rÜ
='';

647 
	g$Şd_pos
 = 0;

648 
	g$pos
 = -1;

649 
	g$log_fe
 = 
XAKINC
.'/../cÚfig/'.
md5
(
$cfg_cook›_’code
).'_safe.txt';

650 
	g$u£rIP
 = 
G‘IP
();

651 
	g$g‘U¾
 = 
G‘CurU¾
();

654 if(
	g$qu”yty³
=='select')

656 
$nÙ®low1
 = "[^0-9a-z@\._-]{1,}(union|sleep|benchmark|load_file|outfile)[^0-9a-z@\.-]{1,}";

659 if(
´eg_m©ch
("/".
$nÙ®low1
."/i", 
$db_¡ršg
))

661 
åuts
(
fİ’
(
$log_fe
,'a+'),"$userIP||$getUrl||$db_string||SelectBreak\r\n");

662 
ex™
("<font size='5' color='red'>Safe Alert: Request Error step 1 !</font>");

667 
	gTRUE
)

669 
	g$pos
 = 
¡½os
(
$db_¡ršg
, '\'', 
$pos
 + 1);

670 ià(
	g$pos
 ==ğ
FALSE
)

674 
	g$ş—n
 .ğ
sub¡r
(
$db_¡ršg
, 
$Şd_pos
, 
$pos
 - $old_pos);

675 
	gTRUE
)

677 
	g$pos1
 = 
¡½os
(
$db_¡ršg
, '\'', 
$pos
 + 1);

678 
	g$pos2
 = 
¡½os
(
$db_¡ršg
, '\\', 
$pos
 + 1);

679 ià(
	g$pos1
 ==ğ
FALSE
)

683 
–£if
 (
$pos2
 =ğ
FALSE
 || $pos2 > 
$pos1
)

685 
$pos
 = 
$pos1
;

688 
	g$pos
 = 
$pos2
 + 1;

690 
	g$ş—n
 .= '$s$';

691 
	g$Şd_pos
 = 
$pos
 + 1;

693 
	g$ş—n
 .ğ
sub¡r
(
$db_¡ršg
, 
$Şd_pos
);

694 
	g$ş—n
 = 
Œim
(
¡¹Şow”
(
´eg_»¶aû
(
¬¿y
('~\s+~s' ),‡¼ay(' '), 
$ş—n
)));

697 ià(
¡½os
(
$ş—n
, 'uniÚ'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])union($|[^[a-z])~s', $clean) != 0)

699 
$ç
 = 
TRUE
;

700 
	g$”rÜ
="union detect";

704 
–£if
 (
¡½os
(
$ş—n
, '/*'è> 2 || sŒpos($ş—n, '--'è!=ğ
FALSE
 || strpos($clean, '#') !== FALSE)

706 
$ç
 = 
TRUE
;

707 
	g$”rÜ
="comment detect";

711 
–£if
 (
¡½os
(
$ş—n
, '¦“p'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])sleep($|[^[a-z])~s', $clean) != 0)

713 
$ç
 = 
TRUE
;

714 
	g$”rÜ
="slown down detect";

716 
–£if
 (
¡½os
(
$ş—n
, 'b’chm¬k'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])benchmark($|[^[a-z])~s', $clean) != 0)

718 
$ç
 = 
TRUE
;

719 
	g$”rÜ
="slown down detect";

721 
–£if
 (
¡½os
(
$ş—n
, 'lßd_fe'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])load_file($|[^[a-z])~s', $clean) != 0)

723 
$ç
 = 
TRUE
;

724 
	g$”rÜ
="file fun detect";

726 
–£if
 (
¡½os
(
$ş—n
, 'štØoutfe'è!=ğ
FALSE
 && 
´eg_m©ch
('~(^|[^a-z])into\s+outfile($|[^[a-z])~s', $clean) != 0)

728 
$ç
 = 
TRUE
;

729 
	g$”rÜ
="file fun detect";

733 
–£if
 (
´eg_m©ch
('~\([^)]*?£Ëù~s', 
$ş—n
) != 0)

735 
$ç
 = 
TRUE
;

736 
	g$”rÜ
="sub select detect";

738 ià(!
em±y
(
$ç
))

740 
åuts
(
fİ’
(
$log_fe
,'a+'),"$userIP||$getUrl||$db_string||$error\r\n");

741 
ex™
("<font size='5' color='red'>Safe Alert: Request Error step 2!</font>");

745  
	g$db_¡ršg
;

	@E:\web\weixun\functions\xaktag.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

15 şas 
	cXakTag


17 
v¬
 
	m$IsR•Ïû
=
FALSE
;

18 
v¬
 
	m$TagName
="";

19 
v¬
 
	m$IÂ”Text
="";

20 
v¬
 
	m$S¹Pos
=0;

21 
v¬
 
	m$EndPos
=0;

22 
v¬
 
	m$CA‰ribu‹
="";

23 
v¬
 
	m$TagV®ue
="";

24 
v¬
 
	m$TagID
 = 0;

32 
funùiÚ
 
	$G‘Name
()

34  
	`¡¹Şow”
(
$this
->
TagName
);

43 
funùiÚ
 
	$G‘V®ue
()

45  
$this
->
TagV®ue
;

46 
	}
}

49 
funùiÚ
 
	$G‘TagName
()

51  
	`¡¹Şow”
(
$this
->
TagName
);

52 
	}
}

54 
funùiÚ
 
	$G‘TagV®ue
()

56  
$this
->
TagV®ue
;

57 
	}
}

60 
funùiÚ
 
	$IsA‰ribu‹
(
$¡r
)

62  
$this
->
CA‰ribu‹
->
	`IsA‰ribu‹
(
$¡r
);

63 
	}
}

65 
funùiÚ
 
	$G‘A‰ribu‹
(
$¡r
)

67  
$this
->
CA‰ribu‹
->
	`G‘A‰
(
$¡r
);

68 
	}
}

70 
funùiÚ
 
	$G‘A‰
(
$¡r
)

72  
$this
->
CA‰ribu‹
->
	`G‘A‰
(
$¡r
);

73 
	}
}

75 
funùiÚ
 
	$G‘IÂ”Text
()

77  
$this
->
IÂ”Text
;

78 
	}
}

85 şas 
	cXakTagP¬£


87 
v¬
 
	m$NameS·û
 = 'xak';

88 
v¬
 
	m$TagS¹WÜd
 = '{';

89 
v¬
 
	m$TagEndWÜd
 = '}';

90 
v¬
 
	m$TagMaxL’
 = 64;

91 
v¬
 
	m$Ch¬ToLow
 = 
TRUE
;

92 
v¬
 
	m$IsCache
 = 
FALSE
;

93 
v¬
 
	m$TempMkTime
 = 0;

94 
v¬
 
	m$CacheFe
 = '';

95 
v¬
 
	m$SourûSŒšg
 = '';

96 
v¬
 
	m$CTags
 = '';

97 
v¬
 
	m$CouÁ
 = -1;

98 
v¬
 
	m$»fObj
 = '';

100 
funùiÚ
 
	$__cÚ¡ruù
()

102 if(!
	`is£t
(
$GLOBALS
['cfg_tplcache']))

104 
$GLOBALS
['cfg_tplcache'] = 'N';

106 if(
$GLOBALS
['cfg_tplcache']=='Y')

108 
$this
->
IsCache
 = 
TRUE
;

112 
$this
->
IsCache
 = 
FALSE
;

114 
$this
->
NameS·û
 = 'xak';

115 
$this
->
TagS¹WÜd
 = '{';

116 
$this
->
TagEndWÜd
 = '}';

117 
$this
->
TagMaxL’
 = 64;

118 
$this
->
Ch¬ToLow
 = 
TRUE
;

119 
$this
->
SourûSŒšg
 = '';

120 
$this
->
CTags
 = 
	`A¼ay
();

121 
$this
->
CouÁ
 = -1;

122 
$this
->
TempMkTime
 = 0;

123 
$this
->
CacheFe
 = '';

126 
funùiÚ
 
	$XakTagP¬£
()

128 
$this
->
	`__cÚ¡ruù
();

129 
	}
}

140 
funùiÚ
 
S‘NameS·û
(
$¡r
, 
$s
="{", 
$e
="}")

142 
$this
->
NameS·û
 = 
¡¹Şow”
(
$¡r
);

143 
	g$this
->
	gTagS¹WÜd
 = 
$s
;

144 
	g$this
->
	gTagEndWÜd
 = 
$e
;

153 
funùiÚ
 
	$S‘DeçuÉ
()

155 
$this
->
SourûSŒšg
 = '';

156 
$this
->
CTags
 = '';

157 
$this
->
CouÁ
=-1;

158 
	}
}

167 
funùiÚ
 
	$S‘RefObj
(&
$»fObj
)

169 
$this
->
»fObj
 = 
$»fObj
;

170 
	}
}

172 
funùiÚ
 
	$G‘CouÁ
()

174  
$this
->
CouÁ
+1;

175 
	}
}

177 
funùiÚ
 
	$CË¬
()

179 
$this
->
	`S‘DeçuÉ
();

180 
	}
}

193 
funùiÚ
 
CheckDi§bËdFunùiÚs
(
$¡r
,&
$”rmsg
='')

195 
glob®
 
$cfg_di§bË_funs
;

196 
	g$cfg_di§bË_funs
 = 
is£t
(
$cfg_di§bË_funs
)? $cfg_disable_funs : 'phpinfo,eval,exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,file_put_contents,fsockopen,fopen,fwrite';

198 ià(
defšed
('XAKDISFUN')) {

199 
	g$tok’s
 = 
tok’_g‘_®l_Æ
('<?php'.
$¡r
."\n\r?>");

200 
	g$di§bËd_funùiÚs
 = 
ex¶ode
(',', 
$cfg_di§bË_funs
);

201 
fÜ—ch
 (
$tok’s
 
as
 
$tok’
)

203 ià(
is_¬¿y
(
$tok’
))

205 ià(
	g$tok’
[0] = '306' && 
š_¬¿y
(
$tok’
[1], 
$di§bËd_funùiÚs
))

207 
	g$”rmsg
 = 'Funs isƒrror';

208  
	gFALSE
;

213  
	gTRUE
;

222 
funùiÚ
 
	$LßdCache
(
$f’ame
)

224 
glob®
 
$cfg_lÿche
,
$cfg_lÿche_dœ
;

225 if(!
$this
->
IsCache
)

227  
FALSE
;

229 
$cdœ
 = 
	`dœÇme
(
$f’ame
);

230 
$ÿchedœ
 = 
XAKROOT
.
$cfg_lÿche_dœ
;

231 
$ckfe
 = 
	`¡r_»¶aû
(
$cdœ
,'',
$f’ame
).
	`sub¡r
(
	`md5
($filename),0,16).'.inc';

232 
$ckfuÎfe
 = 
$ÿchedœ
.'/'.
$ckfe
;

233 
$ckfuÎfe_t
 = 
$ÿchedœ
.'/'.
$ckfe
.'.txt';

234 
$this
->
CacheFe
 = 
$ckfuÎfe
;

235 
$this
->
TempMkTime
 = 
	`femtime
(
$f’ame
);

236 if(!
	`fe_exi¡s
(
$ckfuÎfe
)||!fe_exi¡s(
$ckfuÎfe_t
))

238  
FALSE
;

242 
$å
 = 
	`fİ’
(
$ckfuÎfe_t
,'r');

243 
$time_šfo
 = 
	`Œim
(
	`fg‘s
(
$å
,64));

244 
	`fşo£
(
$å
);

245 if(
$time_šfo
 !ğ
$this
->
TempMkTime
)

247  
FALSE
;

251 
	`šşude
(
$this
->
CacheFe
);

254 ifĞ
	`is£t
(
$z
è&& 
	`is_¬¿y
($z) )

256 
	`fÜ—ch
(
$z
 
as
 
$k
=>
$v
)

258 
$this
->
CouÁ
++;

259 
$ùag
 = 
Ãw
 
	`XakTag
();

260 
$ùag
->
CA‰ribu‹
 = 
Ãw
 
	`XakA‰ribu‹
();

261 
$ùag
->
IsR•Ïû
 = 
FALSE
;

262 
$ùag
->
TagName
 = 
$v
[0];

263 
$ùag
->
IÂ”Text
 = 
$v
[1];

264 
$ùag
->
S¹Pos
 = 
$v
[2];

265 
$ùag
->
EndPos
 = 
$v
[3];

266 
$ùag
->
TagV®ue
 = '';

267 
$ùag
->
TagID
 = 
$k
;

268 if(
	`is£t
(
$v
[4]è&& 
	`is_¬¿y
($v[4]))

270 
$i
 = 0;

271 
	`fÜ—ch
(
$v
[4] 
as
 
$k
=>$v)

273 
$ùag
->
CA‰ribu‹
->
CouÁ
++;

274 
$ùag
->
CA‰ribu‹
->
I‹ms
[
$k
]=
$v
;

277 
$this
->
CTags
[$this->
CouÁ
] = 
$ùag
;

283 
$this
->
CTags
 = '';

284 
$this
->
CouÁ
 = -1;

286  
TRUE
;

287 
	}
}

296 
funùiÚ
 
	$SaveCache
()

298 
$å
 = 
	`fİ’
(
$this
->
CacheFe
.'.txt',"w");

299 
	`fwr™e
(
$å
,
$this
->
TempMkTime
."\n");

300 
	`fşo£
(
$å
);

301 
$å
 = 
	`fİ’
(
$this
->
CacheFe
,"w");

302 
	`æock
(
$å
,3);

303 
	`fwr™e
(
$å
,'<'.'?php'."\r\n");

304 
$”rmsg
 = '';

305 if(
	`is_¬¿y
(
$this
->
CTags
))

307 
	`fÜ—ch
(
$this
->
CTags
 
as
 
$tid
=>
$ùag
)

309 
$¬¿yV®ue
 = 'A¼ay("'.
$ùag
->
TagName
.'",';

310 ià(!
$this
->
	`CheckDi§bËdFunùiÚs
(
$ùag
->
IÂ”Text
, 
$”rmsg
)) {

311 
	`fşo£
(
$å
);

312 @
	`uÆšk
(
$this
->
ghashfe
);

313 @
	`uÆšk
(
$this
->
CacheFe
);

314 @
	`uÆšk
(
$this
->
CacheFe
.'.txt');

315 
	`d›
(
$”rmsg
);

317 
$¬¿yV®ue
 .ğ'"'.
	`¡r_»¶aû
('$','\$',¡r_»¶aû("\r","\\r",¡r_»¶aû("\n","\\n",¡r_»¶aû('"','\"',¡r_»¶aû("\\","\\\\",
$ùag
->
IÂ”Text
))))).'"';

318 
$¬¿yV®ue
 .= ",{$ctag->StartPos},{$ctag->EndPos});";

319 
	`fwr™e
(
$å
,"\$z[$tid]={$arrayValue}\n");

320 if(
	`is_¬¿y
(
$ùag
->
CA‰ribu‹
->
I‹ms
))

322 
	`fÜ—ch
(
$ùag
->
CA‰ribu‹
->
I‹ms
 
as
 
$k
=>
$v
)

324 
$v
 = 
	`¡r_»¶aû
("\\","\\\\",$v);

325 
$v
 = 
	`¡r_»¶aû
('"',"\\".'"',$v);

326 
$v
 = 
	`¡r_»¶aû
('$','\$',$v);

327 
$k
 = 
	`Œim
(
	`¡r_»¶aû
("'","",$k));

328 if(
$k
=="")

332 if(
$k
!='tagname')

334 
	`fwr™e
(
$å
,"\$z[$tid][4]['$k']=\"$v\";\n");

340 
	`fwr™e
(
$å
,"\n".'?'.'>');

341 
	`fşo£
(
$å
);

342 
	}
}

351 
funùiÚ
 
	$LßdTem¶©e
(
$f’ame
)

354 
$this
->
	`S‘DeçuÉ
();

355 if(!
	`fe_exi¡s
(
$f’ame
))

357 
$this
->
SourûSŒšg
 = " $filename Not Found! ";

358 
$this
->
	`P¬£Tem¶‘
();

362 
$å
 = @
	`fİ’
(
$f’ame
, "r");

363 
$lše
 = 
	`fg‘s
(
$å
,1024))

365 
$this
->
SourûSŒšg
 .ğ
$lše
;

367 
	`fşo£
(
$å
);

368 if(
$this
->
	`LßdCache
(
$f’ame
))

374 
$this
->
	`P¬£Tem¶‘
();

377 
	}
}

380 
funùiÚ
 
	$LßdTem¶‘
(
$f’ame
)

382 
$this
->
	`LßdTem¶©e
(
$f’ame
);

383 
	}
}

386 
funùiÚ
 
	$LßdFe
(
$f’ame
)

388 
$this
->
	`LßdTem¶©e
(
$f’ame
);

389 
	}
}

398 
funùiÚ
 
	$LßdSourû
(
$¡r
)

407 
$this
->
ghashfe
 = 
$f’ame
 = 
XAKDATA
.'/lÿche/'.
	`md5
(
$¡r
).'.inc';

408 ifĞ!
	`is_fe
(
$f’ame
) )

410 
	`fe_put_cÚ‹Ás
(
$f’ame
, 
$¡r
);

412 
$this
->
	`LßdTem¶©e
(
$f’ame
);

413 
	}
}

415 
funùiÚ
 
	$LßdSŒšg
(
$¡r
)

417 
$this
->
	`LßdSourû
(
$¡r
);

418 
	}
}

427 
funùiÚ
 
	$G‘TagID
(
$¡r
)

429 if(
$this
->
CouÁ
==-1)

433 if(
$this
->
Ch¬ToLow
)

435 
$¡r
=
	`¡¹Şow”
($str);

437 
	`fÜ—ch
(
$this
->
CTags
 
as
 
$id
=>
$CTag
)

439 if(
$CTag
->
TagName
==
$¡r
 && !$CTag->
IsR•Ïû
)

441  
$id
;

446 
	}
}

455 
funùiÚ
 
	$G‘Tag
(
$¡r
)

457 if(
$this
->
CouÁ
==-1)

461 if(
$this
->
Ch¬ToLow
)

463 
$¡r
=
	`¡¹Şow”
($str);

465 
	`fÜ—ch
(
$this
->
CTags
 
as
 
$id
=>
$CTag
)

467 if(
$CTag
->
TagName
==
$¡r
 && !$CTag->
IsR•Ïû
)

469  
$CTag
;

474 
	}
}

483 
funùiÚ
 
	$G‘TagByName
(
$¡r
)

485  
$this
->
	`G‘Tag
(
$¡r
);

486 
	}
}

495 
funùiÚ
 
	$G‘TagByID
(
$id
)

497 if(
	`is£t
(
$this
->
CTags
[
$id
]))

499  
$this
->
CTags
[
$id
];

505 
	}
}

515 
funùiÚ
 
	$AssignV¬
(
$vÇme
, 
$vv®ue
)

517 if(!
	`is£t
(
$_sys_glob®s
['define']))

519 
$_sys_glob®s
['define'] = 'yes';

521 
$_sys_glob®s
[
$vÇme
] = 
$vv®ue
;

522 
	}
}

533 
funùiÚ
 
	$Assign
(
$i
, 
$¡r
, 
$runfunc
 = 
TRUE
)

535 if(
	`is£t
(
$this
->
CTags
[
$i
]))

537 
$this
->
CTags
[
$i
]->
IsR•Ïû
 = 
TRUE
;

538 
$this
->
CTags
[
$i
]->
TagV®ue
 = 
$¡r
;

540 ifĞ
$this
->
CTags
[
$i
]->
	`G‘A‰
('funùiÚ')!='' && 
$runfunc
 )

542 
$this
->
CTags
[
$i
]->
TagV®ue
 = $this->
	`Ev®Func
Ğ
$¡r
, $this->CTags[$i]->
	`G‘A‰
('function'),$this->CTags[$i] );

545 
	}
}

555 
funùiÚ
 
	$AssignName
(
$gÇme
, 
$¡r
)

557 
	`fÜ—ch
(
$this
->
CTags
 
as
 
$id
=>
$CTag
)

559 if(
$CTag
->
TagName
==
$gÇme
)

561 
$this
->
	`Assign
(
$id
,
$¡r
);

564 
	}
}

572 
funùiÚ
 
	$AssignSysTag
()

574 
glob®
 
$_sys_glob®s
;

575 
$i
=0;$i<=
$this
->
CouÁ
;$i++)

577 
$CTag
 = 
$this
->
CTags
[
$i
];

578 
$¡r
 = '';

581 ifĞ
$CTag
->
TagName
 == 'global' )

583 
$¡r
 = 
$this
->
	`G‘Glob®s
(
$CTag
->
	`G‘A‰
('name'));

584 ifĞ
$this
->
CTags
[
$i
]->
	`G‘A‰
('function')!='' )

587 
$¡r
 = 
$this
->
	`Ev®Func
Ğ$¡r, $this->
CTags
[
$i
]->
	`G‘A‰
('function'),$this->CTags[$i] );

589 
$this
->
CTags
[
$i
]->
IsR•Ïû
 = 
TRUE
;

590 
$this
->
CTags
[
$i
]->
TagV®ue
 = 
$¡r
;

594 ifĞ
$CTag
->
TagName
 == 'include' )

596 
$f’ame
 = (
$CTag
->
	`G‘A‰
('file')=='' ? $CTag->GetAtt('filename') : $CTag->GetAtt('file') );

597 
$¡r
 = 
$this
->
	`InşudeFe
(
$f’ame
,
$CTag
->
	`G‘A‰
('ismake'));

598 
$this
->
CTags
[
$i
]->
IsR•Ïû
 = 
TRUE
;

599 
$this
->
CTags
[
$i
]->
TagV®ue
 = 
$¡r
;

603 ifĞ
$CTag
->
TagName
 == 'foreach' )

605 
$¬r
 = 
$this
->
CTags
[
$i
]->
	`G‘A‰
('array');

606 if(
	`is£t
(
$GLOBALS
[
$¬r
]))

608 
	`fÜ—ch
(
$GLOBALS
[
$¬r
] 
as
 
$k
=>
$v
)

610 
$i¡r
 = '';

611 
$i¡r
 .ğ
	`´eg_»¶aû
("/\[f›ld:key([\r\n\t\à]+)\/\]/is",
$k
,
$this
->
CTags
[
$i
]->
IÂ”Text
);

612 
$¡r
 .ğ
	`´eg_»¶aû
("/\[f›ld:v®ue([\r\n\t\à]+)\/\]/is",
$v
,
$i¡r
);

615 
$this
->
CTags
[
$i
]->
IsR•Ïû
 = 
TRUE
;

616 
$this
->
CTags
[
$i
]->
TagV®ue
 = 
$¡r
;

620 ifĞ
$CTag
->
TagName
 == 'var' )

622 
$vÇme
 = 
$this
->
CTags
[
$i
]->
	`G‘A‰
('name');

623 if(
$vÇme
=='')

625 
$¡r
 = '';

627 if(
$this
->
CTags
[
$i
]->
	`G‘A‰
('value')!='')

629 
$_v¬s
[
$vÇme
] = 
$this
->
CTags
[
$i
]->
	`G‘A‰
('value');

633 
$¡r
 = (
	`is£t
(
$_v¬s
[
$vÇme
]) ? $_vars[$vname] : '');

635 
$this
->
CTags
[
$i
]->
IsR•Ïû
 = 
TRUE
;

636 
$this
->
CTags
[
$i
]->
TagV®ue
 = 
$¡r
;

640 ifĞ
$CTag
->
	`G‘A‰
('runphp') == 'yes' )

642 
$this
->
	`RunPHP
(
$CTag
, 
$i
);

644 if(
	`is_¬¿y
(
$this
->
CTags
[
$i
]->
TagV®ue
))

646 
$this
->
CTags
[
$i
]->
TagV®ue
 = 'array';

649 
	}
}

652 
funùiÚ
 
	$RunPHP
(&
$»fObj
, 
$i
)

654 
$XakMeV®ue
 = 
$phpcode
 = '';

655 if(
$»fObj
->
	`G‘A‰
('source')=='value')

657 
$phpcode
 = 
$this
->
CTags
[
$i
]->
TagV®ue
;

661 
$XakMeV®ue
 = 
$this
->
CTags
[
$i
]->
TagV®ue
;

662 
$phpcode
 = 
$»fObj
->
	`G‘IÂ”Text
();

664 
$phpcode
 = 
	`´eg_»¶aû
("/'@me'|\"@me\"|@me/i", '$XakMeValue', $phpcode);

665 @
	`ev®
(
$phpcode
);

667 
$this
->
CTags
[
$i
]->
TagV®ue
 = 
$XakMeV®ue
;

668 
$this
->
CTags
[
$i
]->
IsR•Ïû
 = 
TRUE
;

669 
	}
}

678 
funùiÚ
 
	$G‘ResuÉNP
()

680 
$ResuÉSŒšg
 = '';

681 if(
$this
->
CouÁ
==-1)

683  
$this
->
SourûSŒšg
;

685 
$this
->
	`AssignSysTag
();

686 
$ÃxtTagEnd
 = 0;

687 
$¡rok
 = "";

688 
$i
=0;$i<=
$this
->
CouÁ
;$i++)

690 if(
$this
->
CTags
[
$i
]->
	`G‘V®ue
()!="")

692 if(
$this
->
CTags
[
$i
]->
	`G‘V®ue
()=='#@Delete@#')

694 
$this
->
CTags
[
$i
]->
TagV®ue
 = "";

696 
$ResuÉSŒšg
 .ğ
	`sub¡r
(
$this
->
SourûSŒšg
,
$ÃxtTagEnd
,$this->
CTags
[
$i
]->
S¹Pos
-$nextTagEnd);

697 
$ResuÉSŒšg
 .ğ
$this
->
CTags
[
$i
]->
	`G‘V®ue
();

698 
$ÃxtTagEnd
 = 
$this
->
CTags
[
$i
]->
EndPos
;

701 
$¦’
 = 
	`¡¾’
(
$this
->
SourûSŒšg
);

702 if(
$¦’
>
$ÃxtTagEnd
)

704 
$ResuÉSŒšg
 .ğ
	`sub¡r
(
$this
->
SourûSŒšg
,
$ÃxtTagEnd
,
$¦’
-$nextTagEnd);

706  
$ResuÉSŒšg
;

707 
	}
}

715 
funùiÚ
 
	$G‘ResuÉ
()

717 
$ResuÉSŒšg
 = '';

718 if(
$this
->
CouÁ
==-1)

720  
$this
->
SourûSŒšg
;

722 
$this
->
	`AssignSysTag
();

723 
$ÃxtTagEnd
 = 0;

724 
$¡rok
 = "";

725 
$i
=0;$i<=
$this
->
CouÁ
;$i++)

727 
$ResuÉSŒšg
 .ğ
	`sub¡r
(
$this
->
SourûSŒšg
,
$ÃxtTagEnd
,$this->
CTags
[
$i
]->
S¹Pos
-$nextTagEnd);

728 
$ResuÉSŒšg
 .ğ
$this
->
CTags
[
$i
]->
	`G‘V®ue
();

729 
$ÃxtTagEnd
 = 
$this
->
CTags
[
$i
]->
EndPos
;

731 
$¦’
 = 
	`¡¾’
(
$this
->
SourûSŒšg
);

732 if(
$¦’
>
$ÃxtTagEnd
)

734 
$ResuÉSŒšg
 .ğ
	`sub¡r
(
$this
->
SourûSŒšg
,
$ÃxtTagEnd
,
$¦’
-$nextTagEnd);

736  
$ResuÉSŒšg
;

737 
	}
}

745 
funùiÚ
 
	$Di¥Ïy
()

747 
echo
 
$this
->
	`G‘ResuÉ
();

748 
	}
}

757 
funùiÚ
 
	$SaveTo
(
$f’ame
)

759 
$å
 = @
	`fİ’
(
$f’ame
,"w"è
Ü
 
	`d›
("XakTag Engine Create File False");

760 
	`fwr™e
(
$å
,
$this
->
	`G‘ResuÉ
());

761 
	`fşo£
(
$å
);

762 
	}
}

770 
funùiÚ
 
	$P¬£Tem¶‘
()

772 
$TagS¹WÜd
 = 
$this
->
TagS¹WÜd
;

773 
$TagEndWÜd
 = 
$this
->
TagEndWÜd
;

774 
$sPos
 = 0; 
$ePos
 = 0;

775 
$FuÎTagS¹WÜd
 = 
$TagS¹WÜd
.
$this
->
NameS·û
.":";

776 
$sTagEndWÜd
 = 
$TagS¹WÜd
."/".
$this
->
NameS·û
.":";

777 
$eTagEndWÜd
 = "/".
$TagEndWÜd
;

778 
$tsL’
 = 
	`¡¾’
(
$FuÎTagS¹WÜd
);

779 
$sourûL’
=
	`¡¾’
(
$this
->
SourûSŒšg
);

781 ifĞ
$sourûL’
 <ğ(
$tsL’
 + 3) )

785 
$cA‰
 = 
Ãw
 
	`XakA‰ribu‹P¬£
();

786 
$cA‰
->
ch¬ToLow
 = 
$this
->
Ch¬ToLow
;

789 
$i
=0; $˜< 
$sourûL’
; $i++)

791 
$tTagName
 = '';

794 if(
$i
-1 >= 0)

796 
$ss
 = 
$i
-1;

800 
$ss
 = 0;

802 
$sPos
 = 
	`¡½os
(
$this
->
SourûSŒšg
,
$FuÎTagS¹WÜd
,
$ss
);

803 
$isTag
 = 
$sPos
;

804 if(
$i
==0)

806 
$h—d”Tag
 = 
	`sub¡r
(
$this
->
SourûSŒšg
,0,
	`¡¾’
(
$FuÎTagS¹WÜd
));

807 if(
$h—d”Tag
==
$FuÎTagS¹WÜd
)

809 
$isTag
=
TRUE
; 
$sPos
=0;

812 if(
$isTag
===
FALSE
)

823 
$j
=(
$sPos
+
$tsL’
);$j<($sPos+$tsL’+
$this
->
TagMaxL’
);$j++)

825 if(
$j
>(
$sourûL’
-1))

829 ifĞ
	`´eg_m©ch
("/[\/ \t\r\n]/", 
$this
->
SourûSŒšg
[
$j
]è|| $this->SourûSŒšg[$j] =ğ$this->
TagEndWÜd
 )

835 
$tTagName
 .ğ
$this
->
SourûSŒšg
[
$j
];

838 if(
$tTagName
!='')

840 
$i
 = 
$sPos
+
$tsL’
;

841 
$’dPos
 = -1;

842 
$fuÎTagEndWÜdThis
 = 
$sTagEndWÜd
.
$tTagName
.
$TagEndWÜd
;

844 
$e1
 = 
	`¡½os
(
$this
->
SourûSŒšg
,
$eTagEndWÜd
, 
$i
);

845 
$e2
 = 
	`¡½os
(
$this
->
SourûSŒšg
,
$FuÎTagS¹WÜd
, 
$i
);

846 
$e3
 = 
	`¡½os
(
$this
->
SourûSŒšg
,
$fuÎTagEndWÜdThis
,
$i
);

850 
$e1
 = 
	`Œim
($e1); 
$e2
 =rim($e2); 
$e3
 =rim($e3);

851 
$e1
 = ($e1=='' ? '-1' : $e1);

852 
$e2
 = ($e2=='' ? '-1' : $e2);

853 
$e3
 = ($e3=='' ? '-1' : $e3);

855 if(
$e3
==-1)

857 
$’dPos
 = 
$e1
;

858 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$eTagEndWÜd
);

861 if(
$e1
==-1)

863 
$’dPos
 = 
$e3
;

864 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$fuÎTagEndWÜdThis
);

870 if(
$e1
 < 
$e2
 && $e1 < 
$e3
 )

872 
$’dPos
 = 
$e1
;

873 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$eTagEndWÜd
);

877 
$’dPos
 = 
$e3
;

878 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$fuÎTagEndWÜdThis
);

883 if(
$’dPos
==-1)

885 
echo
 "Tag Character…ostion $sPos, '$tTagName' Errorï¼<br />\r\n";

888 
$i
 = 
$–’
;

889 
$ePos
 = 
$’dPos
;

892 
$©tSŒ
 = '';

893 
$šÃrText
 = '';

894 
$¡¬tIÂ”
 = 0;

895 
$j
=(
$sPos
+
$tsL’
);$j < 
$ePos
;$j++)

897 if(
$¡¬tIÂ”
==0 && (
$this
->
SourûSŒšg
[
$j
]==
$TagEndWÜd
 && $this->SourceString[$j-1]!="\\") )

899 
$¡¬tIÂ”
=1;

902 if(
$¡¬tIÂ”
==0)

904 
$©tSŒ
 .ğ
$this
->
SourûSŒšg
[
$j
];

908 
$šÃrText
 .ğ
$this
->
SourûSŒšg
[
$j
];

912 
$cA‰
->
	`S‘Sourû
(
$©tSŒ
);

913 if(
$cA‰
->
cA‰ribu‹s
->
	`G‘TagName
()!='')

915 
$this
->
CouÁ
++;

916 
$CDTag
 = 
Ãw
 
	`XakTag
();

917 
$CDTag
->
TagName
 = 
$cA‰
->
cA‰ribu‹s
->
	`G‘TagName
();

918 
$CDTag
->
S¹Pos
 = 
$sPos
;

919 
$CDTag
->
EndPos
 = 
$i
;

920 
$CDTag
->
CA‰ribu‹
 = 
$cA‰
->
cA‰ribu‹s
;

921 
$CDTag
->
IsR•Ïû
 = 
FALSE
;

922 
$CDTag
->
TagID
 = 
$this
->
CouÁ
;

923 
$CDTag
->
IÂ”Text
 = 
$šÃrText
;

924 
$this
->
CTags
[$this->
CouÁ
] = 
$CDTag
;

929 
$i
 = 
$sPos
+
$tsL’
;

934 if(
$this
->
IsCache
)

936 
$this
->
	`SaveCache
();

938 
	}
}

949 
funùiÚ
 
	$Ev®Func
(
$f›ldv®ue
,
$funùiÚÇme
,&
$»fObj
)

951 
$XakF›ldV®ue
 = 
$f›ldv®ue
;

952 
$funùiÚÇme
 = 
	`¡r_»¶aû
("{\"","[\"",$functionname);

953 
$funùiÚÇme
 = 
	`¡r_»¶aû
("\"}","\"]",$functionname);

954 
$funùiÚÇme
 = 
	`´eg_»¶aû
("/'@me'|\"@me\"|@me/i",'$XakFieldValue',$functionname);

955 
$funùiÚÇme
 = "\$XakFieldValue = ".$functionname;

956 @
	`ev®
(
$funùiÚÇme
.";");

957 if(
	`em±y
(
$XakF›ldV®ue
))

963  
$XakF›ldV®ue
;

965 
	}
}

974 
funùiÚ
 
	$G‘Glob®s
(
$v¬Çme
)

976 
$v¬Çme
 = 
	`Œim
($varname);

979 if(
$v¬Çme
=="dbuserpwd"||$varname=="cfg_dbpwd")

985 if(
	`is£t
(
$GLOBALS
[
$v¬Çme
]))

987  
$GLOBALS
[
$v¬Çme
];

993 
	}
}

1003 
funùiÚ
 
InşudeFe
(
$f’ame
, 
$ismake
='no')

1005 
glob®
 
$cfg_df_¡yË
;

1006 
	g$»¡r
 = '';

1007 if(
	g$f’ame
=='')

1011 ifĞ
fe_exi¡s
(
XAKROOT
."/‹m¶‘s/".
$f’ame
) )

1013 
	g$okfe
 = 
XAKROOT
."/‹m¶‘s/".
$f’ame
;

1015 if(
fe_exi¡s
(
XAKROOT
.'/‹m¶‘s/'.
$cfg_df_¡yË
.'/'.
$f’ame
) )

1017 
	g$okfe
 = 
XAKROOT
.'/‹m¶‘s/'.
$cfg_df_¡yË
.'/'.
$f’ame
;

1025 if(
	g$ismake
!="no")

1027 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

1028 
	g$d
 = 
Ãw
 
XakTagP¬£
();

1029 
	g$d
->
LßdTem¶‘
(
$okfe
);

1030 
MakeOÃTag
(
$d
,
$this
->
»fObj
);

1031 
	g$»¡r
 = 
$d
->
G‘ResuÉ
();

1035 
	g$å
 = @
fİ’
(
$okfe
,"r");

1036 
	g$lše
=
fg‘s
(
$å
,1024)è
	g$»¡r
.=
$lše
;

1037 
fşo£
(
$å
);

1039  
	g$»¡r
;

1047 şas 
	cXakA‰ribu‹


1049 
v¬
 
	m$CouÁ
 = -1;

1050 
v¬
 
	m$I‹ms
 = "";

1052 
funùiÚ
 
	$G‘A‰
(
$¡r
)

1054 if(
$¡r
=="")

1058 if(
	`is£t
(
$this
->
I‹ms
[
$¡r
]))

1060  
$this
->
I‹ms
[
$¡r
];

1069 
funùiÚ
 
	$G‘A‰ribu‹
(
$¡r
)

1071  
$this
->
	`G‘A‰
(
$¡r
);

1072 
	}
}

1075 
funùiÚ
 
	$IsA‰ribu‹
(
$¡r
)

1077 if(
	`is£t
(
$this
->
I‹ms
[
$¡r
])è 
TRUE
;

1078  
FALSE
;

1079 
	}
}

1082 
funùiÚ
 
	$G‘TagName
()

1084  
$this
->
	`G‘A‰
("tagname");

1085 
	}
}

1088 
funùiÚ
 
	$G‘CouÁ
()

1090  
$this
->
CouÁ
+1;

1091 
	}
}

1097 şas 
	cXakA‰ribu‹P¬£


1099 
v¬
 
	m$sourûSŒšg
 = "";

1100 
v¬
 
	m$sourûMaxSize
 = 1024;

1101 
v¬
 
	m$cA‰ribu‹s
 = "";

1102 
v¬
 
	m$ch¬ToLow
 = 
TRUE
;

1103 
funùiÚ
 
S‘Sourû
(
$¡r
='')

1105 
$this
->
cA‰ribu‹s
 = 
Ãw
 
XakA‰ribu‹
();

1106 
	m$¡rL’
 = 0;

1107 
	m$this
->
	msourûSŒšg
 = 
Œim
(
´eg_»¶aû
("/[ \r\n\t]{1,}/"," ",
$¡r
));

1110 
	m$this
->
	msourûSŒšg
 = 
¡r_»¶aû
('\]',']',
$this
->
sourûSŒšg
);

1111 
	m$this
->
	msourûSŒšg
 = 
¡r_»¶aû
('[','[',
$this
->
sourûSŒšg
);

1119 
	m$¡rL’
 = 
¡¾’
(
$this
->
sourûSŒšg
);

1120 if(
	m$¡rL’
>0 && $¡rL’ <ğ
$this
->
sourûMaxSize
)

1122 
$this
->
P¬£A‰ribu‹
();

1127 
funùiÚ
 
	$P¬£A‰ribu‹
()

1129 
$d
 = '';

1130 
$tm·‰
 = '';

1131 
$tmpv®ue
 = '';

1132 
$¡¬tdd
 = -1;

1133 
$ddg
 = '';

1134 
$hasA‰ribu‹
=
FALSE
;

1135 
$¡rL’
 = 
	`¡¾’
(
$this
->
sourûSŒšg
);

1138 
$i
=0; $i<
$¡rL’
; $i++)

1140 if(
$this
->
sourûSŒšg
[
$i
]==' ')

1142 
$this
->
cA‰ribu‹s
->
CouÁ
++;

1143 
$tmpv®ues
 = 
	`ex¶ode
('.', 
$tmpv®ue
);

1144 
$this
->
cA‰ribu‹s
->
I‹ms
['gÇme'] = ($this->
ch¬ToLow
 ? 
	`¡¹Şow”
(
$tmpv®ues
[0]) : $tmpvalues[0]);

1145 if(
	`is£t
(
$tmpv®ues
[1]) && $tmpvalues[1]!='')

1147 
$this
->
cA‰ribu‹s
->
I‹ms
['Çme'] = 
$tmpv®ues
[1];

1149 
$tmpv®ue
 = '';

1150 
$hasA‰ribu‹
 = 
TRUE
;

1155 
$tmpv®ue
 .ğ
$this
->
sourûSŒšg
[
$i
];

1160 if(!
$hasA‰ribu‹
)

1162 
$this
->
cA‰ribu‹s
->
CouÁ
++;

1163 
$tmpv®ues
 = 
	`ex¶ode
('.', 
$tmpv®ue
);

1164 
$this
->
cA‰ribu‹s
->
I‹ms
['gÇme'] = ($this->
ch¬ToLow
 ? 
	`¡¹Şow”
(
$tmpv®ues
[0]) : $tmpvalues[0]);

1165 if(
	`is£t
(
$tmpv®ues
[1]) && $tmpvalues[1]!='')

1167 
$this
->
cA‰ribu‹s
->
I‹ms
['Çme'] = 
$tmpv®ues
[1];

1171 
$tmpv®ue
 = '';

1174 
$i
; $i<
$¡rL’
; $i++)

1176 
$d
 = 
$this
->
sourûSŒšg
[
$i
];

1178 if(
$¡¬tdd
==-1)

1180 if(
$d
 != '=')

1182 
$tm·‰
 .ğ
$d
;

1186 if(
$this
->
ch¬ToLow
)

1188 
$tm·‰
 = 
	`¡¹Şow”
(
	`Œim
($tmpatt));

1192 
$tm·‰
 = 
	`Œim
($tmpatt);

1194 
$¡¬tdd
=0;

1199 if(
$¡¬tdd
==0)

1201 
$d
)

1206 
$ddg
 = '"';

1207 
$¡¬tdd
 = 1;

1210 
$ddg
 = '\'';

1211 
$¡¬tdd
 = 1;

1214 
$tmpv®ue
 .ğ
$d
;

1215 
$ddg
 = ' ';

1216 
$¡¬tdd
 = 1;

1220 if(
$¡¬tdd
==1)

1222 if(
$d
==
$ddg
 && ( 
	`is£t
(
$this
->
sourûSŒšg
[
$i
-1]) && $this->sourceString[$i-1]!="\\") )

1224 
$this
->
cA‰ribu‹s
->
CouÁ
++;

1225 
$this
->
cA‰ribu‹s
->
I‹ms
[
$tm·‰
] = 
	`Œim
(
$tmpv®ue
);

1226 
$tm·‰
 = '';

1227 
$tmpv®ue
 = '';

1228 
$¡¬tdd
 = -1;

1232 
$tmpv®ue
 .ğ
$d
;

1238 if(
$tm·‰
 != '')

1240 
$this
->
cA‰ribu‹s
->
CouÁ
++;

1241 
$this
->
cA‰ribu‹s
->
I‹ms
[
$tm·‰
] = 
	`Œim
(
$tmpv®ue
);

1244 
	}
}

	@E:\web\weixun\functions\xaktemplate.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

26 
funùiÚ
 
MakePublicTag
(
$©ts
=
¬¿y
(),
$»fObj
='',
$f›lds
=
	$¬¿y
())

28 
$©ts
['gÇme'] = 
	`´eg_»¶aû
("/[0-9]{1,}$/", "", $atts['tagname']);

29 
$¶usfe
 = 
XAKINC
.'/Îib/¶us_'.
$©ts
['tagname'].'.php';

30 if(!
	`fe_exi¡s
(
$¶usfe
))

32 if(
	`is£t
(
$©ts
['rstype']) && $atts['rstype']=='string')

38  
	`¬¿y
();

43 
	`šşude_Úû
(
$¶usfe
);

44 
$func
 = '¶us_'.
$©ts
['tagname'];

45  
	`$func
(
$©ts
, 
$»fObj
, 
$f›lds
);

47 
	}
}

57 
funùiÚ
 
	$FlA‰s
(&
$©ts
, 
$©i¡
)

59 
$©i¡s
 = 
	`ex¶ode
(',', 
$©i¡
);

60 
	`fÜ—ch
(
$©i¡s
 
as
 
$©t
)

62 
	`li¡
(
$k
, 
$v
)=
	`ex¶ode
('=', 
$©t
);

63 if(!
	`is£t
(
$©ts
[
$k
]))

65 
$©ts
[
$k
] = 
$v
;

68 
	}
}

79 
funùiÚ
 
	$FlF›lds
(&
$©ts
, &
$»fObj
, &
$f›lds
)

81 
glob®
 
$_v¬s
;

82 
	`fÜ—ch
(
$©ts
 
as
 
$k
=>
$v
)

84 if(
	`´eg_m©ch
('/^f›ld\./i',
$v
))

86 
$key
 = 
	`´eg_»¶aû
('/^f›ld\./i', '', 
$v
);

87 ifĞ
	`is£t
(
$f›lds
[
$key
]) )

89 
$©ts
[
$k
] = 
$f›lds
[
$key
];

92 if(
	`´eg_m©ch
('/^v¬\./i', 
$v
))

94 
$key
 = 
	`´eg_»¶aû
('/^v¬\./i', '', 
$v
);

95 ifĞ
	`is£t
(
$_v¬s
[
$key
]) )

97 
$©ts
[
$k
] = 
$_v¬s
[
$key
];

100 if(
	`´eg_m©ch
('/^glob®\./i', 
$v
))

102 
$key
 = 
	`´eg_»¶aû
('/^glob®\./i', '', 
$v
);

103 ifĞ
	`is£t
(
$GLOBALS
[
$key
]) )

105 
$©ts
[
$k
] = 
$GLOBALS
[
$key
];

109 
	}
}

117 şas 
	cTag


119 
v¬
 
	m$isComp”
=
FALSE
;

120 
v¬
 
	m$gName
="";

121 
v¬
 
	m$šÃrText
="";

122 
v¬
 
	m$¡¬tPos
=0;

123 
v¬
 
	m$’dPos
=0;

124 
v¬
 
	m$cA‰
="";

125 
v¬
 
	m$gV®ue
="";

126 
v¬
 
	m$gID
 = 0;

134 
funùiÚ
 
	$G‘Name
()

136  
	`¡¹Şow”
(
$this
->
gName
);

139 
funùiÚ
 
	$G‘V®ue
()

141  
$this
->
gV®ue
;

142 
	}
}

144 
funùiÚ
 
	$IsA‰
(
$¡r
)

146  
$this
->
cA‰
->
	`IsA‰ribu‹
(
$¡r
);

147 
	}
}

149 
funùiÚ
 
	$G‘A‰
(
$¡r
)

151  
$this
->
cA‰
->
	`G‘A‰
(
$¡r
);

152 
	}
}

159 
funùiÚ
 
	$G‘šÃrText
()

161  
$this
->
šÃrText
;

162 
	}
}

171 şas 
	cXakTem¶©e


173 
v¬
 
	m$gMaxL’
 = 64;

174 
v¬
 
	m$ch¬ToLow
 = 
TRUE
;

175 
v¬
 
	m$isCache
 = 
TRUE
;

176 
v¬
 
	m$isP¬£
 = 
FALSE
;

177 
v¬
 
	m$isComp”
 = 
TRUE
;

178 
v¬
 
	m$‹m¶©eDœ
 = '';

179 
v¬
 
	m$‹mpMkTime
 = 0;

180 
v¬
 
	m$ÿcheFe
 = '';

181 
v¬
 
	m$cÚfigFe
 = '';

182 
v¬
 
	m$budFe
 = '';

183 
v¬
 
	m$»fDœ
 = '';

184 
v¬
 
	m$ÿcheDœ
 = '';

185 
v¬
 
	m$‹m¶©eFe
 = '';

186 
v¬
 
	m$sourûSŒšg
 = '';

187 
v¬
 
	m$cTags
 = '';

190 
v¬
 
	m$couÁ
 = -1;

191 
v¬
 
	m$loİNum
 = 0;

192 
v¬
 
	m$»fObj
 = '';

193 
v¬
 
	m$makeLoİ
 = 0;

194 
v¬
 
	m$gS¹WÜd
 = '{xak:';

195 
v¬
 
	m$fuÎTagEndWÜd
 = '{/xak:';

196 
v¬
 
	m$sTagEndWÜd
 = '/}';

197 
v¬
 
	m$gEndWÜd
 = '}';

198 
v¬
 
	m$Cfgs
 = 
¬¿y
();

209 
funùiÚ
 
__cÚ¡ruù
(
$‹m¶©edœ
='',
$»fDœ
='')

213 if(
$‹m¶©edœ
=='')

215 
$this
->
‹m¶©eDœ
 = 
XAKROOT
.'/templets';

219 
	m$this
->
	m‹m¶©eDœ
 = 
$‹m¶©edœ
;

223 if(
	m$»fDœ
=='')

225 if(
is£t
(
$GLOBALS
['cfg_df_style']))

227 
$this
->
»fDœ
 = $this->
‹m¶©eDœ
.'/'.
$GLOBALS
['cfg_df_style'].'/';

231 
	m$this
->
	m»fDœ
 = 
$this
->
‹m¶©eDœ
;

234 
	m$this
->
	mÿcheDœ
 = 
XAKROOT
.
$GLOBALS
['cfg_tplcache_dir'];

238 
funùiÚ
 
XakTem¶©e
(
$‹m¶©edœ
='',
$»fDœ
='')

240 
$this
->
__cÚ¡ruù
(
$‹m¶©edœ
,
$»fDœ
);

250 
funùiÚ
 
	$S‘Objeù
(&
$»fObj
)

252 
$this
->
»fObj
 = 
$»fObj
;

253 
	}
}

263 
funùiÚ
 
	$S‘V¬
(
$k
, 
$v
)

265 
$GLOBALS
['_v¬s'][
$k
] = 
$v
;

266 
	}
}

276 
funùiÚ
 
	$Assign
(
$k
, 
$v
)

278 
$GLOBALS
['_v¬s'][
$k
] = 
$v
;

279 
	}
}

289 
funùiÚ
 
	$S‘A¼ay
(
$k
, 
$v
)

291 
$GLOBALS
[
$k
] = 
$v
;

292 
	}
}

304 
funùiÚ
 
S‘TagStyË
(
$ts
='{xak:',
$á’d
='{/xak:',
$¡’d
='/}',
$‹nd
='}')

306 
$this
->
gS¹WÜd
 = 
$ts
;

307 
	g$this
->
	gfuÎTagEndWÜd
 = 
$á’d
;

308 
	g$this
->
	gsTagEndWÜd
 = 
$¡’d
;

309 
	g$this
->
	ggEndWÜd
 = 
$‹nd
;

319 
funùiÚ
 
	$G‘CÚfig
(
$k
)

321  (
	`is£t
(
$this
->
Cfgs
[
$k
]) ? $this->tpCfgs[$k] : '');

322 
	}
}

331 
funùiÚ
 
	$LßdTem¶©e
(
$tmpfe
)

333 if(!
	`fe_exi¡s
(
$tmpfe
))

335 
echo
 " Template Not Found! ";

336 
	`ex™
();

338 
$tmpfe
 = 
	`´eg_»¶aû
("/[\\/]{1,}/", "/", $tmpfile);

339 
$tmpfes
 = 
	`ex¶ode
('/',
$tmpfe
);

340 
$tmpfeOÆyName
 = 
	`´eg_»¶aû
("/(.*)\//", "", 
$tmpfe
);

341 
$this
->
‹m¶©eFe
 = 
$tmpfe
;

342 
$this
->
»fDœ
 = '';

343 
$i
=0; $˜< 
	`couÁ
(
$tmpfes
)-1; $i++)

345 
$this
->
»fDœ
 .ğ
$tmpfes
[
$i
].'/';

347 if(!
	`is_dœ
(
$this
->
ÿcheDœ
))

349 
$this
->
ÿcheDœ
 = $this->
»fDœ
;

351 if(
$this
->
ÿcheDœ
!='')

353 
$this
->
ÿcheDœ
 = $this->cacheDir.'/';

355 if(
	`is£t
(
$GLOBALS
['_DEBUG_CACHE']))

357 
$this
->
ÿcheDœ
 = $this->
»fDœ
;

359 
$this
->
ÿcheFe
 = $this->
ÿcheDœ
.
	`´eg_»¶aû
("/\.(wml|html|htm|php)$/", "_".$this->
	`G‘EncodeSŒ
(
$tmpfe
).'.šc', 
$tmpfeOÆyName
);

360 
$this
->
cÚfigFe
 = $this->
ÿcheDœ
.
	`´eg_»¶aû
("/\.(wml|html|htm|php)$/", "_".$this->
	`G‘EncodeSŒ
(
$tmpfe
).'_cÚfig.šc', 
$tmpfeOÆyName
);

363 if(
$this
->
isCache
==
FALSE
 || !
	`fe_exi¡s
($this->
ÿcheFe
)

364 || 
	`femtime
(
$this
->
‹m¶©eFe
è> femtime($this->
ÿcheFe
))

366 
$t1
 = 
	`ExecTime
();

367 
$å
 = 
	`fİ’
(
$this
->
‹m¶©eFe
,'r');

368 
$this
->
sourûSŒšg
 = 
	`ä—d
(
$å
,
	`fesize
($this->
‹m¶©eFe
));

369 
	`fşo£
(
$å
);

370 
$this
->
	`P¬£Tem¶©e
();

378 if(
	`fe_exi¡s
(
$this
->
cÚfigFe
))

380 
	`šşude
(
$this
->
cÚfigFe
);

383 
	}
}

392 
funùiÚ
 
LßdSŒšg
(
$¡r
='')

394 
$this
->
sourûSŒšg
 = 
$¡r
;

395 
	g$hashcode
 = 
md5
(
$this
->
sourûSŒšg
);

396 
	g$this
->
	gÿcheFe
 = 
$this
->
ÿcheDœ
."/¡ršg_".
$hashcode
.".inc";

397 
	g$this
->
	gcÚfigFe
 = 
$this
->
ÿcheDœ
."/¡ršg_".
$hashcode
."_config.inc";

398 
	g$this
->
P¬£Tem¶©e
();

407 
funùiÚ
 
	$CacheFe
()

409 
glob®
 
$gtmpfe
;

410 
$this
->
	`Wr™eCache
();

411  
$this
->
ÿcheFe
;

412 
	}
}

422 
funùiÚ
 
	$Di¥Ïy
()

424 
glob®
 
$gtmpfe
;

425 
	`exŒaù
(
$GLOBALS
, 
EXTR_SKIP
);

426 
$this
->
	`Wr™eCache
();

427 
šşude
 
$this
->
ÿcheFe
;

428 
	}
}

437 
funùiÚ
 
	$SaveTo
(
$§vefe
)

439 
	`exŒaù
(
$GLOBALS
, 
EXTR_SKIP
);

440 
$this
->
	`Wr™eCache
();

441 
	`ob_¡¬t
();

442 
šşude
 
$this
->
ÿcheFe
;

443 
$ok¡r
 = 
	`ob_g‘_cÚ‹Ás
();

444 
	`ob_’d_ş—n
();

445 
$å
 = @
	`fİ’
(
$§vefe
,"w"è
Ü
 
	`d›
(" Tag Engine Create File FALSE! ");

446 
	`fwr™e
(
$å
,
$ok¡r
);

447 
	`fşo£
(
$å
);

448 
	}
}

461 
funùiÚ
 
CheckDi§bËdFunùiÚs
(
$¡r
,&
$”rmsg
='')

463 
glob®
 
$cfg_di§bË_funs
;

464 
	g$cfg_di§bË_funs
 = 
is£t
(
$cfg_di§bË_funs
)? $cfg_disable_funs : 'phpinfo,eval,exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,file_put_contents,fsockopen,fopen,fwrite';

466 ià(!
defšed
('XAKDISFUN')) {

467 
	g$tok’s
 = 
tok’_g‘_®l_Æ
(
$¡r
);

468 
	g$di§bËd_funùiÚs
 = 
ex¶ode
(',', 
$cfg_di§bË_funs
);

469 
fÜ—ch
 (
$tok’s
 
as
 
$tok’
)

471 ià(
is_¬¿y
(
$tok’
))

473 ià(
	g$tok’
[0] = '306' && 
š_¬¿y
(
$tok’
[1], 
$di§bËd_funùiÚs
))

475 
	g$”rmsg
 = 'E¼Ü:funùiÚ di§bËd '.
$tok’
[1];

476  
	gFALSE
;

481  
	gTRUE
;

491 
funùiÚ
 
Wr™eCache
(
$ùy³
='all')

493 if(!
fe_exi¡s
(
$this
->
ÿcheFe
è|| $this->
isCache
==
FALSE


494 || ( 
fe_exi¡s
(
$this
->
‹m¶©eFe
è&& (
femtime
($this->‹m¶©eFeè> femtime($this->
ÿcheFe
)) ) )

496 if(!
$this
->
isP¬£
)

498 
$this
->
P¬£Tem¶©e
();

500 
	g$å
 = 
fİ’
(
$this
->
ÿcheFe
,'w'è
Ü
 
dœ
("Write Cache File Error! ");

501 
æock
(
$å
,3);

502 
	g$»suÉ
 = 
Œim
(
$this
->
G‘ResuÉ
());

503 
	g$”rmsg
 = '';

505 ià(!
	g$this
->
CheckDi§bËdFunùiÚs
(
$»suÉ
, 
$”rmsg
))

507 
fşo£
(
$å
);

508 @
uÆšk
(
$this
->
ÿcheFe
);

509 
d›
(
$”rmsg
);

511 
fwr™e
(
$å
,
$»suÉ
);

512 
fşo£
(
$å
);

513 if(
couÁ
(
$this
->
Cfgs
) > 0)

515 
	g$å
 = 
fİ’
(
$this
->
cÚfigFe
,'w'è
Ü
 
dœ
("Write Config File Error! ");

516 
æock
(
$å
,3);

517 
fwr™e
(
$å
,'<'.'?php'."\r\n");

518 
fÜ—ch
(
$this
->
Cfgs
 
as
 
$k
=>
$v
)

520 
$v
 = 
¡r_»¶aû
("\"","\\\"",$v);

521 
	g$v
 = 
¡r_»¶aû
("\$","\\\$",
$v
);

522 
fwr™e
(
$å
,"\$this->tpCfgs['$k']=\"$v\";\r\n");

524 
fwr™e
(
$å
,'?'.'>');

525 
fşo£
(
$å
);

589 
funùiÚ
 
	$G‘EncodeSŒ
(
$tmpfe
)

592 
$’codeSŒ
 = 
	`sub¡r
(
	`md5
(
$tmpfe
),0,24);

593  
$’codeSŒ
;

594 
	}
}

602 
funùiÚ
 
	$P¬£Tem¶©e
()

604 if(
$this
->
makeLoİ
 > 5)

608 
$this
->
couÁ
 = -1;

609 
$this
->
cTags
 = 
	`¬¿y
();

610 
$this
->
isP¬£
 = 
TRUE
;

611 
$sPos
 = 0;

612 
$ePos
 = 0;

613 
$gS¹WÜd
 = 
$this
->
gS¹WÜd
;

614 
$fuÎTagEndWÜd
 = 
$this
->
fuÎTagEndWÜd
;

615 
$sTagEndWÜd
 = 
$this
->
sTagEndWÜd
;

616 
$gEndWÜd
 = 
$this
->
gEndWÜd
;

617 
$¡¬tWÜdL’
 = 
	`¡¾’
(
$gS¹WÜd
);

618 
$sourûL’
 = 
	`¡¾’
(
$this
->
sourûSŒšg
);

619 ifĞ
$sourûL’
 <ğ(
$¡¬tWÜdL’
 + 3) )

623 
$cA‰
 = 
Ãw
 
	`TagA‰ribu‹P¬£
();

624 
$cA‰
->
Ch¬ToLow
 = 
TRUE
;

627 
$t
 = 0;

628 
$´eTag
 = '';

629 
$tswL’
 = 
	`¡¾’
(
$gS¹WÜd
);

630 
$i
=0; $i<
$sourûL’
; $i++)

632 
$‰agName
 = '';

636 if(
$i
-1>=0)

638 
$ss
 = 
$i
-1;

642 
$ss
 = 0;

644 
$gPos
 = 
	`¡½os
(
$this
->
sourûSŒšg
,
$gS¹WÜd
,
$ss
);

647 if(
$gPos
==0 && (
$sourûL’
-
$i
 < 
$tswL’


648 || 
	`sub¡r
(
$this
->
sourûSŒšg
,
$i
,
$tswL’
)!=
$gS¹WÜd
 ))

650 
$gPos
 = -1;

655 
$j
 = 
$gPos
+
$¡¬tWÜdL’
; $j < $gPos+$¡¬tWÜdL’+
$this
->
gMaxL’
; $j++)

657 if(
	`´eg_m©ch
("/[ >\/\r\n\t\}\.]/", 
$this
->
sourûSŒšg
[
$j
]))

663 
$‰agName
 .ğ
$this
->
sourûSŒšg
[
$j
];

666 if(
$‰agName
!='')

668 
$i
 = 
$gPos
 + 
$¡¬tWÜdL’
;

669 
$’dPos
 = -1;

672 
$fuÎTagEndWÜdThis
 = 
$fuÎTagEndWÜd
.
$‰agName
.
$gEndWÜd
;

673 
$e1
 = 
	`¡½os
(
$this
->
sourûSŒšg
, 
$sTagEndWÜd
, 
$i
);

674 
$e2
 = 
	`¡½os
(
$this
->
sourûSŒšg
, 
$gS¹WÜd
, 
$i
);

675 
$e3
 = 
	`¡½os
(
$this
->
sourûSŒšg
, 
$fuÎTagEndWÜdThis
, 
$i
);

676 
$e1
 = 
	`Œim
($e1); 
$e2
 =rim($e2); 
$e3
 =rim($e3);

677 
$e1
 = ($e1=='' ? '-1' : $e1);

678 
$e2
 = ($e2=='' ? '-1' : $e2);

679 
$e3
 = ($e3=='' ? '-1' : $e3);

680 if(
$e3
==-1)

683 
$’dPos
 = 
$e1
;

684 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$sTagEndWÜd
);

686 if(
$e1
==-1)

689 
$’dPos
 = 
$e3
;

690 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$fuÎTagEndWÜdThis
);

697 if(
$e1
 < 
$e2
 && $e1 < 
$e3
 )

699 
$’dPos
 = 
$e1
;

700 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$sTagEndWÜd
);

704 
$’dPos
 = 
$e3
;

705 
$–’
 = 
$’dPos
 + 
	`¡¾’
(
$fuÎTagEndWÜdThis
);

710 if(
$’dPos
==-1)

712 
echo
 "Tpl Character…ostion $tagPos, '$ttagName' Errorï¼<br />\r\n";

715 
$i
 = 
$–’
;

718 
$©tSŒ
 = '';

719 
$šÃrText
 = '';

720 
$¡¬tIÂ”
 = 0;

721 
$j
 = 
$gPos
+
$¡¬tWÜdL’
; $j < 
$’dPos
; $j++)

723 if(
$¡¬tIÂ”
==0)

725 if(
$this
->
sourûSŒšg
[
$j
]==
$gEndWÜd
)

727 
$¡¬tIÂ”
=1; ;

731 
$©tSŒ
 .ğ
$this
->
sourûSŒšg
[
$j
];

736 
$šÃrText
 .ğ
$this
->
sourûSŒšg
[
$j
];

739 
$‰agName
 = 
	`¡¹Şow”
($ttagName);

742 if(
	`´eg_m©ch
("/^if[0-9]{0,}$/", 
$‰agName
))

744 
$cA‰
->
cA‰ribu‹s
 = 
Ãw
 
	`TagA‰ribu‹
();

745 
$cA‰
->
cA‰ribu‹s
->
couÁ
 = 2;

746 
$cA‰
->
cA‰ribu‹s
->
™ems
['gÇme'] = 
$‰agName
;

747 
$cA‰
->
cA‰ribu‹s
->
™ems
['cÚd™iÚ'] = 
	`´eg_»¶aû
("/^if[0-9]{0,}[\r\n\ˆ]/", "", 
$©tSŒ
);

748 
$šÃrText
 = 
	`´eg_»¶aû
("/\{else\}/i", '<'."?php\r\n}\r\nelse{\r\n".'?'.'>', $innerText);

750 if(
$‰agName
=='php')

752 
$cA‰
->
cA‰ribu‹s
 = 
Ãw
 
	`TagA‰ribu‹
();

753 
$cA‰
->
cA‰ribu‹s
->
couÁ
 = 2;

754 
$cA‰
->
cA‰ribu‹s
->
™ems
['gÇme'] = 
$‰agName
;

755 
$cA‰
->
cA‰ribu‹s
->
™ems
['code'] = '<'."?php\r\n".
	`Œim
(
	`´eg_»¶aû
("/^php[0-9]{0,}[\r\n\t ]/",

756 "",
$©tSŒ
))."\r\n?".'>';

761 
$cA‰
->
	`S‘Sourû
(
$©tSŒ
);

763 
$this
->
couÁ
++;

764 
$cTag
 = 
Ãw
 
	`Tag
();

765 
$cTag
->
gName
 = 
$‰agName
;

766 
$cTag
->
¡¬tPos
 = 
$gPos
;

767 
$cTag
->
’dPos
 = 
$i
;

768 
$cTag
->
cA‰
 = 
$cA‰
->
cA‰ribu‹s
;

769 
$cTag
->
isComp”
 = 
FALSE
;

770 
$cTag
->
gID
 = 
$this
->
couÁ
;

771 
$cTag
->
šÃrText
 = 
$šÃrText
;

772 
$this
->
cTags
[$this->
couÁ
] = 
$cTag
;

776 
$i
 = 
$gPos
+
$¡¬tWÜdL’
;

780 ifĞ
$this
->
couÁ
 > -1 && $this->
isComp”
 )

782 
$this
->
	`Comp”AÎ
();

784 
	}
}

793 
funùiÚ
 
	$Comp”AÎ
()

795 
$this
->
loİNum
++;

796 if(
$this
->
loİNum
 > 10)

800 
$ResuÉSŒšg
 = '';

801 
$ÃxtTagEnd
 = 0;

802 
$i
=0; 
	`is£t
(
$this
->
cTags
[$i]); $i++)

804 
$ResuÉSŒšg
 .ğ
	`sub¡r
(
$this
->
sourûSŒšg
, 
$ÃxtTagEnd
, $this->
cTags
[
$i
]->
¡¬tPos
 - $nextTagEnd);

805 
$ResuÉSŒšg
 .ğ
$this
->
	`Comp”OÃTag
($this->
cTags
[
$i
]);

806 
$ÃxtTagEnd
 = 
$this
->
cTags
[
$i
]->
’dPos
;

808 
$¦’
 = 
	`¡¾’
(
$this
->
sourûSŒšg
);

809 if(
$¦’
 > 
$ÃxtTagEnd
)

811 
$ResuÉSŒšg
 .ğ
	`sub¡r
(
$this
->
sourûSŒšg
,
$ÃxtTagEnd
,
$¦’
-$nextTagEnd);

813 
$this
->
sourûSŒšg
 = 
$ResuÉSŒšg
;

814 
$this
->
	`P¬£Tem¶©e
();

815 
	}
}

824 
funùiÚ
 
	$G‘ResuÉ
()

826 if(!
$this
->
isP¬£
)

828 
$this
->
	`P¬£Tem¶©e
();

830 
$add£t
 = '';

831 
$add£t
 .= '<'.'?php'."\r\n".'if(!isset($GLOBALS[\'_vars\'])) $GLOBALS[\'_vars\'] =‡rray(); '."\r\n".'$fields =‡rray();'."\r\n".'?'.'>';

832  
	`´eg_»¶aû
("/\?".">[ \r\n\t]{0,}<"."\?php/", "", 
$add£t
.
$this
->
sourûSŒšg
);

833 
	}
}

842 
funùiÚ
 
	$Comp”OÃTag
(&
$cTag
)

844 
$cTag
->
isComp”
 = 
TRUE
;

845 
$gÇme
 = 
$cTag
->
gName
;

846 
$v¬Çme
 = 
$cTag
->
	`G‘A‰
('name');

847 
$rsv®ue
 = "";

851 ifĞ
$gÇme
 == 'config' )

853 
$this
->
Cfgs
[
$v¬Çme
] = 
$cTag
->
	`G‘A‰
('value');

855 ifĞ
$gÇme
 == 'global' )

857 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”A¼ayV¬
('glob®',
$v¬Çme
);

858 ifĞ
$cTag
->
	`G‘A‰
('function') != '' )

860 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”FunùiÚ
($cTag->
	`G‘A‰
('function'), $cTag->tagValue);

862 
$cTag
->
gV®ue
 = '<'.'?phpƒcho '.$cTag->tagValue.'; ?'.'>';

864 ifĞ
$gÇme
 == 'cfg' )

866 
$cTag
->
gV®ue
 = '$GLOBALS[\'cfg_'.
$v¬Çme
.'\']';

867 ifĞ
$cTag
->
	`G‘A‰
('function')!='' )

869 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”FunùiÚ
($cTag->
	`G‘A‰
('function'), $cTag->tagValue);

871 
$cTag
->
gV®ue
 = '<'.'?phpƒcho '.$cTag->tagValue.'; ?'.'>';

873 ifĞ
$gÇme
 == 'name' )

875 
$cTag
->
gV®ue
 = '$'.
$v¬Çme
;

876 ifĞ
$cTag
->
	`G‘A‰
('function')!='' )

878 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”FunùiÚ
($cTag->
	`G‘A‰
('function'), $cTag->tagValue);

880 
$cTag
->
gV®ue
 = '<'.'?phpƒcho '.$cTag->tagValue.'; ?'.'>';

882 ifĞ
$gÇme
 == 'object' )

884 
	`li¡
(
$_obs
,
$_em
èğ
	`ex¶ode
('->',
$v¬Çme
);

885 
$cTag
->
gV®ue
 = "\$GLOBALS['{$_obs}']->{$_em}";

886 ifĞ
$cTag
->
	`G‘A‰
('function')!='' )

888 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”FunùiÚ
($cTag->
	`G‘A‰
('function'), $cTag->tagValue);

890 
$cTag
->
gV®ue
 = '<'.'?phpƒcho '.$cTag->tagValue.'; ?'.'>';

892 if(
$gÇme
 == 'var')

894 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”A¼ayV¬
('v¬', 
$v¬Çme
);

896 ifĞ
$cTag
->
	`G‘A‰
('function')!='' )

898 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”FunùiÚ
($cTag->
	`G‘A‰
('function'), $cTag->tagValue);

901 ià(
$cTag
->
	`G‘A‰
('default')!='')

903 
$cTag
->
gV®ue
 = '<'.'?ph°echØem±y('.$cTag->gV®ue.')? \''.
	`add¦ashes
($cTag->
	`G‘A‰
('default')).'\':'.$cTag->tagValue.'; ?'.'>';

905 
$cTag
->
gV®ue
 = '<'.'?phpƒcho '.$cTag->tagValue.'; ?'.'>';

908 if(
$gÇme
 == 'field')

910 
$cTag
->
gV®ue
 = '$f›lds[\''.
$v¬Çme
.'\']';

911 ifĞ
$cTag
->
	`G‘A‰
('function')!='' )

913 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”FunùiÚ
($cTag->
	`G‘A‰
('function'), $cTag->tagValue);

915 
$cTag
->
gV®ue
 = '<'.'?phpƒcho '.$cTag->tagValue.'; ?'.'>';

917 ifĞ
	`´eg_m©ch
("/^key[0-9]{0,}/", 
$gÇme
) ||…reg_match("/^value[0-9]{0,}/", $tagname))

919 ifĞ
	`´eg_m©ch
("/^v®ue[0-9]{0,}/", 
$gÇme
è&& 
$v¬Çme
!='' )

921 
$cTag
->
gV®ue
 = '<'.'?ph°echØ'.
$this
->
	`Comp”A¼ayV¬
(
$gÇme
,
$v¬Çme
).'; ?'.'>';

925 
$cTag
->
gV®ue
 = '<'.'?ph°echØ$'.
$gÇme
.'; ?'.'>';

928 ifĞ
	`´eg_m©ch
("/^if[0-9]{0,}$/", 
$gÇme
) )

930 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”If
($cTag);

932 ifĞ
$gÇme
=='echo' )

934 if(
	`Œim
(
$cTag
->
	`G‘IÂ”Text
())==''è$cTag->
gV®ue
 = $cTag->
	`G‘A‰
('code');

937 
$cTag
->
gV®ue
 = '<'."?ph°echØ$".
	`Œim
($cTag->
	`G‘IÂ”Text
())." ;?".'>';

940 ifĞ
$gÇme
=='php' )

942 if(
	`Œim
(
$cTag
->
	`G‘IÂ”Text
())==''è$cTag->
gV®ue
 = $cTag->
	`G‘A‰
('code');

945 
$cTag
->
gV®ue
 = '<'."?php\r\n".
	`Œim
($cTag->
	`G‘IÂ”Text
())."\r\n?".'>';

950 ifĞ
	`´eg_m©ch
("/^¬¿y[0-9]{0,}/",
$gÇme
) )

952 
$kk
 = '$key';

953 
$vv
 = '$value';

954 if(
$cTag
->
	`G‘A‰
('key')!='')

956 
$kk
 = '$key'.
$cTag
->
	`G‘A‰
('key');

958 if(
$cTag
->
	`G‘A‰
('value')!='')

960 
$vv
 = '$v®ue'.
$cTag
->
	`G‘A‰
('value');

962 
$addv¬
 = '';

963 if(!
	`´eg_m©ch
("/\(/",
$v¬Çme
))

965 
$v¬Çme
 = '$GLOBALS[\''.$varname.'\']';

969 
$addv¬
 = "\r\n".'$my¬r ğ$·geCÏss->'.
$v¬Çme
.";\r\n";

970 
$v¬Çme
 = ' $myarrs ';

972 
$rsv®ue
 = '<'.'?ph°'.
$addv¬
.' fÜ—ch('.
$v¬Çme
.'‡ '.
$kk
.'=>'.
$vv
.'){ ?'.">";

973 
$rsv®ue
 .ğ
$cTag
->
	`G‘IÂ”Text
();

974 
$rsv®ue
 .= '<'.'?php } ?'.">\r\n";

975 
$cTag
->
gV®ue
 = 
$rsv®ue
;

979 if(
$gÇme
 == 'include')

981 
$f’ame
 = 
$cTag
->
	`G‘A‰
('file');

982 if(
$f’ame
=='')

984 
$f’ame
 = 
$cTag
->
	`G‘A‰
('filename');

986 
$cTag
->
gV®ue
 = 
$this
->
	`Comp”Inşude
(
$f’ame
, 
FALSE
);

987 if(
$cTag
->
gV®ue
==0) $cTag->tagValue = '';

988 
$cTag
->
gV®ue
 = '<'.'?ph°šşud$this->Comp”Inşude("'.
$f’ame
.'");'."\r\n".' ?'.'>';

990 ifĞ
$gÇme
=='label' )

992 
$bšdFunc
 = 
$cTag
->
	`G‘A‰
('bind');

993 
$rsv®ue
 = 'echØ'.
$bšdFunc
.";\r\n";

994 
$rsv®ue
 = '<'.'?php '.$rsvalue.' ?'.">\r\n";

995 
$cTag
->
gV®ue
 = 
$rsv®ue
;

997 ifĞ
$gÇme
=='datalist' )

1000 
	`fÜ—ch
(
$cTag
->
cA‰
->
™ems
 
as
 
$k
=>
$v
)

1002 
$v
 = 
$this
->
	`TrimA‰s
($v);

1003 
$rsv®ue
 .ğ'$©ts[\''.
$k
.'\'] = \''.
	`¡r_»¶aû
("'","\\'",
$v
)."';\r\n";

1005 
$rsv®ue
 = '<'.'?php'."\r\n".'$atts =‡rray();'."\r\n".$rsvalue;

1006 
$rsv®ue
 .= '$blockValue = $this->refObj->GetArcList($atts,$this->refObj,$fields); '."\r\n";

1007 
$rsv®ue
 .= 'if(is_array($blockValue)){'."\r\n";

1008 
$rsv®ue
 .= 'foreach( $blockValue‡s $key=>$fields )'."\r\n{\r\n".'?'.">";

1009 
$rsv®ue
 .ğ
$cTag
->
	`G‘IÂ”Text
();

1010 
$rsv®ue
 .= '<'.'?php'."\r\n}\r\n}".'?'.'>';

1011 
$cTag
->
gV®ue
 = 
$rsv®ue
;

1013 ifĞ
$gÇme
=='pagelist' )

1016 
	`fÜ—ch
(
$cTag
->
cA‰
->
™ems
 
as
 
$k
=>
$v
)

1018 
$v
 = 
$this
->
	`TrimA‰s
($v);

1019 
$rsv®ue
 .ğ'$©ts[\''.
$k
.'\'] = \''.
	`¡r_»¶aû
("'","\\'",
$v
)."';\r\n";

1021 
$rsv®ue
 = '<'.'?php'."\r\n".'$atts =‡rray();'."\r\n".$rsvalue;

1022 
$rsv®ue
 .= 'ƒcho $this->refObj->GetPageList($atts,$this->refObj,$fields); '."\r\n".'?'.">\r\n";

1023 
$cTag
->
gV®ue
 = 
$rsv®ue
;

1027 
$bšdFunc
 = 
$cTag
->
	`G‘A‰
('bind');

1028 
$bšdTy³
 = 
$cTag
->
	`G‘A‰
('bindtype');

1029 
$r¡y³
 = (
$cTag
->
	`G‘A‰
('resulttype')=='' ? $cTag->GetAtt('rstype') : $cTag->GetAtt('resulttype') );

1030 
$r¡y³
 = 
	`¡¹Şow”
($rstype);

1033 
	`fÜ—ch
(
$cTag
->
cA‰
->
™ems
 
as
 
$k
=>
$v
)

1035 if(
	`´eg_m©ch
("/(bšd|bšdty³)/i",
$k
))

1039 
$v
 = 
$this
->
	`TrimA‰s
($v);

1040 
$rsv®ue
 .ğ'$©ts[\''.
$k
.'\'] = \''.
	`¡r_»¶aû
("'","\\'",
$v
)."';\r\n";

1042 
$rsv®ue
 = '<'.'?php'."\r\n".'$atts =‡rray();'."\r\n".$rsvalue;

1045 if(
$bšdFunc
=='')

1047 
$rsv®ue
 .= '$blockValue = MakePublicTag($atts,$this->refObj,$fields); '."\r\n";

1052 if(
$bšdTy³
==''è
$rsv®ue
 .ğ'$blockV®uğ$this->»fObj->'.
$bšdFunc
.'($atts,$this->refObj,$fields); '."\r\n";

1053 
$rsv®ue
 .ğ'$blockV®uğ'.
$bšdFunc
.'($atts,$this->refObj,$fields); '."\r\n";

1057 if(
$r¡y³
=='string')

1059 
$rsv®ue
 .= 'echo $blockValue;'."\r\n".'?'.">";

1063 
$rsv®ue
 .= 'if(is_array($blockValue) && count($blockValue) > 0){'."\r\n";

1064 
$rsv®ue
 .= 'foreach( $blockValue‡s $key=>$fields )'."\r\n{\r\n".'?'.">";

1065 
$rsv®ue
 .ğ
$cTag
->
	`G‘IÂ”Text
();

1066 
$rsv®ue
 .= '<'.'?php'."\r\n}\r\n}\r\n".'?'.'>';

1068 
$cTag
->
gV®ue
 = 
$rsv®ue
;

1070  
$cTag
->
gV®ue
;

1071 
	}
}

1081 
funùiÚ
 
	$Comp”A¼ayV¬
(
$v¬ty³
, 
$v¬Çme
)

1083 
$okv®ue
 = '';

1085 if(!
	`´eg_m©ch
("/\[/", 
$v¬Çme
))

1087 if(
	`´eg_m©ch
("/^v®ue/",
$v¬ty³
))

1089 
$v¬Çme
 = 
$v¬ty³
.'.'.$varname;

1091 
$v¬Çmes
 = 
	`ex¶ode
('.',
$v¬Çme
);

1092 if(
	`is£t
(
$v¬Çmes
[1]))

1094 
$v¬Çme
 = 
$v¬Çmes
[0];

1095 
$i
=1; 
	`is£t
(
$v¬Çmes
[$i]); $i++)

1097 
$v¬Çme
 .ğ"['".
$v¬Çmes
[
$i
]."']";

1102 if(
	`´eg_m©ch
("/\[/", 
$v¬Çme
))

1104 
$v¬Çmes
 = 
	`ex¶ode
('[', 
$v¬Çme
);

1105 
$¬»nd
 = '';

1106 
$i
=1;
	`is£t
(
$v¬Çmes
[$i]);$i++)

1108 
$¬»nd
 .ğ'['.
$v¬Çmes
[
$i
];

1110 if(!
	`´eg_m©ch
("/[\"']/", 
$¬»nd
)) {

1111 
$¬»nd
 = 
	`¡r_»¶aû
('[', '', $arrend);

1112 
$¬»nd
 = 
	`¡r_»¶aû
(']', '', $arrend);

1113 
$¬»nd
 = "['{$arrend}']";

1115 if(
$v¬ty³
=='var')

1117 
$okv®ue
 = '$GLOBALS[\'_v¬s\'][\''.
$v¬Çmes
[0].'\']'.
$¬»nd
;

1119 ifĞ
	`´eg_m©ch
("/^v®ue/", 
$v¬ty³
) )

1121 
$okv®ue
 = '$'.
$v¬Çmes
[0].
$¬»nd
;

1123 if(
$v¬ty³
=='field')

1125 
$okv®ue
 = '$f›lds[\''.
$v¬Çmes
[0].'\']'.
$¬»nd
;

1129 
$okv®ue
 = '$GLOBALS[\''.
$v¬Çmes
[0].'\']'.
$¬»nd
;

1134 if(
$v¬ty³
=='var')

1136 
$okv®ue
 = '$GLOBALS[\'_v¬s\'][\''.
$v¬Çme
.'\']';

1138 ifĞ
	`´eg_m©ch
("/^v®ue/",
$v¬ty³
) )

1140 
$okv®ue
 = '$'.
$v¬ty³
;

1142 if(
$v¬ty³
=='field')

1144 
$okv®ue
 = '$'.
	`¡r_»¶aû
(
$v¬Çme
);

1148 
$okv®ue
 = '$GLOBALS[\''.
$v¬Çme
.'\']';

1151  
$okv®ue
;

1152 
	}
}

1161 
funùiÚ
 
	$Comp”If
(
$cTag
)

1163 
$cÚd™iÚ
 = 
	`Œim
(
$cTag
->
	`G‘A‰
('condition'));

1164 if(
$cÚd™iÚ
 =='')

1166 
$cTag
->
gV®ue
='';  '';

1168 
$cÚd™iÚ
 = 
	`´eg_»¶aû
("/((var\.|field\.|cfg\.|global\.|key[0-9]{0,}\.|value[0-9]{0,}\.)[\._a-z0-9]+)/ies", "private_rt('\\1')", $condition);

1169 
$rsv®ue
 = '<'.'?ph°if('.
$cÚd™iÚ
.'){ ?'.'>';

1170 
$rsv®ue
 .ğ
$cTag
->
	`G‘IÂ”Text
();

1171 
$rsv®ue
 .= '<'.'?php } ?'.'>';

1172  
$rsv®ue
;

1173 
	}
}

1182 
funùiÚ
 
	$TrimA‰s
(
$v
)

1184 
$v
 = 
	`¡r_»¶aû
('<'.'?','&lt;?',$v);

1185 
$v
 = 
	`¡r_»¶aû
('?'.'>','?&gt;',$v);

1186  
$v
;

1187 
	}
}

1197 
funùiÚ
 
	$Comp”FunùiÚ
(
$func¡r
, 
$nv®ue
)

1199 
$func¡r
 = 
	`¡r_»¶aû
('@quote', '"', $funcstr);

1200 
$func¡r
 = 
	`¡r_»¶aû
('@me', 
$nv®ue
, $funcstr);

1201  
$func¡r
;

1202 
	}
}

1212 
funùiÚ
 
	$Comp”Inşude
(
$f’ame
, 
$i¦ßd
=
TRUE
)

1214 
$okfe
 = '';

1215 ifĞ@
	`fe_exi¡s
(
$f’ame
) )

1217 
$okfe
 = 
$f’ame
;

1219 ifĞ@
	`fe_exi¡s
(
$this
->
»fDœ
.
$f’ame
) )

1221 
$okfe
 = 
$this
->
»fDœ
.
$f’ame
;

1223 ifĞ@
	`fe_exi¡s
(
$this
->
»fDœ
."../".
$f’ame
) )

1225 
$okfe
 = 
$this
->
»fDœ
."../".
$f’ame
;

1227 if(
$okfe
=='')  0;

1228 ifĞ!
$i¦ßd
 )  1;

1229 
$™¶
 = 
Ãw
 
	`XakTem¶©e
(
$this
->
‹m¶©eDœ
);

1230 
$™¶
->
isCache
 = 
$this
->isCache;

1231 
$™¶
->
	`S‘Objeù
(
$this
->
»fObj
);

1232 
$™¶
->
	`LßdTem¶©e
(
$okfe
);

1233  
$™¶
->
	`CacheFe
();

1234 
	}
}

1244 şas 
	cTagA‰ribu‹


1246 
v¬
 
	m$couÁ
 = -1;

1247 
v¬
 
	m$™ems
 = "";

1256 
funùiÚ
 
	$G‘A‰
(
$¡r
)

1258 if(
$¡r
=="")

1262 if(
	`is£t
(
$this
->
™ems
[
$¡r
]))

1264  
$this
->
™ems
[
$¡r
];

1279 
funùiÚ
 
	$G‘A‰ribu‹
(
$¡r
)

1281  
$this
->
	`G‘A‰
(
$¡r
);

1282 
	}
}

1291 
funùiÚ
 
	$IsA‰ribu‹
(
$¡r
)

1293 if(
	`is£t
(
$this
->
™ems
[
$¡r
])è 
TRUE
;

1294  
FALSE
;

1295 
	}
}

1303 
funùiÚ
 
	$G‘gName
()

1305  
$this
->
	`G‘A‰
("tagname");

1306 
	}
}

1314 
funùiÚ
 
	$G‘couÁ
()

1316  
$this
->
couÁ
+1;

1317 
	}
}

1326 şas 
	cTagA‰ribu‹P¬£


1328 
v¬
 
	m$sourûSŒšg
 = "";

1329 
v¬
 
	m$sourûMaxSize
 = 1024;

1330 
v¬
 
	m$cA‰ribu‹s
 = "";

1331 
v¬
 
	m$ch¬ToLow
 = 
TRUE
;

1332 
funùiÚ
 
S‘Sourû
(
$¡r
="")

1334 
$this
->
cA‰ribu‹s
 = 
Ãw
 
TagA‰ribu‹
();

1335 
	m$¡rL’
 = 0;

1336 
	m$this
->
	msourûSŒšg
 = 
Œim
(
´eg_»¶aû
("/[ \r\n\t\f]{1,}/"," ",
$¡r
));

1337 
	m$¡rL’
 = 
¡¾’
(
$this
->
sourûSŒšg
);

1338 if(
	m$¡rL’
>0 && $¡rL’ <ğ
$this
->
sourûMaxSize
)

1340 
$this
->
P¬£A‰ribu‹
();

1350 
funùiÚ
 
	$P¬£A‰ribu‹
()

1352 
$d
 = '';

1353 
$tm·‰
 = '';

1354 
$tmpv®ue
 = '';

1355 
$¡¬tdd
 = -1;

1356 
$ddg
 = '';

1357 
$hasA‰ribu‹
=
FALSE
;

1358 
$¡rL’
 = 
	`¡¾’
(
$this
->
sourûSŒšg
);

1361 
$i
=0; $i<
$¡rL’
; $i++)

1363 if(
$this
->
sourûSŒšg
[
$i
]==' ')

1365 
$this
->
cA‰ribu‹s
->
couÁ
++;

1366 
$tmpv®ues
 = 
	`ex¶ode
('.', 
$tmpv®ue
);

1367 
$this
->
cA‰ribu‹s
->
™ems
['gÇme'] = ($this->
ch¬ToLow
 ? 
	`¡¹Şow”
(
$tmpv®ues
[0]) : $tmpvalues[0]);

1368 ifĞ
	`is£t
(
$tmpv®ues
[2]) )

1370 
$okÇme
 = 
$tmpv®ues
[1];

1371 
$j
=2;
	`is£t
(
$tmpv®ues
[$j]);$j++)

1373 
$okÇme
 .ğ"['".
$tmpv®ues
[
$j
]."']";

1375 
$this
->
cA‰ribu‹s
->
™ems
['Çme'] = 
$okÇme
;

1377 if(
	`is£t
(
$tmpv®ues
[1]) && $tmpvalues[1]!='')

1379 
$this
->
cA‰ribu‹s
->
™ems
['Çme'] = 
$tmpv®ues
[1];

1381 
$tmpv®ue
 = '';

1382 
$hasA‰ribu‹
 = 
TRUE
;

1387 
$tmpv®ue
 .ğ
$this
->
sourûSŒšg
[
$i
];

1392 if(!
$hasA‰ribu‹
)

1394 
$this
->
cA‰ribu‹s
->
couÁ
++;

1395 
$tmpv®ues
 = 
	`ex¶ode
('.', 
$tmpv®ue
);

1396 
$this
->
cA‰ribu‹s
->
™ems
['gÇme'] = ($this->
ch¬ToLow
 ? 
	`¡¹Şow”
(
$tmpv®ues
[0]) : $tmpvalues[0]);

1397 ifĞ
	`is£t
(
$tmpv®ues
[2]) )

1399 
$okÇme
 = 
$tmpv®ues
[1];

1400 
$i
=2;
	`is£t
(
$tmpv®ues
[$i]);$i++)

1402 
$okÇme
 .ğ"['".
$tmpv®ues
[
$i
]."']";

1404 
$this
->
cA‰ribu‹s
->
™ems
['Çme'] = 
$okÇme
;

1406 if(
	`is£t
(
$tmpv®ues
[1]) && $tmpvalues[1]!='')

1408 
$this
->
cA‰ribu‹s
->
™ems
['Çme'] = 
$tmpv®ues
[1];

1412 
$tmpv®ue
 = '';

1415 
$i
; $i<
$¡rL’
; $i++)

1417 
$d
 = 
$this
->
sourûSŒšg
[
$i
];

1419 if(
$¡¬tdd
==-1)

1421 if(
$d
 != '=')

1423 
$tm·‰
 .ğ
$d
;

1427 if(
$this
->
ch¬ToLow
)

1429 
$tm·‰
 = 
	`¡¹Şow”
(
	`Œim
($tmpatt));

1433 
$tm·‰
 = 
	`Œim
($tmpatt);

1435 
$¡¬tdd
=0;

1440 if(
$¡¬tdd
==0)

1442 
$d
)

1447 
$ddg
 = '\'';

1448 
$¡¬tdd
 = 1;

1451 
$ddg
 = '"';

1452 
$¡¬tdd
 = 1;

1455 
$tmpv®ue
 .ğ
$d
;

1456 
$ddg
 = ' ';

1457 
$¡¬tdd
 = 1;

1461 if(
$¡¬tdd
==1)

1463 if(
$d
==
$ddg
 && ( 
	`is£t
(
$this
->
sourûSŒšg
[
$i
-1]) && $this->sourceString[$i-1]!="\\") )

1465 
$this
->
cA‰ribu‹s
->
couÁ
++;

1466 
$this
->
cA‰ribu‹s
->
™ems
[
$tm·‰
] = 
	`Œim
(
$tmpv®ue
);

1467 
$tm·‰
 = '';

1468 
$tmpv®ue
 = '';

1469 
$¡¬tdd
 = -1;

1473 
$tmpv®ue
 .ğ
$d
;

1479 if(
$tm·‰
 != '')

1481 
$this
->
cA‰ribu‹s
->
couÁ
++;

1482 
$this
->
cA‰ribu‹s
->
™ems
[
$tm·‰
] = 
	`Œim
(
$tmpv®ue
);

1485 
	}
}

1496 
funùiÚ
 
	$´iv©e_¹
(
$¡r
)

1498 
$¬r
 = 
	`ex¶ode
('.', 
$¡r
);

1500 
$rs
 = '$GLOBALS[\'';

1501 if(
$¬r
[0] == 'cfg')

1503  
$rs
.'cfg_'.
$¬r
[1]."']";

1505 
	`–£if
(
$¬r
[0] == 'var')

1507 
$¬r
[0] = '_vars';

1508 
$rs
 .ğ
	`im¶ode
('\'][\'', 
$¬r
);

1509 
$rs
 .= "']";

1510  
$rs
;

1512 
	`–£if
(
$¬r
[0] == 'global')

1514 
	`un£t
(
$¬r
[0]);

1515 
$rs
 .ğ
	`im¶ode
('\'][\'', 
$¬r
);

1516 
$rs
 .= "']";

1517  
$rs
;

1521 if(
$¬r
[0] == 'field') $arr[0] = 'fields';

1522 
$rs
 = '$'.
$¬r
[0]."['";

1523 
	`un£t
(
$¬r
[0]);

1524 
$rs
 .ğ
	`im¶ode
('\'][\'', 
$¬r
);

1525 
$rs
 .= "']";

1526  
$rs
;

1528 
	}
}

	@E:\web\weixun\functions\xakvote.class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
("Warning...");

7 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

14 şas 
	cXakVÙe


16 
v¬
 
	m$VÙeInfos
;

17 
v¬
 
	m$VÙeNÙes
;

18 
v¬
 
	m$VÙeCouÁ
;

19 
v¬
 
	m$VÙeID
;

20 
v¬
 
	m$dsql
;

23 
funùiÚ
 
	$__cÚ¡ruù
(
$aid
)

25 
$this
->
dsql
 = 
$GLOBALS
['dsql'];

26 
$this
->
VÙeInfos
 = $this->
dsql
->
	`G‘OÃ
("SELECT * FROM `#@__vote` WHERE‡id='$aid'");

27 
$this
->
VÙeNÙes
 = 
	`A¼ay
();

28 
$this
->
VÙeCouÁ
 = 0;

29 
$this
->
VÙeID
 = 
$aid
;

30 if(!
	`is_¬¿y
(
$this
->
VÙeInfos
))

34 
$d
 = 
Ãw
 
	`XakTagP¬£
();

35 
$d
->
	`S‘NameS·û
("v", "<", ">");

36 
$d
->
	`LßdSourû
(
$this
->
VÙeInfos
['votenote']);

37 if(
	`is_¬¿y
(
$d
->
CTags
))

39 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

41 
$this
->
VÙeNÙes
[
$ùag
->
	`G‘A‰
('id')]['count'] = $ctag->GetAtt('count');

42 
$this
->
VÙeNÙes
[
$ùag
->
	`G‘A‰
('id')]['Çme'] = 
	`Œim
($ùag->
	`G‘IÂ”Text
());

43 
$this
->
VÙeCouÁ
++;

46 
$d
->
	`CË¬
();

49 
funùiÚ
 
	$XakVÙe
(
$aid
)

51 
$this
->
	`__cÚ¡ruù
(
$aid
);

52 
	}
}

54 
funùiÚ
 
	$Clo£
()

56 
	}
}

64 
funùiÚ
 
	$G‘TÙ®CouÁ
()

66 if(!
	`em±y
(
$this
->
VÙeInfos
["totalcount"]))

68  
$this
->
VÙeInfos
["totalcount"];

74 
	}
}

83 
funùiÚ
 
	$AddVÙeCouÁ
(
$aid
)

85 if(
	`is£t
(
$this
->
VÙeNÙes
[
$aid
]))

87 
$this
->
VÙeNÙes
[
$aid
]['count']++;

89 
	}
}

103 
funùiÚ
 
G‘VÙeFÜm
(
$lšeheight
=30,
$bËwidth
="100%",
$t™ËbgcŞÜ
="#333",
$t™Ëbackgroup
="",
$bËbg
="#FFFFFF",
$™embgcŞÜ
="#FFFFFF")

106 if(
$lšeheight
=="")

108 
$lšeheight
=24;

110 if(
	g$bËwidth
=="")

112 
$bËwidth
="100%";

114 if(
	g$t™ËbgcŞÜ
=="")

116 
$t™ËbgcŞÜ
="#98C6EF";

118 if(
	g$t™Ëbackgroup
!="")

120 
$t™Ëbackgroup
="background='$titlebackgroup'";

122 if(
	g$bËbg
=="")

124 
$bËbg
="#FFFFFF";

126 if(
	g$™embgcŞÜ
=="")

128 
$™embgcŞÜ
="#FFFFFF";

130 
	g$™ems
 = "<table width='$tablewidth' border='0' cellspacing='1' cellpadding='1' id='voteitem'>\r\n";

131 
	g$™ems
 .ğ"<fÜm‚ame='vÙefÜm' m‘hod='po¡'‡ùiÚ='".
$GLOBALS
['cfg_phpurl']."/vote.php'arget='_blank'>\r\n";

132 
	g$™ems
 .= "<inputype='hidden'‚ame='dopost' value='send' />\r\n";

133 
	g$™ems
 .ğ"<špuˆty³='hidd’'‚ame='aid' v®ue='".
$this
->
VÙeID
."' />\r\n";

134 
	g$™ems
 .ğ"<špuˆty³='hidd’'‚ame='ismÜe' v®ue='".
$this
->
VÙeInfos
['ismore']."' />\r\n";

135 
	g$™ems
.="<Œ‡lign='ûÁ”'><td height='$lšeheight' id='vÙ‘™Ë' styË='bÜd”-bÙtom:1px dashed #999999;cŞÜ:#3F7652' $t™Ëbackgroup><¡rÚg>".
$this
->
VÙeInfos
['votename']."</strong></td></tr>\r\n";

136 if(
	g$this
->
	gVÙeCouÁ
 > 0)

139 
fÜ—ch
(
$this
->
VÙeNÙes
 
as
 
$k
=>
$¬r
)

141 if(
$this
->
VÙeInfos
['ismore']==0)

143 
$™ems
.="<Œ><td height=$lšeheighˆbgcŞÜ=$™embgcŞÜ styË='cŞÜ:#666666'><špuˆty³='¿dio'‚ame='vÙe™em' v®ue='$k' />".
$¬r
['name']."</td></tr>\r\n";

147 
	g$™ems
.="<Œ><td height=$lšeheighˆbgcŞÜ=$™embgcŞÜ styË='cŞÜ:#666666'><špuˆty³=checkbox‚ame='vÙe™em[]' v®ue='$k' />".
$¬r
['name']."</td></tr>\r\n";

150 
	g$™ems
 .= "<tr><td height='$lineheight'>\r\n";

151 
	g$™ems
 .= "<inputype='submit' class='btn-1'‚ame='vbt1' value='æŠ•ç¥¨' />\r\n";

152 
	g$™ems
 .= "<inputype='button' class='btn-1'‚ame='vbt2' ";

153 
	g$™ems
 .ğ"v®ue='æŸ¥çœ‹ç»“æœ' onClick=wšdow.İ’('".
$GLOBALS
['cfg_phpu¾']."/vÙe.php?dİo¡=v›w&aid=".
$this
->
VÙeID
."'); /></td></tr>\r\n";

155 
	g$™ems
.="</form>\r\n</table>\r\n";

156  
	g$™ems
;

167 
funùiÚ
 
	$SaveVÙe
(
$vÙe™em
)

169 
glob®
 
$ENV_GOBACK_URL
,
$fe
,
$memb”ID
,
$row
,
$cÚ‹Á
;

170 if(
	`em±y
(
$vÙe™em
))

174 
$™ems
 = '';

177 
$nowtime
 = 
	`time
();

178 if(
$nowtime
 > 
$this
->
VÙeInfos
['endtime'])

181 
	`ShowMsg
('æŠ•ç¥¨å·²ç»è¿‡æœŸï¼',
$ENV_GOBACK_URL
);

182 
	`ex™
();

184 if(
$nowtime
 < 
$this
->
VÙeInfos
['starttime'])

186 
	`ShowMsg
('æŠ•ç¥¨è¿˜æ²¡æœ‰å¼€å§‹ï¼',
$ENV_GOBACK_URL
);

187 
	`ex™
();

191 if(
	`is£t
(
$_COOKIE
['VOTE_MEMBER_IP']))

193 if(
$_COOKIE
['VOTE_MEMBER_IP'] =ğ
$_SERVER
['REMOTE_ADDR'])

195 
	`ShowMsg
('æ‚¨å·²æŠ•è¿‡ç¥¨',
$ENV_GOBACK_URL
);

196 
	`ex™
();

198 
	`£tcook›
('VOTE_MEMBER_IP',
$_SERVER
['REMOTE_ADDR'],
	`time
()*
$row
['spec']*3600,'/');

201 
	`£tcook›
('VOTE_MEMBER_IP',
$_SERVER
['REMOTE_ADDR'],
	`time
()*
$row
['spec']*3600,'/');

205 
$nowtime
 = 
	`time
();

206 
$VÙeMem
 = 
$this
->
dsql
->
	`G‘OÃ
("SELECT * FROM #@__vote_member WHERE voteid = '$this->VoteID'‡nd userid='$memberID'");

207 if(!
	`em±y
(
$memb”ID
))

209 if(
	`is£t
(
$VÙeMem
['id']))

211 
$vÙeday
 = 
	`d©e
("Y-m-d",
$VÙeMem
['uptime']);

212 
$day
 = 
	`¡¹Ùime
("-".
$row
['spec']." day");

213 
$day
 = 
	`d©e
("Y-m-d",$day);

214 if(
$day
 < 
$vÙeday
)

216 
	`ShowMsg
('åœ¨'.
$row
['¥ec'].'å¤©å†…ä¸èƒ½é‡å¤æŠ•ç¥¨',
$ENV_GOBACK_URL
);

217 
	`ex™
();

219 
$qu”y
 = "UPDATE #@__vote_member SET uptime='$nowtime' WHERE voteid='$this->VoteID' AND userid='$memberID'";

220 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
è=ğ
çl£
)

222 
	`ShowMsg
('æ’å…¥æ•°æ®è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯',
$ENV_GOBACK_URL
);

223 
	`ex™
();

227 
$qu”y
 = "INSERT INTO #@__vote_member(id,voteid,userid,uptime) VALUES('','$this->VoteID','$memberID','$nowtime')";

228 if(
$this
->
dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
è=ğ
çl£
)

230 
	`ShowMsg
('æ’å…¥æ•°æ®è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯',
$ENV_GOBACK_URL
);

231 
	`ex™
();

236 if(
$this
->
VÙeCouÁ
 > 0)

238 
	`fÜ—ch
(
$this
->
VÙeNÙes
 
as
 
$k
=>
$v
)

240 if(
$this
->
VÙeInfos
['ismore']==0)

243 if(
$vÙe™em
 =ğ
$k
)

245 
$this
->
VÙeNÙes
[
$k
]['count']++; ;

251 if(
	`is_¬¿y
(
$vÙe™em
è&& 
	`š_¬¿y
(
$k
,$voteitem))

253 
$this
->
VÙeNÙes
[
$k
]['count']++;

257 
	`fÜ—ch
(
$this
->
VÙeNÙes
 
as
 
$k
=>
$¬r
)

259 
$™ems
 .ğ"<v:nÙid='$k' couÁ='".
$¬r
['count']."'>".$arr['name']."</v:note>\r\n";

262 
$this
->
dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__vÙe` SETÙ®couÁ='".($this->
VÙeInfos
['tÙ®couÁ']+1)."',vÙ’Ùe='".
	`add¦ashes
(
$™ems
)."' WHERE‡id='".$this->
VÙeID
."'");

264 
	}
}

275 
funùiÚ
 
G‘VÙeResuÉ
(
$bËwidth
="600", 
$lšeheight
="24", 
$bË¥l™
="40%")

277 
$tÙ®couÁ
 = 
$this
->
VÙeInfos
['totalcount'];

278 if(
	g$tÙ®couÁ
==0)

280 
$tÙ®couÁ
=1;

282 
	g$»s
 = "<table width='$tablewidth' border='0' cellspacing='1' cellpadding='1'>\r\n";

283 
	g$»s
 .= "<tr height='8'><td width='$tablesplit'></td><td></td></tr>\r\n";

284 
	g$i
=1;

285 
fÜ—ch
(
$this
->
VÙeNÙes
 
as
 
$k
=>
$¬r
)

287 
$»s
 .ğ"<Œ height='$lšeheight'><td styË='bÜd”-bÙtom:1px sŞid'>".
$i
."ã€".
$¬r
['name']."</td>";

288 
	g$c
 = 
$¬r
['count'];

289 
	g$»s
 .= "<td style='border-bottom:1px solid'>

290 <
bË
 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='2' 
width
='".(($c/$tÙ®couÁ)*100)."%'><
Œ
><
td
 
height
='16' 
background
='img/vÙebg.gif' 
¡yË
='border:1px solid #666666;font-size:9pt;line-height:110%'>".$arr['count']."</td></tr></table>

291 </
td
></
Œ
>\
r
\
n
";

292 
$i
++;

294 
	g$»s
 .= "<tr><td></td><td></td></tr>\r\n";

295 
	g$»s
 .= "</table>\r\n";

296  
	g$»s
;

	@E:\web\weixun\functions\zip.class.php

1 <?
php


7 şas 
	cz


9 
v¬
 
	m$d©a£c
, 
	m$ù¾_dœ
 = 
¬¿y
();

10 
v¬
 
	m$eof_ù¾_dœ
 = "\x50\x4b\x05\x06\x00\x00\x00\x00";

11 
v¬
 
	m$Şd_off£t
 = 0; v¬ 
	m$dœs
 = 
A¼ay
(".");

20 
funùiÚ
 
	$g‘_Li¡
(
$z_Çme
)

22 
$»t
 = '';

23 
$z
 = @
	`fİ’
(
$z_Çme
, 'rb');

24 if(!
$z
)

28 
$ûÁd
 = 
$this
->
	`R—dC’Œ®Dœ
(
$z
,
$z_Çme
);

29 @
	`»wšd
(
$z
);

30 @
	`f£ek
(
$z
, 
$ûÁd
['offset']);

31 
$i
=0; $i<
$ûÁd
['entries']; $i++)

33 
$h—d”
 = 
$this
->
	`R—dC’Œ®FeH—d”s
(
$z
);

34 
$h—d”
['šdex'] = 
$i
;
$šfo
['filename'] = $header['filename'];

35 
$šfo
['¡Üed_f’ame'] = 
$h—d”
['stored_filename'];

36 
$šfo
['size'] = 
$h—d”
['size'];$info['compressed_size']=$header['compressed_size'];

37 
$šfo
['üc'] = 
	`¡¹ouµ”
(
	`dechex
Ğ
$h—d”
['crc'] ));

38 
$šfo
['mtime'] = 
$h—d”
['mtime']; $info['comment'] = $header['comment'];

39 
$šfo
['fŞd”'] = (
$h—d”
['external']==0x41FF0010||$header['external']==16)?1:0;

40 
$šfo
['šdex'] = 
$h—d”
['index'];$info['status'] = $header['status'];

41 
$»t
[]=
$šfo
; 
	`un£t
(
$h—d”
);

43  
$»t
;

54 
funùiÚ
 
	$Add
(
$fes
,
$com·ù
)

56 if(!
	`is_¬¿y
(
$fes
[0]))

58 
$fes
=
	`A¼ay
($files);

60 
$i
=0;
$fes
[$i];$i++)

62 
$â
 = 
$fes
[
$i
];

63 if(!
	`š_A¼ay
(
	`dœÇme
(
$â
[0]),
$this
->
dœs
))

65 
$this
->
	`add_Dœ
(
	`dœÇme
(
$â
[0]));

67 if(
	`ba£Çme
(
$â
[0]))

69 
$»t
[
	`ba£Çme
(
$â
[0])]=
$this
->
	`add_Fe
($â[1],$â[0],
$com·ù
);

72  
$»t
;

73 
	}
}

81 
funùiÚ
 
	$g‘_fe
()

83 
$d©a
 = 
	`im¶ode
('', 
$this
 -> 
d©a£c
);

84 
$ù¾dœ
 = 
	`im¶ode
('', 
$this
 -> 
ù¾_dœ
);

85  
$d©a
 . 
$ù¾dœ
 . 
$this
 -> 
eof_ù¾_dœ
 .

86 
	`·ck
('v', (
$this
 -> 
ù¾_dœ
)).pack('v', ($this -> ctrl_dir)).

87 
	`·ck
('V', 
	`¡¾’
(
$ù¾dœ
)è.…ack('V', sŒËn(
$d©a
)) . "\x00\x00";

88 
	}
}

97 
funùiÚ
 
	$add_dœ
(
$Çme
)

99 
$Çme
 = 
	`¡r_»¶aû
("\\", "/", $name);

100 
$ä
 = "\x50\x4b\x03\x04\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00";

101 
$ä
 .ğ
	`·ck
("V",0).·ck("V",0).·ck("V",0).·ck("v", 
	`¡¾’
(
$Çme
) );

102 
$ä
 .ğ
	`·ck
("v", 0 ).
$Çme
.pack("V", 0).pack("V", 0).pack("V", 0);

103 
$this
 -> 
d©a£c
[] = 
$ä
;

104 
$Ãw_off£t
 = 
	`¡¾’
(
	`im¶ode
("", 
$this
->
d©a£c
));

105 
$cd»c
 = "\x50\x4b\x01\x02\x00\x00\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00";

106 
$cd»c
 .ğ
	`·ck
("V",0).·ck("V",0).·ck("V",0).·ck("v", 
	`¡¾’
(
$Çme
) );

107 
$cd»c
 .ğ
	`·ck
("v", 0 ).pack("v", 0 ).pack("v", 0 ).pack("v", 0 );

108 
$ext
 = "\xff\xff\xff\xff";

109 
$cd»c
 .ğ
	`·ck
("V", 16 ).·ck("V", 
$this
 -> 
Şd_off£t
 ).
$Çme
;

110 
$this
 -> 
ù¾_dœ
[] = 
$cd»c
;

111 
$this
 -> 
Şd_off£t
 = 
$Ãw_off£t
;

112 
$this
 -> 
dœs
[] = 
$Çme
;

113 
	}
}

124 
funùiÚ
 
CompeZFe
(
$f’ame
, 
$tozf’ame
,
$áy³
='dir')

126 ià(@
funùiÚ_exi¡s
('gzcompress'))

128 if(
$áy³
=='dir')

130 
$f–i¡
 = 
$this
->
Li¡DœFes
(
$f’ame
);

132 if(
	g$áy³
=='file')

134 
$f–i¡
[] = 
$f’ame
;

138 
	g$f–i¡
 = 
$f’ame
;

140 
	g$i
 = 0;

141 if(
couÁ
(
$f–i¡
)>0)

143 
fÜ—ch
(
$f–i¡
 
as
 
$f’ame
)

145 ià(
is_fe
(
$f’ame
))

147 
	g$i
++;

148 
	g$fd
 = 
fİ’
 (
$f’ame
, "r");

149 if(
fesize
(
$f’ame
)>0)

151 
	g$cÚ‹Á
 = 
ä—d
(
$fd
, 
fesize
(
$f’ame
));

155 
	g$cÚ‹Á
 = ' ';

157 
fşo£
 (
$fd
);

160 
	g$this
->
add_Fe
(
$cÚ‹Á
, 
$f’ame
);

163 
	g$out
 = 
$this
->
g‘_fe
();

164 
	g$å
 = 
fİ’
(
$tozf’ame
, "w");

165 
fwr™e
(
$å
, 
$out
, 
¡¾’
($out));

166 
fşo£
(
$å
);

168  
	g$i
;

183 
funùiÚ
 
	$Li¡DœFes
(
$dœÇme
)

185 
$fes
 = 
	`¬¿y
();

186 if(
	`is_dœ
(
$dœÇme
))

188 
$fh
 = 
	`İ’dœ
(
$dœÇme
);

189 (
$fe
 = 
	`»addœ
(
$fh
)è!=ğ
çl£
)

191 ià(
	`¡rcmp
(
$fe
, '.')==0 || strcmp($file, '..')==0)

195 
$f•©h
 = 
$dœÇme
 . '/' . 
$fe
;

196 iàĞ
	`is_dœ
(
$f•©h
) )

198 
$fes
 = 
	`¬¿y_m”ge
($fes, 
$this
->
	`Li¡DœFes
(
$f•©h
));

202 
	`¬¿y_push
(
$fes
, 
$f•©h
);

205 
	`şo£dœ
(
$fh
);

209 
$fes
 = 
çl£
;

211  
$fes
;

212 
	}
}

223 
funùiÚ
 
	$add_Fe
(
$d©a
, 
$Çme
, 
$com·ù
 = 1)

225 
$Çme
 = 
	`¡r_»¶aû
('\\', '/', $name);

226 
$dtime
 = 
	`dechex
(
$this
->
	`DosTime
());

228 
$hexdtime
 = '\x' . 
$dtime
[6] . $dtime[7].'\x'.$dtime[4] . $dtime[5]

229 . '\x' . 
$dtime
[2] . $dtime[3].'\x'.$dtime[0].$dtime[1];

230 
	`ev®
('$hexdtimğ"' . 
$hexdtime
 . '";');

231 if(
$com·ù
)

232 
$ä
 = "\x50\x4b\x03\x04\x14\x00\x00\x00\x08\x00".
$hexdtime
;

235 
$ä
 = "\x50\x4b\x03\x04\x0a\x00\x00\x00\x00\x00".
$hexdtime
;

237 
$unc_Ën
 = 
	`¡¾’
(
$d©a
); 
$üc
 = 
	`üc32
($data);

238 if(
$com·ù
)

240 
$zd©a
 = 
	`gzcom´ess
(
$d©a
); 
$c_Ën
 = 
	`¡¾’
($zdata);

241 
$zd©a
 = 
	`sub¡r
(sub¡r($zd©a, 0, 
	`¡¾’
($zdata) - 4), 2);

245 
$zd©a
 = 
$d©a
;

247 
$c_Ën
=
	`¡¾’
(
$zd©a
);

248 
$ä
 .ğ
	`·ck
('V', 
$üc
).·ck('V', 
$c_Ën
).·ck('V', 
$unc_Ën
);

249 
$ä
 .ğ
	`·ck
('v', 
	`¡¾’
(
$Çme
)).·ck('v', 0).$Çme.
$zd©a
;

250 
$ä
 .ğ
	`·ck
('V', 
$üc
).·ck('V', 
$c_Ën
).·ck('V', 
$unc_Ën
);

251 
$this
 -> 
d©a£c
[] = 
$ä
;

252 
$Ãw_off£t
 = 
	`¡¾’
(
	`im¶ode
('', 
$this
->
d©a£c
));

253 if(
$com·ù
)

255 
$cd»c
 = "\x50\x4b\x01\x02\x00\x00\x14\x00\x00\x00\x08\x00";

259 
$cd»c
 = "\x50\x4b\x01\x02\x14\x00\x0a\x00\x00\x00\x00\x00";

261 
$cd»c
 .ğ
$hexdtime
.
	`·ck
('V', 
$üc
).·ck('V', 
$c_Ën
).·ck('V', 
$unc_Ën
);

262 
$cd»c
 .ğ
	`·ck
('v', 
	`¡¾’
(
$Çme
) ).pack('v', 0 ).pack('v', 0 );

263 
$cd»c
 .ğ
	`·ck
('v', 0 ).pack('v', 0 ).pack('V', 32 );

264 
$cd»c
 .ğ
	`·ck
('V', 
$this
 -> 
Şd_off£t
 );

265 
$this
 -> 
Şd_off£t
 = 
$Ãw_off£t
;

266 
$cd»c
 .ğ
$Çme
;

267 
$this
 -> 
ù¾_dœ
[] = 
$cd»c
;

268  
Œue
;

269 
	}
}

277 
funùiÚ
 
	$DosTime
()

279 
$tim—¼ay
 = 
	`g‘d©e
();

280 ià(
$tim—¼ay
['year'] < 1980)

282 
$tim—¼ay
['year'] = 1980; $timearray['mon'] = 1;

283 
$tim—¼ay
['mday'] = 1; $timearray['hours'] = 0;

284 
$tim—¼ay
['minutes'] = 0; $timearray['seconds'] = 0;

286  ((
$tim—¼ay
['year'] - 1980) << 25) | ($timearray['mon'] << 21) | ($timearray['mday'] << 16) | ($timearray['hours'] << 11) |

287 (
$tim—¼ay
['minutes'] << 5) | ($timearray['seconds'] >> 1);

288 
	}
}

299 
funùiÚ
 
	$ExŒaùAÎ
 ( 
$zn
, 
$to
)

301 if(
	`sub¡r
(
$to
,-1)!="/")

303 
$to
 .= "/";

305 
$fes
 = 
$this
->
	`g‘_Li¡
(
$zn
);

306 
$ú
 = 
	`couÁ
(
$fes
);

307 if(
	`is_¬¿y
(
$fes
))

309 
$i
=0;$i<
$ú
;$i++)

311 if(
$fes
[
$i
]['folder']==1)

313 @
	`mkdœ
(
$to
.
$fes
[
$i
]['f’ame'],
$GLOBALS
['cfg_dir_purview']);

314 @
	`chmod
(
$to
.
$fes
[
$i
]['f’ame'],
$GLOBALS
['cfg_dir_purview']);

318 
$this
->
	`ExŒaù
 (
$zn
,
$to
);

319 
	}
}

329 
funùiÚ
 
ExŒaù
 ( 
$zn
, 
$to
, 
$šdex
 = 
A¼ay
(-1) )

331 
$ok
 = 0; 
	g$z
 = @
fİ’
(
$zn
,'rb');

332 if(!
	g$z
)

336 
	g$cdœ
 = 
$this
->
R—dC’Œ®Dœ
(
$z
,
$zn
);

337 
	g$pos_’Œy
 = 
$cdœ
['offset'];

338 if(!
is_¬¿y
(
$šdex
))

340 
	g$šdex
 = 
¬¿y
(
$šdex
);

342 
	g$i
=0; 
is£t
(
$šdex
[
$i
]);$i++)

344 if(
štv®
(
$šdex
[
$i
])!=$šdex[$i]||$šdex[$i]>
$cdœ
['entries'])

349 
	g$i
=0; $i<
	g$cdœ
['entries']; $i++)

351 @
f£ek
(
$z
, 
$pos_’Œy
);

352 
	g$h—d”
 = 
$this
->
R—dC’Œ®FeH—d”s
(
$z
);

353 
	g$h—d”
['šdex'] = 
$i
; 
	g$pos_’Œy
 = 
á–l
(
$z
);

354 @
»wšd
(
$z
); 
f£ek
($z, 
$h—d”
['offset']);

355 if(
š_¬¿y
("-1",
$šdex
)||š_¬¿y(
$i
,$index))

357 
	g$¡©
[
$h—d”
['f’ame']]=
$this
->
ExŒaùFe
($h—d”, 
$to
, 
$z
);

361 
fşo£
(
$z
);

362  
	g$¡©
;

365 
funùiÚ
 
	$R—dFeH—d”
(
$z
)

367 
$bš¬y_d©a
 = 
	`ä—d
(
$z
, 30);

368 
$d©a
 = 
	`uÅack
('vchk/vid/vv”siÚ/væag/vcom´essiÚ/vmtime/vmd©e/Vüc/Vcom´es£d_size/Vsize/vf’ame_Ën/vexŒa_Ën', 
$bš¬y_d©a
);

369 
$h—d”
['f’ame'] = 
	`ä—d
(
$z
, 
$d©a
['filename_len']);

370 ià(
$d©a
['extra_len'] != 0)

372 
$h—d”
['exŒa'] = 
	`ä—d
(
$z
, 
$d©a
['extra_len']);

376 
$h—d”
['extra'] = '';

378 
$h—d”
['com´essiÚ'] = 
$d©a
['compression'];$header['size'] = $data['size'];

379 
$h—d”
['com´es£d_size'] = 
$d©a
['compressed_size'];

380 
$h—d”
['üc'] = 
$d©a
['crc']; $header['flag'] = $data['flag'];

381 
$h—d”
['md©e'] = 
$d©a
['mdate'];$header['mtime'] = $data['mtime'];

382 ià(
$h—d”
['mdate'] && $header['mtime'])

384 
$hour
=(
$h—d”
['mtime']&0xF800)>>11;
$mšu‹
=($header['mtime']&0x07E0)>>5;

385 
$£cÚde
=(
$h—d”
['mtime']&0x001F)*2;
$y—r
=(($header['mdate']&0xFE00)>>9)+1980;

386 
$mÚth
=(
$h—d”
['md©e']&0x01E0)>>5;
$day
=$header['mdate']&0x001F;

387 
$h—d”
['mtime'] = 
	`mktime
(
$hour
, 
$mšu‹
, 
$£cÚde
, 
$mÚth
, 
$day
, 
$y—r
);

391 
$h—d”
['mtime'] = 
	`time
();

393 
$h—d”
['stored_filename'] = $header['filename'];

394 
$h—d”
['status'] = "ok";

395  
$h—d”
;

396 
	}
}

398 
funùiÚ
 
	$R—dC’Œ®FeH—d”s
(
$z
)

400 
$bš¬y_d©a
 = 
	`ä—d
(
$z
, 46);

401 
$h—d”
 = 
	`uÅack
('vchkid/vid/vv”siÚ/vv”siÚ_exŒaùed/væag/vcom´essiÚ/vmtime/vmd©e/Vüc/Vcom´es£d_size/Vsize/vf’ame_Ën/vexŒa_Ën/vcomm’t_Ën/vdisk/vš‹º®/Vex‹º®/Voff£t', 
$bš¬y_d©a
);

402 ià(
$h—d”
['filename_len'] != 0)

404 
$h—d”
['f’ame'] = 
	`ä—d
(
$z
,$header['filename_len']);

408 
$h—d”
['filename'] = '';

410 ià(
$h—d”
['extra_len'] != 0)

412 
$h—d”
['exŒa'] = 
	`ä—d
(
$z
, $header['extra_len']);

416 
$h—d”
['extra'] = '';

418 ià(
$h—d”
['comment_len'] != 0)

420 
$h—d”
['comm’t'] = 
	`ä—d
(
$z
, $header['comment_len']);

424 
$h—d”
['comment'] = '';

426 ià(
$h—d”
['mdate'] && $header['mtime'])

428 
$hour
 = (
$h—d”
['mtime'] & 0xF800) >> 11;

429 
$mšu‹
 = (
$h—d”
['mtime'] & 0x07E0) >> 5;

430 
$£cÚde
 = (
$h—d”
['mtime'] & 0x001F)*2;

431 
$y—r
 = ((
$h—d”
['mdate'] & 0xFE00) >> 9) + 1980;

432 
$mÚth
 = (
$h—d”
['mdate'] & 0x01E0) >> 5;

433 
$day
 = 
$h—d”
['mdate'] & 0x001F;

434 
$h—d”
['mtime'] = 
	`mktime
(
$hour
, 
$mšu‹
, 
$£cÚde
, 
$mÚth
, 
$day
, 
$y—r
);

438 
$h—d”
['mtime'] = 
	`time
();

440 
$h—d”
['stored_filename'] = $header['filename'];

441 
$h—d”
['status'] = 'ok';

442 ià(
	`sub¡r
(
$h—d”
['filename'], -1) == '/')

444 
$h—d”
['external'] = 0x41FF0010;

446  
$h—d”
;

447 
	}
}

449 
funùiÚ
 
	$R—dC’Œ®Dœ
(
$z
,
$z_Çme
)

451 
$size
 = 
	`fesize
(
$z_Çme
);

452 ià(
$size
 < 277)

454 
$maximum_size
 = 
$size
;

458 
$maximum_size
=277;

460 @
	`f£ek
(
$z
, 
$size
-
$maximum_size
);

461 
$pos
 = 
	`á–l
(
$z
); 
$by‹s
 = 0x00000000;

463 
$pos
 < 
$size
)

465 
$by‹
 = @
	`ä—d
(
$z
, 1); 
$by‹s
=($by‹ << 8è| 
	`Ord
($byte);

466 ià(
$by‹s
 == 0x504b0506)

468 
$pos
++; ;

470 
$pos
++;

472 
$d©a
 = @
	`uÅack
('vdisk/vdisk_¡¬t/vdisk_’Œ›s/v’Œ›s/Vsize/Voff£t/vcomm’t_size',
	`ä—d
(
$z
, 18));

473 ià(
$d©a
['comment_size'] != 0)

475 
$ûÁd
['comm’t'] = 
	`ä—d
(
$z
, 
$d©a
['comment_size']);

479 
$ûÁd
['comm’t'] = ''; $ûÁd['’Œ›s'] = 
$d©a
['entries'];

481 
$ûÁd
['disk_’Œ›s'] = 
$d©a
['disk_entries'];

482 
$ûÁd
['off£t'] = 
$d©a
['offset'];$centd['disk_start'] = $data['disk_start'];

483 
$ûÁd
['size'] = 
$d©a
['size']; $centd['disk'] = $data['disk'];

484  
$ûÁd
;

485 
	}
}

487 
funùiÚ
 
	$ExŒaùFe
(
$h—d”
,
$to
,
$z
)

489 
$h—d”
 = 
$this
->
	`»adfeh—d”
(
$z
);

490 
$h—d”
['ex‹º®'] = (!
	`is£t
($header['external']) ? 0 : $header['external']);

491 if(
	`sub¡r
(
$to
,-1)!="/")

493 
$to
.="/";

495 if(!@
	`is_dœ
(
$to
))

497 @
	`mkdœ
(
$to
,
$GLOBALS
['cfg_dir_purview']);

499 ià(!(
$h—d”
['external']==0x41FF0010)&&!($header['external']==16))

501 ià(
$h—d”
['compression']==0)

503 
$å
 = @
	`fİ’
(
$to
.
$h—d”
['filename'], 'wb');

504 if(!
$å
)

508 
$size
 = 
$h—d”
['compressed_size'];

509 
$size
 != 0)

511 
$»ad_size
 = (
$size
 < 2048 ? $size : 2048);

512 
$bufãr
 = 
	`ä—d
(
$z
, 
$»ad_size
);

513 
$bš¬y_d©a
 = 
	`·ck
('a'.
$»ad_size
, 
$bufãr
);

514 @
	`fwr™e
(
$å
, 
$bš¬y_d©a
, 
$»ad_size
);

515 
$size
 -ğ
$»ad_size
;

517 
	`fşo£
(
$å
);

518 
	`touch
(
$to
.
$h—d”
['filename'], $header['mtime']);

522 
$å
 = @
	`fİ’
(
$to
.
$h—d”
['filename'].'.gz','wb');

523 if(!
$å
)

527 
$bš¬y_d©a
 = 
	`·ck
('va1a1Va1a1', 0x8b1f, 
	`Chr
(
$h—d”
['compression']),

528 
	`Chr
(0x00), 
	`time
(), Chr(0x00), Chr(3));

529 
	`fwr™e
(
$å
, 
$bš¬y_d©a
, 10);

530 
$size
 = 
$h—d”
['compressed_size'];

531 
$size
 != 0)

533 
$»ad_size
 = (
$size
 < 1024 ? $size : 1024);

534 
$bufãr
 = 
	`ä—d
(
$z
, 
$»ad_size
);

535 
$bš¬y_d©a
 = 
	`·ck
('a'.
$»ad_size
, 
$bufãr
);

536 @
	`fwr™e
(
$å
, 
$bš¬y_d©a
, 
$»ad_size
);

537 
$size
 -ğ
$»ad_size
;

540 
$bš¬y_d©a
 = 
	`·ck
('VV', 
$h—d”
['crc'], $header['size']);

541 
	`fwr™e
(
$å
, 
$bš¬y_d©a
,8); 
	`fşo£
($fp);

542 
$gzp
 = @
	`gzİ’
(
$to
.
$h—d”
['f’ame'].'.gz','rb'è
Ü
 
	`d›
("Cette‡rchiveƒst compress");

543 if(!
$gzp
)

547 
$å
 = @
	`fİ’
(
$to
.
$h—d”
['filename'],'wb');

548 if(!
$å
)

552 
$size
 = 
$h—d”
['size'];

553 
$size
 != 0)

555 
$»ad_size
 = (
$size
 < 2048 ? $size : 2048);

556 
$bufãr
 = 
	`gz»ad
(
$gzp
, 
$»ad_size
);

557 
$bš¬y_d©a
 = 
	`·ck
('a'.
$»ad_size
, 
$bufãr
);

558 @
	`fwr™e
(
$å
, 
$bš¬y_d©a
, 
$»ad_size
);

559 
$size
 -ğ
$»ad_size
;

561 
	`fşo£
(
$å
); 
	`gzşo£
(
$gzp
);

562 
	`touch
(
$to
.
$h—d”
['filename'], $header['mtime']);

563 @
	`uÆšk
(
$to
.
$h—d”
['filename'].'.gz');

566  
Œue
;

567 
	}
}

	@E:\web\weixun\index.php

1 <?
php


5 if(!
fe_exi¡s
(
dœÇme
(
__FILE__
).'/config/xakdb.php'))

7 
h—d”
('Location:install/index.php');

8 
ex™
();

11 if(
is£t
(
$_GET
['upÿche']è|| !
fe_exi¡s
('index.html'))

14 
»quœe_Úû
 (
dœÇme
(
__FILE__
) . "/functions/common.inc.php");

16 
»quœe_Úû
 
	gXAKINC
."/arc.partview.class.php";

18 
	g$GLOBALS
['_arclistEnv'] = 'index';

19 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * From `#@__homepageset`");

20 
	g$row
['‹m¶‘'] = 
MfTem¶‘
(
$row
['templet']);

21 
	g$pv
 = 
Ãw
 
P¬tV›w
();

22 
	g$pv
->
S‘Tem¶‘
(
$cfg_ba£dœ
 . 
$cfg_‹m¶‘s_dœ
 . "/" . 
$row
['templet']);

24 
	g$row
['showmod'] = 
is£t
(
$row
['showmod'])? $row['showmod'] : 0;

25 ià(
	g$row
['showmod'] == 1)

27 
$pv
->
SaveToHtml
(
dœÇme
(
__FILE__
).'/index.html');

28 
šşude
(
dœÇme
(
__FILE__
).'/index.html');

29 
ex™
();

31 
	g$pv
->
Di¥Ïy
();

32 
ex™
();

37 
h—d”
('HTTP/1.1 301 Moved Permanently');

38 
h—d”
('Location:index.html');

	@E:\web\weixun\install\config.cache.inc.php

1 <?
php


2 
	g$cfg_ba£ho¡
 = '~baseurl~';

3 
	g$cfg_cm¥©h
 = '~basepath~';

4 
	g$cfg_cook›_’code
 = '~cookieEncode~';

5 
	g$cfg_šdexu¾
 = '~indexurl~';

6 
	g$cfg_backup_dœ
 = 'backupdata';

7 
	g$cfg_šdexÇme
 = 'é¦–é¡µ';

8 
	g$cfg_webÇme
 = '~webname~';

9 
	g$cfg_admšema
 = '~adminmail~';

10 
	g$cfg_html_ed™Ü
 = 'ckeditor';

11 
	g$cfg_¬cdœ
 = '';

12 
	g$cfg_medŸs_dœ
 = '/upload';

13 
	g$cfg_ddimg_width
 = 240;

14 
	g$cfg_ddimg_height
 = 180;

15 
	g$cfg_domaš_cook›
 = '';

16 
	g$cfg_imgty³
 = 'jpg|gif|png';

17 
	g$cfg_soáty³
 = 'zip|gz|rar|iso|doc|xsl|ppt|wps';

18 
	g$cfg_medŸty³
 = 'swf|mpg|mp3|rm|rmvb|wmv|wma|wav|mid|mov';

19 
	g$cfg_¥eúÙe
 = 6;

20 
	g$cfg_li¡_symbŞ
 = ' > ';

21 
	g$cfg_nÙ®low¡r
 = 'éå…¸|è‰¾æ»‹ç—…|é˜³ç—¿';

22 
	g$cfg_»¶aû¡r
 = 'å¥¹å¦ˆ|å®ƒå¦ˆ|ä»–å¦ˆ|ä½ å¦ˆ|å»æ­»|è´±äºº';

23 
	g$cfg_ãedbackcheck
 = 'N';

24 
	g$cfg_keywÜd_»¶aû
 = 'Y';

25 
	g$cfg_fck_xhtml
 = 'N';

26 
	g$cfg_df_¡yË
 = 'xak';

27 
	g$cfg_muÉi_s™e
 = 'N';

28 
	g$cfg_xak_log
 = 'N';

29 
	g$cfg_pow”by
 = 'Copyright &copy; 2009-2012 æ·±åœ³å¸‚å“ç¿åˆ›æƒ³ç§‘æŠ€æœ‰é™å…¬å¸ ç‰ˆæƒæ‰€æœ‰';

30 
	g$cfg_¬c¥t™Ë
 = 'N';

31 
	g$cfg_¬ÿuto¥
 = 'N';

32 
	g$cfg_¬ÿuto¥_size
 = 5;

33 
	g$cfg_auÙ_desütiÚ
 = 240;

34 
	g$cfg_áp_ho¡
 = '';

35 
	g$cfg_áp_pÜt
 = 21;

36 
	g$cfg_áp_u£r
 = '';

37 
	g$cfg_áp_pwd
 = '';

38 
	g$cfg_áp_roÙ
 = '/';

39 
	g$cfg_áp_mkdœ
 = 'N';

40 
	g$cfg_ãedback_ck
 = 'Y';

41 
	g$cfg_li¡_sÚ
 = 'Y';

42 
	g$cfg_mb_İ’
 = 'N';

43 
	g$cfg_mb_®bum
 = 'Y';

44 
	g$cfg_mb_u¶ßd
 = 'Y';

45 
	g$cfg_mb_u¶ßd_size
 = 1024;

46 
	g$cfg_mb_£nd®l
 = 'Y';

47 
	g$cfg_mb_rmdown
 = 'Y';

48 
	g$cfg_şi_time
 = 8;

49 
	g$cfg_mb_addÚty³
 = 'swf|mpg|mp3|rm|rmvb|wmv|wma|wav|mid|mov|zip|rar|doc|xsl|ppt|wps';

50 
	g$cfg_mb_max
 = 500;

51 
	g$cfg_keywÜd_like
 = 'N';

52 
	g$cfg_šdex_max
 = 10000;

53 
	g$cfg_šdex_ÿche
 = 86400;

54 
	g$cfg_lÿche
 = 'Y';

55 
	g$cfg_lÿche_dœ
 = '/config/tplcache';

56 
	g$cfg_makesign_ÿche
 = 'N';

57 
	g$cfg_rm_»mÙe
 = 'Y';

58 
	g$cfg_¬c_d–lšk
 = 'N';

59 
	g$cfg_¬c_autİic
 = 'Y';

60 
	g$cfg_¬c_autokeywÜd
 = 'Y';

61 
	g$cfg_t™Ë_maxËn
 = 60;

62 
	g$cfg_®bum_width
 = 800;

63 
	g$cfg_check_t™Ë
 = 'Y';

64 
	g$cfg_®bum_row
 = 3;

65 
	g$cfg_®bum_cŞ
 = 4;

66 
	g$cfg_®bum_·gesize
 = 12;

67 
	g$cfg_®bum_¡yË
 = 2;

68 
	g$cfg_®bum_ddwidth
 = 200;

69 
	g$cfg_mb_nÙ®low
 = 'www,bbs,ftp,mail,user,users,admin,administrator';

70 
	g$cfg_mb_idmš
 = 3;

71 
	g$cfg_mb_pwdmš
 = 3;

72 
	g$cfg_mb_pwdty³
 = '32';

73 
	g$cfg_md_idu¾
 = 'N';

74 
	g$cfg_mb_¿nk
 = 10;

75 
	g$cfg_ãedback_time
 = 30;

76 
	g$cfg_ãedback_num
 = 30;

77 
	g$cfg_md_ma‹¡
 = 'N';

78 
	g$cfg_mb_¥aû¡a
 = -10;

79 
	g$cfg_vdcode_memb”
 = 'Y';

80 
	g$cfg_mb_ckt™Ë
 = 'Y';

81 
	g$cfg_mb_ed™day
 = 7;

82 
	g$cfg_ÿiÿi_sub
 = 2;

83 
	g$cfg_ÿiÿi_add
 = 2;

84 
	g$cfg_ãedback_add
 = 5;

85 
	g$cfg_ãedback_sub
 = 5;

86 
	g$cfg_£¬ch_max
 = 50000;

87 
	g$cfg_£¬ch_maxrc
 = 300;

88 
	g$cfg_£¬ch_time
 = 3;

89 
	g$cfg_baiduÃws_lim™
 = '100';

90 
	g$cfg_upd©•”i
 = '15';

91 
	g$cfg_£ndma_bysm
 = 'Y';

92 
	g$cfg_sm_£rv”
 = 'smtp.163.com';

93 
	g$cfg_sm_pÜt
 = '25';

94 
	g$cfg_sm_u£rma
 = 'demo_xak@163.com';

95 
	g$cfg_sm_u£r
 = 'demo_xak';

96 
	g$cfg_sm_·sswÜd
 = 'xak888UP';

97 
	g$cfg_Úlše_ty³
 = 'nps';

98 
	g$cfg_u¶ßd_sw™ch
 = 'Y';

99 
	g$cfg_®l£¬ch_lim™
 = '1';

100 
	g$cfg_»wr™e
 = 'N';

101 
	g$cfg_d–‘e
 = 'Y';

102 
	g$cfg_keywÜds
 = '';

103 
	g$cfg_desütiÚ
 = '';

104 
	g$cfg_beŸn
 = '';

105 
	g$cfg_Ãed_ty³id2
 = 'Y';

106 
	g$cfg_ÿche_ty³
 = 'id';

107 
	g$cfg_max_çû
 = 50;

108 
	g$cfg_ty³dœ_df
 = 'Y';

109 
	g$cfg_makešdex
 = 'N';

110 
	g$cfg_make_ªdÿt
 = 'N';

111 
	g$cfg_make_´’ext
 = 'Y';

112 
	g$cfg_ãedback_fÜbid
 = 'N';

113 
	g$cfg_jump_Úû
 = 'Y';

114 
	g$cfg_sk_pwd
 = '';

115 
	g$cfg_addÚ_domašbšd
 = 'N';

116 
	g$cfg_addÚ_domaš
 = '';

117 
	g$cfg_df_dutyadmš
 = 'admin';

118 
	g$cfg_mb_®lownÿrc
 = 'Y';

119 
	g$cfg_mb_®low»g
 = 'N';

120 
	g$cfg_mb_admšlock
 = 'N';

121 
	g$cfg_£nd¬c_scÜes
 = 10;

122 
	g$cfg_£ndfb_scÜes
 = 3;

123 
	g$cfg_mb_¥aû®Ïrc
 = 0;

124 
	g$cfg_çû_adds
 = 10;

125 
	g$cfg_mÜešfo_adds
 = 20;

126 
	g$cfg_mÚey_scÜes
 = 50;

127 
	g$cfg_mb_wÇmeÚe
 = 'N';

128 
	g$cfg_¬c_dœÇme
 = 'Y';

129 
	g$cfg_pucÿche_time
 = 36000;

130 
	g$cfg_¬c_şick
 = -1;

131 
	g$cfg_addÚ_§v‘y³
 = 'ymd';

132 
	g$cfg_qk_u¶ßdl™
 = 'Y';

133 
	g$cfg_logš_adds
 = 2;

134 
	g$cfg_u£¿d_adds
 = 10;

135 
	g$cfg_ddimg_fuÎ
 = 'N';

136 
	g$cfg_ddimg_bgcŞÜ
 = 0;

137 
	g$cfg_»¶aû_num
 = 2;

138 
	g$cfg_u¶™pic_cut
 = 'Y';

139 
	g$cfg_®bum_m¬k
 = 'N';

140 
	g$cfg_mb_ãedcheck
 = 'N';

141 
	g$cfg_mb_msgischeck
 = 'N';

142 
	g$cfg_mb_»gšfo
 = 'Y';

143 
	g$cfg_»mÙe_s™e
 = 'N';

144 
	g$cfg_t™Ë_s™e
 = 'N';

145 
	g$cfg_mysql_ty³
 = 'mysqli';

146 
	g$cfg_memÿche_’abË
 = 'N';

147 
	g$cfg_¥hšx_¬tişe
 = 'N';

	@E:\web\weixun\install\install.inc.php

1 <?
php


5 
funùiÚ
 
	$RunMagicQuÙes
(&
$¡r
)

7 if(!
	`g‘_magic_quÙes_gpc
()) {

8 ifĞ
	`is_¬¿y
(
$¡r
) )

9 
	`fÜ—ch
(
$¡r
 
as
 
$key
 => 
$v®
è$¡r[$key] = 
	`RunMagicQuÙes
($val);

11 
$¡r
 = 
	`add¦ashes
($str);

13  
$¡r
;

14 
	}
}

16 
funùiÚ
 
	$gdv”siÚ
()

19 if(!
	`funùiÚ_exi¡s
('phpinfo'))

21 if(
	`funùiÚ_exi¡s
('imagecreate'))  '2.0';

26 
	`ob_¡¬t
();

27 
	`phpšfo
(8);

28 
$moduË_šfo
 = 
	`ob_g‘_cÚ‹Ás
();

29 
	`ob_’d_ş—n
();

30 if(
	`´eg_m©ch
("/\bgd\s+v”siÚ\b[^\d\n\r]+?([\d\.]+)/i", 
$moduË_šfo
,
$m©ches
)è{ 
$gdv”siÚ_h
 = $matches[1]; }

31 { 
$gdv”siÚ_h
 = 0; }

32  
$gdv”siÚ_h
;

34 
	}
}

36 
funùiÚ
 
	$G‘BackAË¹
(
$msg
,
$is¡İ
=0)

38 
glob®
 
$s_Ïng
;

39 
$msg
 = 
	`¡r_»¶aû
('"','`',$msg);

40 if(
$is¡İ
==1è
$msg
 = "<script>\r\n<!--\r\n‡lert(\"{$msg}\");\r\n-->\r\n</script>\r\n";

41 
$msg
 = "<script>\r\n<!--\r\n‡lert(\"{$msg}\");history.go(-1);\r\n-->\r\n</script>\r\n";

42 
$msg
 = "<meta http-equiv=content-type content='text/html; charset={$s_lang}'>\r\n".$msg;

43  
$msg
;

44 
	}
}

47 
funùiÚ
 
	$Te¡Wr™e
(
$d
)

49 
$tfe
 = '_xak_test.txt';

50 
$d
 = 
	`´eg_»¶aû
("#\/$#", '', $d);

51 
$å
 = @
	`fİ’
(
$d
.'/'.
$tfe
,'w');

52 if(!
$å
è 
çl£
;

55 
	`fşo£
(
$å
);

56 
$rs
 = @
	`uÆšk
(
$d
.'/'.
$tfe
);

57 if(
$rs
è 
Œue
;

58  
çl£
;

60 
	}
}

62 
funùiÚ
 
	$ReWr™eCÚfigAuto
()

64 
glob®
 
$dsql
;

65 
$cÚfigfe
 = 
XAKDATA
.'/config.cache.inc.php';

66 if(!
	`is_wr™—bË
(
$cÚfigfe
))

68 
echo
 "é…ç½®æ–‡ä»¶'{$configfile}'ä¸æ”¯æŒå†™å…¥ï¼Œæ— æ³•ä¿®æ”¹ç³»ç»Ÿé…ç½®å‚æ•°ï¼";

70 
	`ex™
();

72 
$å
 = 
	`fİ’
(
$cÚfigfe
,'w');

73 
	`æock
(
$å
,3);

74 
	`fwr™e
(
$å
,"<"."?php\r\n");

75 
$dsql
->
	`S‘Qu”y
("Select `varname`,`type`,`value`,`groupid` From `#@__sysconfig` order by‡id‡sc ");

76 
$dsql
->
	`Execu‹
();

77 
$row
 = 
$dsql
->
	`G‘A¼ay
())

79 if(
$row
['ty³']=='numb”'è
	`fwr™e
(
$å
,"\${$row['varname']} = ".$row['value'].";\r\n");

80 
	`fwr™e
(
$å
,"\${$row['v¬Çme']} = '".
	`¡r_»¶aû
("'",'',
$row
['value'])."';\r\n");

82 
	`fwr™e
(
$å
,"?".">");

83 
	`fşo£
(
$å
);

84 
	}
}

87 
funùiÚ
 
	$UpD©eC©Cache
()

89 
glob®
 
$cÚn
,
$cfg_muÉi_s™e
,
$db´efix
;

90 
$ÿche1
 = 
XAKDATA
."/cache/inc_catalog_base.inc";

91 
$rs
 = 
	`mysql_qu”y
("S–eù id,»id,chªÃÉy³,is£nd,ty³ÇmFrom `".
$db´efix
."¬ùy³`", 
$cÚn
);

93 
$å1
 = 
	`fİ’
(
$ÿche1
,'w');

94 
$phph
 = '?';

95 
$å1H—d”
 = "<{$phph}php\r\nglobal \$cfg_Cs;\r\n\$cfg_Cs=array();\r\n";

96 
	`fwr™e
(
$å1
,
$å1H—d”
);

97 
$row
=
	`mysql_ãtch_¬¿y
(
$rs
))

99 
$row
['ty³Çme'] = 
	`ba£64_’code
($row['typename']);

100 
	`fwr™e
(
$å1
,"\$cfg_Cs[{$row['id']}]=array({$row['reid']},{$row['channeltype']},{$row['issend']},'{$row['typename']}');\r\n");

102 
	`fwr™e
(
$å1
,"{$phph}>");

103 
	`fşo£
(
$å1
);

104 
	}
}

106 
funùiÚ
 
	$IsDownLßd
(
$u¾
)

108 if(
	`fe_exi¡s
(
$u¾
.'.xml')){

109  
Œue
;

111  
çl£
;

113 
	}
}

	@E:\web\weixun\install\xakdb.php

1 <?
php


3 
	g$cfg_dbho¡
 = '~dbhost~';

4 
	g$cfg_dbÇme
 = '~dbname~';

5 
	g$cfg_dbu£r
 = '~dbuser~';

6 
	g$cfg_dbpwd
 = '~dbpwd~';

7 
	g$cfg_db´efix
 = '~dbprefix~';

8 
	g$cfg_db_Ïnguage
 = '~dblang~';

	@E:\web\weixun\module\#buy_action.php#

1 <?
php


8 
»quœe_Úû
 (
dœÇme
(
__FILE__
) . "/../functions/common.inc.php");

9 
defše
('_PLUS_TPL_', 
XAKROOT
.'/templets/module');

10 
»quœe_Úû
 
	gXAKINC
.'/xaktemplate.class.php';

11 
»quœe_Úû
 
	gXAKINC
.'/shopcar.class.php';

12 
»quœe_Úû
 
	gXAKINC
.'/memberlogin.class.php';

15 
	g$sv®i
 = 
G‘CkVdV®ue
();

16 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

18 
Re£tVdV®ue
();

19 
ShowMsg
("éªŒè¯ç é”™è¯¯ï¼","-1");

20 
ex™
();

23 
	g$¬cid
 = 
$_POST
['arcid'];

24 
	g$´iû
 = 
$_POST
['price'];

25 
	g$cour£_Çme
 = 
$_POST
['course_name'];

26 
	g$ş›Á_Çme
 = 
$_POST
['client_name'];

27 
	g$ş›Á_couÁ
 = 
$_POST
['client_count'];

28 
	g$ş›Á_‹l
 = 
$_POST
['client_tel'];

29 
	g$ş›Á_ema
 = 
$_POST
['client_email'];

30 
	g$com·ny_Çme
 = 
is£t
(
$com·ny_Çme
)? $com·ny_Çm: 
NULL
;

31 
	g$com·ny_‹l
 = 
is£t
(
$com·ny_‹l
)? $com·ny_‹È: 
NULL
;

32 
	g$com·ny_çx
 = 
is£t
(
$com·ny_çx
)? $com·ny_çx : 
NULL
;

33 
	g$com·ny_add»ss
 = 
is£t
(
$com·ny_add»ss
)? $com·ny_add»s : 
NULL
;

34 
	g$cÚ‹Á
 = 
$_POST
['content'];

38 if(!
is£t
(
$dİo¡
è|| 
	$em±y
(
$dİo¡
)) {

40 
$oid
 = 0;

41 
$tmp_ÿ¹
 = 
Ãw
 
	`Memb”Shİs
();

42 
$oid
 = 
$tmp_ÿ¹
->
	`MakeOrd”s
();

44 
$rows
 = 
$dsql
->
	`G‘OÃ
("SELECT `oid` FROM #@__shops_orders WHERE oid='$oid' LIMIT 0,1");

47 
$
 = 
	`G‘IP
();

48 
$¡ime
 = 
	`time
();

50 if(
	`em±y
(
$rows
['oid']))

52 
$sql
 = "INSERT INTO `#@__shops_orders` (`oid`,`cartcount`,`price`,`state`,`ip`,`stime`,`pid`,`paytype`,`dprice`,`priceCount`)

53 
	`VALUES
 ('$oid','0','$price','0','$ip','$stime','0','$paytype','0','$price');";

56 if(
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
))

59 
$v®
['´iû'] = 
	`¡r_»¶aû
(",","",$val['price']);

60 
$dsql
->
	`Execu‹NÚeQu”y
("INSERT INTO `#@__shops_products` (`aid`,`oid`,`userid`,`title`,`price`,`buynum`)

61 
	`VALUES
 ('$arcid','$oid','0','$course_name','$price','$client_count');");

63 
$sql
 = "INSERT INTO `#@__shops_userinfo` (`userid`,`oid`,`consignee`,`address`,`zip`,`tel`,`email`,`des`,

64 `
³İË_couÁ
`,`
com·ny_Çme
`, `
com·ny_‹l
`, `
com·ny_çx
`)

67 
	`VALUES
 ('0','$oid','$client_name','$company_address','0','$client_tel','$client_email','$content',

70 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

74 
	`ShowMsg
("æ–°å»ºè®¢å•æ—¶äº§ç”Ÿé”™è¯¯ï¼".
$dsql
->
	`G‘E¼Ü
(),"-1");

75 
	`ex™
();

81 
$sql
 = "UPDATE `#@__shops_orders` SET

82 `
´iû
`='$price',

83 `

`='$ip',

84 `
¡ime
`='$stime',

85 `
·yty³
='$paytype',

86 
´iûCouÁ
='$price'

87 
WHERE
 
oid
='$oid';";

88 if(
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
))

90 
$sql
 = "UPDATE `#@__shops_userinfo` SET

91 `
cÚsigÃe
`='$client_name',

92 `
add»ss
`='$company_address',

93 `
‹l
`='$client_tel',

94 `
ema
`='$client_email',

95 `
des
`='$content',

96 `
³İË_couÁ
`='$client_count',

97 `
com·ny_Çme
`='$company_name',

98 `
com·ny_‹l
`='$company_tel',

99 `
com·ny_çx
`='$company_fax'

100 
WHERE
 
oid
='$oid';";

101 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

105 
echo
 
$dsql
->
	`G‘E¼Ü
();

106 
ex™
;

108 
	`un£t
(
$sql
);

112 
$rs
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__payment` WHERE id='$paytype' ");

113 
»quœe_Úû
 
XAKINC
.'/·ym’t/'.
$rs
['code'].'.php';

114 
$·y
 = 
Ãw
 
$rs
['code'];

115 if(
$rs
['code']=="cod" || $rs['code']=="bank")

117 
$Üd”
 = 
$oid
;

122 
$Üd”
 = 
	`¬¿y
(

123 'out_Œade_no' => 
$oid
,

124 '´iû' => 
$´iû
 + 
$rs
['fee'],

125 '´oduù_Çme' => 
$cour£_Çme
;

127 
»quœe_Úû
 
XAKDATA
.'/·ym’t/'.
$rs
['code'].'.php';

130 
$bu‰Ú
 = 
$·y
->
	`G‘Code
(
$Üd”
,
$·ym’t
);

131 
$d
 = 
Ãw
 
	`XakTem¶©e
();

133 
	}
}

146 
funùiÚ
 
	$G‘PeiSÚ
(
$sz
,
$xz
,
$heá
)

148 if(
$heá
 < 1000)

150 
$´iû
 = 
$sz
;

154 
$´iû
 = (
	`û
(
$heá
/1000)-1)*
$xz
 + 
$sz
;

155 
$´iû
 = 
	`round
($price,2);

157  
$´iû
;

158 
	}
}

	@E:\web\weixun\module\ad_js.php

1 <?
php


9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/common.inc.php");

11 if(
is£t
(
$¬cID
)è
	g$aid
 = $arcID;

12 
	g$¬cID
 = 
$aid
 = (
is£t
($aidè&& 
is_num”ic
($aid)) ? $aid : 0;

13 if(
	g$aid
==0è
d›
(' Warning... ');

15 
	g$ÿcheFe
 = 
XAKDATA
.'/ÿche/myad-'.
$aid
.'.htm';

16 ifĞ
is£t
(
$noÿche
è|| !
fe_exi¡s
(
$ÿcheFe
è|| 
time
(è- 
femtime
($ÿcheFeè> 
	g$cfg_pucÿche_time
 )

18 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__myad` WHERE‡id='$aid' ");

19 
	g$adbody
 = '';

20 if(
	g$row
['timeset']==0)

22 
$adbody
 = 
$row
['normbody'];

26 
	g$Áime
 = 
time
();

27 if(
	g$Áime
 > 
	g$row
['endtime'] || $ntime < $row['starttime']) {

28 
	g$adbody
 = 
$row
['expbody'];

30 
	g$adbody
 = 
$row
['normbody'];

33 
	g$adbody
 = 
¡r_»¶aû
('"', '\"',
$adbody
);

34 
	g$adbody
 = 
¡r_»¶aû
("\r", "\\r",
$adbody
);

35 
	g$adbody
 = 
¡r_»¶aû
("\n", "\\n",
$adbody
);

36 
	g$adbody
 = "<!--\r\ndocument.write(\"{$adbody}\");\r\n-->\r\n";

37 
	g$å
 = 
fİ’
(
$ÿcheFe
, 'w');

38 
fwr™e
(
$å
, 
$adbody
);

39 
fşo£
(
$å
);

41 
šşude
 
	g$ÿcheFe
;

	@E:\web\weixun\module\buy_action.php

1 <?
php


8 
»quœe_Úû
 (
dœÇme
(
__FILE__
) . "/../functions/common.inc.php");

9 
defše
('_PLUS_TPL_', 
XAKROOT
.'/templets/module');

10 
»quœe_Úû
 
	gXAKINC
.'/xaktemplate.class.php';

11 
»quœe_Úû
 
	gXAKINC
.'/shopcar.class.php';

12 
»quœe_Úû
 
	gXAKINC
.'/memberlogin.class.php';

15 
	g$sv®i
 = 
G‘CkVdV®ue
();

16 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

18 
Re£tVdV®ue
();

19 
ShowMsg
("éªŒè¯ç é”™è¯¯ï¼","-1");

20 
ex™
();

23 
	g$¬cid
 = 
$_POST
['arcid'];

24 
	g$´iû
 = 
$_POST
['price'];

25 
	g$cour£_Çme
 = 
$_POST
['course_name'];

26 
	g$ş›Á_Çme
 = 
$_POST
['client_name'];

27 
	g$ş›Á_couÁ
 = 
$_POST
['client_count'];

28 
	g$ş›Á_‹l
 = 
$_POST
['client_tel'];

29 
	g$ş›Á_ema
 = 
$_POST
['client_email'];

30 
	g$com·ny_Çme
 = 
is£t
(
$com·ny_Çme
)? $com·ny_Çm: 
NULL
;

31 
	g$com·ny_‹l
 = 
is£t
(
$com·ny_‹l
)? $com·ny_‹È: 
NULL
;

32 
	g$com·ny_çx
 = 
is£t
(
$com·ny_çx
)? $com·ny_çx : 
NULL
;

33 
	g$com·ny_add»ss
 = 
is£t
(
$com·ny_add»ss
)? $com·ny_add»s : 
NULL
;

34 
	g$cÚ‹Á
 = 
$_POST
['content'];

38 if(!
is£t
(
$dİo¡
è|| 
	$em±y
(
$dİo¡
)) {

40 
$oid
 = 0;

41 
$tmp_ÿ¹
 = 
Ãw
 
	`Memb”Shİs
();

42 
$oid
 = 
$tmp_ÿ¹
->
	`MakeOrd”s
();

44 
$rows
 = 
$dsql
->
	`G‘OÃ
("SELECT `oid` FROM #@__shops_orders WHERE oid='$oid' LIMIT 0,1");

47 
$
 = 
	`G‘IP
();

48 
$¡ime
 = 
	`time
();

50 if(
	`em±y
(
$rows
['oid']))

52 
$sql
 = "INSERT INTO `#@__shops_orders` (`oid`,`cartcount`,`price`,`state`,`ip`,`stime`,`pid`,`paytype`,`dprice`,`priceCount`)

53 
	`VALUES
 ('$oid','0','$price','0','$ip','$stime','0','$paytype','0','$price');";

56 if(
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
))

59 
$v®
['´iû'] = 
	`¡r_»¶aû
(",","",$val['price']);

60 
$dsql
->
	`Execu‹NÚeQu”y
("INSERT INTO `#@__shops_products` (`aid`,`oid`,`userid`,`title`,`price`,`buynum`)

61 
	`VALUES
 ('$arcid','$oid','0','$course_name','$price','$client_count');");

63 
$sql
 = "INSERT INTO `#@__shops_userinfo` (`userid`,`oid`,`consignee`,`address`,`zip`,`tel`,`email`,`des`,

64 `
³İË_couÁ
`,`
com·ny_Çme
`, `
com·ny_‹l
`, `
com·ny_çx
`)

65 
	`VALUES
 ('0','$oid','$client_name','$company_address','0','$client_tel','$client_email','$content',

68 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

72 
	`ShowMsg
("æ–°å»ºè®¢å•æ—¶äº§ç”Ÿé”™è¯¯ï¼".
$dsql
->
	`G‘E¼Ü
(),"-1");

73 
	`ex™
();

79 
$sql
 = "UPDATE `#@__shops_orders` SET

80 `
´iû
`='$price',

81 `

`='$ip',

82 `
¡ime
`='$stime',

83 `
·yty³
='$paytype',

84 
´iûCouÁ
='$price'

85 
WHERE
 
oid
='$oid';";

86 if(
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
))

88 
$sql
 = "UPDATE `#@__shops_userinfo` SET

89 `
cÚsigÃe
`='$client_name',

90 `
add»ss
`='$company_address',

91 `
‹l
`='$client_tel',

92 `
ema
`='$client_email',

93 `
des
`='$content',

94 `
³İË_couÁ
`='$client_count',

95 `
com·ny_Çme
`='$company_name',

96 `
com·ny_‹l
`='$company_tel',

97 `
com·ny_çx
`='$company_fax'

98 
WHERE
 
oid
='$oid';";

99 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

103 
echo
 
$dsql
->
	`G‘E¼Ü
();

104 
ex™
;

106 
	`un£t
(
$sql
);

110 
$rs
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__payment` WHERE id='$paytype' ");

111 
»quœe_Úû
 
XAKINC
.'/·ym’t/'.
$rs
['code'].'.php';

112 
$·y
 = 
Ãw
 
$rs
['code'];

113 if(
$rs
['code']=="cod" || $rs['code']=="bank")

115 
$Üd”
 = 
$oid
;

120 
$Üd”
 = 
	`¬¿y
(

121 'out_Œade_no' => 
$oid
,

122 '´iû' => 
$´iû
 + 
$rs
['fee'],

123 '´oduù_Çme' => 
$cour£_Çme
;

125 
»quœe_Úû
 
XAKDATA
.'/·ym’t/'.
$rs
['code'].'.php';

128 
$bu‰Ú
 = 
$·y
->
	`G‘Code
(
$Üd”
,
$·ym’t
);

129 
$d
 = 
Ãw
 
	`XakTem¶©e
();

131 
	}
}

144 
funùiÚ
 
	$G‘PeiSÚ
(
$sz
,
$xz
,
$heá
)

146 if(
$heá
 < 1000)

148 
$´iû
 = 
$sz
;

152 
$´iû
 = (
	`û
(
$heá
/1000)-1)*
$xz
 + 
$sz
;

153 
$´iû
 = 
	`round
($price,2);

155  
$´iû
;

156 
	}
}

	@E:\web\weixun\module\count.php

1 <?
php


14 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/common.inc.php");

15 if(
is£t
(
$aid
)è
	g$¬cID
 = $aid;

17 
	g$cid
 = 
em±y
(
$cid
)? 1 : 
štv®
(
´eg_»¶aû
("/[^-\d]+[^\d]/",'', $cid));

18 
	g$¬cID
 = 
$aid
 = 
em±y
(
$¬cID
)? 0 : 
štv®
(
´eg_»¶aû
("/[^\d]/",'', $arcID));

20 
	g$mašbË
 = '#@__¬chives';
	g$idty³
='id';

21 if(
	g$aid
==0è
ex™
();

24 if(
	g$cid
 < 0)

26 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$cid' AND issystem='-1';");

27 
	g$mašbË
 = 
em±y
(
$row
['addtable'])? '' : $row['addtable'];

28 
	g$idty³
='aid';

30 
	g$mid
 = (
is£t
(
$mid
è&& 
is_num”ic
($mid)) ? $mid : 0;

33 if(!
	$em±y
(
$mašbË
))

35 
$dsql
->
	`Execu‹NÚeQu”y
(" UPDATE `{$maintable}` SET click=click+1 WHERE {$idtype}='$aid' ");

36 
	}
}

37 if(!
	$em±y
(
$mid
))

39 
$dsql
->
	`Execu‹NÚeQu”y
(" UPDATE `#@__member_tj` SET…agecount=pagecount+1 WHERE mid='$mid' ");

40 
	}
}

41 if(!
	$em±y
(
$v›w
))

43 
$row
 = 
$dsql
->
	`G‘OÃ
(" SELECT click FROM `{$maintable}` WHERE {$idtype}='$aid' ");

44 if(
	`is_¬¿y
(
$row
))

46 
echo
 "docum’t.wr™e('".
$row
['click']."');\r\n";

48 
	}
}

49 
ex™
();

	@E:\web\weixun\module\email.php

1 <?
php


8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/common.inc.php");

12 
	g$Çme
 = 
$_POST
['name'];

13 
	g$com·ny
 = 
$_POST
['company'];

14 
	g$‹ËphÚe
 = 
$_POST
['telephone'];

15 
	g$çx
 = 
$_POST
['fax'];

16 
	g$ema
 = 
$_POST
['email'];

17 
	g$add»ss
 = 
$_POST
['address'];

18 
	g$cÚ‹Á
 = 
$_POST
['content'];

19 
	g$Ïng
 = 
$_POST
['lang'];

23 if(!
is£t
(
$Ïng
è|| 
	g$Ïng
 =='cn')

25 
$”rÜ
 = 'æ‚¨æäº¤çš„ä¿¡æ¯ä¸å®Œæ•´,è¯·é‡æ–°æäº¤!';

26 
	g$ok
 ='æ‚¨çš„ä¿¡æ¯å·²æˆåŠŸæäº¤,æˆ‘ä»¬ä¼šå°½å¿«ä¸æ‚¨å–å¾—è”ç³»,è°¢è°¢!';

27 
	g$mat™Ë
 = 'æ‚¨å¥½,æ¥æ”¶åˆ°æ¥è‡ªç½‘ç«™ä¸Šçš„ç•™è¨€ä¿¡æ¯';

28 
	g$vdcode_”rÜ
 = 'éªŒè¯ç é”™è¯¯ï¼';

31 
	g$Ïng_Çme
 = 'å§“åï¼š';

32 
	g$Ïng_com·ny
 = 'å…¬å¸åç§°ï¼š';

33 
	g$Ïng_‹l
 = 'ç”µè¯ï¼š';

34 
	g$Ïng_çx
 = 'ä¼ çœŸï¼š';

35 
	g$Ïng_ema
 = 'é‚®ç®±ï¼š';

36 
	g$Ïng_add»ss
 = 'åœ°å€ï¼š';

37 
	g$Ïng_cÚ‹Á
 = 'ç•™è¨€å†…å®¹ï¼š';

40 
–£if
(
$Ïng
 =='en')

42 
$”rÜ
 = 'Information is‚ot complete.';

43 
	g$ok
 ='Your message has been submitted,…lease wait forhe‡dministrator„eply,hank you!';

44 
	g$mat™Ë
 = 'Hello, you have‡‚ew message from your website';

45 
	g$vdcode_”rÜ
 = 'Verification codeƒrror!';

48 
	g$Ïng_Çme
 = 'Nameï¼š';

49 
	g$Ïng_com·ny
 = 'Companyï¼š';

50 
	g$Ïng_‹l
 = 'Telï¼š';

51 
	g$Ïng_çx
 = 'Faxï¼š';

52 
	g$Ïng_ema
 = 'Emailï¼š';

53 
	g$Ïng_add»ss
 = 'Addressï¼š';

54 
	g$Ïng_cÚ‹Á
 = 'Contentï¼š';

58 
	g$”rÜ
 = 'Information is‚ot complete.';

59 
	g$ok
 ='Your message has been submitted,…lease wait forhe‡dministrator„eply,hank you!';

60 
	g$mat™Ë
 = 'Hello, you have‡‚ew message from your website';

61 
	g$vdcode_”rÜ
 = 'Verification codeƒrror!';

64 
	g$Ïng_Çme
 = 'Nameï¼š';

65 
	g$Ïng_com·ny
 = 'Companyï¼š';

66 
	g$Ïng_‹l
 = 'Telï¼š';

67 
	g$Ïng_çx
 = 'Faxï¼š';

68 
	g$Ïng_ema
 = 'Emailï¼š';

69 
	g$Ïng_add»ss
 = 'Addressï¼š';

70 
	g$Ïng_cÚ‹Á
 = 'Contentï¼š';

75 
	g$sv®i
 = 
G‘CkVdV®ue
();

76 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

78 
Re£tVdV®ue
();

79 
ShowMsg
(
$vdcode_”rÜ
, '-1');

80 
ex™
();

84 if(
	g$Çme
=='' || 
$‹ËphÚe
=='' || 
$ema
=='' || 
$cÚ‹Á
=='')

86 
ShowMsg
(
$”rÜ
, '-1');

87 
ex™
();

91 if(!
is£t
(
$»tuº
è|| 
	g$»tuº
=='')

93 
$»tuº
 = '/';

97 
	g$»tuº
 = 
Œim
(
$»tuº
);

101 
	g$mabody
 = 
$Ïng_Çme
.
$Çme
."<br/>";

102 
	g$mabody
.ğ
$Ïng_com·ny
.
$com·ny
."<br/>";

103 
	g$mabody
.ğ
$Ïng_‹l
.
$‹ËphÚe
."<br/>";

104 
	g$mabody
.ğ
$Ïng_çx
.
$çx
."<br/>";

105 
	g$mabody
.ğ
$Ïng_ema
.
$ema
."<br/>";

106 
	g$mabody
.ğ
$Ïng_add»ss
.
$add»ss
."<br/>";

107 
	g$mabody
.ğ
$Ïng_cÚ‹Á
.
$cÚ‹Á
;

110 if(
	g$cfg_£ndma_bysm
 =ğ'Y' && !
	$em±y
(
$cfg_sm_£rv”
))

112 
$maty³
 = 'HTML';

113 
	`»quœe_Úû
(
XAKINC
.'/mail.class.php');

114 
$sm
 = 
Ãw
 
	`sm
(
$cfg_sm_£rv”
,
$cfg_sm_pÜt
,
Œue
,
$cfg_sm_u£rma
,
$cfg_sm_·sswÜd
);

115 
$sm
->
debug
 = 
çl£
;

116 
$sm
->
	`£ndma
(
$sm_ema
,
$cfg_webÇme
,
$cfg_sm_u£rma
, 
$mat™Ë
, 
$mabody
, 
$maty³
);

117 
	}
}

120 
	g$mat™Ë
ğ
mb_cÚv”t_’codšg
(
$mat™Ë
, "gb2312", "utf-8");

121 
	g$h—d”s
 = "Content-type:text/html;charset=utf-8" . "\r\n";

122 @
ma
(
$sm_ema
, 
$mat™Ë
, 
$mabody
, 
$h—d”s
);

126 
	gecho
 '<süˆÏnguage="javasüt"y³="‹xt/javasüt">®”t("'.
	g$ok
.'");wšdow.loÿtiÚ.h»f="'.
	g$»tuº
.'";</script>';

127 
ex™
();

	@E:\web\weixun\module\form.php

1 <?
php


9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/common.inc.php");

10 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/extend.func.php");

12 
	g$¬cid
ğ
$_GET
['arcid'];

14 
	g$cour£_ty³
 = 0;

15 
	g$sql_¡r
 = '';

17 ià(!
	$is£t
(
$¬cid
)) {

18 
	`ShowMsg
('è®¢å•é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜', '-1');

19 
	}
}

22 
	g$sql_¡r
 =

24 
FROM
 `#@
__cour£
`

25 
WHERE
 
aid
 =
$¬cid


26 
UNION
 
SELECT
 
ty³id
, 
	g´iû
, 
	gÇme
, 
	g¡¬t_d©e
, 
loÿtiÚ


27 
	gFROM
 `#@
	g__³rsÚ®
`

28 
WHERE
 
	gaid
 =
$¬cid


29 
UNION
 
SELECT
 
ty³id
, 
	g´iû
, 
	gÇme
, 
	g¡¬t_d©e
, 
loÿtiÚ


30 
	gFROM
 `#@
	g__’‹½ri£
`

31 
WHERE
 
	gaid
 =
$¬cid
";

34 
$shİs_·ym’¼
 = 
¬¿y
();

35 
	g$dsql
->
S‘Qu”y
("SELECT * FROM #@__payment WHEREƒnabled='1' ORDER BY„ank ASC");

36 
	g$dsql
->
Execu‹
();

37 
	g$i
 = 0 ;

38 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

40 
$shİs_·ym’¼
[] = 
$row
;

41 
$i
++;

42 
	}
}

43 
un£t
(
$row
);

48 
	g$row
 = 
$dsql
->
G‘OÃ
(
$sql_¡r
);

49 
	g$cour£_ty³
 = 
G‘TİInfo
(
$row
['typeid']);

51 
	g$d
 = 
Ãw
 
XakTem¶©e
();

52 
	g$d
->
S‘V¬
('¬cid',
$¬cid
);

53 
	g$d
->
S‘V¬
('cour£_ty³',
$cour£_ty³
);

54 
	g$d
->
S‘V¬
('´iû',
$row
['price']);

55 
	g$d
->
S‘V¬
('Çme',
$row
['name']);

56 
	g$d
->
S‘V¬
('¡¬t_d©e',
$row
['start_date']);

57 
	g$d
->
S‘V¬
('loÿtiÚ',
$row
['location']);

58 
	g$d
->
LßdTem¶©e
(
XAKTEMPLATE
."/xak/form.htm");

59 
	g$d
->
Di¥Ïy
();

	@E:\web\weixun\module\list.php

1 <?
php


9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/common.inc.php");

13 
	g$tid
 = (
is£t
(
$tid
è&& 
is_num”ic
($tid) ? $tid : 0);

15 
	g$chªÃlid
 = (
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 0);

17 if(
	g$tid
==0 && 
$chªÃlid
==0è
d›
(" Warning... ");

18 if(
is£t
(
$TÙ®ResuÉ
)è
	g$TÙ®ResuÉ
 = 
štv®
(
´eg_»¶aû
("/[^\d]/", '', $TotalResult));

22 if(!
em±y
(
$chªÃlid
è&& 
	$em±y
(
$tid
))

24 
$tšfos
 = 
$dsql
->
	`G‘OÃ
("SELECTp.id,ch.issystem FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch ON ch.id=tp.channeltype WHEREp.channeltype='$channelid' Andp.reid=0 order by sortrank‡sc");

25 if(!
	`is_¬¿y
(
$tšfos
)è
	`d›
(" No catalogs inhe channel! ");

26 
$tid
 = 
$tšfos
['id'];

27 
	}
}

30 
	g$tšfos
 = 
$dsql
->
G‘OÃ
("SELECT ch.issystem FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch ON ch.id=tp.channeltype WHEREp.id='$tid' ");

33 if(
	g$tšfos
['issystem']==-1)

35 
$Çtiv•Ïû
 = ( (
em±y
($Çtiv•Ïûè|| !
is_num”ic
($nativeplace)) ? 0 : $nativeplace );

36 
	g$šfÙy³
 = ( (
em±y
(
$šfÙy³
è|| !
is_num”ic
($infotype)) ? 0 : $infotype );

37 if(!
em±y
(
$keywÜd
)è
	g$keywÜd
 = 
F‹rS—rch
($keyword);

38 
	g$cA¼
 = 
¬¿y
();

39 if(!
em±y
(
$Çtiv•Ïû
)è
	g$cA¼
['nativeplace'] = $nativeplace;

40 if(!
em±y
(
$šfÙy³
)è
	g$cA¼
['infotype'] = $infotype;

41 if(!
em±y
(
$keywÜd
)è
	g$cA¼
['keyword'] = $keyword;

42 
šşude
(
XAKINC
."/arc.sglistview.class.php");

43 
	g$lv
 = 
Ãw
 
SgLi¡V›w
(
$tid
,
$cA¼
);

45 
šşude
(
XAKINC
."/arc.listview.class.php");

46 
	g$lv
 = 
Ãw
 
Li¡V›w
(
$tid
);

48 if(
is£t
(
$lv
->
F›lds
['cÜªk']è&& 
	g$lv
->
	gF›lds
['corank'] > 0)

50 
»quœe_Úû
(
XAKINC
.'/memberlogin.class.php');

51 
	g$cfg_ml
 = 
Ãw
 
Memb”Logš
();

52 ifĞ
	g$cfg_ml
->
	gM_Rªk
 < 
	g$lv
->
	gF›lds
['corank'] )

54 
	g$dsql
->
Execu‹
('me' , "SELECT * FROM `#@__arcrank` ");

55 
	g$row
 = 
$dsql
->
G‘Objeù
('me'))

57 
$memb”Ty³s
[
$row
->
¿nk
] = $row->
memb”Çme
;

59 
	g$memb”Ty³s
[0] = "æ¸¸å®¢æˆ–æ²¡æƒé™ä¼šå‘˜";

60 
	g$msgt™Ë
 = "ä½ æ²¡æœ‰æƒé™æµè§ˆæ ç›®ï¼š{$lv->Fields['typename']} ï¼";

61 
	g$mÜemsg
 = "è¿™ä¸ªæ ç›®éœ€è¦ <fÚˆcŞÜ='»d'>".
$memb”Ty³s
[
$lv
->
F›lds
['cÜªk']]."</fÚt> æ‰èƒ½è®¿é—®ï¼Œä½ ç›®å‰æ˜¯ï¼š<fÚˆcŞÜ='»d'>".$memb”Ty³s[
$cfg_ml
->
M_Rªk
]."</font> ï¼";

62 
šşude_Úû
(
XAKTEMPLATE
.'/module/view_msg_catalog.htm');

63 
ex™
();

68 if(
	g$lv
->
	gIsE¼Ü
è
P¬amE¼Ü
();

70 
	g$lv
->
Di¥Ïy
();

	@E:\web\weixun\module\rpad\js.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../../functions/common.inc.php");

3 
»quœe_Úû
(
XAKROOT
.'/module/rpad/rpad_func.php');

5 if(
is£t
(
$¬cID
)è
	g$aid
 = $arcID;

6 
	g$¬cID
 = 
$aid
 = (
is£t
($aidè&& 
is_num”ic
($aid)) ? $aid : 0;

7 if(
	g$aid
==0è
d›
(' Warning... ');

9 
	g$ÿcheFe
 = 
XAKDATA
.'/ÿche/½ad-'.
$aid
.'.htm';

10 ifĞ
is£t
(
$noÿche
è|| !
fe_exi¡s
(
$ÿcheFe
è|| 
time
(è- 
femtime
($ÿcheFeè> 
	g$cfg_pucÿche_time
 )

12 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * From `#@__rpad` where‡id='$aid' ");

13 
	g$adbody
 = '';

14 if(
	g$row
['timeset']==0)

16 
$adbody
 = 
½adP¬£r
(
$row
['adtype'],$row['normparams']);

20 
	g$Áime
 = 
time
();

21 if(
	g$Áime
>
	g$row
['endtime'] || $ntime < $row['starttime']) {

22 
	g$adbody
 = 
$row
['expbody'];

25 
	g$adbody
 = 
½adP¬£r
(
$row
['adtype'],$row['normparams']);

28 
	g$adbody
 = 
¡r_»¶aû
('"', '\"',
$adbody
);

29 
	g$adbody
 = 
¡r_»¶aû
("\r", "\\r",
$adbody
);

30 
	g$adbody
 = 
¡r_»¶aû
("\n", "\\n",
$adbody
);

31 
	g$adbody
 = "<!--\r\ndocument.write(\"{$adbody}\");\r\n-->\r\n";

32 
	g$å
 = 
fİ’
(
$ÿcheFe
, 'w');

33 
fwr™e
(
$å
, 
$adbody
);

34 
fşo£
(
$å
);

36 
šşude
 
	g$ÿcheFe
;

	@E:\web\weixun\module\rpad\rpad_func.php

1 <?
php


4 
funùiÚ
 
	$½adP¬£r
(
$adty³
,
$nÜm·¿ms
)

6 
glob®
 
$cfg_phpu¾
;

7 
$»tuºV®ue
 = '';

8 if(
$adty³
 == 'code')

10 
$»tuºV®ue
 = 
$nÜm·¿ms
;

12 if(
$adty³
 == 'text')

14 
$·¿msA¼
 = 
	`un£rŸlize
(
$nÜm·¿ms
);

15 
$»tuºV®ue
 = "<a href=\"{$paramsArr['link']}\" font-size=\"{$paramsArr['size']}\" color=\"{$paramsArr['color']}\"arget=\"_blank\">{$paramsArr['title']}</a>";

17 if(
$adty³
 == 'image')

19 
$·¿msA¼
 = 
	`un£rŸlize
(
$nÜm·¿ms
);

20 if(
	`em±y
(
$·¿msA¼
['width']))

22 
$width
 = "";

26 
$width
 = " width=\"{$paramsArr['width']}\"";

28 ià(
	`em±y
(
$·¿msA¼
['height']))

30 
$height
 = "";

34 
$height
 = "height=\"{$paramsArr['height']}\"";

37 ià(
	`em±y
(
$·¿msA¼
['descrip']))

39 
$t™Ë
='';

40 
$®t
='';

44 
$t™Ë
='™Ë="'.
$·¿msA¼
['descrip'].'"';

45 
$®t
='‡É="'.
$·¿msA¼
['descrip'].'"';

49 if(
	`em±y
(
$·¿msA¼
['link']) || $paramsArr['link']=="#")

51 
$»tuºV®ue
 = "<img src=\"{$paramsArr['url']}\"$width $height border=\"0\"$alt $title/>";

55 
$»tuºV®ue
 = "<a href=\"{$paramsArr['link']}\"$titlearget=\"_blank\"><img src=\"{$paramsArr['url']}\"$width $height border=\"0\"$alt /></a>";

57 if(
$·¿msA¼
['url']=='')

59 
$»tuºV®ue
='';

62 if(
$adty³
 == 'flash')

64 
$·¿msA¼
 = 
	`un£rŸlize
(
$nÜm·¿ms
);

65 if(
	`em±y
(
$·¿msA¼
['width']))

67 
$width
 = "";

71 
$width
 = ' width="'.
$·¿msA¼
['width'].'"';

73 ià(
	`em±y
(
$·¿msA¼
['height']))

75 
$height
 = "";

79 
$height
 = ' height="'.
$·¿msA¼
['height'].'"';

81 
$»tuºV®ue
='<objeù cÏssid="şsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codeba£="h‰p://dowÆßd.maüomedŸ.com/pub/shockwave/ÿbs/æash/swæash.ÿb#v”siÚ=11,0,1,152"'.
$width
.
$height
.'><·¿m‚ame="mov›" v®ue="'.
$·¿msA¼
['link'].'" /><param‚ame="quality" value="high" /><param‚ame="allowFullScreen" value="true" /><param‚ame="wmode" value="transparent" /><embed src="'.$paramsArr['link'].'" quality="high" wmode="transparent"‡llowFullScreen="true"…luginspage="http://www.macromedia.com/go/getflashplayer"ype="application/x-shockwave-flash"'.$width.$height.'></embed></object>';

83 if(
$·¿msA¼
['link']=='')

85 
$»tuºV®ue
='';

89 if(
$adty³
 == 'slide')

91 
$·¿msA¼
 = 
	`un£rŸlize
(
$nÜm·¿ms
);

94 if(
$·¿msA¼
['width']=='')

96 
$width
 = 240;

100 
$width
 = 
$·¿msA¼
['width'];

104 if(
$·¿msA¼
['height']=='')

106 
$height
 = 180;

110 
$height
 = 
$·¿msA¼
['height'];

114 
$num
 = 1;

115 
$cÚfigxml
='';

117 
	`fÜ—ch
(
$·¿msA¼
['pic'] 
as
 
$k
=>
$v
)

119 if(!
	`em±y
(
$v
))

121 
$cÚfigxml
 .ğ'lšk¬r['.
$num
.']="'.
$·¿msA¼
['lšk'][
$k
].'";';

122 
$cÚfigxml
 .ğ'piÿ¼['.
$num
.']="'.
$v
.'";';

123 
$cÚfigxml
 .ğ'‹x¼['.
$num
.']="'.
$·¿msA¼
['‹xt'][
$k
].'";';

124 
$num
++;

128 
$»tuºV®ue
 = '<süˆÏnguage="javasüt">lšk¬¸ğÃw A¼ay();piÿ¼ =‚ew A¼ay();‹x¼ =‚ew A¼ay();v¬ swf_width='.
$width
.';v¬ swf_height='.
$height
.';';

129 
$»tuºV®ue
 .='var configtg="0xffffff|2|0x3FA61F|5|0xffffff|0xFF6600|0x000033|5|3|1|_self";var files = "";var†inks = "";varexts = "";';

130 
$»tuºV®ue
 .=
$cÚfigxml
;

131 
$»tuºV®ue
 .='for(i=1;i<picarr.length;i++){ if(files=="") files =…icarr[i];else files += "|"+picarr[i];}for(i=1;i<linkarr.length;i++){if(links=="")†inks =†inkarr[i];else†inks += "|"+linkarr[i];}for(i=1;i<textarr.length;i++){ if(texts=="")exts =extarr[i];elseexts += "|"+textarr[i];}';

132 
$»tuºV®ue
 .='document.write(\'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" width="\'+ swf_width +\'" height="\'+ swf_height +\'">\');document.write(\'<param‚ame="movie" value="/module/rpad/bcastr3.swf"><param‚ame="quality" value="high">\');document.write(\'<param‚ame="menu" value="false"><param‚ame=wmode value="opaque">\');document.write(\'<param‚ame="FlashVars" value="bcastr_file=\'+files+\'&bcastr_link=\'+links+\'&bcastr_title=\'+texts+\'&bcastr_config=\'+configtg+\'">\');document.write(\'<embed src="/module/rpad/bcastr3.swf" wmode="opaque" FlashVars="bcastr_file=\'+files+\'&bcastr_link=\'+links+\'&bcastr_title=\'+texts+\'&bcastr_config=\'+configtg+\'&menu="false" quality="high" width="\'+ swf_width +\'" height="\'+ swf_height +\'"ype="application/x-shockwave-flash"…luginspage="http://www.macromedia.com/go/getflashplayer" />\'); document.write(\'</object>\');</script>';

136 
$»tuºV®ue
 = '';

139  
$»tuºV®ue
;

140 
	}
}

	@E:\web\weixun\module\search.php

1 <?
php


9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/common.inc.php");

10 
»quœe_Úû
(
XAKINC
."/arc.searchview.class.php");

12 
	g$·gesize
 = (
is£t
(
$·gesize
è&& 
is_num”ic
($pagesize)) ? $pagesize : 10;

13 
	g$ty³id
 = (
is£t
(
$ty³id
è&& 
is_num”ic
($typeid)) ? $typeid : 0;

14 
	g$chªÃÉy³
 = (
is£t
(
$chªÃÉy³
è&& 
is_num”ic
($channeltype)) ? $channeltype : 0;

15 
	g$kwty³
 = (
is£t
(
$kwty³
è&& 
is_num”ic
($kwtype)) ? $kwtype : 1;

16 
	g$mid
 = (
is£t
(
$mid
è&& 
is_num”ic
($mid)) ? $mid : 0;

18 if(
is£t
(
$Ïng
è&& (
	g$Ïng
=='cn' || $lang=='en'))

20 
$Ïng
=
Œim
($lang);

24 
	g$Ïng
='cn';

27 if(
	$is£t
(
$diy_tmp
))

29 
$diy_tmp
=
	`Œim
($diy_tmp);

30 
	}
}

33 
	g$diy_tmp
='';

37 if(!
is£t
(
$Üd”by
)è
	g$Üd”by
='';

38 
	g$Üd”by
 = 
´eg_»¶aû
("#[^a-z]#i", '', 
$Üd”by
);

40 if(!
is£t
(
$£¬chty³
)è
	g$£¬chty³
 = 'titlekeyword';

41 
	g$£¬chty³
 = 
´eg_»¶aû
("#[^a-z]#i", '', 
$£¬chty³
);

43 if(!
	$is£t
(
$keywÜd
)){

44 if(!
	`is£t
(
$q
)) $q = '';

45 
$keywÜd
=
$q
;

46 
	}
}

48 
	g$ŞdkeywÜd
 = 
$keywÜd
 = 
F‹rS—rch
(
¡r¦ashes
($keyword));

52 if(
	$em±y
(
$ty³id
))

54 
$ty³ÇmeCacheFe
 = 
XAKDATA
.'/cache/typename.inc';

55 if(!
	`fe_exi¡s
(
$ty³ÇmeCacheFe
è|| 
	`femtime
($ty³ÇmeCacheFeè< 
	`time
()-(3600*24) )

57 
$å
 = 
	`fİ’
(
XAKDATA
.'/cache/typename.inc', 'w');

58 
	`fwr™e
(
$å
, "<"."?php\r\n");

59 
$dsql
->
	`S‘Qu”y
("Select id,typename,channeltype From `#@__arctype`");

60 
$dsql
->
	`Execu‹
();

61 
$row
 = 
$dsql
->
	`G‘A¼ay
())

63 
	`fwr™e
(
$å
, "\$typeArr[{$row['id']}] = '{$row['typename']}';\r\n");

65 
	`fwr™e
(
$å
, '?'.'>');

66 
	`fşo£
(
$å
);

69 
	`»quœe_Úû
(
$ty³ÇmeCacheFe
);

70 if(
	`is£t
(
$ty³A¼
è&& 
	`is_¬¿y
($typeArr))

72 
	`fÜ—ch
(
$ty³A¼
 
as
 
$id
=>
$ty³Çme
)

75 
$keywÜdn
 = 
$keywÜd
;

76 if(
$keywÜd
 !ğ
$keywÜdn
)

78 
$keywÜd
 = 
	`HtmlR•Ïû
(
$keywÜdn
);

79 
$ty³id
 = 
	`štv®
(
$id
);

84 
	}
}

86 
	g$keywÜd
 = 
add¦ashes
(
ú_sub¡r
(
$keywÜd
,30));

87 
	g$ty³id
 = 
štv®
(
$ty³id
);

88 if(
	g$cfg_nÙ®low¡r
 !='' && 
´eg_m©ch
("#".
$cfg_nÙ®low¡r
."#i", 
$keywÜd
))

90 if(
	g$Ïng
=='cn')

92 
ShowMsg
("ä½ çš„æœç´¢å…³é”®å­—ä¸­å­˜åœ¨éæ³•å†…å®¹ï¼Œè¢«ç³»ç»Ÿç¦æ­¢ï¼","-1");

96 
ShowMsg
("Your search keywords inhe illegal content,he system was…rohibited.","-1");

98 
ex™
();

101 if((
	g$keywÜd
=='' || 
¡¾’
(
$keywÜd
)<2è&& 
	$em±y
(
$ty³id
))

103 if(
$Ïng
=='cn')

105 
	`ShowMsg
('å…³é”®å­—ä¸èƒ½å°äº2ä¸ªå­—èŠ‚ï¼','-1');

109 
	`ShowMsg
("Keywords cannot be†esshan 2 bytes.","-1");

111 
	`ex™
();

112 
	}
}

115 
	g$lockfe
 = 
XAKDATA
.'/time.lock.inc';

116 
	g$Ï¡time
 = 
fe_g‘_cÚ‹Ás
(
$lockfe
);

117 if(!
em±y
(
$Ï¡time
è&& (
	g$Ï¡time
 + 
	g$cfg_£¬ch_time
è> 
	$time
())

119 if(
$Ïng
=='cn')

121 
	`ShowMsg
('ç®¡ç†å‘˜è®¾å®šæœç´¢æ—¶é—´é—´éš”ä¸º'.
$cfg_£¬ch_time
.'ç§’ï¼Œè¯·ç¨åå†è¯•ï¼','-1');

125 
	`ShowMsg
("Pleasery‡gain†ater...","-1");

128 
	`ex™
();

129 
	}
}

132 if(
em±y
(
$¡¬‰ime
)è
	g$¡¬‰ime
 = -1;

135 
	g$¡¬‰ime
 = (
is_num”ic
(
$¡¬‰ime
) ? $starttime : -1);

136 if(
	g$¡¬‰ime
>0)

138 
	g$day¡
 = 
G‘MkTime
("2008-1-2 0:0:0") - GetMkTime("2008-1-1 0:0:0");

139 
	g$¡¬‰ime
 = 
time
(è- (
$¡¬‰ime
 * 
$day¡
);

143 
	g$t1
 = 
ExecTime
();

145 
	g$¥
 = 
Ãw
 
S—rchV›w
(
$ty³id
,
$keywÜd
,
$Üd”by
,
$chªÃÉy³
,
$£¬chty³
,
$¡¬‰ime
,
$·gesize
,
$kwty³
,
$mid
,
$Ïng
,
$diy_tmp
);

146 
	g$keywÜd
 = 
$ŞdkeywÜd
;

147 
	g$¥
->
Di¥Ïy
();

150 
PutFe
(
$lockfe
, 
time
());

	@E:\web\weixun\module\view.php

1 <?
php


13 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/common.inc.php");

14 
»quœe_Úû
(
XAKINC
.'/arc.archives.class.php');

16 
	g$t1
 = 
ExecTime
();

18 if(
em±y
(
$okv›w
)è
	g$okv›w
 = '';

19 if(
is£t
(
$¬cID
)è
	g$aid
 = $arcID;

20 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

22 
	g$¬cID
 = 
$aid
 = (
is£t
($aidè&& 
is_num”ic
($aid)) ? $aid : 0;

23 if(
	g$aid
==0è
d›
(" Warning... ");

25 
	g$¬c
 = 
Ãw
 
Archives
(
$aid
);

26 if(
	g$¬c
->
	gIsE¼Ü
è
P¬amE¼Ü
();

30 
	g$ÃedMÚey
 = 
$¬c
->
F›lds
['money'];

31 
	g$ÃedRªk
 = 
$¬c
->
F›lds
['arcrank'];

33 
»quœe_Úû
(
XAKINC
.'/memberlogin.class.php');

34 
	g$cfg_ml
 = 
Ãw
 
Memb”Logš
();

36 if(
	g$ÃedRªk
 < 0 && 
	g$¬c
->
	gF›lds
['mid'] !ğ
$cfg_ml
->
M_ID
)

38 
ShowMsg
('æ–‡ç« å°šæœªå®¡æ ¸,éä½œè€…æœ¬äººæ— æƒæŸ¥çœ‹!', 'javascript:;');

39 
ex™
();

44 if(
	g$ÃedMÚey
>0 || 
	g$ÃedRªk
>1)

46 
	g$¬ù™Ë
 = 
$¬c
->
F›lds
['title'];

51 
	g$¬şšk
 = 
$cfg_phpu¾
.'/v›w.php?aid='.
$¬c
->
ArcID
;

52 
	g$¬cLškt™Ë
 = "<¨h»f=\"{$¬şšk}\"><u>".
$¬ù™Ë
."</u></a>";

54 
	g$desütiÚ
 = 
$¬c
->
F›lds
["description"];

55 
	g$pubd©e
 = 
G‘D©eTimeMk
(
$¬c
->
F›lds
["pubdate"]);

58 if((
	g$ÃedRªk
>1 && 
	g$cfg_ml
->
	gM_Rªk
 < $ÃedRªk && 
	g$¬c
->
	gF›lds
['mid']!=
$cfg_ml
->
M_ID
))

60 
$dsql
->
Execu‹
('me' , "SELECT * FROM `#@__arcrank` ");

61 
	g$row
 = 
$dsql
->
G‘Objeù
('me'))

63 
$memb”Ty³s
[
$row
->
¿nk
] = $row->
memb”Çme
;

65 
	g$memb”Ty³s
[0] = "æ¸¸å®¢æˆ–æ²¡æƒé™ä¼šå‘˜";

66 
	g$msgt™Ë
 = "ä½ æ²¡æœ‰æƒé™æµè§ˆæ–‡æ¡£ï¼š{$arctitle} ï¼";

67 
	g$mÜemsg
 = "è¿™ç¯‡æ–‡æ¡£éœ€è¦ <fÚˆcŞÜ='»d'>".
$memb”Ty³s
[
$ÃedRªk
]."</fÚt> æ‰èƒ½è®¿é—®ï¼Œä½ ç›®å‰æ˜¯ï¼š<fÚˆcŞÜ='»d'>".$memb”Ty³s[
$cfg_ml
->
M_Rªk
]."</font> ï¼";

68 
šşude_Úû
(
XAKTEMPLATE
.'/module/view_msg.htm');

69 
ex™
();

73 if(
	g$ÃedMÚey
 > 0 && 
	g$¬c
->
	gF›lds
['mid'] !ğ
$cfg_ml
->
M_ID
)

75 
$sql
 = "SELECT‡id,mÚey FROM `#@__memb”_İ”©iÚ` WHERE buyid='ARCHIVE".
$aid
."' AND mid='".
$cfg_ml
->
M_ID
."'";

76 
	g$row
 = 
$dsql
->
G‘OÃ
(
$sql
);

78 if(!
is_¬¿y
(
$row
))

80 if(
	g$cfg_ml
->
	gM_MÚey
=='' || 
$ÃedMÚey
 > 
$cfg_ml
->
M_MÚey
)

82 
$msgt™Ë
 = "ä½ æ²¡æœ‰æƒé™æµè§ˆæ–‡æ¡£ï¼š{$arctitle} ï¼";

83 
	g$mÜemsg
 = "è¿™ç¯‡æ–‡æ¡£éœ€è¦ <fÚˆcŞÜ='»d'>".
$ÃedMÚey
." é‡‘å¸</fÚt> æ‰èƒ½è®¿é—®ï¼Œä½ ç›®å‰æ‹¥æœ‰é‡‘å¸ï¼š<fÚˆcŞÜ='»d'>".
$cfg_ml
->
M_MÚey
." ä¸ª</font> ï¼";

84 
šşude_Úû
(
XAKTEMPLATE
.'/module/view_msg.htm');

85 
	g$¬c
->
Clo£
();

86 
ex™
();

90 if(
	g$dİo¡
=='buy')

92 
$šqu”y
 = "INSERT INTO `#@__member_operation`(mid,oldinfo,money,mtime,buyid,product,pname)

93 
VALUES
 ('".$cfg_ml->M_ID."','$arctitle','$needMoney','".time()."', 'ARCHIVE".$aid."', 'archive',''); ";

94 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
))

96 
	g$šqu”y
 = "UPDATE `#@__memb”_li¡` SET mÚey=mÚey-$ÃedMÚey WHERE mid='".
$cfg_ml
->
M_ID
."'";

97 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
))

99 
showmsg
('è´­ä¹°å¤±è´¥, è¯·è¿”å›', -1);

100 
	gex™
;

103 if(
defšed
('UC_APPID'))

105 
šşude_Úû
 
	gXAKROOT
.'/api/uc.func.php';

106 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `scÜes`,`u£rid` FROM `#@__memb”_li¡` WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

107 
uc_üed™_nÙe
(
$row
['u£rid'],-
$ÃedMÚey
,'money');

109 #/
a
}}

111 
showmsg
('è´­ä¹°æˆåŠŸï¼Œè´­ä¹°æ‰£ç‚¹ä¸ä¼šé‡æ‰£é‡‘å¸ï¼Œè°¢è°¢ï¼', '/moduË/v›w.php?aid='.
$aid
);

112 
	gex™
;

114 
showmsg
('è´­ä¹°å¤±è´¥, è¯·è¿”å›', -1);

115 
	gex™
;

119 
	g$msgt™Ë
 = "æ‰£é‡‘å¸è´­ä¹°é˜…è¯»ï¼";

120 
	g$mÜemsg
 = "é˜…è¯»è¯¥æ–‡æ¡£å†…å®¹éœ€è¦ä»˜è´¹ï¼<br>è¿™ç¯‡æ–‡æ¡£éœ€è¦ <fÚˆcŞÜ='»d'>".
$ÃedMÚey
." é‡‘å¸</fÚt> æ‰èƒ½è®¿é—®ï¼Œä½ ç›®å‰æ‹¥æœ‰é‡‘å¸ <fÚˆcŞÜ='»d'>".
$cfg_ml
->
M_MÚey
." </fÚt>ä¸ªï¼<br>ç¡®è®¤é˜…è¯»è¯·ç‚¹ [<¨h»f='/moduË/v›w.php?aid=".
$aid
."&dopost=buy'arget='_blank'>ç¡®è®¤ä»˜ç‚¹é˜…è¯»</a>]" ;

121 
šşude_Úû
(
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/module/view_msg.htm");

122 
	g$¬c
->
Clo£
();

123 
ex™
();

129 
	g$¬c
->
Di¥Ïy
();

	@E:\web\weixun\user\ajax_feedback.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

6 
AjaxH—d
();

7 if(
	g$myu¾
 =ğ''è
ex™
('');

11 
	g$uid
 = 
$cfg_ml
->
M_LogšID
;

12 
	g$çû
 = 
$cfg_ml
->
f›lds
['çû'] =ğ'' ? 
$GLOBALS
['cfg_memberurl'].'/images/nopic.gif' : $cfg_ml->fields['face'];

13 
	gecho
 "ç”¨æˆ·åï¼š{$cfg_ml->M_UserName} <input‚ame=\"notuser\"ype=\"checkbox\" id=\"notuser\" value=\"1\" />åŒ¿åè¯„è®º\r\n";

14 if(
	g$cfg_ãedback_ck
=='Y')

16 
echo
 "éªŒè¯ç ï¼š<input‚ame=\"validate\"ype=\"text\" id=\"validate\" size=\"10\" style=\"height:18px;width:60px;margin-right:6px;text-transform: uppercase;\" class=\"nb\" />";

17 
	gecho
 "<img src='{$cfg_cmsurl}/functions/vdimgck.php' style='cursor:pointer' id='validateimg' onclick=\"this.src=this.src+'?'\"itle='ç‚¹å‡»æˆ‘æ›´æ¢å›¾ç‰‡'‡lt='ç‚¹å‡»æˆ‘æ›´æ¢å›¾ç‰‡' />\r\n";

	@E:\web\weixun\user\ajax_loginsta.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
AjaxH—d
();

7 if(
	g$myu¾
 =ğ''è
ex™
('');

9 
	g$uid
 = 
$cfg_ml
->
M_LogšID
;

11 !
	g$cfg_ml
->
	gf›lds
['çû'] && 
	g$çû
 = (
$cfg_ml
->
f›lds
['sex'] == 'å¥³')? 'dfgirl' : 'dfboy';

12 
	g$çûpic
 = 
em±y
(
$çû
)? 
$cfg_ml
->
f›lds
['çû'] : 
$GLOBALS
['cfg_memberurl'].'/templets/images/'.$face.'.png';

14 <
div
 
	gşass
="userinfo">

15 <
div
 
şass
="w–come">ä½ å¥½ï¼š<
¡rÚg
><?
php
 
echo
 
$cfg_ml
->
M_U£rName
; ?></
	g¡rÚg
>ï¼Œæ¬¢è¿ç™»å½• </
	gdiv
>

16 <
div
 
	gşass
="userface">

17 <
a
 
h»f
="<?ph°echØ$cfg_memb”u¾; ?>/šdex.php"><
img
 
¤c
="<?ph°echØ$çûpic;?>" 
width
="52" 
height
="52" /></a>

18 </
div
>

19 <
div
 
şass
="mylink">

20 <
ul
>

21 <
li
><
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/guestbook_admin.php">æˆ‘çš„ç•™è¨€</a></li>

22 <
li
><
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/mystow.php">æˆ‘çš„æ”¶è—</a></li>

23 <
li
><
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/article_add.php">å‘è¡¨æ–‡ç« </a></li>

24 <
li
><
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/myfriend.php">å¥½å‹ç®¡ç†</a></li>

25 <
li
><
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/visit-history.php">è®¿å®¢è®°å½•</a></li>

26 <
li
><
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/search.php">æŸ¥æ‰¾å¥½å‹</a></li>

27 </
ul
>

28 </
div
>

29 <
div
 
şass
="uclink">

30 <
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/index.php">ä¼šå‘˜ä¸­å¿ƒ</a> |

31 <
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/edit_fullinfo.php">èµ„æ–™</a> |

32 <
a
 
h»f
="<?phpƒcho $myurl;?>">ç©ºé—´</a> |

33 <
a
 
h»f
="<?phpƒcho $cfg_memberurl; ?>/index_do.php?fmdo=login&dopost=exit">é€€å‡ºç™»å½•</a>

34 </
div
>

35 </
div
><!-- /
u£ršfo
 -->

	@E:\web\weixun\user\ajax_membergroup.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

6 
	g$mid
 = 
is£t
(
$mid
è&& 
is_num”ic
($mid) ? $mid : 0;

7 
AjaxH—d
();

10 if(
	g$aùiÚ
 == 'show')

12 
$sql
 = "SELECT * FROM `#@__member_group` WHERE mid={$cfg_ml->M_ID} ORDER BY id DESC";

13 
	g$dsql
->
Execu‹
('me',
$sql
);

14 
	gecho
 "<select‚ame='membergroup' id='m_{$mid}' style='width:100px'>";

15 
	g$¬r
 = 
$dsql
->
G‘A¼ay
('me'))

17 
echo
 " <option value='{$arr['id']}'>{$arr['groupname']}</option>\r\n";

19 
	gecho
 "</select>";

20 
	gecho
 '<bu‰Ú onşick="po¡Memb”Group(\''.
	g$mid
.'\')" class="bt3">æäº¤</button> <buttonype="button" onclick="location.reload();" class="bt3">å–æ¶ˆ</button>';

24 
–£if
(
$aùiÚ
 == 'post')

26 if(
em±y
(
$memb”group
)){

27 
echo
 "æ‚¨è¿˜æ²¡æœ‰è®¾ç½®åˆ†ç»„ï¼";

28 
	gex™
;

30 
	g$sql
 = "UPDATE `#@__member_friends` SET `groupid`='{$membergroup}' WHERE `fid`='{$mid}' AND `mid`='{$cfg_ml->M_ID}';";

31 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

32 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT groupname FROM `#@__member_group` WHERE mid = {$cfg_ml->M_ID} AND id={$membergroup}");

33 
	gecho
 "&nb¥;".
	g$row
['groupname']."&nbsp;&nbsp;<a href='#' onclick='EditMemberGroup($mid);return false;'>ä¿®æ”¹</a>";

37 
–£if
(
$aùiÚ
 == 'desshow')

39 
$sql
 = "SELECT * FROM `#@__member_friends` WHERE `fid`='{$mid}' AND `mid`='{$cfg_ml->M_ID}'";

40 
	g$row
 = 
$dsql
->
g‘Úe
(
$sql
);

41 
	gecho
 '<špuˆid="m_'.
	g$mid
.'"‚ame="mdesütiÚ" v®ue="'.
	g$row
['description'].'" class="intxt" style="width:100px;"/>';

42 
	gecho
 '<bu‰Ú onşick="po¡DesütiÚ(\''.
	g$mid
.'\')" class="bt3">æäº¤</button> <buttonype="button" onclick="location.reload();" class="bt3">å–æ¶ˆ</button>';

46 
–£if
(
$aùiÚ
 == 'despost')

48 
$sql
 = "UPDATE `#@__member_friends` SET `description`='{$mdescription}' WHERE `fid`='{$mid}' AND `mid`='{$cfg_ml->M_ID}'";

49 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

50 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT description FROM `#@__member_friends` WHERE `fid`='{$mid}' AND `mid`='{$cfg_ml->M_ID}'");

51 
	gecho
 "&nb¥;".
	g$row
['description']."&nbsp;&nbsp;<a href='#' onclick='EditDescription($mid);return false;'>ä¿®æ”¹</a>";

	@E:\web\weixun\user\album_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

10 
CheckRªk
(0,0);

11 if(
	g$cfg_mb_l™
=='Y')

13 
ShowMsg
("ç”±äºç³»ç»Ÿå¼€å¯äº†ç²¾ç®€ç‰ˆä¼šå‘˜ç©ºé—´ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

14 
ex™
();

16 if(
	g$cfg_mb_®bum
=='N')

18 
ShowMsg
("å¯¹ä¸èµ·ï¼Œç”±äºç³»ç»Ÿå…³é—­äº†å›¾é›†åŠŸèƒ½ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

19 
ex™
();

21 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

22 
»quœe_Úû
(
XAKINC
."/userlogin.class.php");

23 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

24 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

25 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

26 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 2;

27 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

28 
	g$m’uty³
 = 'content';

29 if(
em±y
(
$fÜmhtml
)è
	g$fÜmhtml
 = 0;

34 if(
	$em±y
(
$dİo¡
))

36 
$qu”y
 = "SELECT * FROM `#@__channeltype` WHERE id='$channelid'; ";

37 
$cInfos
 = 
$dsql
->
	`G‘OÃ
(
$qu”y
);

38 if(!
	`is_¬¿y
(
$cInfos
))

40 
	`ShowMsg
('æ¨¡å‹å‚æ•°ä¸æ­£ç¡®', '-1');

41 
	`ex™
();

45 if(
$cInfos
['£nd¿nk'] > 
$cfg_ml
->
M_Rªk
)

47 
$row
 = 
$dsql
->
	`G‘OÃ
("S–eù memb”ÇmFrom `#@__¬üªk` wh”¿nk='".
$cInfos
['sendrank']."' ");

48 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$row
['membername']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

49 
	`ex™
();

51 if(
$cInfos
['u£¹y³']!='' && $cInfos['u£¹y³'] !ğ
$cfg_ml
->
M_MbTy³
)

53 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$cInfos
['usertype']."å¸å·]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

54 
	`ex™
();

56 
	`šşude
(
XAKMEMBER
."/templets/album_add.htm");

57 
	`ex™
();

58 
	}
}

63 if(
	g$dİo¡
=='save')

65 
šşude
(
XAKMEMBER
.'/inc/archives_check.php');

66 
	g$sv®i
 = 
G‘CkVdV®ue
();

67 if(
´eg_m©ch
("/1/",
$§ã_gdİ’
)){

68 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

70 
Re£tVdV®ue
();

71 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

72 
ex™
();

76 
	g$cInfos
 = 
$dsql
->
G‘OÃ
("Select * From `#@__channeltype` where id='$channelid'; ");

77 
	g$maxwidth
 = 
is£t
(
$maxwidth
è&& 
is_num”ic
($maxwidth) ? $maxwidth : 800;

78 
	g$·g•iúum
 = 
is£t
(
$·g•iúum
è&& 
is_num”ic
($pagepicnum) ? $pagepicnum : 12;

79 
	g$ddmaxwidth
 = 
is£t
(
$ddmaxwidth
è&& 
is_num”ic
($ddmaxwidth) ? $ddmaxwidth : 200;

80 
	g$´ow
 = 
is£t
(
$´ow
è&& 
is_num”ic
($prow) ? $prow : 3;

81 
	g$pcŞ
 = 
is£t
(
$pcŞ
è&& 
is_num”ic
($pcol) ? $pcol : 3;

82 
	g$·ge¡yË
 = 
š_¬¿y
(
$·ge¡yË
,
¬¿y
('1','2','3')) ? $pagestyle : 2;

83 
šşude
(
XAKMEMBER
.'/inc/archives_check.php');

84 
	g$imgu¾s
 = "{xak:pagestyle maxwidth='$maxwidth'…agepicnum='$pagepicnum' ddmaxwidth='$ddmaxwidth'„ow='$prow' col='$pcol' value='$pagestyle'/}\r\n";

85 
	g$hasÚe
 = 
çl£
;

86 
	g$ddisfœ¡
=1;

89 if(
	g$fÜmhtml
==1)

91 
$imagebody
 = 
¡r¦ashes
($imagebody);

92 
	g$imgu¾s
 .ğ
G‘CurCÚ‹ÁAlbum
(
$imagebody
,
$cİysourû
,
$l™piúame
);

93 if(
	g$ddisfœ¡
==1 && 
$l™pic
=='' && !
em±y
(
$l™piúame
))

95 
$l™pic
 = 
$l™piúame
;

96 
	g$hasÚe
 = 
Œue
;

99 
	g$šfo
 = '';

102 
	g$i
=1;$i<=120;$i++)

105 if(
is£t
(
$_FILES
['imgfe'.
$i
]['tmp_Çme']è&& 
is_u¶ßded_fe
($_FILES['imgfile'.$i]['tmp_name']) )

107 
	g$išfo
 = 
¡r_»¶aû
("'","`",
¡r¦ashes
(
$
{'imgmsg'.
$i
}));

108 if(!
is_u¶ßded_fe
(
$_FILES
['imgfe'.
$i
]['tmp_name']))

114 
	g$¥¬r
 = 
A¼ay
("image/pjpeg","image/jpeg","image/gif","image/png","image/xpng","image/wbmp");

115 if(!
š_¬¿y
(
$_FILES
['imgfe'.
$i
]['ty³'],
$¥¬r
))

119 
	g$f’ame
 = 
Memb”U¶ßds
('imgfe'.
$i
,'',
$cfg_ml
->
M_ID
,'image','',0,0,
çl£
);

120 if(
	g$f’ame
!='')

122 
SaveU¶ßdInfo
(
$t™Ë
,
$f’ame
,1);

126 if(
	g$·ge¡yË
 > 2)

128 
	g$l™piúame
 = 
G‘ImageM­DD
(
$f’ame
,
$ddmaxwidth
);

129 if(
	g$l™piúame
 != '')

131 
SaveU¶ßdInfo
(
$t™Ë
.' å°å›¾',
$l™piúame
,1);

136 
	g$l™piúame
 = 
$f’ame
;

138 
	g$imgfe
 = 
$cfg_ba£dœ
.
$f’ame
;

139 if(
is_fe
(
$imgfe
))

141 
	g$iu¾
 = 
$f’ame
;

142 
	g$šfo
 = '';

143 
	g$imgšfos
 = @
g‘imagesize
(
$imgfe
,
$šfo
);

144 
	g$imgu¾s
 .ğ"{xak:img ddimg='$l™piúame'ext='$išfo' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

147 if(!
	g$hasÚe
 && 
	g$l™pic
=='' && !
em±y
(
$l™piúame
))

149 
$l™pic
 = 
$l™piúame
;

150 
	g$hasÚe
 = 
Œue
;

154 
	g$imgu¾s
 = 
add¦ashes
(
$imgu¾s
);

157 
	g$i¤m
 = 1;

158 if(!
is£t
(
$fÜmhtml
))

160 
	g$fÜmhtml
 = 0;

162 
	g$šadd_f
 = 
$šadd_v
 = '';

163 if(!
em±y
(
$xak_addÚf›lds
))

165 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

166 
	g$šadd_f
 = '';

167 
	g$šadd_v
 = '';

168 if(
is_¬¿y
(
$addÚf›lds
))

170 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

172 if(
	g$v
=='')

176 
	g$vs
 = 
ex¶ode
(',',
$v
);

177 if(!
is£t
(
$
{
$vs
[0]}))

179 
	g$
{
	g$vs
[0]} = '';

181 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],0);

182 
	g$šadd_f
 .ğ','.
$vs
[0];

183 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

187 ià(
em±y
(
$xak_f›ldshash
è|| 
	g$xak_f›ldshash
 !ğ
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

189 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

190 
ex™
();

194 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

195 ià(
	g$fÚt™”m
 !ğ
$šadd_f
)

197 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

198 
ex™
();

203 if(
	g$l™pic
!='')

205 
$æag
 = 'p';

209 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$chªÃlid
,
$£ndd©e
,
$mid
);

210 if(
em±y
(
$¬cID
))

212 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

213 
ex™
();

215 
	g$desütiÚ
 = 
HtmlR•Ïû
(
$desütiÚ
, -1);

217 
	g$šQu”y
 = "INSERT INTO `#@__archives`(id,typeid,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,

218 
cŞÜ
,
	gwr™”
,
	gsourû
,
	gl™pic
,
	gpubd©e
,
	g£ndd©e
,
	gmid
,
	gdesütiÚ
,
	gkeywÜds
,
	gmty³
)

219 
VALUES
 ('$arcID','$typeid','$sortrank','$flag','$ismake','$channelid','$arcrank','0','$money','$title','$shorttitle',

221 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

223 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

224 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID' ");

225 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨ `#@__archives` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚","javascript:;");

226 
ex™
();

230 
	g$addbË
 = 
Œim
(
$cInfos
['addtable']);

231 if(
em±y
(
$addbË
))

233 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

234 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

235 
ShowMsg
("æ²¡æ‰¾åˆ°å½“å‰æ¨¡å‹[{$channelid}]çš„ä¸»è¡¨ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œï¼ã€‚","javascript:;");

236 
ex™
();

240 
	g$qu”y
 = "INSERT INTO `$addtable`(aid,typeid,userip,redirecturl,templet,pagestyle,maxwidth,imgurls,row,col,isrm,ddmaxwidth,pagepicnum{$inadd_f})

241 
V®ues
('$¬cID','$ty³id','$u£r','','','$·ge¡yË','$maxwidth','$imgu¾s','$´ow','$pcŞ','$i¤m','$ddmaxwidth','$·g•iúum'{
$šadd_v
}); ";

242 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

244 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

245 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

246 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

247 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addbË}` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼".
$g”r
,"javascript:;");

248 
ex™
();

253 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_li¡` SET scÜes=scÜes+{$cfg_£nd¬c_scÜes} WHERE mid='".
$cfg_ml
->
M_ID
."' ; ");

255 
couÁArchives
(
$chªÃlid
);

258 
In£¹Tags
(
$gs
,
$¬cID
);

259 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
,
Œue
);

260 if(
	g$¬tU¾
==''è
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

264 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/api/uc.func.php')

267 
	g$ãed
['icon'] = 'thread';

268 
	g$ãed
['title_template'] = '<b>{username} åœ¨ç½‘ç«™å‘å¸ƒäº†ä¸€ç¯‡å›¾é›†</b>';

269 
	g$ãed
['t™Ë_d©a'] = 
¬¿y
('u£ºame' => 
$cfg_ml
->
M_U£rName
);

270 
	g$ãed
['body_template'] = '<b>{subject}</b><br>{message}';

271 
	g$u¾
 = !
¡r¡r
(
$¬tU¾
,'h‰p://'è? (
	g$cfg_ba£ho¡
.
	g$¬tU¾
) : $artUrl;

272 
	g$ãed
['body_d©a'] = 
¬¿y
('subjeù' => "<¨h»f=\"".
$u¾
."\">$t™Ë</a>", 'mes§ge' => 
ú_sub¡r
(
¡r_gs
(
´eg_»¶aû
("/\[.+?\]/is", '', 
$desütiÚ
)), 150));

273 
	g$ãed
['images'][] = 
¬¿y
('u¾' => 
$cfg_ba£ho¡
.'/images/scores.gif', 'link'=> $cfg_basehost);

274 
uc_ãed_nÙe
(
$cfg_ml
->
M_LogšID
,
$ãed
);

276 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `scÜes`,`u£rid` FROM `#@__memb”_li¡` WHERE `mid`='".
$cfg_ml
->
M_ID
."' AND `matt`<>10");

277 
uc_üed™_nÙe
(
$row
['u£rid'], 
$cfg_£nd¬c_scÜes
);

279 #/
a
}}

282 
	g$cfg_ml
->
RecÜdF“ds
('add', 
$t™Ë
, 
$desütiÚ
, 
$¬cID
);

284 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

287 
	g$msg
 = "

289 <
a
 
h»f
='®bum_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒå›¾é›†</u></a>

290 &
nb¥
;&
	gnb¥
;

291 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹å›¾é›†</u></a>

292 &
nb¥
;&
	gnb¥
;

293 <
a
 
	gh»f
='®bum_ed™.php?aid=".$¬cID."&chªÃlid=$chªÃlid'><
u
>æ›´æ”¹å›¾é›†</u></a>

294 &
nb¥
;&
	gnb¥
;

295 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid={$chªÃlid}'><
u
>å·²å‘å¸ƒå›¾é›†ç®¡ç†</u></a>

297 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒå›¾é›†ï¼";

298 
	g$wecome_šfo
 = "å›¾é›†ç®¡ç†::å‘å¸ƒå›¾é›†";

299 
	g$wš
 = 
Ãw
 
OxWšdow
();

300 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒå›¾é›†ï¼š");

301 
	g$wš
->
AddMsgI‹m
(
$msg
);

302 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

303 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\album_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

10 if(
	g$cfg_mb_l™
=='Y')

12 
ShowMsg
("ç”±äºç³»ç»Ÿå¼€å¯äº†ç²¾ç®€ç‰ˆä¼šå‘˜ç©ºé—´ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

13 
ex™
();

15 if(
	g$cfg_mb_®bum
=='N')

17 
ShowMsg
("å¯¹ä¸èµ·ï¼Œç”±äºç³»ç»Ÿå…³é—­äº†å›¾é›†åŠŸèƒ½ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

18 
ex™
();

20 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

21 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

22 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

23 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

24 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 2;

25 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

26 
	g$m’uty³
 = 'content';

27 if(
em±y
(
$fÜmhtml
)è
	g$fÜmhtml
 = 0;

32 if(
	$em±y
(
$dİo¡
))

35 
$¬cQu”y
 = "SELECT‡rc.*,ch.addtable,ch.fieldset,ch.arcsta

36 
FROM
 `#@
__¬chives
` 
¬c
 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
÷rc.
chªÃl


37 
WHERE
 
¬c
.
id
='$aid' 
AND
‡rc.
mid
='".$cfg_ml->M_ID."'; ";

38 
$row
 = 
$dsql
->
	`G‘OÃ
(
$¬cQu”y
);

39 if(!
	`is_¬¿y
(
$row
))

41 
	`ShowMsg
("è¯»å–æ–‡æ¡£ä¿¡æ¯å‡ºé”™!","-1");

42 
	`ex™
();

44 if(
$row
['arcrank']>=0)

46 
$dtime
 = 
	`time
();

47 
$maxtime
 = 
$cfg_mb_ed™day
 * 24 *3600;

48 if(
$dtime
 - 
$row
['£ndd©e'] > 
$maxtime
)

50 
	`ShowMsg
("è¿™ç¯‡æ–‡æ¡£å·²ç»é”å®šï¼Œä½ ä¸èƒ½å†ä¿®æ”¹å®ƒï¼","-1");

51 
	`ex™
();

54 
$addRow
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `{$row['addtable']}` WHERE‡id='$aid'; ");

55 
$d
 = 
Ãw
 
	`XakTagP¬£
();

56 
$d
->
	`LßdSourû
(
$addRow
['imgurls']);

57 
$abšfo
 = 
$d
->
	`G‘TagByName
('pagestyle');

58 
	`šşude
(
XAKMEMBER
."/templets/album_edit.htm");

59 
	`ex™
();

60 
	}
}

64 if(
	g$dİo¡
=='save')

66 
$sv®i
 = 
G‘CkVdV®ue
();

67 if(
´eg_m©ch
("/1/",
$§ã_gdİ’
)){

68 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

70 
Re£tVdV®ue
();

71 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

72 
ex™
();

75 
	g$cInfos
 = 
$dsql
->
G‘OÃ
("Select * From `#@__channeltype` where id='$channelid'; ");

76 
	g$maxwidth
 = 
is£t
(
$maxwidth
è&& 
is_num”ic
($maxwidth) ? $maxwidth : 800;

77 
	g$·g•iúum
 = 
is£t
(
$·g•iúum
è&& 
is_num”ic
($pagepicnum) ? $pagepicnum : 12;

78 
	g$ddmaxwidth
 = 
is£t
(
$ddmaxwidth
è&& 
is_num”ic
($ddmaxwidth) ? $ddmaxwidth : 200;

79 
	g$´ow
 = 
is£t
(
$´ow
è&& 
is_num”ic
($prow) ? $prow : 3;

80 
	g$pcŞ
 = 
is£t
(
$pcŞ
è&& 
is_num”ic
($pcol) ? $pcol : 3;

81 
	g$·ge¡yË
 = 
š_¬¿y
(
$·ge¡yË
,
¬¿y
('1','2','3')) ? $pagestyle : 2;

83 
šşude
(
XAKMEMBER
.'/inc/archives_check_edit.php');

84 
	g$imgu¾s
 = "{xak:pagestyle maxwidth='$maxwidth'…agepicnum='$pagepicnum'

85 
ddmaxwidth
='$ddmaxwidth' 
row
='$´ow' 
cŞ
='$pcŞ' 
v®ue
='$·ge¡yË'/}\
	gr
\
	gn
";

86 
	g$hasÚe
 = 
çl£
;

87 
	g$ddisfœ¡
=1;

90 if(
	g$fÜmhtml
==1)

92 
$imagebody
 = 
¡r¦ashes
($imagebody);

93 
	g$imgu¾s
 .ğ
G‘CurCÚ‹ÁAlbum
(
$imagebody
,
$cİysourû
,
$l™piúame
);

94 if(
	g$ddisfœ¡
==1 && 
$l™pic
=='' && !
em±y
(
$l™piúame
))

96 
$l™pic
 = 
$l™piúame
;

97 
	g$hasÚe
 = 
Œue
;

100 
	g$šfo
 = '';

103 
	g$i
=1;$i<=120;$i++)

106 if(
is£t
(
$
{'imgu¾'.
$i
}è|| (is£t(
$_FILES
['imgfe'.$i]['tmp_Çme']è&& 
is_u¶ßded_fe
($_FILES['imgfile'.$i]['tmp_name'])))

108 
	g$išfo
 = 
¡r_»¶aû
("'","`",
¡r¦ashes
(
$
{'imgmsg'.
$i
}));

109 if(!
is_u¶ßded_fe
(
$_FILES
['imgfe'.
$i
]['tmp_name']))

111 
	g$iu¾
 = 
¡r¦ashes
(
$
{'imgu¾'.
$i
});

114 if(
is£t
(
$
{'imgu¾'.
$i
}))

116 
	g$l™piúame
 = 
$iu¾
;

117 
	g$f’ame
 = 
$iu¾
;

120 if(
	g$·ge¡yË
 > 2)

122 
	g$l™piúame
 = 
G‘ImageM­DD
(
$f’ame
,
$ddmaxwidth
);

123 if(
	g$l™piúame
 != '')

125 
SaveU¶ßdInfo
(
$t™Ë
.' å°å›¾',
$l™piúame
,1);

136 
	g$¥¬r
 = 
A¼ay
("image/pjpeg","image/jpeg","image/gif","image/png","image/xpng","image/wbmp");

137 if(!
š_¬¿y
(
$_FILES
['imgfe'.
$i
]['ty³'],
$¥¬r
))

141 if(
is£t
(
$
{'imgu¾'.
$i
}))

143 
	g$f’ame
 = 
$
{'imgu¾'.
$i
};

147 
	g$f’ame
 = '';

149 
	g$f’ame
 = 
Memb”U¶ßds
('imgfe'.
$i
,
$f’ame
,
$cfg_ml
->
M_ID
,'image','',0,0,
çl£
);

150 if(
	g$f’ame
!='')

152 
SaveU¶ßdInfo
(
$t™Ë
,
$f’ame
,1);

154 
	g$l™piúame
 = 
$f’ame
;

157 if(
	g$·ge¡yË
 > 2)

159 
	g$l™piúame
 = 
G‘ImageM­DD
(
$f’ame
,
$ddmaxwidth
);

160 if(
	g$l™piúame
 != '')

162 
SaveU¶ßdInfo
(
$t™Ë
.' å°å›¾',
$l™piúame
,1);

166 
	g$imgfe
 = 
$cfg_ba£dœ
.
$f’ame
;

167 if(
is_fe
(
$imgfe
))

169 
	g$iu¾
 = 
$f’ame
;

170 
	g$šfo
 = '';

171 
	g$imgšfos
 = @
g‘imagesize
(
$imgfe
,
$šfo
);

172 
	g$imgu¾s
 .ğ"{xak:img ddimg='$l™piúame'ext='$išfo' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

174 if(!
	g$hasÚe
 && 
	g$l™pic
=='' && !
em±y
(
$l™piúame
))

176 
$l™pic
 = 
$l™piúame
;

177 
	g$hasÚe
 = 
Œue
;

181 
	g$imgu¾s
 = 
add¦ashes
(
$imgu¾s
);

184 
	g$šadd_f
 = '';

185 if(!
	$em±y
(
$xak_addÚf›lds
))

187 
$addÚf›lds
 = 
	`ex¶ode
(';',
$xak_addÚf›lds
);

188 if(
	`is_¬¿y
(
$addÚf›lds
))

190 
	`fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

192 if(
$v
=='')

196 
$vs
 = 
	`ex¶ode
(',',
$v
);

197 if(!
	`is£t
(
$
{
$vs
[0]}))

199 
$
{
$vs
[0]} = '';

201 
$
{
$vs
[0]} = 
	`G‘F›ldV®ueA
(${$vs[0]},$vs[1],
$aid
);

202 
$šadd_f
 .ğ','.
$vs
[0]." ='".
$
{$vs[0]}."' ";

206 ià(
	`em±y
(
$xak_f›ldshash
è|| $xak_f›ldshash !ğ
	`md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

208 
	`showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

209 
	`ex™
();

213 
$fÚt™”m
 = 
	`PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

214 ià(
$fÚt™”m
 !ğ
$šadd_f
)

216 
	`ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

217 
	`ex™
();

219 
	}
}

220 
	g$desütiÚ
 = 
HtmlR•Ïû
(
$desütiÚ
, -1);

222 if(
	g$l™pic
!=''è
$æag
 = 'p';

226 
	g$upQu”y
 = "UPDATE `#@__archives` SET

227 
ismake
='$ismake',

228 
	g¬üªk
='$arcrank',

229 
	gty³id
='$typeid',

230 
	gt™Ë
='$title',

231 
	gl™pic
='$litpic',

232 
	gdesütiÚ
='$description',

233 
	gkeywÜds
='$keywords',

234 
	gmty³
='$mtypesid',

235 
	gæag
='$flag'

236 
WHERE
 
id
='$aid' 
AND
 
mid
='$mid'; ";

237 if(!
	g$dsql
->
	$Execu‹NÚeQu”y
(
$upQu”y
))

239 
	`ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼".
$dsql
->
	`G‘E¼Ü
(),"-1");

240 
	`ex™
();

241 
	}
}

243 
	g$i¤m
 = 0;

245 if(
	g$addbË
!='')

247 
$qu”y
 = "UPDATE `$addtable`

248 
£t
 
ty³id
='$typeid',

249 
	g·ge¡yË
='$pagestyle',

250 
	gmaxwidth
 = '$maxwidth',

251 
	gddmaxwidth
 = '$ddmaxwidth',

252 
	g·g•iúum
 = '$pagepicnum',

253 
	gimgu¾s
='$imgurls',

254 
	grow
='$prow',

255 
	gcŞ
='$pcol',

256 
	gu£r
='$userip',

257 
	gi¤m
='$i¤m'{
$šadd_f
}

258 
WHERE
 
aid
='$aid'; ";

259 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

261 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addbË` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼".
$dsql
->
G‘E¼Ü
(),"javascript:;");

262 
ex™
();

266 
UpIndexKey
(
$aid
, 
$¬üªk
, 
$ty³id
, 
$sÜŒªk
, 
$gs
);

267 
	g$¬tU¾
 = 
MakeA¹
(
$aid
, 
TRUE
);

268 if(
	g$¬tU¾
==''è
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$aid";

273 
	g$msg
 = "ã€€ã€€è¯·é€‰æ‹©ä½ çš„åç»­æ“ä½œï¼š

274 <
a
 
h»f
='®bum_add.php?cid=$ty³id'><
u
>å‘å¸ƒæ–°å›¾é›†</u></a>

275 &
nb¥
;&
	gnb¥
;

276 <
a
 
	gh»f
='¬chives_do.php?chªÃlid=$chªÃlid&aid=".$aid."&dİo¡ód™'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

277 &
nb¥
;&
	gnb¥
;

278 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹å›¾é›†</u></a>

279 &
nb¥
;&
	gnb¥
;

280 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid=$chªÃlid'><
u
>ç®¡ç†å›¾é›†</u></a> ";

282 
$wšt™Ë
 = "æˆåŠŸæ›´æ”¹å›¾é›†ï¼";

283 
	g$wecome_šfo
 = "å›¾é›†ç®¡ç†::æ›´æ”¹å›¾é›†";

284 
	g$wš
 = 
Ãw
 
OxWšdow
();

285 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹å›¾é›†ï¼š");

286 
	g$wš
->
AddMsgI‹m
(
$msg
);

287 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

288 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\archives_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

9 
»quœe_Úû
(
XAKINC
."/userlogin.class.php");

10 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

12 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

13 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 1;

14 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 
	g$m’uty³
 = 'content';

21 if(
	$em±y
(
$dİo¡
))

23 
$cInfos
 = 
$dsql
->
	`G‘OÃ
("Select * From `#@__channeltype` where id='$channelid'; ");

24 if(!
	`is_¬¿y
(
$cInfos
))

26 
	`ShowMsg
('æ¨¡å‹ä¸å­˜åœ¨', '-1');

27 
	`ex™
();

31 if(
$cInfos
['sendrank']>0 || $cInfos['usertype']!='')

33 
	`CheckRªk
(0,0);

37 if(
$cInfos
['£nd¿nk'] > 
$cfg_ml
->
M_Rªk
)

39 
$row
 = 
$dsql
->
	`G‘OÃ
("S–eù memb”ÇmFrom `#@__¬üªk` wh”¿nk='".
$cInfos
['sendrank']."' ");

40 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$row
['membername']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

41 
	`ex™
();

43 if(
$cInfos
['u£¹y³']!='' && $cInfos['u£¹y³'] !ğ
$cfg_ml
->
M_MbTy³
)

45 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$cInfos
['usertype']."å¸å·]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

46 
	`ex™
();

48 
	`šşude
(
XAKMEMBER
."/templets/archives_add.htm");

49 
	`ex™
();

50 
	}
}

54 if(
	g$dİo¡
=='save')

56 
šşude
(
dœÇme
(
__FILE__
).'/inc/archives_check.php');

58 
	g$šadd_f
 = 
$šadd_v
 = '';

59 if(!
em±y
(
$xak_addÚf›lds
))

61 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

62 
	g$šadd_f
 = '';

63 
	g$šadd_v
 = '';

64 if(
is_¬¿y
(
$addÚf›lds
))

66 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

68 if(
	g$v
=='')

72 
	g$vs
 = 
ex¶ode
(',',
$v
);

73 if(!
is£t
(
$
{
$vs
[0]}))

75 
	g$
{
	g$vs
[0]} = '';

79 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

81 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,$vs[1]);

84 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],0);

86 
	g$šadd_f
 .ğ','.
$vs
[0];

87 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

91 ià(
em±y
(
$xak_f›ldshash
è|| 
	g$xak_f›ldshash
 !ğ
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

93 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

94 
ex™
();

98 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

99 ià(
	g$fÚt™”m
 !ğ
$šadd_f
)

101 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

102 
ex™
();

107 if(
	g$l™pic
!=''è
$æag
 = 'p';

110 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$chªÃlid
,
$£ndd©e
,
$mid
);

111 if(
em±y
(
$¬cID
))

113 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

114 
ex™
();

118 
	g$šQu”y
 = "INSERT INTO `#@__archives`(id,typeid,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,

119 
cŞÜ
,
	gwr™”
,
	gsourû
,
	gl™pic
,
	gpubd©e
,
	g£ndd©e
,
	gmid
,
	gdesütiÚ
,
	gkeywÜds
,
	gmty³
)

120 
VALUES
 ('$arcID','$typeid','$sortrank','$flag','$ismake','$channelid','$arcrank','0','$money','$title','$shorttitle',

122 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

124 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

125 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arctiny` where id='$arcID' ");

126 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨ `#@__archives` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚","javascript:;");

127 
ex™
();

131 
	g$addbË
 = 
Œim
(
$cInfos
['addtable']);

132 if(
em±y
(
$addbË
))

134 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__archives` where id='$arcID'");

135 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arctiny` where id='$arcID'");

136 
ShowMsg
("æ²¡æ‰¾åˆ°å½“å‰æ¨¡å‹[{$channelid}]çš„ä¸»è¡¨ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œã€‚","javascript:;");

137 
ex™
();

141 
	g$šqu”y
 = "INSERT INTO `{$addtable}`(aid,typeid,userip,redirecturl,templet{$inadd_f}) Values('$arcID','$typeid','$userip','',''{$inadd_v})";

142 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
))

144 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

145 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__archives` where id='$arcID'");

146 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arctiny` where id='$arcID'");

147 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addtable}` æ—¶å‡ºé”™<br>error:{$gerr}ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼","javascript:;");

148 
ex™
();

153 
	g$dsql
->
Execu‹NÚeQu”y
("Upd©`#@__memb”_li¡` s‘ scÜes=scÜes+{$cfg_£nd¬c_scÜes} wh”mid='".
$cfg_ml
->
M_ID
."' ; ");

155 
couÁArchives
(
$chªÃlid
);

158 
In£¹Tags
(
$gs
,
$¬cID
);

159 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
,
Œue
);

160 if(
	g$¬tU¾
=='')

162 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

166 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/api/uc.func.php')

169 
	g$ãed
['icon'] = 'thread';

170 
	g$ãed
['title_template'] = '<b>{username} åœ¨ç½‘ç«™å‘å¸ƒäº†ä¸€ç¯‡å†…å®¹</b>';

171 
	g$ãed
['t™Ë_d©a'] = 
¬¿y
('u£ºame' => 
$cfg_ml
->
M_U£rName
);

172 
	g$ãed
['body_template'] = '<b>{subject}</b><br>{message}';

173 
	g$u¾
 = !
¡r¡r
(
$¬tU¾
,'h‰p://'è? (
	g$cfg_ba£ho¡
.
	g$¬tU¾
) : $artUrl;

174 
	g$ãed
['body_d©a'] = 
¬¿y
('subjeù' => "<¨h»f=\"".
$u¾
."\">$t™Ë</a>", 'mes§ge' => 
ú_sub¡r
(
¡r_gs
(
´eg_»¶aû
("/\[.+?\]/is", '', 
$desütiÚ
)), 150));

175 
	g$ãed
['images'][] = 
¬¿y
('u¾' => 
$cfg_ba£ho¡
.'/images/scores.gif', 'link'=> $cfg_basehost);

176 
uc_ãed_nÙe
(
$cfg_ml
->
M_LogšID
,
$ãed
);

178 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `scÜes`,`u£rid` FROM `#@__memb”_li¡` WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

179 
uc_üed™_nÙe
(
$row
['u£rid'],
$cfg_£nd¬c_scÜes
);

181 #/
a
}}

184 
	g$cfg_ml
->
RecÜdF“ds
('add', 
$t™Ë
, 
$desütiÚ
, 
$¬cID
);

186 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

189 
	g$msg
 = "

191 <
a
 
h»f
='¬chives_add.php?cid=$ty³id&chªÃlid=$chªÃlid'><
u
>ç»§ç»­å‘å¸ƒå†…å®¹</u></a>

192 &
nb¥
;&
	gnb¥
;

193 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹å†…å®¹</u></a>

194 &
nb¥
;&
	gnb¥
;

195 <
a
 
	gh»f
='¬chives_ed™.php?chªÃlid=$chªÃlid&aid=$¬cID'><
u
>æ›´æ”¹å†…å®¹</u></a>

196 &
nb¥
;&
	gnb¥
;

197 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid={$chªÃlid}'><
u
>å·²å‘å¸ƒå†…å®¹ç®¡ç†</u></a>

199 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒå†…å®¹ï¼";

200 
	g$wecome_šfo
 = "å†…å®¹ç®¡ç†::å‘å¸ƒå†…å®¹";

201 
	g$wš
 = 
Ãw
 
OxWšdow
();

202 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒå†…å®¹ï¼š");

203 
	g$wš
->
AddMsgI‹m
(
$msg
);

204 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

205 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\archives_do.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

10 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

11 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 1;

17 if(
	g$dİo¡
=="delStow")

19 
CheckRªk
(0,0);

20 
	g$ty³
=
em±y
(
$ty³
)? 'sys' : 
Œim
($type);

21 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? "mystow.php" : $_COOKIE['ENV_GOBACK_URL'];

22 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_¡ow` WHERE‡id='$aid' AND mid='".
$cfg_ml
->
M_ID
."' ANDype='$type';");

24 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*èAS‚um FROM `#@__memb”_¡ow` WHERE `mid`='".
$cfg_ml
->
M_ID
."' ");

25 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_tj` SET `¡ow`='$row[nums]' WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

27 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€æ¡æ”¶è—è®°å½•ï¼",
$ENV_GOBACK_URL
);

28 
ex™
();

35 if(
	g$dİo¡
=="addArc")

37 if(
$chªÃlid
==1)

39 
$addcÚ
 = '¬tişe_add.php?chªÃlid='.
$chªÃlid
;

41 if(
	g$chªÃlid
==2)

43 
$addcÚ
 = '®bum_add.php?chªÃlid='.
$chªÃlid
;

45 if(
	g$chªÃlid
==3)

47 
$addcÚ
 = 'soá_add.php?chªÃlid='.
$chªÃlid
;

51 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT useraddcon FROM `#@__channeltype` WHERE id='$channelid' ");

52 if(!
is_¬¿y
(
$row
))

54 
ShowMsg
("æ¨¡å‹å‚æ•°é”™è¯¯!","-1");

55 
ex™
();

57 
	g$addcÚ
 = 
$row
['useraddcon'];

58 if(
Œim
(
$addcÚ
)=='')

60 
$addcÚ
 = 'archives_add.php';

62 
	g$addcÚ
 = 
$addcÚ
."?channelid=$channelid";

64 
h—d”
("Location:$addcon");

65 
ex™
();

72 if(
	g$dİo¡
=="edit")

74 
CheckRªk
(0,0);

75 if(
	g$chªÃlid
==1)

77 
$ed™
 = '¬tişe_ed™.php?chªÃlid='.
$chªÃlid
;

79 if(
	g$chªÃlid
==2)

81 
$ed™
 = '®bum_ed™.php?chªÃlid='.
$chªÃlid
;

83 if(
	g$chªÃlid
==3)

85 
$ed™
 = 'soá_ed™.php?chªÃlid='.
$chªÃlid
;

89 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT usereditcon FROM `#@__channeltype` WHERE id='$channelid' ");

90 if(!
is_¬¿y
(
$row
))

92 
ShowMsg
("å‚æ•°é”™è¯¯!","-1");

93 
ex™
();

95 
	g$ed™
 = 
$row
['usereditcon'];

96 if(
Œim
(
$ed™
)=='')

98 
$ed™
 = 'archives_edit.php';

100 
	g$ed™
 = 
$ed™
."?channelid=$channelid";

102 
h—d”
("Location:$edit"."&aid=$aid");

103 
ex™
();

110 if(
	g$dİo¡
=="delArc")

112 
CheckRªk
(0,0);

113 
šşude_Úû
(
XAKMEMBER
."/inc/inc_batchup.php");

114 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? 'content_list.php?channelid=' : $_COOKIE['ENV_GOBACK_URL'];

117 
	g$equ”y
 = "SELECT‡rc.channel,arc.senddate,arc.arcrank,ch.maintable,ch.addtable,ch.issystem,ch.arcsta FROM `#@__arctiny`‡rc

118 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl
 
WHERE
‡rc.id='$aid' ";

120 
$row
 = 
$dsql
->
G‘OÃ
(
$equ”y
);

121 if(!
is_¬¿y
(
$row
))

123 
ShowMsg
("ä½ æ²¡æœ‰æƒé™åˆ é™¤è¿™ç¯‡æ–‡æ¡£ï¼","-1");

124 
ex™
();

126 if(
Œim
(
$row
['maintable'])=='') $row['maintable'] = '#@__archives';

127 if(
	g$row
['issystem']==-1)

129 
$equ”y
 = "SELECT mid FROM `{$row['addbË']}` WHERE‡id='$aid' AND mid='".
$cfg_ml
->
M_ID
."' ";

133 
	g$equ”y
 = "SELECT mid,l™piøäom `{$row['mašbË']}` WHERE id='$aid' AND mid='".
$cfg_ml
->
M_ID
."' ";

135 
	g$¬r
 = 
$dsql
->
G‘OÃ
(
$equ”y
);

136 if(!
is_¬¿y
(
$¬r
))

138 
ShowMsg
("ä½ æ²¡æœ‰æƒé™åˆ é™¤è¿™ç¯‡æ–‡æ¡£ï¼","-1");

139 
ex™
();

142 if(
	g$row
['arcrank']>=0)

144 
$dtime
 = 
time
();

145 
	g$maxtime
 = 
$cfg_mb_ed™day
 * 24 *3600;

146 if(
	g$dtime
 - 
	g$row
['£ndd©e'] > 
	g$maxtime
)

148 
ShowMsg
("è¿™ç¯‡æ–‡æ¡£å·²ç»é”å®šï¼Œä½ ä¸èƒ½å†åˆ é™¤å®ƒï¼","-1");

149 
ex™
();

153 
	g$chªÃlid
 = 
$row
['channel'];

154 
	g$row
['l™pic'] = (
is£t
(
$¬r
['litpic']) ? $arr['litpic'] : '');

157 if(
	g$row
['issy¡em']!=-1è
$rs
 = 
D–Arc
(
$aid
);

158 
	g$rs
 = 
D–ArcSg
(
$aid
);

161 if(
Œim
(
$row
['l™pic'])!='' && 
´eg_m©ch
("#^".
$cfg_u£r_dœ
."/{$cfg_ml->M_ID}#", $row['litpic']))

163 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__uploads` WHERE url LIKE '{$row['litpic']}' AND mid='{$cfg_ml->M_ID}' ");

164 @
uÆšk
(
$cfg_ba£dœ
.
$row
['litpic']);

167 if(
	g$ENV_GOBACK_URL
=='content_list.php?channelid=')

169 
$ENV_GOBACK_URL
 = $ENV_GOBACK_URL.
$chªÃlid
;

171 if(
	g$rs
)

174 
couÁArchives
(
$chªÃlid
);

176 
	g$dsql
->
Execu‹NÚeQu”y
("Upd©`#@__memb”_li¡` s‘ scÜes=scÜes-{$cfg_£nd¬c_scÜes} wh”mid='".
$cfg_ml
->
M_ID
."' And (scores-{$cfg_sendarc_scores}) > 0; ");

177 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ç¯‡æ–‡æ¡£ï¼",
$ENV_GOBACK_URL
);

178 
ex™
();

182 
ShowMsg
("åˆ é™¤æ–‡æ¡£å¤±è´¥ï¼",
$ENV_GOBACK_URL
);

183 
ex™
();

185 
ex™
();

192 if(
	g$dİo¡
=="viewArchives")

194 
CheckRªk
(0,0);

195 if(
	g$ty³
==""){

196 
h—d”
("loÿtiÚ:".
$cfg_phpu¾
."/v›w.php?aid=".
$aid
);

198 
h—d”
("loÿtiÚ:/book/book.php?bid=".
$aid
);

206 if(
	g$dİo¡
=="delUploads")

208 
CheckRªk
(0,0);

209 if(
em±y
(
$ids
))

211 
	g$ids
 = '';

214 
	g$tj
 = 0;

215 if(
	g$ids
=='')

217 
$¬ow
 = 
$dsql
->
G‘OÃ
("SELECT url,mid FROM `#@__uploads` WHERE‡id='$aid'; ");

218 if(
is_¬¿y
(
$¬ow
è&& 
	g$¬ow
['mid']==
$cfg_ml
->
M_ID
)

220 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__uploads` WHERE‡id='$aid'; ");

221 if(
fe_exi¡s
(
$cfg_ba£dœ
.
$¬ow
['url']))

223 @
uÆšk
(
$cfg_ba£dœ
.
$¬ow
['url']);

226 
	g$tj
++;

230 
	g$ids
 = 
ex¶ode
(',',
$ids
);

231 
fÜ—ch
(
$ids
 
as
 
$aid
)

233 
	g$aid
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$aid
);

234 
	g$¬ow
 = 
$dsql
->
G‘OÃ
("SELECT url,mid From #@__uploads WHERE‡id='$aid'; ");

235 if(
is_¬¿y
(
$¬ow
è&& 
	g$¬ow
['mid']==
$cfg_ml
->
M_ID
)

237 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__uploads` WHERE‡id='$aid'; ");

238 
	g$tj
++;

239 if(
fe_exi¡s
(
$cfg_ba£dœ
.
$¬ow
['url']))

241 @
uÆšk
(
$cfg_ba£dœ
.
$¬ow
['url']);

246 
ShowMsg
("æˆåŠŸåˆ é™¤ $tj ä¸ªé™„ä»¶ï¼",
$ENV_GOBACK_URL
);

247 
ex™
();

	@E:\web\weixun\user\archives_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

12 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

13 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 1;

14 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 
	g$m’uty³
 = 'content';

21 if(
	$em±y
(
$dİo¡
))

24 
$¬cQu”y
 = "SELECT‡rc.*,ch.addtable,ch.fieldset,arc.mtype‡s mtypeid,ch.arcsta

25 
FROM
 `#@
__¬chives
` 
¬c
 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
÷rc.
chªÃl


26 
WHERE
 
¬c
.
id
='$aid' 
And
‡rc.
mid
='".$cfg_ml->M_ID."'; ";

27 
$row
 = 
$dsql
->
	`G‘OÃ
(
$¬cQu”y
);

28 if(!
	`is_¬¿y
(
$row
))

30 
	`ShowMsg
("è¯»å–æ–‡æ¡£ä¿¡æ¯å‡ºé”™!","-1");

31 
	`ex™
();

33 if(
$row
['arcrank']>=0)

35 
$dtime
 = 
	`time
();

36 
$maxtime
 = 
$cfg_mb_ed™day
 * 24 *3600;

37 if(
$dtime
 - 
$row
['£ndd©e'] > 
$maxtime
)

39 
	`ShowMsg
("è¿™ç¯‡æ–‡æ¡£å·²ç»é”å®šï¼Œä½ ä¸èƒ½å†ä¿®æ”¹å®ƒï¼","-1");

40 
	`ex™
();

43 
$addRow
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `{$row['addtable']}` WHERE‡id='$aid'; ");

44 
$cInfos
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='{$row['channel']}'; ");

45 
	`šşude
(
XAKMEMBER
."/templets/archives_edit.htm");

46 
	`ex™
();

47 
	}
}

52 if(
	g$dİo¡
=='save')

54 
šşude
(
XAKMEMBER
.'/inc/archives_check_edit.php');

57 
	g$šadd_f
 = 
$šadd_m
 = '';

58 if(!
em±y
(
$xak_addÚf›lds
))

60 
	g$addÚf›lds
 = 
ex¶ode
(';', 
$xak_addÚf›lds
);

61 if(
is_¬¿y
(
$addÚf›lds
))

63 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

65 if(
	g$v
=='')

69 
	g$vs
 = 
ex¶ode
(',',
$v
);

70 if(!
is£t
(
$
{
$vs
[0]}))

72 
	g$
{
	g$vs
[0]} = '';

76 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

78 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]}, 
$desütiÚ
, $vs[1]);

81 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]}, $vs[1], 
$aid
);

82 
	g$šadd_m
 .ğ','.
$vs
[0];

83 
	g$šadd_f
 .ğ','.
$vs
[0]." ='".
$
{$vs[0]}."' ";

87 ià(
em±y
(
$idhash
è|| 
	g$idhash
 !ğ
md5
(
$aid
.
$cfg_cook›_’code
))

89 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

90 
ex™
();

94 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

95 ià(
	g$fÚt™”m
 !ğ
$šadd_m
)

97 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

98 
ex™
();

103 if(
	g$l™pic
!=''è
$æag
 = 'p';

107 
	g$upQu”y
 = "UPDATE `#@__archives` SET

108 
ismake
='$ismake',

109 
	g¬üªk
='$arcrank',

110 
	gty³id
='$typeid',

111 
	gt™Ë
='$title',

112 
	gl™pic
='$litpic',

113 
	gdesütiÚ
='$description',

114 
	gkeywÜds
='$keywords',

115 
	gmty³
 = '$mtypesid',

116 
	gæag
='$flag'

117 
WHERE
 
id
='$aid' 
And
 
mid
='$mid'; ";

119 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$upQu”y
))

121 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼".
$dsql
->
G‘E¼Ü
(),"-1");

122 
ex™
();

125 if(
	g$addbË
!='')

127 
$upQu”y
 = "UPDATE `$addtable` SETypeid='$typeid'{$inadd_f}, userip='$userip' WHERE‡id='$aid' ";

128 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$upQu”y
))

130 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addtable` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼","javascript:;");

131 
ex™
();

134 
	g$¬üªk
 = 
em±y
(
$¬üªk
)? 0 : $arcrank;

135 
	g$sÜŒªk
 = 
em±y
(
$sÜŒªk
)? 0 : $sortrank;

136 
UpIndexKey
(
$aid
, 
$¬üªk
, 
$ty³id
, 
$sÜŒªk
, 
$gs
);

137 
	g$¬tU¾
 = 
MakeA¹
(
$aid
, 
TRUE
);

138 if(
	g$¬tU¾
==''è
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$aid";

141 
	g$msg
 = "ã€€ã€€è¯·é€‰æ‹©ä½ çš„åç»­æ“ä½œï¼š

142 <
a
 
h»f
='¬chives_add.php?cid=$ty³id&chªÃlid=$chªÃlid'><
u
>å‘å¸ƒæ–°å†…å®¹</u></a>

143 &
nb¥
;&
	gnb¥
;

144 <
a
 
	gh»f
='¬chives_ed™.php?chªÃlid=$chªÃlid&aid=".$aid."'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

145 &
nb¥
;&
	gnb¥
;

146 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹å†…å®¹</u></a>

147 &
nb¥
;&
	gnb¥
;

148 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid=$chªÃlid'><
u
>ç®¡ç†å†…å®¹</u></a>

150 
$wšt™Ë
 = "æˆåŠŸæ›´æ”¹å†…å®¹ï¼";

151 
	g$wecome_šfo
 = "å†…å®¹ç®¡ç†::æ›´æ”¹å†…å®¹";

152 
	g$wš
 = 
Ãw
 
OxWšdow
();

153 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹å†…å®¹ï¼š");

154 
	g$wš
->
AddMsgI‹m
(
$msg
);

155 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

156 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\archives_sg_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

9 
»quœe_Úû
(
XAKINC
."/userlogin.class.php");

10 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

11 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/inc/inc_catalog_options.php");

12 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/inc/inc_archives_functions.php");

13 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 1;

14 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 
	g$m’uty³
 = 'content';

21 if(
	$em±y
(
$dİo¡
))

23 
$cInfos
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$channelid'; ");

24 if(!
	`is_¬¿y
(
$cInfos
))

26 
	`ShowMsg
('æ¨¡å‹ä¸å­˜åœ¨', '-1');

27 
	`ex™
();

31 if(
$cInfos
['sendrank']>0 || $cInfos['usertype']!='')

33 
	`CheckRªk
(0,0);

37 if(
$cInfos
['£nd¿nk'] > 
$cfg_ml
->
M_Rªk
)

39 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT memb”ÇmFROM `#@__¬üªk` WHERE„ªk='".
$cInfos
['sendrank']."' ");

40 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$row
['membername']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

41 
	`ex™
();

43 if(
$cInfos
['u£¹y³']!='' && $cInfos['u£¹y³'] !ğ
$cfg_ml
->
M_MbTy³
)

45 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$cInfos
['usertype']."å¸å·]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

46 
	`ex™
();

48 
	`šşude
(
XAKMEMBER
."/templets/archives_sg_add.htm");

49 
	`ex™
();

50 
	}
}

54 if(
	g$dİo¡
=='save')

56 
šşude_Úû
(
XAKINC
."/image.func.php");

57 
šşude_Úû
(
XAKINC
."/oxwindow.class.php");

58 
	g$sv®i
 = 
G‘CkVdV®ue
();

59 if(
´eg_m©ch
("/3/", 
$§ã_gdİ’
)){

60 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

62 
Re£tVdV®ue
();

63 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

64 
ex™
();

69 
	g$çqkey
 = 
is£t
(
$çqkey
è&& 
is_num”ic
($faqkey) ? $faqkey : 0;

70 if(
	g$§ã_çq_£nd
 == '1')

72 if(
$§ãçqs
[
$çqkey
]['ªsw”'] !ğ
$§ãªsw”
 || $safeanswer=='')

74 
ShowMsg
('éªŒè¯é—®é¢˜ç­”æ¡ˆé”™è¯¯', '-1');

75 
ex™
();

79 
	g$æag
 = '';

80 
	g$autokey
 = 
$»mÙe
 = 
$d–lšk
 = 
$autŞ™pic
 = 0;

81 
	g$u£r
 = 
G‘IP
();

83 if(
	g$ty³id
==0)

85 
ShowMsg
('è¯·æŒ‡å®šæ–‡æ¡£éš¶å±çš„æ ç›®ï¼','-1');

86 
ex™
();

89 
	g$qu”y
 = "SELECTp.ispart,tp.channeltype,tp.issend,ch.issend AS cissend,ch.sendrank,ch.arcsta,ch.addtable,ch.fieldset,ch.usertype

90 
FROM
 `#@
__¬ùy³
` 

 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
ñp.
chªÃÉy³
 
WHERE
p.id='$typeid' ";

91 
$cInfos
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

94 if(
	g$cInfos
['is£nd']!=1 || 
$cInfos
['i¥¬t']!=0 || $cInfos['chªÃÉy³']!=
$chªÃlid
 || $cInfos['cissend']!=1)

96 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸æ”¯æŒæŠ•ç¨¿ï¼","-1");

97 
ex™
();

101 if(
	g$cInfos
['£nd¿nk'] > 
	g$cfg_ml
->
	gM_Rªk
 )

103 
	g$row
 = 
$dsql
->
G‘OÃ
("S–eù memb”ÇmFrom #@__¬üªk wh”¿nk='".
$cInfos
['sendrank']."' ");

104 
ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$row
['membername']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

105 
ex™
();

108 if(
	g$cInfos
['u£¹y³'] !='' && 
$cInfos
['u£¹y³'] !ğ
$cfg_ml
->
M_MbTy³
)

110 
ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$cInfos
['usertype']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

111 
ex™
();

115 if(
	g$cInfos
['arcsta']==0)

117 
$¬üªk
 = 0;

119 if(
	g$cInfos
['arcsta']==1)

121 
$¬üªk
 = 0;

125 
	g$¬üªk
 = -1;

129 
	g$sÜŒªk
 = 
$£ndd©e
 = 
$pubd©e
 = 
time
();

130 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
,1),
$cfg_t™Ë_maxËn
);

131 
	g$mid
 = 
$cfg_ml
->
M_ID
;

132 
	g$desütiÚ
=
em±y
(
$desütiÚ
)? "" : $description;

135 
	g$l™pic
 = 
Memb”U¶ßds
('l™pic','',
$cfg_ml
->
M_ID
,'image','',
$cfg_ddimg_width
,
$cfg_ddimg_height
,
çl£
);

136 if(
	g$l™pic
!=''è
SaveU¶ßdInfo
(
$t™Ë
,
$l™pic
,1);

139 
	g$šadd_f
 = 
$šadd_v
 = '';

140 if(!
em±y
(
$xak_addÚf›lds
))

142 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

143 
	g$šadd_f
 = '';

144 
	g$šadd_v
 = '';

145 if(
is_¬¿y
(
$addÚf›lds
))

147 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

149 if(
	g$v
=='')

153 
	g$vs
 = 
ex¶ode
(',',
$v
);

154 if(!
is£t
(
$
{
$vs
[0]}))

156 
	g$
{
	g$vs
[0]} = '';

160 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

162 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,$vs[1]);

165 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],0);

167 
	g$šadd_f
 .ğ',`'.
$vs
[0].'`';

168 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

172 ià(
em±y
(
$xak_f›ldshash
è|| 
	g$xak_f›ldshash
 !ğ
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

174 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

175 
ex™
();

179 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

180 ià(
	g$fÚt™”m
 !ğ
¡r_»¶aû
('`', '', 
$šadd_f
))

182 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

183 
ex™
();

188 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$chªÃlid
,
$£ndd©e
,
$mid
);

189 if(
em±y
(
$¬cID
))

191 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

192 
ex™
();

196 
	g$addbË
 = 
Œim
(
$cInfos
['addtable']);

197 if(
em±y
(
$addbË
))

199 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arctiny` where id='$arcID'");

200 
ShowMsg
("æ²¡æ‰¾åˆ°å½“å‰æ¨¡å‹[{$channelid}]çš„ä¸»è¡¨ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œã€‚","javascript:;");

201 
ex™
();

205 
	g$šqu”y
 = "INSERT INTO `{$addtable}`(aid,typeid,arcrank,mid,channel,title,senddate,litpic,userip{$inadd_f}) Values('$arcID','$typeid','$arcrank','$mid','$channelid','$title','$senddate','$litpic','$userip'{$inadd_v})";

206 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
))

208 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

209 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arctiny` where id='$arcID'");

210 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addtable}` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼","javascript:;");

211 
ex™
();

216 
	g$dsql
->
Execu‹NÚeQu”y
("Upd©`#@__memb”_li¡` s‘ scÜes=scÜes+{$cfg_£nd¬c_scÜes} wh”mid='".
$cfg_ml
->
M_ID
."' ; ");

219 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
,
Œue
);

220 if(
	g$¬tU¾
==''è
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

223 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/api/uc.func.php')

226 
	g$ãed
['icon'] = 'thread';

227 
	g$ãed
['title_template'] = '<b>{username} åœ¨ç½‘ç«™å‘å¸ƒäº†ä¸€ç¯‡å†…å®¹</b>';

228 
	g$ãed
['t™Ë_d©a'] = 
¬¿y
('u£ºame' => 
$cfg_ml
->
M_U£rName
);

229 
	g$ãed
['body_template'] = '<b>{subject}</b><br>{message}';

230 
	g$u¾
 = !
¡r¡r
(
$¬tU¾
,'h‰p://'è? (
	g$cfg_ba£ho¡
.
	g$¬tU¾
) : $artUrl;

231 
	g$ãed
['body_d©a'] = 
¬¿y
('subjeù' => "<¨h»f=\"".
$u¾
."\">$t™Ë</a>", 'mes§ge' => 
ú_sub¡r
(
¡r_gs
(
´eg_»¶aû
("/\[.+?\]/is", '', 
$desütiÚ
)), 150));

232 
	g$ãed
['images'][] = 
¬¿y
('u¾' => 
$cfg_ba£ho¡
.'/images/scores.gif', 'link'=> $cfg_basehost);

233 
uc_ãed_nÙe
(
$cfg_ml
->
M_LogšID
,
$ãed
);

235 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `scÜes`,`u£rid` FROM `#@__memb”_li¡` WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

236 
uc_üed™_nÙe
(
$row
['u£rid'],
$cfg_£nd¬c_scÜes
);

238 #/
a
}}

241 
	g$cfg_ml
->
RecÜdF“ds
('add', 
$t™Ë
, 
$desütiÚ
, 
$¬cID
);

243 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

246 
	g$msg
 = "

248 <
a
 
h»f
='¬chives_sg_add.php?chªÃlid=$chªÃlid'><
u
>ç»§ç»­å‘å¸ƒå†…å®¹</u></a>

249 &
nb¥
;&
	gnb¥
;

250 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹å†…å®¹</u></a>

251 &
nb¥
;&
	gnb¥
;

252 <
a
 
	gh»f
='¬chives_sg_ed™.php?chªÃlid=$chªÃlid&aid=$¬cID'><
u
>æ›´æ”¹å†…å®¹</u></a>

253 &
nb¥
;&
	gnb¥
;

254 <
a
 
	gh»f
='cÚ‹Á_sg_li¡.php?chªÃlid={$chªÃlid}'><
u
>å·²å‘å¸ƒå†…å®¹ç®¡ç†</u></a>

256 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒå†…å®¹ï¼";

257 
	g$wecome_šfo
 = "å†…å®¹ç®¡ç†::å‘å¸ƒå†…å®¹";

258 
	g$wš
 = 
Ãw
 
OxWšdow
();

259 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒå†…å®¹ï¼š");

260 
	g$wš
->
AddMsgI‹m
(
$msg
);

261 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

262 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\archives_sg_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

12 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

13 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 1;

14 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 
	g$m’uty³
 = 'content';

21 if(
	$em±y
(
$dİo¡
))

24 
$¬cQu”y
 = "SELECT ch.*,arc.* FROM `#@__arctiny`‡rc

25 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl
 
WHERE
‡rc.id='$aid' ";

26 
$cInfos
 = 
$dsql
->
	`G‘OÃ
(
$¬cQu”y
);

27 if(!
	`is_¬¿y
(
$cInfos
))

29 
	`ShowMsg
("è¯»å–æ–‡æ¡£ä¿¡æ¯å‡ºé”™!","-1");

30 
	`ex™
();

32 
$addRow
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `{$cInfos['addtable']}` WHERE‡id='$aid'; ");

33 if(
$addRow
['mid']!=
$cfg_ml
->
M_ID
)

35 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ æ²¡æƒé™æ“ä½œæ­¤æ–‡æ¡£ï¼","-1");

36 
	`ex™
();

38 
$addRow
['id'] = $addRow['aid'];

39 
	`šşude
(
XAKMEMBER
."/templets/archives_sg_edit.htm");

40 
	`ex™
();

41 
	}
}

46 if(
	g$dİo¡
=='save')

49 
»quœe_Úû
(
XAKINC
."/image.func.php");

50 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

51 
	g$æag
 = '';

52 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

53 
	g$u£r
 = 
G‘IP
();

55 
	g$sv®i
 = 
G‘CkVdV®ue
();

56 if(
´eg_m©ch
("/3/",
$§ã_gdİ’
)){

57 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

59 
Re£tVdV®ue
();

60 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

61 
ex™
();

65 if(
	g$ty³id
==0)

67 
ShowMsg
('è¯·æŒ‡å®šæ–‡æ¡£éš¶å±çš„æ ç›®ï¼','-1');

68 
ex™
();

70 
	g$qu”y
 = "SELECTp.ispart,tp.channeltype,tp.issend,ch.issend AS cissend,ch.sendrank,ch.arcsta,ch.addtable,ch.fieldset,ch.usertype

71 
FROM
 `#@
__¬ùy³
` 

 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
ñp.
chªÃÉy³
 
WHERE
p.id='$typeid' ";

72 
$cInfos
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

73 
	g$addbË
 = 
$cInfos
['addtable'];

76 if(
	g$cInfos
['is£nd']!=1 || 
$cInfos
['i¥¬t']!=0|| $cInfos['chªÃÉy³']!=
$chªÃlid
 || $cInfos['cissend']!=1)

78 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸æ”¯æŒæŠ•ç¨¿ï¼","-1");

79 
ex™
();

83 if(
	g$cInfos
['arcsta']==0)

85 
$¬üªk
 = 0;

87 if(
	g$cInfos
['arcsta']==1)

89 
$¬üªk
 = 0;

93 
	g$¬üªk
 = -1;

97 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
, 1), 
$cfg_t™Ë_maxËn
);

98 
	g$mid
 = 
$cfg_ml
->
M_ID
;

101 
	g$l™pic
 = 
Memb”U¶ßds
('l™pic', 
$Şdl™pic
, 
$mid
, 'image', '', 
$cfg_ddimg_width
, 
$cfg_ddimg_height
, 
FALSE
);

102 if(
	g$l™pic
!=''è
SaveU¶ßdInfo
(
$t™Ë
, 
$l™pic
, 1);

103 
	g$l™pic
 =
$Şdl™pic
;

106 
	g$šadd_f
 = 
$šadd_m
 = '';

107 if(!
em±y
(
$xak_addÚf›lds
))

109 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

110 if(
is_¬¿y
(
$addÚf›lds
))

112 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

114 if(
	g$v
=='')

118 
	g$vs
 = 
ex¶ode
(',',
$v
);

119 if(!
is£t
(
$
{
$vs
[0]}))

121 
	g$
{
	g$vs
[0]} = '';

125 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

127 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,$vs[1]);

130 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$aid
);

132 
	g$šadd_f
 .ğ',`'.
$vs
[0]."` ='".
$
{$vs[0]}."' ";

133 
	g$šadd_m
 .ğ','.
$vs
[0];

136 ià(
em±y
(
$idhash
è|| 
	g$idhash
 !ğ
md5
(
$aid
.
$cfg_cook›_’code
))

138 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

139 
ex™
();

143 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

144 ià(
	g$fÚt™”m
 !ğ
$šadd_m
)

146 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

147 
ex™
();

151 if(
	g$addbË
!='')

153 
$upQu”y
 = "UPDATE `$addtable` SET `title`='$title',`typeid`='$typeid',`arcrank`='$arcrank',litpic='$litpic',userip='$userip'{$inadd_f} WHERE‡id='$aid' ";

154 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$upQu”y
))

156 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addtable` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼","javascript:;");

157 
ex™
();

161 
UpIndexKey
(
$aid
,0,
$ty³id
,
$sÜŒªk
,'');

162 
	g$¬tU¾
 = 
MakeA¹
(
$aid
,
Œue
);

164 if(
	g$¬tU¾
==''è
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$aid";

167 
	g$msg
 = "ã€€ã€€è¯·é€‰æ‹©ä½ çš„åç»­æ“ä½œï¼š

168 <
a
 
h»f
='¬chives_sg_add.php?cid=$ty³id'><
u
>å‘å¸ƒæ–°å†…å®¹</u></a>

169 &
nb¥
;&
	gnb¥
;

170 <
a
 
	gh»f
='¬chives_do.php?chªÃlid=$chªÃlid&aid=".$aid."&dİo¡ód™'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

171 &
nb¥
;&
	gnb¥
;

172 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹å†…å®¹</u></a>

173 &
nb¥
;&
	gnb¥
;

174 <
a
 
	gh»f
='cÚ‹Á_sg_li¡.php?chªÃlid=$chªÃlid'><
u
>ç®¡ç†å†…å®¹</u></a>

176 
$wšt™Ë
 = "æˆåŠŸæ›´æ”¹å†…å®¹ï¼";

177 
	g$wecome_šfo
 = "å†…å®¹ç®¡ç†::æ›´æ”¹å†…å®¹";

178 
	g$wš
 = 
Ãw
 
OxWšdow
();

179 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹å†…å®¹ï¼š");

180 
	g$wš
->
AddMsgI‹m
(
$msg
);

181 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

182 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\article_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

9 
»quœe_Úû
(
XAKINC
."/userlogin.class.php");

10 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

12 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

13 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 1;

14 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 
	g$m’uty³
 = 'content';

21 if(
	$em±y
(
$dİo¡
))

23 
$cInfos
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$channelid'; ");

26 if(
$cInfos
['£nd¿nk']>0 || $cInfos['u£¹y³']!=''è
	`CheckRªk
(0,0);

30 if(
$cInfos
['£nd¿nk'] > 
$cfg_ml
->
M_Rªk
)

32 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT memb”ÇmFROM `#@__¬üªk` WHERE„ªk='".
$cInfos
['sendrank']."' ");

33 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$row
['membername']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

34 
	`ex™
();

37 if(
$cInfos
['u£¹y³']!='' && $cInfos['u£¹y³'] !ğ
$cfg_ml
->
M_MbTy³
)

39 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$cInfos
['usertype']."å¸å·]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

40 
	`ex™
();

42 
	`šşude
(
XAKMEMBER
."/templets/article_add.htm");

43 
	`ex™
();

44 
	}
}

48 if(
	g$dİo¡
=='save')

50 
šşude
(
XAKMEMBER
.'/inc/archives_check.php');

53 
	g$šadd_f
 = 
$šadd_v
 = '';

54 if(!
em±y
(
$xak_addÚf›lds
))

56 
	g$addÚf›lds
 = 
ex¶ode
(';', 
$xak_addÚf›lds
);

57 
	g$šadd_f
 = '';

58 
	g$šadd_v
 = '';

59 if(
is_¬¿y
(
$addÚf›lds
))

61 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

63 if(
	g$v
=='')

67 
	g$vs
 = 
ex¶ode
(',', 
$v
);

68 if(!
is£t
(
$
{
$vs
[0]}))

70 
	g$
{
	g$vs
[0]} = '';

72 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]}, $vs[1],0);

73 
	g$šadd_f
 .ğ','.
$vs
[0];

74 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

79 ià(
em±y
(
$xak_f›ldshash
è|| 
	g$xak_f›ldshash
 !ğ
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

81 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

82 
ex™
();

87 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

88 ià(
	g$fÚt™”m
 !ğ
$šadd_f
)

90 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

91 
ex™
();

95 if(
	g$l™pic
!='')

97 
$æag
 = 'p';

99 
	g$body
 = 
AÇly£HtmlBody
(
$body
, 
$desütiÚ
);

100 
	g$body
 = 
HtmlR•Ïû
(
$body
, -1);

103 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
, 
$ty³id
, 
$sÜŒªk
, 
$chªÃlid
, 
$£ndd©e
, 
$mid
);

104 if(
em±y
(
$¬cID
))

106 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

107 
ex™
();

111 
	g$šQu”y
 = "INSERT INTO `#@__archives`(id,typeid,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,

112 
cŞÜ
,
	gwr™”
,
	gsourû
,
	gl™pic
,
	gpubd©e
,
	g£ndd©e
,
	gmid
,
	gdesütiÚ
,
	gkeywÜds
,
	gmty³
)

113 
VALUES
 ('$arcID','$typeid','$sortrank','$flag','$ismake','$channelid','$arcrank','0','$money','$title','$shorttitle',

115 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

117 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

118 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID' ");

119 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨ `#@__archives` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚","javascript:;");

120 
ex™
();

124 
	g$addbË
 = 
Œim
(
$cInfos
['addtable']);

125 if(
em±y
(
$addbË
))

127 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

128 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

129 
ShowMsg
("æ²¡æ‰¾åˆ°å½“å‰æ¨¡å‹[{$channelid}]çš„ä¸»è¡¨ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œï¼ã€‚","javascript:;");

130 
ex™
();

134 
	g$šqu”y
 = "INSERT INTO `{$addtable}`(aid,typeid,userip,redirecturl,templet,body{$inadd_f}) Values('$arcID','$typeid','$userip','','','$body'{$inadd_v})";

135 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
))

137 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

138 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

139 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

140 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addtable}` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼","javascript:;");

141 
ex™
();

146 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_li¡` s‘ scÜes=scÜes+{$cfg_£nd¬c_scÜes} WHERE mid='".
$cfg_ml
->
M_ID
."' ; ");

148 
couÁArchives
(
$chªÃlid
);

151 
In£¹Tags
(
$gs
, 
$¬cID
);

152 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
, 
TRUE
);

153 if(
	g$¬tU¾
==''è
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

157 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/api/uc.func.php')

160 
	g$ãed
['icon'] = 'thread';

161 
	g$ãed
['title_template'] = '<b>{username} åœ¨ç½‘ç«™å‘å¸ƒäº†ä¸€ç¯‡æ–‡ç« </b>';

162 
	g$ãed
['t™Ë_d©a'] = 
¬¿y
('u£ºame' => 
$cfg_ml
->
M_U£rName
);

163 
	g$ãed
['body_template'] = '<b>{subject}</b><br>{message}';

164 
	g$u¾
 = !
¡r¡r
(
$¬tU¾
,'h‰p://'è? (
	g$cfg_ba£ho¡
.
	g$¬tU¾
) : $artUrl;

165 
	g$ãed
['body_d©a'] = 
¬¿y
('subjeù' => "<¨h»f=\"".
$u¾
."\">$t™Ë</a>", 'mes§ge' => 
ú_sub¡r
(
¡r_gs
(
´eg_»¶aû
("/\[.+?\]/is", '', 
$desütiÚ
)), 150));

166 
	g$ãed
['images'][] = 
¬¿y
('u¾' => 
$cfg_ba£ho¡
.'/images/scores.gif', 'link'=> $cfg_basehost);

167 
uc_ãed_nÙe
(
$cfg_ml
->
M_LogšID
,
$ãed
);

169 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `scÜes`,`u£rid` FROM `#@__memb”_li¡` WHERE `mid`='".
$cfg_ml
->
M_ID
."' AND `matt`<>10");

170 
uc_üed™_nÙe
(
$row
['u£rid'], 
$cfg_£nd¬c_scÜes
);

172 #/
a
}}

175 
	g$cfg_ml
->
RecÜdF“ds
('add', 
$t™Ë
, 
$desütiÚ
, 
$¬cID
);

177 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

180 
	g$msg
 =

182 <
a
 
h»f
='¬tişe_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒæ–‡ç« </u></a>

183 &
nb¥
;&
	gnb¥
;

184 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡ç« </u></a>

185 &
nb¥
;&
	gnb¥
;

186 <
a
 
	gh»f
='¬tişe_ed™.php?chªÃlid=$chªÃlid&aid=$¬cID'><
u
>æ›´æ”¹æ–‡ç« </u></a>

187 &
nb¥
;&
	gnb¥
;

188 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid={$chªÃlid}'><
u
>å·²å‘å¸ƒæ–‡ç« ç®¡ç†</u></a>";

189 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒæ–‡ç« ï¼";

190 
	g$wecome_šfo
 = "æ–‡ç« ç®¡ç†::å‘å¸ƒæ–‡ç« ";

191 
	g$wš
 = 
Ãw
 
OxWšdow
();

192 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒæ–‡ç« ï¼š");

193 
	g$wš
->
AddMsgI‹m
(
$msg
);

194 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

195 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\article_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

12 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

13 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 1;

14 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 
	g$m’uty³
 = 'content';

21 if(
	$em±y
(
$dİo¡
))

24 
$¬cQu”y
 = "SELECT‡rc.*,ch.addtable,ch.fieldset,arc.mtype‡s mtypeid,ch.arcsta

25 
FROM
 `#@
__¬chives
` 
¬c
 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
÷rc.
chªÃl


26 
WHERE
 
¬c
.
id
='$aid' 
And
‡rc.
mid
='".$cfg_ml->M_ID."'; ";

27 
$row
 = 
$dsql
->
	`G‘OÃ
(
$¬cQu”y
);

28 if(!
	`is_¬¿y
(
$row
))

30 
	`ShowMsg
("è¯»å–æ–‡ç« ä¿¡æ¯å‡ºé”™!","-1");

31 
	`ex™
();

33 if(
$row
['arcrank']>=0)

35 
$dtime
 = 
	`time
();

36 
$maxtime
 = 
$cfg_mb_ed™day
 * 24 *3600;

37 if(
$dtime
 - 
$row
['£ndd©e'] > 
$maxtime
)

39 
	`ShowMsg
("è¿™ç¯‡æ–‡æ¡£å·²ç»é”å®šï¼Œä½ ä¸èƒ½å†ä¿®æ”¹å®ƒï¼","-1");

40 
	`ex™
();

43 
$addRow
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `{$row['addtable']}` WHERE‡id='$aid'; ");

44 
	`šşude
(
XAKMEMBER
."/templets/article_edit.htm");

45 
	`ex™
();

46 
	}
}

51 if(
	g$dİo¡
=='save')

53 
šşude
(
XAKMEMBER
.'/inc/archives_check_edit.php');

56 
	g$šadd_f
 = '';

57 if(!
em±y
(
$xak_addÚf›lds
))

59 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

60 if(
is_¬¿y
(
$addÚf›lds
))

62 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

64 if(
	g$v
=='')

68 
	g$vs
 = 
ex¶ode
(',',
$v
);

69 if(!
is£t
(
$
{
$vs
[0]}))

71 
	g$
{
	g$vs
[0]} = '';

73 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$aid
);

74 
	g$šadd_f
 .ğ','.
$vs
[0]." ='".
$
{$vs[0]}."' ";

78 ià(
em±y
(
$xak_f›ldshash
è|| 
	g$xak_f›ldshash
 !ğ
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

80 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

81 
ex™
();

85 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

86 ià(
	g$fÚt™”m
 !ğ
$šadd_f
)

88 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

89 
ex™
();

93 
	g$body
 = 
AÇly£HtmlBody
(
$body
,
$desütiÚ
);

94 
	g$body
 = 
HtmlR•Ïû
(
$body
,-1);

97 if(
	g$l™pic
!=''è
$æag
 = 'p';

100 
	g$upQu”y
 = "UPDATE `#@__archives` SET

101 
ismake
='$ismake',

102 
	g¬üªk
='$arcrank',

103 
	gty³id
='$typeid',

104 
	gt™Ë
='$title',

105 
	gl™pic
='$litpic',

106 
	gdesütiÚ
='$description',

107 
	gmty³
 = '$mtypesid',

108 
	gkeywÜds
='$keywords',

109 
	gæag
='$flag'

110 
WHERE
 
id
='$aid' 
AND
 
mid
='$mid'; ";

111 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$upQu”y
))

113 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼".
$dsql
->
G‘E¼Ü
(),"-1");

114 
ex™
();

116 if(
	g$addbË
!='')

118 
$upQu”y
 = "UPDATE `$addtable` SETypeid='$typeid',body='$body'{$inadd_f},userip='$userip' WHERE‡id='$aid' ";

119 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$upQu”y
))

121 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addtable` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼","javascript:;");

122 
ex™
();

125 
UpIndexKey
(
$aid
, 
$¬üªk
, 
$ty³id
, 
$sÜŒªk
, 
$gs
);

126 
	g$¬tU¾
 = 
MakeA¹
(
$aid
,
Œue
);

127 if(
	g$¬tU¾
=='')

129 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$aid";

133 
	g$msg
 = "ã€€ã€€è¯·é€‰æ‹©ä½ çš„åç»­æ“ä½œï¼š

134 <
a
 
h»f
='¬tişe_add.php?cid=$ty³id'><
u
>å‘å¸ƒæ–°æ–‡ç« </u></a>

135 &
nb¥
;&
	gnb¥
;

136 <
a
 
	gh»f
='¬chives_do.php?chªÃlid=$chªÃlid&aid=".$aid."&dİo¡ód™'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

137 &
nb¥
;&
	gnb¥
;

138 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡ç« </u></a>

139 &
nb¥
;&
	gnb¥
;

140 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid=$chªÃlid'><
u
>ç®¡ç†æ–‡ç« </u></a>

142 
$wšt™Ë
 = "æˆåŠŸæ›´æ”¹æ–‡ç« ï¼";

143 
	g$wecome_šfo
 = "æ–‡ç« ç®¡ç†::æ›´æ”¹æ–‡ç« ";

144 
	g$wš
 = 
Ãw
 
OxWšdow
();

145 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹æ–‡ç« ï¼š");

146 
	g$wš
->
AddMsgI‹m
(
$msg
);

147 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

148 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\buy.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

6 
CheckRªk
(0,0);

7 
	g$m’uty³
 = 'xakmenu';

8 
	g$m’uty³_sÚ
 = 'op';

9 
	g$myu¾
 = 
$cfg_ba£ho¡
.
$cfg_memb”_dœ
.'/šdex.php?uid='.
$cfg_ml
->
M_LogšID
;

10 
	g$mÚeyÿrds
 = '';

11 
	g$memb”ty³s
 = '';

12 
	g$dsql
->
S‘Qu”y
("SELECT * FROM #@__moneycard_type ");

13 
	g$dsql
->
Execu‹
();

14 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

16 
$row
->
mÚey
 = 
	`¥rštf
("%01.2f", $row->money);

17 
$mÚeyÿrds
 .= "<tr‡lign='center'>

18 <
td
><
šput
 
ty³
='¿dio' 
Çme
='pid' 
v®ue
='{$row->tid}'></td>

19 <
td
><
¡rÚg
>{
$row
->
²ame
}</strong></td>

20 <
td
>{
$row
->
num
}ä¸ª</td>

21 <
td
>{
$row
->
mÚey
}å…ƒ</td>

22 </
Œ
>

24 
	}
}

25 
	g$dsql
->
S‘Qu”y
("SELECT `#@__member_type`.*,`#@__arcrank`.membername,`#@__arcrank`.money‡s cm From `#@__member_type` LEFT JOIN `#@__arcrank` on `#@__arcrank`.rank = `#@__member_type`.rank ");

26 
	g$dsql
->
Execu‹
();

27 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

29 
$row
->
mÚey
 = 
	`¥rštf
("%01.2f", $row->money);

30 
$memb”ty³s
 .= "<tr‡lign='center'>

31 <
td
><
šput
 
ty³
='¿dio' 
Çme
='pid' 
v®ue
='{$row->aid}'></td>

32 <
td
><
¡rÚg
>{
$row
->
²ame
}</strong></td>

33 <
td
>{
$row
->
memb”Çme
}</td>

34 <
td
>{
$row
->
ex±ime
}</td>

35 <
td
>{
$row
->
mÚey
}å…ƒ</td>

36 </
Œ
>

38 
	}
}

39 
	g$l
 = 
Ãw
 
XakTem¶©e
();

40 
	g$l
->
LßdTem¶©e
(
XAKMEMBER
.'/templets/buy.htm');

41 
	g$l
->
Di¥Ïy
();

	@E:\web\weixun\user\buy_action.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
CheckRªk
(0,0);

7 
	g$m’uty³
 = 'xakmenu';

8 
	g$m’uty³_sÚ
 = 'op';

9 
»quœe_Úû
 
	gXAKINC
.'/xaktemplate.class.php';

11 
	g$´oduù
 = 
is£t
(
$´oduù
è? 
	$Œim
(
$´oduù
) : '';

12 
$mid
 = 
$cfg_ml
->
M_ID
;

13 
$±y³
 = '';

14 
$²ame
 = '';

15 
$´iû
 = '';

16 
$mtime
 = 
	`time
();

18 if(
	`is£t
(
$pd_’code
è&& is£t(
$pd_v”ify
è&& 
	`md5
("·ym’t".$pd_’code.
$cfg_cook›_’code
) == $pd_verify)

21 
	`·r£_¡r
(
	`mchSŒCode
(
$pd_’code
,'DECODE'),
$mch_Po¡
);

22 
	`fÜ—ch
(
$mch_Po¡
 
as
 
$k
 => 
$v
è
$$k
 = $v;

23 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__member_operation` WHERE mid='$mid' And sta=0 AND…roduct='$product'");

24 if(!
	`is£t
(
$row
['buyid']))

26 
	`ShowMsg
("è¯·ä¸è¦é‡å¤æäº¤è¡¨å•!", 'javascript:;');

27 
	`ex™
();

29 if(!
	`is£t
(
$·yty³
))

31 
	`ShowMsg
("è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼!", 'javascript:;');

32 
	`ex™
();

34 
$buyid
 = 
$row
['buyid'];

36 
	}

	g}–£
{

38 
	g$buyid
 = 'M'.
$mid
.'T'.
$mtime
.'RN'.
mt_¿nd
(100,999);

40 if(!
em±y
(
$´oduù
))

42 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__member_operation` WHERE mid='$mid' And sta=0 And…roduct='$product'");

46 if(
	$em±y
(
$´oduù
))

48 
	`ShowMsg
("è¯·é€‰æ‹©ä¸€ä¸ªäº§å“!", 'javascript:;');

49 
	`ex™
();

50 
	}
}

52 
	g$pid
 = 
is£t
(
$pid
è&& 
is_num”ic
($pid) ? $pid : 0;

53 if(
	g$´oduù
=='member')

55 
$±y³
 = "ä¼šå‘˜å‡çº§";

56 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_type` WHERE‡id='{$pid}'");

57 if(!
is_¬¿y
(
$row
))

59 
ShowMsg
("æ— æ³•è¯†åˆ«ä½ çš„è®¢å•ï¼", 'javascript:;');

60 
ex™
();

62 
	g$²ame
 = 
$row
['pname'];

63 
	g$´iû
 = 
$row
['money'];

65 ià(
	g$´oduù
 == 'card')

67 
$±y³
 = "ç‚¹å¡è´­ä¹°";

68 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * From #@__moneycard_type WHEREid='{$pid}'");

69 if(!
is_¬¿y
(
$row
))

71 
ShowMsg
("æ— æ³•è¯†åˆ«ä½ çš„è®¢å•ï¼", 'javascript:;');

72 
ex™
();

74 
	g$²ame
 = 
$row
['pname'];

75 
	g$´iû
 = 
$row
['money'];

78 if(!
	$is£t
(
$·yty³
))

80 
$šqu”y
 = "INSERT INTO `#@__member_operation` (`buyid` , `pname` , `product` , `money` , `mtime` , `pid` , `mid` , `sta` ,`oldinfo`)

81 
	`VALUES
 ('$buyid', '$pname', '$product' , '$price' , '$mtime' , '$pid' , '$mid' , '0' , '$ptype');

83 
$isok
 = 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

84 if(!
$isok
)

86 
echo
 "æ•°æ®åº“å‡ºé”™ï¼Œè¯·é‡æ–°å°è¯•ï¼".
$dsql
->
	`G‘E¼Ü
();

87 
	`ex™
();

90 if(
$´iû
=='')

92 
echo
 "æ— æ³•è¯†åˆ«ä½ çš„è®¢å•ï¼";

93 
	`ex™
();

97 
$·ym’t_li¡
 = 
	`¬¿y
();

98 
$dsql
->
	`S‘Qu”y
("SELECT * FROM #@__payment WHEREƒnabled='1' ORDER BY„ank ASC");

99 
$dsql
->
	`Execu‹
();

100 
$i
 = 0 ;

101 
$row
 = 
$dsql
->
	`G‘A¼ay
())

103 
$·ym’t_li¡
[] = 
$row
;

104 
$i
++;

106 
	`un£t
(
$row
);

108 
$´_’code
 = '';

109 
	`fÜ—ch
(
$_REQUEST
 
as
 
$key
 => 
$v®
)

111 
$´_’code
 .= $pr_encode ? "&$key=$val" : "$key=$val";

114 
$´_’code
 = 
	`¡r_»¶aû
('=', '', 
	`mchSŒCode
($pr_encode));

116 
$´_v”ify
 = 
	`md5
("·ym’t".
$´_’code
.
$cfg_cook›_’code
);

118 
$l
 = 
Ãw
 
	`XakTem¶©e
();

119 
$l
->
	`LßdTem¶©e
(
XAKMEMBER
.'/templets/buy_action_payment.htm');

120 
$l
->
	`Di¥Ïy
();

122 
	}

	g}–£
{

124 
	g$rs
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__payment` WHERE id='$paytype' ");

125 
»quœe_Úû
 
	gXAKINC
.'/·ym’t/'.
	g$rs
['code'].'.php';

126 
	g$·y
 = 
Ãw
 
$rs
['code'];

127 
	g$·ym’t
="";

128 if(
	g$rs
['code']=="cod" || 
$rs
['code']=="bank") {

129 
$Üd”
=
$buyid
;

130 
	g$·ym’t
="member";

133 
	g$Üd”
=
¬¿y
Ğ'out_Œade_no' => 
$buyid
,

134 '´iû' => 
¥rštf
("%01.2f", 
$´iû
)

136 
»quœe_Úû
 
	gXAKDATA
.'/·ym’t/'.
	g$rs
['code'].'.php';

138 
	g$bu‰Ú
=
$·y
->
G‘Code
(
$Üd”
,
$·ym’t
);

139 
	g$d
 = 
Ãw
 
XakTem¶©e
();

140 
	g$ÿ¹s
 = 
¬¿y
Ğ'Üd”s_id' => 
$buyid
,

142 '´iû_couÁ' => 
¥rštf
("%01.2f", 
$´iû
)

144 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT…name,money FROM `#@__member_operation` WHERE buyid='{$buyid}'");

145 
	g$d
->
S‘V¬
('·y_Çme',
$row
['pname']);

146 
	g$d
->
S‘V¬
('´iû',
$row
['money']);

147 
	g$d
->
S‘V¬
('·y_way',
$rs
['name']);

148 
	g$d
->
S‘V¬
('desütiÚ',
$rs
['description']);

149 
	g$d
->
S‘V¬
('bu‰Ú',
$bu‰Ú
);

150 
	g$d
->
Assign
('ÿ¹s',
$ÿ¹s
);

151 
	g$d
->
LßdTem¶©e
(
XAKMEMBER
.'/templets/shops_action_payment.htm');

152 
	g$d
->
Di¥Ïy
();

153 
ex™
();

164 
funùiÚ
 
mchSŒCode
(
$¡ršg
,
$aùiÚ
='ENCODE')

166 
$key
 = 
sub¡r
(
md5
(
$_SERVER
["HTTP_USER_AGENT"].
$GLOBALS
['cfg_cookie_encode']),8,18);

167 
	g$¡ršg
 = 
$aùiÚ
 =ğ'ENCODE' ? 
$¡ršg
 : 
ba£64_decode
($string);

168 
	g$Ën
 = 
¡¾’
(
$key
);

169 
	g$code
 = '';

170 
	g$i
=0; $i<
¡¾’
(
$¡ršg
); $i++)

172 
	g$k
 = 
$i
 % 
$Ën
;

173 
	g$code
 .ğ
$¡ršg
[
$i
] ^ 
$key
[
$k
];

175 
	g$code
 = 
$aùiÚ
 =ğ'DECODE' ? 
$code
 : 
ba£64_’code
($code);

176  
	g$code
;

	@E:\web\weixun\user\caicai.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
»quœe_Úû
(
XAKINC
."/arc.caicai.class.php");

7 
	g$sÜt
 = 
Œim
(
em±y
(
$sÜt
è? 'Ï¡po¡' : 
´eg_»¶aû
("#[^0-9a-z]#i", '', $sort));

8 if(!
´eg_m©ch
("#^(scÜes|badpo¡|goodpo¡)$#", 
$sÜt
)è
	g$sÜt
 = 'lastpost';

10 
	g$tid
 = (
is£t
(
$tid
è? 
	$štv®
(
$tid
) : 0);

11 
$t1
 = 
	`ExecTime
();

12 
$ty³qu”y
 = '';

13 
$m’uty³
 = 'xakmenu';

14 
$m’uty³_sÚ
 = 'cc';

16 if(
$tid
!=0)

18 
$¬r
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__arctype` WHERE id='$tid' AND corank=0 ");

19 if(
$cfg_li¡_sÚ
=='Y')

21 
$CrossID
 = 
	`G‘SÚIds
(
$tid
,
$¬r
['channeltype']);

25 
$CrossID
 = 
$tid
;

27 if(
$¬r
['cross']>0)

29 
$£lqu”y
 = '';

30 if(
$¬r
['cross']==1)

32 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHEREypename LIKE '{$arr['typename']}' AND id<>'{$tid}' ANDopid<>'{$tid}' ";

36 
$¬r
['üossid'] = 
	`´eg_»¶aû
("#[^0-9,]#", '', 
	`Œim
($arr['crossid']));

37 if(
$¬r
['crossid']!='')

39 
$£lqu”y
 = "SELECT id,topid FROM `#@__arctype` WHERE id in('{$arr['crossid']}') AND id<>'{$tid}' ANDopid<>'{$tid}' ";

42 if(
$£lqu”y
!='')

44 
$dsql
->
	`S‘Qu”y
(
$£lqu”y
);

45 
$dsql
->
	`Execu‹
();

46 
$¬r
 = 
$dsql
->
	`G‘A¼ay
())

48 
$CrossID
 .ğ($CrossID=='' ? 
$¬r
['id'] : ','.$arr['id']);

52 
$ty³qu”y
 = "‡rc.typeid in($CrossID) And ";

53 
	}
}

54 
	g$dli¡
 = 
Ãw
 
Caiÿi
();

55 
	g$dli¡
->
	g·geSize
 = 15;

56 
	g$dli¡
->
	gmaxPageSize
 = 100;

57 
	g$maxrc
 = 
$dli¡
->
·geSize
 * $dli¡->
maxPageSize
;

58 
	g$qu”y
 = "Select‡rc.*,m.userid,m.face,

59 

.
ty³dœ
,
	g
.
	gty³Çme
,.
	gisdeçuÉ
,.
	gdeçuÉÇme
,.
	gÇm”uË
,.
	gÇm”uË2
,.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h


60 
	gFrom
 `#@
	g__¬chives
` 
¬c
 
Ëá
 
	gjoš
 `#@
	g__¬ùy³
` 

 
Ú
 
	g
.
	gid
÷rc.
ty³id
†eá 
još
 `#@
__memb”_li¡
` 
m
 oÀm.
mid
=arc.mid

61 
wh”e
 
$ty³qu”y
 
¬c
.
¬üªk
>-1

62 
Üd”
 
by
 
¬c
.`{
$sÜt
}` 
desc
 
lim™
 
$maxrc
 ";

63 
$dli¡
->
S‘P¬am‘”
('tid',
$tid
);

64 
	g$dli¡
->
S‘P¬am‘”
('sÜt',
$sÜt
);

65 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
.'/templets/caicai.htm');

66 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

67 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\user\check_card.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
	g$sv®i
 = 
G‘CkVdV®ue
();

8 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=="")

10 
ShowMsg
("éªŒè¯ç é”™è¯¯ï¼","-1");

11 
ex™
();

14 
	g$ÿrdid
 = 
´eg_»¶aû
("#[^0-9A-Za-z-]#", "", 
$ÿrdid
);

15 if(
	$em±y
(
$ÿrdid
))

17 
	`ShowMsg
("å¡å·ä¸ºç©ºï¼","-1");

18 
	`ex™
();

19 
	}
}

21 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__moneycard_record WHERE cardid='$cardid' ");

23 if(!
	$is_¬¿y
(
$row
))

25 
	`ShowMsg
("å¡å·é”™è¯¯ï¼šä¸å­˜åœ¨æ­¤å¡å·ï¼","-1");

26 
	`ex™
();

27 
	}
}

29 if(
	g$row
['isexp']==-1)

31 
ShowMsg
("æ­¤å¡å·å·²ç»å¤±æ•ˆï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨ï¼","-1");

32 
ex™
();

35 
	g$hasMÚey
 = 
$row
['num'];

36 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__mÚeyÿrd_»cÜd` SET uid='".
$cfg_ml
->
M_ID
."',i£xp='-1',utime='".
time
()."' WHERE cardid='$cardid' ");

37 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_li¡` SET mÚey=mÚey+$hasMÚey WHERE mid='".
$cfg_ml
->
M_ID
."'");

39 
ShowMsg
("å……å€¼æˆåŠŸï¼Œä½ æœ¬æ¬¡å¢åŠ çš„é‡‘å¸ä¸ºï¼š{$hasMoney} ä¸ªï¼",-1);

40 
ex™
();

	@E:\web\weixun\user\config.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/../functions/common.inc.php');

6 
»quœe_Úû
(
XAKINC
.'/filter.inc.php');

7 
»quœe_Úû
(
XAKINC
.'/memberlogin.class.php');

8 
»quœe_Úû
(
XAKINC
.'/xaktemplate.class.php');

11 
	g$xakNowu¾
 = 
$s_sütName
 = '';

12 
	g$xakNowu¾
 = 
G‘CurU¾
();

13 
	g$xakNowu¾s
 = 
ex¶ode
('?', 
$xakNowu¾
);

14 
	g$s_sütName
 = 
$xakNowu¾s
[0];

15 
	g$m’uty³
 = '';

16 
	g$m’uty³_sÚ
 = '';

17 
	g$gou¾
 = 
em±y
(
$gou¾
)? "" : 
RemoveXSS
($gourl);

21 if(
	g$cfg_mb_İ’
=='N')

23 
ShowMsg
("ç³»ç»Ÿå…³é—­äº†ä¼šå‘˜åŠŸèƒ½ï¼Œå› æ­¤ä½ æ— æ³•è®¿é—®æ­¤é¡µé¢ï¼","javascript:;");

24 
ex™
();

26 
	g$k“±ime
 = 
is£t
(
$k“±ime
è&& 
is_num”ic
($keeptime) ? $keeptime : -1;

27 
	g$cfg_ml
 = 
Ãw
 
Memb”Logš
(
$k“±ime
);

30 
	g$myu¾
 = '';

31 if(
	g$cfg_ml
->
	$IsLogš
())

33 
$myu¾
 = 
$cfg_memb”u¾
."/šdex.php?uid=".
	`u¾’code
(
$cfg_ml
->
M_LogšID
);

34 if(!
	`´eg_m©ch
("#^h‰p:#i", 
$myu¾
)è$myu¾ = 
$cfg_ba£ho¡
.$myurl;

35 
	}
}

45 
funùiÚ
 
	$CheckRªk
(
$¿nk
=0, 
$mÚey
=0, 
$Ãedšfo
=
TRUE
)

47 
glob®
 
$cfg_ml
,
$cfg_memb”u¾
,
$cfg_mb_»gšfo
,
$cfg_mb_¥aû¡a
;

48 if(!
$cfg_ml
->
	`IsLogš
())

50 
	`h—d”
("LoÿtiÚ:{$cfg_memb”u¾}/logš.php?gou¾=".
	`u¾’code
(
	`G‘CurU¾
()));

51 
	`ex™
();

55 if(
$cfg_mb_»gšfo
 =ğ'Y' && 
$Ãedšfo
)

58 if(
$cfg_ml
->
f›lds
['spacesta'] == 0 || $cfg_ml->fields['spacesta'] == 1)

60 
	`ShowMsg
("å°šæœªå®Œæˆè¯¦ç»†èµ„æ–™ï¼Œè¯·å®Œå–„...","{$cfg_memberurl}/index_do.php?fmdo=user&dopost=regnew&step=2",0,1000);

61 
ex™
;

64 if(
$cfg_mb_¥aû¡a
 == '-10')

67 if(
$cfg_ml
->
f›lds
['spacesta'] == '-10')

69 
$msg
="æ‚¨å°šæœªè¿›è¡Œé‚®ä»¶éªŒè¯ï¼Œè¯·åˆ°é‚®ç®±æŸ¥é˜…...</br>é‡æ–°å‘é€é‚®ä»¶éªŒè¯ <a href='/user/index_do.php?fmdo=sendMail'><font color='red'>ç‚¹å‡»æ­¤å¤„</font></a>";

70 
	`ShowMsg
(
$msg
,"-1",0,5000);

71 
ex™
;

74 if(
$cfg_ml
->
M_Rªk
 < 
$¿nk
)

76 
$ÃedÇme
 = "";

77 if(
$cfg_ml
->
M_Rªk
==0)

79 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT membername FROM #@__arcrank WHERE„ank='$rank'");

80 
$myÇme
 = "æ™®é€šä¼šå‘˜";

81 
$ÃedÇme
 = 
$row
['membername'];

85 
$dsql
->
	`S‘Qu”y
("SELECT memb”ÇmFrom #@__¬üªk WHERE„ªk='$¿nk' OR„ªk='".
$cfg_ml
->
M_Rªk
."' ORDER BY„ank DESC");

86 
$dsql
->
	`Execu‹
();

87 
$row
 = 
$dsql
->
	`G‘Objeù
();

88 
$ÃedÇme
 = 
$row
->
memb”Çme
;

89 if(
$row
 = 
$dsql
->
	`G‘Objeù
())

91 
$myÇme
 = 
$row
->
memb”Çme
;

95 
$myÇme
 = "æ™®é€šä¼šå‘˜";

98 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦ï¼š<span style='font-size:11pt;color:red'>$needname</span> æ‰èƒ½è®¿é—®æœ¬é¡µé¢ã€‚<br>ä½ ç›®å‰çš„ç­‰çº§æ˜¯ï¼š<span style='font-size:11pt;color:red'>$myname</span> ã€‚","-1",0,5000);

99 
	`ex™
();

101 if(
$cfg_ml
->
M_MÚey
 < 
$mÚey
)

103 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦èŠ±è´¹é‡‘å¸ï¼š<¥ª styË='fÚt-size:11±;cŞÜ:»d'>$mÚey</¥ª> æ‰èƒ½è®¿é—®æœ¬é¡µé¢ã€‚<br>ä½ ç›®å‰æ‹¥æœ‰çš„é‡‘å¸æ˜¯ï¼š<¥ª styË='fÚt-size:11±;cŞÜ:»d'>".
$cfg_ml
->
M_MÚey
."</span> ã€‚","-1",0,5000);

104 
	`ex™
();

107 
	}
}

116 
funùiÚ
 
	$couÁArchives
(
$chªÃlid
)

118 
glob®
 
$cfg_ml
,
$dsql
;

119 
$id
 = ()
$chªÃlid
;

120 if(
$cfg_ml
->
	`IsLogš
())

122 
$chªÃÉy³
 = 
	`¬¿y
(1 => 'article',2 => 'album',3 => 'soft',-8 => 'infos');

123 if(
	`is£t
(
$chªÃÉy³
[
$id
]))

125 
$_f›ld
 = 
$chªÃÉy³
[
$id
];

129 
$_f›ld
 = 'articles';

131 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT COUNT(*èAS‚um FROM #@__¬chive WHERE chªÃl='$id' AND mid='".
$cfg_ml
->
M_ID
."'");

133 
$dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__memb”_tj` SET ".
$_f›ld
."='".
$row
['nums']."' WHERE mid='".
$cfg_ml
->
M_ID
."'");

137  
FALSE
;

139 
	}
}

	@E:\web\weixun\user\content_list.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

10 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_list_functions.php");

12 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

13 
	g$cid
 = 
is£t
(
$cid
è&& 
is_num”ic
($cid) ? $cid : 0;

14 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 if(!
is£t
(
$keywÜd
)è
	g$keywÜd
 = '';

17 if(!
is£t
(
$¬üªk
)è
	g$¬üªk
 = '';

19 
	g$pos™iÚÇme
 = '';

20 
	g$m’uty³
 = 'content';

21 
	g$mid
 = 
$cfg_ml
->
M_ID
;

22 
	g$
 = 
Ãw
 
Ty³Lšk
(
$cid
);

23 
	g$cInfos
 = 
$
->
dsql
->
G‘OÃ
("Select‡rcsta,issend,issystem,usertype From `#@__channeltype` where id='$channelid'; ");

24 if(!
	$is_¬¿y
(
$cInfos
))

26 
	`ShowMsg
('æ¨¡å‹ä¸å­˜åœ¨', '-1');

27 
	`ex™
();

28 
	}
}

29 
	g$¬c¡a
 = 
$cInfos
['arcsta'];

30 
	g$dtime
 = 
time
();

31 
	g$maxtime
 = 
$cfg_mb_ed™day
 * 24 *3600;

34 if(
	g$cInfos
['u£¹y³'] !='' && 
$cInfos
['u£¹y³']!=
$cfg_ml
->
M_MbTy³
)

36 
ShowMsg
('ä½ æ— æƒé™è®¿é—®è¯¥éƒ¨åˆ†', '-1');

37 
ex™
();

40 if(
	g$cid
==0)

42 
$row
 = 
$
->
dsql
->
G‘OÃ
("Selectypename From #@__channeltype where id='$channelid'");

43 if(
is_¬¿y
(
$row
))

45 
	g$pos™iÚÇme
 = 
$row
['typename'];

50 
	g$pos™iÚÇme
 = 
¡r_»¶aû
(
$cfg_li¡_symbŞ
,"",
$
->
G‘Pos™iÚName
())." ";

52 
	g$wh”eSql
 = " where‡rc.channel = '$channelid' And‡rc.mid='$mid' ";

53 if(
	g$keywÜd
!='')

55 
$keywÜd
 = 
ú_sub¡r
(
Œim
(
´eg_»¶aû
("#[><\|\"\r\n\t%\*\.\?\(\)\$ ;,'%-]#", "", 
¡r¦ashes
($keyword))),30);

56 
	g$keywÜd
 = 
add¦ashes
(
$keywÜd
);

57 
	g$wh”eSql
 .= " And (arc.title†ike '%$keyword%') ";

59 if(
	g$cid
!=0è
$wh”eSql
 .ğ" And‡rc.ty³id iÀ(".
G‘SÚIds
(
$cid
).")";

63 if(
	g$¬üªk
 == '1'){

64 
$wh”eSql
 .= " And‡rc.arcrank >= 0";

65 }if(
	g$¬üªk
 == '-1'){

66 
$wh”eSql
 .= " And‡rc.arcrank = -1";

67 }if(
	g$¬üªk
 == '-2'){

68 
$wh”eSql
 .= " And‡rc.arcrank = -2";

71 
	g$şas¦i¡
 = '';

72 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__mtypes` WHERE `mid` = '$cfg_ml->M_ID';");

73 
	g$dsql
->
Execu‹
();

74 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

76 
$şas¦i¡
 .ğ"<İtiÚ v®ue='cÚ‹Á_li¡.php?chªÃlid=".
$chªÃlid
."&mty³sid=".
$row
['mtypeid']."'>".$row['mtypename']."</option>\r\n";

77 
	}
}

78 if(
	g$mty³sid
 != 0 )

80 
$wh”eSql
 .= " And‡rc.mtype = '$mtypesid'";

82 
	g$qu”y
 = "select‡rc.id,arc.typeid,arc.senddate,arc.flag,arc.ismake,arc.channel,arc.arcrank,

83 
¬c
.
şick
,
	g¬c
.
	gt™Ë
,¬c.
	gcŞÜ
,¬c.
	gl™pic
,¬c.
	gpubd©e
,¬c.
	gmid
,
	g
.
	gty³Çme
,
	gch
.
ty³Çme
 
as
 
chªÃÊame


84 
	gäom
 `#@
	g__¬chives
` 
¬c


85 
Ëá
 
	gjoš
 `#@
	g__¬ùy³
` 

 
Ú
 
	g
.
	gid
=
¬c
.
ty³id


86 
Ëá
 
još
 `#@
__chªÃÉy³
` 
ch
 
Ú
 ch.
id
=
¬c
.
chªÃl


87 
$wh”eSql
 
Üd”
 
by
 
¬c
.
£ndd©e
 
desc
 ";

88 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

89 
	g$dli¡
->
	g·geSize
 = 20;

90 
	g$dli¡
->
S‘P¬am‘”
("dopost","listArchives");

91 
	g$dli¡
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

92 
	g$dli¡
->
S‘P¬am‘”
("cid",
$cid
);

93 
	g$dli¡
->
S‘P¬am‘”
("chªÃlid",
$chªÃlid
);

94 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/templets/content_list.htm");

95 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

96 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\user\content_sg_list.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

10 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_list_functions.php");

12 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

13 
	g$cid
 = 
is£t
(
$cid
è&& 
is_num”ic
($cid) ? $cid : 0;

14 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 0;

15 
	g$mty³sid
 = 
is£t
(
$mty³sid
è&& 
is_num”ic
($mtypesid) ? $mtypesid : 0;

16 if(!
is£t
(
$keywÜd
)è
	g$keywÜd
 = '';

17 if(!
is£t
(
$¬üªk
)è
	g$¬üªk
 = '';

19 
	g$pos™iÚÇme
 = '';

20 
	g$m’uty³
 = 'content';

21 
	g$mid
 = 
$cfg_ml
->
M_ID
;

22 
	g$
 = 
Ãw
 
Ty³Lšk
(
$cid
);

23 
	g$cInfos
 = 
$
->
dsql
->
G‘OÃ
("SELECT‡rcsta,issend,issystem,usertype,typename,addtable FROM `#@__channeltype` WHERE id='$channelid'; ");

24 if(!
	$is_¬¿y
(
$cInfos
))

26 
	`ShowMsg
('æ¨¡å‹ä¸å­˜åœ¨', '-1');

27 
	`ex™
();

28 
	}
}

29 
	g$¬c¡a
 = 
$cInfos
['arcsta'];

32 if(
	g$cInfos
['u£¹y³'] !='' && 
$cInfos
['u£¹y³']!=
$cfg_ml
->
M_MbTy³
)

34 
ShowMsg
('ä½ æ— æƒé™è®¿é—®è¯¥éƒ¨åˆ†', '-1');

35 
ex™
();

38 if(
	g$cid
==0)

40 
$pos™iÚÇme
 = 
$cInfos
['typename']." &gt;&gt; ";

44 
	g$pos™iÚÇme
 = 
¡r_»¶aû
(
$cfg_li¡_symbŞ
," &gt;&gt; ",
$
->
G‘Pos™iÚName
())." &gt;&gt; ";

46 
	g$wh”eSql
 = " WHERE‡rc.channel = '$channelid' AND‡rc.mid='$mid' ";

47 if(
	g$keywÜd
!='')

49 
$keywÜd
 = 
ú_sub¡r
(
Œim
(
´eg_»¶aû
("#[><\|\"\r\n\t%\*\.\?\(\)\$ ;,'%-]#", "", 
¡r¦ashes
($keyword))),30);

50 
	g$keywÜd
 = 
add¦ashes
(
$keywÜd
);

51 
	g$wh”eSql
 .= " AND (arc.title†ike '%$keyword%') ";

53 if(
	g$cid
!=0)

55 
$wh”eSql
 .ğ" AND‡rc.ty³id iÀ(".
G‘SÚIds
(
$cid
).")";

58 
	g$qu”y
 = "SELECT‡rc.aid,arc.aid‡s id,arc.typeid,arc.senddate,arc.channel,arc.click,arc.title,arc.mid,tp.typename

59 
FROM
 `{
$cInfos
['addbË']}` 
¬c


60 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


61 
$wh”eSql


62 
ORDER
 
BY
 
¬c
.
aid
 
desc
 ";

63 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

64 
	g$dli¡
->
	g·geSize
 = 20;

65 
	g$dli¡
->
S‘P¬am‘”
("dopost","listArchives");

66 
	g$dli¡
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

67 
	g$dli¡
->
S‘P¬am‘”
("cid",
$cid
);

68 
	g$dli¡
->
S‘P¬am‘”
("chªÃlid",
$chªÃlid
);

69 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/templets/content_sg_list.htm");

70 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

71 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\user\control.php

1 <?
php


8 
h—d”
("location:index.php");

	@E:\web\weixun\user\edit_baseinfo.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
CheckRªk
(0,0);

7 
	g$m’uty³
 = 'config';

8 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

10 
	g$pwd2
=(
em±y
(
$pwd2
))? "" : $pwd2;

11 
	g$row
=
$dsql
->
G‘OÃ
("SELECT * FROM `#@__memb”_li¡` WHERE mid='".
$cfg_ml
->
M_ID
."'");

12 
	g$çû
 = 
$row
['face'];

13 if(
	g$dİo¡
=='save')

15 
$sv®i
 = 
G‘CkVdV®ue
();

17 if(
¡¹Şow”
(
$vdcode
è!ğ
$sv®i
 || $svali=='')

19 
ReSETVdV®ue
();

20 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼','-1');

21 
ex™
();

23 if(!
is_¬¿y
(
$row
è|| 
	g$row
['pwd'] !ğ
PassJoš
(
$Şdpwd
))

25 
ShowMsg
('ä½ è¾“å…¥çš„æ—§å¯†ç é”™è¯¯æˆ–æ²¡å¡«å†™ï¼Œä¸å…è®¸ä¿®æ”¹èµ„æ–™ï¼','-1');

26 
ex™
();

28 if(
	g$u£½wd
 !ğ
$u£½wdok
)

30 
ShowMsg
('ä½ ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´ï¼','-1');

31 
ex™
();

33 if(
	g$u£½wd
=='')

35 
$pwd
 = 
$row
['pwd'];

39 
	g$pwd
 = 
$pwd2
 = 
PassJoš
(
$u£½wd
);

43 
	g$addupqu”y
 = '';

46 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

48 
	g$emaÃw
 = 
$ema
 !ğ
$row
['email'] ? $email : '';

49 
	g$uüesuÉ
 = 
uc_u£r_ed™
(
$cfg_ml
->
M_LogšID
, 
$Şdpwd
, 
$u£½wd
, 
$emaÃw
);

51 #/
a
}}

54 if(
	g$ema
 !ğ
$row
['ema'] || (
$Ãw§ãque¡iÚ
 !ğ0 && 
$Ãw§ãªsw”
 != ''))

56 if(
$row
['§ãque¡iÚ']!=0 && ($row['§ãque¡iÚ'] !ğ
$§ãque¡iÚ
 || $row['§ãªsw”'] !ğ
$§ãªsw”
))

58 
ShowMsg
('ä½ çš„æ—§å®‰å…¨é—®é¢˜åŠç­”æ¡ˆä¸æ­£ç¡®ï¼Œä¸èƒ½ä¿®æ”¹Emailæˆ–å®‰å…¨é—®é¢˜ï¼','-1');

59 
ex™
();

63 if(
	g$ema
 !ğ
$row
['email'])

65 if(!
CheckEma
(
$ema
))

67 
ShowMsg
('Emailæ ¼å¼ä¸æ­£ç¡®ï¼','-1');

68 
ex™
();

72 
	g$addupqu”y
 .= ",email='$email'";

77 if(
	g$Ãw§ãque¡iÚ
 !ğ0 && 
$Ãw§ãªsw”
 != '')

79 if(
¡¾’
(
$Ãw§ãªsw”
) > 30)

81 
ShowMsg
('ä½ çš„æ–°å®‰å…¨é—®é¢˜çš„ç­”æ¡ˆå¤ªé•¿äº†ï¼Œè¯·ä¿æŒåœ¨30å­—èŠ‚ä»¥å†…ï¼','-1');

82 
ex™
();

86 
	g$addupqu”y
 .= ",safequestion='$newsafequestion',safeanswer='$newsafeanswer'";

92 if(
	g$uÇme
 !ğ
$row
['uname'])

94 
$rs
 = 
CheckU£rID
(
$uÇme
,'æ˜µç§°æˆ–å…¬å¸åç§°',
FALSE
);

95 if(
	g$rs
!='ok')

97 
ShowMsg
(
$rs
,'-1');

98 
ex™
();

100 
	g$addupqu”y
 .= ",uname='$uname'";

104 ifĞ!
š_¬¿y
(
$£x
, 
¬¿y
('ç”·','å¥³','ä¿å¯†')) )

106 
ShowMsg
('è¯·é€‰æ‹©æ­£å¸¸çš„æ€§åˆ«ï¼','-1');

107 
ex™
();

110 
	g$qu”y1
 = "UPDATE `#@__memb”_li¡` SET…wd='$pwd',£x='$£x'{$addupqu”y} wh”mid='".
$cfg_ml
->
M_ID
."' ";

111 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y1
);

114 if(
	g$cfg_ml
->
	gf›lds
['m©t']==10 && 
$pwd2
!="")

116 
$qu”y2
 = "UPDATE `#@__admš_li¡` SET…wd='$pwd2' wh”id='".
$cfg_ml
->
M_ID
."' ";

117 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y2
);

120 
	g$cfg_ml
->
D–Cache
(
$cfg_ml
->
M_ID
);

121 
ShowMsg
('æˆåŠŸæ›´æ–°ä½ çš„åŸºæœ¬èµ„æ–™ï¼','edit_baseinfo.php',0,5000);

122 
ex™
();

124 
šşude
(
XAKMEMBER
."/templets/edit_baseinfo.htm");

	@E:\web\weixun\user\edit_face.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
CheckRªk
(0,0);

7 
	g$m’uty³
 = 'config';

8 if(!
	$is£t
(
$dİo¡
))

10 
$dİo¡
 = '';

11 
	}
}

12 if(!
	$is£t
(
$backu¾
))

14 
$backu¾
 = 'edit_face.php';

15 
	}
}

16 if(
	g$dİo¡
=='save')

18 
$maxËngth
 = 
$cfg_max_çû
 * 1024;

19 
	g$u£rdœ
 = 
$cfg_u£r_dœ
.'/'.
$cfg_ml
->
M_ID
;

20 if(!
´eg_m©ch
("#^".
$u£rdœ
."#", 
$Şdçû
))

22 
	g$Şdçû
 = '';

24 if(
is_u¶ßded_fe
(
$çû
))

26 if(@
fesize
(
$_FILES
['çû']['tmp_Çme']è> 
	g$maxËngth
)

28 
ShowMsg
("ä½ ä¸Šä¼ çš„å¤´åƒæ–‡ä»¶è¶…è¿‡äº†ç³»ç»Ÿé™åˆ¶å¤§å°ï¼š{$cfg_max_face} Kï¼", '-1');

29 
ex™
();

32 if(
´eg_m©ch
("#\.(jpg|gif|²g)$#i", 
$Şdçû
è&& 
fe_exi¡s
(
$cfg_ba£dœ
.$oldface))

34 @
uÆšk
(
$cfg_ba£dœ
.
$Şdçû
);

37 
	g$çû
 = 
Memb”U¶ßds
('çû', 
$Şdçû
, 
$cfg_ml
->
M_ID
, 'image', 'myface', 180, 180);

41 
	g$çû
 = 
$Şdçû
;

43 
	g$qu”y
 = "UPDATE `#@__member_list` SET `face` = '$face' WHERE mid='{$cfg_ml->M_ID}' ";

44 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

46 
	g$cfg_ml
->
D–Cache
(
$cfg_ml
->
M_ID
);

47 
ShowMsg
('æˆåŠŸæ›´æ–°å¤´åƒä¿¡æ¯ï¼', 
$backu¾
);

48 
ex™
();

50 if(
	g$dİo¡
=='delold')

52 if(
em±y
(
$Şdçû
))

54 
ShowMsg
("æ²¡æœ‰å¯åˆ é™¤çš„å¤´åƒï¼", "-1");

55 
ex™
();

57 
	g$u£rdœ
 = 
$cfg_u£r_dœ
.'/'.
$cfg_ml
->
M_ID
;

58 if(!
´eg_m©ch
("#^".
$u£rdœ
."#", 
$Şdçû
) ||…reg_match('#\.\.#', $oldface))

60 
	g$Şdçû
 = '';

62 if(
´eg_m©ch
("#\.(jpg|gif|²g)$#i", 
$Şdçû
è&& 
fe_exi¡s
(
$cfg_ba£dœ
.$oldface))

64 @
uÆšk
(
$cfg_ba£dœ
.
$Şdçû
);

66 
	g$qu”y
 = "UPDATE `#@__member_list` SET `face` = '' WHERE mid='{$cfg_ml->M_ID}' ";

67 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

69 
	g$cfg_ml
->
D–Cache
(
$cfg_ml
->
M_ID
);

70 
ShowMsg
('æˆåŠŸåˆ é™¤åŸæ¥çš„å¤´åƒï¼', 
$backu¾
);

71 
ex™
();

73 
	g$çû
 = 
$cfg_ml
->
f›lds
['face'];

74 
šşude
(
XAKMEMBER
."/templets/edit_face.htm");

75 
ex™
();

	@E:\web\weixun\user\edit_fullinfo.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

6 
»quœe_Úû
 
	gXAKINC
.'/membermodel.cls.php';

7 
»quœe_Úû
(
XAKINC
."/userlogin.class.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
.'/enums.func.php');

10 
	g$m’uty³
 = 'config';

11 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

13 if(
	g$dİo¡
=='')

15 
$xak_f›lds
 = 
em±y
($xak_f›ldsè? '' : 
Œim
($xak_fields);

16 if(!
em±y
(
$xak_f›lds
))

18 if(
	g$xak_f›ldshash
 !ğ
md5
(
$xak_f›lds
.
$cfg_cook›_’code
))

20 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

21 
ex™
();

25 
	g$xak_f›ldshash
 = 
em±y
(
$xak_f›ldshash
è? '' : 
Œim
($xak_fieldshash);

26 
	g$memb”mod–
 = 
Ãw
 
memb”mod–
(
$cfg_ml
->
M_MbTy³
);

27 
	g$mod–fÜm
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$membermodel->modid' ");

28 if(!
is_¬¿y
(
$mod–fÜm
))

30 
showmsg
('æ¨¡å‹è¡¨å•ä¸å­˜åœ¨', '-1');

31 
ex™
();

33 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM ".
$mod–fÜm
['table']." WHERE mid=$cfg_ml->M_ID");

34 if(!
is_¬¿y
(
$row
))

36 
showmsg
("ä½ è®¿é—®çš„è®°å½•ä¸å­˜åœ¨æˆ–æœªç»å®¡æ ¸", '-1');

37 
ex™
();

39 
	g$po¡fÜm
 = 
$memb”mod–
->
g‘FÜm
('ed™', 
$row
, 'membermodel');

40 
šşude
(
XAKMEMBER
."/templets/edit_fullinfo.htm");

41 
ex™
();

46 if(
	g$dİo¡
=='save'){

48 
$memb”mod–
 = 
Ãw
 
memb”mod–
(
$cfg_ml
->
M_MbTy³
);

49 
	g$po¡fÜm
 = 
$memb”mod–
->
g‘FÜm
(
Œue
);

52 
	g$xak_f›lds
 = 
em±y
(
$xak_f›lds
è? '' : 
Œim
($xak_fields);

53 
	g$xak_f›ldshash
 = 
em±y
(
$xak_f›ldshash
è? '' : 
Œim
($xak_fieldshash);

54 
	g$modid
 = 
em±y
(
$modid
)? 0 : 
štv®
(
´eg_»¶aû
("/[^\d]/",'', $modid));

56 if(!
em±y
(
$xak_f›lds
))

58 if(
	g$xak_f›ldshash
 !ğ
md5
(
$xak_f›lds
.
$cfg_cook›_’code
))

60 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

61 
ex™
();

64 
	g$mod–fÜm
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$modid' ");

65 if(!
is_¬¿y
(
$mod–fÜm
))

67 
showmsg
('æ¨¡å‹è¡¨å•ä¸å­˜åœ¨', '-1');

68 
ex™
();

71 
	g$šadd_f
 = '';

72 if(!
em±y
(
$xak_f›lds
))

74 
	g$f›ld¬r
 = 
ex¶ode
(';', 
$xak_f›lds
);

75 if(
is_¬¿y
(
$f›ld¬r
))

77 
fÜ—ch
(
$f›ld¬r
 
as
 
$f›ld
)

79 if(
	g$f›ld
 == '') ;

80 
	g$f›ldšfo
 = 
ex¶ode
(',', 
$f›ld
);

81 if(
	g$f›ldšfo
[1] == 'textdata')

83 
$
{
$f›ldšfo
[0]} = 
F‹rS—rch
(
¡r¦ashes
(${$fieldinfo[0]}));

84 
	g$
{
	g$f›ldšfo
[0]} = 
add¦ashes
(
$
{
$f›ldšfo
[0]});

85 } ià(
	g$f›ldšfo
[1] == 'img')

87 
$
{
$f›ldšfo
[0]} = 
add¦ashes
(${$fieldinfo[0]});

91 if(
em±y
(
$
{
$f›ldšfo
[0]})è
	g$
{
	g$f›ldšfo
[0]} = '';

92 
	g$
{
	g$f›ldšfo
[0]} = 
G‘F›ldV®ue
(
$
{
$f›ldšfo
[0]}, $fieldinfo[1],0,'add','','diy', $fieldinfo[0]);

94 if(
	g$f›ldšfo
[0]=="bœthday"è
$
{
$f›ldšfo
[0]}=
G‘D©eMk
(${$fieldinfo[0]});

95 
	g$šadd_f
 .ğ','.
$f›ldšfo
[0]." ='".
$
{$fieldinfo[0]}."'";

100 
	g$šadd_f
=
´eg_»¶aû
('/,/','',
$šadd_f
,1);

101 
	g$qu”y
 = "UPDATE `{$membermodel->table}`set {$inadd_f} WHERE mid='{$cfg_ml->M_ID}'";

103 
	g$cfg_ml
->
D–Cache
(
$cfg_ml
->
M_ID
);

105 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

107 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `{$membermodel->table}` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼","javascript:;");

108 
ex™
();

110 
ShowMsg
('æˆåŠŸæ›´æ–°ä½ çš„è¯¦ç»†èµ„æ–™ï¼','edit_fullinfo.php',0,5000);

111 
ex™
();

	@E:\web\weixun\user\edit_space_info.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
CheckRªk
(0,0);

7 
	g$m’uty³
 = 'config';

8 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

10 if(
	g$dİo¡
=='save')

12 
$Şd¥aûlogo
=(
em±y
($oldspacelogo))? "" : $oldspacelogo;

13 
	g$¥aûlogo
=(
em±y
(
$¥aûlogo
))? "" : $spacelogo;

14 
	g$·gesize
=(
em±y
(
$·gesize
))? "" : $pagesize;

15 
	g$sign
=(
em±y
(
$sign
))? "" : $sign;

16 
	g$¥aûÃws
 =(
em±y
(
$¥aûÃws
))? "" : $spacenews;

17 
	g$¥aûÇme
 =(
em±y
(
$¥aûÇme
))? "" : $spacename;

18 
	g$maxËngth
 = 
$cfg_max_çû
 * 1024;

19 
	g$u£rdœ
 = 
$cfg_u£r_dœ
.'/'.
$cfg_ml
->
M_ID
;

20 if(!
´eg_m©ch
('#^'.
$u£rdœ
."#", 
$Şd¥aûlogo
))

22 
	g$Şd¥aûlogo
 = '';

24 if(
is_u¶ßded_fe
(
$¥aûlogo
))

26 if(@
fesize
(
$_FILES
['¥aûlogo']['tmp_Çme']è> 
	g$maxËngth
)

28 
ShowMsg
("ä½ ä¸Šä¼ çš„Logoæ–‡ä»¶è¶…è¿‡äº†ç³»ç»Ÿé™åˆ¶å¤§å°ï¼š{$cfg_max_face} Kï¼", '-1');

29 
ex™
();

32 if(
´eg_m©ch
("#\.(jpg|gif|²g)$#i", 
$Şd¥aûlogo
è&& 
fe_exi¡s
(
$cfg_ba£dœ
.$oldspacelogo))

34 @
uÆšk
(
$cfg_ba£dœ
.
$Şd¥aûlogo
);

37 
	g$¥aûlogo
 = 
Memb”U¶ßds
('¥aûlogo','',
$cfg_ml
->
M_ID
,'image','mylogo', 200, 50);

39 
	g$¥aûlogo
 = 
$Şd¥aûlogo
;

41 
	g$·gesize
 = 
štv®
(
$·gesize
);

42 if(
	g$·gesize
<=0)

44 
ShowMsg
('æ¯é¡µæ–‡æ¡£æ•°ä¸èƒ½å°äº0ï¼','edit_space_info.php');

45 
ex™
();

47 
	g$¥aûÇme
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$¥aûÇme
, 2), 50);

48 
	g$sign
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$sign
), 100);

49 
	g$¥aûÃws
 = 
HtmlR•Ïû
(
$¥aûÃws
, -1);

50 
	g$qu”y
 = "UPDATE `#@__member_space` SET `pagesize` = '$pagesize',`spacename`='$spacename' , spacelogo='$spacelogo', `sign` = '$sign' ,`spacenews`='$spacenews' WHERE mid='{$cfg_ml->M_ID}' ";

51 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

52 if(
	g$cfg_ml
->
	gM_S·û¡a
 >= 0)

54 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET spacesta=1 WHERE mid='{$cfg_ml->M_ID}' And spacesta < 1 ");

56 
ShowMsg
('æˆåŠŸæ›´æ–°ç©ºé—´ä¿¡æ¯ï¼','edit_space_info.php');

57 
ex™
();

59 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__memb”_¥aû` WHERE mid='".
$cfg_ml
->
M_ID
."'");

60 if(!
is_¬¿y
(
$row
))

62 
	g$šqu”y
 = "INSERT INTO `#@__member_space`(`mid` ,`pagesize` ,`matt` ,`spacename` ,`spacelogo` , `sign` ,`spacenews`)

63 
V®ues
('{$cfg_ml->M_ID}', '10', '0', '{$cfg_ml->M_UserName}çš„ç©ºé—´', '', '', ''); ";

64 
	g$row
['spacename'] = '';

65 
	g$row
['sign'] = '';

66 
	g$row
['pagesize'] = 10;

67 
	g$row
['spacestyle'] = 'person';

68 
	g$row
['spacenews'] = '';

70 
exŒaù
(
$row
);

71 
šşude
(
dœÇme
(
__FILE__
)."/templets/edit_space_info.htm");

72 
ex™
();

	@E:\web\weixun\user\feed.php

1 <?
php


8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

9 
CheckRªk
(0,0);

10 
	g$m’uty³
 = 'config';

11 
AjaxH—d
();

13 
funùiÚ
 
	$quÙeR•Ïû
(
$quÙe
)

15 
$quÙe
 = 
	`¡r_»¶aû
('{quote}','',$quote);

16 
$quÙe
 = 
	`¡r_»¶aû
('{title}','',$quote);

17 
$quÙe
 = 
	`¡r_»¶aû
('{/title}','',$quote);

18 
$quÙe
 = 
	`¡r_»¶aû
('&lt;br/&gt;','',$quote);

19 
$quÙe
 = 
	`¡r_»¶aû
('&lt;', '', $quote);

20 
$quÙe
 = 
	`¡r_»¶aû
('&gt;', '', $quote);

21 
$quÙe
 = 
	`¡r_»¶aû
('{content}','',$quote);

22 
$quÙe
 = 
	`¡r_»¶aû
('{/content}','',$quote);

23 
$quÙe
 = 
	`¡r_»¶aû
('{/quote}','',$quote);

24  
$quÙe
;

25 
	}
}

28 
	g$ãeds
 = 
¬¿y
();

29 
	g$ty³
=(
em±y
(
$ty³
))? "" : $type;

30 if(
	g$ty³
=="allfeed")

32 
$sql
="SELECT * FROM `#@__member_feed` ORDER BY dtime DESC LIMIT 8";

33 
	g$dsql
->
S‘Qu”y
(
$sql
);

34 
	g$dsql
->
Execu‹
();

35 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

36 if(
$cfg_soá_Ïng
 == 'gb2312') {

37 
$row
['uÇme'] = 
gb2utf8
($row['uname']);

38 
	g$row
['t™Ë'] = 
gb2utf8
(
html¥ecŸlch¬s_decode
(
$row
['t™Ë'],
ENT_QUOTES
));

39 
	g$row
['nÙe'] = 
gb2utf8
(
quÙeR•Ïû
(
$row
['note']));

40 
	g$row
['dtime']ğ
gb2utf8
(
FloÜTime
(
time
()- 
$row
['dtime']));

42 
	g$row
['t™Ë'] = 
html¥ecŸlch¬s_decode
(
$row
['t™Ë'],
ENT_QUOTES
);

43 
	g$row
['dtime']ğ
FloÜTime
(
time
()- 
$row
['dtime']);

45 
	g$ãeds
[] = 
$row
;

47 } ià(
	g$ty³
=="myfeed"){

48 
$sql
="SELECT * FROM `#@__memb”_ãed` wh”mid='".
$cfg_ml
->
M_ID
."' ORDER BY dtime DESC†imit 8";

49 
	g$dsql
->
S‘Qu”y
(
$sql
);

50 
	g$dsql
->
Execu‹
();

51 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

52 if(
$cfg_soá_Ïng
 == 'gb2312') {

53 
$row
['uÇme'] = 
gb2utf8
($row['uname']);

54 
	g$row
['t™Ë'] = 
gb2utf8
(
html¥ecŸlch¬s_decode
(
$row
['t™Ë'],
ENT_QUOTES
));

55 
	g$row
['nÙe'] = 
gb2utf8
(
quÙeR•Ïû
(
$row
['note']));

56 
	g$row
['dtime']ğ
gb2utf8
(
FloÜTime
(
time
()- 
$row
['dtime']));

58 
	g$row
['t™Ë'] = 
html¥ecŸlch¬s_decode
(
$row
['t™Ë'],
ENT_QUOTES
);

59 
	g$row
['dtime']ğ
FloÜTime
(
time
()- 
$row
['dtime']);

61 
	g$ãeds
[] = 
$row
;

64 
»quœe_Úû
(
XAKINC
.'/channelunit.func.php');

65 
	g$sql
 = "SELECT‡rc.id,arc.typeid,arc.senddate,arc.title,arc.ismake,arc.arcrank,arc.money,arc.filename,a.namerule,a.typedir,a.moresite,a.siteurl,‡.sitepath,m.userid FROM `#@__archives`‡rc LEFT JOIN `#@__arctype`‡ on‡.id=arc.typeid LEFT JOIN `#@__member_list` m on m.mid=arc.mid WHERE‡rc.arcrank > -1 ORDER BY‡rc.sortrank DESC LIMIT 12";

66 
	g$dsql
->
S‘Qu”y
(
$sql
);

67 
	g$dsql
->
Execu‹
();

68 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

69 
$row
['htmlu¾'] = 
G‘FeU¾
($row['id'], $row['typeid'], $row['senddate'], $row['title'], $row['ismake'], $row['arcrank'], $row['namerule'], $row['typedir'], $row['money'], $row['filename'], $row['moresite'], $row['siteurl'], $row['sitepath']);

70 if(
	g$cfg_soá_Ïng
 == 'gb2312') {

71 
$row
['u£rid'] = 
gb2utf8
($row['userid']);

72 
	g$row
['t™Ë'] = 
gb2utf8
(
$row
['title']);

73 
	g$row
['£ndd©e'] = 
gb2utf8
(
MyD©e
('m-d H:i',
$row
['senddate']));

75 
	g$row
['£ndd©e'] = 
MyD©e
('m-d H:i',
$row
['senddate']);

77 
	g$ãeds
[] = 
$row
;

81 
	g$ouut
 = 
jsÚ_’code
(
$ãeds
);

82 
´št
(
$ouut
);

	@E:\web\weixun\user\feedback.php

1 <?
php


7 
	g$cfg_fÜmmemb”
 = 
Œue
;

8 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/../module/feedback.php');

	@E:\web\weixun\user\flink_main.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
CheckRªk
(0,0);

7 
	g$m’uty³
 = 'config';

8 if(
	g$cfg_mb_l™
=='Y')

10 
ShowMsg
("ç”±äºç³»ç»Ÿå¼€å¯äº†ç²¾ç®€ç‰ˆä¼šå‘˜ç©ºé—´ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

11 
ex™
();

13 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

15 if(
	g$dİo¡
=="addnew")

17 
AjaxH—d
();

18 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*èAS dd FROM `#@__memb”_æšk` WHERE mid='".
$cfg_ml
->
M_ID
."' ");

19 if(
	g$row
['dd']>=50)

21 
echo
 "<font color='red'>å¢åŠ ç½‘å€å¤±è´¥ï¼Œå› ä¸ºå·²ç»è¾¾åˆ°äº”åä¸ªç½‘å€çš„ä¸Šé™ï¼</font>";

22 
G‘LškLi¡
(
$dsql
);

23 
ex™
();

25 if(!
´eg_m©ch
("#^h‰p:\/\/#",
$u¾
)è
	g$u¾
 = "h‰p://".
HtmlR•Ïû
($url, 2);

27 
	g$t™Ë
 = 
HtmlR•Ïû
(
$t™Ë
);

28 
	g$šqu”y
 = "INSERT INTO `#@__memb”_æšk`(mid,t™Ë,u¾èVALUES(".
$cfg_ml
->
M_ID
.",'$title','$url'); ";

29 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

30 
	gecho
 "<font color='red'>æˆåŠŸå¢åŠ ä¸€é“¾æ¥ï¼</font>";

31 
G‘LškLi¡
(
$dsql
);

32 
ex™
();

34 if(
	g$dİo¡
=="del")

36 
AjaxH—d
();

37 
	g$aid
 = 
štv®
(
$aid
);

38 if(
em±y
(
$aid
)è
ex™
("<font color='red'>å‚æ•°é”™è¯¯ï¼</font>");

40 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_æšk` WHERE‡id='$aid' AND mid='".
$cfg_ml
->
M_ID
."';");

41 
	gecho
 "<font color='red'>æˆåŠŸåˆ é™¤é“¾æ¥ï¼š{$aid}</font>";

42 
G‘LškLi¡
(
$dsql
);

44 if(
	g$dİo¡
=="update")

46 
AjaxH—d
();

47 
	g$aid
 = 
štv®
(
$aid
);

48 if(!
´eg_m©ch
("#^h‰p:\/\/#", 
$u¾
)è
	g$u¾
 = "h‰p://".
HtmlR•Ïû
($url,2);

50 
	g$t™Ë
 = 
HtmlR•Ïû
(
$t™Ë
);

51 
	g$upqu”y
 = "UPDATE `#@__memb”_æšk` SET™Ë='$t™Ë',u¾='$u¾' WHERE‡id='$aid' AND mid='".
$cfg_ml
->
M_ID
."'; ";

52 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$upqu”y
);

53 if(
	g$rs
)

55 
	gecho
 "<font color='red'>æˆåŠŸæ›´æ–°é“¾æ¥ï¼š{$title}</font>";

56 
G‘LškLi¡
(
$dsql
);

57 
ex™
();

61 
	gecho
 "<font color='red'>æ›´æ–°é“¾æ¥ï¼š{$title} å¤±è´¥ï¼</font>";

62 
G‘LškLi¡
(
$dsql
);

63 
ex™
();

66 if(
	g$dİo¡
=="reload")

68 
AjaxH—d
();

69 
G‘LškLi¡
(
$dsql
);

70 
ex™
();

75 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/flink_main.htm");

76 
ex™
();

86 
funùiÚ
 
	$G‘LškLi¡
(&
$dsql
)

88 
glob®
 
$cfg_ml
;

89 
$dsql
->
	`S‘Qu”y
("SELECT * FROM `#@__memb”_æšk` WHERE mid='".
$cfg_ml
->
M_ID
."' ORDER BY‡id DESC");

90 
$dsql
->
	`Execu‹
();

91 
$j
=0;

92 
$row
 = 
$dsql
->
	`G‘A¼ay
())

94 
$j
++;

95 
$lše
 = "

96 <
div
 
şass
='item flink'>

97 <
div
 
şass
='itemHead' >

98 <
div
 
şass
='fRight'>

99 <
¥ª
 
şass
='™emDigg'><
a
 
h»f
='#' 
Úşick
='Upd©eTy³({$row['
aid
']})'>[æ›´æ–°]</a></span>

100 <
¥ª
 
şass
='™emMªage'><
a
 
h»f
='#' 
Úşick
='D–Ty³({$row['
aid
']})'>[åˆ é™¤]</a></span>

101 </
div
>

102 <
¥ª
 
şass
='™emT™Ë'>åç§°ï¼š<
šput
 
Çme
='t™Ë{$row['
aid
']}' 
ty³
='‹xt' 
id
='t™Ë{$row['aid']}' 
v®ue
='{$row['
t™Ë
']}' class='intxt' /></span>

103 <
div
 
şass
='mt5'>ç½‘å€ï¼š<
šput
 
Çme
='u¾{$row['
aid
']}' 
ty³
='‹xt' 
id
='u¾{$row['aid']}' 
v®ue
='{$row['
u¾
']}' class='intxt' /></div>

104 </
div
>

105 </
div
>

106 <
hr
 
şass
='dotted' />";

107 
echo
 
$lše
;

109 if(
$j
==0)

111 
echo
 "å°šæ— ä»»ä½•é“¾æ¥";

113 
	}
}

	@E:\web\weixun\user\guestbook_admin.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
CheckRªk
(0,0);

7 
	g$m’uty³
 = 'xakmenu';

8 
	g$m’uty³_sÚ
 = 'gu';

9 
	g$·gesize
 = 
is£t
(
$·gesize
è&& 
is_num”ic
($pagesize) ? $pagesize : 5;

10 
	g$·g’o
 = 
is£t
(
$·g’o
è&& 
is_num”ic
($·g’oè? 
	$max
(1,
$·g’o
) : 1;

11 if(
	`em±y
(
$dİo¡
)) $dopost = '';

15 if(
$dİo¡
=='getlist')

17 
	`AjaxH—d
();

18 
	`G‘Li¡
(
$dsql
,
$·g’o
,
$·gesize
);

19 
	`ex™
();

20 
	}
}

23 if(
	g$dİo¡
=='del')

25 if(!
em±y
(
$aid
))

27 
$aid
 = 
štv®
($aid);

28 
	g$dsql
->
Execu‹NÚeQu”y
("D–‘FROM `#@__memb”_gue¡book` WHERE‡id='$aid' And mid='".
$cfg_ml
->
M_ID
."'; ");

30 if(!
em±y
(
$ids
))

32 
	g$ids
 = 
´eg_»¶aû
("#[^0-9,]#", '', 
$ids
);

33 if(
	g$ids
!='')

35 
$dsql
->
Execu‹NÚeQu”y
("D–‘FROM `#@__memb”_gue¡book` WHERE‡id in($idsèAnd mid='".
$cfg_ml
->
M_ID
."'; ");

38 
AjaxH—d
();

39 
G‘Li¡
(
$dsql
, 
$·g’o
, 
$·gesize
);

40 
ex™
();

44 if(
	g$dİo¡
=='')

46 
$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*èAS dd FROM `#@__memb”_gue¡book` WHERE mid='".
$cfg_ml
->
M_ID
."'; ");

47 
	g$tÙ®Row
 = 
$row
['dd'];

48 
šşude
(
dœÇme
(
__FILE__
)."/templets/guestbook_admin.htm");

60 
funùiÚ
 
	$G‘Li¡
(&
$dsql
, 
$·g’o
, 
$·gesize
)

62 
glob®
 
$cfg_phpu¾
,
$cfg_ml
;

63 
$·gesize
 = 
	`štv®
($pagesize);

64 
$·g’o
 = 
	`štv®
($pageno);

65 
$¡¬t
 = (
$·g’o
-1è* 
$·gesize
;

66 
$dsql
->
	`S‘Qu”y
("SELECT * FROM `#@__memb”_gue¡book` WHERE mid='".
$cfg_ml
->
M_ID
."' ORDER BY‡id DESC LIMIT $start,$pagesize ");

67 
$dsql
->
	`Execu‹
();

68 
$lše
 = '';

69 
$row
 = 
$dsql
->
	`G‘A¼ay
())

72 
$lše
 .= "<table width='100%' border='0' cellpadding='0' cellspacing='0' class='list'>

73 <
th—d
>

74 <
Œ
>

75 <
th
 
cŞ¥ª
='6'><
¡rÚg
 
şass
='fLeá' 
¡yË
='·ddšg-Ëá: 5px;'>ç•™è¨€æ ‡é¢˜ï¼š".$row['t™Ë']."</¡rÚg><
¥ª
 class='fRight'>

76 <
šput
 
Çme
=\"ids\"y³=\"checkbox\" id=\"ids\" v®ue=\"".
$row
['aid']."\" />

77 <
a
 
h»f
='#' 
Úşick
='D–NÙe(".$row['
aid
'].")' 
¡yË
='cŞÜ:#29A5C9;'>åˆ é™¤</a></
¥ª
></
th
>

78 </
Œ
>

79 </
th—d
>

80 <
tbody
>

81 <
Œ
>

82 <
td
 
width
='18%' 
¡yË
='padding-left: 10px;'>ç”¨æˆ·ç§°å‘¼ï¼š".$row['uname']."</td>

83 <
td
>æ—¶é—´ï¼š".MyD©e("
Y
-
m
-
d
 
H
:
i
",$row['dtime'])."&
nb¥
;
IP
åœ°å€ï¼š".$row['ip']."&nbsp;";

85 if(!
	`em±y
(
$row
['gid']))

87 
$lše
 .= " <a href='index.php?uid={$row['uname']}&action=infos'arget='_blank'>èµ„æ–™</a> <a href='index.php?uid={$row['uname']}'arget='_blank'>ç©ºé—´</a> <a href='index.php?uid={$row['uname']}&action=guestbook'arget='_blank'>å›å¤</a> ";

89 
$lše
 .= "</td>

90 </
Œ
>

91 <
Œ
>

92 <
td
 
cŞ¥ª
='2' 
¡yË
='padding-left: 10px;'>".Text2Html($row['msg'])."</td>

93 </
Œ
>

94 </
tbody
>

95 </
bË
>";

97 
$lše
 = $line == '' ? 'æš‚æ— ç•™è¨€' : $line;

98 
echo
 
$lše
;

99 
	}
}

	@E:\web\weixun\user\inc\archives_check.php

1 <?
php


7 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

9 
šşude_Úû
(
XAKINC
.'/image.func.php');

10 
šşude_Úû
(
XAKINC
.'/oxwindow.class.php');

12 
	g$sv®i
 = 
G‘CkVdV®ue
();

13 if(
´eg_m©ch
("/3/",
$§ã_gdİ’
)){

14 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

16 
Re£tVdV®ue
();

17 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

18 
ex™
();

22 
	g$çqkey
 = 
is£t
(
$çqkey
è&& 
is_num”ic
($faqkey) ? $faqkey : 0;

23 
	g$§ã_çq_£nd
 = 
is£t
(
$§ã_çq_£nd
è&& 
is_num”ic
($safe_faq_send) ? $safe_faq_send : 0;

24 if(
	g$§ã_çq_£nd
 == '1')

26 if(
$§ãçqs
[
$çqkey
]['ªsw”'] !ğ
$§ãªsw”
 || $safeanswer=='')

28 
ShowMsg
('éªŒè¯é—®é¢˜ç­”æ¡ˆé”™è¯¯', '-1');

29 
ex™
();

33 
	g$æag
 = '';

34 
	g$autokey
 = 
$»mÙe
 = 
$d–lšk
 = 
$autŞ™pic
 = 0;

35 
	g$u£r
 = 
G‘IP
();

37 if(
	g$ty³id
==0)

39 
ShowMsg
('è¯·æŒ‡å®šæ–‡æ¡£éš¶å±çš„æ ç›®ï¼', '-1');

40 
ex™
();

43 
	g$qu”y
 = "Selectp.ispart,tp.channeltype,tp.issend,ch.issend‡s cissend,ch.sendrank,ch.arcsta,ch.addtable,ch.fieldset,ch.usertype

44 
From
 `#@
__¬ùy³
` 

 
Ëá
 
još
 `#@
__chªÃÉy³
` 
ch
 
Ú
 ch.
id
ñp.
chªÃÉy³
 
wh”e
p.id='$typeid' ";

45 
$cInfos
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

48 if(
	g$cInfos
['is£nd']!=1 || 
$cInfos
['i¥¬t']!=0 || $cInfos['chªÃÉy³']!=
$chªÃlid
 || $cInfos['cissend']!=1)

50 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸æ”¯æŒæŠ•ç¨¿ï¼","-1");

51 
ex™
();

55 if(
	g$cInfos
['£nd¿nk'] > 
	g$cfg_ml
->
	gM_Rªk
 )

57 
	g$row
 = 
$dsql
->
G‘OÃ
("S–eù memb”ÇmFrom #@__¬üªk wh”¿nk='".
$cInfos
['sendrank']."' ");

58 
ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$row
['membername']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

59 
ex™
();

62 if(
	g$cInfos
['u£¹y³'] !='' && 
$cInfos
['u£¹y³'] !ğ
$cfg_ml
->
M_MbTy³
)

64 
ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$cInfos
['usertype']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

65 
ex™
();

69 if(
	g$cInfos
['arcsta']==0)

71 
$ismake
 = 0;

72 
	g$¬üªk
 = 0;

74 if(
	g$cInfos
['arcsta']==1)

76 
$ismake
 = -1;

77 
	g$¬üªk
 = 0;

81 
	g$ismake
 = 0;

82 
	g$¬üªk
 = -1;

86 
	g$mÚey
 = 0;

87 
	g$æag
 = 
$shÜ‰™Ë
 = 
$cŞÜ
 = 
$sourû
 = '';

88 
	g$sÜŒªk
 = 
$£ndd©e
 = 
$pubd©e
 = 
time
();

89 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
,1),
$cfg_t™Ë_maxËn
);

90 
	g$wr™”
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$wr™”
,1),20);

91 if(
em±y
(
$desütiÚ
)è
	g$desütiÚ
 = '';

92 
	g$desütiÚ
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$desütiÚ
,1),250);

93 
	g$keywÜds
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$gs
,1),30);

94 
	g$mid
 = 
$cfg_ml
->
M_ID
;

97 
	g$l™pic
 = 
Memb”U¶ßds
('l™pic', '', 
$cfg_ml
->
M_ID
, 'image', '', 
$cfg_ddimg_width
, 
$cfg_ddimg_height
, 
FALSE
);

98 if(
	g$l™pic
!=''è
SaveU¶ßdInfo
(
$t™Ë
,
$l™pic
,1);

101 if(
	g$cfg_mb_ckt™Ë
=='Y')

103 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__archives` WHEREitle LIKE '$title' ");

104 if(
is_¬¿y
(
$row
))

106 
ShowMsg
("å¯¹ä¸èµ·ï¼Œè¯·ä¸è¦å‘å¸ƒé‡å¤æ–‡æ¡£ï¼","-1","0",5000);

107 
ex™
();

	@E:\web\weixun\user\inc\archives_check_edit.php

1 <?
php


7 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

9 
»quœe_Úû
(
XAKINC
."/image.func.php");

10 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

12 
	g$æag
 = '';

13 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

14 
	g$u£r
 = 
G‘IP
();

15 
	g$sv®i
 = 
G‘CkVdV®ue
();

16 if(
´eg_m©ch
("/3/",
$§ã_gdİ’
)){

17 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

19 
Re£tVdV®ue
();

20 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

21 
ex™
();

24 if(
	g$ty³id
==0)

26 
ShowMsg
('è¯·æŒ‡å®šæ–‡æ¡£éš¶å±çš„æ ç›®ï¼','-1');

27 
ex™
();

29 
	g$qu”y
 = "SELECTp.ispart,tp.channeltype,tp.issend,ch.issend‡s cissend,ch.sendrank,ch.arcsta,ch.addtable,ch.fieldset,ch.usertype

30 
FROM
 `#@
__¬ùy³
` 

 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
ñp.
chªÃÉy³
 
WHERE
p.id='$typeid' ";

31 
$cInfos
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

32 
	g$addbË
 = 
$cInfos
['addtable'];

35 if(
	g$cInfos
['is£nd']!=1 || 
$cInfos
['i¥¬t']!=0|| $cInfos['chªÃÉy³']!=
$chªÃlid
 || $cInfos['cissend']!=1)

37 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸æ”¯æŒæŠ•ç¨¿ï¼","-1");

38 
ex™
();

42 if(
	g$cInfos
['arcsta']==0)

44 
$ismake
 = 0;

45 
	g$¬üªk
 = 0;

47 if(
	g$cInfos
['arcsta']==1)

49 
$ismake
 = -1;

50 
	g$¬üªk
 = 0;

54 
	g$ismake
 = 0;

55 
	g$¬üªk
 = -1;

59 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
,1),
$cfg_t™Ë_maxËn
);

60 
	g$wr™”
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$wr™”
,1),20);

61 if(
em±y
(
$desütiÚ
)è
	g$desütiÚ
 = '';

62 
	g$desütiÚ
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$desütiÚ
,1),250);

63 
	g$keywÜds
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$gs
,1),30);

64 
	g$mid
 = 
$cfg_ml
->
M_ID
;

65 
	g$i§dmš
 = (
$cfg_ml
->
f›lds
['m©t']==10 ? 
Œue
 : 
çl£
);

66 ià(
	$em±y
(
$Şdl™pic
))

68 
$Şdl™pic
 = '';

69 
	}
}

72 if(
	g$l™pic
 != '')

74 
$l™pic
 = 
Memb”U¶ßds
('l™pic', 
$Şdl™pic
, 
$mid
, 'image', '', 
$cfg_ddimg_width
, 
$cfg_ddimg_height
, 
çl£
, 
$i§dmš
);

75 
SaveU¶ßdInfo
(
$t™Ë
, 
$l™pic
, 1);

79 
	g$l™pic
 =
$Şdl™pic
;

	@E:\web\weixun\user\inc\config_pay_alipay.php

1 <?
php


7 
»quœe_Úû
(
XAKMEMBER
."/paycenter/alipay/alipay_config.php");

8 
»quœe_Úû
(
XAKMEMBER
."/paycenter/alipay/alipay_service.php");

9 if(
	g$·ym’t_exp
[2] < 0) $payment_exp[2] = 0;

10 
	g$piiû_ex
 = 
$´iû
*
$·ym’t_exp
[2];

11 
	g$·¿m‘”
 = 
¬¿y
(

13 "·¹Ãr" => 
$·¹Ãr
,

14 "»tuº_u¾" => 
$»tuº_u¾
,

15 "nÙify_u¾" => 
$nÙify_u¾
,

16 "_šput_ch¬£t" => 
$_šput_ch¬£t
,

17 "subjeù" => 
$±y³
,

18 "body" => 
$²ame
,

19 "out_Œade_no" => 
$buyid
,

24 "´iû" => 
¥rštf
("%01.2f", 
$´iû
),

27 "show_u¾" => 
$show_u¾
,

28 "£Î”_ema" => 
$£Î”_ema


30 
	g$®ay
 = 
Ãw
 
®ay_£rviû
(
$·¿m‘”
,
$£cur™y_code
,
$sign_ty³
);

31 
	g$lšk
 = 
$®ay
->
ü—‹_u¾
();

33 
	gecho
 '<html>

34 <
	gh—d
>

35 <
	gt™Ë
>è½¬åˆ°æ”¯ä»˜å®æ”¯ä»˜é¡µé¢</title>

36 </
	gh—d
>

37 <
body
 
	gÚlßd
="document.alipay.submit();">

38 <
fÜm
 
Çme
="®ay" 
aùiÚ
="'.$lšk.'" 
m‘hod
="post">

39 </
fÜm
>

40 </
body
>

41 </
html
>';

42 
ex™
;

	@E:\web\weixun\user\inc\config_pay_cbpayment.php

1 <?
php


2 
»quœe_Úû
(
XAKMEMBER
."/paycenter/cbpayment/cbpayment_config.php");

3 if(
	g$·ym’t_exp
[3] < 0) $payment_exp[3] = 0;

4 
	g$piiû_ex
 = 
$´iû
*
$·ym’t_exp
[3];

6 
	g$v_oid
 = 
Œim
(
$buyid
);

7 if(
	g$piiû_ex
 > 0è
	g$´iû
 = 
$´iû
+
$piiû_ex
;

8 
	g$v_amouÁ
 = 
¥rštf
("%01.2f", 
$´iû
);

10 
	g$‹xt
 = 
$v_amouÁ
.
$v_mÚeyty³
.
$v_oid
.
$v_mid
.
$v_u¾
.
$key
;

11 
	g$v_md5šfo
 = 
¡¹ouµ”
(
md5
(
$‹xt
));

13 
	g$»m¬k1
 = 
Œim
(
$±y³
);

14 
	g$»m¬k2
 = 
Œim
(
$²ame
);

16 
	g$v_rcvÇme
 = 'ç«™é•¿';

17 
	g$v_rcvaddr
 = 'æ·±åœ³';

18 
	g$v_rcv‹l
 = '0755-83791960';

19 
	g$v_rcvpo¡
 = '100080';

20 
	g$v_rcvmobe
 = '13838384381';

22 
	g$v_Üd”Çme
 = 
$cfg_ml
->
M_U£rName
;

23 
	g$v_Üd”addr
 = 'æ·±åœ³';

24 
	g$v_Üd”‹l
 = '0755-83791960';

25 
	g$v_Üd”po¡
 = 518000;

26 
	g$v_Üd”ema
 = 'service@nps.cn';

27 
	g$v_Üd”mobe
 = 13838384581;

29 
	g$¡rReque¡U¾
 = 
$v_po¡_u¾
.'?v_mid='.
$v_mid
.'&v_oid='.
$v_oid
.'&v_amouÁ='.
$v_amouÁ
.'&v_mÚeyty³='.
$v_mÚeyty³


30 .'&v_u¾='.
$v_u¾
.'&v_md5šfo='.
$v_md5šfo
.'&»m¬k1='.
$»m¬k1
.'&»m¬k2='.
$»m¬k2
;

32 
	gecho
 '<html>

33 <
	gh—d
>

34 <
	gt™Ë
>è½¬åˆ°ç½‘é“¶åœ¨çº¿æ”¯ä»˜é¡µé¢</title>

35 </
	gh—d
>

36 <
body
 
	gÚlßd
="document.cbpayment.submit();">

37 <
fÜm
 
Çme
="cb·ym’t" 
aùiÚ
="'.$¡rReque¡U¾.'" 
m‘hod
="post">

38 </
fÜm
>

39 </
body
>

40 </
html
>';

41 
ex™
;

	@E:\web\weixun\user\inc\config_pay_nps.php

1 <?
php


3 
šşude_Úû
 
	gXAKMEMBER
.'/paycenter/nps/nps_config.inc.php';

5 if(
	g$·ym’t_exp
[1] < 0.01) $payment_exp[1] = 0;

6 
	g$piiû_ex
 = 
$´iû
*
$·ym’t_exp
[1];

7 
	g$´iû
 = 
$´iû
+
$piiû_ex
;

9 
funùiÚ
 
	$HexToSŒ
(
$hex
)

11 
$¡ršg
="";

12 
$i
=0;$i<
	`¡¾’
(
$hex
)-1;$i+=2){ 
$¡ršg
.=
	`chr
(
	`hexdec
($hex[$i].$hex[$i+1])); }

13  
$¡ršg
;

14 
	}
}

16 
funùiÚ
 
	$SŒToHex
(
$¡ršg
)

18 
$hex
="";

19 
$i
=0;$i<
	`¡¾’
(
$¡ršg
);$i++){ 
$hex
.=
	`dechex
(
	`Üd
($string[$i])); }

20 
$hex
=
	`¡¹ouµ”
($hex);

21  
$hex
;

22 
	}
}

25 
	g$m_Ïnguage
 = 1;

26 
	g$s_Çme
 = "é™ˆåº·";

27 
	g$s_addr
 = "æ·±åœ³";

28 
	g$s_po¡code
 = 518000;

29 
	g$s_‹l
 = "0755-83791960";

30 
	g$r_Çme
 = "é™ˆå¤§åº·";

31 
	g$r_addr
 = "æ·±åœ³";

32 
	g$r_po¡code
 = 100080;

33 
	g$r_‹l
 = "010-81234567";

34 
	g$r_eml
 = "service@nps.cn";

35 
	g$m_¡©us
 = 0;

36 
	g$m_ocu¼’cy
 = 1;

38 
	g$m_id
 = 
$cfg_m”chªt
;

39 
	g$m_Üd”id
 = 
$buyid
;

40 
	g$m_ßmouÁ
 = 
$´iû
;

41 
	g$m_u¾
 = 
$cfg_ba£ho¡
."/paycenter/nps/pay_back_nps.php";

42 
	g$m_ocomm’t
 = 
$cfg_ml
->
M_ID
;

43 
	g$mod©e
 = 
G‘D©eTimeMk
(
$mtime
);

47 
	g$m_šfo
 = 
$m_id
."|".
$m_Üd”id
."|".
$m_ßmouÁ
."|".
$m_ocu¼’cy
."|".
$m_u¾
."|".
$m_Ïnguage
;

48 
	g$s_šfo
 = 
$s_Çme
."|".
$s_addr
."|".
$s_po¡code
."|".
$s_‹l
."|".
$s_eml
;

49 
	g$r_šfo
 = 
$r_Çme
."|".
$r_addr
."|".
$r_po¡code
."|".
$r_‹l
."|".
$r_eml
."|".
$m_ocomm’t
."|".
$m_¡©us
."|".
$mod©e
;

51 
	g$Ord”Info
 = 
$m_šfo
."|".
$s_šfo
."|".
$r_šfo
;

54 
	g$Ord”Info
 = 
SŒToHex
(
$Ord”Info
);

55 
	g$dige¡
 = 
¡¹ouµ”
(
md5
(
$Ord”Info
.
$cfg_m”·sswÜd
));

57 
	g$¡rReque¡U¾
 = 
$·ym’t_u¾
.'?Ord”Mes§ge='.
$Ord”Info
.'&dige¡='.
$dige¡
.'&M_ID='.
$cfg_m”chªt
;

60 
	gecho
 '<html>

61 <
	gh—d
>

62 <
	gt™Ë
>è½¬åˆ°
	gNPS
æ”¯ä»˜é¡µé¢</title>

63 </
	gh—d
>

64 <
body
 
	gÚlßd
="document.nps.submit();">

65 <
fÜm
 
Çme
="Ås" 
aùiÚ
="'.$¡rReque¡U¾.'" 
m‘hod
="post">

66 </
fÜm
>

67 </
body
>

68 </
html
>';

69 
ex™
;

	@E:\web\weixun\user\inc\config_pay_tenpay.php

1 <?
php


4 
	g$¡rSpid
 = 
$·ym’t_u£rid
[0];

6 
	g$¡rSpkey
 = 
$·ym’t_key
[0];

17 if(!
is£t
(
$BªkTy³
)è
	g$BªkTy³
 = 0;

18 
	g$BªkTy³
 = 
´eg_»¶aû
("#[^0-9]#","",
$BªkTy³
);

19 if(
	g$BªkTy³
 < 1) $BankType = 0;

20 
	g$¡rBªkTy³
ğ
$BªkTy³
;

21 
	g$¡rCmdNo
 = "1";

22 
	g$¡rBlD©e
ğ
d©e
('Ymd');

24 if(!
is£t
(
$²ame
)è
	g$²ame
 = 'æœåŠ¡è´­ä¹°';

25 
	g$¡rDesc
 = 
$²ame
;

27 
	g$¡rBuy”Id
 = "";

29 
	g$¡rS®”
 = 
$·ym’t_u£rid
[0];

31 if(
	g$·ym’t_exp
[0] < 0) $payment_exp[0] = 0;

32 
	g$piiû_ex
 = 
$´iû
*
$·ym’t_exp
[0];

33 
	g$´iû
 = 
$´iû
+
$piiû_ex
;

35 
	g$¡rTÙ®F“
 = 
$´iû
*100;

36 ifĞ
	g$¡rTÙ®F“
 < 1){

37 
	g$dsql
->
Clo£
();

38 
ex™
('é‡‘é¢ä¸å¯¹');

40 
	g$¡rSpBlNo
 = 
$buyid
;;

45 
	g$¡rT¿n§ùiÚId
 = 
$¡rSpid
 . 
$¡rBlD©e
 . 
time
();

47 
	g$¡rF“Ty³
 = "1";

49 
	g$¡rR‘U¾
 = 
$cfg_ba£ho¡
."/user/paycenter/tenpay/notify_handler.php";

51 
	g$¡rA‰ach
 = "my_magic_string";

53 
	g$¡rSignText
 = "cmdno=" . 
$¡rCmdNo
 . "&d©e=" . 
$¡rBlD©e
 . "&b¬gašÜ_id=" . 
$¡rS®”
 .

54 "&Œª§ùiÚ_id=" . 
$¡rT¿n§ùiÚId
 . "&¥_bÊo=" . 
$¡rSpBlNo
 .

55 "&tÙ®_ãe=" . 
$¡rTÙ®F“
 . "&ãe_ty³=" . 
$¡rF“Ty³
 . "&»tuº_u¾=" . 
$¡rR‘U¾
 .

56 "&©ch=" . 
$¡rA‰ach
 . "&key=" . 
$¡rSpkey
;

57 
	g$¡rSign
 = 
¡¹ouµ”
(
md5
(
$¡rSignText
));

60 
	g$¡rReque¡
 = "cmdno=" . 
$¡rCmdNo
 . "&d©e=" . 
$¡rBlD©e
 . "&b¬gašÜ_id=" . 
$¡rS®”
 .

61 "&Œª§ùiÚ_id=" . 
$¡rT¿n§ùiÚId
 . "&¥_bÊo=" . 
$¡rSpBlNo
 .

62 "&tÙ®_ãe=" . 
$¡rTÙ®F“
 . "&ãe_ty³=" . 
$¡rF“Ty³
 . "&»tuº_u¾=" . 
$¡rR‘U¾
 .

63 "&©ch=" . 
$¡rA‰ach
 . "&bªk_ty³=" . 
$¡rBªkTy³
 . "&desc=" . 
$¡rDesc
 .

64 "&purcha£r_id=" . 
$¡rBuy”Id
 .

65 "&sign=" . 
$¡rSign
 ;

66 
	g$¡rReque¡U¾
 = "h‰ps://www.‹Åay.com/cgi-bš/v1.0/·y_g©e.cgi?".
$¡rReque¡
;

69 if(
	g$cfg_soá_Ïng
 == 'utf-8')

71 
$¡rReque¡U¾
 = 
utf82gb
($strRequestUrl);

72 
	gecho
 '<html>

73 <
	gh—d
>

74 <
	gt™Ë
>è½¬åˆ°è´¢ä»˜é€šæ”¯ä»˜é¡µé¢</title>

75 </
	gh—d
>

76 <
body
 
	gÚlßd
="document.tenpay.submit();">

77 <
fÜm
 
Çme
="‹Åay" 
aùiÚ
="·yûÁ”/‹Åay/‹Åay_gbk_·ge.php?¡rReU¾='.u¾’code($¡rReque¡U¾).'" 
m‘hod
="post">

78 </
fÜm
>

79 </
body
>

80 </
html
>';

82 
	gecho
 '<html>

83 <
	gh—d
>

84 <
	gt™Ë
>è½¬åˆ°è´¢ä»˜é€šæ”¯ä»˜é¡µé¢</title>

85 </
	gh—d
>

86 <
body
 
	gÚlßd
="document.tenpay.submit();">

87 <
fÜm
 
Çme
="‹Åay" 
aùiÚ
="'.$¡rReque¡U¾.'" 
m‘hod
="post">

88 </
fÜm
>

89 </
body
>

90 </
html
>';

92 
	gex™
;

	@E:\web\weixun\user\inc\config_pay_yeepay.php

1 <?
php


2 
šşude_Úû
 
	gXAKMEMBER
.'/paycenter/yeepay/yeepay_config.php';

4 if(
	g$·ym’t_exp
[4] < 0) $payment_exp[4] = 0;

5 
	g$piiû_ex
 = 
$´iû
*
$·ym’t_exp
[4];

7 if(
	g$piiû_ex
 > 0è
	g$´iû
 = 
$´iû
+
$piiû_ex
;

10 ##æ˜“å®æ”¯ä»˜å¹³å°ç»Ÿä¸€ä½¿ç”¨
GBK
/
GB2312
ç¼–ç æ–¹å¼,å‚æ•°å¦‚ç”¨åˆ°ä¸­æ–‡ï¼Œè¯·æ³¨æ„è½¬ç 

14 
	g$p2_Ord”
 = 
Œim
(
$buyid
);

18 
	g$p3_Amt
 = 
$´iû
;

21 
	g$p4_Cur
 = "CNY";

25 
	g$p5_Pid
 = 
Œim
(
$²ame
);

28 
	g$p6_Pÿt
 = 
Œim
(
$±y³
);

31 
	g$p7_Pdesc
 = '';

34 
	g$p8_U¾
 = 
$cfg_ba£ho¡
.'/user/paycenter/yeepay/callback.php';

37 ##å•†æˆ·å¯ä»¥ä»»æ„å¡«å†™1
K
 çš„å­—ç¬¦ä¸²,æ”¯ä»˜æˆåŠŸæ—¶å°†åŸæ ·è¿”å›.

38 
	g$·_MP
 = 'member';

42 
	g$´_N“dRe¥Ú£
 = 1;

46 
	g$pd_F½Id
 = '';

48 
	g$hmac
 = 
g‘ReqHmacSŒšg
(
$p2_Ord”
,
$p3_Amt
,
$p4_Cur
,
$p5_Pid
,
$p6_Pÿt
,
$p7_Pdesc
,
$p8_U¾
,
$·_MP
,
$pd_F½Id
,
$´_N“dRe¥Ú£
);

49 
	g$»qURL_ÚLšeCmd
 = 'paycenter/yeepay/yeepay_gbk.php';

50 
	gecho
 '

51 <
	ghtml
>

52 <
	gh—d
>

53 <
	gt™Ë
>
To
 
Y“Pay
 
	gPage
</title>

54 <
body
 
	gÚlßd
="document.yeepay.submit();">

55 <
fÜm
 
Çme
="y“·y" 
aùiÚ
="'.$»qURL_ÚLšeCmd.'" 
m‘hod
="post">

56 <
šput
 
ty³
="hidd’" 
Çme
="p0_Cmd" 
v®ue
="'.$p0_Cmd.'">

57 <
šput
 
ty³
="hidd’" 
Çme
="p1_M”Id" 
v®ue
="'.$p1_MerId.'">

58 <
šput
 
ty³
="hidd’" 
Çme
="p2_Ord”" 
v®ue
="'.$p2_Order.'">

59 <
šput
 
ty³
="hidd’" 
Çme
="p3_Amt" 
v®ue
="'.$p3_Amt.'">

60 <
šput
 
ty³
="hidd’" 
Çme
="p4_Cur" 
v®ue
="'.$p4_Cur.'">

61 <
šput
 
ty³
="hidd’" 
Çme
="p5_Pid" 
v®ue
="'.$p5_Pid.'">

62 <
šput
 
ty³
="hidd’" 
Çme
="p6_Pÿt" 
v®ue
="'.$p6_Pcat.'">

63 <
šput
 
ty³
="hidd’" 
Çme
="p7_Pdesc" 
v®ue
="'.$p7_Pdesc.'">

64 <
šput
 
ty³
="hidd’" 
Çme
="p8_U¾" 
v®ue
="'.$p8_Url.'">

65 <
šput
 
ty³
="hidd’" 
Çme
="p9_SAF" 
v®ue
="'.$p9_SAF.'">

66 <
šput
 
ty³
="hidd’" 
Çme
="·_MP" 
v®ue
="'.$pa_MP.'">

67 <
šput
 
ty³
="hidd’" 
Çme
="pd_F½Id" 
v®ue
="'.$pd_FrpId.'">

68 <
šput
 
ty³
="hidd’" 
Çme
="´_N“dRe¥Ú£" 
v®ue
="'.$pr_NeedResponse.'">

69 <
šput
 
ty³
="hidd’" 
Çme
="hmac" 
v®ue
="'.$hmac.'">

70 <
šput
 
ty³
="hidd’" 
Çme
="Ïng" 
v®ue
="'.$cfg_soft_lang.'">

71 <
šput
 
ty³
="hidd’" 
Çme
="»qURL_ÚLše" 
v®ue
="'.$reqURL_onLine.'">

72 </
fÜm
>

73 </
body
>

74 </
html
>';exit;

	@E:\web\weixun\user\inc\config_space.php

1 <?
php


7 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

10 if(
	g$cfg_mb_İ’
=='N')

12 
ShowMsg
("ç³»ç»Ÿå…³é—­äº†ä¼šå‘˜åŠŸèƒ½ï¼Œå› æ­¤ä½ æ— æ³•è®¿é—®æ­¤é¡µé¢ï¼","javascript:;");

13 
ex™
();

17 if(
´eg_m©ch
("/'/", 
$uid
)){

18 
ShowMsg
("æ‚¨çš„ç”¨æˆ·åä¸­å«æœ‰éæ³•å­—ç¬¦ï¼", "-1");

19 
ex™
();

21 
	g$uid
=
RemoveXSS
(
$uid
);

25 
	g$_v¬s
 = 
G‘U£rS·ûInfos
();

26 
	g$_v¬s
['bloglšks'] = 
$_v¬s
['curtitle'] = '';

31 if(
	g$_v¬s
['spacesta'] == -2)

33 
ShowMsg
("ç”¨æˆ·ï¼š{$_vars['userid']} è¢«ç¦è¨€ï¼Œå› æ­¤ä¸ªäººç©ºé—´ç¦æ­¢è®¿é—®ï¼", "-1");

34 
ex™
();

37 if(
	g$_v¬s
['spacesta'] < 0)

39 
ShowMsg
("ç”¨æˆ·ï¼š{$_vars['userid']} çš„èµ„æ–™å°šæœªé€šè¿‡å®¡æ ¸ï¼Œå› æ­¤ç©ºé—´ç¦æ­¢è®¿é—®ï¼", "-1");

40 
ex™
();

43 ifĞ!
is£t
(
$_v¬s
['m©t']èè
	g$_v¬s
['matt'] = 0;

44 if(
	g$_v¬s
['m©t'] =ğ10 && 
$cfg_mb_admšlock
=='Y'

45 && !(
is£t
(
$cfg_ml
->
f›lds
) && $cfg_ml->fields['matt']==10))

47 
ShowMsg
('ç³»ç»Ÿè®¾ç½®äº†ç¦æ­¢è®¿é—®ç®¡ç†å‘˜çš„ä¸ªäººç©ºé—´ï¼', '-1');

48 
ex™
();

53 if(
	g$_v¬s
['spacestyle']=='')

55 if(
$_v¬s
['mtype']=='ä¸ªäºº') {

56 
$_v¬s
['spacestyle'] = 'person';

58 if(
	g$_v¬s
['mtype']=='ä¼ä¸š') {

59 
$_v¬s
['spacestyle'] = 'company';

62 
	g$_v¬s
['spacestyle'] = 'person';

66 if(!
is_dœ
(
XAKMEMBER
.'/¥aû/'.
$_v¬s
['spacestyle']))

68 
	g$_v¬s
['spacestyle'] = 'person';

72 
	g$mty³¬r
 = 
¬¿y
();

73 
	g$dsql
->
Execu‹
('mty', "£Ëù * from `#@__mty³s` wh”mid='".
$_v¬s
['mid']."'");

74 
	g$row
 = 
$dsql
->
G‘A¼ay
('mty'))

76 
$mty³¬r
[] = 
$row
;

80 
	g$_v¬s
['bloglšks'] = 
¬¿y
();

81 
	g$qu”y
 = "SELECTp.channeltype,ch.typename FROM `#@__arctype`p

82 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
Ú
 ch.
id
=

.
chªÃÉy³


83 
WHERE
 (
ch
.
u£¹y³
='' 
OR
 ch.u£¹y³ 
LIKE
 '{$_v¬s['
mty³
']}'è
And
 

.
chªÃÉy³
<>1 Andp.
is£nd
=1 Andp.
ishidd’
=0 
GROUP
 
BY
p.chªÃÉy³ 
ORDER
 BY 
	$ABS
(

.
chªÃÉy³
è
asc
";

84 
$dsql
->
	`Execu‹
('ùc', 
$qu”y
);

85  
$row
 = 
$dsql
->
	`G‘A¼ay
('ctc') )

87 
$_v¬s
['bloglšks'][
$row
['channeltype']] = $row['typename'];

88 
	}
}

92 if(
	g$_v¬s
['mtype']=='ä¼ä¸š')

94 
»quœe_Úû
(
XAKINC
.'/enums.func.php');

95 
	g$qu”y
 = "SELECT * FROM `#@__memb”_com·ny` WHERE mid='".
$_v¬s
['mid']."'";

96 
	g$com·ny
 = 
$db
->
G‘OÃ
(
$qu”y
);

97 
	g$com·ny
['voÿtiÚ'] = 
G‘EnumsV®ue
('voÿtiÚ', 
$com·ny
['vocation']);

98 
	g$com·ny
['cosize'] = 
G‘EnumsV®ue
('cosize', 
$com·ny
['cosize']);

99 
	g$tmµÏû
 = 
G‘EnumsTy³s
(
$com·ny
['place']);

100 
	g$´ovšûid
 = 
$tmµÏû
['top'];

101 
	g$´ovšûÇme
 = (
is£t
(
$em_Çtiv•Ïûs
[
$´ovšûid
]) ? $em_nativeplaces[$provinceid] : '');

102 
	g$c™yÇme
 = (
is£t
(
$em_Çtiv•Ïûs
[
$tmµÏû
['son']]) ? $em_nativeplaces[$tmpplace['son']] : '');

103 
	g$com·ny
['¶aû'] = 
$´ovšûÇme
.' - '.
$c™yÇme
;

104 
	g$_v¬s
 = 
¬¿y_m”ge
(
$com·ny
, 
$_v¬s
);

105 if(
	g$aùiÚ
 =ğ'šfos'è
$aùiÚ
 = 'introduce';

106 
	g$_v¬s
['comçû'] = 
em±y
(
$_v¬s
['comface']) ? '/user/templets/images/mylogo.jpg' : $_vars['comface'];

114 
funùiÚ
 
	$G‘U£rS·ûInfos
()

116 
glob®
 
$dsql
,
$uid
,
$cfg_memb”u¾
;

117 
$_v¬s
 = 
	`¬¿y
();

118 
$u£rid
 = 
	`´eg_»¶aû
("#[\r\n\ˆ\*%]#", '', 
$uid
);

119 
$qu”y
 = "SELECT m.mid,m.mtype,m.userid,m.uname,m.sex,m.rank,m.email,m.scores,

120 
m
.
¥aû¡a
,m.
çû
,m.
logštime
,

121 
s
.*,
t
.*,
m
.
m©t
,
r
.
memb”Çme
,
g
.
msg


122 
From
 `#@
__memb”_li¡
` 
m


123 
LEFT
 
JOIN
 `#@
__memb”_¥aû
` 
s
 
Ú
 s.
mid
=
m
.mid

124 
LEFT
 
JOIN
 `#@
__memb”_tj
` 
t
 
Ú
.
mid
=
m
.mid

125 
LEFT
 
JOIN
 `#@
__¬üªk
` 
r
 
Ú
„.
¿nk
=
m
.rank

126 
LEFT
 
JOIN
 `#@
__memb”_msg
` 
g
 
Ú
 g.
mid
=
m
.mid

127 
wh”e
 
m
.
u£rid
 
like
 '$uid' 
ORDER
 
BY
 
g
.
dtime
 
DESC
 ";

128 
$_v¬s
 = 
$dsql
->
	`G‘OÃ
(
$qu”y
);

129 if(!
	`is_¬¿y
(
$_v¬s
))

131 
	`ShowMsg
("ä½ è®¿é—®çš„ç”¨æˆ·å¯èƒ½å·²ç»è¢«åˆ é™¤ï¼","javascript:;");

132 
	`ex™
();

134 if(
$_v¬s
['face']=='')

136 
$_v¬s
['face']=($_vars['sex']=='å¥³')? 'templets/images/dfgirl.png' : 'templets/images/dfboy.png';

138 
$_v¬s
['u£rid_e'] = 
	`u¾’code
($_vars['userid']);

139 
$_v¬s
['u£ru¾'] = 
$cfg_memb”u¾
."/index.php?uid=".$_vars['userid_e'];

140 if(
$_v¬s
['membername']=='å¼€æ”¾æµè§ˆ') $_vars['membername'] = 'é™åˆ¶ä¼šå‘˜';

141  
$_v¬s
;

142 
	}
}

	@E:\web\weixun\user\inc\inc_archives_functions.php

1 <?
php


7 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

8 
»quœe_Úû
(
XAKINC
.'/image.func.php');

9 
»quœe_Úû
(
XAKINC
.'/archives.func.php');

10 
»quœe_Úû
(
XAKINC
."/userlogin.class.php");

13 
CheckNÙAÎow
();

23 
funùiÚ
 
	$G‘CurCÚ‹ÁAlbum
(
$body
,
$rfu¾
,&
$fœ¡dd
)

25 
glob®
 
$cfg_muÉi_s™e
,
$cfg_ba£ho¡
,
$ddmaxwidth
,
$cfg_ba£dœ
,
$·ge¡yË
,
$cfg_mb_rmdown
,
$t™Ë
,
$cfg_ml
,
$cfg_u£r_dœ
;

26 
	`šşude_Úû
(
XAKINC
."/xakcollection.func.php");

27 if(
	`em±y
(
$ddmaxwidth
)) $ddmaxwidth = 240;

28 
$rsimg
 = '';

29 
$ba£ho¡
 = "h‰p://".
$_SERVER
["HTTP_HOST"];

30 
$img_¬¿y
 = 
	`¬¿y
();

31 
	`´eg_m©ch_®l
("/(¤c|SRC)=[\"|'| ]{0,}(h‰p:\/\/([^>]*)\.(gif|jpg|²g))/isU", 
$body
, 
$img_¬¿y
);

32 
$img_¬¿y
 = 
	`¬¿y_unique
($img_array[2]);

33 
$imgU¾
 = 
$cfg_u£r_dœ
."/".
$cfg_ml
->
M_ID
;

34 
$imgP©h
 = 
$cfg_ba£dœ
.
$imgU¾
;

35 if(!
	`is_dœ
(
$imgP©h
."/"))

37 
	`MkdœAÎ
(
$imgP©h
,
$GLOBALS
['cfg_dir_purview']);

38 
	`Clo£F
();

40 
$mliSecÚd
 = 
	`MyD©e
("ymdHis",
	`time
());

41 
	`fÜ—ch
(
$img_¬¿y
 
as
 
$key
 => 
$v®ue
)

43 if(
	`´eg_m©ch
("#".
$ba£ho¡
."#i", 
$v®ue
))

47 if(
$cfg_ba£ho¡
!=
$ba£ho¡
 && 
	`´eg_m©ch
("#".$cfg_ba£ho¡."#i", 
$v®ue
))

51 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$v®ue
))

55 if(
$cfg_mb_rmdown
=='Y')

57 
$v®ue
 = 
	`Œim
($value);

58 
$™y³
 = 
	`sub¡r
(
$v®ue
,-4,4);

59 if(!
	`´eg_m©ch
("#\.(gif|jpg|²g)#i", 
$™y³
)) $itype = ".jpg";

60 
$ºdFeName
 = 
$imgP©h
."/".
$mliSecÚd
.
$key
.
$™y³
;

61 
$iu¾
 = 
$imgU¾
."/".
$mliSecÚd
.
$key
.
$™y³
;

65 
$rs
 = 
	`DownImageK“p
(
$v®ue
, 
$rfu¾
, 
$ºdFeName
, '', 0, 30);

66 if(
$rs
)

68 if(
$·ge¡yË
 > 2)

70 
$l™piúame
 = 
	`G‘ImageM­DD
(
$iu¾
,
$ddmaxwidth
);

71 if(
$l™piúame
!=''è
	`SaveU¶ßdInfo
(
$t™Ë
,$l™piúame,1,
$addšfos
);

75 
$l™piúame
 = '';

77 if(
	`em±y
(
$fœ¡dd
))

79 
$fœ¡dd
 = 
$l™piúame
;

80 if(!
	`fe_exi¡s
(
$cfg_ba£dœ
.
$fœ¡dd
)è$fœ¡dd = 
$iu¾
;

82 @
	`W©”Img
(
$ºdFeName
,'down');

83 
$šfo
 = '';

84 
$imgšfos
 = 
	`G‘ImageSize
(
$ºdFeName
,
$šfo
);

85 
	`SaveU¶ßdInfo
(
$t™Ë
,
$iu¾
,1,
$imgšfos
);

86 
$rsimg
 .ğ"{xak:img ddimg='$l™piúame'ext='' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

91 
$rsimg
 .= "{xak:img ddimg='$value'ext='' width='0' height='0'} $value {/xak:img}\r\n";

94  
$rsimg
;

95 
	}
}

105 
funùiÚ
 
G‘ImageM­DD
(
$f’ame
, 
$ddm
, 
$ŞdÇme
='')

107 if(
$ŞdÇme
!='' && !
´eg_m©ch
("#^http:\/\/#i", $oldname))

109 
	g$ddpicok
 = 
$ŞdÇme
;

113 
	g$ddn
 = 
sub¡r
(
$f’ame
,-3);

114 
	g$ddpicok
 = 
´eg_»¶aû
("#\.".
$ddn
."$#", "-Í.".$ddn, 
$f’ame
);

116 
	g$toFe
 = 
$GLOBALS
['cfg_ba£dœ'].
$ddpicok
;

117 
ImageResize
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
, 
$ddm
, 300, 
$toFe
);

118  
	g$ddpicok
;

130 
funùiÚ
 
SaveU¶ßdInfo
(
$t™Ë
,
$f’ame
,
$meda™y³
=1,
$addšfos
='')

132 
glob®
 
$dsql
,
$cfg_ml
,
$cfg_ba£dœ
;

133 if(
	g$f’ame
=='')

135  
FALSE
;

137 if(!
is_¬¿y
(
$addšfos
))

139 
	g$addšfos
[0] = 
$addšfos
[1] = $addinfos[2] = 0;

141 if(
	g$meda™y³
==1)

143 
$šfo
 = '';

144 
	g$addšfos
 = 
G‘ImageSize
(
$cfg_ba£dœ
.
$f’ame
,
$šfo
);

146 
	g$addšfos
[2] = @
fesize
(
$cfg_ba£dœ
.
$f’ame
);

147 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT‡id,t™Ë,u¾ FROM `#@__u¶ßds` WHERE u¾ LIKE '$f’ame' AND mid='".
$cfg_ml
->
M_ID
."'; ");

148 
	g$u±ime
 = 
time
();

149 if(
is_¬¿y
(
$row
))

151 
	g$qu”y
 = "UPDATE `#@__uploads` SETitle='$title',mediatype='$medaitype',

152 
width
='{$addšfos[0]}',
	gheight
='{$addšfos[1]}',
	gfesize
='{$addšfos[2]}',
	gu±ime
='$uptime'

153 
WHERE
 
aid
='{$row['aid']}'; ";

154 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

158 
	g$šqu”y
 = "INSERT INTO `#@__uploads`(title,url,mediatype,width,height,playtime,filesize,uptime,mid)

159 
VALUES
 ('$title','$filename','$medaitype','".$addinfos[0]."','".$addinfos[1]."','0','".$addinfos[2]."','$uptime','".$cfg_ml->M_ID."'); ";

160 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

162 
	g$fid
 = 
$dsql
->
G‘La¡ID
();

163 
AddMyAddÚ
(
$fid
, 
$f’ame
);

164  
	gTRUE
;

173 
funùiÚ
 
	$G‘FÜmI‹mA
(
$ùag
)

175  
	`G‘FÜmI‹m
(
$ùag
,'member');

176 
	}
}

188 
funùiÚ
 
G‘F›ldV®ueA
(
$dv®ue
,
$dty³
,
$aid
=0,
$job
='add',
$addv¬
='')

190  
G‘F›ldV®ue
(
$dv®ue
,
$dty³
,
$aid
,
$job
,
$addv¬
,'member');

200 
funùiÚ
 
	$G‘FÜmI‹mV®ueA
(
$ùag
,
$fv®ue
)

202  
	`G‘FÜmI‹mV®ue
(
$ùag
,
$fv®ue
,'member');

203 
	}
}

214 
funùiÚ
 
PrštAutoF›ldsAdd
(&
$f›ld£t
, 
$lßdty³
='®l', 
$i¥ršt
=
TRUE
)

216 
glob®
 
$cfg_cook›_’code
;

217 
	g$d
 = 
Ãw
 
XakTagP¬£
();

218 
	g$d
->
S‘NameS·û
('field','<','>');

219 
	g$d
->
LßdSourû
(
$f›ld£t
);

220 
	g$xak_addÚf›lds
 = '';

221 
	g$addÚf›ld¢ame
 = '';

222 if(
is_¬¿y
(
$d
->
CTags
))

224 
fÜ—ch
(
$d
->
CTags
 
as
 
$tid
=>
$ùag
)

226 if(
$lßdty³
!='autof›ld' || 
$ùag
->
G‘A‰
('autofield')==1 )

228 
$xak_addÚf›lds
 .ğĞ$xak_addÚf›lds=="" ? 
$ùag
->
G‘Name
().",".$ùag->
G‘A‰
('type') : ";".$ctag->GetName().",".$ctag->GetAtt('type') );

229 
	g$addÚf›ld¢ame
 .ğ",".
$ùag
->
G‘Name
();

230 ià(
	g$i¥ršt
è
echo
 
G‘FÜmI‹mA
(
$ùag
);

234 ià(
	g$i¥ršt
è
	gecho
 "<špuˆty³='hidd’'‚ame='xak_addÚf›lds' v®ue=\"".
	g$xak_addÚf›lds
."\">\r\n";

235 
	gecho
 "<špuˆty³=\"hidd’\"‚ame=\"xak_f›ldshash\" v®ue=\"".
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
)."\" />";

237  
	g$addÚf›ld¢ame
;

248 
funùiÚ
 
PrštAutoF›ldsEd™
(&
$f›ld£t
, &
$f›ldV®ues
, 
$lßdty³
='all')

250 
$d
 = 
Ãw
 
XakTagP¬£
();

251 
	g$d
->
S‘NameS·û
("field","<",">");

252 
	g$d
->
LßdSourû
(
$f›ld£t
);

253 
	g$xak_addÚf›lds
 = "";

254 if(
is_¬¿y
(
$d
->
CTags
))

256 
fÜ—ch
(
$d
->
CTags
 
as
 
$tid
=>
$ùag
)

258 if(
$lßdty³
!='autofield'

259 || (
$lßdty³
=='autof›ld' && 
$ùag
->
G‘A‰
('autofield')==1) )

261 
$xak_addÚf›lds
 .ğĞ$xak_addÚf›lds=='' ? 
$ùag
->
G‘Name
().",".$ùag->
G‘A‰
('type') : ";".$ctag->GetName().",".$ctag->GetAtt('type') );

262 
echo
 
G‘FÜmI‹mV®ueA
(
$ùag
,
$f›ldV®ues
[$ùag->
G‘Name
()]);

266 
	gecho
 "<špuˆty³='hidd’'‚ame='xak_addÚf›lds' v®ue=\"".
	g$xak_addÚf›lds
."\">\r\n";

276 
funùiÚ
 
	$MakeA¹
(
$aid
, 
$ismakesign
=
FALSE
)

278 
glob®
 
$cfg_makešdex
,
$cfg_ba£dœ
,
$cfg_‹m¶‘s_dœ
,
$cfg_df_¡yË
;

279 
	`šşude_Úû
(
XAKINC
.'/arc.archives.class.php');

280 if(
$ismakesign
)

282 
$’vs
['makesign'] = 'yes';

284 
$¬c
 = 
Ãw
 
	`Archives
(
$aid
);

285 
$»u¾
 = 
$¬c
->
	`MakeHtml
();

286 if(
	`is£t
(
$ty³id
))

288 
$´eRow
 = 
$¬c
->
dsql
->
	`G‘OÃ
("SELECT id FROM `#@__arctiny` WHERE id<$aid AND‡rcrank>-1 ANDypeid='$typeid' order by id desc");

289 
$ÃxtRow
 = 
$¬c
->
dsql
->
	`G‘OÃ
("SELECT id FROM `#@__arctiny` WHERE id>$aid AND‡rcrank>-1 ANDypeid='$typeid' order by id‡sc");

290 if(
	`is_¬¿y
(
$´eRow
))

292 
$¬c
 = 
Ãw
 
	`Archives
(
$´eRow
['id']);

293 
$¬c
->
	`MakeHtml
();

295 if(
	`is_¬¿y
(
$ÃxtRow
))

297 
$¬c
 = 
Ãw
 
	`Archives
(
$ÃxtRow
['id']);

298 
$¬c
->
	`MakeHtml
();

301  
$»u¾
;

302 
	}
}

313 
funùiÚ
 
AÇly£HtmlBody
(
$body
, &
$desütiÚ
, 
$dty³
='')

315 
glob®
 
$cfg_mb_rmdown
,
$cfg_ba£ho¡
,
$cfg_auÙ_desütiÚ
,
$¬cID
;

316 
	g$autŞ™pic
 = (
em±y
(
$autŞ™pic
) ? '' : $autolitpic);

317 
	g$body
 = 
¡r¦ashes
(
$body
);

320 if(
	g$cfg_mb_rmdown
=='Y')

322 
$body
 = 
G‘CurCÚ‹Á
($body);

326 if(
	g$desütiÚ
=='' && 
$cfg_auÙ_desütiÚ
>0)

328 
$desütiÚ
 = 
ú_sub¡r
(
html2‹xt
(
$body
),
$cfg_auÙ_desütiÚ
);

329 
	g$desütiÚ
 = 
Œim
(
´eg_»¶aû
('/#p#|#e#/','',
$desütiÚ
));

330 
	g$desütiÚ
 = 
add¦ashes
(
$desütiÚ
);

332 
	g$body
 = 
add¦ashes
(
$body
);

333  
	g$body
;

343 
funùiÚ
 
	$G‘CurCÚ‹Á
(&
$body
)

345 
glob®
 
$cfg_muÉi_s™e
,
$cfg_ba£ho¡
,
$cfg_ba£dœ
,
$cfg_u£r_dœ
,
$t™Ë
,
$cfg_ml
;

346 
	`šşude_Úû
(
XAKINC
."/xakcollection.func.php");

347 
$htd
 = 
Ãw
 
	`XakH‰pDown
();

348 
$ba£ho¡
 = "h‰p://".
$_SERVER
["HTTP_HOST"];

349 
$img_¬¿y
 = 
	`¬¿y
();

350 
	`´eg_m©ch_®l
("/(¤c|SRC)=[\"|'| ]{0,}(h‰p:\/\/([^>]*)\.(gif|jpg|²g))/isU",
$body
,
$img_¬¿y
);

351 
$img_¬¿y
 = 
	`¬¿y_unique
($img_array[2]);

352 
$imgU¾
 = 
$cfg_u£r_dœ
."/".
$cfg_ml
->
M_ID
;

353 
$imgP©h
 = 
$cfg_ba£dœ
.
$imgU¾
;

354 if(!
	`is_dœ
(
$imgP©h
."/"))

356 
	`MkdœAÎ
(
$imgP©h
,
$GLOBALS
['cfg_dir_purview']);

357 
	`Clo£F
();

359 
$mliSecÚd
 = 
	`MyD©e
("ymdHis",
	`time
());

360 
	`fÜ—ch
(
$img_¬¿y
 
as
 
$key
=>
$v®ue
)

362 if(
	`´eg_m©ch
("#".
$ba£ho¡
."#i", 
$v®ue
))

366 if(
$cfg_ba£ho¡
!=
$ba£ho¡
 && 
	`´eg_m©ch
("#".$cfg_ba£ho¡."#i", 
$v®ue
))

370 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$v®ue
))

374 
$htd
->
	`O³nU¾
(
$v®ue
);

375 
$™y³
 = 
$htd
->
	`G‘H—d
("content-type");

376 
$™y³
 = 
	`sub¡r
(
$v®ue
,-4,4);

377 if(!
	`´eg_m©ch
("#\.(jpg|gif|²g)#i", 
$™y³
))

379 if(
$™y³
=='image/gif')

381 
$™y³
 = ".gif";

383 if(
$™y³
=='image/png')

385 
$™y³
 = ".png";

389 
$™y³
 = '.jpg';

392 
$mliSecÚdN
 = 
	`dd2ch¬
(
$mliSecÚd
.'-'.
	`mt_¿nd
(1000,8000));

393 
$v®ue
 = 
	`Œim
($value);

394 
$ºdFeName
 = 
$imgP©h
."/".
$mliSecÚdN
.'-'.
$key
.
$™y³
;

395 
$feu¾
 = 
$imgU¾
."/".
$mliSecÚdN
.'-'.
$key
.
$™y³
;

396 
$rs
 = 
$htd
->
	`SaveToBš
(
$ºdFeName
);

397 if(
$rs
)

399 
$body
 = 
	`¡r_»¶aû
(
$v®ue
,
$feu¾
,$body);

400 @
	`W©”Img
(
$ºdFeName
,'down');

402 
$šfo
 = '';

403 
$imgšfos
 = 
	`G‘ImageSize
(
$ºdFeName
,
$šfo
);

404 
	`SaveU¶ßdInfo
(
$t™Ë
,
$feu¾
,1,
$imgšfos
);

406 
$htd
->
	`Clo£
();

407  
$body
;

408 
	}
}

425 
funùiÚ
 
U¶ßdOÃImage
(
$u²ame
,
$hªdu¾
='',
$i¤emÙe
=1,
$Á™Ë
='')

427 
glob®
 
$cfg_ml
,
$cfg_ba£dœ
,
$cfg_image_dœ
,
$dsql
,
$t™Ë
, $dsql;

428 if(
	g$Á™Ë
!='')

430 
$t™Ë
 = 
$Á™Ë
;

432 
	g$Áime
 = 
time
();

433 
	g$f’ame
 = '';

434 
	g$i¤m_up
 = 
çl£
;

435 
	g$hªdu¾
 = 
Œim
(
$hªdu¾
);

437 if(!
em±y
(
$_FILES
[
$u²ame
]['tmp_Çme']è&& 
is_u¶ßded_fe
($_FILES[$upname]['tmp_name']))

439 
	g$i¡y³
 = 0;

440 
	g$¥¬r
 = 
A¼ay
("image/pjpeg","image/jpeg","image/gif","image/png");

441 
	g$_FILES
[
$u²ame
]['ty³'] = 
¡¹Şow”
(
Œim
(
$_FILES
[$upname]['type']));

442 if(!
š_¬¿y
(
$_FILES
[
$u²ame
]['ty³'],
$¥¬r
))

444 
ShowMsg
("ä¸Šä¼ çš„å›¾ç‰‡æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨JPEGã€GIFã€PNGæ ¼å¼çš„å…¶ä¸­ä¸€ç§ï¼","-1");

445 
ex™
();

447 if(!
em±y
(
$hªdu¾
è&& !
´eg_m©ch
("#^h‰p:\/\/#", $hªdu¾è&& 
fe_exi¡s
(
$cfg_ba£dœ
.$handurl) )

449 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From #@__uploads where url†ike '$handurl' ");

450 
	g$fuÎU¾
 = 
´eg_»¶aû
("#\.([a-z]*)$#i", "", 
$hªdu¾
);

454 
	g$§v•©h
 = 
$cfg_image_dœ
."/".
¡ráime
("%Y-%m",
$Áime
);

455 
C»©eDœ
(
$§v•©h
);

456 
	g$fuÎU¾
 = 
$§v•©h
."/".
¡ráime
("%d",
$Áime
).
dd2ch¬
(¡ráime("%H%M%S",$Áime).'0'.
$cfg_ml
->
M_ID
.'0'.
mt_¿nd
(1000,9999));

458 if(
¡¹Şow”
(
$_FILES
[
$u²ame
]['type'])=="image/gif")

460 
$fuÎU¾
 = $fullUrl.".gif";

462 if(
¡¹Şow”
(
$_FILES
[
$u²ame
]['type'])=="image/png")

464 
$fuÎU¾
 = $fullUrl.".png";

468 
	g$fuÎU¾
 = 
$fuÎU¾
.".jpg";

472 @
move_u¶ßded_fe
(
$_FILES
[
$u²ame
]['tmp_Çme'],
$cfg_ba£dœ
.
$fuÎU¾
);

473 
	g$f’ame
 = 
$fuÎU¾
;

476 @
W©”Img
(
$imgfe
,'up');

477 
	g$i¤m_up
 = 
TRUE
;

482 if(
	g$hªdu¾
=='')

488 if(
	g$i¤emÙe
==1 && 
´eg_m©ch
("#^h‰p:\/\/#", 
$hªdu¾
))

490 
	g$ddšfos
 = 
G‘RemÙeImage
(
$hªdu¾
,
$cu£rLogš
->
g‘U£rID
());

491 if(!
is_¬¿y
(
$ddšfos
))

493 
	g$l™pic
 = "";

497 
	g$f’ame
 = 
$ddšfos
[0];

499 
	g$i¤m_up
 = 
TRUE
;

505 
	g$f’ame
 = 
$hªdu¾
;

508 
	g$imgfe
 = 
$cfg_ba£dœ
.
$f’ame
;

509 if(
is_fe
(
$imgfe
è&& 
	g$i¤m_up
 && 
	g$f’ame
!='')

511 
$šfo
 = "";

512 
	g$imgšfos
 = 
G‘ImageSize
(
$imgfe
,
$šfo
);

515 
	g$šqu”y
 = "

516 
INSERT
 
INTO
 #@
__u¶ßds
(
t™Ë
,
u¾
,
medŸty³
,
width
,
height
,
¶aytime
,
fesize
,
u±ime
,
mid
)

517 
VALUES
 ('$title','$filename','1','".$imginfos[0]."','".$imginfos[1]."','0','".filesize($imgfile)."','".time()."','".$cfg_ml->M_ID."');

519 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

521 
	g$fid
 = 
$dsql
->
G‘La¡ID
();

522 
AddMyAddÚ
(
$fid
, 
$f’ame
);

523  
	g$f’ame
;

	@E:\web\weixun\user\inc\inc_batchup.php

1 <?
php
 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

8 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

17 
funùiÚ
 
	$D–Arc
(
$aid
)

19 
glob®
 
$dsql
,
$cfg_cook›_’code
,
$cfg_ml
,
$cfg_u¶ßd_sw™ch
,
$cfg_medŸs_dœ
;

20 
$aid
 = 
	`štv®
($aid);

23 
$¬ù™Ë
 = '';

24 
$¬cu¾
 = '';

26 
$¬cQu”y
 = "SELECT‡rc.*,ch.addtable,tp.typedir,tp.typename,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath,ch.nid

27 
FROM
 `#@
__¬chives
` 
¬c


28 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


29 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl


30 
WHERE
 
¬c
.
id
='$aid' ";

31 
$¬cRow
 = 
$dsql
->
	`G‘OÃ
(
$¬cQu”y
);

32 if(!
	`is_¬¿y
(
$¬cRow
))

34  
çl£
;

38 
$dsql
->
	`Execu‹NÚeQu”y
(" DELETE FROM `#@__arctiny` WHERE id='$aid' ");

39 if(
$¬cRow
['addtable']!='')

42 if(
$cfg_u¶ßd_sw™ch
 == 'Y')

45 
$¬cRow
['nid'])

48 
$nid
 = "imgurls";

51 
$nid
 = "body";

54 
$nid
 = "softlinks";

57 
$nid
 = "body";

60 
$nid
 = "";

63 if(
$nid
 !="")

65 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT $nid FROM ".
$¬cRow
['addtable']." WHERE‡id = '$aid'");

66 
$liı
 = 
$dsql
->
	`G‘OÃ
("SELECT†itpic FROM `#@__archives` WHERE id = '$aid'");

67 if(
$liı
['litpic'] != "")

69 
$l™pic
 = 
XAKROOT
.
$liı
['litpic'];

70 if(
	`fe_exi¡s
(
$l™pic
è&& !
	`is_dœ
($litpic))

72 @
	`uÆšk
(
$l™pic
);

75 
$tm²ame
 = '/(\\'.
$cfg_medŸs_dœ
.'.+?)(\"| )/';

78 
	`´eg_m©ch_®l
("$tm²ame", 
$row
["$nid"], 
$d–Çme
);

81 
$d–Çme
 = 
	`¬¿y_unique
($delname['1']);

82 
	`fÜ—ch
 (
$d–Çme
 
as
 
$v¬
)

84 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__uploads` WHERE url='$var' AND mid = '$cfg_ml->M_ID'");

85 
$u²ame
 = 
XAKROOT
.
$v¬
;

86 if(
	`fe_exi¡s
(
$u²ame
è&& !
	`is_dœ
($u²ame)è@
	`uÆšk
($upname);

90 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `".
$¬cRow
['addtable']."` where‡id='$aid' ");

92 
$dsql
->
	`Execu‹NÚeQu”y
(" DELETE FROM `#@__archives` where id='$aid' ");

93 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__feedback` where‡id='$aid'");

94 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__member_stow` where‡id='$aid'");

95 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__taglist ` where‡id='$aid'");

98 if(
$¬cRow
['ismake']==-1||$arcRow['arcrank']!=0 ||$arcRow['typeid']==0||$arcRow['money']>0)

100  
TRUE
;

102 
$¬cu¾
 = 
	`G‘FeU¾
(
$¬cRow
['id'],$arcRow['typeid'],$arcRow['senddate'],$arcRow['title'],$arcRow['ismake'],

103 
$¬cRow
['arcrank'],$arcRow['namerule'],$arcRow['typedir'],$arcRow['money'],$arcRow['filename']);

104 if(!
	`´eg_m©ch
("#\?#", 
$¬cu¾
))

106 
$htmlfe
 = 
	`G‘TrueP©h
().
	`¡r_»¶aû
(
$GLOBALS
['cfg_ba£ho¡'], '', 
$¬cu¾
);

107 if(
	`fe_exi¡s
(
$htmlfe
è&& !
	`is_dœ
($htmlfile))

109 @
	`uÆšk
(
$htmlfe
);

110 
$¬cu¾s
 = 
	`ex¶ode
(".", 
$htmlfe
);

111 
$¢ame
 = 
$¬cu¾s
[
	`couÁ
($arcurls)-1];

112 
$âame
 = 
	`´eg_»¶aû
("#(\.$¢ame)$#", "", 
$htmlfe
);

113 
$i
=2; $i<=100; $i++)

115 
$htmlfe
 = 
$âame
."_$i".".".
$¢ame
;

116 if(
	`fe_exi¡s
(
$htmlfe
è&& !
	`is_dœ
($htmlfe)è@
	`uÆšk
($htmlfile);

123 
$f’ameh
 = 
XAKDATA
."/‹xtd©a/".(
	`û
(
$aid
/5000))."/{$aid}-".
	`sub¡r
(
	`md5
(
$cfg_cook›_’code
),0,16).".txt";

124 if(
	`is_fe
(
$f’ame
)è@
	`uÆšk
($filename);

125  
TRUE
;

126 
	}
}

135 
funùiÚ
 
	$D–ArcSg
(
$aid
)

137 
glob®
 
$dsql
,
$cfg_cook›_’code
,
$cfg_ml
,
$cfg_u¶ßd_sw™ch
,
$cfg_medŸs_dœ
;

138 
$aid
 = 
	`štv®
($aid);

141 
$¬ù™Ë
 = '';

142 
$¬cu¾
 = '';

144 
$¬cQu”y
 = "Select‡rc.id,arc.typeid,arc.senddate,arc.arcrank,ch.addtable,ch.nid,

145 

.
ty³dœ
,.
ty³Çme
,.
Çm”uË
,.
Çm”uË2
,.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h


146 
äom
 `#@
__¬ùšy
` 
¬c


147 
Ëá
 
još
 `#@
__¬ùy³
` 

 
Ú
p.
id
=
¬c
.
ty³id


148 
Ëá
 
još
 `#@
__chªÃÉy³
` 
ch
 
Ú
 ch.
id
=
¬c
.
chªÃl


149 
wh”e
 
¬c
.
id
='$aid' ";

150 
$¬cRow
 = 
$dsql
->
	`G‘OÃ
(
$¬cQu”y
);

152 if(!
	`is_¬¿y
(
$¬cRow
))

154  
FALSE
;

158 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` where id='$aid' ");

159 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `".
$¬cRow
['addtable']."` where‡id='$aid' ");

160 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__feedback` where‡id='$aid'");

161 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__member_stow` where‡id='$aid'");

162 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__taglist ` where‡id='$aid'");

165 if(
$¬cRow
['arcrank']!=0 ||$arcRow['typeid']==0)

167  
TRUE
;

169 
$¬cu¾
 = 
	`G‘FeU¾
(
$¬cRow
['id'],$arcRow['typeid'],$arcRow['senddate'],'',1,

170 
$¬cRow
['arcrank'],$arcRow['namerule'],$arcRow['typedir'],0,'');

171 if(!
	`´eg_m©ch
("#\?#", 
$¬cu¾
))

173 
$htmlfe
 = 
	`G‘TrueP©h
().
	`¡r_»¶aû
(
$GLOBALS
['cfg_ba£ho¡'],'',
$¬cu¾
);

174 if(
	`fe_exi¡s
(
$htmlfe
è&& !
	`is_dœ
($htmlfile))

176 @
	`uÆšk
(
$htmlfe
);

177 
$¬cu¾s
 = 
	`ex¶ode
(".", 
$htmlfe
);

178 
$¢ame
 = 
$¬cu¾s
[
	`couÁ
($arcurls)-1];

179 
$âame
 = 
	`´eg_»¶aû
("#(\.$¢ame)$#", "", 
$htmlfe
);

180 
$i
=2;$i<=100;$i++)

182 
$htmlfe
 = 
$âame
."_$i".".".
$¢ame
;

183 if(
	`fe_exi¡s
(
$htmlfe
è&& !
	`is_dœ
($htmlfe)è@
	`uÆšk
($htmlfile);

189 
$f’ameh
 = 
XAKDATA
."/‹xtd©a/".(
	`û
(
$aid
/5000))."/{$aid}-".
	`sub¡r
(
	`md5
(
$cfg_cook›_’code
),0,16).".txt";

190  
TRUE
;

191 
	}
}

198 
funùiÚ
 
	$G‘TrueP©h
()

200 
$Œu•©h
 = 
$GLOBALS
["cfg_basedir"];

201  
$Œu•©h
;

202 
	}
}

	@E:\web\weixun\user\inc\inc_catalog_options.php

1 <?
php


7 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

16 
funùiÚ
 
	$G‘O±iÚLi¡
(
$£lid
=0, 
$chªÃÉy³
=0)

18 
glob®
 
$O±iÚA¼ayLi¡
,
$chªÃls
,
$dsql
;

19 
$dsql
->
	`S‘Qu”y
("SELECT id,typename FROM `#@__channeltype` ");

20 
$dsql
->
	`Execu‹
();

21 
$chªÃls
 = 
	`A¼ay
();

22 
$row
 = 
$dsql
->
	`G‘Objeù
())

24 
$chªÃls
[
$row
->
id
] = $row->
ty³Çme
;

26 
$O±iÚA¼ayLi¡
 = "";

27 
$qu”y
 = "SELECT id,typename,ispart,channeltype,issend FROM `#@__arctype` WHERE ispart<2 AND„eid=0 ORDER BY sortrank ASC ";

28 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

29 
$dsql
->
	`Execu‹
();

30 
$£Ëùed
 = '';

31 
$row
=
$dsql
->
	`G‘Objeù
())

33 if(
$£lid
==
$row
->
id
)

35 
$£Ëùed
 = " selected='$selected'";

37 if(
$row
->
chªÃÉy³
==
$chªÃÉy³
 && $row->
is£nd
==1)

39 if(
$row
->
i¥¬t
==0)

41 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ3'{$£Ëùed}>".$row->
ty³Çme
."</option>\r\n";

43 if(
$row
->
i¥¬t
==1)

45 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ2'{$£Ëùed}>".$row->
ty³Çme
."</option>\r\n";

48 
$£Ëùed
 = '';

49 
	`LogicG‘O±iÚA¼ay
(
$row
->
id
,"â”€",
$chªÃÉy³
,
$£lid
);

51  
$O±iÚA¼ayLi¡
;

52 
	}
}

64 
funùiÚ
 
	$LogicG‘O±iÚA¼ay
(
$id
,
$¡•
,
$chªÃÉy³
,
$£lid
=0)

66 
glob®
 
$O±iÚA¼ayLi¡
,
$chªÃls
,
$dsql
;

67 
$£Ëùed
 = '';

68 
$dsql
->
	`S‘Qu”y
("S–eù id,ty³Çme,i¥¬t,chªÃÉy³,is£nd From `#@__¬ùy³` wh”»id='".
$id
."' And ispart<2 order by sortrank‡sc");

69 
$dsql
->
	`Execu‹
(
$id
);

70 
$row
=
$dsql
->
	`G‘Objeù
(
$id
))

72 if(
$£lid
==
$row
->
id
)

74 
$£Ëùed
 = " selected='$selected'";

76 if(
$row
->
chªÃÉy³
==
$chªÃÉy³
 && $row->
is£nd
==1)

78 if(
$row
->
i¥¬t
==0)

80 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ3'{$£Ëùed}>$¡•".$row->
ty³Çme
."</option>\r\n";

82 if(
$row
->
i¥¬t
==1)

84 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ2'{$£Ëùed}>$¡•".$row->
ty³Çme
."</option>\r\n";

87 
$£Ëùed
 = '';

88 
	`LogicG‘O±iÚA¼ay
(
$row
->
id
,
$¡•
."â”€",
$chªÃÉy³
,
$£lid
);

90 
	}
}

100 
funùiÚ
 
	$şassifiÿtiÚ
(
$mid
, 
$mty³id
 = 0, 
$chªÃlid
=1)

102 
glob®
 
$dsql
;

103 
$li¡
 = 
$£Ëùed
 = '';

104 
$quey
 = "SELECT * FROM `#@__mtypes` WHERE mid = '$mid' And channelid='$channelid' ;";

105 
$dsql
->
	`S‘Qu”y
(
$quey
);

106 
$dsql
->
	`Execu‹
();

107 
$row
 = 
$dsql
->
	`G‘A¼ay
())

109 if(
$mty³id
 != 0){

110 if(
$mty³id
 =ğ
$row
['mtypeid'])

112 
$£Ëùed
 = " selected";

115 
$li¡
 .ğ"<İtiÚ v®ue='".
$row
['mtypeid']."' class='option3'{$selected}>".$row['mtypename']."</option>\r\n";

116 
$£Ëùed
 = '';

118  
$li¡
;

119 
	}
}

	@E:\web\weixun\user\inc\inc_list_functions.php

1 <?
php
 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

14 
funùiÚ
 
	$IsComm’dArchives
(
$iscomm’d
)

16 
$s
 = '';

17 if(
	`´eg_m©ch
('/c/', 
$iscomm’d
))

19 
$s
 .= 'æ¨è';

21 if(
	`´eg_m©ch
('/h/', 
$iscomm’d
))

23 
$s
 .= ' å¤´æ¡';

25 if(
	`´eg_m©ch
('/p/', 
$iscomm’d
))

27 
$s
 .= ' å›¾ç‰‡';

29 if(
	`´eg_m©ch
('/j/', 
$iscomm’d
))

31 
$s
 .= ' è·³è½¬';

33  
$s
;

34 
	}
}

43 
funùiÚ
 
	$G‘Comm’dT™Ë
(
$t™Ë
, 
$iscomm’d
)

45 if(
	`´eg_m©ch
('/c/', 
$iscomm’d
))

47 
$t™Ë
 = "$title<font color='red'>(æ¨è)</font>";

50 
	}
}

52 
	g$GLOBALS
['RndTrunID'] = 1;

60 
funùiÚ
 
	$G‘CŞÜ
(
$cŞÜ1
,
$cŞÜ2
)

62 
$GLOBALS
['RndTrunID']++;

63 if(
$GLOBALS
['RndTrunID']%2==0)

65  
$cŞÜ1
;

69  
$cŞÜ2
;

71 
	}
}

79 
funùiÚ
 
	$CheckPic
(
$piúame
)

81 if(
$piúame
!="")

83  
$piúame
;

89 
	}
}

97 
funùiÚ
 
	$IsHtmlArchives
(
$ismake
)

99 if(
$ismake
==1)

103 if(
$ismake
==-1)

111 
	}
}

119 
funùiÚ
 
	$G‘RªkName
(
$¬üªk
)

121 
glob®
 
$¬cA¼ay
;

122 if(!
	`is_¬¿y
(
$¬cA¼ay
))

124 
$dsql
->
	`S‘Qu”y
("SELECT * FROM #@__arcrank");

125 
$dsql
->
	`Execu‹
();

126 
$row
 = 
$dsql
->
	`G‘Objeù
())

128 
$¬cA¼ay
[
$row
->
¿nk
]=$row->
memb”Çme
;

131 if(
	`is£t
(
$¬cA¼ay
[
$¬üªk
]))

133  
$¬cA¼ay
[
$¬üªk
];

139 
	}
}

147 
funùiÚ
 
	$IsPicArchives
(
$piúame
)

149 if(
$piúame
!="")

157 
	}
}

	@E:\web\weixun\user\inc\inc_pwd_functions.php

1 <?
php
 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

15 
funùiÚ
 
	$¿ndom
(
$Ëngth
, 
$num”ic
 = 0)

17 
PHP_VERSION
 < '4.2.0' && 
	`mt_¤ªd
(()
	`miüÙime
() * 1000000);

18 if(
$num”ic
)

20 
$hash
 = 
	`¥rštf
('%0'.
$Ëngth
.'d', 
	`mt_¿nd
(0, 
	`pow
(10, $length) - 1));

24 
$hash
 = '';

25 
$ch¬s
 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz';

26 
$max
 = 
	`¡¾’
(
$ch¬s
) - 1;

27 
$i
 = 0; $˜< 
$Ëngth
; $i++)

29 
$hash
 .ğ
$ch¬s
[
	`mt_¿nd
(0, 
$max
)];

32  
$hash
;

33 
	}
}

44 
funùiÚ
 
	$£ndma
(
$ema
, 
$mat™Ë
, 
$mabody
, 
$h—d”s
)

46 
glob®
 
$cfg_£ndma_bysm
, 
$cfg_sm_£rv”
, 
$cfg_sm_pÜt
, 
$cfg_sm_u£rma
, 
$cfg_sm_u£r
, 
$cfg_sm_·sswÜd
, 
$cfg_admšema
;

47 if(
$cfg_£ndma_bysm
 == 'Y')

49 
$maty³
 = 'TXT';

50 
	`»quœe_Úû
(
XAKINC
.'/mail.class.php');

51 
$sm
 = 
Ãw
 
	`sm
(
$cfg_sm_£rv”
,
$cfg_sm_pÜt
,
Œue
,
$cfg_sm_u£rma
,
$cfg_sm_·sswÜd
);

52 
$sm
->
debug
 = 
çl£
;

53 
$sm
->
	`£ndma
(
$ema
,
$cfg_webÇme
,
$cfg_sm_u£rma
, 
$mat™Ë
, 
$mabody
, 
$maty³
);

55 @
	`ma
(
$ema
, 
$mat™Ë
, 
$mabody
, 
$h—d”s
);

57 
	}
}

69 
funùiÚ
 
	$Ãwma
(
$mid
, 
$u£rid
, 
$mato
, 
$ty³
, 
$£nd
)

71 
glob®
 
$db
,
$cfg_admšema
,
$cfg_webÇme
,
$cfg_ba£ho¡
,
$cfg_memb”u¾
;

72 
$matime
 = 
	`time
();

73 
$¿ndv®
 = 
	`¿ndom
(8);

74 
$mat™Ë
 = 
$cfg_webÇme
.":å¯†ç ä¿®æ”¹";

75 
$mato
 = $mailto;

76 
$h—d”s
 = "From: ".
$cfg_admšema
."\r\nReply-To: $cfg_adminemail";

77 
$mabody
 = "äº²çˆ±çš„".
$u£rid
."ï¼š\r\næ‚¨å¥½ï¼æ„Ÿè°¢æ‚¨ä½¿ç”¨".
$cfg_webÇme
."ç½‘ã€‚\r\n".$cfg_webÇme."åº”æ‚¨çš„è¦æ±‚ï¼Œé‡æ–°è®¾ç½®å¯†ç ï¼šï¼ˆæ³¨ï¼šå¦‚æœæ‚¨æ²¡æœ‰æå‡ºç”³è¯·ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ä¿¡æ¯æ˜¯å¦æ³„æ¼ã€‚ï¼‰\r\næœ¬æ¬¡ä¸´æ—¶ç™»é™†å¯†ç ä¸ºï¼š".
$¿ndv®
." è¯·äºä¸‰å¤©å†…ç™»é™†ä¸‹é¢ç½‘å€ç¡®è®¤ä¿®æ”¹ã€‚\r\n".
$cfg_ba£ho¡
.
$cfg_memb”u¾
."/»£asswÜd.php?dİo¡=g‘·sswd&id=".
$mid
;

78 if(
$ty³
 == 'INSERT')

80 
$key
 = 
	`md5
(
$¿ndv®
);

81 
$sql
 = "INSERT INTO `#@__pwd_tmp` (`mid` ,`membername` ,`pwd` ,`mailtime`)VALUES ('$mid', '$userid', '$key', '$mailtime');";

82 if(
$db
->
	`Execu‹NÚeQu”y
(
$sql
))

84 if(
$£nd
 == 'Y')

86 
	`£ndma
(
$mato
,
$mat™Ë
,
$mabody
,
$h—d”s
);

87  
	`ShowMsg
('EMAILä¿®æ”¹éªŒè¯ç å·²ç»å‘é€åˆ°åŸæ¥çš„é‚®ç®±è¯·æŸ¥æ”¶', 'login.php','','5000');

88 } ià(
$£nd
 == 'N')

90  
	`ShowMsg
('ç¨åè·³è½¬åˆ°ä¿®æ”¹é¡µ', 
$cfg_ba£ho¡
.
$cfg_memb”u¾
."/»£asswÜd.php?dİo¡=g‘·sswd&amp;id=".
$mid
."&amp;key=".
$¿ndv®
);

95  
	`ShowMsg
('å¯¹ä¸èµ·ä¿®æ”¹å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜', 'login.php');

98 
	`–£if
(
$ty³
 == 'UPDATE')

100 
$key
 = 
	`md5
(
$¿ndv®
);

101 
$sql
 = "UPDATE `#@__pwd_tmp` SET `pwd` = '$key',mailtime = '$mailtime' WHERE `mid` ='$mid';";

102 if(
$db
->
	`Execu‹NÚeQu”y
(
$sql
))

104 if(
$£nd
 == 'Y')

106 
	`£ndma
(
$mato
,
$mat™Ë
,
$mabody
,
$h—d”s
);

107 
	`ShowMsg
('EMAILä¿®æ”¹éªŒè¯ç å·²ç»å‘é€åˆ°åŸæ¥çš„é‚®ç®±è¯·æŸ¥æ”¶', 'login.php');

109 
	`–£if
(
$£nd
 == 'N')

111  
	`ShowMsg
('ç¨åè·³è½¬åˆ°ä¿®æ”¹é¡µ', 
$cfg_ba£ho¡
.
$cfg_memb”u¾
."/»£asswÜd.php?dİo¡=g‘·sswd&amp;id=".
$mid
."&amp;key=".
$¿ndv®
);

116 
	`ShowMsg
('å¯¹ä¸èµ·ä¿®æ”¹å¤±è´¥ï¼Œè¯·ä¸ç®¡ç†å‘˜è”ç³»', 'login.php');

119 
	}
}

129 
funùiÚ
 
	$memb”
(
$ma
, 
$u£rid
)

131 
glob®
 
$db
;

132 
$sql
 = "SELECT mid,email,safequestion FROM `#@__member_list` WHEREƒmail='$mail' AND userid = '$userid'";

133 
$row
 = 
$db
->
	`G‘OÃ
(
$sql
);

134 if(
	`is_¬¿y
(
$row
)){

135  
$row
;

137 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œç”¨æˆ·IDè¾“å…¥é”™è¯¯ï¼","-1");

138 
ex™
;

140 
	}
}

151 
funùiÚ
 
¢
(
$mid
,
$u£rid
,
$mato
, 
$£nd
 = 'Y')

153 
glob®
 
$db
;

154 
	g$tim
= (60*10);

155 
	g$dtime
 = 
time
();

156 
	g$sql
 = "SELECT * FROM #@__pwd_tmp WHERE mid = '$mid'";

157 
	g$row
 = 
$db
->
G‘OÃ
(
$sql
);

158 if(!
is_¬¿y
(
$row
))

161 
Ãwma
(
$mid
,
$u£rid
,
$mato
,'INSERT',
$£nd
);

164 
–£if
(
$dtime
 - 
$tim
 > 
$row
['mailtime'])

166 
Ãwma
(
$mid
,
$u£rid
,
$mato
,'UPDATE',
$£nd
);

171  
ShowMsg
('å¯¹ä¸èµ·ï¼Œè¯·10åˆ†é’Ÿåå†é‡æ–°ç”³è¯·', 'login.php');

	@E:\web\weixun\user\inc\space_action.php

1 <?
php
 if(!
defšed
('XAKMEMBER')è
ex™
('Warning...');

9 
	g$addqSql
 = '';

10 if(
	g$cfg_mb_®lownÿrc
=='N'è
$addqSql
 .= " And‡rc.arcrank > -1 ";

11 if(
is£t
(
$mty³
)è
	g$mty³
 = 
štv®
($mtype);

12 if(!
em±y
(
$mty³
)è
	g$addqSql
 .= " And‡rc.mtype = '$mtype' ";

18 if(
	g$aùiÚ
=='article')

20 if(
em±y
(
$mty³
)) $mtype = 0;

22 
šşude_Úû
(
XAKINC
.'/arc.memberlistview.class.php');

23 
šşude_Úû
(
XAKINC
.'/channelunit.func.php');

24 
	g$qu”y
 = "SELECT‡rc.*,mt.mtypename,addt.body,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath

25 
FROM
 `#@
__¬chives
` 
¬c


26 
LEFT
 
JOIN
 `#@
__addÚ¬tişe
` 
addt
 
ON
‡ddt.
aid
=
¬c
.
id


27 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


28 
LEFT
 
JOIN
 `#@
__mty³s
` 
mt
 
ON
 mt.
mty³id
=
¬c
.
mty³


29 
WHERE
 
¬c
.
mid
='{$_v¬s['mid']}' 
$addqSql
 
AND
‡rc.
chªÃl
=1 
ORDER
 
BY
‡rc.
id
 
DESC
";

30 
$dli¡
 = 
Ãw
 
Memb”Li¡v›w
();

31 
	g$dli¡
->
	g·geSize
 = 
$_v¬s
['pagesize'];

32 
	g$dli¡
->
S‘P¬am‘”
("mty³",
$mty³
);

33 
	g$dli¡
->
S‘P¬am‘”
("uid",
$_v¬s
['userid']);

34 
	g$dli¡
->
S‘P¬am‘”
("aùiÚ",
$aùiÚ
);

35 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/listarticle.htm");

36 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

37 
	g$dli¡
->
Di¥Ïy
();

38 
ex™
();

44 if(
	g$aùiÚ
=='v›w¬chives' && !
em±y
(
$aid
è&& 
	$is_num”ic
(
$aid
))

46 if(
	`em±y
(
$mty³
)) $mtype = 0;

48 
	`šşude_Úû
(
XAKINC
.'/arc.memberlistview.class.php');

49 
	`šşude_Úû
(
XAKINC
.'/channelunit.func.php');

52 
$sql
 = "SELECT fb.*,mb.userid,mb.face‡s mface,mb.spacesta,mb.scores FROM `#@__feedback` fb

53 
LEFT
 
JOIN
 `#@
__memb”_li¡
` 
mb
 
ON
 mb.
mid
 = 
fb
.mid

54 
WHERE
 
fb
.
aid
='$aid' 
ªd
 fb.
ischeck
='1' 
ORDER
 
BY
 fb.
id
 
DESC
 
LIMIT
 0, 50";

55 
$msgs
 = 
	`¬¿y
();

56 
$dsql
->
	`Execu‹
('fb', 
$sql
);

57 
$row
 = 
$dsql
->
	`G‘A¼ay
('fb'))

59 
$msgs
[] = 
$row
;

63 
$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,

64 

.
i¥¬t
,.
mÜes™e
,.
s™eu¾
,.
s™•©h
,
¬
.
body
 
FROM
 `#@
__¬chives
` 
¬c


65 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
 
¬c
.
ty³id
ñp.
id


66 
LEFT
 
JOIN
 `#@
__addÚ¬tişe
` 
¬
 
ON
‡r.
aid
=
¬c
.
id


67 
WHERE
 
¬c
.
mid
='{$_v¬s['mid']}' 
AND
‡rc.
chªÃl
=1 AND 
¬
.
ty³id
=

.
id
 AND‡r.
aid
='$aid' ";

68 
$¬üow
 = 
$dsql
->
	`G‘OÃ
(
$qu”y
);

69 ifĞ!
	`is_¬¿y
(
$¬üow
) )

71 
	`ShowMsg
(' è¯»å–æ–‡æ¡£æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯! ', '-1');

72 
	`ex™
();

76 
$dli¡
 = 
Ãw
 
	`Memb”Li¡v›w
();

77 
$dli¡
->
	`S‘Tem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/blog.htm");

78 
$dli¡
->
	`Di¥Ïy
();

79 
	`ex™
();

80 
	}
}

85 if(
	g$aùiÚ
=='archives')

87 if(
em±y
(
$mty³
)) $mtype = 0;

88 
šşude_Úû
(
XAKINC
.'/arc.memberlistview.class.php');

89 
šşude_Úû
(
XAKINC
.'/channelunit.func.php');

92 if(
	g$cfg_mb_¥aû®Ïrc
 > 0 && 
em±y
(
$chªÃlid
)è
	g$chªÃlid
 = 
štv®
(
$cfg_mb_¥aû®Ïrc
);

94 if(
em±y
(
$chªÃlid
))

96 
	g$chªÃlid
 = 0;

97 
	g$qu”y
 = "SELECT‡rc.*,mt.mtypename,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath

98 
FROM
 `#@
__¬chives
` 
¬c


99 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
 
¬c
.
ty³id
ñp.
id


100 
LEFT
 
JOIN
 `#@
__mty³s
` 
mt
 
ON
 mt.
mty³id
=
¬c
.
mty³


101 
WHERE
 
¬c
.
mid
='{$_v¬s['mid']}' 
$addqSql
 
ORDER
 
BY
‡rc.
id
 
DESC
";

105 
	g$chªÃlid
 = 
štv®
(
$chªÃlid
);

106 
	g$chRow
 = 
$dsql
->
G‘OÃ
("SELECT issystem,addtable,listfields From `#@__channeltype` WHERE id='$channelid' ");

107 if(!
is_¬¿y
(
$chRow
)è
d›
(' Channel Error! ');

108 if(
	g$chRow
['issystem']==-1)

110 
$addbË
 = 
Œim
(
$chRow
['addtable']);

111 
	g$li¡f›lds
 = 
ex¶ode
(',', 
$chRow
['listfields']);

112 
	g$li¡f›lds_¡r
 = '¬c.'.
još
(',¬c.', 
$li¡f›lds
);

113 if(
	g$li¡f›lds_¡r
!='arc.')

115 
$li¡f›lds_¡r
 = $listfields_str.',';

118 
	g$li¡f›lds_¡r
 = '';

120 
	g$qu”y
 = "SELECT‡rc.aid,arc.aid‡s id,arc.typeid,''‡s mtypename,1‡s ismake,0‡s money,''‡s filename,{$listfields_str}

121 

.
ty³dœ
,
	g
.
	gty³Çme
,.
	gisdeçuÉ
,.
	gdeçuÉÇme
,.
	gÇm”uË
,.
	gÇm”uË2
,.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h


122 
	gFROM
 `{
	g$addbË
}` 
¬c


123 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g¬c
.
	gty³id
ñp.
id


124 
WHERE
 
¬c
.
mid
='{$_v¬s['mid']}' 
And
‡rc.
chªÃl
='$chªÃlid' 
$addqSql
 
ORDER
 
BY
‡rc.
aid
 
DESC
";

128 
	g$qu”y
 = "SELECT‡rc.*,mt.mtypename,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath

129 
äom
 `#@
__¬chives
` 
¬c


130 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
Ú
 
¬c
.
ty³id
ñp.
id


131 
LEFT
 
JOIN
 `#@
__mty³s
` 
mt
 
Ú
 mt.
mty³id
=
¬c
.
mty³


132 
WHERE
 
¬c
.
mid
='{$_v¬s['mid']}' 
And
‡rc.
chªÃl
='$chªÃlid' 
$addqSql
 
Üd”
 
by
‡rc.
id
 
desc
";

135 
	g$dli¡
 = 
Ãw
 
Memb”Li¡v›w
();

136 
	g$dli¡
->
	g·geSize
 = 
$_v¬s
['pagesize'];

137 
	g$dli¡
->
S‘P¬am‘”
("mty³", 
$mty³
);

138 
	g$dli¡
->
S‘P¬am‘”
("uid", 
$_v¬s
['userid']);

139 
	g$dli¡
->
S‘P¬am‘”
("chªÃlid", 
$chªÃlid
);

140 
	g$dli¡
->
S‘P¬am‘”
("aùiÚ", 
$aùiÚ
);

141 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/listarchives.htm");

142 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

143 
	g$dli¡
->
Di¥Ïy
();

144 
ex™
();

151 if(
	g$aùiÚ
=='album')

153 if(
em±y
(
$mty³
)) {

154 
$mty³
 = 0;

156 
šşude_Úû
(
XAKINC
.'/arc.memberlistview.class.php');

157 
šşude_Úû
(
XAKINC
.'/channelunit.func.php');

158 
	g$qu”y
 = "SELECT‡rc.*,mt.mtypename,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath

159 
äom
 `#@
__¬chives
` 
¬c


160 
Ëá
 
još
 `#@
__¬ùy³
` 

 
Ú
 
¬c
.
ty³id
ñp.
id


161 
Ëá
 
još
 `#@
__mty³s
` 
mt
 
Ú
 mt.
mty³id
=
¬c
.
mty³


162 
wh”e
 
¬c
.
mid
='{$_v¬s['mid']}' 
And
‡rc.
chªÃl
=2 
$addqSql
 
Üd”
 
by
‡rc.
id
 
desc
";

163 
$dli¡
 = 
Ãw
 
Memb”Li¡v›w
();

164 
	g$dli¡
->
	g·geSize
 = 
$_v¬s
['pagesize'];

165 
	g$dli¡
->
S‘P¬am‘”
("mty³",
$mty³
);

166 
	g$dli¡
->
S‘P¬am‘”
("uid",
$_v¬s
['userid']);

167 
	g$dli¡
->
S‘P¬am‘”
("aùiÚ",
$aùiÚ
);

168 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/listalbum.htm");

169 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

170 
	g$dli¡
->
Di¥Ïy
();

171 
ex™
();

178 if(
	g$aùiÚ
=='guestbook')

180 if(
em±y
(
$mty³
)) {

181 
$mty³
 = 0;

183 
šşude_Úû
(
XAKINC
.'/datalistcp.class.php');

184 
	g$qu”y
 = "SELECT mg.*,mb.face,mb.userid,mb.sex From `#@__member_guestbook` mg

185 
Ëá
 
još
 `#@
__memb”_li¡
` 
mb
 
Ú
 mb.
u£rid
=
mg
.
gid


186 
wh”e
 
mg
.
mid
='{$_v¬s['mid']}' 
Üd”
 
by
 mg.
aid
 
desc
";

187 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

188 
	g$dli¡
->
	g·geSize
 = 10;

189 
	g$dli¡
->
S‘P¬am‘”
("uid",
$_v¬s
['userid']);

190 
	g$dli¡
->
S‘P¬am‘”
("aùiÚ",
$aùiÚ
);

191 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/guestbook.htm");

192 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

193 
	g$dli¡
->
Di¥Ïy
();

194 
ex™
();

201 if(
	g$aùiÚ
=='friend')

203 if(
em±y
(
$mty³
)) {

204 
$mty³
 = 0;

206 
šşude_Úû
(
XAKINC
.'/arc.memberlistview.class.php');

207 
šşude_Úû
(
XAKINC
.'/channelunit.func.php');

208 
	g$qu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath

209 
äom
 `#@
__¬chives
` 
¬c


210 
Ëá
 
još
 `#@
__¬ùy³
` 

 
Ú
 
¬c
.
ty³id
ñp.
id


211 
wh”e
 
¬c
.
mid
='{$_v¬s['mid']}' 
$addqSql
 
Üd”
 
by
‡rc.
id
 
desc
";

212 
$dli¡
 = 
Ãw
 
Memb”Li¡v›w
();

213 
	g$dli¡
->
	g·geSize
 = 8;

214 
	g$dli¡
->
S‘P¬am‘”
("mty³",
$mty³
);

215 
	g$dli¡
->
S‘P¬am‘”
("uid",
$_v¬s
['userid']);

216 
	g$dli¡
->
S‘P¬am‘”
("aùiÚ",
$aùiÚ
);

217 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/friend.htm");

218 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

219 
	g$dli¡
->
Di¥Ïy
();

220 
ex™
();

227 if(
	g$aùiÚ
=='infos')

229 
šşude_Úû
(
XAKDATA
.'/enums/nativeplace.php');

230 
šşude_Úû
(
XAKINC
."/enums.func.php");

231 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * from `#@__member_person` where mid='{$_vars['mid']}' ");

232 
	g$d¶
 = 
Ãw
 
XakTem¶©e
();

233 
	g$d¶
->
LßdTem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/infos.htm");

234 
	g$d¶
->
di¥Ïy
();

241 if(
	g$aùiÚ
=='guestbooksave')

243 
CheckRªk
(0,0);

244 
	g$sv®i
 = 
G‘CkVdV®ue
();

245 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

247 
Re£tVdV®ue
();

248 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

249 
ex™
();

251 
	g$uidnum
 = 
štv®
(
$uidnum
);

252 if(
em±y
(
$uidnum
))

254 
ShowMsg
('å‚æ•°é”™è¯¯ï¼', '-1');

255 
ex™
();

257 if(
¡¾’
(
$msg
)<6)

259 
ShowMsg
('ä½ çš„ç•™è¨€å†…å®¹å¤ªçŸ­ï¼', '-1');

260 
ex™
();

262 
	g$uÇme
 = 
HtmlR•Ïû
(
$uÇme
, 1);

263 
	g$msg
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$msg
), 2048);

264 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
), 255);

265 if(
	g$cfg_ml
->
	gM_U£rName
 !ğ'' && 
$cfg_ml
->
M_ID
 !ğ
$uidnum
)

267 
$gid
 = 
$cfg_ml
->
M_U£rName
;

271 
	g$gid
 = '';

273 
	g$šqu”y
 = "INSERT INTO `#@__member_guestbook`(mid,gid,title,msg,uname,ip,dtime)

274 
VALUES
 ('$uidnum','$gid','$title','$msg','$uname','".GetIP()."',".time()."); ";

275 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

276 
ShowMsg
('æˆåŠŸæäº¤ä½ çš„ç•™è¨€ï¼', "index.php?uid={$uid}&action=guestbook");

277 
ex™
();

284 if(
	g$aùiÚ
=='guestbookdel')

286 
CheckRªk
(0,0);

287 if(
	g$cfg_ml
->
	gM_LogšID
!=
$uid
)

289 
ShowMsg
('è¿™æ¡ç•™è¨€ä¸æ˜¯ç»™ä½ çš„ï¼Œä½ ä¸èƒ½åˆ é™¤ï¼', -1);

290 
ex™
();

292 
	g$šqu”y
 = "DELETE FROM `#@__member_guestbook` WHERE‡id='$aid' AND mid='$mid'";

293 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

294 
ShowMsg
('æˆåŠŸåˆ é™¤ï¼', "index.php?uid={$uid}&action=guestbook");

295 
ex™
();

302 if(
	g$aùiÚ
=='feeddel')

304 
CheckRªk
(0,0);

305 
	g$fid
=(
em±y
(
$fid
))? "" : $fid;

306 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT mid FROM `#@__member_feed` WHERE fid='$fid'");

307 if(
	g$cfg_ml
->
	gM_ID
!=
$row
['mid'])

309 
ShowMsg
('æ­¤åŠ¨æ€ä¿¡æ¯ä¸å­˜åœ¨ï¼', -1);

310 
ex™
();

312 
	g$šqu”y
 = "DELETE FROM `#@__memb”_ãed` WHERE fid='$fid' AND mid='".
$cfg_ml
->
M_ID
."'";

313 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

314 
ShowMsg
('æˆåŠŸåˆ é™¤ä¸€æ¡åŠ¨æ€ä¿¡æ¯ï¼', "index.php");

315 
ex™
();

321 if(
	g$aùiÚ
=='mooddel')

323 
CheckRªk
(0,0);

324 
	g$id
=(
em±y
(
$id
))? "" : $id;

325 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT mid FROM `#@__member_msg` WHERE id='$id'");

326 if(
	g$cfg_ml
->
	gM_ID
!=
$row
['mid'])

328 
ShowMsg
('æ­¤åŠ¨æ€ä¿¡æ¯ä¸å­˜åœ¨ï¼', -1);

329 
ex™
();

331 
	g$šqu”y
 = "DELETE FROM `#@__memb”_msg` WHERE id='$id' AND mid='".
$cfg_ml
->
M_ID
."'";

332 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

333 
ShowMsg
('æˆåŠŸåˆ é™¤ä¸€æ¡å¿ƒæƒ…ï¼', "index.php");

334 
ex™
();

340 if(
	g$aùiÚ
=='newfriend')

342 
CheckRªk
(0,0);

343 if(
	g$_v¬s
['mid']==
$cfg_ml
->
M_ID
)

345 
ShowMsg
("ä½ ä¸èƒ½åŠ è‡ªå·±ä¸ºå¥½å‹ï¼","šdex.php?uid=".
$uid
);

346 
ex™
();

348 
	g$addtime
 = 
time
();

349 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_friends` where fid='{$_vars['mid']}' And mid='{$cfg_ml->M_ID}' ");

350 if(
is_¬¿y
(
$row
))

352 
ShowMsg
("è¯¥ç”¨æˆ·å·²ç»æ˜¯ä½ çš„å¥½å‹ï¼","šdex.php?uid=".
$uid
);

353 
ex™
();

358 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

360 if(
	g$d©a
 = 
uc_g‘_u£r
(
$cfg_ml
->
M_LogšID
)è
uc_ä›nd_add
(
$uid
,
$d©a
[0]);

362 #/
a
}}

364 
	g$šqu”y
 = "INSERT INTO `#@__member_friends` (`fid` , `floginid` , `funame` , `mid` , `addtime` , `ftype`)

365 
VALUES
 ('{$_v¬s['
mid
']}' , '{$_v¬s['
u£rid
']}' , '{$_v¬s['
uÇme
']}' , '{$cfg_ml->M_ID}' , '$addtime' , '0'); ";

366 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

368 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*èAS‚um FROM `#@__memb”_ä›nds` WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

369 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_tj` SET fr›nd='$row[nums]' WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

372 
	g$cfg_ml
->
RecÜdF“ds
('addä›nds',"","",
$_v¬s
['userid']);

374 
ShowMsg
("æˆåŠŸæ·»åŠ å¥½å‹ï¼","šdex.php?uid=".
$uid
);

375 
ex™
();

383 if(
	g$aùiÚ
=='delfriend')

385 
CheckRªk
(0,0);

386 if(
	g$_v¬s
['mid']==
$cfg_ml
->
M_ID
)

388 
ShowMsg
("ä½ ä¸èƒ½å’Œè‡ªå·±ä¸ºè§£é™¤å…³ç³»ï¼","šdex.php?uid=".
$uid
);

389 
ex™
();

391 
	g$addtime
 = 
time
();

392 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * FROM `#@__member_friends` where fid='{$_vars['mid']}' And mid='{$cfg_ml->M_ID}' ");

393 if(!
is_¬¿y
(
$row
))

395 
ShowMsg
("è¯¥ç”¨æˆ·å·²ç»ä¸æ˜¯ä½ çš„å¥½å‹ï¼","šdex.php?uid=".
$uid
);

396 
ex™
();

401 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

403 if(
	g$d©a
 = 
uc_g‘_u£r
(
$cfg_ml
->
M_LogšID
)è
uc_ä›nd_add
(
$uid
,
$d©a
[0]);

405 #/
a
}}

406 
	g$šqu”y
 = "DELETE FROM `#@__member_friends` where fid='{$_vars['mid']}' And mid='{$cfg_ml->M_ID}' ";

407 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

409 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*èAS‚um FROM `#@__memb”_ä›nds` WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

410 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_tj` SET fr›nd='$row[nums]' WHERE `mid`='".
$cfg_ml
->
M_ID
."'");

411 
ShowMsg
("æˆåŠŸè§£é™¤å¥½å‹å…³ç³»ï¼","myfriend.php");

412 
ex™
();

419 if(
	g$aùiÚ
=='blackfriend')

421 
CheckRªk
(0,0);

422 if(
	g$_v¬s
['mid']==
$cfg_ml
->
M_ID
)

424 
ShowMsg
("ä½ ä¸èƒ½åŠ è‡ªå·±åˆ°é»‘åå•ï¼","šdex.php?uid=".
$uid
);

425 
ex™
();

427 
	g$addtime
 = 
time
();

428 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * FROM `#@__member_friends` where fid='{$_vars['mid']}' And mid='{$cfg_ml->M_ID}' ");

429 if(
is_¬¿y
(
$row
))

431 
ShowMsg
("è¯¥ç”¨æˆ·å·²ç»æ˜¯ä½ çš„å¥½å‹ï¼","šdex.php?uid=".
$uid
);

432 
ex™
();

436 
	g$šqu”y
 = "INSERT INTO `#@__member_friends` (`fid` , `floginid` , `funame` , `mid` , `addtime` , `ftype`)

437 
VALUES
 ('{$cfg_ml->M_ID}' , '{$cfg_ml->M_LogšID}' , '{$cfg_ml->M_U£rName}' , '{$_v¬s['
mid
']}' , '$addtime' , '-1'); ";

438 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

439 
ShowMsg
("æˆåŠŸæ·»åŠ å¥½å‹åœ¨é»‘åå•ï¼","šdex.php?uid=".
$uid
);

440 
ex™
();

447 
–£if
(
$aùiÚ
 == 'introduce')

449 
$d¶
 = 
Ãw
 
XakTem¶©e
();

450 
	g$d¶
->
LßdTem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/introduce.htm");

451 
	g$d¶
->
di¥Ïy
();

454 
–£if
 (
$aùiÚ
 == 'contact')

456 
$d¶
 = 
Ãw
 
XakTem¶©e
();

457 
	g$d¶
->
LßdTem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/contact.htm");

458 
	g$d¶
->
di¥Ïy
();

464 
–£if
(
$aùiÚ
 == 'products')

466 
$mty³
 = 
is£t
($mty³è&& 
is_num”ic
($mtype) ? $mtype : 0;

467 if(
	g$aùiÚ
 == 'products') {

468 
$chªÃl
 = 6;

470 
šşude_Úû
(
XAKINC
.'/arc.memberlistview.class.php');

471 
šşude_Úû
(
XAKINC
.'/channelunit.func.php');

473 
	g$qu”y
 = "Select‡rc.*,tp.typedir,tp.typename,tp.isdefault,tp.defaultname,tp.namerule,

474 

.
Çm”uË2
,
	g
.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™eu¾
,.
s™•©h
 
	gFROM
 `#@
	g__¬chives
` 
¬c


475 
Ëá
 
	gjoš
 `#@
	g__¬ùy³
` 

 
Ú
 
	g¬c
.
	gty³id
ñp.
id


476 
wh”e
 
¬c
.
mid
='{$_v¬s['mid']}' 
ªd
‡rc.
chªÃl
='$chªÃl' 
$addqSql
 
Üd”
 
by
‡rc.
id
 
desc
";

478 
$dli¡
 = 
Ãw
 
Memb”Li¡v›w
();

479 
	g$dli¡
->
	g·geSize
 = 12;

480 
	g$dli¡
->
S‘P¬am‘”
('mty³', 
$mty³
);

481 
	g$dli¡
->
S‘P¬am‘”
('uid', 
$_v¬s
['userid']);

482 
	g$dli¡
->
S‘P¬am‘”
('aùiÚ', 
$aùiÚ
);

483 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/space/{$_vars['spacestyle']}/listproducts.htm");

484 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

485 
	g$dli¡
->
Di¥Ïy
();

486 
ex™
();

	@E:\web\weixun\user\index.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

7 
	g$uid
=
em±y
(
$uid
)? "" : 
RemoveXSS
($uid);

8 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

9 if(
em±y
(
$aid
)è
	g$aid
 = '';

11 
	g$m’uty³
 = 'xakmenu';

14 if(
	g$uid
=='')

16 
$iscÚŒŞ
 = 'yes';

17 if(!
	g$cfg_ml
->
IsLogš
())

19 
šşude_Úû
(
dœÇme
(
__FILE__
)."/templets/index-notlogin.htm");

23 
	g$mšfos
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__memb”_tj` WHERE mid='".
$cfg_ml
->
M_ID
."'; ");

24 
	g$mšfos
['tÙ®u£'] = 
$cfg_ml
->
G‘U£rS·û
();

25 
	g$mšfos
['tÙ®u£'] = 
numb”_fÜm©
(
$mšfos
['totaluse']/1024/1024,2);

26 if(
	g$cfg_mb_max
 > 0) {

27 
	g$ddsize
 = 
û
Ğ(
$mšfos
['tÙ®u£']/
$cfg_mb_max
) * 100 );

30 
	g$ddsize
 = 0;

33 
»quœe_Úû
(
XAKINC
.'/channelunit.func.php');

36 
	g$¬chives
 = 
¬¿y
();

37 
	g$sql
 = "SELECT‡rc.*, category.namerule, category.typedir, category.moresite, category.siteurl, category.sitepath, mem.userid

38 
FROM
 #@
__¬chives
 
¬c


39 
LEFT
 
JOIN
 `#@
__¬ùy³
` 
ÿ‹gÜy
 
ON
 c©egÜy.
id
=
¬c
.
ty³id


40 
LEFT
 
JOIN
 `#@
__memb”_li¡
` 
mem
 
ON
 mem.
mid
=
¬c
.mid

41 
WHERE
 
¬c
.
¬üªk
 > -1

42 
ORDER
 
BY
 
¬c
.
sÜŒªk
 
DESC
 
LIMIT
 8";

43 
$dsql
->
S‘Qu”y
(
$sql
);

44 
	g$dsql
->
Execu‹
();

45 
	g$row
 = 
$dsql
->
G‘A¼ay
())

47 
$row
['htmlu¾'] = 
G‘FeU¾
($row['id'], $row['typeid'], $row['senddate'], $row['title'], $row['ismake'], $row['arcrank'], $row['namerule'], $row['typedir'], $row['money'], $row['filename'], $row['moresite'], $row['siteurl'], $row['sitepath']);

48 
	g$¬chives
[] = 
$row
;

52 
	g$_v¬s
['mid'] = 
$cfg_ml
->
M_ID
;

54 if(
em±y
(
$cfg_ml
->
f›lds
['face']))

56 
	g$cfg_ml
->
	gf›lds
['çû']=(
$cfg_ml
->
f›lds
['sex']=='å¥³')? 'templets/images/dfgirl.png' : 'templets/images/dfboy.png';

60 
	g$çvÜ™es
 = 
¬¿y
();

61 
	g$dsql
->
Execu‹
('fl',"SELECT * FROM `#@__member_stow` WHERE mid='{$cfg_ml->M_ID}' LIMIT 5");

62 
	g$¬r
 = 
$dsql
->
G‘A¼ay
('fl'))

64 
$çvÜ™es
[] = 
$¬r
;

68 
	g$sql
 = "SELECT * FROM `#@__member_list` ORDER BY mid DESC LIMIT 3";

69 
	g$Ãwä›nds
 = 
¬¿y
();

70 
	g$dsql
->
S‘Qu”y
(
$sql
);

71 
	g$dsql
->
Execu‹
();

72 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

73 
$Ãwä›nds
[] = 
$row
;

77 
	g$sql
 = "SELECT F.*,M.face,M.sex FROM `#@__member_list` AS M LEFT JOIN `#@__member_friends` AS F ON F.fid=M.mid WHERE F.mid='{$cfg_ml->M_ID}' ORDER BY F.addtime desc LIMIT 6";

78 
	g$ä›nds
 = 
¬¿y
();

79 
	g$dsql
->
S‘Qu”y
(
$sql
);

80 
	g$dsql
->
Execu‹
();

81 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

82 
$ä›nds
[] = 
$row
;

86 
	g$pms
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS‚ums FROM `#@__member_pms` WHEREoid='{$cfg_ml->M_ID}' AND `hasview`=0 AND folder = 'inbox'");

89 
	g$moodmsg
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_msg` WHERE mid='{$cfg_ml->M_ID}' ORDER BY dtime desc");

92 
	g$sql
 = "SELECT * From `#@__member_feed` where ischeck=1 order by fid desc†imit 8";

93 
	g$ãeds
 = 
¬¿y
();

94 
	g$dsql
->
S‘Qu”y
(
$sql
);

95 
	g$dsql
->
Execu‹
();

96 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

97 
$ãeds
[] = 
$row
;

100 
	g$d¶
 = 
Ãw
 
XakTem¶©e
();

101 
	g$l
 = 
dœÇme
(
__FILE__
)."/templets/index.htm";

102 
	g$d¶
->
LßdTem¶©e
(
$l
);

103 
	g$d¶
->
di¥Ïy
();

113 
»quœe_Úû
(
XAKMEMBER
.'/inc/config_space.php');

114 if(
	g$aùiÚ
 == '')

116 
šşude_Úû
(
XAKINC
."/channelunit.func.php");

117 
	g$d¶
 = 
Ãw
 
XakTem¶©e
();

118 
	g$lfe
 = 
XAKMEMBER
."/space/{$_vars['spacestyle']}/index.htm";

121 
	g$vtime
 = 
time
();

122 
	g$Ï¡_vtime
 = 
G‘Cook›
('last_vtime');

123 
	g$Ï¡_vid
 = 
G‘Cook›
('last_vid');

124 if(
em±y
(
$Ï¡_vtime
))

126 
	g$Ï¡_vtime
 = 0;

128 if(
	g$vtime
 - 
	g$Ï¡_vtime
 > 3600 || !
´eg_m©ch
('#,'.
$uid
.',#i', ','.
$Ï¡_vid
.',') )

130 if(
	g$Ï¡_vid
!='')

132 
$Ï¡_vids
 = 
ex¶ode
(',',
$Ï¡_vid
);

133 
	g$i
 = 0;

134 
	g$Ï¡_vid
 = 
$uid
;

135 
fÜ—ch
(
$Ï¡_vids
 
as
 
$lsid
)

137 if(
	g$i
>10)

141 if(
	g$lsid
 !ğ
$uid
)

143 
$i
++;

144 
	g$Ï¡_vid
 .ğ','.
$Ï¡_vid
;

150 
	g$Ï¡_vid
 = 
$uid
;

152 
PutCook›
('Ï¡_vtime', 
$vtime
, 3600*24, '/');

153 
PutCook›
('Ï¡_vid', 
$Ï¡_vid
, 3600*24, '/');

154 if(
	g$cfg_ml
->
IsLogš
(è&& $cfg_ml->
	gM_LogšID
 !ğ
$uid
)

156 
$v
 = 
G‘IP
();

157 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_vhistory` WHERE mid='{$_vars['mid']}' AND vid='{$cfg_ml->M_ID}' ");

158 if(
is_¬¿y
(
$¬r
))

160 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_vhistory` SET vip='$vip',vtime='$vtime',count=count+1 WHERE mid='{$_vars['mid']}' AND vid='{$cfg_ml->M_ID}' ");

164 
	g$qu”y
 = "INSERT INTO `#@__member_vhistory`(mid,loginid,vid,vloginid,count,vip,vtime)

165 
VALUES
('{$_v¬s['
mid
']}','{$_v¬s['
u£rid
']}','{$cfg_ml->M_ID}','{$cfg_ml->M_LoginID}','1','$vip','$vtime'); ";

166 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

169 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_tj` SET homecount=homecount+1 WHERE mid='{$_vars['mid']}' ");

171 
	g$d¶
->
LßdTem¶©e
(
$lfe
);

172 
	g$d¶
->
di¥Ïy
();

173 
ex™
();

177 
»quœe_Úû
(
XAKMEMBER
.'/inc/space_action.php');

178 
ex™
();

	@E:\web\weixun\user\index_do.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

7 if(
em±y
(
$fmdo
)è
	g$fmdo
 = '';

12 if(
	g$fmdo
=='sendMail')

14 if(!
CheckEma
(
$cfg_ml
->
f›lds
['email']) )

16 
ShowMsg
('ä½ çš„é‚®ç®±æ ¼å¼æœ‰é”™è¯¯ï¼', '-1');

17 
ex™
();

19 if(
	g$cfg_ml
->
	gf›lds
['spacesta'] != -10)

21 
ShowMsg
('ä½ çš„å¸å·ä¸åœ¨é‚®ä»¶éªŒè¯çŠ¶æ€ï¼Œæœ¬æ“ä½œæ— æ•ˆï¼', '-1');

22 
ex™
();

24 
	g$u£rhash
 = 
md5
(
$cfg_cook›_’code
.'--'.
$cfg_ml
->
f›lds
['mid'].'--'.$cfg_ml->fields['email']);

25 
	g$u¾
 = 
$cfg_ba£ho¡
.(
em±y
(
$cfg_cm¥©h
) ? '/' : $cfg_cmspath)."/user/index_do.php?fmdo=checkMail&mid={$cfg_ml->fields['mid']}&userhash={$userhash}&do=1";

26 
	g$u¾
 = 
´eg_»¶aû
("#h‰p:\/\/#i", '', 
$u¾
);

27 
	g$u¾
 = 'h‰p://'.
´eg_»¶aû
("#\/\/#i", '/', 
$u¾
);

28 
	g$mat™Ë
 = "{$cfg_webname}--ä¼šå‘˜é‚®ä»¶éªŒè¯é€šçŸ¥";

29 
	g$mabody
 = '';

30 
	g$mabody
 .= "å°Šæ•¬çš„ç”¨æˆ·[{$cfg_ml->fields['uname']}]ï¼Œæ‚¨å¥½ï¼š\r\n";

31 
	g$mabody
 .= "æ¬¢è¿æ³¨å†Œæˆä¸º[{$cfg_webname}]çš„ä¼šå‘˜ã€‚\r\n";

32 
	g$mabody
 .= "è¦é€šè¿‡æ³¨å†Œï¼Œè¿˜å¿…é¡»è¿›è¡Œæœ€åä¸€æ­¥æ“ä½œï¼Œè¯·ç‚¹å‡»æˆ–å¤åˆ¶ä¸‹é¢é“¾æ¥åˆ°åœ°å€æ è®¿é—®è¿™åœ°å€ï¼š\r\n\r\n";

33 
	g$mabody
 .= "{$url}\r\n\r\n";

34 
	g$mabody
 .= "Power by http://www.xak.cn å†…å®¹ç®¡ç†ç³»ç»Ÿï¼\r\n";

36 
	g$h—d”s
 = "From: ".
$cfg_admšema
."\r\nReply-To: ".$cfg_adminemail;

37 if(
	g$cfg_£ndma_bysm
 =ğ'Y' && !
em±y
(
$cfg_sm_£rv”
))

39 
$maty³
 = 'TXT';

40 
»quœe_Úû
(
XAKINC
.'/mail.class.php');

41 
	g$sm
 = 
Ãw
 
sm
(
$cfg_sm_£rv”
,
$cfg_sm_pÜt
,
Œue
,
$cfg_sm_u£rma
,
$cfg_sm_·sswÜd
);

42 
	g$sm
->
	gdebug
 = 
çl£
;

43 
	g$sm
->
£ndma
(
$cfg_ml
->
f›lds
['ema'],
$cfg_webÇme
 ,
$cfg_sm_u£rma
, 
$mat™Ë
, 
$mabody
, 
$maty³
);

47 @
ma
(
$cfg_ml
->
f›lds
['ema'], 
$mat™Ë
, 
$mabody
, 
$h—d”s
);

49 
ShowMsg
('æˆåŠŸå‘é€é‚®ä»¶ï¼Œè¯·ç¨åç™»å½•ä½ çš„é‚®ç®±è¿›è¡Œæ¥æ”¶ï¼', '/user');

50 
ex™
();

52 if(
	g$fmdo
=='checkMail')

54 
$mid
 = 
štv®
($mid);

55 if(
em±y
(
$mid
))

57 
ShowMsg
('ä½ çš„æ•ˆéªŒä¸²ä¸åˆæ³•ï¼', '-1');

58 
ex™
();

60 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE mid='{$mid}' ");

61 
	g$ÃedU£rhash
 = 
md5
(
$cfg_cook›_’code
.'--'.
$mid
.'--'.
$row
['email']);

62 if(
	g$ÃedU£rhash
 !ğ
$u£rhash
)

64 
ShowMsg
('ä½ çš„æ•ˆéªŒä¸²ä¸åˆæ³•ï¼', '-1');

65 
ex™
();

67 if(
	g$row
['spacesta'] != -10)

69 
ShowMsg
('ä½ çš„å¸å·ä¸åœ¨é‚®ä»¶éªŒè¯çŠ¶æ€ï¼Œæœ¬æ“ä½œæ— æ•ˆï¼', '-1');

70 
ex™
();

72 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET spacesta=0 WHERE mid='{$mid}' ");

74 
	g$cfg_ml
->
D–Cache
(
$mid
);

75 
ShowMsg
('æ“ä½œæˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•ç³»ç»Ÿï¼', 'login.php');

76 
ex™
();

81 if(
	g$fmdo
=='user')

85 if(
$dİo¡
=="checkuser")

87 
AjaxH—d
();

88 
	g$msg
 = '';

89 
	g$uid
 = 
Œim
(
$uid
);

90 if(
	g$ckty³
==0)

92 
$msgt™Ë
='ç”¨æˆ·ç¬”å';

97 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

99 
	g$uüesuÉ
 = 
uc_u£r_checkÇme
(
$uid
);

100 if(
	g$uüesuÉ
 > 0)

102 
	gecho
 "<font color='#4E7504'><b>âˆšç”¨æˆ·åå¯ç”¨</b></font>";

104 
–£if
(
$uüesuÉ
 == -1)

106 
echo
 "<font color='red'><b>Ã—ç”¨æˆ·åä¸åˆæ³•</b></font>";

108 
–£if
(
$uüesuÉ
 == -2)

110 
echo
 "<font color='red'><b>Ã—åŒ…å«è¦å…è®¸æ³¨å†Œçš„è¯è¯­</b></font>";

112 
–£if
(
$uüesuÉ
 == -3)

114 
echo
 "<font color='red'><b>Ã—ç”¨æˆ·åå·²ç»å­˜åœ¨</b></font>";

116 
ex™
();

118 #/
a
}}

119 
	g$msgt™Ë
='ç”¨æˆ·å';

121 if(
	g$ckty³
!=0 || 
$cfg_mb_wÇmeÚe
=='N') {

122 
$msg
 = 
CheckU£rID
(
$uid
, 
$msgt™Ë
);

125 
	g$msg
 = 
CheckU£rID
(
$uid
, 
$msgt™Ë
, 
çl£
);

127 if(
	g$msg
=='ok')

129 
$msg
 = "<font color='#4E7504'><b>âˆš{$msgtitle}å¯ä»¥ä½¿ç”¨</b></font>";

133 
	g$msg
 = "<font color='red'><b>Ã—{$msg}</b></font>";

135 
echo
 
	g$msg
;

136 
ex™
();

140 if(
	g$dİo¡
=="checkmail")

142 
AjaxH—d
();

145 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

147 
	g$uüesuÉ
 = 
uc_u£r_checkema
(
$ema
);

148 if(
	g$uüesuÉ
 > 0) {

149 
	gecho
 "<font color='#4E7504'><b>âˆšå¯ä»¥ä½¿ç”¨</b></font>";

150 } 
–£if
(
$uüesuÉ
 == -4) {

151 
echo
 "<font color='red'><b>Ã—Email æ ¼å¼æœ‰è¯¯ï¼</b></font>";

152 } 
–£if
(
$uüesuÉ
 == -5) {

153 
echo
 "<font color='red'><b>Ã—Email ä¸å…è®¸æ³¨å†Œï¼</b></font>";

154 } 
–£if
(
$uüesuÉ
 == -6) {

155 
echo
 "<font color='red'><b>Ã—è¯¥ Email å·²ç»è¢«æ³¨å†Œï¼</b></font>";

157 
ex™
();

159 #/
a
}}

161 if(
	g$cfg_md_ma‹¡
=='N')

163 
$msg
 = "<font color='#4E7504'><b>âˆšå¯ä»¥ä½¿ç”¨</b></font>";

167 if(!
CheckEma
(
$ema
))

169 
	g$msg
 = "<font color='#4E7504'><b>Ã—Emailæ ¼å¼æœ‰è¯¯</b></font>";

173 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT mid FROM `#@__member_list` WHEREƒmail LIKE '$email' LIMIT 1");

174 if(!
is_¬¿y
(
$row
)) {

175 
	g$msg
 = "<font color='#4E7504'><b>âˆšå¯ä»¥ä½¿ç”¨</b></font>";

178 
	g$msg
 = "<font color='red'><b>Ã—Emailå·²ç»è¢«å¦ä¸€ä¸ªå¸å·å ç”¨ï¼</b></font>";

182 
echo
 
	g$msg
;

183 
ex™
();

187 if(
	g$dİo¡
=="regnew")

189 
$¡•
 = 
em±y
($¡•)? 1 : 
štv®
(
´eg_»¶aû
("/[^\d]/",'', $step));

190 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/reg_new.php");

191 
ex™
();

197 if(
	g$dİo¡
=="money2s")

199 
CheckRªk
(0,0);

200 if(
	g$cfg_mÚey_scÜes
==0)

202 
ShowMsg
('ç³»ç»Ÿç¦ç”¨äº†ç§¯åˆ†ä¸é‡‘å¸å…‘æ¢åŠŸèƒ½ï¼', '-1');

203 
ex™
();

205 
	g$mÚey
 = 
em±y
(
$mÚey
è? "" : 
abs
(
štv®
($money));

206 if(
em±y
(
$mÚey
))

208 
ShowMsg
('æ‚¨æ²¡æŒ‡å®šè¦å…‘æ¢å¤šå°‘é‡‘å¸ï¼', '-1');

209 
ex™
();

212 
	g$ÃedscÜes
 = 
$mÚey
 * 
$cfg_mÚey_scÜes
;

213 if(
	g$cfg_ml
->
	gf›lds
['scÜes'] < 
	g$ÃedscÜes
 )

215 
ShowMsg
('æ‚¨ç§¯åˆ†ä¸è¶³ï¼Œä¸èƒ½æ¢å–è¿™ä¹ˆå¤šçš„é‡‘å¸ï¼', '-1');

216 
ex™
();

218 
	g$l™m™scÜes
 = 
$cfg_ml
->
f›lds
['scÜes'] - 
$ÃedscÜes
;

221 
	g$mtime
 = 
time
();

222 
	g$šqu”y
 = "INSERT INTO `#@__member_operation`(`buyid` , `pname` , `product` , `money` , `mtime` , `pid` , `mid` , `sta` ,`oldinfo`)

223 
VALUES
 ('ScoresToMoney', 'ç§¯åˆ†æ¢é‡‘å¸æ“ä½œ', 'stc' , '0' , '$mtime' , '0' , '{$cfg_ml->M_ID}' , '0' , 'ç”¨ {$needscores} ç§¯åˆ†å…‘äº†æ¢é‡‘å¸ï¼š{$money} ä¸ª'); ";

224 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

226 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_li¡` SET `scÜes`=$l™m™scÜes, mÚeyğmÚey + $mÚey WHERE mid='".
$cfg_ml
->
M_ID
."' ");

229 
	g$cfg_ml
->
D–Cache
(
$cfg_ml
->
M_ID
);

230 
ShowMsg
('æˆåŠŸå…‘æ¢æŒ‡å®šé‡çš„é‡‘å¸ï¼', 'operation.php');

231 
ex™
();

238 if(
	g$fmdo
=='login')

241 if(
$dİo¡
=="login")

243 if(!
is£t
(
$vdcode
))

245 
$vdcode
 = '';

247 
	g$sv®i
 = 
G‘CkVdV®ue
();

248 if(
´eg_m©ch
("/2/",
$§ã_gdİ’
)){

249 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

251 
Re£tVdV®ue
();

252 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

253 
ex™
();

257 if(
CheckU£rID
(
$u£rid
,'',
çl£
)!='ok')

259 
ShowMsg
("ä½ è¾“å…¥çš„ç”¨æˆ·å {$userid} ä¸åˆæ³•ï¼","-1");

260 
ex™
();

262 if(
	g$pwd
=='')

264 
ShowMsg
("å¯†ç ä¸èƒ½ä¸ºç©ºï¼","-1",0,2000);

265 
ex™
();

269 
	g$rs
 = 
$cfg_ml
->
CheckU£r
(
$u£rid
,
$pwd
);

272 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

275 
li¡
(
$uid
, 
$u£ºame
, 
$·sswÜd
, 
$ema
èğ
uc_u£r_logš
(
$u£rid
, 
$pwd
);

276 if(
	g$uid
 > 0) {

277 
	g$·sswÜd
 = 
PassJoš
(
$·sswÜd
);

279 if(!
	g$rs
) {

281 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `money`,`scores` FROM `#@__arcrank` WHERE `rank`='10' ");

282 
	g$scÜes
 = 
is_¬¿y
(
$row
) ? $row['scores'] : 0;

283 
	g$mÚey
 = 
is_¬¿y
(
$row
) ? $row['money'] : 0;

284 
	g$logštime
 = 
$joštime
 = 
time
();

285 
	g$logš
 = 
$još
 = 
G‘IP
();

286 
	g$»s
 = 
$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__member_list` SET `mtype`='ä¸ªäºº',`userid`='$username',`pwd`='$password',`uname`='$username',`sex`='ç”·' ,`rank`='10',`money`='$money', `email`='$email', `scores`='$scores', `matt`='0', `face`='',`safequestion`='0',`safeanswer`='', `jointime`='$jointime',`joinip`='$joinip',`logintime`='$logintime',`loginip`='$loginip';");

287 if(
	g$»s
) {

288 
	g$mid
 = 
$dsql
->
G‘La¡ID
();

289 
	g$d©a
 = 
¬¿y


292 `
bœthday
`='1980-01-01', `
	g¡¬
`='1', `
	gšcome
`='0', `
	geduÿtiÚ
`='0', `
	gheight
`='160', `
	gbodyty³
`='0', `
	gblood
`='0', `
	gvoÿtiÚ
`='0', `
	gsmoke
`='0', `
	gm¬™®
`='0', `
	ghou£
`='0',

293 `
	gdršk
`='0', `
	gd©šgty³
`='0', `
	gÏnguage
`='', `
	gÇtu»
`='', `
	glovemsg
`='', `
	gadd»ss
`='',`
	gu±ime
`='0';",

298 
fÜ—ch
(
$d©a
 
as
 
$v®
è
	g$dsql
->
Execu‹NÚeQu”y
($val);

301 
	g$rs
 = 1;

302 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `mid`, `pwd` FROM `#@__member_list` WHERE `userid`='$username'");

303 if(
is£t
(
$row
['mid']))

305 
	g$cfg_ml
->
PutLogšInfo
(
$row
['mid']);

306 if(
	g$·sswÜd
!=
$row
['pwd']è
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET `pwd`='$password' WHERE mid='$row[mid]'");

309 
	g$ucsyÆogš
 = 
uc_u£r_syÆogš
(
$uid
);

310 } if(
	g$uid
 == -1) {

312 if(
$rs
) {

313 
$row
 = 
$dsql
->
G‘OÃ
("SELECT `email` FROM `#@__member_list` WHERE userid='$userid'");

314 
	g$uid
 = 
uc_u£r_»gi¡”
(
$u£rid
, 
$pwd
, 
$row
['email']);

315 if(
	g$uid
 > 0è
	g$ucsyÆogš
 = 
uc_u£r_syÆogš
(
$uid
);

317 
	g$rs
 = -1;

320 
	g$rs
 = -1;

323 #/
a
}}

325 if(
	g$rs
==0)

327 
ShowMsg
("ç”¨æˆ·åä¸å­˜åœ¨ï¼", "-1", 0, 2000);

328 
ex™
();

330 if(
	g$rs
==-1) {

331 
ShowMsg
("å¯†ç é”™è¯¯ï¼", "-1", 0, 2000);

332 
ex™
();

334 if(
	g$rs
==-2) {

335 
ShowMsg
("ç®¡ç†å‘˜å¸å·ä¸å…è®¸ä»å‰å°ç™»å½•ï¼", "-1", 0, 2000);

336 
ex™
();

341 
	g$cfg_ml
->
D–Cache
(
$cfg_ml
->
M_ID
);

342 if(
em±y
(
$gou¾
è|| 
´eg_m©ch
("#action|_do#i", $gourl))

344 
ShowMsg
("æˆåŠŸç™»å½•ï¼Œ5ç§’é’Ÿåè½¬å‘ç³»ç»Ÿä¸»é¡µ...","index.php",0,2000);

348 
	g$gou¾
 = 
¡r_»¶aû
('^','&',
$gou¾
);

349 
ShowMsg
("æˆåŠŸç™»å½•ï¼Œç°åœ¨è½¬å‘æŒ‡å®šé¡µé¢...",
$gou¾
,0,2000);

351 
ex™
();

356 if(
	g$dİo¡
=="exit")

358 
$cfg_ml
->
Ex™Cook›
();

360 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

362 
	g$ucsyÆogš
 = 
uc_u£r_syÆogout
();

364 #/
a
}}

365 
ShowMsg
("æˆåŠŸé€€å‡ºç™»å½•ï¼","index.php",0,2000);

366 
ex™
();

372 if(
	g$fmdo
=='moodmsg')

375 if(
$dİo¡
=="sendmsg")

377 if(!
em±y
(
$cÚ‹Á
))

379 
$
 = 
G‘IP
();

380 
	g$dtime
 = 
time
();

381 
	g$ischeck
 = (
$cfg_mb_msgischeck
 == 'Y')? 0 : 1;

382 if(
	g$cfg_soá_Ïng
 == 'gb2312')

384 
$cÚ‹Á
 = 
utf82gb
(
Æ2br
($content));

386 
	g$cÚ‹Á
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$cÚ‹Á
,1),360);

388 
	g$cÚ‹Á
 = 
add¦ashes
(
´eg_»¶aû
("/\[çû:(\d{1,2})\]/is","<img src='".
$cfg_memb”u¾
."/‹m¶‘s/images/smey/\\1.gif' styË='cursÜ:…oš‹r;…os™iÚ:„–©ive;'>",
$cÚ‹Á
));

390 
	g$šqu”y
 = "INSERT INTO `#@__member_msg`(`mid`,`userid`,`ip`,`ischeck`,`dtime`, `msg`)

391 
VALUES
 ('{$cfg_ml->M_ID}','{$cfg_ml->M_LoginID}','$ip','$ischeck','$dtime', '$content'); ";

392 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

393 if(!
	g$rs
)

395 
	g$ouut
['type'] = 'error';

396 
	g$ouut
['data'] = 'æ›´æ–°å¤±è´¥,è¯·é‡è¯•.';

397 
ex™
();

399 
	g$ouut
['type'] = 'success';

400 if(
	g$cfg_soá_Ïng
 == 'gb2312')

402 
$cÚ‹Á
 = 
utf82gb
(
Æ2br
($content));

404 
	g$ouut
['d©a'] = 
¡r¦ashes
(
$cÚ‹Á
);

405 
ex™
(
jsÚ_’code
(
$ouut
));

411 
ShowMsg
("æœ¬é¡µé¢ç¦æ­¢è¿”å›!","index.php");

	@E:\web\weixun\user\login.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 if(
	g$cfg_ml
->
	$IsLogš
())

8 
	`ShowMsg
('ä½ å·²ç»ç™»é™†ç³»ç»Ÿï¼Œæ— éœ€é‡æ–°æ³¨å†Œï¼', 'index.php');

9 
	`ex™
();

10 
	}
}

11 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/login.htm");

	@E:\web\weixun\user\mail.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

3 
CheckRªk
(0,0);

4 
	g$m’uty³
 = 'xakmenu';

5 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

6 
	g$dİo¡
 = 
is£t
(
$dİo¡
è? 
	$Œim
(
$dİo¡
) : '';

7 
$fŞd”
 = 
	`is£t
($fŞd”è? 
	$Œim
(
$fŞd”
) : '';

8 
$mid
 = 
$cfg_ml
->
M_ID
;

9 if(
$dİo¡
 == '')

11 if(
$cfg_mb_¥aû¡a
!="-10"){

12 if(
$cfg_checkema
=='Y'){

13 
$row
=
$dsql
->
	`G‘OÃ
("SELECTƒmail,checkmail FROM `#@__member_list` WHERE mid=$mid");

14 if(
$row
['checkmail']=="-1"){

15 
$msg
="é‚®ä»¶è®¢é˜…éœ€è¦æ‚¨å…ˆè¿›è¡Œé‚®ç®±éªŒè¯ï¼</br><a href='mail.php?dopost=sendmail'>ç‚¹å‡»è¿›è¡ŒéªŒè¯</a>";

16 
	`ShowMsg
(
$msg
,'-1');

17 
	`ex™
();

21 
$db
->
	`S‘Qu”y
("SELECTypeid FROM `#@__mail_order` WHERE mid=$mid");

22 
$db
->
	`Execu‹
();

23 
$ty³id
="";

24 
$row
 = 
$db
->
	`G‘A¼ay
())

26 
$ty³id
.=
$row
['typeid'].",";

28 if(
$fŞd”
=="drop"){

29 
$dsql
->
	`S‘Qu”y
("SELECT.*,o.mid FROM `#@__mail_type` AS LEFT JOIN `#@__mail_order` AS o ON.id=o.typeid WHERE mid=$mid ORDER BY.id‡sc");

30 
$dsql
->
	`Execu‹
();

31 
$¬r
 = 
$dsql
->
	`G‘A¼ay
())

33 
$rows
[]=
$¬r
;

35 
$rows
=
	`em±y
($rows)? "" : $rows;

36 
$l
 = 
Ãw
 
	`XakTem¶©e
();

37 
$l
->
	`LßdTem¶©e
(
XAKMEMBER
.'/templets/mail_drop.htm');

38 
$l
->
	`Di¥Ïy
();

40 
$ty³id
=
	`ex¶ode
(",",$typeid);

41 
$dsql
->
	`S‘Qu”y
("SELECT * FROM `#@__mail_type` ORDER BY id‡sc");

42 
$dsql
->
	`Execu‹
();

43 
$šputbox
="";

44 
$row
 = 
$dsql
->
	`G‘Objeù
())

46 if(
	`š_¬¿y
(
$row
->
id
,
$ty³id
)){

47 
$šputbox
.="<li><inputype='checkbox'‚ame='mailtype[]' id='{$row->id}' value='{$row->id}' class='np' checked/> <label>{$row->typename}</label></li>\r\n";

49 
$šputbox
.="<li><inputype='checkbox'‚ame='mailtype[]' id='{$row->id}' value='{$row->id}' class='np' /> <label>{$row->typename}</label></li>\r\n";

52 
$l
 = 
Ãw
 
	`XakTem¶©e
();

53 
$l
->
	`LßdTem¶©e
(
XAKMEMBER
.'/templets/mail.htm');

54 
$l
->
	`Di¥Ïy
();

56 
	}

}–£if
(
$dİo¡
 == 'save' || $dopost == 'drop'){

57 
$maty³
=
em±y
($mailtype)? "" : $mailtype;

58 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__mail_order WHERE mid=$mid");

59 if(
	g$dİo¡
 =ğ'§ve' && 
$maty³
==""){

60 
ShowMsg
("è¯·é€‰æ‹©è®¢é˜…ç±»å‹ï¼",'mail.php');

61 
ex™
();

63 if(
	g$dİo¡
=="§ve"è
$msg
="è®¢é˜…æˆåŠŸï¼";

64 
–£if
(
$dİo¡
=="drİ"è
$msg
="é€€è®¢æˆåŠŸï¼";

65 if(
is_¬¿y
(
$maty³
)){

66 
fÜ—ch
(
$maty³
 
as
 
$ty³
){

67 
	g$dsql
->
Execu‹NÚeQu”y
("INSERT INTO #@__mail_order(`typeid` , `mid`)VALUES ('$type', '$mid')");

70 
ShowMsg
(
$msg
,'mail.php');

71 
ex™
();

72 }
–£if
(
$dİo¡
=='sendmail'){

73 
$u£rhash
 = 
md5
(
$cfg_cook›_’code
.'--'.
$cfg_ml
->
f›lds
['mid'].'--'.$cfg_ml->fields['email']);

74 
	g$u¾
 = 
$cfg_ba£ho¡
.(
em±y
(
$cfg_cm¥©h
) ? '/' : $cfg_cmspath)."/user/mail.php?dopost=checkmail&mid={$cfg_ml->fields['mid']}&userhash={$userhash}&do=1";

75 
	g$u¾
 = 
”egi_»¶aû
('h‰p://', '', 
$u¾
);

76 
	g$u¾
 = 'h‰p://'.
”egi_»¶aû
('//', '/', 
$u¾
);

77 
	g$mat™Ë
 = "{$cfg_webname}--ä¼šå‘˜é‚®ä»¶éªŒè¯é€šçŸ¥";

78 
	g$mabody
 = '';

79 
	g$mabody
 .= "å°Šæ•¬çš„ç”¨æˆ·[{$cfg_ml->fields['uname']}]ï¼Œæ‚¨å¥½ï¼š\r\n";

80 
	g$mabody
 .= "æ¬¢è¿ä½¿ç”¨é‚®ä»¶è®¢é˜…åŠŸèƒ½ã€‚\r\n";

81 
	g$mabody
 .= "è¦é€šè¿‡éªŒè¯ï¼Œè¯·ç‚¹å‡»æˆ–å¤åˆ¶ä¸‹é¢é“¾æ¥åˆ°åœ°å€æ è®¿é—®è¿™åœ°å€ï¼š\r\n\r\n";

82 
	g$mabody
 .= "{$url}\r\n\r\n";

84 if(
	g$cfg_£ndma_bysm
 =ğ'Y' && !
em±y
(
$cfg_sm_£rv”
))

86 
$maty³
 = 'TXT';

87 
»quœe_Úû
(
XAKINC
.'/mail.class.php');

88 
	g$sm
 = 
Ãw
 
sm
(
$cfg_sm_£rv”
,
$cfg_sm_pÜt
,
Œue
,
$cfg_sm_u£rma
,
$cfg_sm_·sswÜd
);

89 
	g$sm
->
	gdebug
 = 
çl£
;

90 if(!
	g$sm
->
sm_sockİ’
(
$cfg_sm_£rv”
)){

91 
ShowMsg
('é‚®ä»¶å‘é€å¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜','index.php');

92 
ex™
();

94 
	g$sm
->
£ndma
(
$cfg_ml
->
f›lds
['ema'], 
$cfg_webÇme
,
$cfg_sm_u£rma
, 
$mat™Ë
, 
$mabody
, 
$maty³
);

96 @
ma
(
$cfg_ml
->
f›lds
['ema'], 
$mat™Ë
, 
$mabody
);

98 if(
em±y
(
$cfg_sm_£rv”
)){

99 
ShowMsg
('é‚®ä»¶å‘é€å¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜','index.php');

100 
ex™
();

102 
ShowMsg
('æˆåŠŸå‘é€é‚®ä»¶ï¼Œè¯·ç™»å½•ä½ çš„é‚®ç®±è¿›è¡Œæ¥æ”¶ï¼', 'index.php');

103 
ex™
();

105 }if(
	g$dİo¡
=='checkmail'){

106 
$mid
 = 
štv®
($mid);

107 if(
em±y
(
$mid
))

109 
ShowMsg
('ä½ çš„æ•ˆéªŒä¸²ä¸åˆæ³•ï¼', '-1');

110 
ex™
();

112 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * From `#@__member_list` where mid='{$mid}' ");

113 
	g$ÃedU£rhash
 = 
md5
(
$cfg_cook›_’code
.'--'.
$mid
.'--'.
$row
['email']);

114 if(
	g$ÃedU£rhash
 !ğ
$u£rhash
)

116 
ShowMsg
('ä½ çš„æ•ˆéªŒä¸²ä¸åˆæ³•ï¼', '-1');

117 
ex™
();

119 
	g$dsql
->
Execu‹NÚeQu”y
("Update `#@__member_list` set checkmail=0 where mid='{$mid}' ");

120 
ShowMsg
('æ“ä½œæˆåŠŸ,æ¬¢è¿ä½¿ç”¨é‚®ä»¶è®¢é˜…ï¼', 'mail.php');

121 
ex™
();

	@E:\web\weixun\user\mtypes.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

6 
CheckRªk
(0, 0);

7 
	g$dİo¡
 = 
is£t
(
$dİo¡
è? 
	$Œim
(
$dİo¡
) : '';

8 
$m’uty³
 = 'config';

9 if(
$dİo¡
 == '')

11 if(
	`em±y
(
$chªÃlid
)) $channelid = 0;

12 
$chªÃlid
 = 
	`štv®
($channelid);

13 
$mty³¬r
 = 
	`¬¿y
();

14 
$addqu”y
 = '';

15 if(!
	`em±y
(
$chªÃlid
)è
$addqu”y
 = " AND channelid='$channelid' ";

16 
$qu”y
 = "SELECT * FROM `#@__mtypes` WHERE mid='{$cfg_ml->M_ID}' $addquery ";

17 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

18 
$dsql
->
	`Execu‹
();

19 
$row
 = 
$dsql
->
	`G‘A¼ay
())

21 
$mty³¬r
[] = 
$row
;

23 
$l
 = 
Ãw
 
	`XakTem¶©e
();

24 
$l
->
	`LßdTem¶©e
(
XAKMEMBER
.'/templets/mtypes.htm');

25 
$l
->
	`Di¥Ïy
();

26 
	`ex™
();

27 
	}
}

28 
–£if
 (
$dİo¡
 == 'add')

30 
$mty³Çme
 = 
HtmlR•Ïû
(
Œim
($mtypename));

31 
	g$chªÃlid
 = 
štv®
(
$chªÃlid
);

32 if(
em±y
(
$chªÃlid
)è
	g$chªÃlid
 = 1;

33 if(
¡¾’
(
$mty³Çme
) > 40 || strlen($mtypename) < 2)

35 
ShowMsg
('åˆ†ç±»åç§°å¿…é¡»å¤§äºä¸¤ä¸ªå­—èŠ‚å°‘äº40ä¸ªå­—èŠ‚', '-1');

36 
ex™
();

38 
	g$qu”y
 = "INSERT INTO `#@__mtypes`(mtypename, channelid, mid) VALUES ('$mtypename', '$channelid', '$cfg_ml->M_ID'); ";

39 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

41 
ShowMsg
('å¢åŠ åˆ†ç±»æˆåŠŸ', 'mtypes.php');

45 
ShowMsg
('å¢åŠ åˆ†ç±»å¤±è´¥', '-1');

47 
ex™
();

49 
–£if
 (
$dİo¡
 == 'save')

51 if(
is£t
(
$mty³id¬r
è&& 
is_¬¿y
($mtypeidarr))

53 
$d–ids
 = '0';

54 
	g$mty³id¬r
 = 
¬¿y_f‹r
(
$mty³id¬r
, 'is_numeric');

55 
fÜ—ch
(
$mty³id¬r
 
as
 
$d–id
)

57 
	g$d–ids
 .ğ','.
$d–id
;

58 
un£t
(
$mty³Çme
[
$d–id
]);

60 
	g$qu”y
 = "DELETE FROM `#@__mtypes` WHERE mtypeid IN ($delids) AND mid='$cfg_ml->M_ID';";

61 
	g$dsql
->
ExecNÚeQu”y
(
$qu”y
);

63 
fÜ—ch
 (
$mty³Çme
 
as
 
$id
 => 
$Çme
)

65 
$Çme
 = 
HtmlR•Ïû
($name);

66 
	g$qu”y
 = "UPDATE `#@__mtypes` SET mtypename='$name' WHERE mtypeid='$id' AND mid='$cfg_ml->M_ID'";

67 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

69 
ShowMsg
('åˆ†ç±»ä¿®æ”¹å®Œæˆ','mtypes.php');

	@E:\web\weixun\user\myfriend.php

1 <?
php


8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

9 
CheckRªk
(0, 0);

10 
	g$m’uty³
 = 'xakmenu';

11 
	g$m’uty³_sÚ
 = 'mf';

12 if(
	g$cfg_mb_l™
=='Y')

14 
ShowMsg
("ç”±äºç³»ç»Ÿå¼€å¯äº†ç²¾ç®€ç‰ˆä¼šå‘˜ç©ºé—´ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

15 
ex™
();

17 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

19 if(!
is£t
(
$áy³
)è
	g$áy³
 = 0;

20 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

23 if(
	g$dİo¡
=='upsta')

25 
$ids
 = 
´eg_»¶aû
("#[^0-9,]#", "", $ids);

26 if(
	g$¡a
=='good')

28 
$up¡a
 = " ftype=1 ";

30 if(
	g$¡a
=='bad')

32 
$up¡a
 = " ftype=-1 ";

36 
	g$up¡a
 = " ftype=0 ";

38 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_friends` SET $upsta WHERE id IN($ids) AND mid='{$cfg_ml->M_ID}' ");

41 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_ş›Á/ş›Á.php' && 
	g$¡a
!='bad')

43 if(
$d©a
 = 
uc_g‘_u£r
(
$cfg_ml
->
M_LogšID
)è
uc_ä›nd_add
(
$uid
, $data[0]);

45 #/
a
}}

47 if(
	g$¡a
=='good')

49 
ShowMsg
("æˆåŠŸæŠŠæŒ‡å®šå¥½å‹è®¾ä¸ºå…³æ³¨å¥½å‹ï¼","myfriend.php?ftype=1");

51 if(
	g$¡a
=='bad')

53 
ShowMsg
("æˆåŠŸæŠŠæŒ‡å®šå¥½å‹æ”¾å…¥é»‘åå•ï¼","myfriend.php?ftype=-1");

57 
ShowMsg
("æˆåŠŸæŠŠæŒ‡å®šå¥½å‹è½¬ä¸ºæ™®é€šå¥½å‹ï¼","myfriend.php");

59 
ex™
();

63 if(
	g$dİo¡
=='del')

65 
$ids
 = 
´eg_»¶aû
("#[^0-9,]#", "", $ids);

67 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

69 if(
	g$d©a
 = 
uc_g‘_u£r
(
$cfg_ml
->
M_LogšID
))

71 
li¡
(
$uid
, 
$u£ºame
, 
$ema
èğ
$d©a
;

72 
	g$ä›ndids
 = @
ex¶ode
(",", 
$ids
);

73 if(!
em±y
(
$ä›ndids
)è
uc_ä›nd_d–‘e
(
$uid
 , $friendids);

76 #/
a
}}

77 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_friends` WHERE id IN($ids) AND mid='{$cfg_ml->M_ID}' ");

78 
ShowMsg
("æˆåŠŸåˆ é™¤æ‰€é€‰çš„å¥½å‹ï¼","myä›nd.php?áy³=".
$áy³
);

79 
ex™
();

83 
	g$wsql
 = '';

84 if(
em±y
(
$áy³
))

86 
	g$wsql
 = " F.mid='{$cfg_ml->M_ID}' AND F.ftype <> '-1' ";

87 
	g$Šame
 = "æ‰€æœ‰å¥½å‹";

89 if(
	g$áy³
==1)

91 
$wsql
 = " F.mid='{$cfg_ml->M_ID}' AND F.ftype = '1' ";

92 
	g$Šame
 = "ç‰¹åˆ«å…³æ³¨";

94 if(
	g$áy³
==-1)

96 
$wsql
 = " F.mid='{$cfg_ml->M_ID}' AND F.ftype = '-1' ";

97 
	g$Šame
 = "é»‘åå•";

99 
	g$qu”y
 = "SELECT F.*,G.groupname FROM `#@__member_group` AS G LEFT JOIN #@__member_friends AS F ON F.groupid=G.id WHERE $wsql ORDER BY F.id DESC";

100 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

101 
	g$dli¡
->
	g·geSize
 = 20;

102 
	g$dli¡
->
S‘P¬am‘”
("áy³",
$áy³
);

103 
	g$dli¡
->
S‘Tem¶©e
(
dœÇme
(
__FILE__
).'/templets/myfriend.htm');

104 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

105 
	g$dli¡
->
Di¥Ïy
();

115 
funùiÚ
 
g‘U£rInfo
(
$uid
,
$_f›ld
 = 'uname')

117 
glob®
 
$dsql
;

118 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT M.*,YEAR(CURDATE())-YEAR(P.birthday)‡s‡ge,DATE_FORMAT(P.birthday,'%eæœˆ%dæ—¥å‡ºç”Ÿ')‡s birthday,S.spacename,S.sign FROM `#@__member_list` AS M

119 
LEFT
 
JOIN
 `#@
__memb”_³rsÚ
` 
AS
 
P
 
ON
 P.
mid
=
M
.mid

120 
LEFT
 
JOIN
 `#@
__memb”_¥aû
` 
AS
 
S
 
ON
 
M
.
mid
=M.mid 
WHERE
 M.mid='$uid'");

121 if(
is£t
(
$row
[
$_f›ld
]))

123 if(
$_f›ld
 == 'face')

125 if(
em±y
(
$row
[
$_f›ld
])){

126 
$row
[
$_f›ld
]=($row['sex']=='å¥³')? 'templets/images/dfgirl.png' : 'templets/images/dfboy.png';

129  
$row
[
$_f›ld
];

	@E:\web\weixun\user\myfriend_group.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckRªk
(0,0);

9 
	g$m’uty³
 = 'xakmenu';

10 
	g$dİo¡
 = 
is£t
(
$dİo¡
è? 
	$Œim
(
$dİo¡
) : '';

11 if(
$dİo¡
 == '')

13 
$qu”y
 = "SELECT * FROM `#@__member_group` WHERE mid='{$cfg_ml->M_ID}'";

14 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

15 
$dsql
->
	`Execu‹
();

16 
$row
 = 
$dsql
->
	`G‘A¼ay
())

18 
$mty³¬r
[] = 
$row
;

20 
$GLOBALS
['mty³¬r'] =
	`em±y
($GLOBALS['mtypearr'] )? '' : $GLOBALS['mtypearr'] ;

21 
$l
 = 
Ãw
 
	`XakTem¶©e
();

22 
$l
->
	`LßdTem¶©e
(
XAKMEMBER
.'/templets/myfriend_group.htm');

23 
$l
->
	`Di¥Ïy
();

24 
	`ex™
();

25 
	}
}

26 
–£if
 (
$dİo¡
 == 'add')

27 { 
$mty³Çme
 = 
HtmlR•Ïû
(
Œim
(
$grou²ame
));

28 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_group` WHERE groupname LIKE '$groupname' AND mid='{$cfg_ml->M_ID}'");

29 if(
is_¬¿y
(
$row
))

31 
ShowMsg
('åˆ†ç»„åç§°å·²ç»å­˜åœ¨', '-1');

32 
ex™
();

34 if(
¡¾’
(
$grou²ame
)=="")

36 
ShowMsg
('åˆ†ç»„åç§°ä¸èƒ½ä¸ºç©º', '-1');

37 
ex™
();

39 
	g$qu”y
 = "INSERT INTO `#@__member_group`(groupname, mid) VALUES ('$groupname', '$cfg_ml->M_ID'); ";

40 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

42 
ShowMsg
('å¢åŠ åˆ†ç±»æˆåŠŸ', 'myfriend_group.php');

46 
ShowMsg
('å¢åŠ åˆ†ç±»å¤±è´¥', '-1');

48 
ex™
();

49 }
–£if
 (
$dİo¡
 == 'save'){

50 
$grou²ame
 = 
HtmlR•Ïû
(
Œim
($groupname));

51 if(
is£t
(
$mty³id¬r
è&& 
is_¬¿y
($mtypeidarr))

53 
	g$d–ids
 = '0';

54 
	g$mty³id¬r
 = 
¬¿y_f‹r
(
$mty³id¬r
, 'is_numeric');

55 
fÜ—ch
(
$mty³id¬r
 
as
 
$d–id
)

57 
	g$d–ids
 .ğ','.
$d–id
;

58 
un£t
(
$grou²ame
[
$d–id
]);

60 
	g$qu”y
 = "DELETE FROM `#@__member_group` WHERE id in ($delids) AND mid='$cfg_ml->M_ID'";

61 
	g$dsql
->
ExecNÚeQu”y
(
$qu”y
);

62 
	g$sql
="SELECT id FROM `#@__member_friends` WHERE groupid in ($delids) AND mid='$cfg_ml->M_ID'";

63 
	g$db
->
S‘Qu”y
(
$sql
);

64 
	g$db
->
Execu‹
();

65 
	g$row
 = 
$db
->
G‘A¼ay
())

67 
$qu”y2
 = "UPDATE `#@__member_friends` SET groupid='1' WHERE id='{$row['id']}' AND mid='$cfg_ml->M_ID'";

68 
	g$dsql
->
ExecNÚeQu”y
(
$qu”y2
);

71 
fÜ—ch
 (
$grou²ame
 
as
 
$id
 => 
$Çme
)

73 
$Çme
 = 
HtmlR•Ïû
($name);

74 
	g$id
 = 
HtmlR•Ïû
(
$id
);

75 
	g$qu”y
 = "UPDATE `#@__member_group` SET groupname='$name' WHERE id='$id' AND mid='$cfg_ml->M_ID'";

76 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

78 
ShowMsg
('åˆ†ç»„ä¿®æ”¹å®Œæˆ(åˆ é™¤åˆ†ç»„ä¸­çš„ä¼šå‘˜ä¼šè½¬ç§»åˆ°é»˜è®¤åˆ†ç»„ä¸­)','myfriend_group.php');

79 
ex™
();

	@E:\web\weixun\user\mypay.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckRªk
(0,0);

9 
	g$m’uty³
 = 'xakmenu';

10 
	g$m’uty³_sÚ
 = 'op';

11 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

12 
£tcook›
('ENV_GOBACK_URL', 
G‘CurU¾
(), 
time
()+3600, '/');

13 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

16 if(
	g$dİo¡
=='')

18 
$qu”y
 = "S–eù * From `#@__memb”_İ”©iÚ` wh”mid='".
$cfg_ml
->
M_ID
."' And…roduct='archive' order by‡id desc";

19 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

20 
	g$dli¡
->
	g·geSize
 = 20;

21 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
.'/templets/mypay.htm');

22 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

23 
	g$dli¡
->
Di¥Ïy
();

25 
–£if
(
$dİo¡
=='del')

27 
$ids
 = 
´eg_»¶aû
("#[^0-9,]#", "", $ids);

28 
	g$qu”y
 = "Delete From `#@__member_operation` where‡id in($ids) And mid='{$cfg_ml->M_ID}' And…roduct='archive'";

29 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

30 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„äº¤æ˜“è®°å½•!","mypay.php");

31 
ex™
();

	@E:\web\weixun\user\mystow.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
G‘CurU¾
(),
time
()+3600,"/");

11 
	g$ty³
 = 
em±y
(
$ty³
)? "sys" : 
Œim
($type);

12 
	g$l
 = '';

13 
	g$m’uty³
 = 'xakmenu';

14 
	g$¿nk
 = 
em±y
(
$¿nk
)? "" : $rank;

15 if(
	g$¿nk
 == 'top'){

16 
$sql
 = "SELECT s.*,COUNT(s.aid) AS‚um,t.* from `#@__member_stow` AS s LEFT JOIN `#@__member_stowtype` AS on.stowname=s.type group by s.aid order by‚um desc";

17 
	g$l
 = 'stowtop';

19 
	g$sql
 = "SELECT s.*,t.* FROM `#@__memb”_¡ow` AS s†eá još `#@__memb”_¡owty³` AS oÀt.¡owÇme=s.ty³ wh”s.mid='".
$cfg_ml
->
M_ID
."' order by s.id desc";

20 
	g$l
 = 'mystow';

23 
	g$dsql
->
Execu‹
('nn','SELECT indexname,stowname FROM `#@__member_stowtype`');

24 
	g$row
 = 
$dsql
->
G‘A¼ay
('nn'))

26 
$rows
[]=
$row
;

29 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

30 
	g$dli¡
->
	g·geSize
 = 20;

31 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/templets/$tpl.htm");

32 
	g$dli¡
->
S‘Sourû
(
$sql
);

33 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\user\operation.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
CheckRªk
(0,0);

10 
	g$m’uty³
 = 'xakmenu';

11 
	g$m’uty³_sÚ
 = 'op';

12 
£tcook›
("ENV_GOBACK_URL",
G‘CurU¾
(),
time
()+3600,"/");

13 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

21 
funùiÚ
 
	$G‘S
(
$¡a
){

22 if(
$¡a
==0)  'æœªä»˜æ¬¾';

23 if(
$¡a
==1)  'å·²ä»˜æ¬¾';

25 
	}
}

27 if(
	g$dİo¡
=='')

29 
$sql
 = "SELECT * FROM `#@__memb”_İ”©iÚ` WHERE mid='".
$cfg_ml
->
M_ID
."' AND…roduct<>'archive' ORDER BY‡id DESC";

30 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

31 
	g$dli¡
->
	g·geSize
 = 20;

32 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/templets/operation.htm");

33 
	g$dli¡
->
S‘Sourû
(
$sql
);

34 
	g$dli¡
->
Di¥Ïy
();

36 if(
	g$dİo¡
=='del')

38 
$ids
 = 
´eg_»¶aû
("#[^0-9,]#", "", $ids);

39 
	g$qu”y
 = "DELETE FROM `#@__member_operation` WHERE‡id IN($ids) AND mid='{$cfg_ml->M_ID}'";

40 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

41 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„äº¤æ˜“è®°å½•!","operation.php");

42 
ex™
();

	@E:\web\weixun\user\pm.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
	g$m’uty³
 = 'xakmenu';

10 
	g$m’uty³_sÚ
 = 'pm';

11 if(
	g$cfg_mb_l™
=='Y')

13 
ShowMsg
('ç”±äºç³»ç»Ÿå¼€å¯äº†ç²¾ç®€ç‰ˆä¼šå‘˜ç©ºé—´ï¼Œä½ ä¸èƒ½å‘å…¶å®ƒä¼šå‘˜å‘çŸ­ä¿¡æ¯ï¼Œä¸è¿‡ä½ å¯ä»¥å‘ä»–ç•™è¨€ï¼','-1');

14 
ex™
();

18 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

20 if(
	g$d©a
 = 
uc_g‘_u£r
(
$cfg_ml
->
M_LogšID
)è
uc_pm_loÿtiÚ
(
$d©a
[0]);

22 #/
a
}}

24 if(!
	$is£t
(
$dİo¡
))

26 
$dİo¡
 = '';

27 
	}
}

29 
CheckNÙAÎow
();

30 
	g$¡©e
=(
em±y
(
$¡©e
))? "" : $state;

34 if(
	g$dİo¡
=='send')

37 
$sql
 = "SELECT * FROM `#@__member_friends` WHERE mid='{$cfg_ml->M_ID}' AND ftype!='-1' ORDER BY‡ddtime DESC LIMIT 20";

38 
	g$ä›nds
 = 
¬¿y
();

39 
	g$dsql
->
S‘Qu”y
(
$sql
);

40 
	g$dsql
->
Execu‹
();

41 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

42 
$ä›nds
[] = 
$row
;

45 
šşude_Úû
(
dœÇme
(
__FILE__
).'/templets/pm-send.htm');

46 
ex™
();

51 if(
	g$dİo¡
=='read')

53 
$sql
 = "SELECT * FROM `#@__member_friends` WHERE mid='{$cfg_ml->M_ID}' AND ftype!='-1' ORDER BY‡ddtime DESC LIMIT 20";

54 
	g$ä›nds
 = 
¬¿y
();

55 
	g$dsql
->
S‘Qu”y
(
$sql
);

56 
	g$dsql
->
Execu‹
();

57 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

58 
$ä›nds
[] = 
$row
;

60 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_pms` WHERE id='$id' AND (fromid='{$cfg_ml->M_ID}' ORoid='{$cfg_ml->M_ID}')");

61 if(!
is_¬¿y
(
$row
))

63 
ShowMsg
('å¯¹ä¸èµ·ï¼Œä½ æŒ‡å®šçš„æ¶ˆæ¯ä¸å­˜åœ¨æˆ–ä½ æ²¡æƒé™æŸ¥çœ‹ï¼','-1');

64 
ex™
();

66 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_pms` SET hasview=1 WHERE id='$id' AND folder='inbox' ANDoid='{$cfg_ml->M_ID}'");

67 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_pms` SET hasview=1 WHERE folder='outbox' ANDoid='{$cfg_ml->M_ID}'");

68 
šşude_Úû
(
dœÇme
(
__FILE__
).'/templets/pm-read.htm');

69 
ex™
();

74 if(
	g$dİo¡
=='savesend')

76 
$sv®i
 = 
G‘CkVdV®ue
();

77 if(
´eg_m©ch
("/5/",
$§ã_gdİ’
)){

78 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

80 
Re£tVdV®ue
();

81 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

82 
ex™
();

86 
	g$çqkey
 = 
is£t
(
$çqkey
è&& 
is_num”ic
($faqkey) ? $faqkey : 0;

87 if(
	g$§ã_çq_msg
 == 1)

89 if(
$§ãçqs
[
$çqkey
]['ªsw”'] !ğ
$§ãªsw”
 || $safeanswer=='')

91 
ShowMsg
('éªŒè¯é—®é¢˜ç­”æ¡ˆé”™è¯¯', '-1');

92 
ex™
();

95 if(
	g$subjeù
=='')

97 
ShowMsg
("è¯·å¡«å†™ä¿¡æ¯æ ‡é¢˜!","-1");

98 
ex™
();

100 
	g$msg
 = 
CheckU£rID
(
$msgtoid
,"ç”¨æˆ·å",
çl£
);

101 if(
	g$msg
!='ok')

103 
ShowMsg
(
$msg
,"-1");

104 
ex™
();

106 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE userid LIKE '$msgtoid' ");

107 if(!
is_¬¿y
(
$row
))

109 
ShowMsg
("ä½ æŒ‡å®šçš„ç”¨æˆ·ä¸å­˜åœ¨,ä¸èƒ½å‘é€ä¿¡æ¯!","-1");

110 
ex™
();

112 
	g$subjeù
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$subjeù
,1),60);

113 
	g$mes§ge
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$mes§ge
,0),1024);

114 
	g$£ndtime
 = 
$wr™‘ime
 = 
time
();

117 
	g$šqu”y1
 = "INSERT INTO `#@__member_pms` (`floginid`,`fromid`,`toid`,`tologinid`,`folder`,`subject`,`sendtime`,`writetime`,`hasview`,`isadmin`,`message`)

118 
VALUES
 ('{$cfg_ml->M_LogšID}','{$cfg_ml->M_ID}','{$row['
mid
']}','{$row['
u£rid
']}','inbox','$subject','$sendtime','$writetime','0','0','$message'); ";

121 
	g$šqu”y2
 = "INSERT INTO `#@__member_pms` (`floginid`,`fromid`,`toid`,`tologinid`,`folder`,`subject`,`sendtime`,`writetime`,`hasview`,`isadmin`,`message`)

122 
VALUES
 ('{$cfg_ml->M_LogšID}','{$cfg_ml->M_ID}','{$row['
mid
']}','{$row['
u£rid
']}','outbox','$subject','$sendtime','$writetime','0','0','$message'); ";

123 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y1
);

124 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y2
);

125 
ShowMsg
("æˆåŠŸå‘é€ä¸€æ¡ä¿¡æ¯!","pm.php?dopost=outbox");

126 
ex™
();

131 if(
	g$dİo¡
=='del')

133 
$ids
 = 
´eg_»¶aû
("#[^0-9,]#", "", $ids);

134 if(
	g$fŞd”
=='inbox')

136 
$boxsql
="SELECT * FROM `#@__member_pms` WHERE id IN($ids) AND folder LIKE 'inbox' ANDoid='{$cfg_ml->M_ID}'";

137 
	g$dsql
->
S‘Qu”y
(
$boxsql
);

138 
	g$dsql
->
Execu‹
();

139 
	g$qu”y
='';

140 
	g$row
 = 
$dsql
->
G‘A¼ay
())

142 if(
$row
 && $row['isadmin']==1)

144 
$qu”y
 = "Update `#@__member_pms` set writetime='0' WHERE id='{$row['id']}' AND folder='inbox' ANDoid='{$cfg_ml->M_ID}' AND isadmin='1';";

145 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

149 
	g$qu”y
 = "DELETE FROM `#@__member_pms` WHERE id in($ids) ANDoid='{$cfg_ml->M_ID}' AND folder LIKE 'inbox'";

153 if(
	g$fŞd”
=='outbox')

155 
$qu”y
 = "Delete From `#@__member_pms` WHERE id in($ids) AND fromid='{$cfg_ml->M_ID}' AND folder LIKE 'outbox' ";

159 
	g$qu”y
 = "Delete From `#@__member_pms` WHERE id in($ids) AND fromid='{$cfg_ml->M_ID}' Oroid='{$cfg_ml->M_ID}' AND folder LIKE 'outbox' Or (folder LIKE 'inbox' AND hasview='0')";

161 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

162 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„æ¶ˆæ¯!","pm.php?fŞd”=".
$fŞd”
);

163 
ex™
();

170 if(!
is£t
(
$fŞd”
))

172 
	g$fŞd”
 = 'inbox';

174 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

175 
	g$wsql
 = '';

176 if(
	g$fŞd”
=='outbox')

178 
$wsql
 = " `fromid`='{$cfg_ml->M_ID}' AND folder LIKE 'outbox' ";

179 
	g$Šame
 = "å‘ä»¶ç®±";

181 
–£if
(
$fŞd”
=='inbox')

183 
$qu”y
 = "SELECT * FROM `#@__member_pms` WHERE folder LIKE 'outbox' AND isadmin='1'";

184 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

185 
	g$dsql
->
Execu‹
();

186 
	g$row
 = 
$dsql
->
G‘A¼ay
())

188 
$row2
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_pms` WHERE fromid = '$row[id]' ANDoid='{$cfg_ml->M_ID}'");

189 if(!
is_¬¿y
(
$row2
))

191 
	g$row3
= "INSERT INTO

192 `#@
__memb”_pms
` (`
æogšid
`,`
	gäomid
`,`
	gtoid
`,`
	gtŞogšid
`,`
	gfŞd”
`,`
	gsubjeù
`,`
	g£ndtime
`,`
	gwr™‘ime
`,`
	ghasv›w
`,`
	gi§dmš
`,`
	gmes§ge
`)

193 
VALUES
 ('admš','{$row['
id
']}','{$cfg_ml->M_ID}','{$cfg_ml->M_LogšID}','šbox','{$row['
subjeù
']}','{$row['
£ndtime
']}','{$row['
wr™‘ime
']}','{$row['
hasv›w
']}','{$row['
i§dmš
']}','{$row['
mes§ge
']}')";

194 
	g$dsql
->
Execu‹NÚeQu”y
(
$row3
);

197 if(
	g$¡©e
=="1"){

198 
$wsql
= "oid='{$cfg_ml->M_ID}' AND folder='inbox' AND writetime!=''‡nd hasview=1";

199 
	g$Šame
 = "æ”¶ä»¶ç®±";

200 } ià(
	g$¡©e
=="-1")

202 
$wsql
 = "toid='{$cfg_ml->M_ID}' AND folder='inbox' AND writetime!=''‡nd hasview=0";

203 
	g$Šame
 = "æ”¶ä»¶ç®±";

205 
	g$wsql
 = "oid='{$cfg_ml->M_ID}' AND folder='inbox' AND writetime!=''";

206 
	g$Šame
 = "æ”¶ä»¶ç®±";

211 
	g$wsql
 = " `fromid` ='{$cfg_ml->M_ID}' AND folder LIKE 'outbox'";

212 
	g$Šame
 = "å·²å‘ä¿¡æ¯";

214 
	g$qu”y
 = "SELECT * FROM `#@__member_pms` WHERE $wsql ORDER BY sendtime DESC";

215 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

216 
	g$dli¡
->
	g·geSize
 = 20;

217 
	g$dli¡
->
S‘P¬am‘”
("dİo¡",
$dİo¡
);

218 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
.'/templets/pm-main.htm');

219 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

220 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\user\reg_new.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
»quœe_Úû
 
	gXAKINC
.'/membermodel.cls.php';

7 if(
	g$cfg_mb_®low»g
=='N')

9 
ShowMsg
('ç³»ç»Ÿå…³é—­äº†æ–°ç”¨æˆ·æ³¨å†Œï¼', 'index.php');

10 
ex™
();

13 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

14 
	g$¡•
 = 
em±y
(
$¡•
)? 1 : 
štv®
(
´eg_»¶aû
("/[^\d]/", '', $step));

16 if(
	g$¡•
 == 1)

18 if(
$cfg_ml
->
IsLogš
())

20 if(
$cfg_mb_»gšfo
 == 'Y')

23 if(
$cfg_ml
->
f›lds
['spacesta'] == 0 || $cfg_ml->fields['spacesta'] == 1)

25 
ShowMsg
("å°šæœªå®Œæˆè¯¦ç»†èµ„æ–™ï¼Œè¯·å®Œå–„...", "index_do.php?fmdo=user&dopost=regnew&step=2", 0, 1000);

26 
	gex™
;

29 
ShowMsg
('ä½ å·²ç»ç™»é™†ç³»ç»Ÿï¼Œæ— éœ€é‡æ–°æ³¨å†Œï¼', 'index.php');

30 
ex™
();

32 if(
	g$dİo¡
=='regbase')

34 
$sv®i
 = 
G‘CkVdV®ue
();

35 if(
´eg_m©ch
("/1/", 
$§ã_gdİ’
)){

36 if(
¡¹Şow”
(
$vdcode
)!=
$sv®i
 || $svali=='')

38 
Re£tVdV®ue
();

39 
ShowMsg
('éªŒè¯ç é”™è¯¯ï¼', '-1');

40 
ex™
();

44 
	g$çqkey
 = 
is£t
(
$çqkey
è&& 
is_num”ic
($faqkey) ? $faqkey : 0;

45 if(
	g$§ã_çq_»g
 == '1')

47 if(
$§ãçqs
[
$çqkey
]['ªsw”'] !ğ
$r§ãªsw”
 || $rsafeanswer=='')

49 
ShowMsg
('éªŒè¯é—®é¢˜ç­”æ¡ˆé”™è¯¯', '-1');

50 
ex™
();

54 
	g$u£rid
 = 
Œim
(
$u£rid
);

55 
	g$pwd
 = 
Œim
(
$u£½wd
);

56 
	g$pwdc
 = 
Œim
(
$u£½wdok
);

57 
	g$rs
 = 
CheckU£rID
(
$u£rid
, 'ç”¨æˆ·å');

58 if(
	g$rs
 != 'ok')

60 
ShowMsg
(
$rs
, '-1');

61 
ex™
();

63 if(
¡¾’
(
$u£rid
è> 20 || sŒËn(
$uÇme
) > 36)

65 
ShowMsg
('ä½ çš„ç”¨æˆ·åæˆ–ç”¨æˆ·ç¬”åè¿‡é•¿ï¼Œä¸å…è®¸æ³¨å†Œï¼', '-1');

66 
ex™
();

68 if(
¡¾’
(
$u£rid
è< 
	g$cfg_mb_idmš
 || sŒËn(
$pwd
è< 
	g$cfg_mb_pwdmš
)

70 
ShowMsg
("ä½ çš„ç”¨æˆ·åæˆ–å¯†ç è¿‡çŸ­ï¼Œä¸å…è®¸æ³¨å†Œï¼","-1");

71 
ex™
();

73 if(
	g$pwdc
 !ğ
$pwd
)

75 
ShowMsg
('ä½ ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼', '-1');

76 
ex™
();

79 
	g$uÇme
 = 
HtmlR•Ïû
(
$uÇme
, 1);

81 if(
	g$cfg_mb_wÇmeÚe
=='N')

83 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE uname LIKE '$uname' ");

84 if(
is_¬¿y
(
$row
))

86 
ShowMsg
('ç”¨æˆ·ç¬”åæˆ–å…¬å¸åç§°ä¸èƒ½é‡å¤ï¼', '-1');

87 
ex™
();

90 if(!
CheckEma
(
$ema
))

92 
ShowMsg
('Emailæ ¼å¼ä¸æ­£ç¡®ï¼', '-1');

93 
ex™
();

97 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

99 
	g$uid
 = 
uc_u£r_»gi¡”
(
$u£rid
, 
$pwd
, 
$ema
);

100 if(
	g$uid
 <= 0)

102 if(
$uid
 == -1)

104 
ShowMsg
("ç”¨æˆ·åä¸åˆæ³•ï¼","-1");

105 
ex™
();

107 
–£if
(
$uid
 == -2)

109 
ShowMsg
("åŒ…å«è¦å…è®¸æ³¨å†Œçš„è¯è¯­ï¼","-1");

110 
ex™
();

112 
–£if
(
$uid
 == -3)

114 
ShowMsg
("ä½ æŒ‡å®šçš„ç”¨æˆ·å {$userid} å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨åˆ«çš„ç”¨æˆ·åï¼","-1");

115 
ex™
();

117 
–£if
(
$uid
 == -5)

119 
ShowMsg
("ä½ ä½¿ç”¨çš„Email ä¸å…è®¸æ³¨å†Œï¼","-1");

120 
ex™
();

122 
–£if
(
$uid
 == -6)

124 
ShowMsg
("ä½ ä½¿ç”¨çš„Emailå·²ç»è¢«å¦ä¸€å¸å·æ³¨å†Œï¼Œè¯·ä½¿å…¶å®ƒå¸å·","-1");

125 
ex™
();

129 
ShowMsg
("æ³¨åˆ å¤±æ”¹ï¼","-1");

130 
ex™
();

135 
	g$ucsyÆogš
 = 
uc_u£r_syÆogš
(
$uid
);

138 #/
a
}}

140 if(
	g$cfg_md_ma‹¡
=='Y')

142 
$row
 = 
$dsql
->
G‘OÃ
("SELECT mid FROM `#@__member_list` WHEREƒmail LIKE '$email' ");

143 if(
is_¬¿y
(
$row
))

145 
ShowMsg
('ä½ ä½¿ç”¨çš„Emailå·²ç»è¢«å¦ä¸€å¸å·æ³¨å†Œï¼Œè¯·ä½¿å…¶å®ƒå¸å·ï¼', '-1');

146 
ex™
();

151 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT mid FROM `#@__member_list` WHERE userid LIKE '$userid' ");

152 if(
is_¬¿y
(
$row
))

154 
ShowMsg
("ä½ æŒ‡å®šçš„ç”¨æˆ·å {$userid} å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨åˆ«çš„ç”¨æˆ·åï¼", "-1");

155 
ex™
();

157 if(
	g$§ãque¡iÚ
==0)

159 
$§ãªsw”
 = '';

163 if(
¡¾’
(
$§ãªsw”
)>30)

165 
ShowMsg
('ä½ çš„æ–°å®‰å…¨é—®é¢˜çš„ç­”æ¡ˆå¤ªé•¿äº†ï¼Œè¯·æ§åˆ¶åœ¨30å­—èŠ‚ä»¥å†…ï¼', '-1');

166 
ex™
();

171 
	g$dfscÜes
 = 0;

172 
	g$dfmÚey
 = 0;

173 
	g$däªk
 = 
$dsql
->
G‘OÃ
("SELECT money,scores FROM `#@__arcrank` WHERE„ank='10' ");

174 if(
is_¬¿y
(
$däªk
))

176 
	g$dfmÚey
 = 
$däªk
['money'];

177 
	g$dfscÜes
 = 
$däªk
['scores'];

179 
	g$joštime
 = 
time
();

180 
	g$logštime
 = 
time
();

181 
	g$još
 = 
G‘IP
();

182 
	g$logš
 = 
G‘IP
();

184 
	g$pwd
 = 
PassJoš
(
$u£½wd
);

186 
	g$¥aûS
 = (
$cfg_mb_¥aû¡a
 < 0 ? $cfg_mb_spacesta : 0);

188 
	g$šQu”y
 = "INSERT INTO `#@__member_list` (`mtype` ,`userid` ,`pwd` ,`uname` ,`sex` ,`rank` ,`money` ,`email` ,`scores` ,

189 `
m©t
`, `
	g¥aû¡a
` ,`
	gçû
`,`
	g§ãque¡iÚ
`,`
	g§ãªsw”
` ,`
	gjoštime
` ,`
	gjoš
` ,`
	glogštime
` ,`
	glogš
` )

190 
VALUES
 ('$mtype','$userid','$pwd','$uname','$sex','10','$dfmoney','$email','$dfscores',

192 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

194 
	g$mid
 = 
$dsql
->
G‘La¡ID
();

197 if(
	g$mty³
=='ä¸ªäºº'){

198 
$¥aû
='person';

199 }if(
	g$mty³
=='ä¼ä¸š'){

200 
$¥aû
='company';

202 
	g$¥aû
='person';

206 
	g$memb”tjqu”y
 = "INSERT INTO `#@__member_tj` (`mid`,`article`,`album`,`archives`,`homecount`,`pagecount`,`feedback`,`friend`,`stow`)

207 
VALUES
 ('$mid','0','0','0','0','0','0','0','0'); ";

208 
	g$dsql
->
Execu‹NÚeQu”y
(
$memb”tjqu”y
);

211 
	g$¥aûqu”y
 = "INSERT INTO `#@__member_space`(`mid` ,`pagesize` ,`matt` ,`spacename` ,`spacelogo` ,`spacestyle`, `sign` ,`spacenews`)

212 
VALUES
('{$mid}','10','0','{$uname}çš„ç©ºé—´','','$space','',''); ";

213 
	g$dsql
->
Execu‹NÚeQu”y
(
$¥aûqu”y
);

216 
	g$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__member_flink`(mid,title,url) VALUES('$mid','å†…å®¹ç®¡ç†ç³»ç»Ÿ','http://www.xak.cn'); ");

218 
	g$memb”mod–
 = 
Ãw
 
memb”mod–
(
$mty³
);

219 
	g$modid
=
$memb”mod–
->
modid
;

220 
	g$modid
 = 
em±y
(
$modid
)? 0 : 
štv®
(
´eg_»¶aû
("/[^\d]/",'', $modid));

221 
	g$mod–fÜm
 = 
$dsql
->
g‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$modid' ");

223 if(!
is_¬¿y
(
$mod–fÜm
))

225 
showmsg
('æ¨¡å‹è¡¨å•ä¸å­˜åœ¨', '-1');

226 
ex™
();

228 
	g$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `{$membermodel->table}` (`mid`) VALUES ('{$mid}');");

234 
	g$cfg_ml
 = 
Ãw
 
Memb”Logš
(7*3600);

235 
	g$rs
 = 
$cfg_ml
->
CheckU£r
(
$u£rid
, 
$u£½wd
);

239 if(
	g$cfg_mb_¥aû¡a
==-10)

241 
$u£rhash
 = 
md5
(
$cfg_cook›_’code
.'--'.
$mid
.'--'.
$ema
);

242 
	g$u¾
 = 
$cfg_ba£ho¡
.(
em±y
(
$cfg_cm¥©h
) ? '/' : $cfg_cmspath)."/user/index_do.php?fmdo=checkMail&mid={$mid}&userhash={$userhash}&do=1";

243 
	g$u¾
 = 
´eg_»¶aû
("#h‰p:\/\/#i", '', 
$u¾
);

244 
	g$u¾
 = 'h‰p://'.
´eg_»¶aû
("#\/\/#", '/', 
$u¾
);

245 
	g$mat™Ë
 = "{$cfg_webname}--ä¼šå‘˜é‚®ä»¶éªŒè¯é€šçŸ¥";

246 
	g$mabody
 = '';

247 
	g$mabody
 .= "å°Šæ•¬çš„ç”¨æˆ·[{$uname}]ï¼Œæ‚¨å¥½ï¼š\r\n";

248 
	g$mabody
 .= "æ¬¢è¿æ³¨å†Œæˆä¸º[{$cfg_webname}]çš„ä¼šå‘˜ã€‚\r\n";

249 
	g$mabody
 .= "è¦é€šè¿‡æ³¨å†Œï¼Œè¿˜å¿…é¡»è¿›è¡Œæœ€åä¸€æ­¥æ“ä½œï¼Œè¯·ç‚¹å‡»æˆ–å¤åˆ¶ä¸‹é¢é“¾æ¥åˆ°åœ°å€æ è®¿é—®è¿™åœ°å€ï¼š\r\n\r\n";

250 
	g$mabody
 .= "{$url}\r\n\r\n";

251 
	g$mabody
 .= "Power by http://www.xak.cn å†…å®¹ç®¡ç†ç³»ç»Ÿï¼\r\n";

253 
	g$h—d”s
 = "From: ".
$cfg_admšema
."\r\nReply-To: ".$cfg_adminemail;

254 if(
	g$cfg_£ndma_bysm
 =ğ'Y' && !
em±y
(
$cfg_sm_£rv”
))

256 
$maty³
 = 'TXT';

257 
»quœe_Úû
(
XAKINC
.'/mail.class.php');

258 
	g$sm
 = 
Ãw
 
sm
(
$cfg_sm_£rv”
,
$cfg_sm_pÜt
,
Œue
,
$cfg_sm_u£rma
,
$cfg_sm_·sswÜd
);

259 
	g$sm
->
	gdebug
 = 
çl£
;

260 
	g$sm
->
£ndma
(
$ema
,
$cfg_webÇme
,
$cfg_sm_u£rma
, 
$mat™Ë
, 
$mabody
, 
$maty³
);

264 @
ma
(
$ema
, 
$mat™Ë
, 
$mabody
, 
$h—d”s
);

268 if(
	g$cfg_mb_»gšfo
 =ğ'Y' && 
$¥aûS
 >=0)

270 
ShowMsg
("å®ŒæˆåŸºæœ¬ä¿¡æ¯çš„æ³¨å†Œï¼Œæ¥ä¸‹æ¥å®Œå–„è¯¦ç»†èµ„æ–™...","index_do.php?fmdo=user&dopost=regnew&step=2",0,1000);

271 
ex™
();

273 
»quœe_Úû
(
XAKMEMBER
."/templets/reg-new3.htm");

274 
	gex™
;

277 
ShowMsg
("æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥èµ„æ–™æ˜¯å¦æœ‰è¯¯æˆ–ä¸ç®¡ç†å‘˜è”ç³»ï¼", "-1");

278 
ex™
();

281 
»quœe_Úû
(
XAKMEMBER
."/templets/reg-new.htm");

283 if(!
	g$cfg_ml
->
IsLogš
())

285 
ShowMsg
("å°šæœªå®ŒæˆåŸºæœ¬ä¿¡æ¯çš„æ³¨å†Œ,è¯·è¿”å›é‡æ–°å¡«å†™ï¼", "index_do.php?fmdo=user&dopost=regnew");

286 
	gex™
;

288 if(
	g$cfg_ml
->
	gf›lds
['spacesta'] == 2)

290 
ShowMsg
('ä½ å·²ç»ç™»é™†ç³»ç»Ÿï¼Œæ— éœ€é‡æ–°æ³¨å†Œï¼', 'index.php');

291 
	gex™
;

294 
	g$memb”mod–
 = 
Ãw
 
memb”mod–
(
$cfg_ml
->
M_MbTy³
);

295 
	g$po¡fÜm
 = 
$memb”mod–
->
g‘FÜm
(
Œue
);

296 if(
	g$dİo¡
 == 'reginfo')

299 
$xak_f›lds
 = 
em±y
($xak_f›ldsè? '' : 
Œim
($xak_fields);

300 
	g$xak_f›ldshash
 = 
em±y
(
$xak_f›ldshash
è? '' : 
Œim
($xak_fieldshash);

301 
	g$modid
 = 
em±y
(
$modid
)? 0 : 
štv®
(
´eg_»¶aû
("/[^\d]/",'', $modid));

303 if(!
em±y
(
$xak_f›lds
))

305 if(
	g$xak_f›ldshash
 !ğ
md5
(
$xak_f›lds
.
$cfg_cook›_’code
))

307 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

308 
ex™
();

311 
	g$mod–fÜm
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$modid' ");

312 if(!
is_¬¿y
(
$mod–fÜm
))

314 
showmsg
('æ¨¡å‹è¡¨å•ä¸å­˜åœ¨', '-1');

315 
ex™
();

317 
	g$šadd_f
 = '';

318 if(!
em±y
(
$xak_f›lds
))

320 
	g$f›ld¬r
 = 
ex¶ode
(';', 
$xak_f›lds
);

321 if(
is_¬¿y
(
$f›ld¬r
))

323 
fÜ—ch
(
$f›ld¬r
 
as
 
$f›ld
)

325 if(
	g$f›ld
 == '') ;

326 
	g$f›ldšfo
 = 
ex¶ode
(',', 
$f›ld
);

327 if(
	g$f›ldšfo
[1] == 'textdata')

329 
$
{
$f›ldšfo
[0]} = 
F‹rS—rch
(
¡r¦ashes
(${$fieldinfo[0]}));

330 
	g$
{
	g$f›ldšfo
[0]} = 
add¦ashes
(
$
{
$f›ldšfo
[0]});

334 if(
em±y
(
$
{
$f›ldšfo
[0]})è
	g$
{
	g$f›ldšfo
[0]} = '';

335 
	g$
{
	g$f›ldšfo
[0]} = 
G‘F›ldV®ue
(
$
{
$f›ldšfo
[0]}, $fieldinfo[1],0,'add','','diy', $fieldinfo[0]);

337 if(
	g$f›ldšfo
[0]=="bœthday"è
$
{
$f›ldšfo
[0]}=
G‘D©eMk
(${$fieldinfo[0]});

338 
	g$šadd_f
 .ğ','.
$f›ldšfo
[0]." ='".
$
{$fieldinfo[0]}."' ";

345 
	g$qu”y
 = "UPDATE `{$membermodel->table}` SET `mid`='{$cfg_ml->M_ID}' $inadd_f WHERE `mid`='{$cfg_ml->M_ID}'; ";

346 if(
	g$dsql
->
execu‹nÚequ”y
(
$qu”y
))

348 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET `spacesta`='2' WHERE `mid`='{$cfg_ml->M_ID}'");

350 
	g$cfg_ml
->
D–Cache
(
$cfg_ml
->
M_ID
);

351 
»quœe_Úû
(
XAKMEMBER
."/templets/reg-new3.htm");

352 
	gex™
;

355 
»quœe_Úû
(
XAKMEMBER
."/templets/reg-new2.htm");

	@E:\web\weixun\user\resetpassword.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_pwd_functions.php");

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

11 if(
	g$dİo¡
 == "")

13 
šşude
(
dœÇme
(
__FILE__
)."/templets/resetpassword.htm");

15 
–£if
(
$dİo¡
 == "getpwd")

19 if(!
is£t
(
$vdcode
)) $vdcode = '';

21 
	g$sv®i
 = 
G‘CkVdV®ue
();

22 if(
¡¹Şow”
(
$vdcode
è!ğ
$sv®i
 || $svali=='')

24 
Re£tVdV®ue
();

25 
ShowMsg
("å¯¹ä¸èµ·ï¼ŒéªŒè¯ç è¾“å…¥é”™è¯¯ï¼","-1");

26 
ex™
();

30 if(
em±y
(
$ma
è&&ƒm±y(
$u£rid
))

32 
showmsg
('å¯¹ä¸èµ·ï¼Œè¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±', '-1');

33 
	gex™
;

34 } ià(!
´eg_m©ch
("#(.*)@(.*)\.(.*)#", 
$ma
))

36 
showmsg
('å¯¹ä¸èµ·ï¼Œè¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼', '-1');

37 
	gex™
;

38 } ià(
CheckU£rID
(
$u£rid
, '', 
çl£
) != 'ok')

40 
ShowMsg
("ä½ è¾“å…¥çš„ç”¨æˆ·å {$userid} ä¸åˆæ³•ï¼","-1");

41 
ex™
();

43 
	g$memb”
 = 
memb”
(
$ma
, 
$u£rid
);

46 if(
	g$ty³
 == 1)

49 if(
$cfg_£ndma_bysm
 == "Y")

51 
¢
(
$memb”
['mid'],
$u£rid
,$member['email']);

54 
showmsg
('å¯¹ä¸èµ·é‚®ä»¶æœåŠ¡æš‚æœªå¼€å¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜', 'login.php');

55 
ex™
();

59 } ià(
	g$ty³
 == 2)

61 if(
$memb”
['safequestion'] == 0)

63 
showmsg
('å¯¹ä¸èµ·æ‚¨å°šæœªè®¾ç½®å®‰å…¨å¯†ç ï¼Œè¯·é€šè¿‡é‚®ä»¶æ–¹å¼é‡è®¾å¯†ç ', 'login.php');

64 
	gex™
;

66 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/resetpassword3.htm");

68 
ex™
();

70 if(
	g$dİo¡
 == "safequestion")

72 
$mid
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$id
);

73 
	g$sql
 = "SELECT safequestion,safeanswer,userid,email FROM `#@__member_list` WHERE mid = '$mid'";

74 
	g$row
 = 
$db
->
G‘OÃ
(
$sql
);

75 if(
em±y
(
$§ãque¡iÚ
)è
	g$§ãque¡iÚ
 = '';

77 if(
em±y
(
$§ãªsw”
)è
	g$§ãªsw”
 = '';

79 if(
	g$row
['§ãque¡iÚ'] =ğ
$§ãque¡iÚ
 && 
$row
['§ãªsw”'] =ğ
$§ãªsw”
)

81 
¢
(
$mid
, 
$row
['userid'], $row['email'], 'N');

82 
ex™
();

86 
ShowMsg
("å¯¹ä¸èµ·ï¼Œæ‚¨çš„å®‰å…¨é—®é¢˜æˆ–ç­”æ¡ˆå›ç­”é”™è¯¯","-1");

87 
ex™
();

91 if(
	g$dİo¡
 == "getpasswd")

94 if(
em±y
(
$id
))

96 
ShowMsg
("å¯¹ä¸èµ·ï¼Œè¯·ä¸è¦éæ³•æäº¤","login.php");

97 
ex™
();

99 
	g$mid
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$id
);

100 
	g$row
 = 
$db
->
G‘OÃ
("SELECT * FROM #@__pwd_tmp WHERE mid = '$mid'");

101 if(
em±y
(
$row
))

103 
ShowMsg
("å¯¹ä¸èµ·ï¼Œè¯·ä¸è¦éæ³•æäº¤","login.php");

104 
ex™
();

106 if(
em±y
(
$£
))

108 
	g$tim
= (60*60*24*3);

109 
	g$dtime
 = 
time
();

110 if(
	g$dtime
 - 
	g$tim
 > 
	g$row
['mailtime'])

112 
	g$db
->
execu‹nÚequ”y
("DELETE FROM `#@__pwd_tmp` WHERE `md` = '$id';");

113 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä¸´æ—¶å¯†ç ä¿®æ”¹æœŸé™å·²è¿‡æœŸ","login.php");

114 
ex™
();

116 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/resetpassword2.htm");

118 
–£if
(
$£
 == 2)

120 if(
is£t
(
$key
)è
$pwdtmp
 = $key;

122 
	g$¢
 = 
md5
(
Œim
(
$pwdtmp
));

123 if(
	g$row
['pwd'] =ğ
$¢
)

125 if(
$pwd
 != "")

127 if(
$pwd
 =ğ
$pwdok
)

129 
$pwdok
 = 
PassJoš
($pwdok);

130 
	g$sql
 = "DELETE FROM `#@__pwd_tmp` WHERE `mid` = '$id';";

131 
	g$db
->
execu‹nÚequ”y
(
$sql
);

132 
	g$sql
 = "UPDATE `#@__member_list` SET `pwd` = '$pwdok' WHERE `mid` = '$id';";

133 if(
	g$db
->
execu‹nÚequ”y
(
$sql
))

135 
showmsg
('æ›´æ”¹å¯†ç æˆåŠŸï¼Œè¯·ç‰¢è®°æ–°å¯†ç ', 'login.php');

136 
	gex™
;

140 
showmsg
('å¯¹ä¸èµ·ï¼Œæ–°å¯†ç ä¸ºç©ºæˆ–å¡«å†™ä¸ä¸€è‡´', '-1');

141 
	gex™
;

143 
showmsg
('å¯¹ä¸èµ·ï¼Œä¸´æ—¶å¯†ç é”™è¯¯', '-1');

144 
	gex™
;

	@E:\web\weixun\user\search.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
.'/enums.func.php');

10 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

11 
	g$m’uty³
 = 'xakmenu';

14 
CheckNÙAÎow
();

16 
	g$addsqls
 = 
¬¿y
();

17 
	g$´ovšû
 = 
em±y
(
$´ovšû
è? 0 : 
štv®
($province);

18 
	g$c™y
 = 
em±y
(
$c™y
è? 0 : 
štv®
($city);

19 
	g$mšage
 = 
em±y
(
$mšage
è? 0 : 
štv®
($minage);

20 
	g$maxage
 = 
em±y
(
$maxage
è? 0 : 
štv®
($maxage);

22 if(
em±y
(
$£x
)è
	g$£x
 = '';

23 if(
em±y
(
$keywÜd
)è
	g$keywÜd
 = '';

25 
	g$keywÜd
 = 
F‹rS—rch
(
¡r¦ashes
(
$keywÜd
));

26 
	g$keywÜd
 = 
add¦ashes
(
ú_sub¡r
(
$keywÜd
,20));

28 if(!
	$em±y
(
$keywÜd
)) {

29 
$addsqls
[] = " (mb.userid†ike '%$keyword%' Or mb.uname†ike '%$keyword%') ";

30 
	}
}

32 if(
	$em±y
(
$c™y
)) {

33 
$¶aû
 = 
$´ovšû
;

34 
	}
}

36 
	g$¶aû
 = 
$c™y
;

39 ifĞ
	g$¶aû
%500 != 0 )

41 
$addsqls
[] = " mp.place='$place' ";

45 if(
	g$¶aû
!=0)

47 
$mšp
 = 
$¶aû
 - 1;

48 
	g$maxp
 = 
$¶aû
 + 500;

49 
	g$addsqls
[] = " mp.place>'$minp' And mp.place<'$maxp' ";

53 if(
	g$£x
!=''è
$addsqls
[] = " mp.sex = '$sex' ";

54 if(
	g$mšage
!=0è
$addsqls
[] = " YEAR(CURDATE())-YEAR(mp.birthday)>='$minage' ";

55 if(
	g$maxage
!=0è
$addsqls
[] = " YEAR(CURDATE())-YEAR(mp.birthday)<='$maxage' ";

57 
	g$addsqls_¡r
 = 
još
(' And ',
$addsqls
);

58 if(
	g$addsqls_¡r
!='') {

59 
$addsqls_¡r
 = ' And '.$addsqls_str;

62 
	g$addsql
 = " WHERE mb.¥aû¡¨> -1 ".
$addsqls_¡r
;

64 
	g$qu”y
 = "SELECT mb.*,mp.place,YEAR(CURDATE())-YEAR(mp.birthday) AS‡ge,mp.lovemsg,mp.birthday FROM `#@__member_list` mb

65 
LEFT
 
JOIN
 `#@
__memb”_³rsÚ
` 
mp
 
ON
 mp.
mid
 = 
mb
.mid

66 {
$addsql
} 
ORDER
 
BY
 
mb
.
logštime
 
DESC
";

67 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

68 
	g$dli¡
->
	g·geSize
 = 8;

69 
	g$dli¡
->
S‘P¬am‘”
('keywÜd',
$keywÜd
);

70 
	g$dli¡
->
S‘P¬am‘”
('´ovšû',
$´ovšû
);

71 
	g$dli¡
->
S‘P¬am‘”
('c™y',
$c™y
);

72 
	g$dli¡
->
S‘P¬am‘”
('mšage',
$mšage
);

73 
	g$dli¡
->
S‘P¬am‘”
('maxage',
$maxage
);

74 
	g$dli¡
->
S‘P¬am‘”
('£x',
$£x
);

75 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
.'/templets/search.htm');

76 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

77 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\user\shops_orders.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
šşude_Úû
 
	gXAKINC
.'/datalistcp.class.php';

9 
	g$m’uty³
 = 'xakmenu';

10 
	g$m’uty³_sÚ
 = 'op';

11 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

21 
funùiÚ
 
	$G‘S
(
$¡a
,
$oid
)

23 
glob®
 
$dsql
;

24 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT….name FROM #@__shops_orders AS s LEFT JOIN #@__payment AS… ON s.paytype=p.id WHERE s.oid='$oid'");

25 if(
$¡a
==0)

27  'æœªä»˜æ¬¾('.
$row
['Çme'].'è< <¨h»f="../moduË/ÿrbuyaùiÚ.php?dİo¡=memşickout&oid='.
$oid
.'"arget="_blank">å»ä»˜æ¬¾</a>';

28 } ià(
$¡a
==1){

30 } ià(
$¡a
==2){

31  '<¨h»f="shİs_´oduùs.php?do=ok&oid='.
$oid
.'">ç¡®è®¤</a>';

35 
	}
}

36 if(
	g$dİo¡
=='')

38 
$sql
 = "SELECT * FROM #@__shİs_Üd” WHERE u£rid='".
$cfg_ml
->
M_ID
."' ORDER BY stime DESC";

39 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

40 
	g$dl
->
	g·geSize
 = 20;

42 
	g$dl
->
S‘Tem¶©e
(
dœÇme
(
__FILE__
)."/templets/shops_orders.htm");

43 
	g$dl
->
S‘Sourû
(
$sql
);

44 
	g$dl
->
Di¥Ïy
();

45 } ià(
	g$dİo¡
=='del')

47 
$ids
 = 
ex¶ode
(',',$ids);

48 if(
is£t
(
$ids
è&& 
is_¬¿y
($ids))

50 
fÜ—ch
(
$ids
 
as
 
$id
)

52 
	g$id
 = 
´eg_»¶aû
("/^[a-z][0-9]$/","",
$id
);

53 
	g$qu”y
 = "DELETE FROM `#@__shops_products` WHERE oid='$id' AND userid='{$cfg_ml->M_ID}'";

54 
	g$qu”y2
 = "DELETE FROM `#@__shops_orders` WHERE oid='$id' AND userid='{$cfg_ml->M_ID}'";

55 
	g$qu”y3
 = "DELETE FROM `#@__shops_userinfo` WHERE oid='$id' AND userid='{$cfg_ml->M_ID}'";

56 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

57 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y2
);

58 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y3
);

60 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„äº¤æ˜“è®°å½•!","shops_orders.php");

61 
ex™
();

	@E:\web\weixun\user\shops_point.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
	$is£t
(
$oid
))

10 
$oid
 = 
	`´eg_»¶aû
("#[^-0-9A-Z]#i", "", $oid);

11 
$rs
 = 
$dsql
->
	`G‘OÃ
("SELECT…ayty³,´iûCouÁ FROM #@__shİs_Üd” WHERE u£rid='".
$cfg_ml
->
M_ID
."' AND oid='$oid'");

12 if(
$rs
['paytype']!=5)

14 
	`ShowMsg
("è®¢å•ä¸æ”¯æŒè¯¥æ”¯ä»˜æ–¹å¼ï¼","javascript:;");

15 
	`ex™
();

17 
$´iûCouÁ
 = 
$row
['priceCount'];

19 
$memb”s
 = 
$dsql
->
	`G‘OÃ
("SELECT `mÚey` FROM `#@__memb”_li¡` WHERE mid='".
$cfg_ml
->
M_ID
."'");

20 if(
$memb”s
['mÚey'] < 
$´iûCouÁ
)

22 
	`ShowMsg
("æ”¯ä»˜å¤±è´¥ç‚¹æ•°ä¸å¤Ÿï¼","-1");

23 
	`ex™
();

26 if(
$dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__shİs_Üd”s` SET `¡©e`='1' WHERE `oid`='$oid' AND `u£rid`='".
$cfg_ml
->
M_ID
."' AND `state`<1"))

28 
$»s
 = 
$dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET money=money-$priceCount WHERE mid='{$cfg_ml->M_ID}'");

29 
	`ShowMsg
("ä¸‹å•,æ”¯ä»˜æˆåŠŸ,ç­‰å¾…å•†å®¶å‘è´§ï¼","../u£r/shİs_´oduùs.php?oid=".
$oid
);

30 
	`ex™
();

34 
	`ShowMsg
("æ”¯ä»˜å¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜ï¼","-1");

35 
	`ex™
();

37 
	}
}

40 
ex™
("403 Forbidden!");

	@E:\web\weixun\user\shops_products.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
šşude_Úû
 
	gXAKINC
.'/datalistcp.class.php';

9 
	g$m’uty³
 = 'xakmenu';

10 
	g$m’uty³_sÚ
 = 'op';

11 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

13 if(
	g$dİo¡
=='')

15 
$do
 = 
is£t
($doè? 
Œim
($do) : '';

16 
	g$oid
 = 
is£t
(
$oid
è? 
´eg_»¶aû
("#[^-0-9A-Z]#i", "", $oid) : '';

17 
	g$addsql
 = '';

18 if(!
em±y
(
$oid
))

20 if(
	g$do
=='ok')

22 
$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__shops_orders SET `state`='4' WHERE oid='$oid'");

23 
ShowMsg
("å·²ç¡®è®¤è®¢å•ï¼",'shİs_´oduùs.php?oid='.
$oid
);

24 
ex™
();

27 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__shİs_u£ršfØWHERE u£rid='".
$cfg_ml
->
M_ID
."' AND oid='$oid'");

28 if(!
is£t
(
$row
['oid']))

30 
ShowMsg
("è®¢å•ä¸å­˜åœ¨ï¼",-1);

31 
ex™
();

33 
	g$row
['des'] = 
¡r¦ashes
(
$row
['des']);

34 
	g$rs
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__shİs_Üd” WHERE u£rid='".
$cfg_ml
->
M_ID
."' AND oid='$oid'");

35 
	g$row
['¡©e'] = 
$rs
['state'];

36 
	g$row
['¡ime'] = 
$rs
['stime'];

37 
	g$row
['ÿ¹couÁ'] = 
$rs
['cartcount'];

38 
	g$row
['´iû'] = 
$rs
['price'];

39 
	g$row
['u´iû'] = 
$rs
['price'] / $rs['cartcount'];

40 
	g$row
['d´iû'] = 
$rs
['dprice'];

41 
	g$row
['´iûCouÁ'] = 
$rs
['priceCount'];

42 
	g$rs
 = 
$dsql
->
G‘OÃ
("SELECT `dname` FROM #@__shops_delivery WHERE…id='$rs[pid]' LIMIT 0,1");

43 
	g$row
['dÇme'] = 
$rs
['dname'];

44 
un£t
(
$rs
);

45 
	g$addsql
 = " AND oid='".
$oid
."'";

48 
	g$sql
 = "SELECT * FROM #@__shİs_´oduù WHERE u£rid='".
$cfg_ml
->
M_ID
."' $addsql ORDER BY‡id ASC";

49 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

50 
	g$dl
->
	g·geSize
 = 20;

51 if(!
em±y
(
$oid
)è
	g$dl
->
S‘P¬am‘”
('oid',$oid);

53 
	g$dl
->
S‘Tem¶©e
(
dœÇme
(
__FILE__
)."/templets/shops_products.htm");

54 
	g$dl
->
S‘Sourû
(
$sql
);

55 
	g$dl
->
Di¥Ïy
();

57 ià(
	g$dİo¡
=='del')

59 
$ids
 = 
ex¶ode
(',',$ids);

60 if(
is£t
(
$ids
è&& 
is_¬¿y
($ids))

62 
fÜ—ch
(
$ids
 
as
 
$id
)

64 
	g$id
 = 
´eg_»¶aû
("/^[a-z][0-9]$/","",
$id
);

65 
	g$qu”y
 = "DELETE FROM `#@__shops_products` WHERE oid='$id' AND userid='{$cfg_ml->M_ID}'";

66 
	g$qu”y2
 = "DELETE FROM `#@__shops_orders` WHERE oid='$id' AND userid='{$cfg_ml->M_ID}'";

67 
	g$qu”y3
 = "DELETE FROM `#@__shops_userinfo` WHERE oid='$id' AND userid='{$cfg_ml->M_ID}'";

68 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

69 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y2
);

70 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y3
);

72 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„äº¤æ˜“è®°å½•!","shops_products.php");

73 
ex™
();

84 
funùiÚ
 
	$G‘S
(
$¡a
,
$oid
)

86 
glob®
 
$dsql
;

87 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT…aytype FROM #@__shops_orders WHERE oid='$oid'");

88 
$·yÇme
 = 
$dsql
->
	`G‘OÃ
("SELECT‚ame,fee FROM #@__payment WHERE id='{$row['paytype']}'");

89 if(
$¡a
==0)

91  
$·yÇme
['name']." æ‰‹ç»­è´¹:".$payname['fee']."å…ƒ";

93 
	`–£if
(
$¡a
==1)

97 
	`–£if
(
$¡a
==2)

99  '<¨h»f="shİs_´oduùs.php?do=ok&oid='.
$oid
.'">ç¡®è®¤</a>';

105 
	}
}

113 
funùiÚ
 
	$ÿrTime
(
$oid
)

115 
glob®
 
$dsql
;

116 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT stime FROM #@__shops_orders WHERE oid='$oid'");

117  
	`Myd©e
('Y-m-d h:i:s',
$row
['stime']);

118 
	}
}

	@E:\web\weixun\user\soft_add.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

4 
CheckRªk
(0, 0);

5 if(
	g$cfg_mb_l™
=='Y')

7 
ShowMsg
("ç”±äºç³»ç»Ÿå¼€å¯äº†ç²¾ç®€ç‰ˆä¼šå‘˜ç©ºé—´ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

8 
ex™
();

10 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

11 
»quœe_Úû
(
XAKINC
."/userlogin.class.php");

12 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

13 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

14 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

15 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 3;

16 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

17 
	g$m’uty³
 = 'content';

22 if(
	$em±y
(
$dİo¡
))

24 
$cInfos
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$channelid'; ");

25 if(!
	`is_¬¿y
(
$cInfos
))

27 
	`ShowMsg
('æ¨¡å‹ä¸æ­£ç¡®', '-1');

28 
	`ex™
();

32 if(
$cInfos
['sendrank']>0 || $cInfos['usertype']!='')

34 
	`CheckRªk
(0, 0);

38 if(
$cInfos
['£nd¿nk'] > 
$cfg_ml
->
M_Rªk
)

40 
$row
 = 
$dsql
->
	`G‘OÃ
("S–eù memb”ÇmFrom `#@__¬üªk` wh”¿nk='".
$cInfos
['sendrank']."' ");

41 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$row
['membername']."]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

42 
	`ex™
();

44 if(
$cInfos
['u£¹y³']!='' && $cInfos['u£¹y³'] !ğ
$cfg_ml
->
M_MbTy³
)

46 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œéœ€è¦[".
$cInfos
['usertype']."å¸å·]æ‰èƒ½åœ¨è¿™ä¸ªé¢‘é“å‘å¸ƒæ–‡æ¡£ï¼","-1","0",5000);

47 
	`ex™
();

49 
	`šşude
(
XAKMEMBER
."/templets/soft_add.htm");

50 
	`ex™
();

51 
	}
}

56 if(
	g$dİo¡
=='save')

58 
$desütiÚ
 = '';

59 
šşude
(
XAKMEMBER
.'/inc/archives_check.php');

62 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$chªÃlid
,
$£ndd©e
,
$mid
);

63 if(
em±y
(
$¬cID
))

65 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

66 
ex™
();

70 
	g$šadd_f
 = '';

71 
	g$šadd_v
 = '';

72 if(!
em±y
(
$xak_addÚf›lds
))

74 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

75 
	g$šadd_f
 = '';

76 
	g$šadd_v
 = '';

77 if(
is_¬¿y
(
$addÚf›lds
))

79 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

81 if(
	g$v
=='')

84 }if(
	g$v
 == 'templet')

86 
ShowMsg
("ä½ ä¿å­˜çš„å­—æ®µæœ‰è¯¯,è¯·æ£€æŸ¥ï¼","-1");

87 
ex™
();

89 
	g$vs
 = 
ex¶ode
(',',
$v
);

90 if(!
is£t
(
$
{
$vs
[0]}))

92 
	g$
{
	g$vs
[0]} = '';

94 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

98 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

102 if(!
is£t
(
$
{
$vs
[0]}))

104 
	g$
{
	g$vs
[0]} = '';

106 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$¬cID
);

108 
	g$šadd_f
 .ğ','.
$vs
[0];

109 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

113 ià(
em±y
(
$xak_f›ldshash
è|| 
	g$xak_f›ldshash
 !ğ
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

115 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

116 
ex™
();

120 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

121 ià(
	g$fÚt™”m
 !ğ
$šadd_f
)

123 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

124 
ex™
();

129 if(
	g$l™pic
!='')

131 
$æag
 = 'p';

133 
	g$body
 = 
HtmlR•Ïû
(
$body
,-1);

136 
	g$šQu”y
 = "INSERT INTO `#@__archives`(id,typeid,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,

137 
cŞÜ
,
	gwr™”
,
	gsourû
,
	gl™pic
,
	gpubd©e
,
	g£ndd©e
,
	gmid
,
	gdesütiÚ
,
	gkeywÜds
)

138 
VALUES
 ('$arcID','$typeid','$sortrank','$flag','$ismake','$channelid','$arcrank','0','$money','$title','$shorttitle',

140 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

142 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

143 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arctiny` where id='$arcID' ");

144 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨ `#@__archives` æ—¶å‡ºé”™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚","javascript:;");

145 
ex™
();

149 
	g$soáu¾1
 = 
¡r¦ashes
(
$soáu¾1
);

150 if(!
´eg_m©ch
("#[_=&///?\.a-zA-Z0-9-]+$#i", 
$soáu¾1
))

152 
ShowMsg
("ç¡®å®šè½¯ä»¶åœ°å€æäº¤æ­£ç¡®!", "-1");

153 
	gex™
;

155 
	g$u¾s
 = '';

156 if(
	g$soáu¾1
!='')

158 
$u¾s
 .= "{xak:link islocal='1'ext='{$servermsg1}'} $softurl1 {/xak:link}\r\n";

160 
	g$i
=2; $i<=12; $i++)

162 if(!
em±y
(
$
{'soáu¾'.
$i
}))

164 
	g$£rv”msg
 = 
¡r_»¶aû
("'","",
¡r¦ashes
(
$
{'£rv”msg'.
$i
}));

165 
	g$soáu¾
 = 
¡r¦ashes
(
$
{'soáu¾'.
$i
});

166 if(
	g$£rv”msg
=='')

168 
$£rv”msg
 = 'ä¸‹è½½åœ°å€'.
$i
;

170 if(
	g$soáu¾
!='' && 
$soáu¾
!='http://')

172 
$u¾s
 .= "{xak:linkext='$servermsg'} $softurl {/xak:link}\r\n";

176 
	g$u¾s
 = 
add¦ashes
(
$u¾s
);

177 
	g$soásize
 = 
$soásize
.
$un™
;

180 
	g$ÃedmÚey
 = @
štv®
(
$ÃedmÚey
);

181 if(
	g$ÃedmÚey
 > 100) $needmoney = 100;

182 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

183 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

184 if(
em±y
(
$addbË
))

186 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

187 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

188 
ShowMsg
("æ²¡æ‰¾åˆ°å½“å‰æ¨¡å‹[{$channelid}]çš„ä¸»è¡¨ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œï¼ã€‚","javascript:;");

189 
ex™
();

191 
	g$šQu”y
 = "INSERT INTO `$addtable`(aid,typeid,filetype,language,softtype,accredit,

192 
os
,
	gsoá¿nk
,
	gofficŸlU¾
,
	gofficŸlDemo
,
	gsoásize
,
	gsoálšks
,
	gšŒoduû
,
	gu£r
,
	g‹m¶‘
,
	g»dœeùu¾
,
	gdacûss
,
	gÃedmÚey
{
	g$šadd_f
})

193 
VALUES
 ('$arcID','$typeid','$filetype','$language','$softtype','$accredit',

194 '$os','$soá¿nk','$officŸlU¾','$officŸlDemo','$soásize','$u¾s','$body','$u£r','','','0','$ÃedmÚey'{
$šadd_v
});";

195 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

197 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

198 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

199 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

200 
echo
 
	g$šQu”y
;

201 
ex™
();

202 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addbË}` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

203 
ex™
();

207 
	g$cfg_£nd¬c_scÜes
 = 
štv®
(
$cfg_£nd¬c_scÜes
);

208 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_li¡` s‘ scÜes=scÜes+{$cfg_£nd¬c_scÜes} WHERE mid='".
$cfg_ml
->
M_ID
."' ; ");

210 
couÁArchives
(
$chªÃlid
);

213 
In£¹Tags
(
$gs
,
$¬cID
);

214 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
, 
TRUE
);

215 if(
	g$¬tU¾
=='')

217 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

221 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/api/uc.func.php')

224 
	g$ãed
['icon'] = 'thread';

225 
	g$ãed
['title_template'] = '<b>{username} åœ¨ç½‘ç«™å…±äº«äº†ä¸€è½¯ä»¶</b>';

226 
	g$ãed
['t™Ë_d©a'] = 
¬¿y
('u£ºame' => 
$cfg_ml
->
M_U£rName
);

227 
	g$ãed
['body_template'] = '<b>{subject}</b><br>{message}';

228 
	g$u¾
 = !
¡r¡r
(
$¬tU¾
,'h‰p://'è? (
	g$cfg_ba£ho¡
.
	g$¬tU¾
) : $artUrl;

229 
	g$ãed
['body_d©a'] = 
¬¿y
('subjeù' => "<¨h»f=\"".
$u¾
."\">$t™Ë</a>", 'mes§ge' => 
ú_sub¡r
(
¡r_gs
(
´eg_»¶aû
("/\[.+?\]/is", '', 
$desütiÚ
)), 150));

230 
	g$ãed
['images'][] = 
¬¿y
('u¾' => 
$cfg_ba£ho¡
.'/images/scores.gif', 'link'=> $cfg_basehost);

231 
uc_ãed_nÙe
(
$cfg_ml
->
M_LogšID
,
$ãed
);

233 
uc_üed™_nÙe
(
$cfg_ml
->
M_LogšID
, 
$cfg_£nd¬c_scÜes
);

235 #/
a
}}

238 
	g$cfg_ml
->
RecÜdF“ds
('addsoá',
$t™Ë
,
$desütiÚ
,
$¬cID
);

240 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

243 
	g$msg
 = "

245 <
a
 
h»f
='soá_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒè½¯ä»¶</u></a>

246 &
nb¥
;&
	gnb¥
;

247 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹è½¯ä»¶</u></a>

248 &
nb¥
;&
	gnb¥
;

249 <
a
 
	gh»f
='soá_ed™.php?chªÃlid=$chªÃlid&aid=$¬cID'><
u
>æ›´æ”¹è½¯ä»¶</u></a>

250 &
nb¥
;&
	gnb¥
;

251 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid={$chªÃlid}'><
u
>å·²å‘å¸ƒè½¯ä»¶ç®¡ç†</u></a>

253 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒæ–‡ç« ï¼";

254 
	g$wecome_šfo
 = "è½¯ä»¶ç®¡ç†::å‘å¸ƒè½¯ä»¶";

255 
	g$wš
 = 
Ãw
 
OxWšdow
();

256 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒè½¯ä»¶ï¼š");

257 
	g$wš
->
AddMsgI‹m
(
$msg
);

258 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd", "&nb¥;", 
FALSE
);

259 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\soft_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0, 0);

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

11 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_catalog_options.php");

12 
»quœe_Úû
(
XAKMEMBER
."/inc/inc_archives_functions.php");

13 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 3;

14 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

15 
	g$m’uty³
 = 'content';

20 if(
	$em±y
(
$dİo¡
))

23 
$¬cQu”y
 = "SELECT

24 #@
__chªÃÉy³
.
ty³Çme
 
as
 
chªÃÊame
,

25 #@
__¬üªk
.
memb”Çme
 
as
 
¿nkÇme
,

26 #@
__chªÃÉy³
.
¬c¡a
,

27 #@
__¬chives
.*

28 
FROM
 #@
__¬chives


29 
LEFT
 
JOIN
 #@
__chªÃÉy³
 
ON
 #@__chªÃÉy³.
id
=#@
__¬chives
.
chªÃl


30 
LEFT
 
JOIN
 #@
__¬üªk
 
ON
 #@__¬üªk.
¿nk
=#@
__¬chives
.
¬üªk


31 
WHERE
 #@
__¬chives
.
id
='$aid'";

32 
$dsql
->
	`S‘Qu”y
(
$¬cQu”y
);

33 
$row
 = 
$dsql
->
	`G‘OÃ
(
$¬cQu”y
);

34 if(!
	`is_¬¿y
(
$row
))

36 
	`ShowMsg
("è¯»å–æ¡£æ¡ˆåŸºæœ¬ä¿¡æ¯å‡ºé”™!","-1");

37 
	`ex™
();

39 if(
$row
['arcrank']>=0)

41 
$dtime
 = 
	`time
();

42 
$maxtime
 = 
$cfg_mb_ed™day
 * 24 *3600;

43 if(
$dtime
 - 
$row
['£ndd©e'] > 
$maxtime
)

45 
	`ShowMsg
("è¿™ç¯‡æ–‡æ¡£å·²ç»é”å®šï¼Œä½ ä¸èƒ½å†ä¿®æ”¹å®ƒï¼","-1");

46 
	`ex™
();

49 
$qu”y
 = "SELECT * FROM `#@__chªÃÉy³` WHERE id='".
$row
['channel']."'";

50 
$cInfos
 = 
$dsql
->
	`G‘OÃ
(
$qu”y
);

51 if(!
	`is_¬¿y
(
$cInfos
))

53 
	`ShowMsg
("è¯»å–é¢‘é“é…ç½®ä¿¡æ¯å‡ºé”™!","javascript:;");

54 
	`ex™
();

56 
$addbË
 = 
$cInfos
['addtable'];

57 
$addQu”y
 = "SELECT * FROM `$addtable` WHERE‡id='$aid'";

58 
$addRow
 = 
$dsql
->
	`G‘OÃ
(
$addQu”y
);

59 
$ÃwRowS¹
 = 1;

60 
$nFÜm
 = '';

61 if(
	`is£t
(
$addRow
['softlinks']) && $addRow['softlinks']!='')

63 
$d
 = 
Ãw
 
	`XakTagP¬£
();

64 
$d
->
	`LßdSourû
(
$addRow
['softlinks']);

65 if(
	`is_¬¿y
(
$d
->
CTags
))

67 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

69 if(
$ùag
->
	`G‘Name
()=='link')

71 
$nFÜm
 .ğ"è½¯ä»¶åœ°å€".
$ÃwRowS¹
."ï¼š<špuˆşass='‹xt'y³='‹xt'‚ame='soáu¾".$ÃwRowS¹."' v®ue='".
	`Œim
(
$ùag
->
	`G‘IÂ”Text
())."' />

72 æœåŠ¡å™¨åç§°ï¼š<
šput
 
şass
='‹xt' 
ty³
='‹xt' 
Çme
='£rv”msg".$ÃwRowS¹."' 
v®ue
='".$ctag->GetAtt("text")."' />

73 <
br
 />";

74 
$ÃwRowS¹
++;

78 
$d
->
	`CË¬
();

80 
$chªÃlid
 = 
$row
['channel'];

81 
$gs
 = 
	`G‘Tags
(
$aid
);

82 
	`šşude
(
XAKMEMBER
."/templets/soft_edit.htm");

83 
	`ex™
();

84 
	}
}

88 if(
	g$dİo¡
=='save')

90 
$desütiÚ
 = '';

91 
šşude
(
XAKMEMBER
.'/inc/archives_check_edit.php');

94 
	g$šadd_f
 = '';

95 if(!
em±y
(
$xak_addÚf›lds
))

97 
	g$addÚf›lds
 = 
ex¶ode
(';', 
$xak_addÚf›lds
);

98 if(
is_¬¿y
(
$addÚf›lds
))

100 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

102 if(
	g$v
=='')

106 
	g$vs
 = 
ex¶ode
(',',
$v
);

107 if(!
is£t
(
$
{
$vs
[0]}))

109 
	g$
{
	g$vs
[0]} = '';

111 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$aid
);

112 
	g$šadd_f
 .ğ','.
$vs
[0]." ='".
$
{$vs[0]}."' ";

116 
	g$body
 = 
AÇly£HtmlBody
(
$body
, 
$desütiÚ
);

117 
	g$body
 = 
HtmlR•Ïû
(
$body
, -1);

120 if(
	g$l™pic
!=''è
$æag
 = 'p';

123 
	g$šadd_f
 = '';

124 
	g$šadd_v
 = '';

125 if(!
em±y
(
$xak_addÚf›lds
))

127 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

128 
	g$šadd_f
 = '';

129 
	g$šadd_v
 = '';

130 if(
is_¬¿y
(
$addÚf›lds
))

132 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

134 if(
	g$v
=='')

138 
	g$vs
 = 
ex¶ode
(',', 
$v
);

141 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

143 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

147 if(!
is£t
(
$
{
$vs
[0]}))

149 
	g$
{
	g$vs
[0]} = '';

151 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$¬cID
);

153 
	g$šadd_f
 .ğ",`{$vs[0]}` = '".
$
{
$vs
[0]}."'";

157 ià(
em±y
(
$xak_f›ldshash
è|| 
	g$xak_f›ldshash
 !ğ
md5
(
$xak_addÚf›lds
.
$cfg_cook›_’code
))

159 
showMsg
('æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›', '-1');

160 
ex™
();

164 
	g$fÚt™”m
 = 
PrštAutoF›ldsAdd
(
$cInfos
['f›ld£t'],'autof›ld', 
FALSE
);

165 ià(
	g$fÚt™”m
 !ğ
$šadd_f
)

167 
ShowMsg
("æäº¤è¡¨å•åŒç³»ç»Ÿé…ç½®ä¸ç›¸ç¬¦,è¯·é‡æ–°æäº¤ï¼", "-1");

168 
ex™
();

173 
	g$upQu”y
 = "UPDATE `#@__archives` set

174 
ismake
='$ismake',

175 
	g¬üªk
='$arcrank',

176 
	gty³id
='$typeid',

177 
	gt™Ë
='$title',

178 
	gl™pic
='$litpic',

179 
	gdesütiÚ
='$description',

180 
	gkeywÜds
='$keywords',

181 
	gæag
='$flag'

182 
WHERE
 
id
='$aid' 
AND
 
mid
='$mid'; ";

183 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$upQu”y
))

185 
ShowMsg
("æ›´æ–°æ•°æ®åº“archivesè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼", "-1");

186 
ex™
();

190 
	g$u¾s
 = '';

191 
	g$i
=1; $i<=9; $i++)

193 if(!
em±y
(
$
{'soáu¾'.
$i
}))

195 
	g$£rv”msg
 = 
¡r_»¶aû
("'",'',
¡r¦ashes
(
$
{'£rv”msg'.
$i
}));

196 
	g$soáu¾
 = 
¡r¦ashes
(
$
{'soáu¾'.
$i
});

197 if(!
´eg_m©ch
("#(h‰p:\/\/)?([\w-]+\.)+[\w-]+(/[\w- ./?%&=]*)?#i",
$soáu¾
)){

198 
ShowMsg
("è¯·ä½¿ç”¨æ ‡å‡†çš„urlæ ¼å¼", "-1");

199 
ex™
();

201 if(
	g$£rv”msg
=='')

203 
$£rv”msg
 = 'ä¸‹è½½åœ°å€'.
$i
;

205 if(
	g$soáu¾
!='' && 
$soáu¾
!='http://')

207 
$u¾s
 .= "{xak:linkext='$servermsg'} $softurl {/xak:link}\r\n";

211 
	g$u¾s
 = 
add¦ashes
(
$u¾s
);

214 
	g$ÃedmÚey
 = @
štv®
(
$ÃedmÚey
);

215 if(
	g$ÃedmÚey
 > 100) $needmoney = 100;

216 
	g$ùs
 = 
$dsql
->
G‘OÃ
("Select‡ddtable From `#@__channeltype` where id='$channelid' ");

217 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

218 if(
	g$addbË
!='')

220 
$šQu”y
 = "update `$addtable`

221 
£t
 
ty³id
 ='$typeid',

222 
	gf‘y³
 ='$filetype',

223 
	gÏnguage
 ='$language',

224 
	gsoáty³
 ='$softtype',

225 
	gacüed™
 ='$accredit',

226 
	gos
 ='$os',

227 
	gsoá¿nk
 ='$softrank',

228 
	gofficŸlU¾
 ='$officialUrl',

229 
	gofficŸlDemo
 ='$officialDemo',

230 
	gsoásize
 ='$softsize',

231 
	gsoálšks
 ='$urls',

232 
	gu£r
='$userip',

233 
	gÃedmÚey
='$needmoney',

234 
	gšŒoduû
='$body'{
$šadd_f
}

235 
wh”e
 
aid
='$aid'; ";

236 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

238 
ShowMsg
("æ›´æ–°æ•°æ®åº“é™„åŠ è¡¨‡ddonsoft æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥åŸå› ï¼","-1");

239 
ex™
();

242 
UpIndexKey
(
$aid
,
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$gs
);

243 
	g$¬tU¾
 = 
MakeA¹
(
$aid
,
TRUE
);

244 if(
	g$¬tU¾
=='')

246 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$aid";

250 
	g$msg
 = "ã€€ã€€è¯·é€‰æ‹©ä½ çš„åç»­æ“ä½œï¼š

251 <
a
 
h»f
='soá_add.php?cid=$ty³id'><
u
>å‘å¸ƒæ–°è½¯ä»¶</u></a>

252 &
nb¥
;&
	gnb¥
;

253 <
a
 
	gh»f
='soá_ed™.php?chªÃlid=$chªÃlid&aid=".$aid."'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

254 &
nb¥
;&
	gnb¥
;

255 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹è½¯ä»¶</u></a>

256 &
nb¥
;&
	gnb¥
;

257 <
a
 
	gh»f
='cÚ‹Á_li¡.php?chªÃlid=$chªÃlid'><
u
>ç®¡ç†è½¯ä»¶</u></a>

259 
$wšt™Ë
 = "æˆåŠŸæ›´æ”¹è½¯ä»¶ï¼";

260 
	g$wecome_šfo
 = "è½¯ä»¶ç®¡ç†::æ›´æ”¹è½¯ä»¶";

261 
	g$wš
 = 
Ãw
 
OxWšdow
();

262 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹è½¯ä»¶ï¼š");

263 
	g$wš
->
AddMsgI‹m
(
$msg
);

264 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
FALSE
);

265 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\user\spaceskin.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
	g$m’uty³
 = 'config';

10 if(
	g$cfg_mb_l™
=='Y')

12 
ShowMsg
("ç”±äºç³»ç»Ÿå¼€å¯äº†ç²¾ç®€ç‰ˆä¼šå‘˜ç©ºé—´ï¼Œä½ è®¿é—®çš„åŠŸèƒ½ä¸å¯ç”¨ï¼","-1");

13 
ex™
();

15 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

18 if(
	g$dİo¡
=="use")

20 
AjaxH—d
();

21 
	g$t
 = 
´eg_»¶aû
("#[^a-z0-9-]#i", "", 
$t
);

22 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__memb”_¥aû` SET s·û¡yË='$t' WHERE mid='".
$cfg_ml
->
M_ID
."';");

23 
ShowMsg
('æˆåŠŸæ›´æ–°ç©ºé—´æ ·å¼ï¼', 'spaceskin.php');

28 
	g$u£¼ow
 = 
$dsql
->
G‘OÃ
("SELECT s·û¡yË FROM `#@__memb”_¥aû` WHERE mid='".
$cfg_ml
->
M_ID
."' ");

29 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/spaceskin.htm");

30 
ex™
();

40 
funùiÚ
 
	$checku£
(
$ty³
)

42 
glob®
 
$cfg_ml
, 
$u£¼ow
;

43 if(
$u£¼ow
['¥aû¡yË'] =ğ
$ty³
)

49  '<¨h»f="¥aûskš.php?t='.
$ty³
.'&dopost=use"itle="ä½¿ç”¨æ­¤é£æ ¼">ä½¿ç”¨</a>';

51 
	}
}

61 
funùiÚ
 
	$showdemİic
(
$dœ
, 
$dœÇme
)

63 ià(
	`fe_exi¡s
("$dir/$dirname/demo.png")) {

64 
$demİic
 = "$dir/$dirname/demo.png";

65 } ià(
	`fe_exi¡s
("$dir/$dirname/demo.jpg")) {

66 
$demİic
 = "$dir/$dirname/demo.jpg";

67 } ià(
	`fe_exi¡s
("$dir/$dirname/demo.jpeg")) {

68 
$demİic
 = "$dir/$dirname/demo.jpeg";

69 } ià(
	`fe_exi¡s
("$dir/$dirname/demo.gif")) {

70 
$demİic
 = "$dir/$dirname/demo.gif";

72  
$demİic
;

73 
	}
}

82 
funùiÚ
 
	$Li¡Skš
()

84 
glob®
 
$cfg_ml
;

85 
$dœ
 = 'space';

86 
$®lskšs
 = 
	`¬¿y
();

88 if(
	`fe_exi¡s
(
$dœ
.'/skinlist.inc'))

90 
$ds
 = 
	`fe
(
$dœ
.'/skinlist.inc');

91 
	`fÜ—ch
(
$ds
 
as
 
$d
)

93 
$d
 = 
	`Œim
($d);

94 if(
	`em±y
(
$d
è|| 
	`sub¡r
($d, 0, 2)=='//') ;

95 if(!
	`is_dœ
(
$dœ
.'/'.
$d
)) ;

96 
$dœs
[] = 
$d
;

101 
$å
 = 
	`İ’dœ
(
$dœ
);

102 
$sy¢ame
 = 
	`»addœ
(
$å
))

104 
$dœs
[] = 
$sy¢ame
;

106 
	`şo£dœ
(
$dh
);

109 
	`fÜ—ch
(
$dœs
 
as
 
$sy¢ame
)

111 ià(
$sy¢ame
=='.' || $sysname=='..' || $sysname=='CVS'

112 || !
	`fe_exi¡s
("$dir/$sysname/info.txt"))

116 
$demİic
 = 
	`showdemİic
(
$dœ
, 
$sy¢ame
);

117 
$d©e
 = 
	`MyD©e
('Y-m-d', 
	`femtime
("$dir/$sysname"));

118 
$li¡db
 = 
	`¬¿y
(

119 'sign' => 
$sy¢ame
,

120 'demo' => 
$demİic
,

125 
$šfod©as
 = 
	`fe
("$dir/$sysname/info.txt");

126 
	`fÜ—ch
(
$šfod©as
 
as
 
$d
)

128 
$d
 = 
	`Œim
($d);

129 if(
	`em±y
(
$d
)) ;

130 
$ds
 = 
	`ex¶ode
(':', 
$d
);

131 
$li¡db
[
	`Œim
(
$ds
[0])] =rim($ds[1]);

133 if(
$li¡db
['ty³'] !ğ'deçuÉ' && $li¡db['ty³'] !ğ
$cfg_ml
->
M_MbTy³
)

137 
$®lskšs
[] = 
$li¡db
;

140 
$num
 = 0;

141 
´št
 '<tr class="head" height="25"><td colspan="2">&nbsp; &nbsp;<b></b></td></tr>';

142 
	`fÜ—ch
 (
$®lskšs
 
as
 
$v®ue
)

144 if(
$num
==0è{ 
´št
 '<tr height="20">'; }

145 
$num
++;

146 
´št
 '<td cÏss="b"><img src="'.
$v®ue
['demo'].'" width="150" height="150" border="0" /><br />';

147 
´št
 'é£æ ¼åç§°ï¼š'.
$v®ue
['name']."({$value['sign']})".'<br />';

148 
´št
 'é£æ ¼ä½œè€…ï¼š'.
$v®ue
['author'].'<br />';

150 
´št
 'æ“ä½œï¼š'.
	`checku£
(
$v®ue
['sign']).'';

151 if(
$num
==4)

153 
$num
=0;

154 
´št
 '</tr>';

157 if(
$num
 != 0)

159 
$i
=
$num
; $num < 4; $num++)

161 
´št
' <td class="b">&nbsp;</td>';

163 
´št
 '</tr>';

165 
´št
 '</td>';

166 
	}
}

	@E:\web\weixun\user\templets\menu.php

1 <?
php


2 
	g$add_chªÃl_m’u
 = 
¬¿y
();

4 if(!
em±y
(
$cfg_ml
->
M_ID
))

6 
	g$chªÃlInfos
 = 
¬¿y
();

7 
	g$dsql
->
Execu‹
('addmod',"SELECT id,nid,typename,useraddcon,usermancon,issend,issystem,usertype,isshow FROM `#@__channeltype` ");

8 
	g$m’urow
 = 
$dsql
->
G‘A¼ay
('addmod'))

10 
$chªÃlInfos
[
$m’urow
['nid']] = $menurow;

12 if(
	g$m’urow
['isshow']==0)

17 if(
	g$m’urow
['is£nd']!=1 || 
$m’urow
['issystem']==1

18 || ( !
´eg_m©ch
("#".
$cfg_ml
->
M_MbTy³
."#", 
$m’urow
['u£¹y³']è&& 
Œim
($menurow['usertype'])!='' ) )

22 
	g$m’urow
['ddcÚ'] = 
em±y
(
$m’urow
['useraddcon']) ? 'archives_add.php' : $menurow['useraddcon'];

23 
	g$m’urow
['li¡'] = 
em±y
(
$m’urow
['usermancon']) ? 'content_list.php' : $menurow['usermancon'];

24 
	g$add_chªÃl_m’u
[] = 
$m’urow
;

26 
un£t
(
$m’urow
);

28 <
div
 
	gid
="mcpsub">

29 <
div
 
şass
="topGr"></div>

30 <
div
 
id
="menuBody">

32 <?
php


33 if(
$m’uty³
 == 'content')

36 <
h2
 
şass
="m’uT™Ë" 
Úşick
="m’uShow('m’uFœ¡')" 
id
="m’uFœ¡_t"><
b
></b>ç³»ç»Ÿæ¨¡å‹å†…å®¹</h2>

37 <
ul
 
id
="menuFirst">

38 <?
php


40 if(
$chªÃlInfos
['article']['issend']==1 && $channelInfos['article']['isshow']==1)

43 <
li
 
şass
="¬tişes"><
a
 
h»f
="../u£r/cÚ‹Á_li¡.php?chªÃlid=1" 
t™Ë
="å·²å‘å¸ƒçš„æ–‡ç« "><
b
></b>æ–‡ç« </a><a href="../user/article_add.php" class="act"itle="å‘è¡¨æ–°æ–‡ç« ">å‘è¡¨</a></li>

44 <?
php


47 if(
	g$chªÃlInfos
['image']['is£nd']==1 && 
$cfg_mb_®bum
=='Y' && 
$chªÃlInfos
['image']['isshow']==1

48 && (
$chªÃlInfos
['image']['u£¹y³']=='' || 
´eg_m©ch
("#".
$cfg_ml
->
f›lds
['mtype']."#", $channelInfos['image']['usertype'])) )

53 <
li
 
	gşass
="phÙo"><
a
 
h»f
="../u£r/cÚ‹Á_li¡.php?chªÃlid=2" 
t™Ë
="ç®¡ç†å›¾é›†"><
b
></b>å›¾é›†</a><¨h»f="../u£r/®bum_add.php" 
şass
="act"itle="æ–°å»ºå›¾é›†">æ–°å»º</a></li>

54 <?
php


57 if(
	g$chªÃlInfos
['soá']['is£nd']==1 && 
$chªÃlInfos
['soft']['isshow']==1

58 && (
$chªÃlInfos
['image']['u£¹y³']=='' || 
´eg_m©ch
("#".
$cfg_ml
->
f›lds
['mtype']."#", $channelInfos['image']['usertype']))

62 <
li
 
	gşass
="soá"><
a
 
h»f
="../u£r/cÚ‹Á_li¡.php?chªÃlid=3" 
t™Ë
="å·²å‘å¸ƒçš„è½¯ä»¶"><
b
></b>è½¯ä»¶</a><¨h»f="../u£r/soá_add.php"™Ë="ä¸Šä¼ è½¯ä»¶"
şass
="act">ä¸Šä¼ </a></li>

63 <?
php


66 </
	gul
>

67 <?
php


69 if(
	g$cfg_mb_£nd®l
=='Y')

72 <
h2
 
şass
="m’uT™Ë" 
Úşick
="m’uShow('m’uSec')" 
id
="m’uSec_t"><
b
></b>è‡ªå®šä¹‰å†…å®¹</h2>

73 <
ul
 
id
="menuSec">

74 <?
php


75 
fÜ—ch
(
$add_chªÃl_m’u
 
as
 
$Â¬r
) {

77 <
li
 
şass
="<?ph°echØ$Â¬r['nid'];?>"><
a
 
h»f
="../u£r/<?ph°echØ$Â¬r['li¡'];?>?chªÃlid=<?ph°echØ$Â¬r['id'];?>" 
t™Ë
="å·²å‘å¸ƒçš„<?ph°echØ$Â¬r['ty³Çme'];?>"><
b
></b><?
php
 
echo
 
$Â¬r
['ty³Çme'];?></
	ga
><¨
	gh»f
='¬chives_do.php?dİo¡÷ddArc&chªÃlid=<?ph°echØ$Â¬r['
id
'];?>' class="act"itle="å‘è¡¨æ–°æ–‡ç« ">å‘è¡¨</a></li>

78 <?
php


82 </
	gul
>

83 <
h2
 
	gşass
="m’uT™Ë" 
Úşick
="m’uShow('m’uThœd')" 
id
="m’uThœd_t"><
b
></b>å…¶ä»–ç®¡ç†</h2>

84 <
ul
 
id
="menuThird">

85 <
li
 
şass
="icÚ‡‰achm’t"><
a
 
h»f
="../u£r/u¶ßds.php"><
b
></b>é™„ä»¶ç®¡ç†</a></li>

86 </
ul
>

88 <?
php


92 <?
php


93 if(
	g$m’uty³
 == 'xakmenu')

96 <
h2
 
şass
="m’uT™Ë" 
Úşick
="m’uShow('m’uFœ¡')" 
id
="m’uFœ¡_t"><
b
></b>ä¼šå‘˜äº’åŠ¨</h2>

97 <
ul
 
id
="menuFirst">

98 <
li
 
şass
="icÚ my¡ow"><
a
 
h»f
="../u£r/my¡ow.php"><
b
></b>æˆ‘çš„æ”¶è—å¤¹</a></li>

99 <?
php


100 if(
$cfg_ãedback_fÜbid
=='N')

104 
$dsql
->
Execu‹
('nn','Select indexname,indexurl From `#@__sys_module` where ismember=1 ');

105 
	g$Â¬r
 = 
$dsql
->
G‘A¼ay
('nn'))

107 @
´eg_m©ch
("/\/(.+?)\//is", 
$Â¬r
['šdexu¾'],
$m©ches
);

108 
	g$Â¬r
['şass'] = 
is£t
(
$m©ches
[1]) ? $matches[1] : 'channel';

109 
	g$Â¬r
['šdexu¾'] = 
¡r_»¶aû
("**","=",
$Â¬r
['indexurl']);

111 <
li
 
	gşass
="<?ph°echØ$Â¬r['şass'];?>"><
a
 
h»f
="<?ph°echØ$Â¬r['šdexu¾']; ?>"><
b
></b><?
php
 
echo
 
$Â¬r
['šdexÇme']; ?>æ¨¡å—</
	ga
></
	gli
>

112 <?
	gphp


115 </
	gul
>

116 <?
	gphp


120 <?
php


121 if(
	g$m’uty³
 == 'config')

124 <
h2
 
şass
="m’uT™Ë" 
Úşick
="m’uShow('m’uFœ¡')" 
id
="m’uFœ¡_t"><
b
></b><?
php
 
echo
 
$cfg_ml
->
M_MbTy³
; ?>èµ„æ–™</
	ga
></
	gh2
>

125 <
ul
 
	gid
="menuFirst">

126 <
li
 
şass
="icÚ ba£šfo"><
a
 
h»f
="../u£r/ed™_ba£šfo.php"><
b
></b>åŸºæœ¬èµ„æ–™</a></li>

127 <
li
 
şass
="icÚ myšfo"><
a
 
h»f
="../u£r/ed™_fuÎšfo.php"><
b
></b><?
php
 
echo
 
$cfg_ml
->
M_MbTy³
; ?>èµ„æ–™</
	ga
></
	gli
>

128 <
li
 
	gşass
="icÚ faû"><
a
 
h»f
="../u£r/ed™_çû.php"><
b
></b>å¤´åƒè®¾ç½®</a></li>

129 </
ul
>

130 <
h2
 
şass
="m’uT™Ë" 
Úşick
="m’uShow('m’uSec')" 
id
="m’uSec_t"><
b
></b>ç©ºé—´ç®¡ç†</h2>

131 <
ul
 
id
="menuSec">

132 <
li
 
şass
="icÚ mty³s"><
a
 
h»f
="../u£r/mty³s.php"><
b
></b>åˆ†ç±»ç®¡ç†</a></li>

133 <
li
 
şass
="icÚ flšk"><
a
 
h»f
="../u£r/æšk_maš.php"><
b
></b>ä¹¦ç­¾ç®¡ç†</a></li>

134 <
li
 
şass
="icÚ info"><
a
 
h»f
="../u£r/ed™_¥aû_šfo.php"><
b
></b>ç©ºé—´è®¾ç½®</a></li>

135 <
li
 
şass
="icÚ s·ûskš"><
a
 
h»f
="../u£r/¥aûskš.php"><
b
></b>é£æ ¼é€‰æ‹©</a></li>

136 </
ul
>

138 <?
php


141 <!--<
h2
 
	gşass
="m’uT™Ë"><
b
 
şass
="showMenu"></b>æ“ä½œä¸»èœå•é¡¹</h2> -->

142 </
div
>

143 <
div
 
şass
="buttomGr"></div>

144 </
div
>

145 <?
php


	@E:\web\weixun\user\uploads.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

11 
	g$m’uty³
 = 'content';

12 
	g$keywÜd
 = 
em±y
(
$keywÜd
è? '' : 
F‹rS—rch
($keyword);

13 
	g$addsql
 = " wh”mid='".
$cfg_ml
->
M_ID
."' ANDitle LIKE '%$keyword%' ";

14 if(
em±y
(
$medŸty³
)è
	g$medŸty³
 = 0;

16 
	g$medŸty³
 = 
štv®
(
$medŸty³
);

17 if(
	g$medŸty³
>0è
	g$addsql
 .= " AND mediatype='$mediatype' ";

19 
	g$sql
 = "SELECT * FROM `#@__uploads` $addsql ORDER BY‡id DESC";

20 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

21 
	g$dli¡
->
	g·geSize
 = 5;

22 
	g$dli¡
->
S‘P¬am‘”
("medŸty³",
$medŸty³
);

23 
	g$dli¡
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

24 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/templets/uploads.htm");

25 
	g$dli¡
->
S‘Sourû
(
$sql
);

26 
	g$dli¡
->
Di¥Ïy
();

28 
funùiÚ
 
	$MedŸTy³
(
$tid
,
$nu¾
)

30 if(
$tid
==1)

34 if(
$tid
==2)

38 if(
$tid
==3)

46 
	}
}

48 
funùiÚ
 
	$G‘FeSize
(
$fs
)

50 
$fs
 = $fs/1024;

51  
	`¥rštf
("%10.1f",
$fs
)." K";

52 
	}
}

54 
funùiÚ
 
	$G‘ImageV›w
(
$fu¾
,
$mty³
)

56 if(
$mty³
==1)

60 
	}
}

	@E:\web\weixun\user\uploads_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckRªk
(0,0,
FALSE
);

9 
»quœe_Úû
(
XAKMEMBER
.'/inc/inc_archives_functions.php');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
em±y
(
$medŸty³
)è
	g$medŸty³
 = 1;

12 
	g$m’uty³
 = 'content';

13 if(
	g$dİo¡
=='')

15 
šşude
(
XAKMEMBER
."/templets/uploads_add.htm");

17 if(
	g$dİo¡
=='save')

19 
$cfg_ml
->
CheckU£rS·û
();

20 if(
	g$medŸty³
==1)

22 
$uty³
 = 'image';

24 if(
	g$medŸty³
==2)

26 
$uty³
 = 'flash';

28 if(
	g$medŸty³
==3)

30 
$uty³
 = 'media';

34 
	g$uty³
 = 'addon';

36 
	g$t™Ë
 = 
HtmlR•Ïû
(
$t™Ë
,2);

37 
	g$f’ame
 = 
Memb”U¶ßds
('addÚfe','',
$cfg_ml
->
M_ID
,
$uty³
,'',-1,-1,
Œue
);

38 
SaveU¶ßdInfo
(
$t™Ë
,
$f’ame
,
$medŸty³
);

39 
	g$bku¾
 = "u¶ßds_£Ëù.php?f=".
$f
."&medŸty³=".
$medŸty³
."&keywÜd=".
u¾’code
(
$keywÜd
)."&f’ame=".
$f’ame
;

40 if(
	g$f’ame
=='')

42 
ShowMsg
("ä¸Šä¼ æ–‡ä»¶å¤±è´¥ï¼","-1");

46 
ShowMsg
("æˆåŠŸä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼",
$bku¾
);

	@E:\web\weixun\user\uploads_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckRªk
(0,0);

9 
»quœe_Úû
(
XAKMEMBER
.'/inc/inc_archives_functions.php');

10 
	g$m’uty³
 = 'content';

11 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

13 if(
	g$dİo¡
=='')

15 
$¬ow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__uploads` WHERE‡id='$aid ';");

16 if(!
is_¬¿y
(
$¬ow
))

18 
ShowMsg
('é™„ä»¶ä¸å­˜åœ¨', '-1');

19 
ex™
();

21 if(
	g$¬ow
['mid'] !ğ
$cfg_ml
->
M_ID
)

23 
ShowMsg
("ä½ æ²¡æœ‰ä¿®æ”¹è¿™ä¸ªé™„ä»¶çš„æƒé™ï¼","-1");

24 
ex™
();

26 
šşude
(
XAKMEMBER
."/templets/uploads_edit.htm");

27 
ex™
();

29 if(
	g$dİo¡
=='save')

31 
$t™Ë
 = 
HtmlR•Ïû
($title,2);

32 if(
	g$medŸty³
==1è
$uty³
 = 'image';

33 if(
	g$medŸty³
==2)

35 
$uty³
 = 'flash';

37 if(
	g$medŸty³
==3)

39 
$uty³
 = 'media';

43 
	g$uty³
 = 'addon';

45 
	g$t™Ë
 = 
HtmlR•Ïû
(
$t™Ë
, 2);

46 
	g$exÇme
 = 
´eg_»¶aû
("#(.*)/#", "", 
$Şdu¾
);

47 
	g$exÇme
 = 
´eg_»¶aû
("#\.(.*)$#", "", 
$exÇme
);

48 
	g$f’ame
 = 
Memb”U¶ßds
('addÚfe', 
$Şdu¾
, 
$cfg_ml
->
M_ID
, 
$uty³
,
$exÇme
, -1, -1, 
TRUE
);

49 
SaveU¶ßdInfo
(
$t™Ë
, 
$f’ame
, 
$medŸty³
);

50 
ShowMsg
("æˆåŠŸä¿®æ”¹æ–‡ä»¶ï¼", "uploads_edit.php?aid=$aid");

	@E:\web\weixun\user\uploads_select.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0,
FALSE
);

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

11 
	g$m’uty³
 = 'content';

12 if(
em±y
(
$f’ame
)è
	g$f’ame
 = '';

14 
	g$keywÜd
 = 
em±y
(
$keywÜd
è? '' : 
F‹rS—rch
($keyword);

15 
	g$addsql
 = " WHERE mid='".
$cfg_ml
->
M_ID
."' ANDitle LIKE '%$keyword%' ";

16 if(
em±y
(
$medŸty³
)è
	g$medŸty³
 = 0;

18 
	g$medŸty³
 = 
štv®
(
$medŸty³
);

19 if(
	g$medŸty³
>0è
	g$addsql
 .= " AND mediatype='$mediatype' ";

21 
	g$sql
 = "SELECT * FROM `#@__uploads` $addsql ORDER BY‡id DESC";

22 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

23 
	g$dli¡
->
	g·geSize
 = 5;

24 
	g$dli¡
->
S‘P¬am‘”
("medŸty³",
$medŸty³
);

25 
	g$dli¡
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

26 
	g$dli¡
->
S‘P¬am‘”
("f",
$f
);

27 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
."/templets/uploads_select.htm");

28 
	g$dli¡
->
S‘Sourû
(
$sql
);

29 
	g$dli¡
->
Di¥Ïy
();

39 
funùiÚ
 
	$MedŸTy³
(
$tid
, 
$nu¾
)

41 if(
$tid
==1)

45 if(
$tid
==2)

49 if(
$tid
==3)

57 
	}
}

58 
funùiÚ
 
	$G‘FeSize
(
$fs
)

60 
$fs
 = $fs/1024;

61  
	`¥rštf
("%10.1f",
$fs
)." K";

62 
	}
}

63 
funùiÚ
 
	$G‘ImageV›w
(
$fu¾
,
$mty³
)

65 if(
$mty³
==1)

69 
	}
}

	@E:\web\weixun\user\visit-history.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckRªk
(0,0);

9 
	g$m’uty³
 = 'xakmenu';

10 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

12 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

13 
	g$wsql
 = '';

14 if(
	g$dİo¡
=='meview')

16 
$wsql
 = " v.vid='{$cfg_ml->M_ID}' ";

17 
	g$Šame
 = "æˆ‘æœ€è¿‘è®¿é—®";

18 
	g$osql
="ON v.mid=m.mid ";

22 
	g$wsql
 = " v.mid='{$cfg_ml->M_ID}' ";

23 
	g$Šame
 = "å…³æ³¨æˆ‘çš„äºº";

24 
	g$osql
="ON v.vid=m.mid ";

26 
	g$qu”y
 = "SELECT v.*,m.sex,face FROM `#@__member_vhistory` AS v LEFT JOIN `#@__member_list` AS m $osql WHERE $wsql ORDER BY vtime DESC";

27 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

28 
	g$dli¡
->
	g·geSize
 = 20;

29 
	g$dli¡
->
S‘P¬am‘”
("dİo¡",
$dİo¡
);

30 
	g$dli¡
->
S‘Tem¶©e
(
XAKMEMBER
.'/templets/visit-history.htm');

31 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

32 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\action_search.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/actionsearch_class.php");

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

13 
	g$keywÜd
=
em±y
(
$keywÜd
)? "" : $keyword;

14 
	g$aù£¬ch
 = 
Ãw
 
AùiÚS—rch
(
$keywÜd
);

15 
	g$a¤esuÉ
 = 
$aù£¬ch
->
S—rch
();

16 
šşude
 
XAKINClude
('templets/action_search.htm');

	@E:\web\weixun\xakadmin\actionsearch_class.php

1 <?
php


5 şas 
	cAùiÚS—rch


7 
v¬
 
	m$keywÜd
;

8 
v¬
 
	m$a§¼ay
 = 
¬¿y
();

9 
v¬
 
	m$»suÉ
 = 
¬¿y
();

12 
funùiÚ
 
	$AùiÚS—rch
(
$keywÜd
){

13 
$this
->
a§¼ay
 = $this->
	`G‘S—rch¡r
();

14 
$this
->
keywÜd
 = 
$keywÜd
;

17 
funùiÚ
 
	$G‘S—rch¡r
()

19 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
)."/inc/inc_action_info.php");

20  
	`is_¬¿y
(
$aùiÚS—rch
)? $aùiÚS—rch : 
	`¬¿y
();

21 
	}
}

23 
funùiÚ
 
	$£¬ch
(){

24 
$this
->
	`£¬chkeywÜd
();

25  
$this
->
»suÉ
;

26 
	}
}

33 
funùiÚ
 
	$£¬chkeywÜd
(){

34 
$i
 = 0;

35 
	`fÜ—ch
 (
$this
->
a§¼ay
 
as
 
$key
=>
$v®ue
)

38 if(
	`is_¬¿y
(
$this
->
a§¼ay
[
$key
]['soniterm']))

40 
	`fÜ—ch
 (
$this
->
a§¼ay
[
$key
]['sÚ™”m'] 
as
 
$k
=> 
$v®
)

43 if(
	`Te¡Purv›w
(
$v®
['purview']))

46 if(
$this
->
	`_¡½os
(
$v®
['t™Ë'], $this->
keywÜd
è!=ğ
çl£
 || $this->_strpos($val['description'], $this->keyword)!== false)

49 
$this
->
»suÉ
[
$i
]['tİt™Ë'] = $this->
	`»dCŞÜKeywÜd
($this->
a§¼ay
[
$key
]['toptitle']);

50 
$this
->
»suÉ
[
$i
]['t™Ë'] = $this->
	`»dCŞÜKeywÜd
($this->
a§¼ay
[
$key
]['title']);

51 
$this
->
»suÉ
[
$i
]['desütiÚ'] = $this->
	`»dCŞÜKeywÜd
($this->
a§¼ay
[
$key
]['description']);

53 
$this
->
»suÉ
[
$i
]['sÚ™”m'][] = $this->
	`»dCŞÜKeywÜd
(
$v®
);

58 
$i
++;

60 
	}
}

69 
funùiÚ
 
	$»dCŞÜKeywÜd
(
$‹xt
){

70 if(
	`is_¬¿y
(
$‹xt
))

72 
	`fÜ—ch
 (
$‹xt
 
as
 
$key
 => 
$v®ue
) {

73 if(
$key
 == 'title' || $key == 'description')

76 
$‹xt
[
$key
] = 
	`¡r_»¶aû
(
$this
->
keywÜd
,'<font color="red">'.$this->keyword.'</font>',$text[$key]);

80 
$‹xt
 = 
	`¡r_»¶aû
(
$this
->
keywÜd
,'<font color="red">'.$this->keyword.'</font>',$text);

82  
$‹xt
;

83 
	}
}

85 
funùiÚ
 
	$_¡½os
(
$¡ršg
,
$fšd
)

87 ià(
	`funùiÚ_exi¡s
('¡ros')è 
	`¡ros
(
$¡ršg
,
$fšd
);

88  
	`¡½os
(
$¡ršg
,
$fšd
);

89 
	}
}

	@E:\web\weixun\xakadmin\ad_add.php

1 <?
php


8 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

9 
CheckPurv›w
('plus_å¹¿å‘Šç®¡ç†');

10 
»quœe_Úû
 
	gXAKINC
."/typelink.class.php";

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

13 if(
	g$dİo¡
=="save")

16 
$gÇme
 = 
Œim
($tagname);

17 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECTypeid FROM #@__myad WHEREypeid='$typeid' ANDagname LIKE '$tagname'");

18 if(
is_¬¿y
(
$row
))

20 
ShowMsg
("åœ¨ç›¸åŒæ ç›®ä¸‹å·²ç»å­˜åœ¨åŒåçš„æ ‡è®°ï¼","-1");

21 
ex™
();

23 
	g$¡¬‰ime
 = 
G‘MkTime
(
$¡¬‰ime
);

24 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

25 
	g$lšk
 = 
add¦ashes
(
$nÜmbody
['link']);

26 if(
	g$nÜmbody
['style']=='code')

28 
$nÜmbody
 = 
add¦ashes
($normbody['htmlcode']);

30 if(
	g$nÜmbody
['style']=='txt')

33 
$nÜmbody
 = "<a href=\"{$link}\" font-size=\"{$normbody['size']}\" color=\"{$normbody['color']}\">{$normbody['title']}</a>";

35 if(
	g$nÜmbody
['style']=='img')

37 if(
em±y
(
$nÜmbody
['width']))

39 
$width
 = "";

43 
	g$width
 = " width=\"{$normbody['width']}\"";

45 ià(
em±y
(
$nÜmbody
['height']))

47 
	g$height
 = "";

51 
	g$height
 = "height=\"{$normbody['height']}\"";

53 
	g$nÜmbody
 = "<a href=\"{$link}\"><img src=\"{$normbody['url']}\"$width $height border=\"0\" /></a>";

57 if(
em±y
(
$nÜmbody
['width']))

59 
	g$width
 = "";

63 
	g$width
 = " width=\"{$normbody['width']}\"";

65 ià(
em±y
(
$nÜmbody
['height']))

67 
	g$height
 = "";

71 
	g$height
 = "height=\"{$normbody['height']}\"";

73 
	g$nÜmbody
 = "<object classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"http://download.Macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0\"$width $height><param‚ame=\"movie\" value=\"{$link}\"/><param‚ame=\"quality\" value=\"high\"/></object>";

75 
	g$qu”y
 = "

76 
INSERT
 
INTO
 #@
__myad
(
şsid
,
ty³id
,
gÇme
,
adÇme
,
time£t
,
¡¬‰ime
,
’dtime
,
nÜmbody
,
expbody
)

77 
VALUES
('$clsid','$typeid','$tagname','$adname','$timeset','$starttime','$endtime','$normbody','$expbody');

79 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

80 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªå¹¿å‘Šï¼","ad_main.php");

81 
ex™
();

83 
	g$dsql
->
Execu‹
('dd','SELECT * FROM `#@__myadtype` ORDER BY id DESC');

84 
	g$İtiÚ
 = '';

85 
	g$¬r
 = 
$dsql
->
G‘A¼ay
('dd'))

87 
$İtiÚ
 .= "<option value='{$arr['id']}'>{$arr['typename']}</option>\n\r";

89 
	g$¡¬tDay
 = 
time
();

90 
	g$’dDay
 = 
AddDay
(
$¡¬tDay
,30);

91 
	g$¡¬tDay
 = 
G‘D©eTimeMk
(
$¡¬tDay
);

92 
	g$’dDay
 = 
G‘D©eTimeMk
(
$’dDay
);

93 
šşude
 
XAKINClude
('templets/ad_add.htm');

	@E:\web\weixun\xakadmin\ad_edit.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_å¹¿å‘Šç®¡ç†');

9 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 
	g$aid
 = 
´eg_»¶aû
("#[^0-9]#", '', 
$aid
);

12 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? "ad_main.php" : $_COOKIE['ENV_GOBACK_URL'];

14 if(
	g$dİo¡
=='delete')

16 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__myad` WHERE‡id='$aid' ");

17 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€åˆ™å¹¿å‘Šä»£ç ï¼",
$ENV_GOBACK_URL
);

18 
ex™
();

20 if(
	g$dİo¡
=="gettag")

22 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

23 
	g$jscode
 = "<script src='{$cfg_phpurl}/ad_js.php?aid=$aid'†anguage='javascript'></script>";

24 
	g$showhtml
 = "<xmp style='color:#333333;background-color:#ffffff'>\r\n\r\n$jscode\r\n\r\n</xmp>";

25 
	g$showhtml
 .= "é¢„è§ˆï¼š<iframe‚ame='testfrm' frameborder='0' src='ad_edit.php?aid={$aid}&dopost=testjs' id='testfrm' width='100%' height='200'></iframe>";

26 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECTagname from `#@__myad` WHERE‡id='$aid' ");

28 
	g$showg
 = '{'."xak:myad‚ame='{$row['tagname']}'/".'}';

29 
	g$šfo
 = "<b>è¯´æ˜ï¼š</b>å¦‚æœåµŒå…¥çš„æ˜¯CMSå¹¿å‘Šæ ‡ç­¾ï¼Œé‚£ä¹ˆå°†ä¼šè§£ææˆæ ‡ç­¾ä¸­çš„å†…å®¹åˆ°é¡µé¢ï¼Œå¹¿å‘Šæ›´æ”¹åéœ€è¦é‡æ–°ç”Ÿæˆã€‚<br />

30 å¦‚æœä¸å¸Œæœ›é‡æ–°ç”Ÿæˆæ‰€æœ‰é¡µé¢ï¼Œåˆ™ç›´æ¥è°ƒç”¨
JS
ä»£ç å³å¯ã€‚

32 
$wšt™Ë
 = "å¹¿å‘Šç®¡ç†-è·å–å¹¿å‘Šæ ‡ç­¾";

33 
	g$wecome_šfo
 = "<a href='ad_main.php'><u>å¹¿å‘Šç®¡ç†</u></a>::è·å–JS";

34 
	g$wš
 = 
Ãw
 
OxWšdow
();

35 
	g$wš
->
In™
();

36 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd",
$šfo
);

37 
	g$wš
->
AddT™Ë
("CMSæ ‡ç­¾è°ƒç”¨ä»£ç ï¼š");

38 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd",
$showg
);

39 
	g$wš
->
	gmyWšI‹m
 = '';

40 
	g$wš
->
AddT™Ë
("ä»¥ä¸‹ä¸ºé€‰å®šå¹¿å‘Šçš„JSè°ƒç”¨ä»£ç ï¼š");

41 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd",
$showhtml
);

42 
	g$wš
->
Di¥Ïy
();

43 
ex™
();

45 if(
	g$dİo¡
=='testjs')

47 
echo
 "<script src='{$cfg_phpurl}/ad_js.php?aid=$aid&nocache=1'†anguage='javascript'></script>";

48 
ex™
();

50 if(
	g$dİo¡
=='saveedit')

52 
$¡¬‰ime
 = 
G‘MkTime
($starttime);

53 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

54 
	g$qu”y
 = "UPDATE `#@__myad`

55 
SET


56 
şsid
='$clsid',

57 
	gty³id
='$typeid',

58 
	gadÇme
='$adname',

59 
	gtime£t
='$timeset',

60 
	g¡¬‰ime
='$starttime',

61 
	g’dtime
='$endtime',

62 
	gnÜmbody
='$normbody',

63 
	gexpbody
='$expbody'

64 
WHERE
 
aid
='$aid'

66 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

67 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€åˆ™å¹¿å‘Šä»£ç ï¼",
$ENV_GOBACK_URL
);

68 
ex™
();

71 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__myad` WHERE‡id='$aid'");

72 
	g$dsql
->
Execu‹
('dd','SELECT * FROM `#@__myadtype` ORDER BY id DESC');

73 
	g$İtiÚ
 = '';

74 
	g$¬r
 = 
$dsql
->
G‘A¼ay
('dd'))

76 ià(
$¬r
['id'] =ğ
$row
['clsid'])

78 
$İtiÚ
 .= "<option value='{$arr['id']}' selected='selected'>{$arr['typename']}</option>\n\r";

80 
	g$İtiÚ
 .= "<option value='{$arr['id']}'>{$arr['typename']}</option>\n\r";

83 
šşude
 
XAKINClude
('templets/ad_edit.htm');

	@E:\web\weixun\xakadmin\ad_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

9 
»quœe_Úû
(
XAKINC
.'/common.func.php');

10 
£tcook›
('ENV_GOBACK_URL',
$xakNowu¾
,
time
()+3600,'/');

13 
	g$şsid
 = 
is£t
(
$şsid
)? 
	$štv®
(
$şsid
) : 0;

14 
$keywÜd
 = 
	`is£t
($keywÜd)? 
	$add¦ashes
(
$keywÜd
) : '';

16 
$dsql
->
	`Execu‹
('dd','SELECT * FROM `#@__myadtype` ORDER BY id DESC');

17 
$İtiÚ
 = '';

18 
$¬r
 = 
$dsql
->
	`G‘A¼ay
('dd'))

20 ià(
$¬r
['id'] =ğ
$şsid
)

22 
$İtiÚ
 .= "<option value='{$arr['id']}' selected='selected'>{$arr['typename']}</option>\n\r";

24 
$İtiÚ
 .= "<option value='{$arr['id']}'>{$arr['typename']}</option>\n\r";

26 
	}
}

27 
	g$wh”e_sql
 = ' 1=1';

28 if(
	g$şsid
!=0è
$wh”e_sql
 .= " AND clsid = $clsid";

29 if(
	g$keywÜd
!=''è
$wh”e_sql
 .= " AND (ad.adname†ike '%$keyword%') ";

31 
	g$sql
 = "SELECT‡d.aid,ad.clsid,ad.tagname,tp.typename‡sypename,ad.adname,ad.timeset,ad.endtime,ap.typename‡s clsname

32 
FROM
 `#@
__myad
` 
ad


33 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
Ú
p.
id
=
ad
.
ty³id


34 
LEFT
 
JOIN
 `#@
__myadty³
` 
­
 
Ú
‡p.
id
=
ad
.
şsid


35 
WHERE
 
$wh”e_sql


36 
ORDER
 
BY
 
ad
.
aid
 
desc
";

37 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

38 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/ad_main.htm");

39 
	g$dli¡
->
S‘Sourû
(
$sql
);

40 
	g$dli¡
->
di¥Ïy
();

42 
funùiÚ
 
Te¡Ty³
(
$Šame
, 
$ty³
="")

44 if(
$Šame
=="")

46  (
$ty³
 == 1)? "é»˜è®¤åˆ†ç±»" : "æ‰€æœ‰æ ç›®";

50  
	g$Šame
;

54 
funùiÚ
 
	$TimeS‘V®ue
(
$ts
)

56 if(
$ts
==0)

64 
	}
}

	@E:\web\weixun\xakadmin\adtype_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
	g$dİo¡
=="save")

13 
$¡¬tID
 = 1;

14 
	g$’dID
 = 
$id’d
;

15 ;
	g$¡¬tID
<=
$’dID
;$startID++)

17 
	g$qu”y
 = '';

18 
	g$tid
 = 
$
{'ID_'.
$¡¬tID
};

19 
	g$²ame
 = 
$
{'²ame_'.
$¡¬tID
};

20 if(
is£t
(
$
{'check_'.
$¡¬tID
}))

22 if(
	g$²ame
!='')

24 
$qu”y
 = "UPDATE `#@__myadtypee` SETypename='$pname' WHERE id='$tid' ";

25 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

30 
	g$qu”y
 = "DELETE FROM `#@__myadtype` WHERE id='$tid' ";

31 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

35 if(
is£t
(
$check_Ãw
è&& 
	g$²ame_Ãw
!='')

37 
$qu”y
 = "INSERT INTO `#@__myadtype`(typename) VALUES('{$pname_new}');";

38 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

40 
h—d”
("Content-Type:ext/html; charset={$cfg_soft_lang}");

41 
ShowMsg
("æˆåŠŸæ›´æ–°å¹¿å‘Šåˆ†ç±»åˆ—è¡¨ï¼", 'adtype_main.php');

42 
	gex™
;

45 
šşude
 
XAKINClude
('templets/adtype_main.htm');

	@E:\web\weixun\xakadmin\album_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('a_New,a_AccNew');

9 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

10 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
 != 'save')

16 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

17 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

18 
CË¬MyAddÚ
();

19 
	g$chªÃlid
 = 
em±y
(
$chªÃlid
è? 0 : 
štv®
($channelid);

20 
	g$cid
 = 
em±y
(
$cid
è? 0 : 
štv®
($cid);

23 if(
	g$cid
>0 && 
	g$chªÃlid
==0)

25 
$row
 = 
$dsql
->
G‘OÃ
("SELECT channeltype FROM `#@__arctype` WHERE id='$cid'; ");

26 
	g$chªÃlid
 = 
$row
['channeltype'];

30 if(
	g$chªÃlid
==0è
$chªÃlid
 = 2;

34 
	g$cInfos
 = 
$dsql
->
G‘OÃ
(" SELECT * FROM `#@__channeltype` WHERE id='$channelid' ");

35 
	g$chªÃlid
 = 
$cInfos
['id'];

38 
	g$maxWright
 = 
$dsql
->
G‘OÃ
("SELECT id+1 AS cc FROM #@__archives ORDER BY id DESC");

39 
šşude
 
XAKINClude
("templets/album_add.htm");

40 
ex™
();

45 if(
	g$dİo¡
=='save')

47 
»quœe_Úû
(
XAKINC
.'/image.func.php');

48 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

50 
	g$æag
 = 
is£t
(
$æags
è? 
još
(',',$flags) : '';

51 
	g$nÙpo¡
 = 
is£t
(
$nÙpo¡
) && $notpost == 1 ? 1: 0;

52 if(
em±y
(
$şick
)è
	g$şick
 = (
$cfg_¬c_şick
=='-1' ? 
mt_¿nd
(50, 200) : $cfg_arc_click);

54 if(!
is£t
(
$ty³id2
)è
	g$ty³id2
 = 0;

55 if(!
is£t
(
$autokey
)è
	g$autokey
 = 0;

56 if(!
is£t
(
$»mÙe
)è
	g$»mÙe
 = 0;

57 if(!
is£t
(
$d–lšk
)è
	g$d–lšk
 = 0;

58 if(!
is£t
(
$autŞ™pic
)è
	g$autŞ™pic
 = 0;

59 if(!
is£t
(
$fÜmhtml
)è
	g$fÜmhtml
 = 0;

60 if(!
is£t
(
$fÜmz
)è
	g$fÜmz
 = 0;

61 if(!
is£t
(
$ddisfœ¡
)è
	g$ddisfœ¡
 = 0;

62 if(!
is£t
(
$d–z
)è
	g$d–z
 = 0;

63 if(
em±y
(
$şick
)è
	g$şick
 = (
$cfg_¬c_şick
=='-1' ? 
mt_¿nd
(50, 200) : $cfg_arc_click);

65 if(
	g$ty³id
==0)

67 
ShowMsg
("è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼", "-1");

68 
ex™
();

70 if(
em±y
(
$chªÃlid
))

72 
ShowMsg
("æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼","-1");

73 
ex™
();

75 if(!
CheckChªÃl
(
$ty³id
,
$chªÃlid
) )

77 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼","-1");

78 
ex™
();

80 if(!
Te¡Purv›w
('a_New'))

82 
CheckC©®og
(
$ty³id
,"å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æƒé™ï¼");

86 
	g$ty³_·¿m
 = 
$dsql
->
G‘OÃ
("SELECT ddimg_width, ddimg_height FROM `#@__arctype` WHERE id ='$typeid'");

87 if(!
em±y
(
$ty³_·¿m
['ddimg_width'])){

88 
	g$cfg_ddimg_width
 = 
$ty³_·¿m
['ddimg_width'];

90 if(!
em±y
(
$ty³_·¿m
['ddimg_height'])){

91 
	g$cfg_ddimg_height
 = 
$ty³_·¿m
['ddimg_height'];

95 if(
em±y
(
$wr™”
))
	g$wr™”
=
$cu£rLogš
->
g‘U£rName
();

96 if(
em±y
(
$sourû
))
	g$sourû
='æœªçŸ¥';

97 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

98 
	g$£ndd©e
 = 
time
();

99 
	g$sÜŒªk
 = 
AddDay
(
$pubd©e
,
$sÜtup
);

100 
	g$ismake
 = 
$ishtml
==0 ? -1 : 0;

101 
	g$t™Ë
 = 
´eg_»¶aû
("#\"#", 'ï¼‚', 
$t™Ë
);

102 
	g$t™Ë
 = 
ú_sub¡rR
(
$t™Ë
,
$cfg_t™Ë_maxËn
);

103 
	g$shÜ‰™Ë
 = 
ú_sub¡rR
(
$shÜ‰™Ë
,36);

104 
	g$cŞÜ
 = 
ú_sub¡rR
(
$cŞÜ
,7);

105 
	g$wr™”
 = 
ú_sub¡rR
(
$wr™”
,20);

106 
	g$sourû
 = 
ú_sub¡rR
(
$sourû
,30);

107 
	g$desütiÚ
 = 
ú_sub¡rR
(
$desütiÚ
,
$cfg_auÙ_desütiÚ
);

108 
	g$keywÜds
 = 
ú_sub¡rR
(
$keywÜds
,60);

109 
	g$f’ame
 = 
Œim
(
ú_sub¡rR
(
$f’ame
,40));

110 
	g$u£r
 = 
G‘IP
();

111 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

112 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

113 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck'))

115 
	g$¬üªk
 = -1;

117 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

120 if(
em±y
(
$ddi¤emÙe
))

122 
	g$ddi¤emÙe
 = 0;

124 
	g$l™pic
 = 
G‘DDImage
('nÚe',
$piúame
,
$ddi¤emÙe
);

127 if(
	g$ddisfœ¡
==1 && 
$l™pic
=='')

129 if(
is£t
(
$imgu¾1
))

131 
$l™pic
 = 
G‘DDImage
('ddfœ¡', 
$imgu¾1
, 
$i¤m
);

137 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$chªÃlid
,
$£ndd©e
,
$admšid
);

138 if(
em±y
(
$¬cID
))

140 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

141 
ex™
();

144 
	g$imgu¾s
 = "{xak:pagestyle maxwidth='$maxwidth'…agepicnum='$pagepicnum' ddmaxwidth='$ddmaxwidth'„ow='$row' col='$col' value='$pagestyle'/}\r\n";

145 
	g$hasÚe
 = 
FALSE
;

151 if(
	g$fÜmhtml
==1)

153 
$imagebody
 = 
¡r¦ashes
($imagebody);

154 
	g$imgu¾s
 .ğ
G‘CurCÚ‹ÁAlbum
(
$imagebody
,
$cİysourû
,
$l™piúame
);

155 if(
	g$ddisfœ¡
==1 && 
$l™pic
=='' && !
em±y
(
$l™piúame
))

157 
$l™pic
 = 
$l™piúame
;

158 
	g$hasÚe
 = 
TRUE
;

165 if(
	g$fÜmz
==1)

167 
šşude_Úû
(
XAKINC
."/zip.class.php");

168 
šşude_Úû
(
XAKADMIN
."/file_class.php");

169 
	g$zfe
 = 
$cfg_ba£dœ
.
¡r_»¶aû
(
$cfg_mašs™e
,'',
$zfe
);

170 
	g$tmpzdœ
 = 
XAKDATA
.'/ztmp/'.
ú_sub¡r
(
md5
(
ExecTime
()),16);

171 
	g$Áime
 = 
time
();

172 if(
fe_exi¡s
(
$zfe
))

174 @
mkdœ
(
$tmpzdœ
,
$GLOBALS
['cfg_dir_purview']);

175 @
chmod
(
$tmpzdœ
,
$GLOBALS
['cfg_dir_purview']);

176 
	g$z
 = 
Ãw
 
z
();

177 
	g$z
->
ExŒaùAÎ
(
$zfe
,
$tmpzdœ
);

178 
	g$fm
 = 
Ãw
 
FeMªagem’t
();

179 
	g$imgs
 = 
¬¿y
();

180 
	g$fm
->
G‘M©chFes
(
$tmpzdœ
,"jpg|²g|gif",
$imgs
);

181 
	g$i
 = 0;

182 
fÜ—ch
(
$imgs
 
as
 
$imgŞd
)

184 
	g$i
++;

185 
	g$§v•©h
 = 
$cfg_image_dœ
."/".
MyD©e
("Y-m",
$Áime
);

186 
C»©eDœ
(
$§v•©h
);

187 
	g$iu¾
 = 
$§v•©h
."/".
MyD©e
("d",
$Áime
).
dd2ch¬
(MyD©e("His",$Áime).'-'.
$admšid
."-{$i}".
mt_¿nd
(1000,9999));

188 
	g$iu¾
 = 
$iu¾
.
sub¡r
(
$imgŞd
,-4,4);

189 
	g$imgfe
 = 
$cfg_ba£dœ
.
$iu¾
;

190 
cİy
(
$imgŞd
,
$imgfe
);

191 
uÆšk
(
$imgŞd
);

193 if(
is_fe
(
$imgfe
))

195 
	g$l™piúame
 = 
$·ge¡yË
 > 2 ? 
G‘ImageM­DD
(
$iu¾
,
$cfg_ddimg_width
) : $iurl;

197 if(
	g$i
=='1')

199 if(!
$hasÚe
 && 
$ddisfœ¡
==1 && 
$l™pic
=='' && 
em±y
(
$l™piúame
))

201 
$l™piúame
 = 
G‘ImageM­DD
(
$iu¾
,
$cfg_ddimg_width
);

204 
	g$šfo
 = '';

205 
	g$imgšfos
 = 
G‘ImageSize
(
$imgfe
,
$šfo
);

206 
	g$imgu¾s
 .ğ"{xak:img ddimg='$l™piúame'ext='' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

209 
	g$šqu”y
 = "

210 
INSERT
 
INTO
 #@
__u¶ßds
(
t™Ë
,
u¾
,
medŸty³
,
width
,
height
,
¶aytime
,
fesize
,
u±ime
,
mid
)

211 
VALUES
 ('{$title}','{$iurl}','1','".$imginfos[0]."','".$imginfos[1]."','0','".filesize($imgfile)."','".$ntime."','$adminid');

213 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

214 
	g$fid
 = 
$dsql
->
G‘La¡ID
();

215 
AddMyAddÚ
(
$fid
, 
$iu¾
);

217 
W©”Img
(
$imgfe
, 'up');

219 if(!
	g$hasÚe
 && 
	g$ddisfœ¡
==1 && 
$l™pic
=='')

221 if(
em±y
(
$l™piúame
))

223 
$l™piúame
 = 
$iu¾
;

224 
	g$l™piúame
 = 
G‘ImageM­DD
(
$iu¾
, 
$cfg_ddimg_width
);

226 
	g$l™pic
 = 
$l™piúame
;

227 
	g$hasÚe
 = 
TRUE
;

231 if(
	g$d–z
==1è
uÆšk
(
$zfe
);

232 
	g$fm
->
RmDœFes
(
$tmpzdœ
);

239 if(
is_¬¿y
(
$_SESSION
['bigfile_info']))

241 
fÜ—ch
(
$_SESSION
['bigfe_šfo'] 
as
 
$k
=>
$v
)

243 
$Œuefe
 = 
$cfg_ba£dœ
.
$v
;

244 if(
¡¾’
(
$v
)<2 || !
fe_exi¡s
(
$Œuefe
)) ;

245 
	g$šfo
 = '';

246 
	g$imgšfos
 = 
G‘ImageSize
(
$Œuefe
, 
$šfo
);

247 
	g$l™piúame
 = 
$·ge¡yË
 > 2 ? 
G‘ImageM­DD
(
$v
, 
$cfg_ddimg_width
) : '';

248 if(!
	g$hasÚe
 && 
	g$ddisfœ¡
==1 && 
$l™pic
=='')

250 
$l™pic
 = 
em±y
(
$l™piúame
è? 
G‘ImageM­DD
(
$v
, 
$cfg_ddimg_width
) : $litpicname;

251 
	g$hasÚe
 = 
TRUE
;

253 
	g$imgšfo
 = !
em±y
(
$
{'picšfook'.
$k
}) ? ${'picinfook'.$k} : '';

254 
	g$imgu¾s
 .ğ"{xak:img ddimg='$l™piúame'ext='$imgšfo' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $v {/xak:img}\r\n";

258 
	g$imgu¾s
 = 
add¦ashes
(
$imgu¾s
);

261 
	g$body
 = 
AÇly£HtmlBody
(
$body
,
$desütiÚ
,
$l™pic
,
$keywÜds
,'htmltext');

264 
	g$šadd_f
 = '';

265 
	g$šadd_v
 = '';

266 if(!
em±y
(
$xak_addÚf›lds
))

268 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

269 
	g$šadd_f
 = '';

270 
	g$šadd_v
 = '';

271 if(
is_¬¿y
(
$addÚf›lds
))

273 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

275 if(
	g$v
=='')

279 
	g$vs
 = 
ex¶ode
(',',
$v
);

280 if(!
is£t
(
$
{
$vs
[0]}))

282 
	g$
{
	g$vs
[0]} = '';

284 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

286 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

290 if(!
is£t
(
$
{
$vs
[0]}))

292 
	g$
{
	g$vs
[0]} = '';

294 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$¬cID
);

296 
	g$šadd_f
 .ğ','.
$vs
[0];

297 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

303 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

305 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

307 if(
	g$»dœeùu¾
!='' && !
´eg_m©ch
("#j#", 
$æag
))

309 
	g$æag
 = (
$æag
=='' ? 'j' : $flag.',j');

313 if(
´eg_m©ch
("#j#", 
$æag
)è
	g$ismake
 = -1;

315 
	g$qu”y
 = "INSERT INTO `#@__archives`(id,typeid,typeid2,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,

316 
cŞÜ
,
	gwr™”
,
	gsourû
,
	gl™pic
,
	gpubd©e
,
	g£ndd©e
,
	gmid
,
	gnÙpo¡
,
	gdesütiÚ
,
	gkeywÜds
,
	gf’ame
,
	gdutyadmš
,
	gweight
)

317 
VALUES
 ('$arcID','$typeid','$typeid2','$sortrank','$flag','$ismake','$channelid','$arcrank','$click','$money','$title','$shorttitle',

319 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

321 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

322 
	g$dsql
->
Execu‹NÚeQu”y
(" DELETE FROM `#@__arctiny` WHERE id='$arcID' ");

323 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨ `#@__¬chives` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

324 
ex™
();

328 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

329 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

330 if(
em±y
(
$addbË
))

332 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

333 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

334 
ShowMsg
("æ²¡æ‰¾åˆ°å½“å‰æ¨¡å‹[{$channelid}]çš„ä¸»è¡¨ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œï¼ã€‚","javascript:;");

335 
ex™
();

337 
	g$u£
 = 
G‘IP
();

338 
	g$qu”y
 = "INSERT INTO `$addtable`(aid,typeid,redirecturl,userip,pagestyle,maxwidth,imgurls,row,col,isrm,ddmaxwidth,pagepicnum,body{$inadd_f})

339 
V®ues
('$¬cID','$ty³id','$»dœeùu¾','$u£','$·ge¡yË','$maxwidth','$imgu¾s','$row','$cŞ','$i¤m','$ddmaxwidth','$·g•iúum','$body'{
$šadd_v
}); ";

340 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

342 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

343 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

344 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

345 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addbË}` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

346 
ex™
();

350 
In£¹Tags
(
$gs
,
$¬cID
);

351 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

353 if(
$£rv™”m
!=""){

354 
li¡
(
$£rvu¾
,
$£rvu£r
,
$£rvpwd
èğ
ex¶ode
(',',
$£rv™”m
);

355 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
, '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

357 
	g$cÚfig
=
¬¿y
();

359 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

361 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
, 
TRUE
, TRUE, 
$i¤emÙe
);

362 if(
	g$¬tU¾
=='')

364 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

366 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

368 
	g$msg
 = "

370 <
a
 
h»f
='®bum_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒå›¾ç‰‡</u></a>

371 &
nb¥
;&
	gnb¥
;

372 <
a
 
	gh»f
='¬chives_do.php?aid=".$¬cID."&dİo¡ód™Archives'><
u
>æ›´æ”¹æ–‡æ¡£</u></a>

373 &
nb¥
;&
	gnb¥
;

374 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆæ–‡æ¡£</u></a>

375 &
nb¥
;&
	gnb¥
;

376 <
a
 
	gh»f
='ÿlog_do.php?cid=$ty³id&dİo¡öi¡Archives'><
u
>å·²å‘å¸ƒå›¾ç‰‡ç®¡ç†</u></a>

377 &
nb¥
;&
	gnb¥
;

378 
	g$backu¾


380 
	g$msg
 = "<div styË=\"lše-height:36px;height:36px\">{$msg}</div>".
G‘Upd©eTe¡
();

382 
	g$wšt™Ë
 = "æˆåŠŸå‘å¸ƒä¸€ä¸ªæ–‡æ¡£ï¼";

383 
	g$wecome_šfo
 = "æ–‡ç« ç®¡ç†::å‘å¸ƒæ–‡æ¡£";

384 
	g$wš
 = 
Ãw
 
OxWšdow
();

385 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒä¸€ä¸ªæ–‡æ¡£ï¼š");

386 
	g$wš
->
AddMsgI‹m
(
$msg
);

387 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
FALSE
);

388 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\album_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('a_Edit,a_AccEdit,a_MyEdit');

9 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

10 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
!='save')

16 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

17 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

18 
CË¬MyAddÚ
();

19 
	g$aid
 = 
štv®
(
$aid
);

22 
	g$¬cQu”y
 = "SELECT ch.typename‡s channelname,ar.membername‡s„ankname,arc.*

23 
FROM
 `#@
__¬chives
` 
¬c


24 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl


25 
LEFT
 
JOIN
 `#@
__¬üªk
` 
¬
 
ON
‡r.
¿nk
=
¬c
.
¬üªk
 
WHERE
‡rc.
id
='$aid' ";

26 
$¬cRow
 = 
$dsql
->
G‘OÃ
(
$¬cQu”y
);

27 if(!
is_¬¿y
(
$¬cRow
))

29 
ShowMsg
("è¯»å–æ¡£æ¡ˆåŸºæœ¬ä¿¡æ¯å‡ºé”™!","-1");

30 
ex™
();

32 
	g$qu”y
 = "SELECT * FROM `#@__chªÃÉy³` WHERE id='".
$¬cRow
['channel']."'";

33 
	g$cInfos
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

34 if(!
is_¬¿y
(
$cInfos
))

36 
ShowMsg
("è¯»å–é¢‘é“é…ç½®ä¿¡æ¯å‡ºé”™!","javascript:;");

37 
ex™
();

39 
	g$addbË
 = 
$cInfos
['addtable'];

40 
	g$addRow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `$addtable` WHERE‡id='$aid'");

41 
	g$chªÃlid
 = 
$¬cRow
['channel'];

42 
	g$imgu¾s
 = 
$addRow
["imgurls"];

43 
	g$maxwidth
 = 
$addRow
["maxwidth"];

44 
	g$·ge¡yË
 = 
$addRow
["pagestyle"];

45 
	g$œow
 = 
$addRow
["row"];

46 
	g$icŞ
 = 
$addRow
["col"];

47 
	g$i¤m
 = 
$addRow
["isrm"];

48 
	g$body
 = 
$addRow
["body"];

49 
	g$ddmaxwidth
 = 
$addRow
["ddmaxwidth"];

50 
	g$·g•iúum
 = 
$addRow
["pagepicnum"];

51 
	g$gs
 = 
G‘Tags
(
$aid
);

52 
šşude
 
XAKINClude
("templets/album_edit.htm");

53 
ex™
();

58 if(
	g$dİo¡
=='save')

60 
»quœe_Úû
(
XAKINC
.'/image.func.php');

61 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

63 
	g$æag
 = 
is£t
(
$æags
è? 
još
(',', $flags) : '';

64 
	g$nÙpo¡
 = 
is£t
(
$nÙpo¡
) && $notpost == 1 ? 1: 0;

65 if(
em±y
(
$ty³id2
)è
	g$ty³id2
 = 0;

66 if(!
is£t
(
$autokey
)è
	g$autokey
 = 0;

67 if(!
is£t
(
$»mÙe
)è
	g$»mÙe
 = 0;

68 if(!
is£t
(
$d–lšk
)è
	g$d–lšk
 = 0;

69 if(!
is£t
(
$autŞ™pic
)è
	g$autŞ™pic
 = 0;

70 if(!
is£t
(
$fÜmhtml
)è
	g$fÜmhtml
 = 0;

71 if(!
is£t
(
$fÜmz
)è
	g$fÜmz
 = 0;

72 if(!
is£t
(
$ddisfœ¡
)è
	g$ddisfœ¡
 = 0;

73 if(!
is£t
(
$d–z
)è
	g$d–z
 = 0;

75 if(
	g$ty³id
==0)

77 
ShowMsg
("è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼","-1");

78 
ex™
();

80 if(
em±y
(
$chªÃlid
))

82 
ShowMsg
("æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼","-1");

83 
ex™
();

85 if(!
CheckChªÃl
(
$ty³id
,
$chªÃlid
))

87 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼","-1");

88 
ex™
();

90 if(!
Te¡Purv›w
('a_Edit'))

92 if(
Te¡Purv›w
('a_AccEdit'))

94 
CheckC©®og
(
$ty³id
,"å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æ–‡æ¡£æƒé™ï¼");

98 
CheckArcAdmš
(
$id
,
$cu£rLogš
->
g‘U£rID
());

103 
	g$ty³_·¿m
 = 
$dsql
->
G‘OÃ
("SELECT ddimg_width, ddimg_height FROM `#@__arctype` WHERE id ='$typeid'");

104 if(!
em±y
(
$ty³_·¿m
['ddimg_width'])){

105 
	g$cfg_ddimg_width
 = 
$ty³_·¿m
['ddimg_width'];

107 if(!
em±y
(
$ty³_·¿m
['ddimg_height'])){

108 
	g$cfg_ddimg_height
 = 
$ty³_·¿m
['ddimg_height'];

112 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

113 
	g$sÜŒªk
 = 
AddDay
(
$pubd©e
,
$sÜtup
);

114 
	g$ismake
 = 
$ishtml
==0 ? -1 : 0;

115 
	g$t™Ë
 = 
ú_sub¡rR
(
$t™Ë
,
$cfg_t™Ë_maxËn
);

116 
	g$shÜ‰™Ë
 = 
ú_sub¡rR
(
$shÜ‰™Ë
,36);

117 
	g$cŞÜ
 = 
ú_sub¡rR
(
$cŞÜ
,7);

118 
	g$wr™”
 = 
ú_sub¡rR
(
$wr™”
,20);

119 
	g$sourû
 = 
ú_sub¡rR
(
$sourû
,30);

120 
	g$desütiÚ
 = 
ú_sub¡rR
(
$desütiÚ
,250);

121 
	g$keywÜds
 = 
Œim
(
ú_sub¡rR
(
$keywÜds
,60));

122 
	g$f’ame
 = 
Œim
(
ú_sub¡rR
(
$f’ame
,40));

123 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

124 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

125 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck'))

127 
	g$¬üªk
 = -1;

129 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

132 if(
em±y
(
$ddi¤emÙe
))

134 
	g$ddi¤emÙe
 = 0;

136 
	g$l™pic
 = 
G‘DDImage
('nÚe', 
$piúame
, 
$ddi¤emÙe
);

139 if(
	g$ddisfœ¡
==1 && 
$l™pic
=='')

141 if(
is£t
(
$imgu¾1
))

143 
$l™pic
 = 
G‘DDImage
('ddfœ¡', 
$imgu¾1
, 
$i¤m
);

148 
	g$body
 = 
AÇly£HtmlBody
(
$body
, 
$desütiÚ
, 
$l™pic
, 
$keywÜds
, 'htmltext');

151 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

153 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

155 if(
	g$»dœeùu¾
!='' && !
´eg_m©ch
("#j#", 
$æag
))

157 
	g$æag
 = (
$æag
=='' ? 'j' : $flag.',j');

161 if(
´eg_m©ch
("#j#", 
$æag
)è
	g$ismake
 = -1;

164 
	g$qu”y
 = "

165 
UPDATE
 `#@
__¬chives
` 
SET


166 
ty³id
='$typeid',

167 
	gty³id2
='$typeid2',

168 
	gsÜŒªk
='$sortrank',

169 
	gæag
='$flag',

170 
	gşick
='$click',

171 
	gismake
='$ismake',

172 
	g¬üªk
='$arcrank',

173 
	gmÚey
='$money',

174 
	gt™Ë
='$title',

175 
	gcŞÜ
='$color',

176 
	gsourû
='$source',

177 
	gwr™”
='$writer',

178 
	gl™pic
='$litpic',

179 
	gpubd©e
='$pubdate',

180 
	gnÙpo¡
='$notpost',

181 
	gdesütiÚ
='$description',

182 
	gkeywÜds
='$keywords',

183 
	gshÜ‰™Ë
='$shorttitle',

184 
	gf’ame
='$filename',

185 
	gweight
='$weight',

186 
	gdutyadmš
='$adminid'

187 
WHERE
 
id
='$id'; ";

189 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

191 
ShowMsg
("æ›´æ–°æ•°æ®åº“¬chivesè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼".
$dsql
->
G‘E¼Ü
(),"javascript:;");

192 
ex™
();

195 
	g$imgu¾s
 = "{xak:pagestyle maxwidth='$maxwidth'…agepicnum='$pagepicnum' ddmaxwidth='$ddmaxwidth'„ow='$row' col='$col' value='$pagestyle'/}\r\n";

196 
	g$hasÚe
 = 
çl£
;

201 
	g$i
=1; $i<=120; $i++)

203 ifĞ!
is£t
(
$
{'imgu¾'.
$i
}) ) ;

204 
	g$šfo
 = '';

205 
	g$išfo
 = 
¡r_»¶aû
("'", "`", 
¡r¦ashes
(
$
{'imgmsg'.
$i
}));

206 
	g$iu¾
 = 
¡r¦ashes
(
$
{'imgu¾'.
$i
});

207 
	g$ddu¾
 = 
¡r¦ashes
(
$
{'imgddu¾'.
$i
});

208 if(
´eg_m©ch
("#swfu¶ßd#i", 
$ddu¾
)è
	g$ddu¾
 = '';

209 
	g$imgfe
 = 
$cfg_ba£dœ
.
$iu¾
;

210 
	g$l™imgfe
 = 
$cfg_ba£dœ
.
$ddu¾
;

212 ifĞ
is£t
(
$
{'imgfe'.
$i
}è&& 
is_u¶ßded_fe
(${'imgfile'.$i}) )

214 
	g$tmpFe
 = 
$
{'imgfe'.
$i
};

216 
	g$imgšfos
 = @
G‘ImageSize
(
$tmpFe
, 
$šfo
);

217 if(!
is_¬¿y
(
$imgšfos
))

219 
	g$imgšfos
 = @
G‘ImageSize
(
$imgfe
, 
$šfo
);

220 
	g$imgu¾s
 .ğ"{xak:img ddimg='$ddu¾'ext='$išfo' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

223 
move_u¶ßded_fe
(
$tmpFe
, 
$imgfe
);

224 
	g$imgšfos
 = @
G‘ImageSize
(
$imgfe
, 
$šfo
);

225 if(
	g$ddu¾
==
$iu¾
)

227 
$l™piúame
 = 
$·ge¡yË
 > 2 ? 
G‘ImageM­DD
(
$iu¾
, 
$cfg_ddimg_width
) : $iurl;

228 
	g$l™imgfe
 = 
$cfg_ba£dœ
.
$l™piúame
;

232 if(
	g$cfg_ddimg_fuÎ
=='Y'è
ImageResizeNew
(
$imgfe
, 
$cfg_ddimg_width
, 
$cfg_ddimg_height
, 
$l™imgfe
);

233 
ImageResize
(
$imgfe
, 
$cfg_ddimg_width
, 
$cfg_ddimg_height
, 
$l™imgfe
);

234 
	g$l™piúame
 = 
$ddu¾
;

236 
	g$imgu¾s
 .ğ"{xak:img ddimg='$l™piúame'ext='$išfo' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

241 
	g$išfo
 = 
¡r_»¶aû
("'", "`", 
¡r¦ashes
(
$
{'imgmsg'.
$i
}));

242 
	g$iu¾
 = 
¡r¦ashes
(
$
{'imgu¾'.
$i
});

243 
	g$ddu¾
 = 
¡r¦ashes
(
$
{'imgddu¾'.
$i
});

244 if(
´eg_m©ch
("#swfu¶ßd#i", 
$ddu¾
))

246 
	g$ddu¾
 = 
$·ge¡yË
 > 2 ? 
G‘ImageM­DD
(
$iu¾
, 
$cfg_ddimg_width
) : $iurl;

248 
	g$imgšfos
 = @
G‘ImageSize
(
$imgfe
, 
$šfo
);

249 
	g$imgu¾s
 .ğ"{xak:img ddimg='$ddu¾'ext='$išfo' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

258 if(
	g$fÜmz
==1)

260 
šşude_Úû
(
XAKINC
."/zip.class.php");

261 
šşude_Úû
(
XAKADMIN
."/file_class.php");

262 
	g$zfe
 = 
$cfg_ba£dœ
.
¡r_»¶aû
(
$cfg_mašs™e
,'',
$zfe
);

263 
	g$tmpzdœ
 = 
XAKDATA
.'/ztmp/'.
ú_sub¡r
(
md5
(
ExecTime
()),16);

264 
	g$Áime
 = 
time
();

265 if(
fe_exi¡s
(
$zfe
))

268 @
mkdœ
(
$tmpzdœ
,
$GLOBALS
['cfg_dir_purview']);

269 @
chmod
(
$tmpzdœ
,
$GLOBALS
['cfg_dir_purview']);

270 
	g$z
 = 
Ãw
 
z
();

271 
	g$z
->
ExŒaùAÎ
(
$zfe
,
$tmpzdœ
);

272 
	g$fm
 = 
Ãw
 
FeMªagem’t
();

273 
	g$imgs
 = 
¬¿y
();

274 
	g$fm
->
G‘M©chFes
(
$tmpzdœ
,"jpg|²g|gif",
$imgs
);

275 
	g$i
 = 0;

276 
fÜ—ch
(
$imgs
 
as
 
$imgŞd
)

278 
	g$i
++;

279 
	g$§v•©h
 = 
$cfg_image_dœ
."/".
MyD©e
("Y-m",
$Áime
);

280 
C»©eDœ
(
$§v•©h
);

281 
	g$iu¾
 = 
$§v•©h
."/".
MyD©e
("d",
$Áime
).
dd2ch¬
(MyD©e("His",$Áime).'-'.
$admšid
."-{$i}".
mt_¿nd
(1000,9999));

282 
	g$iu¾
 = 
$iu¾
.
sub¡r
(
$imgŞd
,-4,4);

283 
	g$imgfe
 = 
$cfg_ba£dœ
.
$iu¾
;

284 
cİy
(
$imgŞd
,
$imgfe
);

285 
uÆšk
(
$imgŞd
);

286 if(
is_fe
(
$imgfe
))

288 
	g$l™piúame
 = 
$·ge¡yË
 > 2 ? 
G‘ImageM­DD
(
$iu¾
,
$cfg_ddimg_width
) : $iurl;

289 
	g$šfo
 = '';

290 
	g$imgšfos
 = 
G‘ImageSize
(
$imgfe
,
$šfo
);

291 
	g$imgu¾s
 .ğ"{xak:img ddimg='$l™piúame'ext='' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

294 
	g$šqu”y
 = "

295 
INSERT
 
INTO
 #@
__u¶ßds
(
t™Ë
,
u¾
,
medŸty³
,
width
,
height
,
¶aytime
,
fesize
,
u±ime
,
mid
)

296 
VALUES
 ('{$title}','{$iurl}','1','".$imginfos[0]."','".$imginfos[1]."','0','".filesize($imgfile)."','".$ntime."','$adminid');

298 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

299 if(!
	g$hasÚe
 && 
	g$ddisfœ¡
==1 && 
$l™pic
=="" && !
em±y
(
$l™piúame
))

301 ifĞ
fe_exi¡s
(
$cfg_ba£dœ
.
$l™piúame
) )

303 
$l™pic
 = 
$l™piúame
;

304 
	g$hasÚe
 = 
Œue
;

309 if(
	g$d–z
==1)

311 
uÆšk
(
$zfe
);

313 
	g$fm
->
RmDœFes
(
$tmpzdœ
);

320 if(
is_¬¿y
(
$_SESSION
['bigfile_info']))

322 
fÜ—ch
(
$_SESSION
['bigfe_šfo'] 
as
 
$k
=>
$v
)

324 
$Œuefe
 = 
$cfg_ba£dœ
.
$v
;

325 if(
¡¾’
(
$v
)<2 || !
fe_exi¡s
(
$Œuefe
)) ;

326 
	g$šfo
 = '';

327 
	g$imgšfos
 = 
G‘ImageSize
(
$Œuefe
, 
$šfo
);

328 
	g$l™piúame
 = 
$·ge¡yË
 > 2 ? 
G‘ImageM­DD
(
$v
, 
$cfg_ddimg_width
) : $v;

329 
	g$imgšfo
 = !
em±y
(
$
{'picšfook'.
$k
}) ? ${'picinfook'.$k} : '';

330 
	g$imgu¾s
 .ğ"{xak:img ddimg='$l™piúame'ext='$imgšfo' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $v {/xak:img}\r\n";

334 
	g$imgu¾s
 = 
add¦ashes
(
$imgu¾s
);

337 
	g$šadd_f
 = '';

338 
	g$šadd_v
 = '';

339 if(!
em±y
(
$xak_addÚf›lds
))

341 
	g$addÚf›lds
 = 
ex¶ode
(';', 
$xak_addÚf›lds
);

342 
	g$šadd_f
 = '';

343 
	g$šadd_v
 = '';

344 if(
is_¬¿y
(
$addÚf›lds
))

346 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

348 if(
	g$v
=='')

352 
	g$vs
 = 
ex¶ode
(',',
$v
);

353 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

355 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

357 if(!
is£t
(
$
{
$vs
[0]}))

359 
	g$
{
	g$vs
[0]} = '';

361 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$id
);

363 
	g$šadd_f
 .ğ",`{$vs[0]}` = '".
$
{
$vs
[0]}."'";

369 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

370 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

371 if(
	g$addbË
!='')

373 
$u£
 = 
G‘IP
();

374 
	g$qu”y
 = "Update `$addtable`

375 
£t
 
ty³id
='$typeid',

376 
	g·ge¡yË
='$pagestyle',

377 
	gbody
='$body',

378 
	gmaxwidth
 = '$maxwidth',

379 
	gddmaxwidth
 = '$ddmaxwidth',

380 
	g·g•iúum
 = '$pagepicnum',

381 
	gimgu¾s
='$imgurls',

382 
	grow
='$row',

383 
	gcŞ
='$col',

384 
	gi¤m
='$i¤m'{
$šadd_f
},

385 
	g»dœeùu¾
='$redirecturl',

386 
	gu£r
 = '$useip'

387 
WHERE
 
aid
='$id'; ";

388 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

390 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addbË` æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥åŸå› ï¼".
$dsql
->
G‘E¼Ü
(),"javascript:;");

391 
ex™
();

396 
UpIndexKey
(
$id
,
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$gs
);

397 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

399 if(
$£rv™”m
!=""){

400 
li¡
(
$£rvu¾
,
$£rvu£r
,
$£rvpwd
èğ
ex¶ode
(',',
$£rv™”m
);

401 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
, '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

403 
	g$cÚfig
=
¬¿y
();

405 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

407 
	g$¬cU¾
 = 
MakeA¹
(
$id
,
Œue
,Œue,
$i¤emÙe
);

408 if(
	g$¬cU¾
=='')

410 
$¬cU¾
 = 
$cfg_phpu¾
."/view.php?aid=$id";

412 
CË¬MyAddÚ
(
$id
, 
$t™Ë
);

414 
	g$msg
 =

416 <
a
 
h»f
='®bum_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒå›¾ç‰‡</u></a>

417 &
nb¥
;&
	gnb¥
;

418 <
a
 
	gh»f
='¬chives_do.php?aid=".$id."&dİo¡ód™Archives'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

419 &
nb¥
;&
	gnb¥
;

420 <
a
 
	gh»f
='$¬cU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆæ–‡æ¡£</u></a>

421 &
nb¥
;&
	gnb¥
;

422 <
a
 
	gh»f
='ÿlog_do.php?cid=$ty³id&dİo¡öi¡Archives'><
u
>ç®¡ç†å·²å‘å¸ƒå›¾ç‰‡</u></a>

423 &
nb¥
;&
	gnb¥
;

424 
	g$backu¾


427 
	g$wšt™Ë
 = "æˆåŠŸæ›´æ”¹å›¾é›†ï¼";

428 
	g$wecome_šfo
 = "æ–‡ç« ç®¡ç†::æ›´æ”¹å›¾é›†";

429 
	g$wš
 = 
Ãw
 
OxWšdow
();

430 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªå›¾é›†ï¼š");

431 
	g$wš
->
AddMsgI‹m
(
$msg
);

432 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

433 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\album_testhtml.php

1 <?
php


8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

9 
AjaxH—d
();

10 
	g$myhtml
 = 
UnicodeU¾2Gbk
(
¡r¦ashes
(
$myhtml
));

11 
	gecho
 "<div class='coolbg61'>[<a href='#' onclick='javascript:HideObj(\"_myhtml\")'>å…³é—­</a>]</div>\r\n";

12 
´eg_m©ch_®l
("/(¤c|SRC)=[\"|'| ]{0,}(h‰p:\/\/(.*)\.(gif|jpg|j³g|²g))/isU", 
$myhtml
, 
$img_¬¿y
);

13 
	g$img_¬¿y
 = 
¬¿y_unique
(
$img_¬¿y
[2]);

14 
	gecho
 "<div class='coolbg62'><xmp>";

15 
	gecho
 "æ•è·çš„å›¾ç‰‡ï¼š\r\n";

16 
´št_r
(
$img_¬¿y
);

17 
	gecho
 "</xmp></div>\r\n";

	@E:\web\weixun\xakadmin\api_ucenter.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

3 
CheckPurv›w
('api_ucenter');

4 if(!
funùiÚ_exi¡s
('fe_put_cÚ‹Ás')){ 
funùiÚ
 
fe_put_cÚ‹Ás
(
$f’ame
, 
$s
)

6 
	g$å
 = @
fİ’
(
$f’ame
, 'w');

7 @
fwr™e
(
$å
, 
$s
);

8 @
fşo£
(
$å
);

9  
	gTRUE
;

11 
»quœe_Úû
(
XAKINC
.'/xaktemplate.class.php');

12 if(
fe_exi¡s
(
XAKROOT
.'/uc_client/client.php'))

14 if(!
defšed
('UC_API')è
defše
('UC_API', '');

15 
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php';

19 
ShowMsg
('è¯·å®‰è£…UCenteræ¨¡å—!',-1);

20 
ex™
();

23 
	g$dİo¡
 = 
­i_gpc
('dopost','R');

25 
	g$uc
 = 
Ãw
 
­i_uûÁ”
(
$dİo¡
);

27 şas 
	c­i_uûÁ”


29 
v¬
 
	m$aùiÚ
;

30 
v¬
 
	m$d
;

31 
v¬
 
	m$cÚfig
;

34 
funùiÚ
 
__cÚ¡ruù
(
$ac
 = '')

36 
$aùiÚ
 = 'uc_'.(
em±y
(
$ac
)||(!
š_¬¿y
($ac,
¬¿y
('š¡®l','ed™'))è? 'show' : 
Œim
($ac));

37 
	m$this
->
	md
 = 
Ãw
 
XakTem¶©e
();

38 
	m$this
->
	mcÚfig
 = 
XAKINC
.'/common.inc.php';

39 
	m$this
->
$aùiÚ
();

43 
funùiÚ
 
­i_uûÁ”
(
$ac
 = '')

45 
$this
->
__cÚ¡ruù
(
$ac
);

48 
funùiÚ
 
	$uc_š¡®l
()

50 
$uc_£tšgs
 = 
	`­i_gpc
('uc_setings','P');

52 if(!
	`is£t
(
$uc_£tšgs
['authkey']è|| 
	`em±y
($uc_setings['authkey']))

54 
	`ShowMsg
('è¯·å¡«å†™ucåˆ›å§‹äººå¯†ç !',-1);

55 
	`ex™
();

58 
$uc_£tšgs
['uÿpi'] = 
	`´eg_»¶aû
("/\/$/", '', 
	`Œim
($uc_setings['ucapi']));

60 if(
	`em±y
(
$uc_£tšgs
['uÿpi']è|| !
	`´eg_m©ch
("/^(http:\/\/)/i", $uc_setings['ucapi']))

62 
	`ShowMsg
('è¯·å¡«æ­£ç¡®çš„æœåŠ¡ç«¯åœ°å€ä»¥http://å¼€å¤´!',-1);

63 
	`ex™
();

67 if(!
$uc_£tšgs
['ucip'])

69 
$‹mp
 = @
	`·r£_u¾
(
$uc_£tšgs
['ucapi']);

70 
$uc_£tšgs
['uÿpi'] = 
	`g‘ho¡byÇme
(
$‹mp
['host']);

71 if(
	`2lÚg
(
$uc_£tšgs
['uÿpi']è=ğ-1 || ip2lÚg($uc_£tšgs['uÿpi']è==ğ
FALSE
)

73 
$uc_£tšgs
['ucip'] = '127.0.0.1';

78 
$ucšfo
 = 
	`­i_fİ’
(
$uc_£tšgs
['ucapi'].'/index.php?m=app&a=ucinfo', 500, '', '', 1, $uc_setings['ucip']);

80 
	`li¡
(
$¡©us
, 
$ucv”siÚ
, 
$uü–—£
, 
$ucch¬£t
, 
$ucdbch¬£t
, 
$­±y³s
èğ
	`ex¶ode
('|', 
$ucšfo
);

82 if(
$¡©us
 != 'UC_STATUS_OK')

84 
	`ShowMsg
('ucæœåŠ¡ç«¯åœ°å€æ— æ•ˆ,è¯·ä»”ç»†æ£€æŸ¥æ‚¨å®‰è£…çš„ucæœåŠ¡ç«¯åœ°å€!',-1);

85 
	`ex™
();

89 
$ucdbch¬£t
 = 
	`¡¹Şow”
($ucdbch¬£ˆ? 
	`¡r_»¶aû
('-', '', $ucdbcharset) : $ucdbcharset);

90 if(
UC_CLIENT_VERSION
 > 
$ucv”siÚ
)

92 
	`ShowMsg
('ucæœåŠ¡ç«¯ç‰ˆæœ¬ä¸ä¸€è‡´,æ‚¨å½“å‰çš„ucå®¢æœç«¯ç‰ˆæœ¬ä¸º:'.
UC_CLIENT_VERSION
.',è€ŒæœåŠ¡ç«¯ç‰ˆæœ¬ä¸º:'.
$ucv”siÚ
.'!',-1);

93 
	`ex™
();

95 
	`–£if
(
$ucdbch¬£t
 != 'gbk')

97 
	`ShowMsg
('ucæœåŠ¡ç«¯ç¼–ç ä¸ç³»ç»Ÿç¼–ç ä¸ä¸€è‡´!è¦æ±‚æ‚¨çš„ucæœåŠ¡ç«¯ç¼–ç ä¸º:gbkç¼–ç .',-1);

98 
	`ex™
();

101 
$­p_g‹m¶©es
 = '­±ag‹m¶©es[‹m¶©e]='.
	`u¾’code
('<a href="{url}"arget="_blank">{title}</a>').'&'.

102 '­±ag‹m¶©es[f›lds][t™Ë]='.
	`u¾’code
('æ ‡é¢˜').'&'.

103 '­±ag‹m¶©es[f›lds][wr™”]='.
	`u¾’code
('ä½œè€…').'&'.

104 '­±ag‹m¶©es[f›lds][pubd©e]='.
	`u¾’code
('æ—¶é—´').'&'.

105 '­±ag‹m¶©es[f›lds][u¾]='.
	`u¾’code
('åœ°å€');

107 
$po¡d©a
 = 'm÷µ&a÷dd&ucfound”=&ucfound”pw='.
	`u¾’code
(
$uc_£tšgs
['authkey']).'&­±y³=OTHER&­²ame='.u¾’code(
$GLOBALS
['cfg_webÇme']).'&­pu¾='.u¾’code($GLOBALS['cfg_ba£ho¡']).'&­p=&­pch¬£t=gbk&­pdbch¬£t=gbk&'.
$­p_g‹m¶©es
.'&»Ëa£='.
UC_CLIENT_RELEASE
;

109 
$uccÚfig
 = 
	`­i_fİ’
(
$uc_£tšgs
['uÿpi'].'/šdex.php', 500, 
$po¡d©a
, '', 1, $uc_setings['ucip']);

111 if(
	`¡r¡r
(
$uccÚfig
,'<?xml'))

113 
$‹mp
 = 
	`ex¶ode
('<?xml', 
$uccÚfig
);

114 
$uccÚfig
 = 
$‹mp
[0]; 
	`un£t
($temp);

117 if(
	`em±y
(
$uccÚfig
))

119 
	`ShowMsg
('è¯·å¡«å†™æœ‰æ•ˆçš„é…ç½®ä¿¡æ¯!',-1);

120 
	`ex™
();

122 
	`–£if
(
$uccÚfig
 == '-1')

124 
	`ShowMsg
('åˆ›å§‹äººå¯†ç é”™è¯¯!',-1);

125 
	`ex™
();

129 
	`li¡
(
$­·uthkey
, 
$­pid
èğ
	`ex¶ode
('|', 
$uccÚfig
);

130 if(
	`em±y
(
$­·uthkey
è||ƒm±y(
$­pid
))

132 
	`ShowMsg
('æ•°æ®è·å–å¤±è´¥!',-1);

133 
	`ex™
();

135 
	`–£if
(
$sucûed
 = 
	`­i_wr™e_cÚfig
(
$uccÚfig
."|".
$uc_£tšgs
['uÿpi']."|".$uc_£tšgs['uc'], 
$this
->
cÚfig
))

137 
	`ShowMsg
('å®‰è£…æˆåŠŸ!',-1);

138 
	`ex™
();

142 
	`ShowMsg
('å†™å…¥é…ç½®æ•°æ®å¤±è´¥!'.
$this
->
cÚfig
.' è¯·è®¾ç½®å¯å†™æƒé™!',-1);

143 
	`ex™
();

147 
	}
}

149 
funùiÚ
 
	$uc_ed™
()

151 
$uc_£tšgs
 = 
	`­i_gpc
('uc_setings','P');

152 
$uc_db·ss
 = 
$uc_£tšgs
['db·ss'] =ğ'********' ? 
UC_DBPW
 : $uc_setings['dbpass'];

153 
$å
 = 
	`fİ’
(
$this
->
cÚfig
, 'r');

154 
$cÚ‹Á
 = 
	`ä—d
(
$å
, 
	`fesize
(
$this
->
cÚfig
));

155 
$cÚ‹Á
 = 
	`Œim
($content);

156 
$cÚ‹Á
 = 
	`sub¡r
($content, -2) == '?>' ? substr($content, 0, -2) : $content;

157 
$cÚ‹Á
 = 
	`¡r¡r
($cÚ‹Á, '_|cfg_|GLOBALS'è? 
	`¡r_»¶aû
('_|cfg_|GLOBALS','cfg_|GLOBALS',$content) : $content;

158 
	`fşo£
(
$å
);

160 
$cÚÃù
 = '';

161 if(
$uc_£tšgs
['connect'])

163 
$uc_dblšk
 = @
	`mysql_cÚÃù
(
$uc_£tšgs
['dbho¡'], $uc_£tšgs['dbu£r'], 
$uc_db·ss
, 1);

164 if(!
$uc_dblšk
)

166 
	`ShowMsg
('æ•°æ®åº“è¿æ¥å¤±è´¥!',-1);

167 
	`ex™
();

169 
	`mysql_şo£
(
$uc_dblšk
);

172 
$cÚÃù
 = 'mysql';

173 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_DBHOST',\s*'.*?'\);/i", "defše('UC_DBHOST', '".
$uc_£tšgs
['dbhost']."');");

174 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_DBUSER',\s*'.*?'\);/i", "defše('UC_DBUSER', '".
$uc_£tšgs
['dbuser']."');");

175 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_DBPW',\s*'.*?'\);/i", "defše('UC_DBPW', '".
$uc_db·ss
."');");

176 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_DBNAME',\s*'.*?'\);/i", "defše('UC_DBNAME', '".
$uc_£tšgs
['dbname']."');");

177 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_DBTABLEPRE',\s*'.*?'\);/i", "defše('UC_DBTABLEPRE', '`".
$uc_£tšgs
['dbname'].'`.'.$uc_setings['dbtablepre']."');");

180 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_CONNECT',\s*'.*?'\);/i", "define('UC_CONNECT', '$connect');");

181 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_KEY',\s*'.*?'\);/i", "defše('UC_KEY', '".
$uc_£tšgs
['authkey']."');");

182 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_API',\s*'.*?'\);/i", "defše('UC_API', '".
$uc_£tšgs
['ucapi']."');");

183 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_IP',\s*'.*?'\);/i", "defše('UC_IP', '".
$uc_£tšgs
['ucip']."');");

184 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($cÚ‹Á, "/defše\('UC_APPID',\s*'?.*?'?\);/i", "defše('UC_APPID', '".
UC_APPID
."');");

185 
$cÚ‹Á
 .= '?>';

187 if(
$å
 = @
	`fİ’
(
$this
->
cÚfig
, 'w'))

189 @
	`fwr™e
(
$å
, 
	`Œim
(
$cÚ‹Á
));

190 @
	`fşo£
(
$å
);

191 
	`ShowMsg
('é…ç½®å·²ç»æ›´æ”¹!',-1);

192 
	`ex™
();

194 
	`ShowMsg
('å†™å…¥é…ç½®æ•°æ®å¤±è´¥!'.
$this
->
cÚfig
.' è¯·è®¾ç½®å¯å†™æƒé™!',-1);

195 
	`ex™
();

197 
	}
}

199 
funùiÚ
 
	$uc_show
()

201 
$this
->
d
->
	`Assign
('uc_cÚfig_fe',$this->
cÚfig
);

203 if(!
	`defšed
('UC_APPID'))

205 
$this
->
d
->
	`LßdTem¶©e
(
XAKADMIN
.'/templets/api_ucenter_install.htm');

209 
$uc_­i_İ’
 = 
çl£
;

210 
$uÿµ¬¿y
 = 
	`uc_­p_ls
();

211 
	`fÜ—ch
(
$uÿµ¬¿y
 
as
 
$­·¼ay
)

213 if(
$­·¼ay
['­pid'] =ğ
UC_APPID
)

215 
$uc_­i_İ’
 = 
Œue
;

220 if(!
$uc_­i_İ’
)

222 
	`ShowMsg
("ç³»ç»Ÿæ²¡æ‰¾åˆ°æ­£ç¡®çš„ucé…ç½®ï¼",-1);

223 
	`ex™
();

227 
	`li¡
(
$dbÇme
,
$dbbË´e
èğ
	`ex¶ode
('.',
	`¡r_»¶aû
('`','',
UC_DBTABLEPRE
));

228 
$uc_£tšgs
 = 
	`¬¿y
('­pid' => 
UC_APPID
, 'uÿpi' => 
UC_API
, 'cÚÃù' => 
UC_CONNECT
, 'dbho¡' => 
UC_DBHOST
, 'dbu£r' => 
UC_DBUSER
,'db·ss' => 
UC_DBPW
, 'dbÇme' => 
$dbÇme
, 'dbbË´e' => 
$dbbË´e
,'uc' => 
UC_IP
,'authkey' => 
UC_KEY
);

230 
$this
->
d
->
	`Assign
('uc_£tšgs',
$uc_£tšgs
);

231 
$this
->
d
->
	`LßdTem¶©e
(
XAKADMIN
.'/templets/api_ucenter_edit.htm');

233 
$this
->
d
->
	`Di¥Ïy
();

234 
	`ex™
();

235 
	}
}

240 
funùiÚ
 
­i_fİ’
(
$u¾
, 
$lim™
 = 0, 
$po¡
 = '', 
$cook›
 = '', 
$bysock‘
 = 
FALSE
, 
$
 = '', 
$timeout
 = 15, 
$block
 = 
TRUE
)

242 
$»tuº
 = '';

243 
	g$m©ches
 = 
·r£_u¾
(
$u¾
);

244 
	g$ho¡
 = 
$m©ches
['host'];

245 
	g$·th
 = 
$m©ches
['path'] ? $matches['path'].($matches['query'] ? '?'.$matches['query'] : '') : '/';

246 
	g$pÜt
 = !
em±y
(
$m©ches
['port']) ? $matches['port'] : 80;

247 if(
	g$po¡
)

249 
	g$out
 = "POST $path HTTP/1.0\r\n";

250 
	g$out
 .= "Accept: */*\r\n";

252 
	g$out
 .= "Accept-Language: zh-cn\r\n";

253 
	g$out
 .= "Content-Type:‡pplication/x-www-form-urlencoded\r\n";

254 
	g$out
 .= "User-Agent: $_SERVER[HTTP_USER_AGENT]\r\n";

255 
	g$out
 .= "Host: $host\r\n";

256 
	g$out
 .ğ'CÚ‹Á-L’gth: '.
¡¾’
(
$po¡
)."\r\n";

257 
	g$out
 .= "Connection: Close\r\n";

258 
	g$out
 .= "Cache-Control:‚o-cache\r\n";

259 
	g$out
 .= "Cookie: $cookie\r\n\r\n";

260 
	g$out
 .ğ
$po¡
;

262 
	g$out
 = "GET $path HTTP/1.0\r\n";

263 
	g$out
 .= "Accept: */*\r\n";

265 
	g$out
 .= "Accept-Language: zh-cn\r\n";

266 
	g$out
 .= "User-Agent: $_SERVER[HTTP_USER_AGENT]\r\n";

267 
	g$out
 .= "Host: $host\r\n";

268 
	g$out
 .= "Connection: Close\r\n";

269 
	g$out
 .= "Cookie: $cookie\r\n\r\n";

272 
	g$å
 = @
fsockİ’
((
$ho¡
 ? $ho¡ : 
$
), 
$pÜt
, 
$”ºo
, 
$”r¡r
, 
$timeout
);

273 if(!
	g$å
)

277 
¡»am_£t_blockšg
(
$å
, 
$block
);

278 
¡»am_£t_timeout
(
$å
, 
$timeout
);

279 @
fwr™e
(
$å
, 
$out
);

280 
	g$¡©us
 = 
¡»am_g‘_m‘a_d©a
(
$å
);

281 if(!
	g$¡©us
['timed_out'])

283 !
ãof
(
$å
))

285 if((
	g$h—d”
 = @
fg‘s
(
$å
)è&& (
$h—d”
 == "\r\n" || $header == "\n"))

291 
	g$¡İ
 = 
çl£
;

292 !
ãof
(
$å
è&& !
	g$¡İ
)

294 
	g$d©a
 = 
ä—d
(
$å
, (
$lim™
 == 0 || $limit > 8192 ? 8192 : $limit));

295 
	g$»tuº
 .ğ
$d©a
;

296 if(
	g$lim™
)

298 
	g$lim™
 -ğ
¡¾’
(
$d©a
);

299 
	g$¡İ
 = 
$lim™
 <= 0;

303 @
fşo£
(
$å
);

304  
	g$»tuº
;

308 
funùiÚ
 
	$­i_wr™e_cÚfig
(
$cÚfig
, 
$fe
)

310 
$sucûss
 = 
çl£
;

311 
	`li¡
(
$­·uthkey
, 
$­pid
, 
$ucdbho¡
, 
$ucdbÇme
, 
$ucdbu£r
, 
$ucdbpw
, 
$ucdbch¬£t
, 
$uùabË´e
, 
$ucch¬£t
, 
$uÿpi
, 
$uc
èğ
	`ex¶ode
('|', 
$cÚfig
);

313 if(
$cÚ‹Á
 = 
	`fe_g‘_cÚ‹Ás
(
$fe
))

315 
$cÚ‹Á
 = 
	`Œim
($content);

316 
$cÚ‹Á
 = 
	`sub¡r
($content, -2) == '?>' ? substr($content, 0, -2) : $content;

317 
$cÚ‹Á
 = 
	`¡r¡r
($cÚ‹Á, '_|cfg_|GLOBALS'è? 
	`¡r_»¶aû
('_|cfg_|GLOBALS','cfg_|GLOBALS',$content) : $content;

318 
$lšk
 = 
	`mysql_cÚÃù
(
$ucdbho¡
, 
$ucdbu£r
, 
$ucdbpw
, 1);

319 
$uc_cÚÂeù
 = 
$lšk
 && 
	`mysql_£Ëù_db
(
$ucdbÇme
, $link) ? 'mysql' : '';

320 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_CONNECT',\s*'.*?'\);/i", "define('UC_CONNECT', '$uc_connnect');");

321 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_DBHOST',\s*'.*?'\);/i", "define('UC_DBHOST', '$ucdbhost');");

322 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_DBUSER',\s*'.*?'\);/i", "define('UC_DBUSER', '$ucdbuser');");

323 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_DBPW',\s*'.*?'\);/i", "define('UC_DBPW', '$ucdbpw');");

324 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_DBNAME',\s*'.*?'\);/i", "define('UC_DBNAME', '$ucdbname');");

325 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_DBCHARSET',\s*'.*?'\);/i", "define('UC_DBCHARSET', '$ucdbcharset');");

326 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_DBTABLEPRE',\s*'.*?'\);/i", "define('UC_DBTABLEPRE', '`$ucdbname`.$uctablepre');");

327 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_DBCONNECT',\s*'.*?'\);/i", "define('UC_DBCONNECT', '0');");

328 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_KEY',\s*'.*?'\);/i", "define('UC_KEY', '$appauthkey');");

329 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_API',\s*'.*?'\);/i", "define('UC_API', '$ucapi');");

330 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_CHARSET',\s*'.*?'\);/i", "define('UC_CHARSET', '$uccharset');");

331 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_IP',\s*'.*?'\);/i", "define('UC_IP', '$ucip');");

332 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_APPID',\s*'?.*?'?\);/i", "define('UC_APPID', '$appid');");

333 
$cÚ‹Á
 = 
	`­i_š£¹_cÚfig
($content, "/define\('UC_PPP',\s*'?.*?'?\);/i", "define('UC_PPP', '20');");

334 
$cÚ‹Á
 .= "\r\n".'?>';

336 if(@
	`fe_put_cÚ‹Ás
(
$fe
, 
$cÚ‹Á
))

338 
$sucûss
 = 
Œue
;

341  
$sucûss
;

342 
	}
}

344 
funùiÚ
 
	$­i_š£¹_cÚfig
(
$s
, 
$fšd
, 
$»¶aû
)

346 if(
	`´eg_m©ch
(
$fšd
, 
$s
))

348 
$s
 = 
	`´eg_»¶aû
(
$fšd
, 
$»¶aû
, $s);

351 
$s
 .ğ"\r\n".
$»¶aû
;

353  
$s
;

354 
	}
}

356 
funùiÚ
 
­i_gpc
(
$k
, 
$v¬
='R')

358 
$v¬
)

360 'G': 
$v¬
 = &
$_GET
; ;

361 'P': 
$v¬
 = &
$_POST
; ;

362 'C': 
$v¬
 = &
$_COOKIE
; ;

363 'R': 
$v¬
 = &
$_REQUEST
; ;

365  
is£t
(
$v¬
[
$k
]è? 
	g$v¬
[$k] : 
NULL
;

368 if(!
funùiÚ_exi¡s
('fe_put_cÚ‹Ás')){ 
funùiÚ
 
fe_put_cÚ‹Ás
(
$f’ame
, 
$s
)

370 
	g$å
 = @
fİ’
(
$f’ame
, 'w');

371 @
fwr™e
(
$å
, 
$s
);

372 @
fşo£
(
$å
);

373  
	gTRUE
;

	@E:\web\weixun\xakadmin\archives_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('a_New,a_AccNew');

9 
»quœe_Úû
(
XAKINC
.'/customfields.func.php');

10 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
 != 'save')

16 
»quœe_Úû
(
XAKINC
.'/xaktag.class.php');

17 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_catalog_options.php');

18 
CË¬MyAddÚ
();

19 
	g$chªÃlid
 = 
em±y
(
$chªÃlid
è? 0 : 
štv®
($channelid);

20 
	g$cid
 = 
em±y
(
$cid
è? 0 : 
štv®
($cid);

23 if(
	g$cid
 > 0 && 
	g$chªÃlid
 == 0)

25 
$row
 = 
$dsql
->
G‘OÃ
("SELECT channeltype FROM `#@__arctype` WHERE id='$cid'; ");

26 
	g$chªÃlid
 = 
$row
['channeltype'];

30 if(
	g$chªÃlid
==0)

32 
ShowMsg
('æ— æ³•è¯†åˆ«æ¨¡å‹ä¿¡æ¯ï¼Œå› æ­¤æ— æ³•æ“ä½œï¼', '-1');

33 
ex™
();

38 
	g$cInfos
 = 
$dsql
->
G‘OÃ
(" SELECT * FROM `#@__channeltype` WHERE id='$channelid' ");

39 
	g$chªÃlid
 = 
$cInfos
['id'];

41 
	g$maxWright
 = 
$dsql
->
G‘OÃ
("SELECT id+1 AS cc FROM #@__archives ORDER BY id DESC");

42 
šşude
 
XAKINClude
('templets/archives_add.htm');

43 
ex™
();

48 if(
	g$dİo¡
=='save')

50 
»quœe_Úû
(
XAKINC
.'/image.func.php');

51 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

53 
	g$æag
 = 
is£t
(
$æags
è? 
još
(',',$flags) : '';

54 
	g$nÙpo¡
 = 
is£t
(
$nÙpo¡
) && $notpost == 1 ? 1: 0;

55 if(
em±y
(
$şick
)è
	g$şick
 = (
$cfg_¬c_şick
=='-1' ? 
mt_¿nd
(50, 200) : $cfg_arc_click);

57 if(
em±y
(
$ty³id2
)è
	g$ty³id2
 = 0;

58 if(!
is£t
(
$autokey
)è
	g$autokey
 = 0;

59 if(!
is£t
(
$»mÙe
)è
	g$»mÙe
 = 0;

60 if(!
is£t
(
$d–lšk
)è
	g$d–lšk
 = 0;

61 if(!
is£t
(
$autŞ™pic
)è
	g$autŞ™pic
 = 0;

62 if(
em±y
(
$şick
)è
	g$şick
 = (
$cfg_¬c_şick
=='-1' ? 
mt_¿nd
(50, 200) : $cfg_arc_click);

64 if(
	g$ty³id
==0)

66 
ShowMsg
('è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼', '-1');

67 
ex™
();

69 if(
em±y
(
$chªÃlid
))

71 
ShowMsg
('æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼', '-1');

72 
ex™
();

74 if(!
CheckChªÃl
(
$ty³id
,
$chªÃlid
) )

76 
ShowMsg
('ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼', '-1');

77 
ex™
();

79 if(!
Te¡Purv›w
('a_New'))

81 
CheckC©®og
(
$ty³id
, "å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æƒé™ï¼");

85 
	g$ty³_·¿m
 = 
$dsql
->
G‘OÃ
("SELECT ddimg_width, ddimg_height FROM `#@__arctype` WHERE id ='$typeid'");

86 if(!
em±y
(
$ty³_·¿m
['ddimg_width'])){

87 
	g$cfg_ddimg_width
 = 
$ty³_·¿m
['ddimg_width'];

89 if(!
em±y
(
$ty³_·¿m
['ddimg_height'])){

90 
	g$cfg_ddimg_height
 = 
$ty³_·¿m
['ddimg_height'];

94 if(
em±y
(
$wr™”
)è
	g$wr™”
 = 
$cu£rLogš
->
g‘U£rName
();

95 if(
em±y
(
$sourû
)è
	g$sourû
 = 'æœªçŸ¥';

96 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

97 
	g$£ndd©e
 = 
time
();

98 
	g$sÜŒªk
 = 
AddDay
(
$pubd©e
,
$sÜtup
);

99 
	g$ismake
 = 
$ishtml
 == 0 ? -1 : 0;

100 
	g$t™Ë
 = 
´eg_»¶aû
("#\"#", 'ï¼‚', 
$t™Ë
);

101 
	g$t™Ë
 = 
ú_sub¡rR
(
$t™Ë
,
$cfg_t™Ë_maxËn
);

102 
	g$shÜ‰™Ë
 = 
ú_sub¡rR
(
$shÜ‰™Ë
,36);

103 
	g$cŞÜ
 = 
ú_sub¡rR
(
$cŞÜ
,7);

104 
	g$wr™”
 = 
ú_sub¡rR
(
$wr™”
,20);

105 
	g$sourû
 = 
ú_sub¡rR
(
$sourû
,30);

106 
	g$desütiÚ
 = 
ú_sub¡rR
(
$desütiÚ
,
$cfg_auÙ_desütiÚ
);

107 
	g$keywÜds
 = 
ú_sub¡rR
(
$keywÜds
,60);

108 
	g$f’ame
 = 
Œim
(
ú_sub¡rR
(
$f’ame
,40));

109 
	g$u£r
 = 
G‘IP
();

110 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

111 
	g$vÙeid
 = (
em±y
(
$vÙeid
)? 0 : $voteid);

112 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

113 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck'))

115 
	g$¬üªk
 = -1;

117 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

120 if(
em±y
(
$ddi¤emÙe
))

122 
	g$ddi¤emÙe
 = 0;

124 
	g$l™pic
 = 
G‘DDImage
('nÚe',
$piúame
,
$ddi¤emÙe
);

127 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$chªÃlid
,
$£ndd©e
,
$admšid
);

129 if(
em±y
(
$¬cID
))

131 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

132 
ex™
();

136 
	g$šadd_f
 = 
$šadd_v
 = '';

137 if(!
em±y
(
$xak_addÚf›lds
))

139 
	g$addÚf›lds
 = 
ex¶ode
(';', 
$xak_addÚf›lds
);

140 if(
is_¬¿y
(
$addÚf›lds
))

142 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

144 if(
	g$v
=='') ;

145 
	g$vs
 = 
ex¶ode
(',', 
$v
);

146 if(
	g$vs
[1]=='htmÉext' || 
$vs
[1]=='textdata')

148 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]}, 
$desütiÚ
, 
$l™pic
, 
$keywÜds
, $vs[1]);

152 if(!
is£t
(
$
{
$vs
[0]})è
	g$
{
	g$vs
[0]} = '';

153 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]}, $vs[1], 
$¬cID
);

155 
	g$šadd_f
 .ğ','.
$vs
[0];

156 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

162 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

164 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

166 if(
	g$»dœeùu¾
!='' && !
´eg_m©ch
("#j#", 
$æag
))

168 
	g$æag
 = (
$æag
=='' ? 'j' : $flag.',j');

172 if(
´eg_m©ch
("#j#", 
$æag
)è
	g$ismake
 = -1;

174 
	g$qu”y
 = "INSERT INTO `#@__archives`(id,typeid,typeid2,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,

175 
cŞÜ
,
	gwr™”
,
	gsourû
,
	gl™pic
,
	gpubd©e
,
	g£ndd©e
,
	gmid
,
	gvÙeid
,
	gnÙpo¡
,
	gdesütiÚ
,
	gkeywÜds
,
	gf’ame
,
	gdutyadmš
,
	gweight
)

176 
VALUES
 ('$arcID','$typeid','$typeid2','$sortrank','$flag','$ismake','$channelid','$arcrank','$click','$money','$title','$shorttitle',

179 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

181 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

182 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

183 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨ `#@__¬chives` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

184 
ex™
();

188 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

189 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

190 if(!
em±y
(
$addbË
))

192 
	g$u£
 = 
G‘IP
();

193 
	g$qu”y
 = "INSERT INTO `{$addtable}`(aid,typeid,redirecturl,userip{$inadd_f}) Values('$arcID','$typeid','$redirecturl','$useip'{$inadd_v})";

194 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

196 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

197 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

198 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

199 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addbË}` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

200 
ex™
();

205 
In£¹Tags
(
$gs
, 
$¬cID
);

206 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

208 if(
$£rv™”m
!="")

210 
li¡
(
$£rvu¾
,
$£rvu£r
,
$£rvpwd
èğ
ex¶ode
(',',
$£rv™”m
);

211 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

212 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

214 
	g$cÚfig
=
¬¿y
();

216 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

218 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
, 
Œue
,rue,
$i¤emÙe
);

219 if(
	g$¬tU¾
=='')

221 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

223 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

225 
	g$msg
 = " ã€€ã€€è¯·é€‰æ‹©ä½ çš„åç»­æ“ä½œï¼š

226 <
a
 
h»f
='¬chives_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒæ–‡æ¡£</u></a>

227 &
nb¥
;&
	gnb¥
;

228 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡æ¡£</u></a>

229 &
nb¥
;&
	gnb¥
;

230 <
a
 
	gh»f
='¬chives_do.php?aid=".$¬cID."&dİo¡ód™Archives'><
u
>æ›´æ”¹æ–‡æ¡£</u></a>

231 &
nb¥
;&
	gnb¥
;

232 <
a
 
	gh»f
='ÿlog_do.php?cid=$ty³id&dİo¡öi¡Archives'><
u
>å·²å‘å¸ƒæ–‡æ¡£ç®¡ç†</u></a>

233 &
nb¥
;&
	gnb¥
;

234 
	g$backu¾


236 
	g$msg
 = "<div styË=\"lše-height:36px;height:36px\">{$msg}</div>".
G‘Upd©eTe¡
();

238 
	g$wšt™Ë
 = 'æˆåŠŸå‘å¸ƒæ–‡æ¡£ï¼';

239 
	g$wecome_šfo
 = 'æ–‡æ¡£ç®¡ç†::å‘å¸ƒæ–‡æ¡£';

240 
	g$wš
 = 
Ãw
 
OxWšdow
();

241 
	g$wš
->
AddT™Ë
('æˆåŠŸå‘å¸ƒæ–‡æ¡£ï¼š');

242 
	g$wš
->
AddMsgI‹m
(
$msg
);

243 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('hªd', '&nb¥;', 
çl£
);

244 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\archives_do.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_batchup.php');

9 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

10 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

11 
»quœe_Úû
(
XAKINC
.'/arc.archives.class.php');

12 
	g$ENV_GOBACK_URL
 = (
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? 'content_list.php' : $_COOKIE['ENV_GOBACK_URL']);

14 if(
	$em±y
(
$dİo¡
))

16 
	`ShowMsg
('å¯¹ä¸èµ·ï¼Œä½ æ²¡æŒ‡å®šè¿è¡Œå‚æ•°ï¼','-1');

17 
	`ex™
();

18 
	}
}

19 
	g$aid
 = 
is£t
(
$aid
è? 
´eg_»¶aû
("#[^0-9]#", '', $aid) : '';

25 if(
	g$dİo¡
=='editArchives')

27 
$qu”y
 = "SELECT‡rc.id,arc.typeid,ch.maintable,ch.editcon

28 
FROM
 `#@
__¬ùšy
` 
¬c


29 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


30 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl


31 
WHERE
 
¬c
.
id
='$aid' ";

32 
$row
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

33 
	g$gu¾
 = 
$row
['editcon'];

34 if(
	g$gu¾
==''è
$gu¾
='article_edit.php';

35 
h—d”
("location:{$gurl}?aid=$aid");

36 
ex™
();

42 if(
	g$dİo¡
=="viewArchives")

44 
$aid
 = 
´eg_»¶aû
("#[^0-9]#", '', $aid);

47 
	g$qu”y
 = "SELECT‡rc.*,ch.maintable,ch.addtable,ch.issystem,ch.editcon,

48 

.
ty³dœ
,
	g
.
	gty³Çme
,.
	gcÜªk
,.
	gÇm”uË
,.
	gÇm”uË2
,.
	gi¥¬t
,.
	gmÜes™e
,.
	gs™•©h
,.
s™eu¾


49 
	gFROM
 `#@
	g__¬ùšy
` 
¬c


50 
LEFT
 
	gJOIN
 `#@
	g__¬ùy³
` 

 
ON
 
	g
.
	gid
=
¬c
.
ty³id


51 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=

.
chªÃÉy³


52 
WHERE
 
¬c
.
id
='$aid' ";

53 
$Œow
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

54 
	g$Œow
['mašbË'] = ( 
Œim
(
$Œow
['maintable'])=='' ? '#@__archives' :rim($trow['maintable']) );

55 if(
	g$Œow
['issystem'] != -1)

57 
$¬cQu”y
 = "SELECT‡rc.*,tp.typedir,tp.typename,tp.corank,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.sitepath,tp.siteurl

58 
FROM
 `{
$Œow
['mašbË']}` 
¬c
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
Ú
‡rc.
ty³id
ñp.
id


59 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
Ú
 ch.
id
=
¬c
.
chªÃl
 
WHERE
‡rc.id='$aid' ";

60 
$¬cRow
 = 
$dsql
->
G‘OÃ
(
$¬cQu”y
);

61 
PutCook›
('XakU£rID',
$¬cRow
['mid'],1800);

62 
PutCook›
('XakLogšTime',
time
(),1800);

63 if(
	g$¬cRow
['ismake']==-1 || 
$¬cRow
['corank']!=0 || $arcRow['arcrank']!=0 || ($arcRow['typeid']==0 && $arcRow['channel']!=-1) || $arcRow['money']>0)

65 
echo
 "<script†anguage='javascript'>location.href='{$cfg_phpurl}/view.php?aid={$aid}';</script>";

66 
ex™
();

71 
	g$¬cRow
['id'] = 
$aid
;

72 
	g$¬cRow
['ty³id'] = 
$Œow
['typeid'];

73 
	g$¬cRow
['£ndd©e'] = 
$Œow
['senddate'];

74 
	g$¬cRow
['title'] = '';

75 
	g$¬cRow
['ismake'] = 1;

76 
	g$¬cRow
['¬üªk'] = 
$Œow
['corank'];

77 
	g$¬cRow
['Çm”uË'] = 
$Œow
['namerule'];

78 
	g$¬cRow
['ty³dœ'] = 
$Œow
['typedir'];

79 
	g$¬cRow
['money'] = 0;

80 
	g$¬cRow
['filename'] = '';

81 
	g$¬cRow
['mÜes™e'] = 
$Œow
['moresite'];

82 
	g$¬cRow
['s™eu¾'] = 
$Œow
['siteurl'];

83 
	g$¬cRow
['s™•©h'] = 
$Œow
['sitepath'];

85 
	g$¬cu¾
 = 
G‘FeU¾
(
$¬cRow
['id'],$arcRow['typeid'],$arcRow['senddate'],$arcRow['title'],$arcRow['ismake'],$arcRow['arcrank'],

86 
$¬cRow
['namerule'],$arcRow['typedir'],$arcRow['money'],$arcRow['filename'],$arcRow['moresite'],$arcRow['siteurl'],$arcRow['sitepath']);

87 
	g$¬cfe
 = 
G‘FeU¾
(
$¬cRow
['id'],$arcRow['typeid'],$arcRow['senddate'],$arcRow['title'],

88 
$¬cRow
['ismake'],$arcRow['arcrank'],$arcRow['namerule'],$arcRow['typedir'],$arcRow['money'],$arcRow['filename']);

89 if(
´eg_m©ch
("#^h‰p:#", 
$¬cfe
))

91 
	g$¬cfe
 = 
´eg_»¶aû
("#^h‰p:\/\/([^\/]*)\/#i", '/', 
$¬cfe
);

93 
	g$Œuefe
 = 
G‘TrueP©h
().
$¬cfe
;

94 if(!
fe_exi¡s
(
$Œuefe
))

96 
MakeA¹
(
$aid
,
TRUE
);

98 
	gecho
 "<süˆÏnguage='javasüt'>loÿtiÚ.h»f='$¬cu¾"."?".
time
()."';</script>";

99 
ex™
();

105 if(
	g$dİo¡
=="uploadLitpic")

107 
$upfe
 = 
AdmšU¶ßd
('l™pic', 'imag–™', 0, 
çl£
 );

108 if(
	g$upfe
=='-1')

110 
$msg
 = "<script†anguage='javascript'>

111 
·»Á
.
docum’t
.
g‘EËm’tById
('u¶ßdwa™').
¡yË
.
di¥Ïy
 = 'none';

112 
®”t
('ä½ æ²¡æŒ‡å®šè¦ä¸Šä¼ çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼');

113 </
	gsüt
>";

115 if(
	g$upfe
=='-2')

117 
$msg
 = "<script†anguage='javascript'>

118 
·»Á
.
docum’t
.
g‘EËm’tById
('u¶ßdwa™').
¡yË
.
di¥Ïy
 = 'none';

119 
®”t
('ä¸Šä¼ æ–‡ä»¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŸå› ï¼');

120 </
	gsüt
>";

122 if(
	g$upfe
=='0')

124 
$msg
 = "<script†anguage='javascript'>

125 
·»Á
.
docum’t
.
g‘EËm’tById
('u¶ßdwa™').
¡yË
.
di¥Ïy
 = 'none';

126 
®”t
('æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼');

127 </
	gsüt
>";

131 if(!
em±y
(
$cfg_u¶™pic_cut
è&& 
	g$cfg_u¶™pic_cut
=='N')

133 
$msg
 = "<script†anguage='javascript'>

134 
·»Á
.
docum’t
.
g‘EËm’tById
('u¶ßdwa™').
¡yË
.
di¥Ïy
 = 'none';

135 
	g·»Á
.
	gdocum’t
.
g‘EËm’tById
('piúame').
	gv®ue
 = '{$upfile}';

136 if(
	g·»Á
.
	gdocum’t
.
g‘EËm’tById
('divpicview'))

138 
	g·»Á
.
	gdocum’t
.
g‘EËm’tById
('divpicv›w').
	g¡yË
.
	gwidth
 = '150px';

139 
	g·»Á
.
	gdocum’t
.
g‘EËm’tById
('divpicv›w').
	gšÃrHTML
 = \"<img src='{$upfile}?n' width='150' />\";

141 </
	gsüt
>";

145 
	g$msg
 = "<script†anguage='javascript'>

146 
·»Á
.
docum’t
.
g‘EËm’tById
('u¶ßdwa™').
¡yË
.
di¥Ïy
 = 'none';

147 
	gwšdow
.
İ’
('imagecut.php?f=picname&isupload=yes&file={$upfile}', 'popUpImagesWin', 'scrollbars=yes,resizable=yes,statebar=no,width=800,height=600,left=150,op=50');

148 </
	gsüt
>";

151 
echo
 
	g$msg
;

152 
ex™
();

158 if(
	g$dİo¡
=="commendArchives")

160 
CheckPurv›w
('a_Commend,sys_ArcBatch');

161 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
) )

163 
	g$q¡r
 = 
$aid
;

165 if(
	g$q¡r
=='')

167 
ShowMsg
("å‚æ•°æ— æ•ˆï¼",
$ENV_GOBACK_URL
);

168 
ex™
();

170 
	g$¬cids
 = 
´eg_»¶aû
("#[^0-9,]#", '',…»g_»¶aû("#`#", ',', 
$q¡r
));

171 
	g$qu”y
 = "SELECT‡rc.id,arc.typeid,ch.issystem,ch.maintable,ch.addtable FROM `#@__arctiny`‡rc

172 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
Ú
p.
id
=
¬c
.
ty³id


173 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
Ú
 ch.
id
=

.
chªÃÉy³


174 
WHERE
 
¬c
.
id
 
š
(
$¬cids
) ";

175 
$dsql
->
S‘Qu”y
(
$qu”y
);

176 
	g$dsql
->
Execu‹
();

177 
	g$row
 = 
$dsql
->
G‘A¼ay
())

179 
$aid
 = 
$row
['id'];

180 if(
	g$row
['issystem']!=-1)

182 
$mašbË
 = ( 
Œim
(
$row
['maintable'])=='' ? '#@__archives' :rim($row['maintable']) );

183 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT flag FROM `{$maintable}` WHERE id='$aid' ");

184 
	g$æag
 = (
$¬r
['flag']=='' ? 'c' : $arr['flag'].',c');

185 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `{$maintable}` SET `flag`='$flag' WHERE id='{$aid}' ");

189 
	g$mašbË
 = 
Œim
(
$row
['addtable']);

190 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT flag From `{$maintable}` where‡id='$aid' ");

191 
	g$æag
 = (
$¬r
['flag']=='' ? 'c' : $arr['flag'].',c');

192 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `{$maintable}` SET `flag`='$flag' WHERE‡id='{$aid}' ");

195 
ShowMsg
("æˆåŠŸæŠŠæ‰€é€‰çš„æ–‡æ¡£è®¾ä¸ºæ¨èï¼",
$ENV_GOBACK_URL
);

196 
ex™
();

203 if(
	g$dİo¡
=="makeArchives")

205 
CheckPurv›w
('sys_MakeHtml,sys_ArcBatch');

206 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
èè
	g$q¡r
 = $aid;

208 if(
	g$q¡r
=='')

210 
ShowMsg
('å‚æ•°æ— æ•ˆï¼',
$ENV_GOBACK_URL
);

211 
ex™
();

213 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

214 
	g$q¡rs
 = 
ex¶ode
('`',
$q¡r
);

215 
	g$i
 = 0;

216 
fÜ—ch
(
$q¡rs
 
as
 
$aid
)

218 
	g$i
++;

219 
	g$·geu¾
 = 
MakeA¹
(
$aid
,
çl£
);

221 
ShowMsg
("æˆåŠŸæ›´æ–°æŒ‡å®š $˜ä¸ªæ–‡ä»¶...",
$ENV_GOBACK_URL
);

222 
ex™
();

228 if(
	g$dİo¡
=="checkArchives")

230 
CheckPurv›w
('a_Check,a_AccCheck,sys_ArcBatch');

231 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

232 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
èè
	g$q¡r
 = $aid;

233 if(
	g$q¡r
=='')

235 
ShowMsg
("å‚æ•°æ— æ•ˆï¼",
$ENV_GOBACK_URL
);

236 
ex™
();

238 
	g$¬cids
 = 
´eg_»¶aû
("#[^0-9,]#", '',…»g_»¶aû("#`#", ',', 
$q¡r
));

239 
	g$qu”y
 = "SELECT‡rc.id,arc.typeid,ch.issystem,ch.maintable,ch.addtable FROM `#@__arctiny`‡rc

240 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


241 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=

.
chªÃÉy³


242 
WHERE
 
¬c
.
id
 
š
(
$¬cids
) ";

243 
$dsql
->
S‘Qu”y
(
$qu”y
);

244 
	g$dsql
->
Execu‹
('ckall');

245 
	g$row
 = 
$dsql
->
G‘A¼ay
('ckall'))

247 
$aid
 = 
$row
['id'];

248 
	g$mašbË
 = ( 
Œim
(
$row
['maintable'])=='' ? '#@__archives' :rim($row['maintable']) );

249 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctiny` SET‡rcrank='0' WHERE id='$aid' ");

250 if(
	g$row
['issystem']==-1)

252 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `".
Œim
(
$row
['addtable'])."` SET‡rcrank='0' WHERE‡id='$aid' ");

256 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `$mašbË` SET‡rüªk='0', dutyadmš='".
$cu£rLogš
->
g‘U£rID
()."' WHERE id='$aid' ");

258 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__taglist` SET‡rcrank='0' WHERE‡id='$aid' ");

259 
	g$·geu¾
 = 
MakeA¹
(
$aid
,
çl£
);

261 
ShowMsg
("æˆåŠŸå®¡æ ¸æŒ‡å®šçš„æ–‡æ¡£ï¼",
$ENV_GOBACK_URL
);

262 
ex™
();

268 if(
	g$dİo¡
=="delArchives")

270 
CheckPurv›w
('a_Del,a_AccDel,a_MyDel,sys_ArcBatch');

271 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

272 if(
em±y
(
$fmdo
)è
	g$fmdo
 = '';

274 if(
	g$fmdo
=='yes')

276 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
) )

278 
$q¡r
 = 
$aid
;

280 if(
	g$q¡r
=='')

282 
ShowMsg
("å‚æ•°æ— æ•ˆï¼",
$ENV_GOBACK_URL
);

283 
ex™
();

285 
	g$q¡rs
 = 
ex¶ode
("`",
$q¡r
);

286 
	g$okaids
 = 
A¼ay
();

288 
fÜ—ch
(
$q¡rs
 
as
 
$aid
)

290 if(!
is£t
(
$okaids
[
$aid
]))

292 
D–Arc
(
$aid
);

296 
	g$okaids
[
$aid
] = 1;

299 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„æ–‡æ¡£ï¼",
$ENV_GOBACK_URL
);

300 
ex™
();

305 
	g$wšt™Ë
 = "æ–‡æ¡£ç®¡ç†-åˆ é™¤æ–‡æ¡£";

306 
	g$wecome_šfo
 = "<¨h»f='".
$ENV_GOBACK_URL
."'>æ–‡æ¡£ç®¡ç†</a>::åˆ é™¤æ–‡æ¡£";

307 
	g$wš
 = 
Ãw
 
OxWšdow
();

308 
	g$wš
->
In™
("archives_do.php","js/blank.js","POST");

309 
	g$wš
->
AddHidd’
("fmdo","yes");

310 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

311 
	g$wš
->
AddHidd’
("q¡r",
$q¡r
);

312 
	g$wš
->
AddHidd’
("aid",
$aid
);

313 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦åˆ é™¤â€œ $qstr å’Œ $aid â€è¿™äº›æ–‡æ¡£ï¼Ÿ");

314 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

315 
	g$wš
->
Di¥Ïy
();

321 if(
	g$dİo¡
=='moveArchives')

323 
CheckPurv›w
('sys_ArcBatch');

324 if(
em±y
(
$tÙy³
))

326 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

327 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
èè
	g$q¡r
 = $aid;

329 
AjaxH—d
();

330 
	g$chªÃlid
 = 
em±y
(
$chªÃlid
) ? 0 : $channelid;

331 
	g$
 = 
Ãw
 
Ty³Lšk
(
$aid
);

332 
	g$ty³O±iÚs
 = 
$
->
G‘O±iÚA¼ay
(0, 
$admš_ÿlogs
, 
$chªÃlid
);

333 
	g$ty³O±iÚs
 = "<select‚ame='totype' style='width:90%'>

334 <
İtiÚ
 
v®ue
='0'>è¯·é€‰æ‹©ç§»åŠ¨åˆ°çš„ä½ç½®...</İtiÚ>\
r
\
n


335 
$ty³O±iÚs


336 </
£Ëù
>";

339 
$divÇme
 = 'moveArchives';

340 
	gecho
 "<div class='title' onmousemove=\"DropMoveHand('{$divname}', 225);\" onmousedown=\"DropStartHand();\" onmouseup=\"DropStopHand();\">\r\n";

341 
	gecho
 " <div class='titLeft'>ç§»åŠ¨æ–‡æ¡£</div>\r\n";

342 
	gecho
 " <div class='titRight'><img src='images/ico-close.gif' style='cursor:pointer;' onclick='HideObj(\"{$divname}\");ChangeFullDiv(\"hide\");'‡lt='å…³é—­'itle='å…³é—­' /></div>\r\n";

343 
	gecho
 "</div>\r\n";

344 
	gecho
 "<form‚ame='quickeditform'‡ction='archives_do.php' method='post'>\r\n";

345 
	gecho
 "<inputype='hidden'‚ame='dopost' value='{$dopost}' />\r\n";

346 
	gecho
 "<inputype='hidden'‚ame='qstr' value='{$qstr}' />\r\n";

347 
	gecho
 "<table width='100%' style='margin-top:6px;z-index:9000;'>\r\n";

349 <
Œ
 
	gheight
='28'>

350 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;ç›®æ ‡æ ç›®ï¼š</
	gtd
>

351 <
td
 
	gşass
='bline'>

352 <?
php
 
echo
 
$ty³O±iÚs
; ?>

353 </
	gtd
>

354 </
	gŒ
>

355 <
Œ
 
	gheight
='32'>

356 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;æ–‡æ¡£
	gID
ï¼š</
	gtd
>

357 <
td
 
	gşass
='bline'>

358 <
šput
 
ty³
='‹xt' 
Çme
='tmpids' 
v®ue
="<?ph°echØ$q¡r; ?>" 
¡yË
='width:310px;overflow:hidden;' />

359 <
br
 />

361 </
td
>

362 </
Œ
>

363 <
Œ
 
height
='32'>

364 <
td
 
cŞ¥ª
='2' 
®ign
='ûÁ”' 
¡yË
='padding-top:12px'>

365 <
šput
 
Çme
="imageF›ld" 
ty³
="image" 
¤c
="images/bu‰Ú_ok.gif" 
width
="60" 
height
="22" 
şass
="Å" 
bÜd”
="0" 
¡yË
="cursor:pointer" />

366 &
nb¥
;&
	gnb¥
;

367 <
img
 
	g¤c
="images/bu‰Ú_back.gif" 
width
="60" 
height
="22" 
bÜd”
="0" 
Úşick
='HideObj("<?ph°echØ$divÇme; ?>");ChªgeFuÎDiv("hide");' 
¡yË
="cursor:pointer" />

368 </
td
>

369 </
td
>

370 </
Œ
>

371 </
bË
>

372 </
fÜm
>

373 <?
php


378 
	g$tÙy³
 = 
´eg_»¶aû
("#[^0-9]#", '', 
$tÙy³
);

379 
	g$ty³Infos
 = 
$dsql
->
G‘OÃ
("SELECTp.channeltype,tp.ispart,tp.channeltype,ch.maintable,ch.addtable,ch.issystem FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch on ch.id=tp.channeltype WHEREp.id='$totype' ");

380 
	g$idty³
 = "id";

381 if(!
is_¬¿y
(
$ty³Infos
))

383 
ShowMsg
('å‚æ•°é”™è¯¯ï¼','-1');

384 
ex™
();

386 if(
	g$ty³Infos
['ispart']!=0)

388 
ShowMsg
('æ–‡æ¡£ä¿å­˜çš„æ ç›®å¿…é¡»ä¸ºæœ€ç»ˆåˆ—è¡¨æ ç›®ï¼','-1');

389 
ex™
();

391 if(
em±y
(
$ty³Infos
['addtable']))

393 
	g$ty³Infos
['maintable'] = '#@__archives';

396 if(
	g$ty³Infos
['issystem'] == -1)

398 
$ty³Infos
['maintable'] = $typeInfos['addtable'];

399 
	g$idty³
 = "aid";

401 
	g$¬cids
 = 
´eg_»¶aû
("#[^0-9,]#", '',…»g_»¶aû("#`#", ',', 
$q¡r
));

402 
	g$¬c
 = '';

403 
	g$j
 = 0;

404 
	g$okids
 = 
¬¿y
();

405 
	g$dsql
->
S‘Qu”y
("SELECT {$idtype},typeid FROM `{$typeInfos['maintable']}` WHERE {$idtype} in($arcids) AND channel='{$typeInfos['channeltype']}' ");

406 
	g$dsql
->
Execu‹
();

407 
	g$row
 = 
$dsql
->
G‘A¼ay
())

409 if(
$row
['ty³id']!=
$tÙy³
)

411 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctiny` SETypeid='$totype' WHERE id='{$row[$idtype]}' ");

412 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `{$typeInfos['maintable']}` SETypeid='$totype' WHERE id='{$row[$idtype]}' ");

413 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `{$typeInfos['addtable']}` SETypeid='$totype' WHERE‡id='{$row[$idtype]}' ");

414 
	g$okids
[] = 
$row
[
$idty³
];

415 
	g$j
++;

419 
fÜ—ch
(
$okids
 
as
 
$aid
)

421 
	g$¬c
 = 
Ãw
 
Archives
(
$aid
);

422 
	g$¬c
->
MakeHtml
();

424 
ShowMsg
("æˆåŠŸç§»åŠ¨ $j ä¸ªæ–‡æ¡£ï¼", 
$ENV_GOBACK_URL
);

425 
ex™
();

432 if(
	g$dİo¡
=='return')

434 
CheckPurv›w
('a_Del,a_AccDel,a_MyDel,sys_ArcBatch');

435 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

437 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
èè
	g$q¡r
 = $aid;

439 if(
	g$q¡r
=='')

441 
ShowMsg
("å‚æ•°æ— æ•ˆï¼","recycling.php");

442 
ex™
();

444 
	g$q¡rs
 = 
ex¶ode
("`", 
$q¡r
);

445 
fÜ—ch
(
$q¡rs
 
as
 
$aid
)

447 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SET‡rcrank='-1',ismake='0' WHERE id='$aid'");

448 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctiny` SET `arcrank` = '-1' WHERE id = '$aid'; ");

450 
ShowMsg
("æˆåŠŸè¿˜åŸæŒ‡å®šçš„æ–‡æ¡£ï¼","recycling.php");

451 
ex™
();

457 if(
	g$dİo¡
=='clear')

459 
CheckPurv›w
('a_Del,a_AccDel,a_MyDel,sys_ArcBatch');

460 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

461 if(
em±y
(
$fmdo
)è
	g$fmdo
 = '';

462 
	g$»cyşe
 = 
em±y
(
$»cyşe
)? "" : $recycle;

464 if(
	g$fmdo
=='yes')

466 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
) ) $qstr = $aid;

467 if(
	g$q¡r
=='')

469 
ShowMsg
("å‚æ•°æ— æ•ˆï¼","recycling.php");

470 
ex™
();

472 
	g$q¡rs
 = 
ex¶ode
(",", 
$q¡r
);

473 
	g$okaids
 = 
A¼ay
();

474 
fÜ—ch
(
$q¡rs
 
as
 
$q¡r
)

476 if(!
is£t
(
$okaids
[
$q¡r
]))

478 
D–Arc
(
$q¡r
, "OK", 
FALSE
, 
$»cyşe
);

479 
	g$okaids
[
$q¡r
] = $qstr;

483 
	g$okaids
[
$q¡r
] = 1;

486 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„æ–‡æ¡£ï¼","recycling.php");

487 
ex™
();

491 
	g$dsql
->
S‘Qu”y
("SELECT id FROM `#@__archives` WHERE `arcrank` = '-2'");

492 
	g$dsql
->
Execu‹
();

493 
	g$q¡r
 = '';

494 
	g$row
 = 
$dsql
->
G‘A¼ay
())

496 
$q¡r
 .ğ
$row
['id'].",";

497 
	g$aid
 = 
$row
['id'];

499 
	g$num
 = 
$dsql
->
G‘TÙ®Row
();

500 if(
em±y
(
$num
))

502 
ShowMsg
("å¯¹ä¸èµ·ï¼Œæœªå‘ç°ç›¸å…³æ–‡æ¡£ï¼","recycling.php");

503 
ex™
();

505 
	g$wšt™Ë
 = "æ–‡æ¡£ç®¡ç†-æ¸…ç©ºæ‰€æœ‰æ–‡æ¡£";

506 
	g$wecome_šfo
 = "<a href='recycling.php'>æ–‡æ¡£å›æ”¶ç«™</a>::æ¸…ç©ºæ‰€æœ‰æ–‡æ¡£";

507 
	g$wš
 = 
Ãw
 
OxWšdow
();

508 
	g$wš
->
In™
("archives_do.php","js/blank.js","POST");

509 
	g$wš
->
AddHidd’
("fmdo","yes");

510 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

511 
	g$wš
->
AddHidd’
("q¡r",
$q¡r
);

512 
	g$wš
->
AddHidd’
("aid",
$aid
);

513 
	g$wš
->
AddHidd’
("»cyşe",
$»cyşe
);

514 
	g$wš
->
AddT™Ë
("æœ¬æ¬¡æ“ä½œå°†æ¸…ç©ºå›æ”¶ç«™<font color='#FF0000'>æ‰€æœ‰å…± $num ç¯‡æ–‡æ¡£</font><br>ä½ ç¡®å®è¦æ°¸ä¹…åˆ é™¤â€œ $qstr â€è¿™äº›æ–‡æ¡£ï¼Ÿ");

515 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

516 
	g$wš
->
Di¥Ïy
();

523 if(
	g$dİo¡
=='del')

525 
CheckPurv›w
('a_Del,a_AccDel,a_MyDel,sys_ArcBatch');

526 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

527 if(
em±y
(
$fmdo
)è
	g$fmdo
 = '';

528 
	g$»cyşe
 = 
em±y
(
$»cyşe
)? "" : $recycle;

530 if(
	g$fmdo
=='yes')

532 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
) ) $qstr = $aid;

533 if(
	g$q¡r
=='')

535 
ShowMsg
("å‚æ•°æ— æ•ˆï¼","recycling.php");

536 
ex™
();

538 
	g$q¡rs
 = 
ex¶ode
("`", 
$q¡r
);

539 
	g$okaids
 = 
A¼ay
();

541 
fÜ—ch
(
$q¡rs
 
as
 
$aid
)

543 if(!
is£t
(
$okaids
[
$aid
]))

545 
D–Arc
(
$aid
,"OK","",
$»cyşe
);

549 
	g$okaids
[
$aid
] = 1;

552 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„æ–‡æ¡£ï¼","recycling.php");

553 
ex™
();

558 
	g$wšt™Ë
 = "æ–‡æ¡£ç®¡ç†-åˆ é™¤æ–‡æ¡£";

559 
	g$wecome_šfo
 = "<a href='recycling.php'>æ–‡æ¡£ç®¡ç†</a>::åˆ é™¤æ–‡æ¡£";

560 
	g$wš
 = 
Ãw
 
OxWšdow
();

561 
	g$wš
->
In™
("archives_do.php","js/blank.js","POST");

562 
	g$wš
->
AddHidd’
("fmdo","yes");

563 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

564 
	g$wš
->
AddHidd’
("q¡r",
$q¡r
);

565 
	g$wš
->
AddHidd’
("aid",
$aid
);

566 
	g$wš
->
AddHidd’
("»cyşe",
$»cyşe
);

567 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦æ°¸ä¹…åˆ é™¤â€œ $qstr å’Œ $aid â€è¿™äº›æ–‡æ¡£ï¼Ÿ");

568 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

569 
	g$wš
->
Di¥Ïy
();

576 if(
	g$dİo¡
=='quickEdit')

578 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

579 
AjaxH—d
();

580 
	g$qu”y
 = "SELECT ch.typename‡s channelname,ch.addtable,ar.membername‡s„ankname,arc.*

581 
FROM
 `#@
__¬chives
` 
¬c


582 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl


583 
LEFT
 
JOIN
 `#@
__¬üªk
` 
¬
 
ON
‡r.
¿nk
=
¬c
.
¬üªk
 
WHERE
‡rc.
id
='$aid' ";

584 
$¬cRow
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

585 
	g$divÇme
 = 'quickEdit';

586 
	gecho
 "<div class='title' onmousemove=\"DropMoveHand('{$divname}', 225);\" onmousedown=\"DropStartHand();\" onmouseup=\"DropStopHand();\">\r\n";

587 
	gecho
 " <div class='titLeft'>å¿«é€Ÿå±æ€§ç¼–è¾‘</div>\r\n";

588 
	gecho
 " <div class='titRight'><img src='images/ico-close.gif' style='cursor:pointer;' onclick='HideObj(\"{$divname}\");ChangeFullDiv(\"hide\");'‡lt='å…³é—­'itle='å…³é—­' /></div>\r\n";

589 
	gecho
 "</div>\r\n";

590 
	gecho
 "<form‚ame='quickeditform'‡ction='archives_do.php?dopost=quickEditSave&aid={$aid}' method='post'>\r\n";

591 
	gecho
 "<inputype='hidden'‚ame='addtable' value='{$arcRow['addtable']}' />\r\n";

592 
	gecho
 "<inputype='hidden'‚ame='oldtypeid' value='{$arcRow['typeid']}' />\r\n";

593 
	gecho
 "<table width='100%' style='margin-top:6px;z-index:9000;'>\r\n";

595 <
Œ
 
	gheight
='32'>

596 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;æ‰€å±æ ç›®ï¼š</
	gtd
>

597 <
td
 
	gşass
='bline'>

598 <?
php


599 
$ty³O±iÚs
 = 
G‘O±iÚLi¡
(
$¬cRow
['ty³id'],
$cu£rLogš
->
g‘U£rChªÃl
(), $arcRow['channel']);

600 
	gecho
 "<select‚ame='typeid' style='width:70%'>\r\n";

601 if(
	g$¬cRow
["ty³id"]=="0"è
echo
 "<option value='0' selected>è¯·é€‰æ‹©æ ç›®...</option>\r\n";

602 
echo
 
	g$ty³O±iÚs
;

603 
	gecho
 "</select>";

605 </
	gtd
>

606 </
	gŒ
>

607 <
Œ
 
	gheight
='28'>

608 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;å± æ€§ï¼š</
	gtd
>

609 <
td
 
	gşass
='bline'>

610 <
šput
 
ty³
='hidd’' 
Çme
='Şdæag' 
v®ue
='<?ph°echØ$¬cRow['
æag
']; ?>' />

611 <?
php


612 
$dsql
->
S‘Qu”y
("SELECT * FROM `#@__arcatt` ORDER BY sortid ASC");

613 
	g$dsql
->
Execu‹
();

614 
	g$Œow
 = 
$dsql
->
G‘Objeù
())

616 if(
$Œow
->
©t
=='j' || $trow->att=='p') ;

617 if(
´eg_m©ch
("#".
$Œow
->
©t
."#", 
$¬cRow
['flag']))

618 
	gecho
 "<input class='np'ype='checkbox'‚ame='flags[]' id='flags{$trow->att}' value='{$trow->att}' checked='checked' />{$trow->attname}.{$trow->att}";

620 
	gecho
 "<input class='np'ype='checkbox'‚ame='flags[]' id='flags{$trow->att}' value='{$trow->att}' />{$trow->attname}.{$trow->att}";

623 </
	gtd
>

624 </
	gŒ
>

625 <
Œ
 
	gheight
='32'>

626 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;æ ‡ é¢˜ï¼š</
	gtd
>

627 <
td
 
	gşass
='bline'>

628 <
šput
 
Çme
="t™Ë" 
ty³
="‹xt" 
id
="t™Ë" 
v®ue
="<?ph°echØ$¬cRow['t™Ë']; ?>" 
¡yË
="width:90%" />

629 </
td
>

630 </
Œ
>

631 <
Œ
 
height
='32'>

632 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;ç®€ç•¥æ ‡é¢˜ï¼š</
	gtd
>

633 <
td
 
	gşass
='bline'>

634 <
šput
 
Çme
="shÜ‰™Ë" 
ty³
="‹xt" 
id
="shÜ‰™Ë" 
v®ue
="<?ph°echØ$¬cRow['shÜ‰™Ë']; ?>" 
¡yË
="width:60%" />

635 </
td
>

636 </
Œ
>

637 <?
php
 if(
$İ’_memb”
){ ?>

638 <
Œ
 
height
='32'>

639 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;é˜…è¯»æƒé™ï¼š</
	gtd
>

640 <
td
 
	gşass
='bline'>

641 <
£Ëù
 
Çme
="¬üªk" 
id
="¬üªk" 
¡yË
="width:120px">

642 <
İtiÚ
 
v®ue
='<?phpƒcho $arcRow["arcrank"]?>'>

643 <?
php
 
echo
 
$¬cRow
["¿nkÇme"]?> </
İtiÚ
>

644 <?
php


645 
$u¿nk
 = 
$cu£rLogš
->
g‘U£rRªk
();

647 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__arcrank` WHERE‡dminrank<='$urank'");

648 
	g$dsql
->
Execu‹
();

649 
	g$row
 = 
$dsql
->
G‘Objeù
()){

650 
echo
 " <İtiÚ v®ue='".
$row
->
¿nk
."'>".$row->
memb”Çme
."</option>\r\n";

653 </
	g£Ëù
>

654 éœ€è¦é‡‘å¸ï¼š<
šput
 
	gÇme
="mÚey" 
ty³
="‹xt" 
id
="mÚey" 
v®ue
="<?ph°echØ$¬cRow["
mÚey
"]; ?>" 
¡yË
="width:80px" />

655 </
td
>

656 </
Œ
>

657 <?
php
 } ?>

658 <
Œ
 
	gheight
='32'>

659 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;å…³é”®å­—ï¼š</
	gtd
>

660 <
td
 
	gşass
='bline'>

661 <
šput
 
Çme
="keywÜds" 
ty³
="‹xt" 
id
="keywÜds" 
v®ue
="<?ph°echØ$¬cRow['keywÜds']; ?>" 
¡yË
="width:90%" />

662 </
td
>

663 </
Œ
>

664 <
Œ
 
height
='32'>

665 <
td
 
cŞ¥ª
='2' 
®ign
='ûÁ”' 
¡yË
='padding-top:12px'>

666 <
šput
 
Çme
="imageF›ld" 
ty³
="image" 
¤c
="images/bu‰Ú_ok.gif" 
şass
="Å" 
bÜd”
="0" 
¡yË
="cursor:pointer" />

667 &
nb¥
;&
	gnb¥
;

668 <
img
 
	g¤c
="images/bu‰Ú_back.gif" 
bÜd”
="0" 
Úşick
='HideObj("<?ph°echØ$divÇme; ?>");ChªgeFuÎDiv("hide");' 
¡yË
="cursor:pointer" />

669 </
td
>

670 </
td
>

671 </
Œ
>

672 </
bË
>

673 </
fÜm
>

674 <?
php


681 if(
	g$dİo¡
=='quickEditSave')

683 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

685 if(!
Te¡Purv›w
('a_Edit'))

687 if(
Te¡Purv›w
('a_AccEdit'))

689 
CheckC©®og
(
$ty³id
, "å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æ–‡æ¡£æƒé™ï¼");

693 
CheckArcAdmš
(
$aid
, 
$cu£rLogš
->
g‘U£rID
());

696 
	g$t™Ë
 = 
html¥ecŸlch¬s
(
ú_sub¡rR
(
$t™Ë
, 
$cfg_t™Ë_maxËn
));

697 
	g$shÜ‰™Ë
 = 
ú_sub¡rR
(
$shÜ‰™Ë
, 36);

698 
	g$keywÜds
 = 
Œim
(
ú_sub¡rR
(
$keywÜds
, 60));

699 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck')è
	g$¬üªk
 = -1;

701 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

704 
	g$æag
 = 
is£t
(
$æags
è? 
još
(',', $flags) : '';

705 if(!
em±y
(
$æag
))

707 if(
´eg_m©ch
("#p#", 
$Şdæag
)è
	g$æag
 .= ',p';

708 if(
´eg_m©ch
("#j#", 
$Şdæag
)è
	g$æag
 .= ',j';

717 
	g$qu”y
 = "UPDATE `#@__archives` SET

718 
ty³id
 = '$typeid',

719 
	gæag
 = '$flag',

720 
	g¬üªk
 = '$arcrank',

721 
	gmÚey
 = '$money',

722 
	gt™Ë
 = '$title',

723 
	gshÜ‰™Ë
 = '$shorttitle',

724 
	gkeywÜds
 = '$keywords',

725 
	gdutyadmš
 = '$adminid'

726 
WHERE
 
id
 = '$aid'; ";

728 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

730 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `#@__arctiny` SETypeid='$typeid',arcrank='$arcrank' WHERE id='$aid' ");

732 if(
	g$ty³id
 !ğ
$Şdty³id
)

734 
$addbË
 = 
Œim
($addtable);

735 if(
em±y
(
$addbË
)è
	g$addbË
 = '#@__addonarticle';

736 
	g$addbË
 = 
´eg_»¶aû
("#[^a-z0-9__#@-]#i", "", 
$addbË
);

737 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `$addtable` SETypeid='$typeid' WHERE‡id='$aid' ");

740 
	g$¬tU¾
 = 
MakeA¹
(
$aid
, 
TRUE
, TRUE);

742 
	g$backu¾
 = !
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : '-1';

743 
ShowMsg
('æˆåŠŸæ›´æ–°ä¸€ç¯‡æ–‡æ¡£çš„åŸºæœ¬ä¿¡æ¯ï¼', 
$backu¾
);

744 
ex™
();

750 if(
	g$dİo¡
=="makekw")

752 
šşude_Úû
(
XAKINC
.'/splitword.class.php');

753 
CheckPurv›w
('a_Commend,sys_ArcBatch');

754 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
èè
	g$q¡r
 = $aid;

756 if(
	g$q¡r
=='')

758 
ShowMsg
("å‚æ•°æ— æ•ˆï¼", 
$ENV_GOBACK_URL
);

759 
ex™
();

761 
	g$¥
 = 
Ãw
 
S¶™WÜd
(
$cfg_soá_Ïng
, $cfg_soft_lang);

762 
	g$¬cids
 = 
´eg_»¶aû
("#[^0-9,]#", '',…»g_»¶aû("#`#", ',', 
$q¡r
));

763 
	g$qu”y
 = "SELECT‡rc.*,‡ddt.* From `#@__archives`‡rc LEFT JOIN `#@__addonarticle`‡ddt ON‡ddt.aid=arc.id WHERE‡rc.id in($arcids) AND‡rc.channel=1 ";

764 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

765 
	g$dsql
->
Execu‹
();

766 
	g$row
 = 
$dsql
->
G‘A¼ay
())

769 if(
Œim
(
$row
['keywords']) !='' ) ;

771 
	g$aid
 = 
$row
['id'];

772 
	g$keywÜds
 = '';

773 
	g$t™Ë
 = 
$row
['title'];

774 
	g$desütiÚ
 = 
$row
['description'];

775 
	g$body
 = 
ú_sub¡r
(
$row
['body'], 5000);

776 
	g$¥
->
S‘Sourû
(
$t™Ë
, 
$cfg_soá_Ïng
, $cfg_soft_lang);

777 
	g$¥
->
S¹AÇlysis
();

778 
	g$t™Ëšdexs
 = 
´eg_»¶aû
("/#p#|#e#/",'',
$¥
->
G‘Fš®lyIndex
());

779 
	g$¥
->
S‘Sourû
(
Html2Text
(
$body
), 
$cfg_soá_Ïng
, $cfg_soft_lang);

780 
	g$¥
->
S¹AÇlysis
();

781 
	g$®lšdexs
 = 
´eg_»¶aû
("/#p#|#e#/",'',
$¥
->
G‘Fš®lyIndex
());

783 if(
is_¬¿y
(
$®lšdexs
è&& is_¬¿y(
$t™Ëšdexs
))

785 
fÜ—ch
(
$t™Ëšdexs
 
as
 
$k
 => 
$v
)

787 if(
¡¾’
(
$keywÜds
.
$k
)>=60)

793 if(
¡¾’
(
$k
) <= 2) ;

794 
	g$keywÜds
 .ğ
$k
.',';

797 
fÜ—ch
(
$®lšdexs
 
as
 
$k
 => 
$v
)

799 if(
¡¾’
(
$keywÜds
.
$k
)>=60)

803 if(!
š_¬¿y
(
$k
,
$t™Ëšdexs
))

805 if(
¡¾’
(
$k
) <= 2) ;

806 
	g$keywÜds
 .ğ
$k
.',';

811 
	g$desütiÚ
 = 
¡r_»¶aû
('ã€€', ' ', 
Œim
(
$desütiÚ
));

812 
	g$desütiÚ
 = 
¡r_»¶aû
('ï¼»', ' ', 
$desütiÚ
);

813 
	g$desütiÚ
 = 
¡r_»¶aû
('ï¼½', ' ', 
$desütiÚ
);

814 
	g$desütiÚ
 = 
´eg_»¶aû
("#[ \r\n\t]{1,}#is", ' ', 
$desütiÚ
);

815 
	g$desütiÚ
 = 
¡r_»¶aû
('å…³é”®å­—', '', 
$desütiÚ
);

816 
	g$desütiÚ
 = 
¡r_»¶aû
('å…³é”®è¯', '', 
$desütiÚ
);

817 
	g$desütiÚ
 = 
add¦ashes
(
$desütiÚ
);

818 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `#@__archives` SET `keywords`='$keywords',`description`='$description' WHERE id='{$aid}' ");

820 
	g$¥
 = 
nuÎ
;

821 
ShowMsg
("æˆåŠŸåˆ†ææŒ‡å®šæ–‡æ¡£çš„å…³é”®è¯ï¼", 
$ENV_GOBACK_URL
);

822 
ex™
();

828 if(
	g$dİo¡
=='attsAdd')

830 
CheckPurv›w
('a_Commend,sys_ArcBatch');

831 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
èè
	g$q¡r
 = $aid;

833 if(
	g$q¡r
=='')

835 
ShowMsg
("å‚æ•°æ— æ•ˆï¼",
$ENV_GOBACK_URL
);

836 
ex™
();

838 if(
em±y
(
$æagÇme
))

840 
ShowMsg
("å¿…é¡»æŒ‡å®šè¦æ·»åŠ çš„å±æ€§ï¼",
$ENV_GOBACK_URL
);

841 
ex™
();

843 
	g$¬cids
 = 
´eg_»¶aû
("#[^0-9,]#", '',…»g_»¶aû("#`#", ',', 
$q¡r
));

844 
	g$qu”y
 = "SELECT‡rc.id,arc.typeid,ch.issystem,ch.maintable,ch.addtable FROM `#@__arctiny`‡rc

845 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


846 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=

.
chªÃÉy³


847 
WHERE
 
¬c
.
id
 
š
(
$¬cids
) ";

848 
$dsql
->
S‘Qu”y
(
$qu”y
);

849 
	g$dsql
->
Execu‹
();

850 
	g$row
 = 
$dsql
->
G‘A¼ay
())

852 
$aid
 = 
$row
['id'];

853 if(
	g$row
['issystem'] != -1)

855 
$mašbË
 = ( 
Œim
(
$row
['maintable'])=='' ? '#@__archives' :rim($row['maintable']) );

856 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT flag FROM `{$maintable}` WHERE id='$aid' ");

857 
	g$æag
 = (
$¬r
['æag']=='' ? 
$æagÇme
 : $arr['flag'].','.$flagname);

858 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `{$maintable}` SET `flag`='$flag' WHERE id='{$aid}' ");

862 
	g$mašbË
 = 
Œim
(
$row
['addtable']);

863 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT flag FROM `{$maintable}` WHERE‡id='$aid' ");

864 
	g$æag
 = (
$¬r
['æag']=='' ? 
$æagÇme
 : $arr['flag'].','.$flagname);

865 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `{$maintable}` SET `flag`='$flag' WHERE‡id='{$aid}' ");

868 
ShowMsg
("æˆåŠŸå¯¹é€‰ä¸­æ–‡æ¡£å¢åŠ æŒ‡å®šçš„å±æ€§ï¼",
$ENV_GOBACK_URL
);

869 
ex™
();

875 if(
	g$dİo¡
=='attsDel')

877 
CheckPurv›w
('a_Commend,sys_ArcBatch');

878 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
èè
	g$q¡r
 = $aid;

879 if(
	g$q¡r
=='')

881 
ShowMsg
("å‚æ•°æ— æ•ˆï¼", 
$ENV_GOBACK_URL
);

882 
ex™
();

884 if(
em±y
(
$æagÇme
))

886 
ShowMsg
("å¿…é¡»æŒ‡å®šè¦åˆ é™¤çš„å±æ€§ï¼", 
$ENV_GOBACK_URL
);

887 
ex™
();

889 
	g$¬cids
 = 
´eg_»¶aû
("#[^0-9,]#", '',…»g_»¶aû("#`#", ',', 
$q¡r
));

890 
	g$qu”y
 = "SELECT‡rc.id,arc.typeid,ch.issystem,ch.maintable,ch.addtable FROM `#@__arctiny`‡rc

891 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


892 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=

.
chªÃÉy³


893 
WHERE
 
¬c
.
id
 
š
(
$¬cids
) ";

894 
$dsql
->
S‘Qu”y
(
$qu”y
);

895 
	g$dsql
->
Execu‹
();

896 
	g$row
 = 
$dsql
->
G‘A¼ay
())

898 
$aid
 = 
$row
['id'];

899 if(
	g$row
['issystem'] != -1)

901 
$idÇme
 = 'id';

902 
	g$mašbË
 = ( 
Œim
(
$row
['maintable'])=='' ? '#@__archives' :rim($row['maintable']) );

903 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT flag FROM `{$maintable}` WHERE id='$aid' ");

907 
	g$idÇme
 = 'aid';

908 
	g$mašbË
 = 
Œim
(
$row
['addtable']);

909 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT flag FROM `{$maintable}` WHERE‡id='$aid' ");

911 
	g$æag
 = 
$¬r
['flag'];

912 if(
Œim
(
$æag
)=='' || !
´eg_m©ch
("#".
$æagÇme
."#", $flag) )

918 
	g$æags
 = 
ex¶ode
(',', 
$æag
);

919 
	g$okæags
 = 
¬¿y
();

920 
fÜ—ch
(
$æags
 
as
 
$f
)

922 if(
	g$f
 !ğ
$æagÇme
è
$okæags
[] = 
$f
;

925 
	g$æag
 = 
Œim
(
još
(',', 
$okæags
));

926 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `{$maintable}` SET `flag`='$flag' WHERE {$idname}='{$aid}' ");

928 
ShowMsg
("æˆåŠŸå¯¹é€‰ä¸­æ–‡æ¡£åˆ é™¤æŒ‡å®šçš„å±æ€§ï¼", 
$ENV_GOBACK_URL
);

929 
ex™
();

935 if(
	g$dİo¡
=='attsDlg')

937 ifĞ!
em±y
(
$aid
è&&ƒm±y(
$q¡r
) ) $qstr = $aid;

939 
	g$dojobÇme
 = (
$dojob
=='attsDel' ? 'æ‰¹é‡åˆ é™¤å±æ€§' : 'æ‰¹é‡å¢åŠ å±æ€§');

940 
AjaxH—d
();

942 
	g$divÇme
 = 'attsDlg';

943 
	gecho
 "<div class='title' onmousemove=\"DropMoveHand('{$divname}', 225);\" onmousedown=\"DropStartHand();\" onmouseup=\"DropStopHand();\">\r\n";

944 
	gecho
 " <div class='titLeft'>{$dojobname}</div>\r\n";

945 
	gecho
 " <div class='titRight'><img src='images/ico-close.gif' style='cursor:pointer;' onclick='HideObj(\"{$divname}\");ChangeFullDiv(\"hide\");'‡lt='å…³é—­'itle='å…³é—­' /></div>\r\n";

946 
	gecho
 "</div>\r\n";

947 
	gecho
 "<form‚ame='quickeditform'‡ction='archives_do.php' method='post'>\r\n";

948 
	gecho
 "<inputype='hidden'‚ame='dopost' value='{$dojob}' />\r\n";

949 
	gecho
 "<inputype='hidden'‚ame='qstr' value='{$qstr}' />\r\n";

950 
	gecho
 "<table width='100%' style='margin-top:6px;z-index:9000;'>\r\n";

952 <
Œ
 
	gheight
='28'>

953 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;å± æ€§ï¼š</
	gtd
>

954 <
td
 
	gşass
='bline'>

955 <
šput
 
ty³
='hidd’' 
Çme
='Şdæag' 
v®ue
='<?ph°echØ$¬cRow['
æag
']; ?>' />

956 <?
php


957 
$dsql
->
S‘Qu”y
("SELECT * FROM `#@__arcatt` ORDER BY sortid ASC");

958 
	g$dsql
->
Execu‹
();

959 
	g$Œow
 = 
$dsql
->
G‘Objeù
())

961 if(
$Œow
->
©t
=='j' || $trow->att=='p') ;

962 
	gecho
 "<input class='np'ype='radio'‚ame='flagname' id='flags{$trow->att}' value='{$trow->att}' />{$trow->attname}.{$trow->att}";

965 </
	gtd
>

966 </
	gŒ
>

967 <
Œ
 
	gheight
='32'>

968 <
td
 
width
="80" 
şass
='blše'>&
nb¥
;æ–‡æ¡£
	gID
ï¼š</
	gtd
>

969 <
td
 
	gşass
='bline'>

970 <
šput
 
ty³
='‹xt' 
Çme
='tmpids' 
v®ue
="<?ph°echØ$q¡r; ?>" 
¡yË
='width:310px;overflow:hidden;' />

971 </
td
>

972 </
Œ
>

973 <
Œ
 
height
='32'>

974 <
td
 
cŞ¥ª
='2' 
®ign
='ûÁ”' 
¡yË
='padding-top:12px'>

975 <
šput
 
Çme
="imageF›ld" 
ty³
="image" 
¤c
="images/bu‰Ú_ok.gif" 
width
="60" 
height
="22" 
şass
="Å" 
bÜd”
="0" 
¡yË
="cursor:pointer" />

976 &
nb¥
;&
	gnb¥
;

977 <
img
 
	g¤c
="images/bu‰Ú_back.gif" 
width
="60" 
height
="22" 
bÜd”
="0" 
Úşick
='HideObj("<?ph°echØ$divÇme; ?>");ChªgeFuÎDiv("hide");' 
¡yË
="cursor:pointer" />

978 </
td
>

979 </
td
>

980 </
Œ
>

981 </
bË
>

982 </
fÜm
>

983 <?
php


989 if(
	g$dİo¡
=='getCatMap')

991 
»quœe_Úû
(
XAKINC
.'/typeunit.class.selector.php');

992 
AjaxH—d
();

994 
	g$divÇme
 = 'getCatMap';

995 
	gecho
 "<div class='title' style='cursor:default;'>\r\n";

996 
	gecho
 " <div class='titLeft'>æ ç›®å¿«é€Ÿé€‰æ‹©å™¨</div>\r\n";

997 
	gecho
 " <div class='titRight'><img src='images/ico-close.gif' style='cursor:pointer;' onclick='HideObj(\"{$divname}\");ChangeFullDiv(\"hide\");'‡lt='å…³é—­'itle='å…³é—­' /></div>\r\n";

998 
	gecho
 "</div>\r\n";

999 
	g$tus
 = 
Ãw
 
Ty³Un™S–eùÜ
();

1001 <
fÜm
 
	gÇme
='quick£l' 
aùiÚ
='javasüt:;' 
m‘hod
='get'>

1002 <
div
 
şass
='quicksel'>

1003 <?
php
 
$tus
->
Li¡AÎTy³
(
$chªÃlid
); ?>

1004 </
	gdiv
>

1005 <
div
 
	g®ign
='ûÁ”' 
şass
='quickselfoot'>

1006 <
img
 
¤c
="images/bu‰Ú_ok.gif" 
Úşick
="g‘S–C©('<?ph°echØ$rg‘id; ?>');" 
width
="60" 
height
="22" 
şass
="Å" 
bÜd”
="0" 
¡yË
="cursor:pointer" />

1007 &
nb¥
;&
	gnb¥
;

1008 <
img
 
	g¤c
="images/bu‰Ú_back.gif" 
Úşick
='HideObj("<?ph°echØ$divÇme; ?>");ChªgeFuÎDiv("hide");' 
width
="60" 
height
="22" 
bÜd”
="0" 
¡yË
="cursor:pointer" />

1009 </
div
>

1010 </
fÜm
>

1011 <?
php


	@E:\web\weixun\xakadmin\archives_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('a_Edit,a_AccEdit,a_MyEdit');

9 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

10 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
!='save')

16 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

17 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

18 
CË¬MyAddÚ
();

19 
	g$aid
 = 
štv®
(
$aid
);

22 
	g$¬cQu”y
 = "SELECT ch.typename‡s channelname,ar.membername‡s„ankname,arc.*

23 
FROM
 `#@
__¬chives
` 
¬c


24 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl


25 
LEFT
 
JOIN
 `#@
__¬üªk
` 
¬
 
ON
‡r.
¿nk
=
¬c
.
¬üªk
 
WHERE
‡rc.
id
='$aid'

28 
$¬cRow
 = 
$dsql
->
G‘OÃ
(
$¬cQu”y
);

29 if(!
is_¬¿y
(
$¬cRow
))

31 
ShowMsg
("è¯»å–æ¡£æ¡ˆåŸºæœ¬ä¿¡æ¯å‡ºé”™!","-1");

32 
ex™
();

35 
	g$qu”y
 = "SELECT * FROM `#@__chªÃÉy³` WHERE id='".
$¬cRow
['channel']."'";

36 
	g$cInfos
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

37 if(!
is_¬¿y
(
$cInfos
))

39 
ShowMsg
("è¯»å–é¢‘é“é…ç½®ä¿¡æ¯å‡ºé”™!","javascript:;");

40 
ex™
();

42 
	g$addbË
 = 
$cInfos
['addtable'];

43 
	g$addRow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `$addtable` WHERE‡id='$aid'");

44 
	g$chªÃlid
 = 
$¬cRow
['channel'];

45 
	g$gs
 = 
G‘Tags
(
$aid
);

46 
šşude
 
XAKINClude
("templets/archives_edit.htm");

47 
ex™
();

52 if(
	g$dİo¡
=='save')

54 
»quœe_Úû
(
XAKINC
.'/image.func.php');

55 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

56 
	g$æag
 = 
is£t
(
$æags
è? 
još
(',',$flags) : '';

57 
	g$nÙpo¡
 = 
is£t
(
$nÙpo¡
) && $notpost == 1 ? 1: 0;

59 if(
em±y
(
$ty³id2
)è
	g$ty³id2
 = 0;

60 if(!
is£t
(
$autokey
)è
	g$autokey
 = 0;

61 if(!
is£t
(
$»mÙe
)è
	g$»mÙe
 = 0;

62 if(!
is£t
(
$d–lšk
)è
	g$d–lšk
 = 0;

63 if(!
is£t
(
$autŞ™pic
)è
	g$autŞ™pic
 = 0;

64 if(!
is£t
(
$wr™”
)è
	g$wr™”
 = '';

66 if(
	g$ty³id
==0)

68 
ShowMsg
("è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼","-1");

69 
ex™
();

71 if(
em±y
(
$chªÃlid
))

73 
ShowMsg
("æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼","-1");

74 
ex™
();

76 if(!
CheckChªÃl
(
$ty³id
,
$chªÃlid
))

78 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼","-1");

79 
ex™
();

81 if(!
Te¡Purv›w
('a_Edit'))

83 if(
Te¡Purv›w
('a_AccEdit'))

85 
CheckC©®og
(
$ty³id
,"å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æ–‡æ¡£æƒé™ï¼");

89 
CheckArcAdmš
(
$id
,
$cu£rLogš
->
g‘U£rID
());

94 
	g$ty³_·¿m
 = 
$dsql
->
G‘OÃ
("SELECT ddimg_width, ddimg_height FROM `#@__arctype` WHERE id ='$typeid'");

95 if(!
em±y
(
$ty³_·¿m
['ddimg_width'])){

96 
	g$cfg_ddimg_width
 = 
$ty³_·¿m
['ddimg_width'];

98 if(!
em±y
(
$ty³_·¿m
['ddimg_height'])){

99 
	g$cfg_ddimg_height
 = 
$ty³_·¿m
['ddimg_height'];

103 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

104 
	g$sÜŒªk
 = 
AddDay
(
$pubd©e
, 
$sÜtup
);

105 
	g$ismake
 = 
$ishtml
==0 ? -1 : 0;

106 
	g$t™Ë
 = 
ú_sub¡rR
(
$t™Ë
, 
$cfg_t™Ë_maxËn
);

107 
	g$shÜ‰™Ë
 = 
ú_sub¡rR
(
$shÜ‰™Ë
, 36);

108 
	g$cŞÜ
 = 
ú_sub¡rR
(
$cŞÜ
, 7);

109 
	g$wr™”
 = 
ú_sub¡rR
(
$wr™”
, 20);

110 
	g$sourû
 = 
ú_sub¡rR
(
$sourû
, 30);

111 
	g$desütiÚ
 = 
ú_sub¡rR
(
$desütiÚ
, 
$cfg_auÙ_desütiÚ
);

112 
	g$keywÜds
 = 
Œim
(
ú_sub¡rR
(
$keywÜds
, 60));

113 
	g$f’ame
 = 
Œim
(
ú_sub¡rR
(
$f’ame
, 40));

114 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

115 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

116 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck')è
	g$¬üªk
 = -1;

118 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

121 if(
em±y
(
$ddi¤emÙe
)è
	g$ddi¤emÙe
 = 0;

123 
	g$l™pic
 = 
G‘DDImage
('nÚe', 
$piúame
, 
$ddi¤emÙe
);

126 
	g$šadd_f
 = '';

127 
	g$šadd_v
 = '';

128 if(!
em±y
(
$xak_addÚf›lds
))

130 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

131 
	g$šadd_f
 = '';

132 
	g$šadd_v
 = '';

133 if(
is_¬¿y
(
$addÚf›lds
))

135 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

137 if(
	g$v
=='')

141 
	g$vs
 = 
ex¶ode
(',',
$v
);

142 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

144 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

147 if(!
is£t
(
$
{
$vs
[0]}))

149 
	g$
{
	g$vs
[0]} = '';

151 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$id
);

153 
	g$šadd_f
 .ğ",`{$vs[0]}` = '".
$
{
$vs
[0]}."'";

159 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

161 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

163 if(
	g$»dœeùu¾
!='' && !
´eg_m©ch
("#j#", 
$æag
))

165 
	g$æag
 = (
$æag
=='' ? 'j' : $flag.',j');

169 if(
´eg_m©ch
("#j#", 
$æag
)è
	g$ismake
 = -1;

171 
	g$šQu”y
 = "UPDATE `#@__archives` SET

172 
ty³id
='$typeid',

173 
	gty³id2
='$typeid2',

174 
	gsÜŒªk
='$sortrank',

175 
	gæag
='$flag',

176 
	gnÙpo¡
='$notpost',

177 
	gşick
='$click',

178 
	gismake
='$ismake',

179 
	g¬üªk
='$arcrank',

180 
	gmÚey
='$money',

181 
	gt™Ë
='$title',

182 
	gcŞÜ
='$color',

183 
	gwr™”
='$writer',

184 
	gsourû
='$source',

185 
	gl™pic
='$litpic',

186 
	gpubd©e
='$pubdate',

187 
	gdesütiÚ
='$description',

188 
	gkeywÜds
='$keywords',

189 
	gshÜ‰™Ë
='$shorttitle',

190 
	gf’ame
='$filename',

191 
	gdutyadmš
='$adminid',

192 
	gweight
='$weight'

193 
WHERE
 
id
='$id'; ";

194 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

196 
ShowMsg
("æ›´æ–°æ•°æ®åº“archivesè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼","-1");

197 
ex™
();

200 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable From `#@__channeltype` WHERE id='$channelid' ");

201 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

202 if(
	g$addbË
!='')

204 
$u£
 = 
G‘IP
();

205 
	g$iqu”y
 = "UPDATE `$addtable` SETypeid='$typeid'{$inadd_f},redirecturl='$redirecturl',userip='$useip' WHERE‡id='$id' ";

206 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$iqu”y
))

208 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addtable` æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥åŸå› ï¼","javascript:;");

209 
ex™
();

214 
UpIndexKey
(
$id
, 
$¬üªk
, 
$ty³id
, 
$sÜŒªk
, 
$gs
);

215 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

217 if(
$£rv™”m
!="")

219 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$£rv™”m
);

220 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
, '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

222 
	g$cÚfig
=
¬¿y
();

224 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

226 
	g$¬tU¾
 = 
MakeA¹
(
$id
, 
TRUE
, TRUE, 
$i¤emÙe
);

227 if(
	g$¬tU¾
=='')

229 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$id";

231 
CË¬MyAddÚ
(
$id
, 
$t™Ë
);

233 
	g$msg
 = "

235 <
a
 
h»f
='¬chives_add.php?cid=$ty³id'><
u
>å‘å¸ƒæ–°æ–‡æ¡£</u></a>

236 &
nb¥
;&
	gnb¥
;

237 <
a
 
	gh»f
='¬chives_do.php?aid=".$id."&dİo¡ód™Archives'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

238 &
nb¥
;&
	gnb¥
;

239 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡æ¡£</u></a>

240 &
nb¥
;&
	gnb¥
;

241 <
a
 
	gh»f
='ÿlog_do.php?cid=$ty³id&dİo¡öi¡Archives'><
u
>ç®¡ç†æ–‡æ¡£</u></a>

242 &
nb¥
;&
	gnb¥
;

243 
	g$backu¾


246 
	g$wšt™Ë
 = "æˆåŠŸæ›´æ”¹æ–‡æ¡£ï¼";

247 
	g$wecome_šfo
 = "æ–‡æ¡£ç®¡ç†::æ›´æ”¹æ–‡æ¡£";

248 
	g$wš
 = 
Ãw
 
OxWšdow
();

249 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹æ–‡æ¡£ï¼š");

250 
	g$wš
->
AddMsgI‹m
(
$msg
);

251 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

252 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\archives_sg_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('a_New,a_AccNew');

9 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

10 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
!='save')

16 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

17 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

18 
CË¬MyAddÚ
();

19 
	g$chªÃlid
 = 
em±y
(
$chªÃlid
è? 0 : 
štv®
($channelid);

20 
	g$cid
 = 
em±y
(
$cid
è? 0 : 
štv®
($cid);

23 if(
	g$cid
 > 0 && 
	g$chªÃlid
 == 0)

25 
$row
 = 
$dsql
->
G‘OÃ
("SELECT channeltype FROM `#@__arctype` WHERE id='$cid'; ");

26 
	g$chªÃlid
 = 
$row
['channeltype'];

30 if(
	g$chªÃlid
==0)

32 
ShowMsg
("æ— æ³•è¯†åˆ«æ¨¡å‹ä¿¡æ¯ï¼Œå› æ­¤æ— æ³•æ“ä½œï¼","-1");

33 
ex™
();

38 
	g$cInfos
 = 
$dsql
->
G‘OÃ
(" SELECT * FROM `#@__channeltype` WHERE id='$channelid' ");

39 
	g$chªÃlid
 = 
$cInfos
['id'];

40 
šşude
 
XAKINClude
("templets/archives_sg_add.htm");

41 
ex™
();

46 if(
	g$dİo¡
=='save')

48 
»quœe_Úû
(
XAKINC
.'/image.func.php');

49 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

51 if(
	g$ty³id
==0)

53 
ShowMsg
("è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼","-1");

54 
ex™
();

56 if(
em±y
(
$chªÃlid
))

58 
ShowMsg
("æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼","-1");

59 
ex™
();

61 if(!
CheckChªÃl
(
$ty³id
,
$chªÃlid
) )

63 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼","-1");

64 
ex™
();

66 if(!
Te¡Purv›w
('a_New'))

68 
CheckC©®og
(
$ty³id
,"å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æƒé™ï¼");

71 if(
em±y
(
$wr™”
))
	g$wr™”
=
$cu£rLogš
->
g‘U£rName
();

72 if(
em±y
(
$sourû
))
	g$sourû
='æœªçŸ¥';

73 if(
em±y
(
$æags
)è
	g$æag
 = '';

74 
	g$æag
 = 
još
(',', 
$æags
);

75 
	g$£ndd©e
 = 
time
();

76 
	g$t™Ë
 = 
ú_sub¡rR
(
$t™Ë
,
$cfg_t™Ë_maxËn
);

77 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

78 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

79 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck')è
	g$¬üªk
 = -1;

81 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

82 
	g$u£r
 = 
G‘IP
();

84 if(
em±y
(
$ddi¤emÙe
)è
	g$ddi¤emÙe
 = 0;

86 
	g$l™pic
 = 
G‘DDImage
('nÚe', 
$piúame
, 
$ddi¤emÙe
);

89 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
, 
$ty³id
, 
$£ndd©e
, 
$chªÃlid
, $£ndd©e, 
$admšid
);

91 if(
em±y
(
$¬cID
))

93 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

94 
ex™
();

98 
	g$šadd_f
 = '';

99 
	g$šadd_v
 = '';

100 if(!
em±y
(
$xak_addÚf›lds
))

102 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

103 
	g$šadd_f
 = '';

104 
	g$šadd_v
 = '';

105 if(
is_¬¿y
(
$addÚf›lds
))

107 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

109 if(
	g$v
=='')

113 
	g$vs
 = 
ex¶ode
(',',
$v
);

114 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

116 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

120 if(!
is£t
(
$
{
$vs
[0]}))

122 
	g$
{
	g$vs
[0]} = '';

124 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$¬cID
);

126 
	g$šadd_f
 .ğ','.
$vs
[0];

127 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

133 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

135 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

139 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

140 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

141 if(!
em±y
(
$addbË
))

143 
	g$qu”y
 = "INSERT INTO `{$addtable}`(aid,typeid,channel,arcrank,mid,click,title,senddate,flag,litpic,userip{$inadd_f})

144 
VALUES
('$¬cID','$ty³id','$chªÃlid','$¬üªk','$admšid','0','$t™Ë','$£ndd©e','$æag','$l™pic','$u£r'{
$šadd_v
})";

145 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

147 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

148 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

149 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addbË}` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

150 
ex™
();

155 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

157 if(
$£rv™”m
!="")

159 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$£rv™”m
);

160 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
, '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

162 
	g$cÚfig
=
¬¿y
();

164 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

166 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
, 
TRUE
, TRUE, 
$i¤emÙe
);

167 if(
	g$¬tU¾
=='')

169 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

171 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

173 
	g$msg
 = "

175 <
a
 
h»f
='¬chives_sg_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒæ–‡æ¡£</u></a>

176 &
nb¥
;&
	gnb¥
;

177 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡æ¡£</u></a>

178 &
nb¥
;&
	gnb¥
;

179 <
a
 
	gh»f
='¬chives_do.php?aid=".$¬cID."&dİo¡ód™Archives'><
u
>æ›´æ”¹æ–‡æ¡£</u></a>

180 &
nb¥
;&
	gnb¥
;

181 <
a
 
	gh»f
='cÚ‹Á_sg_li¡.php?cid=$ty³id&chªÃlid={$chªÃlid}&dİo¡öi¡Archives'><
u
>å·²å‘å¸ƒæ–‡æ¡£ç®¡ç†</u></a>

182 &
nb¥
;&
	gnb¥
;

183 <
a
 
	gh»f
='ÿlog_maš.php'><
u
>ç½‘ç«™æ ç›®ç®¡ç†</u></a>

186 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒæ–‡æ¡£ï¼";

187 
	g$wecome_šfo
 = "æ–‡æ¡£ç®¡ç†::å‘å¸ƒæ–‡æ¡£";

188 
	g$wš
 = 
Ãw
 
OxWšdow
();

189 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒæ–‡æ¡£ï¼š");

190 
	g$wš
->
AddMsgI‹m
(
$msg
);

191 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

192 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\archives_sg_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('a_Edit,a_AccEdit,a_MyEdit');

9 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

10 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
!='save')

16 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

17 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

18 
CË¬MyAddÚ
();

19 
	g$aid
 = 
štv®
(
$aid
);

22 
	g$¬cQu”y
 = "SELECT ch.*,arc.* FROM `#@__arctiny`‡rc

23 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
Ú
 ch.
id
=
¬c
.
chªÃl
 
WHERE
‡rc.id='$aid' ";

25 
$cInfos
 = 
$dsql
->
G‘OÃ
(
$¬cQu”y
);

26 if(!
is_¬¿y
(
$cInfos
))

28 
ShowMsg
("è¯»é¢‘é“æ¨¡å‹ä¿¡æ¯å‡ºé”™ï¼","-1");

29 
ex™
();

32 
	g$addbË
 = 
$cInfos
['addtable'];

33 
	g$addRow
 = 
$dsql
->
G‘OÃ
("SELECT‡rc.*,ar.membername‡s„ankname FROM `$addtable`‡rc LEFT JOIN `#@__arcrank`‡r on‡r.rank=arc.arcrank WHERE‡rc.aid='$aid'");

34 
	g$chªÃlid
 = 
$cInfos
['channel'];

35 
	g$gs
 = 
G‘Tags
(
$aid
);

36 
šşude
 
XAKINClude
('templets/archives_sg_edit.htm');

37 
ex™
();

42 if(
	g$dİo¡
=='save')

44 
»quœe_Úû
(
XAKINC
.'/image.func.php');

45 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

46 if(
	g$ty³id
==0)

48 
ShowMsg
("è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼","-1");

49 
ex™
();

51 if(
em±y
(
$chªÃlid
))

53 
ShowMsg
("æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼","-1");

54 
ex™
();

56 if(!
CheckChªÃl
(
$ty³id
,
$chªÃlid
))

58 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼","-1");

59 
ex™
();

61 if(!
Te¡Purv›w
('a_Edit'))

63 if(
Te¡Purv›w
('a_AccEdit'))

65 
CheckC©®og
(
$ty³id
, "å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æ–‡æ¡£æƒé™ï¼");

69 
CheckArcAdmš
(
$id
,
$cu£rLogš
->
g‘U£rID
());

73 if(
em±y
(
$æags
)è
	g$æag
 = '';

74 
	g$æag
 = 
još
(',', 
$æags
);

75 
	g$t™Ë
 = 
ú_sub¡rR
(
$t™Ë
, 
$cfg_t™Ë_maxËn
);

76 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

77 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

78 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck')è
	g$¬üªk
 = -1;

80 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

83 if(
em±y
(
$ddi¤emÙe
)è
	g$ddi¤emÙe
 = 0;

84 
	g$l™pic
 = 
G‘DDImage
('nÚe', 
$piúame
, 
$ddi¤emÙe
);

87 
	g$šadd_f
 = '';

88 
	g$šadd_v
 = '';

89 if(!
em±y
(
$xak_addÚf›lds
))

91 
	g$addÚf›lds
 = 
ex¶ode
(';', 
$xak_addÚf›lds
);

92 
	g$šadd_f
 = '';

93 
	g$šadd_v
 = '';

94 if(
is_¬¿y
(
$addÚf›lds
))

96 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

98 if(
	g$v
=='')

102 
	g$vs
 = 
ex¶ode
(',',
$v
);

103 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

105 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

108 if(!
is£t
(
$
{
$vs
[0]}))

110 
	g$
{
	g$vs
[0]} = '';

112 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$id
);

114 
	g$šadd_f
 .ğ",`{$vs[0]}` = '".
$
{
$vs
[0]}."'";

120 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

122 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

125 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

126 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

127 if(
	g$addbË
!='')

129 
$iqu”y
 = "UPDATE `$addtable` SETypeid='$typeid',arcrank='$arcrank',title='$title',flag='$flag',litpic='$litpic'{$inadd_f} WHERE‡id='$id' ";

130 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$iqu”y
))

132 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addtable` æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥åŸå› ï¼","javascript:;");

133 
ex™
();

138 
UpIndexKey
(
$id
, 
$¬üªk
, 
$ty³id
, 
$sÜŒªk
, '');

139 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

141 if(
$£rv™”m
!="")

143 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$£rv™”m
);

144 
	g$cÚfig
 = 
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

145 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

147 
	g$cÚfig
 = 
¬¿y
();

149 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

152 
	g$¬tU¾
 = 
MakeA¹
(
$id
, 
TRUE
, TRUE, 
$i¤emÙe
);

153 if(
	g$¬tU¾
==''è
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$id";

155 
CË¬MyAddÚ
(
$id
, 
$t™Ë
);

157 
	g$msg
 = "

159 <
a
 
h»f
='¬chives_sg_add.php?cid=$ty³id'><
u
>å‘å¸ƒæ–°æ–‡æ¡£</u></a>

160 &
nb¥
;&
	gnb¥
;

161 <
a
 
	gh»f
='¬chives_do.php?aid=".$id."&dİo¡ód™Archives'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

162 &
nb¥
;&
	gnb¥
;

163 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡æ¡£</u></a>

164 &
nb¥
;&
	gnb¥
;

165 <
a
 
	gh»f
='ÿlog_do.php?cid=$ty³id&chªÃlid={$chªÃlid}&dİo¡öi¡Archives'><
u
>ç®¡ç†æ–‡æ¡£</u></a>

166 &
nb¥
;&
	gnb¥
;

167 <
a
 
	gh»f
='ÿlog_maš.php'><
u
>ç½‘ç«™æ ç›®ç®¡ç†</u></a>

170 
$wšt™Ë
 = "æˆåŠŸæ›´æ”¹æ–‡æ¡£ï¼";

171 
	g$wecome_šfo
 = "æ–‡æ¡£ç®¡ç†::æ›´æ”¹æ–‡æ¡£";

172 
	g$wš
 = 
Ãw
 
OxWšdow
();

173 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹æ–‡æ¡£ï¼š");

174 
	g$wš
->
AddMsgI‹m
(
$msg
);

175 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

176 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_add.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

3 
CheckPurv›w
('a_New,a_AccNew');

4 
»quœe_Úû
(
XAKINC
.'/customfields.func.php');

5 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

6 if(
fe_exi¡s
(
XAKDATA
.'/template.rand.php'))

8 
»quœe_Úû
(
XAKDATA
.'/template.rand.php');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
	g$dİo¡
!='save')

14 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

15 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

16 
CË¬MyAddÚ
();

17 
	g$chªÃlid
 = 
em±y
(
$chªÃlid
è? 0 : 
štv®
($channelid);

18 
	g$cid
 = 
em±y
(
$cid
è? 0 : 
štv®
($cid);

20 if(
em±y
(
$g‘u¾
)è
	g$g‘u¾
 = '';

22 
	g$keywÜds
 = 
$wr™”
 = 
$sourû
 = 
$body
 = 
$desütiÚ
 = 
$t™Ë
 = '';

25 if(
´eg_m©ch
("#^h‰p:\/\/#", 
$g‘u¾
))

27 
»quœe_Úû
(
XAKADMIN
."/inc/inc_coonepage.php");

28 
	g$»d©as
 = 
CoOÃPage
(
$g‘u¾
);

29 
exŒaù
(
$»d©as
);

33 if(
	g$cid
>0 && 
	g$chªÃlid
==0)

35 
$row
 = 
$dsql
->
G‘OÃ
("Select channeltype From `#@__arctype` where id='$cid'; ");

36 
	g$chªÃlid
 = 
$row
['channeltype'];

40 if(
	g$chªÃlid
==0)

42 
$chªÃlid
 = 1;

47 
	g$cInfos
 = 
$dsql
->
G‘OÃ
(" Select * From `#@__channeltype` where id='$channelid' ");

50 
	g$maxWright
 = 
$dsql
->
G‘OÃ
("SELECT id+1 AS cc FROM #@__archives ORDER BY id DESC");

52 
šşude
 
XAKINClude
("templets/article_add.htm");

53 
ex™
();

59 if(
	g$dİo¡
=='save')

61 
»quœe_Úû
(
XAKINC
.'/image.func.php');

62 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

63 
	g$æag
 = 
is£t
(
$æags
è? 
još
(',',$flags) : '';

64 
	g$nÙpo¡
 = 
is£t
(
$nÙpo¡
) && $notpost == 1 ? 1: 0;

66 if(
em±y
(
$ty³id2
)è
	g$ty³id2
 = '';

67 if(!
is£t
(
$autokey
)è
	g$autokey
 = 0;

68 if(!
is£t
(
$»mÙe
)è
	g$»mÙe
 = 0;

69 if(!
is£t
(
$d–lšk
)è
	g$d–lšk
 = 0;

70 if(!
is£t
(
$autŞ™pic
)è
	g$autŞ™pic
 = 0;

71 if(
em±y
(
$şick
)è
	g$şick
 = (
$cfg_¬c_şick
=='-1' ? 
mt_¿nd
(50, 200) : $cfg_arc_click);

73 if(
em±y
(
$ty³id
))

75 
ShowMsg
("è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼","-1");

76 
ex™
();

78 if(
em±y
(
$chªÃlid
))

80 
ShowMsg
("æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼","-1");

81 
ex™
();

83 if(!
CheckChªÃl
(
$ty³id
,
$chªÃlid
))

85 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼","-1");

86 
ex™
();

88 if(!
Te¡Purv›w
('a_New'))

90 
CheckC©®og
(
$ty³id
,"å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æƒé™ï¼");

94 
	g$ty³_·¿m
 = 
$dsql
->
G‘OÃ
("SELECT ddimg_width, ddimg_height FROM `#@__arctype` WHERE id ='$typeid'");

95 if(!
em±y
(
$ty³_·¿m
['ddimg_width'])){

96 
	g$cfg_ddimg_width
 = 
$ty³_·¿m
['ddimg_width'];

98 if(!
em±y
(
$ty³_·¿m
['ddimg_height'])){

99 
	g$cfg_ddimg_height
 = 
$ty³_·¿m
['ddimg_height'];

103 if(
em±y
(
$wr™”
))
	g$wr™”
=
$cu£rLogš
->
g‘U£rName
();

104 if(
em±y
(
$sourû
))
	g$sourû
='æœªçŸ¥';

105 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

106 
	g$£ndd©e
 = 
time
();

107 
	g$sÜŒªk
 = 
AddDay
(
$pubd©e
,
$sÜtup
);

108 
	g$ismake
 = 
$ishtml
==0 ? -1 : 0;

109 
	g$t™Ë
 = 
´eg_»¶aû
("#\"#", 'ï¼‚', 
$t™Ë
);

110 
	g$t™Ë
 = 
html¥ecŸlch¬s
(
ú_sub¡rR
(
$t™Ë
,
$cfg_t™Ë_maxËn
));

111 
	g$shÜ‰™Ë
 = 
ú_sub¡rR
(
$shÜ‰™Ë
,36);

112 
	g$cŞÜ
 = 
ú_sub¡rR
(
$cŞÜ
,7);

113 
	g$wr™”
 = 
ú_sub¡rR
(
$wr™”
,20);

114 
	g$sourû
 = 
ú_sub¡rR
(
$sourû
,30);

115 
	g$desütiÚ
 = 
ú_sub¡rR
(
$desütiÚ
,
$cfg_auÙ_desütiÚ
);

116 
	g$keywÜds
 = 
ú_sub¡rR
(
$keywÜds
,60);

117 
	g$f’ame
 = 
Œim
(
ú_sub¡rR
(
$f’ame
,40));

118 
	g$u£r
 = 
G‘IP
();

119 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

120 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

122 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck'))

124 
	g$¬üªk
 = -1;

126 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

129 if(
em±y
(
$ddi¤emÙe
))

131 
	g$ddi¤emÙe
 = 0;

134 
	g$l™pic
 = 
G‘DDImage
('nÚe', 
$piúame
, 
$ddi¤emÙe
);

137 
	g$¬cID
 = 
G‘IndexKey
(
$¬üªk
,
$ty³id
,
$sÜŒªk
,
$chªÃlid
,
$£ndd©e
,
$admšid
);

139 if(
em±y
(
$¬cID
))

141 
ShowMsg
("æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œï¼","-1");

142 
ex™
();

144 if(
Œim
(
$t™Ë
) == '')

146 
ShowMsg
('æ ‡é¢˜ä¸èƒ½ä¸ºç©º', '-1');

147 
ex™
();

151 
	g$body
 = 
AÇly£HtmlBody
(
$body
,
$desütiÚ
,
$l™pic
,
$keywÜds
,'htmltext');

154 if(
	g$¥ty³
=='auto')

156 
$body
 = 
SpLÚgBody
($body,
$¥size
*1024,"#p#åˆ†é¡µæ ‡é¢˜#e#");

160 
	g$šadd_f
 = 
$šadd_v
 = '';

161 if(!
em±y
(
$xak_addÚf›lds
))

163 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

164 if(
is_¬¿y
(
$addÚf›lds
))

166 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

168 if(
	g$v
=='') ;

169 
	g$vs
 = 
ex¶ode
(',',
$v
);

170 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

172 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

176 if(!
is£t
(
$
{
$vs
[0]})è
	g$
{
	g$vs
[0]} = '';

177 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$¬cID
);

179 
	g$šadd_f
 .ğ','.
$vs
[0];

180 
	g$šadd_v
 .ğ" ,'".
$
{
$vs
[0]}."' ";

186 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

188 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

190 if(
	g$»dœeùu¾
!='' && !
´eg_m©ch
("#j#", 
$æag
))

192 
	g$æag
 = (
$æag
=='' ? 'j' : $flag.',j');

196 if(
´eg_m©ch
("#j#", 
$æag
)è
	g$ismake
 = -1;

199 
	g$qu”y
 = "INSERT INTO `#@__archives`(id,typeid,typeid2,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,

200 
cŞÜ
,
	gwr™”
,
	gsourû
,
	gl™pic
,
	gpubd©e
,
	g£ndd©e
,
	gmid
,
	gvÙeid
,
	gnÙpo¡
,
	gdesütiÚ
,
	gkeywÜds
,
	gf’ame
,
	gdutyadmš
,
	gweight
)

201 
VALUES
 ('$arcID','$typeid','$typeid2','$sortrank','$flag','$ismake','$channelid','$arcrank','$click','$money',

205 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

207 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

208 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

209 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸»è¡¨ `#@__¬chives` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

210 
ex™
();

214 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

215 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

216 if(
em±y
(
$addbË
))

218 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='$arcID'");

219 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$arcID'");

220 
ShowMsg
("æ²¡æ‰¾åˆ°å½“å‰æ¨¡å‹[{$channelid}]çš„ä¸»è¡¨ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œï¼ã€‚","javascript:;");

221 
ex™
();

223 
	g$u£
 = 
G‘IP
();

224 
	g$‹m¶‘
 = 
em±y
(
$‹m¶‘
) ? '' : $templet;

225 
	g$qu”y
 = "INSERT INTO `{$addtable}`(aid,typeid,redirecturl,templet,userip,body{$inadd_f}) Values('$arcID','$typeid','$redirecturl','$templet','$useip','$body'{$inadd_v})";

226 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

228 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

229 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__archives` where id='$arcID'");

230 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arctiny` where id='$arcID'");

231 
ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é™„åŠ è¡¨ `{$addbË}` æ—¶å‡ºé”™ã€‚".
¡r_»¶aû
('"','',
$g”r
),"javascript:;");

232 
ex™
();

235 
In£¹Tags
(
$gs
,
$¬cID
);

236 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

238 if(
$£rv™”m
!=""){

239 
li¡
(
$£rvu¾
,
$£rvu£r
,
$£rvpwd
èğ
ex¶ode
(',',
$£rv™”m
);

240 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
, '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

242 
	g$cÚfig
=
¬¿y
();

244 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

246 
	g$picT™Ë
 = 
çl£
;

247 if(
couÁ
(
$_SESSION
['bigfile_info']) > 0)

249 
fÜ—ch
 (
$_SESSION
['bigfe_šfo'] 
as
 
$k
 => 
$v
)

251 if(!
em±y
(
$v
))

253 
$più™Ë
 = 
$
{'picšfook'.
$k
};

254 
	g$t™ËS‘
 = '';

255 if(!
em±y
(
$più™Ë
))

257 
	g$picT™Ë
 = 
TRUE
;

258 
	g$t™ËS‘
 = ",title='{$pictitle}'";

260 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__uploads` SET‡rcid='{$arcID}'{$titleSet} WHERE url LIKE '{$v}'; ");

264 
	g$¬tU¾
 = 
MakeA¹
(
$¬cID
,
Œue
,Œue,
$i¤emÙe
);

265 if(
	g$¬tU¾
=='')

267 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$arcID";

269 
CË¬MyAddÚ
(
$¬cID
, 
$t™Ë
);

273 
	g$msg
 = " ã€€ã€€è¯·é€‰æ‹©ä½ çš„åç»­æ“ä½œï¼š

274 <
a
 
h»f
='¬tişe_add.php?cid=$ty³id'><
u
>ç»§ç»­å‘å¸ƒæ–‡ç« </u></a>

275 &
nb¥
;&
	gnb¥
;

276 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡ç« </u></a>

277 &
nb¥
;&
	gnb¥
;

278 <
a
 
	gh»f
='¬chives_do.php?aid=".$¬cID."&dİo¡ód™Archives'><
u
>æ›´æ”¹æ–‡ç« </u></a>

279 &
nb¥
;&
	gnb¥
;

280 <
a
 
	gh»f
='ÿlog_do.php?cid=$ty³id&dİo¡öi¡Archives'><
u
>å·²å‘å¸ƒæ–‡ç« ç®¡ç†</u></a>

281 &
nb¥
;&
	gnb¥
;

282 
	g$backu¾


284 
	g$msg
 = "<div styË=\"lše-height:36px;height:36px\">{$msg}</div>".
G‘Upd©eTe¡
();

285 
	g$wšt™Ë
 = "æˆåŠŸå‘å¸ƒæ–‡ç« ï¼";

286 
	g$wecome_šfo
 = "æ–‡ç« ç®¡ç†::å‘å¸ƒæ–‡ç« ";

287 
	g$wš
 = 
Ãw
 
OxWšdow
();

288 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒæ–‡ç« ï¼š");

289 
	g$wš
->
AddMsgI‹m
(
$msg
);

290 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

291 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_allowurl_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

9 
CheckPurv›w
('sys_Source');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
em±y
(
$®lu¾s
)è
	g$®lsourû
 = '';

12 
	g$®lu¾s
 = 
¡r¦ashes
(
$®lu¾s
);

14 
	g$m_fe
 = 
XAKDATA
."/admin/allowurl.txt";

17 if(
	g$dİo¡
=='save')

19 
$å
 = 
fİ’
(
$m_fe
,'w');

20 
æock
(
$å
,3);

21 
fwr™e
(
$å
,
$®lu¾s
);

22 
fşo£
(
$å
);

23 
	gecho
 "<script>alert('Save OK!');</script>";

26 if(
em±y
(
$®lu¾s
è&& 
fesize
(
$m_fe
)>0)

28 
	g$å
 = 
fİ’
(
$m_fe
,'r');

29 
	g$®lu¾s
 = 
ä—d
(
$å
,
fesize
(
$m_fe
));

30 
fşo£
(
$å
);

32 
	g$wšt™Ë
 = "";

33 
	g$wecome_šfo
 = "å…è®¸çš„è¶…é“¾æ¥";

34 
	g$wš
 = 
Ãw
 
OxWšdow
();

35 
	g$wš
->
In™
('article_allowurl_edit.php','js/blank.js','POST');

36 
	g$wš
->
AddHidd’
('dopost','save');

37 
	g$wš
->
AddT™Ë
("æ¯è¡Œä¿å­˜ä¸€ä¸ªè¶…é“¾æ¥ï¼š");

38 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='allurls' id='allurls' style='width:100%;height:300px'>$allurls</textarea>");

39 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

40 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_coonepage_rule.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

10 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

15 if(
	g$aùiÚ
 == 'add')

17 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__co_onepage` WHERE url LIKE '$url' ");

18 if(
is_¬¿y
(
$row
))

20 
	gecho
 "ç³»ç»Ÿå·²ç»å­˜åœ¨è¿™ä¸ªç½‘å€çš„æ¡ç›®ï¼";

22 
	g$qu”y
 = " INSERT INTO `#@__co_onepage`(`url`,`title`,`issource`,`lang`,`rule`) Values('$url','$title','$issource','$lang','$rule'); ";

23 
	g$dsql
->
Execu‹NÚequ”y
(
$qu”y
);

24 
echo
 
	g$dsql
->
G‘E¼Ü
();

30 if(
	g$aùiÚ
 == 'del')

32 if(!
´eg_m©ch
("#,#", 
$ids
))

34 
$qu”y
 = "DELETE FROM `#@__co_onepage` WHERE id='$ids' ";

38 
	g$qu”y
 = "DELETE FROM `#@__co_onepage` WHERE id IN($ids) ";

40 
	g$dsql
->
Execu‹NÚequ”y
(
$qu”y
);

46 if(
	g$aùiÚ
 == 'editsave')

48 
$qu”y
 = "UPDATE `#@__co_onepage` SET `url`='$url',`title`='$title',`issource`='$issource',`lang`='$lang',`rule`='$rule' WHERE id='$id' ";

49 
	g$dsql
->
Execu‹NÚequ”y
(
$qu”y
);

50 
echo
 
	g$dsql
->
G‘E¼Ü
();

55 if(
	g$aùiÚ
 == 'editload')

57 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__co_onepage` WHERE id='$id' ");

58 
AjaxH—d
();

60 <
fÜm
 
	gÇme
='addfÜm' 
aùiÚ
='¬tişe_coÚ•age_ruË.php' 
m‘hod
='post'>

61 <
šput
 
ty³
='hidd’' 
Çme
='id' 
v®ue
='<?phpƒcho $id; ?>' />

62 <
šput
 
ty³
='hidd’' 
Çme
='aùiÚ' 
v®ue
='editsave' />

63 <
bË
 
width
="430" 
bÜd”
="0" 
ûÎ¥acšg
="0" 
ûÎ·ddšg
="0">

64 <
Œ
>

65 <
td
 
width
="102" 
height
="30">ç½‘ç«™åç§°ï¼š</td>

66 <
td
 
width
="302"><
šput
 
Çme
="t™Ë" 
ty³
="‹xt" 
id
="t™Ë" 
¡yË
="width:200px" 
v®ue
="<?phpƒcho $row['title']; ?>" /></td>

67 <
td
 
width
="26" 
®ign
="ûÁ”"><
a
 
h»f
="javasüt:Clo£Ed™Node()"><
img
 
¤c
="images/şo£.gif" width="12" 
height
="12" 
bÜd”
="0" /></a></td>

68 </
Œ
>

69 <
Œ
>

70 <
td
 
height
="30">åŸå†…å®¹ç¼–ç ï¼š</td>

71 <
td
 
cŞ¥ª
="2">

72 <
šput
 
ty³
="¿dio" 
Çme
="Ïng" 
v®ue
="gb2312" <?
php
 
echo
 (
$row
['lang']=='gb2312' ? ' checked="checked" ' : ''); ?> />

73 
	gGB2312
/
	gGBK


74 <
šput
 
	gty³
="¿dio" 
Çme
="Ïng" 
v®ue
="utf-8" <?
php
 
echo
 (
$row
['lang']=='utf-8' ? ' checked="checked" ' : ''); ?> />

75 
	gUTF
-8

76 </
	gtd
>

77 </
	gŒ
>

78 <
	gŒ
>

79 <
td
 
	gheight
="30">ç”¨ä½œæ–‡ç« æ¥æºï¼š</td>

80 <
td
 
cŞ¥ª
="2">

81 <
šput
 
ty³
="¿dio" 
Çme
="issourû" 
v®ue
="0" <?
php
 
echo
 (
$row
['issource']==0 ? ' checked="checked" ' : ''); ?> />

83 <
šput
 
	gÇme
="issourû" 
ty³
="¿dio" 
v®ue
="1" <?
php
 
echo
 (
$row
['issource']==1 ? ' checked="checked" ' : ''); ?> />

85 </
	gtd
>

86 </
	gŒ
>

87 <
	gŒ
>

88 <
td
 
	gheight
="30">ç½‘ç«™ç½‘å€ï¼š</td>

89 <
td
 
cŞ¥ª
="2">

90 <
šput
 
Çme
="u¾" 
ty³
="‹xt" 
id
="u¾" 
v®ue
="<?ph°echØ$row['u¾']; ?>" 
¡yË
="width:200px" />

91 </
td
>

92 </
Œ
>

93 <
Œ
>

94 <
td
 
height
="30">&
nb¥
;</
	gtd
>

95 <
td
 
	gcŞ¥ª
="2">

96 ä½¿ç”¨ä¸å¸¦
h‰p
åŠä»»ä½•é™„åŠ ç›®å½•çš„ç½‘å€

97 </
td
>

98 </
Œ
>

99 <
Œ
>

100 <
td
 
height
="30">é‡‡é›†è§„åˆ™ï¼š</td>

101 <
td
 
cŞ¥ª
="2">ä»…é’ˆå¯¹æ–‡ç« å†…å®¹ï¼Œæ ¼å¼ï¼šå‰é¢
HTML
{@
body
}åé¢
HMTL
</td>

102 </
Œ
>

103 <
Œ
>

104 <
td
 
height
="90">&
nb¥
;</
	gtd
>

105 <
td
 
	gcŞ¥ª
="2"><
‹x»a
 
Çme
="ruË" 
¡yË
="width:300px;height:80px"><?
php
 
echo
 
$row
['ruË']; ?></
	g‹x»a
></
	gtd
>

106 </
	gŒ
>

107 <
	gŒ
>

108 <
td
 
	gheight
="32">&
nb¥
;</
	gtd
>

109 <
td
 
	gcŞ¥ª
="2"><
šput
 
şass
="nbt" 
ty³
="subm™" 
Çme
="Subm™" 
v®ue
="ä¿å­˜è§„åˆ™" />ã€€

110 <
šput
 
ty³
="»£t" 
şass
="nbt" 
Çme
="Subm™2" 
v®ue
="é‡ç½®" /></
td
>

111 </
Œ
>

112 </
bË
>

113 </
fÜm
>

114 <?
php


115 
ex™
();

120 
	g$sql
 = "";

121 
	g$sql
 = "SELECT id,url,title,lang,issource FROM `#@__co_onepage` ORDER BY id DESC";

122 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

123 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/article_coonepage_rule.htm");

124 
	g$dli¡
->
S‘Sourû
(
$sql
);

125 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_description_main.php

1 <?
	gphp


7 @
ob_¡¬t
();

8 @
£t_time_lim™
(3600);

9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

10 
CheckPurv›w
('sys_Keyword');

11 if(
em±y
(
$dojob
)è
	g$dojob
 = '';

12 if(
	g$dojob
=='')

14 
šşude
 
XAKINClude
("templets/article_description_main.htm");

15 
ex™
();

19 if(
em±y
(
$¡¬tdd
)è
	g$¡¬tdd
 = 0;

20 if(
em±y
(
$·gesize
)è
	g$·gesize
 = 100;

21 if(
em±y
(
$tÙ®num
)è
	g$tÙ®num
 = 0;

22 if(
em±y
(
$sid
)è
	g$sid
 = 0;

23 if(
em±y
(
$eid
)è
	g$eid
 = 0;

24 if(
em±y
(
$dojob
)è
	g$dojob
 = 'des';

26 
	g$bË
 = 
´eg_»¶aû
("#[^0-9a-zA-Z_\#@]#", "", 
$bË
);

27 
	g$f›ld
 = 
´eg_»¶aû
("#[^0-9a-zA-Z_\[\]]#", "", 
$f›ld
);

28 
	g$chªÃl
 = 
štv®
(
$chªÃl
);

29 if(
	g$dsize
>250) $dsize = 250;

30 
	g$tjnum
 = 0;

33 if(
	g$dojob
=='des')

35 if(
em±y
(
$tÙ®num
))

37 
$addqu”y
 = "";

38 if(
	g$sid
!=0)

40 
$addqu”y
 .= " AND id>='$sid' ";

42 if(
	g$eid
!=0)

44 
$addqu”y
 .= " AND id<='$eid' ";

46 
	g$tjQu”y
 = "SELECT COUNT(*) AS dd FROM #@__archives WHERE channel='{$channel}' $addquery";

47 
	g$row
 = 
$dsql
->
G‘OÃ
(
$tjQu”y
);

48 
	g$tÙ®num
 = 
$row
['dd'];

50 if(
	g$tÙ®num
 > 0)

52 
	g$addqu”y
 = "";

53 if(
	g$sid
!=0)

55 
$addqu”y
 .= " AND #@__archives.id>='$sid' ";

57 if(
	g$eid
!=0)

59 
$addqu”y
 .= " AND #@__archives.id<='$eid' ";

61 
	g$fqu”y
 = "SELECT #@__archives.id,#@__archives.title,#@__archives.description,{$table}.{$field}

62 
FROM
 #@
__¬chives
 
LEFT
 
JOIN
 {
$bË
} 
ON
 {$bË}.
aid
=#@__¬chives.
id


63 
WHERE
 #@
__¬chives
.
chªÃl
='{$chªÃl}' 
$addqu”y
 
LIMIT
 
$¡¬tdd
,
	g$·gesize
 ; ";

64 
	g$dsql
->
S‘Qu”y
(
$fqu”y
);

65 
	g$dsql
->
Execu‹
();

66 
	g$row
=
$dsql
->
G‘A¼ay
())

68 
$body
 = 
$row
[
$f›ld
];

69 
	g$desütiÚ
 = 
$row
['description'];

70 if(
¡¾’
(
$desütiÚ
)>10 || 
	g$desütiÚ
=='-')

74 
	g$body‹xt
 = 
´eg_»¶aû
("/#p#|#e#|å‰¯æ ‡é¢˜|åˆ†é¡µæ ‡é¢˜/isU","",
Html2Text
(
$body
));

75 if(
¡¾’
(
$body‹xt
è< 
	g$msize
)

79 
	g$des
 = 
Œim
(
add¦ashes
(
ú_sub¡r
(
$body‹xt
,
$dsize
)));

80 if(
¡¾’
(
$des
)<3)

82 
	g$des
 = "-";

84 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__archives SET description='{$des}' WHERE id='{$row['id']}';");

88 
	g$¡¬tdd
 = 
$¡¬tdd
 + 
$·gesize
;

89 if(
	g$tÙ®num
 > 
	g$¡¬tdd
)

91 
	g$tjËn
 = 
û
Ğ(
$¡¬tdd
/
$tÙ®num
) * 100 );

93 
	g$tjËn
=100;

94 
ShowMsg
('å®Œæˆæ‰€æœ‰ä»»åŠ¡', 'javascript:;');

95 
ex™
();

97 
	g$dvËn
 = 
$tjËn
 * 2;

98 
	g$tj¡a
 = "<div style='width:200;height:15;border:1px solid #898989;text-align:left'><div style='width:$dvlen;height:15;background-color:#829D83'></div></div>";

99 
	g$tj¡a
 .= "<br/>å®Œæˆå¤„ç†æ–‡æ¡£æ€»æ•°çš„ï¼š$tjlen %ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡...";

100 
	g$nu¾
 = "article_description_main.php?totalnum=$totalnum&startdd={$startdd}&pagesize=$pagesize&table={$table}&field={$field}&dsize={$dsize}&msize={$msize}&channel={$channel}&dojob={$dojob}";

101 
ShowMsg
(
$tj¡a
,
$nu¾
,0,500);

102 
ex™
();

106 
ShowMsg
('å®Œæˆæ‰€æœ‰ä»»åŠ¡', 'javascript:;');

107 
ex™
();

112 if(
	g$dojob
=='page')

114 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

116 
	g$addqu”y
 = "";

117 if(
	g$sid
!=0)

119 
$addqu”y
 .= "‡nd‡id>='$sid' ";

121 if(
	g$eid
!=0)

123 
$addqu”y
 .= "‡nd‡id<='$eid' ";

127 if(
	g$tÙ®num
==0)

129 
$sql
 = "SELECT COUNT(*) AS dd FROM $table WHERE 1 $addquery";

130 
	g$row
 = 
$dsql
->
G‘OÃ
(
$sql
);

131 
	g$tÙ®num
 = 
$row
['dd'];

135 if(
	g$tÙ®num
 > 
	g$¡¬tdd
+
	g$·gesize
)

137 
	g$lim™Sql
 = " LIMIT $startdd,$pagesize";

139 if((
	g$tÙ®num
-
	g$¡¬tdd
)>0)

141 
	g$lim™Sql
 = " LIMIT $¡¬tdd,".(
$tÙ®num
 - 
$¡¬tdd
);

145 
	g$lim™Sql
 = "";

147 
	g$tjnum
 = 
$¡¬tdd
;

148 if(
	g$lim™Sql
!="")

150 
$fqu”y
 = "SELECT‡id,$field FROM $table WHERE 1 $addquery $limitSql ;";

151 
	g$dsql
->
S‘Qu”y
(
$fqu”y
);

152 
	g$dsql
->
Execu‹
();

153 
	g$row
=
$dsql
->
G‘A¼ay
())

155 
$tjnum
++;

156 
	g$body
 = 
$row
[
$f›ld
];

157 
	g$aid
 = 
$row
['aid'];

158 if(
¡¾’
(
$body
è< 
	g$msize
)

162 if(!
´eg_m©ch
("/#p#/iU",
$body
))

164 
	g$body
 = 
SpLÚgBody
(
$body
,
$cfg_¬ÿuto¥_size
*1024,"#p#åˆ†é¡µæ ‡é¢˜#e#");

165 
	g$body
 = 
add¦ashes
(
$body
);

166 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE $table SET $field='$body' WHERE‡id='$aid' ; ");

172 if(
	g$tÙ®num
>0)

174 
	g$tjËn
 = 
û
Ğ(
$tjnum
/
$tÙ®num
) * 100 );

178 
	g$tjËn
=100;

181 
	g$dvËn
 = 
$tjËn
 * 2;

183 
	g$tj¡a
 = "<div style='width:200;height:15;border:1px solid #898989;text-align:left'><div style='width:$dvlen;height:15;background-color:#829D83'></div></div>";

184 
	g$tj¡a
 .= "<br/>å®Œæˆå¤„ç†æ–‡æ¡£æ€»æ•°çš„ï¼š$tjlen %ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡...";

186 if(
	g$tjnum
 < 
	g$tÙ®num
)

188 
	g$nu¾
 = "¬tişe_desütiÚ_maš.php?tÙ®num=$tÙ®num&¡¬tdd=".(
$¡¬tdd
+
$·gesize
)."&pagesize=$pagesize&table={$table}&field={$field}&dsize={$dsize}&msize={$msize}&channel={$channel}&dojob={$dojob}";

189 
ShowMsg
(
$tj¡a
,
$nu¾
,0,500);

190 
ex™
();

194 
ShowMsg
('å®Œæˆæ‰€æœ‰ä»»åŠ¡', 'javascript:;');

195 
ex™
();

	@E:\web\weixun\xakadmin\article_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('a_Edit,a_AccEdit,a_MyEdit');

9 
»quœe_Úû
(
XAKINC
."/customfields.func.php");

10 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

11 if(
fe_exi¡s
(
XAKDATA
.'/template.rand.php'))

13 
»quœe_Úû
(
XAKDATA
.'/template.rand.php');

15 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

18 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

19 if(
	g$dİo¡
!='save')

21 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

22 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

23 
CË¬MyAddÚ
();

26 
	g$qu”y
 = "SELECT ch.typename AS channelname,ar.membername AS„ankname,arc.*

27 
FROM
 `#@
__¬chives
` 
¬c


28 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl


29 
LEFT
 
JOIN
 `#@
__¬üªk
` 
¬
 
ON
‡r.
¿nk
=
¬c
.
¬üªk
 
WHERE
‡rc.
id
='$aid' ";

30 
$¬cRow
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

31 if(!
is_¬¿y
(
$¬cRow
))

33 
ShowMsg
("è¯»å–æ¡£æ¡ˆåŸºæœ¬ä¿¡æ¯å‡ºé”™!","-1");

34 
ex™
();

36 
	g$qu”y
 = "SELECT * FROM `#@__chªÃÉy³` WHERE id='".
$¬cRow
['channel']."'";

37 
	g$cInfos
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

38 if(!
is_¬¿y
(
$cInfos
))

40 
ShowMsg
("è¯»å–é¢‘é“é…ç½®ä¿¡æ¯å‡ºé”™!","javascript:;");

41 
ex™
();

43 
	g$addbË
 = 
$cInfos
['addtable'];

44 
	g$addRow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `$addtable` WHERE‡id='$aid'");

45 if(!
is_¬¿y
(
$addRow
))

47 
ShowMsg
("è¯»å–é™„åŠ ä¿¡æ¯å‡ºé”™!","javascript:;");

48 
ex™
();

50 
	g$chªÃlid
 = 
$¬cRow
['channel'];

51 
	g$gs
 = 
G‘Tags
(
$aid
);

52 
šşude
 
XAKINClude
("templets/article_edit.htm");

53 
ex™
();

58 if(
	g$dİo¡
=='save')

60 
»quœe_Úû
(
XAKINC
.'/image.func.php');

61 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

62 
	g$æag
 = 
is£t
(
$æags
è? 
još
(',',$flags) : '';

63 
	g$nÙpo¡
 = 
is£t
(
$nÙpo¡
) && $notpost == 1 ? 1: 0;

65 if(
em±y
(
$ty³id2
)è
	g$ty³id2
 = 0;

66 if(!
is£t
(
$autokey
)è
	g$autokey
 = 0;

67 if(!
is£t
(
$»mÙe
)è
	g$»mÙe
 = 0;

68 if(!
is£t
(
$d–lšk
)è
	g$d–lšk
 = 0;

69 if(!
is£t
(
$autŞ™pic
)è
	g$autŞ™pic
 = 0;

71 if(
em±y
(
$ty³id
))

73 
ShowMsg
("è¯·æŒ‡å®šæ–‡æ¡£çš„æ ç›®ï¼", "-1");

74 
ex™
();

76 if(
em±y
(
$chªÃlid
))

78 
ShowMsg
("æ–‡æ¡£ä¸ºéæŒ‡å®šçš„ç±»å‹ï¼Œè¯·æ£€æŸ¥ä½ å‘å¸ƒå†…å®¹çš„è¡¨å•æ˜¯å¦åˆæ³•ï¼", "-1");

79 
ex™
();

81 if(!
CheckChªÃl
(
$ty³id
, 
$chªÃlid
))

83 
ShowMsg
("ä½ æ‰€é€‰æ‹©çš„æ ç›®ä¸å½“å‰æ¨¡å‹ä¸ç›¸ç¬¦ï¼Œè¯·é€‰æ‹©ç™½è‰²çš„é€‰é¡¹ï¼", "-1");

84 
ex™
();

86 if(!
Te¡Purv›w
('a_Edit'))

88 if(
Te¡Purv›w
('a_AccEdit'))

90 
CheckC©®og
(
$ty³id
, "å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æ“ä½œæ ç›® {$typeid} çš„æ–‡æ¡£æƒé™ï¼");

94 
CheckArcAdmš
(
$id
, 
$cu£rLogš
->
g‘U£rID
());

99 
	g$ty³_·¿m
 = 
$dsql
->
G‘OÃ
("SELECT ddimg_width, ddimg_height FROM `#@__arctype` WHERE id ='$typeid'");

100 if(!
em±y
(
$ty³_·¿m
['ddimg_width'])){

101 
	g$cfg_ddimg_width
 = 
$ty³_·¿m
['ddimg_width'];

103 if(!
em±y
(
$ty³_·¿m
['ddimg_height'])){

104 
	g$cfg_ddimg_height
 = 
$ty³_·¿m
['ddimg_height'];

108 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

109 
	g$sÜŒªk
 = 
AddDay
(
$pubd©e
,
$sÜtup
);

110 
	g$ismake
 = 
$ishtml
==0 ? -1 : 0;

111 
	g$autokey
 = 1;

112 
	g$t™Ë
 = 
html¥ecŸlch¬s
(
ú_sub¡rR
(
$t™Ë
,
$cfg_t™Ë_maxËn
));

113 
	g$shÜ‰™Ë
 = 
ú_sub¡rR
(
$shÜ‰™Ë
,36);

114 
	g$cŞÜ
 = 
ú_sub¡rR
(
$cŞÜ
,7);

115 
	g$wr™”
 = 
ú_sub¡rR
(
$wr™”
,20);

116 
	g$sourû
 = 
ú_sub¡rR
(
$sourû
,30);

117 
	g$desütiÚ
 = 
ú_sub¡rR
(
$desütiÚ
,
$cfg_auÙ_desütiÚ
);

118 
	g$keywÜds
 = 
Œim
(
ú_sub¡rR
(
$keywÜds
,60));

119 
	g$f’ame
 = 
Œim
(
ú_sub¡rR
(
$f’ame
,40));

120 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

121 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

122 if(!
Te¡Purv›w
('a_Check,a_AccCheck,a_MyCheck'))

124 
	g$¬üªk
 = -1;

126 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

129 if(
em±y
(
$ddi¤emÙe
))

131 
	g$ddi¤emÙe
 = 0;

133 
	g$l™pic
 = 
G‘DDImage
('nÚe',
$piúame
,
$ddi¤emÙe
);

136 
	g$body
 = 
AÇly£HtmlBody
(
$body
,
$desütiÚ
,
$l™pic
,
$keywÜds
,'htmltext');

139 
	g$šadd_f
 = '';

140 
	g$šadd_v
 = '';

141 if(!
em±y
(
$xak_addÚf›lds
))

143 
	g$addÚf›lds
 = 
ex¶ode
(';',
$xak_addÚf›lds
);

144 
	g$šadd_f
 = '';

145 
	g$šadd_v
 = '';

146 if(
is_¬¿y
(
$addÚf›lds
))

148 
fÜ—ch
(
$addÚf›lds
 
as
 
$v
)

150 if(
	g$v
=='')

154 
	g$vs
 = 
ex¶ode
(',',
$v
);

155 if(
	g$vs
[1]=='htmÉext'||
$vs
[1]=='textdata')

157 
$
{
$vs
[0]} = 
AÇly£HtmlBody
(${$vs[0]},
$desütiÚ
,
$l™pic
,
$keywÜds
,$vs[1]);

160 if(!
is£t
(
$
{
$vs
[0]}))

162 
	g$
{
	g$vs
[0]} = '';

164 
	g$
{
	g$vs
[0]} = 
G‘F›ldV®ueA
(
$
{
$vs
[0]},$vs[1],
$id
);

166 
	g$šadd_f
 .ğ",`{$vs[0]}` = '".
$
{
$vs
[0]}."'";

172 if(
	g$l™pic
!='' && !
´eg_m©ch
("#p#", 
$æag
))

174 
	g$æag
 = (
$æag
=='' ? 'p' : $flag.',p');

176 if(
	g$»dœeùu¾
!='' && !
´eg_m©ch
("#j#", 
$æag
))

178 
	g$æag
 = (
$æag
=='' ? 'j' : $flag.',j');

182 if(
´eg_m©ch
("#j#", 
$æag
)è
	g$ismake
 = -1;

184 
	g$qu”y
 = "UPDATE #@__archives SET

185 
ty³id
='$typeid',

186 
	gty³id2
='$typeid2',

187 
	gsÜŒªk
='$sortrank',

188 
	gæag
='$flag',

189 
	gşick
='$click',

190 
	gismake
='$ismake',

191 
	g¬üªk
='$arcrank',

192 
	gmÚey
='$money',

193 
	gt™Ë
='$title',

194 
	gcŞÜ
='$color',

195 
	gwr™”
='$writer',

196 
	gsourû
='$source',

197 
	gl™pic
='$litpic',

198 
	gpubd©e
='$pubdate',

199 
	gvÙeid
='$voteid',

200 
	gnÙpo¡
='$notpost',

201 
	gdesütiÚ
='$description',

202 
	gkeywÜds
='$keywords',

203 
	gshÜ‰™Ë
='$shorttitle',

204 
	gf’ame
='$filename',

205 
	gdutyadmš
='$adminid',

206 
	gweight
='$weight'

207 
WHERE
 
id
='$id'; ";

209 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

211 
ShowMsg
('æ›´æ–°æ•°æ®åº“archivesè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥',-1);

212 
ex™
();

215 
	g$ùs
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

216 
	g$addbË
 = 
Œim
(
$ùs
['addtable']);

217 if(
	g$addbË
!='')

219 
$u£
 = 
G‘IP
();

220 
	g$‹m¶‘
 = 
em±y
(
$‹m¶‘
) ? '' : $templet;

221 
	g$iqu”y
 = "UPDATE `$addtable` SETypeid='$typeid',body='$body'{$inadd_f},redirecturl='$redirecturl',templet='$templet',userip='$useip' WHERE‡id='$id'";

222 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$iqu”y
))

224 
ShowMsg
("æ›´æ–°é™„åŠ è¡¨ `$addtable` æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥åŸå› ï¼","javascript:;");

225 
ex™
();

230 
UpIndexKey
(
$id
, 
$¬üªk
, 
$ty³id
, 
$sÜŒªk
, 
$gs
);

231 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

233 if(
$£rv™”m
!=""){

234 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$£rv™”m
);

235 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

236 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

238 
	g$cÚfig
=
¬¿y
();

240 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

242 
	g$¬tU¾
 = 
MakeA¹
(
$id
,
Œue
,Œue,
$i¤emÙe
);

243 if(
	g$¬tU¾
=='')

245 
$¬tU¾
 = 
$cfg_phpu¾
."/view.php?aid=$id";

247 
CË¬MyAddÚ
(
$id
, 
$t™Ë
);

250 
	g$msg
 = "

252 <
a
 
h»f
='¬tişe_add.php?cid=$ty³id'><
u
>å‘å¸ƒæ–°æ–‡ç« </u></a>

253 &
nb¥
;&
	gnb¥
;

254 <
a
 
	gh»f
='¬chives_do.php?aid=".$id."&dİo¡ód™Archives'><
u
>æŸ¥çœ‹æ›´æ”¹</u></a>

255 &
nb¥
;&
	gnb¥
;

256 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æ–‡ç« </u></a>

257 &
nb¥
;&
	gnb¥
;

258 <
a
 
	gh»f
='ÿlog_do.php?cid=$ty³id&dİo¡öi¡Archives'><
u
>ç®¡ç†æ–‡ç« </u></a>

259 &
nb¥
;&
	gnb¥
;

260 
	g$backu¾


263 
	g$wšt™Ë
 = "æˆåŠŸæ›´æ”¹æ–‡ç« ï¼";

264 
	g$wecome_šfo
 = "æ–‡ç« ç®¡ç†::æ›´æ”¹æ–‡ç« ";

265 
	g$wš
 = 
Ãw
 
OxWšdow
();

266 
	g$wš
->
AddT™Ë
("æˆåŠŸæ›´æ”¹æ–‡ç« ï¼š");

267 
	g$wš
->
AddMsgI‹m
(
$msg
);

268 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

269 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_keywords_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Keyword');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

15 if(
	g$dİo¡
=='saveall')

17 
$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? "article_keywords_main.php" : $_COOKIE['ENV_GOBACK_URL'];

18 if(!
is£t
(
$aids
))

20 
ShowMsg
("ä½ æ²¡æœ‰é€‰æ‹©è¦æ›´æ”¹çš„å†…å®¹ï¼",
$ENV_GOBACK_URL
);

21 
ex™
();

23 
fÜ—ch
(
$aids
 
as
 
$aid
)

25 
	g$½u¾
 = 
$
{'½u¾_'.
$aid
};

26 
	g$½u¾Şd
 = 
$
{'½u¾Şd_'.
$aid
};

27 
	g$keywÜd
 = 
$
{'keywÜd_'.
$aid
};

30 if(!
em±y
(
$
{'isd–_'.
$aid
}))

32 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__keywords` WHERE‡id='$aid'");

37 
	g$¡aŞd
 = 
$
{'¡aŞd_'.
$aid
};

38 
	g$¡a
 = 
em±y
(
$
{'i¢ou£_'.
$aid
}) ? 1 : 0;

39 if(
	g$¡aŞd
!=
$¡a
)

41 
$qu”y1
 = "UPDATE `#@__keywords` SET sta='$sta',rpurl='$rpurl' WHERE‡id='$aid' ";

42 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y1
);

47 if(
	g$½u¾
!=
$½u¾Şd
)

49 
$qu”y1
 = "UPDATE `#@__keywords` SET„purl='$rpurl' WHERE‡id='$aid' ";

50 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y1
);

53 
ShowMsg
("å®ŒæˆæŒ‡å®šçš„æ›´æ”¹ï¼",
$ENV_GOBACK_URL
);

54 
ex™
();

57 if(
	g$dİo¡
=='add')

59 
$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? "-1" : $_COOKIE['ENV_GOBACK_URL'];

60 
	g$keywÜd
 = 
Œim
(
$keywÜd
);

61 
	g$¿nk
 = 
´eg_»¶aû
("#[^0-9]#", '', 
$¿nk
);

62 if(
	g$keywÜd
=='')

64 
ShowMsg
("å…³é”®å­—ä¸èƒ½ä¸ºç©ºï¼",-1);

65 
ex™
();

67 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__keywords` WHERE keyword LIKE '$keyword'");

68 if(
is_¬¿y
(
$row
))

70 
ShowMsg
("å…³é”®å­—å·²å­˜åœ¨åº“ä¸­ï¼","-1");

71 
ex™
();

73 
	g$šqu”y
 = "INSERT INTO `#@__keywords`(keyword,rank,sta,rpurl) VALUES ('$keyword','$rank','1','$rpurl');";

74 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

75 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªå…³é”®å­—ï¼",
$ENV_GOBACK_URL
);

76 
ex™
();

78 if(
	$em±y
(
$keywÜd
))

80 
$keywÜd
 = '';

81 
$addqu”y
 = '';

82 
	}
}

85 
	g$addqu”y
 = " WHERE keyword LIKE '%$keyword%' ";

88 
	g$sql
 = "SELECT * FROM `#@__keywords` $addquery ORDER BY„ank DESC";

89 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

90 
	g$dli¡
->
	g·geSize
 = 20;

91 
	g$dli¡
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

92 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/article_keywords_main.htm");

93 
	g$dli¡
->
S‘Sourû
(
$sql
);

94 
	g$dli¡
->
Di¥Ïy
();

96 
funùiÚ
 
	$G‘S
(
$¡a
)

98 if(
$¡a
==1)  '';

100 
	}
}

	@E:\web\weixun\xakadmin\article_keywords_make.php

1 <?
	gphp


7 @
ob_¡¬t
();

8 @
£t_time_lim™
(3600);

9 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

10 
CheckPurv›w
('sys_Keyword');

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
=='analyse')

16 
echo
 "æ­£åœ¨è¯»å–å…³é”®å­—æ•°æ®åº“...<br/>\r\n";

17 
æush
();

18 
	g$ws
 = 
$w£¼
 = 
$w¢ew
 = "";

19 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__keywords`");

20 
	g$dsql
->
Execu‹
();

21 
	g$row
 = 
$dsql
->
G‘Objeù
())

23 if(
$row
->
¡a
==1è
$ws
[$row->
keywÜd
] = 1;

24 
	g$w£¼
[
$row
->
keywÜd
] = 1;

26 
	gecho
 "å®Œæˆå…³é”®å­—æ•°æ®åº“çš„è½½å…¥ï¼<br/>\r\n";

27 
æush
();

28 
	gecho
 "è¯»å–æ¡£æ¡ˆæ•°æ®åº“ï¼Œå¹¶å¯¹ç¦ç”¨çš„å…³é”®å­—å’Œç”Ÿå­—è¿›è¡Œå¤„ç†...<br/>\r\n";

29 
æush
();

30 
	g$dsql
->
S‘Qu”y
("SELECT id,keywords FROM `#@__archives`");

31 
	g$dsql
->
Execu‹
();

32 
	g$row
 = 
$dsql
->
G‘Objeù
())

34 
$keywÜds
 = 
ex¶ode
(',',
Œim
(
$row
->
keywÜds
));

35 
	g$Ã¼
 = 
çl£
;

36 
	g$mykey
 = '';

37 if(
is_¬¿y
(
$keywÜds
))

39 
fÜ—ch
(
$keywÜds
 
as
 
$v
)

41 
	g$v
 = 
Œim
(
$v
);

42 if(
	g$v
=='')

46 if(
is£t
(
$ws
[
$v
]))

48 
	g$mykey
 .ğ
$v
." ";

50 if(
is£t
(
$w¢ew
[
$v
]))

52 
	g$mykey
 .ğ
$v
.' ';

53 
	g$w¢ew
[
$v
]++;

55 if(
is£t
(
$w£¼
[
$v
]))

57 
	g$Ã¼
 = 
Œue
;

61 
	g$mykey
 .ğ
$v
." ";

62 
	g$w¢ew
[
$v
] = 1;

67 
	gecho
 "å®Œæˆæ¡£æ¡ˆæ•°æ®åº“çš„å¤„ç†ï¼<br/>\r\n";

68 
æush
();

69 if(
is_¬¿y
(
$w¢ew
))

71 
	gecho
 "å¯¹å…³é”®å­—è¿›è¡Œæ’åº...<br/>\r\n";

72 
æush
();

73 
¬sÜt
(
$w¢ew
);

74 
	gecho
 "æŠŠå…³é”®å­—ä¿å­˜åˆ°æ•°æ®åº“...<br/>\r\n";

75 
æush
();

76 
fÜ—ch
(
$w¢ew
 
as
 
$k
=>
$v
)

78 if(
¡¾’
(
$k
)>20)

82 
	g$dsql
->
S‘Qu”y
("INSERT INTO `#@__keywÜds`(keywÜd,¿nk,¡a,½u¾èVALUES('".
add¦ashes
(
$k
)."','$v','1','')");

83 
	g$dsql
->
Execu‹
();

85 
	gecho
 "å®Œæˆå…³é”®å­—çš„å¯¼å…¥ï¼<br/>\r\n";

86 
æush
();

87 
¦“p
(1);

91 
	gecho
 "æ²¡å‘ç°ä»»ä½•æ–°çš„å…³é”®å­—ï¼<br/>\r\n";

92 
æush
();

93 
¦“p
(1);

95 
ShowMsg
('å®Œæˆæ‰€æœ‰æ“ä½œï¼Œç°åœ¨è½¬åˆ°å…³é”®å­—åˆ—è¡¨é¡µï¼','article_keywords_main.php');

96 
ex™
();

99 if(
	g$dİo¡
=='fetch')

101 
»quœe_Úû
(
XAKINC
."/splitword.class.php");

102 if(
em±y
(
$¡¬tdd
))

104 
	g$¡¬tdd
 = 0;

106 if(
em±y
(
$·gesize
))

108 
	g$·gesize
 = 20;

110 if(
em±y
(
$tÙ®num
))

112 
	g$tÙ®num
 = 0;

116 if(
	g$tÙ®num
==0)

118 
$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__archives` WHERE channel='1' ");

119 
	g$tÙ®num
 = 
$row
['dd'];

123 if(
	g$tÙ®num
 > 
	g$¡¬tdd
+
	g$·gesize
)

125 
	g$lim™Sql
 = " LIMIT $startdd,$pagesize";

127 if((
	g$tÙ®num
-
	g$¡¬tdd
)>0)

129 
	g$lim™Sql
 = " LIMIT $¡¬tdd,".(
$tÙ®num
 - 
$¡¬tdd
);

133 
	g$lim™Sql
 = '';

135 
	g$tjnum
 = 
$¡¬tdd
;

136 if(
	g$lim™Sql
!='')

138 
$fqu”y
 = "SELECT‡rc.id,arc.title,arc.keywords,addon.body FROM `#@__archives`‡rc

139 
LEFT
 
JOIN
 `#@
__addÚ¬tişe
` 
addÚ
 
ON
‡ddÚ.
aid
=
¬c
.
id
 
WHERE
‡rc.
chªÃl
='1' 
$lim™Sql
 ";

140 
$dsql
->
S‘Qu”y
(
$fqu”y
);

141 
	g$dsql
->
Execu‹
();

142 
	g$¥
 = 
Ãw
 
S¶™WÜd
(
$cfg_soá_Ïng
 , $cfg_soft_lang );

143 
	g$row
=
$dsql
->
G‘Objeù
())

145 if(
$row
->
keywÜds
!='')

149 
	g$tjnum
++;

150 
	g$id
 = 
$row
->
id
;

151 
	g$keywÜds
 = "";

153 
	g$¥
->
S‘Sourû
(
$row
->
t™Ë
, 
$cfg_soá_Ïng
 , $cfg_soft_lang );

154 
	g$¥
->
S‘ResuÉTy³
(2);

155 
	g$¥
->
S¹AÇlysis
(
TRUE
);

157 
	g$t™Ëšdexs
 = 
$¥
->
G‘Fš®lyIndex
();

159 
	g$¥
->
S‘Sourû
(
Html2Text
(
$row
->
body
), 
$cfg_soá_Ïng
 , $cfg_soft_lang );

160 
	g$¥
->
S‘ResuÉTy³
(2);

161 
	g$¥
->
S¹AÇlysis
(
TRUE
);

162 
	g$®lšdexs
 = 
$¥
->
G‘Fš®lyIndex
();

163 if(
is_¬¿y
(
$®lšdexs
è&& is_¬¿y(
$t™Ëšdexs
))

165 
fÜ—ch
(
$t™Ëšdexs
 
as
 
$k
 => 
$v
)

167 if(
¡¾’
(
$keywÜds
)>=30)

173 if(
¡¾’
(
$k
) <= 2) ;

174 
	g$keywÜds
 .ğ
$k
.",";

177 
fÜ—ch
(
$®lšdexs
 
as
 
$k
 => 
$v
)

179 if(
¡¾’
(
$keywÜds
)>=30)

183 if(!
š_¬¿y
(
$k
,
$t™Ëšdexs
))

185 if(
¡¾’
(
$k
) <= 2) ;

186 
	g$keywÜds
 .ğ
$k
.",";

190 
	g$keywÜds
 = 
add¦ashes
(
$keywÜds
);

191 if(
	g$keywÜds
=='')

193 
$keywÜds
 = ',';

195 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SET keywords='$keywords' WHERE id='$id'");

197 
un£t
(
$¥
);

201 if(
	g$tÙ®num
>0è
	g$tjËn
 = 
û
Ğ(
$tjnum
/
$tÙ®num
) * 100 );

202 
	g$tjËn
=100;

204 
	g$dvËn
 = 
$tjËn
 * 2;

205 
	g$tj¡a
 = "<div style='width:200;height:15;border:1px solid #898989;text-align:left'><div style='width:$dvlen;height:15;background-color:#829D83'></div></div>";

206 
	g$tj¡a
 .= "<br/>å®Œæˆå¤„ç†æ–‡æ¡£æ€»æ•°çš„ï¼š$tjlen %ï¼Œä½ç½®ï¼š{$startdd}ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡...";

208 if(
	g$tjnum
 < 
	g$tÙ®num
)

210 
	g$nu¾
 = "¬tişe_keywÜds_make.php?dİo¡=ãtch&tÙ®num=$tÙ®num&¡¬tdd=".(
$¡¬tdd
+
$·gesize
)."&pagesize=$pagesize";

211 
ShowMsg
(
$tj¡a
,
$nu¾
,0,500);

215 
ShowMsg
("å®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼","javascript:;");

217 
ex™
();

219 
šşude
 
XAKINClude
('templets/article_keywords_make.htm');

	@E:\web\weixun\xakadmin\article_keywords_select.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

11 if(
em±y
(
$keywÜds
)è
	g$keywÜds
 = "";

13 
	g$sql
 = "SELECT * FROM #@__keywords ORDER BY„ank DESC";

14 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

15 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/article_keywords_select.htm");

16 
	g$dli¡
->
	g·geSize
 = 300;

17 
	g$dli¡
->
S‘P¬am‘”
("f",
$f
);

18 
	g$dli¡
->
S‘Sourû
(
$sql
);

19 
	g$dli¡
->
Di¥Ïy
();

21 
funùiÚ
 
	$G‘S
(
$¡a
)

23 if(
$¡a
==1)  "æ­£å¸¸";

25 
	}
}

27 
funùiÚ
 
	$G‘Mª
(
$¡a
)

29 if(
$¡a
==1)  "<u>ç¦ç”¨</u>";

31 
	}
}

	@E:\web\weixun\xakadmin\article_select_sw.php

1 <?
php


5 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

6 
h—d”
("Pragma:no-cache");

7 
h—d”
("Cache-Control:no-cache");

8 
h—d”
("Expires:0");

11 if(
	g$t
=='source')

13 
$m_fe
 = 
XAKDATA
."/admin/source.txt";

14 
	g$®lsourûs
 = 
fe
(
$m_fe
);

15 
	gecho
 "<div class='coolbg4'>[<a href=\"javascript:OpenMyWin('article_source_edit.php');ClearDivCt('mysource');\">è®¾ç½®</a>]&nbsp;";

16 
	gecho
 "[<a href='#' onclick='javascript:HideObj(\"mysource\");ChangeFullDiv(\"hide\");'>å…³é—­</a>]</div>\r\n<div class='wsselect'>\r\n";

17 
fÜ—ch
(
$®lsourûs
 
as
 
$v
)

19 
	g$v
 = 
Œim
(
$v
);

20 if(
	g$v
!="")

22 
echo
 "<a href='#' onclick='javascript:PutSource(\"$v\")'>$v</a> | \r\n";

25 
	gecho
 "</div><div class='coolbg5'>&nbsp;</div>";

30 
	g$m_fe
 = 
XAKDATA
."/admin/writer.txt";

31 
	gecho
 "<div class='coolbg4'>[<a href=\"javascript:OpenMyWin('article_writer_edit.php');ClearDivCt('mywriter');\">è®¾ç½®</a>]&nbsp;";

32 
	gecho
 "[<a href='#' onclick='javascript:HideObj(\"mywriter\");ChangeFullDiv(\"hide\");'>å…³é—­</a>]</div>\r\n<div class='wsselect'>\r\n";

33 if(
fesize
(
$m_fe
)>0)

35 
	g$å
 = 
fİ’
(
$m_fe
,'r');

36 
	g$¡r
 = 
ä—d
(
$å
,
fesize
(
$m_fe
));

37 
fşo£
(
$å
);

38 
	g$¡rs
 = 
ex¶ode
(',',
$¡r
);

39 
fÜ—ch
(
$¡rs
 
as
 
$¡r
)

41 
	g$¡r
 = 
Œim
(
$¡r
);

42 if(
	g$¡r
!="")

44 
echo
 "<a href='#' onclick='javascript:PutWriter(\"$str\")'>$str</a> | ";

48 
	gecho
 "</div><div class='coolbg5'>&nbsp;</div>\r\n";

	@E:\web\weixun\xakadmin\article_source_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

9 
CheckPurv›w
('sys_Source');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
em±y
(
$®lsourû
)è
	g$®lsourû
 = '';

12 
	g$®lsourû
 = 
¡r¦ashes
(
$®lsourû
);

14 
	g$m_fe
 = 
XAKDATA
."/admin/source.txt";

17 if(
	g$dİo¡
=='save')

19 
$å
 = 
fİ’
(
$m_fe
,'w');

20 
æock
(
$å
,3);

21 
fwr™e
(
$å
,
$®lsourû
);

22 
fşo£
(
$å
);

23 
	gecho
 "<script>alert('Save OK!');</script>";

26 if(
em±y
(
$®lsourû
è&& 
fesize
(
$m_fe
)>0)

28 
	g$å
 = 
fİ’
(
$m_fe
,'r');

29 
	g$®lsourû
 = 
ä—d
(
$å
,
fesize
(
$m_fe
));

30 
fşo£
(
$å
);

32 
	g$wšt™Ë
 = "æ–‡ç« æ¥æºç®¡ç†";

33 
	g$wecome_šfo
 = "æ–‡ç« æ¥æºç®¡ç†";

34 
	g$wš
 = 
Ãw
 
OxWšdow
();

35 
	g$wš
->
In™
('article_source_edit.php','js/blank.js','POST');

36 
	g$wš
->
AddHidd’
('dopost','save');

37 
	g$wš
->
AddT™Ë
("æ¯è¡Œä¿å­˜ä¸€ä¸ªæ¥æºï¼š");

38 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='allsource' id='allsource' style='width:100%;height:300px'>$allsource</textarea>");

39 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

40 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_string_mix.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

9 
CheckPurv›w
('sys_StringMix');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
em±y
(
$®lsourû
)è
	g$®lsourû
 = '';

13 
	g$®lsourû
 = 
¡r¦ashes
(
$®lsourû
);

15 
	g$m_fe
 = 
XAKDATA
."/downmix.data.php";

18 if(
	g$dİo¡
=="save")

20 
$å
 = 
fİ’
(
$m_fe
,'w');

21 
æock
(
$å
,3);

22 
fwr™e
(
$å
,
$®lsourû
);

23 
fşo£
(
$å
);

24 
	gecho
 "<script>alert('Save OK!');</script>";

28 if(
em±y
(
$®lsourû
è&& 
fesize
(
$m_fe
)>0)

30 
	g$å
 = 
fİ’
(
$m_fe
,'r');

31 
	g$®lsourû
 = 
ä—d
(
$å
,
fesize
(
$m_fe
));

32 
fşo£
(
$å
);

34 
	g$wšt™Ë
 = "é˜²é‡‡é›†æ··æ·†å­—ç¬¦ä¸²ç®¡ç†";

35 
	g$wecome_šfo
 = "é˜²é‡‡é›†æ··æ·†å­—ç¬¦ä¸²ç®¡ç†";

36 
	g$wš
 = 
Ãw
 
OxWšdow
();

37 
	g$wš
->
In™
('article_string_mix.php','js/blank.js','POST');

38 
	g$wš
->
AddHidd’
('dopost','save');

39 
	g$wš
->
AddT™Ë
("å¦‚æœä½ è¦å¯ç”¨å­—ç¬¦ä¸²æ··æ·†æ¥é˜²é‡‡é›†ï¼Œè¯·åœ¨æ–‡æ¡£æ¨¡æ¿éœ€è¦çš„å­—æ®µåŠ ä¸Š function='RndString(@me)' å±æ€§ï¼Œå¦‚ï¼š{xak:field‚ame='body' function='RndString(@me)'/}ã€‚");

40 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='allsource' id='allsource' style='width:100%;height:300px'>$allsource</textarea>");

41 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

42 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_template_rand.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

9 
CheckPurv›w
('sys_StringMix');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 
	g$‹m¶©es
 = 
em±y
(
$‹m¶©es
è? '' : 
¡r¦ashes
($templates);

12 
	g$m_fe
 = 
XAKDATA
.'/template.rand.php';

15 
	g$okmsg
 = '';

17 if(
	g$dİo¡
=='save')

19 
$å
 = 
fİ’
(
$m_fe
,'w');

20 
æock
(
$å
,3);

21 
fwr™e
(
$å
,
$‹m¶©es
);

22 
fşo£
(
$å
);

23 
	g$okmsg
 = 'æˆåŠŸä¿å­˜é…ç½®ä¿¡æ¯ AT:('.
MyD©e
('H:i:s', 
time
()).')';

26 if(
	g$dİo¡
=='makeold')

28 
£t_time_lim™
(3600);

29 if(!
fe_exi¡s
(
$m_fe
))

31 
AjaxH—d
();

32 
	gecho
 "é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼";

33 
ex™
();

35 
»quœe_Úû
(
$m_fe
);

36 if(
	g$cfg_m¶©e_¿nd
==0)

38 
AjaxH—d
();

39 
	gecho
 "ç³»ç»Ÿæ²¡å¼€å¯å…è®¸éšæœºæ¨¡æ¿çš„é€‰é¡¹ï¼";

40 
ex™
();

42 
	g$tÙ®Tmp
 = 
couÁ
(
$cfg_m¶©e_¬r
) - 1;

43 ifĞ
	g$tÙ®Tmp
 < 1 )

45 
AjaxH—d
();

46 
	gecho
 "éšæœºæ¨¡æ¿çš„æ•°é‡å¿…é¡»ä¸º2ä¸ªæˆ–ä»¥ä¸Šï¼";

47 
ex™
();

49 
	g$i
=0; $i < 10; $i++)

51 
	g$‹mp
 = 
$cfg_m¶©e_¬r
[
mt_¿nd
(0, 
$tÙ®Tmp
)];

52 
	g$dsql
->
Execu‹NÚeQu”y
(" Update `#@__addonarticle` setemplet='$temp' where RIGHT(aid, 1)='$i' ");

54 
AjaxH—d
();

55 
	gecho
 "å…¨éƒ¨éšæœºæ“ä½œæˆåŠŸï¼";

56 
ex™
();

59 if(
	g$dİo¡
=='clearold')

61 
$dsql
->
Execu‹NÚeQu”y
(" Update `#@__addonarticle` setemplet='' ");

62 
	g$dsql
->
Execu‹NÚeQu”y
(" OPTIMIZE TABLE `#@__addonarticle` ");

63 
AjaxH—d
();

64 
	gecho
 "å…¨éƒ¨æ¸…é™¤æ“ä½œæˆåŠŸï¼";

65 
ex™
();

70 if(
em±y
(
$‹m¶©es
è&& 
fesize
(
$m_fe
)>0)

72 
	g$å
 = 
fİ’
(
$m_fe
,'r');

73 
	g$‹m¶©es
 = 
ä—d
(
$å
,
fesize
(
$m_fe
));

74 
fşo£
(
$å
);

76 
	g$wšt™Ë
 = "éšæœºæ¨¡æ¿é˜²é‡‡é›†è®¾ç½®";

77 
	g$wecome_šfo
 = "éšæœºæ¨¡æ¿é˜²é‡‡é›†è®¾ç½®";

79 
	g$msg
 = "

80 <
lšk
 
h»f
='images/ba£.css' 
»l
='¡yËsh“t' 
ty³
='text/css' />

81 <
süt
 
Ïnguage
='javasüt' 
¤c
='js/main.js'></script>

82 <
süt
 
Ïnguage
='javasüt' 
¤c
='../functions/xakajax2.js'></script>

83 <
süt
 
Ïnguage
='javascript'>

84 
funùiÚ
 
	$DoRªd
(
jobÇme
)

86 
	`ChªgeFuÎDiv
('show');

87 \
	`$DE
('lßdšg').
¡yË
.
di¥Ïy
 = 'block';

88 
v¬
 
myajax
 = 
Ãw
 
	`XakAjax
(\
	`$DE
('tmpct'));

89 
myajax
.
	`S’dG‘2
('¬tişe_‹m¶©e_¿nd.php?dİo¡='+
jobÇme
);

90 \
	`$DE
('lßdšg').
¡yË
.
di¥Ïy
 = 'none';

91 
	`ChªgeFuÎDiv
('hide');

92 
	}
}

93 </
	gsüt
>

94 <
div
 
	gid
='lßdšg' 
¡yË
='z-index:3000;top:160;left:300;position:absolute;display:none;'>

95 <
img
 
¤c
='images/loadinglit.gif' /> è¯·ç¨åï¼Œæ­£åœ¨æ“ä½œä¸­...

96 </
div
>

97 <
bË
 
width
='98%' 
®ign
='center'>

98 <
Œ
>

99 <
td
 
height
='28'>

101 &
nb¥
; <
a
 
	gh»f
='#' 
Úşick
='DoRªd(\"makeŞd\")'>[<
u
>è®¾ç½®å…¨éƒ¨</u>]</a>

102 &
nb¥
; <
a
 
	gh»f
='#' 
Úşick
='DoRªd(\"ş—rŞd\")'>[<
u
>å–æ¶ˆå…¨éƒ¨</u>]</a>

103 &
nb¥
; <
¥ª
 
	gid
='tmpù' 
¡yË
='cŞÜ:»d;fÚt-weight:bŞd'>
$okmsg
</span>

104 </
td
>

105 </
Œ
>

106 <
Œ
>

107 <
td
 
bgcŞÜ
='#F9FCFD'><
b
>è¯·æŒ‰è¯´æ˜ä¿®æ”¹è®¾ç½®ï¼š</b></td>

108 </
Œ
>

109 <
Œ
>

110 <
td
><
‹x»a
 
Çme
='‹m¶©es' 
id
='‹m¶©es' 
¡yË
='width:100%;height:250px'>
$‹m¶©es
</textarea></td>

111 </
Œ
>

112 </
bË
>";

114 
$wš
 = 
Ãw
 
OxWšdow
();

115 
	g$wš
->
In™
('article_template_rand.php','js/blank.js','POST');

116 
	g$wš
->
AddHidd’
('dopost','save');

117 
	g$wš
->
AddT™Ë
("æœ¬è®¾ç½®ä»…é€‚ç”¨äºç³»ç»Ÿé»˜è®¤çš„æ–‡ç« æ¨¡å‹ï¼Œè®¾ç½®åå‘å¸ƒæ–‡ç« æ—¶ä¼šè‡ªåŠ¨æŒ‰æŒ‡å®šçš„æ¨¡æ¿éšæœºè·å–ä¸€ä¸ªï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨æ­¤åŠŸèƒ½ï¼ŒæŠŠå®ƒè®¾ç½®ä¸ºç©ºå³å¯ï¼");

118 
	g$wš
->
AddMsgI‹m
(
$msg
);

119 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

120 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\article_test_same.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 @
£t_time_lim™
(0);

9 
CheckPurv›w
('sys_ArcBatch');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
	g$dİo¡
=='analyse')

13 
$¬r
 = 
$dsql
->
g‘Úe
("SELECT maintable FROM `#@__channeltype` WHERE id='$channelid' ");

14 if(
is_¬¿y
(
$¬r
)) {

15 
	g$mašbË
 = 
$¬r
['maintable'];

17 
showmsg
('é¢‘é“idä¸æ­£ç¡®ï¼Œæ— æ³•å¤„ç†ï¼','javascript:;');

18 
ex™
();

20 
	g$dsql
->
S‘Qu”y
("SELECT COUNT(title) AS dd,title FROM `$maintable` WHERE channel='$channelid' GROUP BYitle ORDER BY dd DESC LIMIT 0, $pagesize");

21 
	g$dsql
->
Execu‹
();

22 
	g$®Ïrc
 = 0;

23 
šşude
 
XAKINClude
('templets/article_result_same.htm');

24 
ex™
();

27 if(
	g$dİo¡
=='delsel')

29 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/typelink.class.php");

30 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/inc/inc_batchup.php");

32 if(
em±y
(
$t™Ës
))

34 
h—d”
("Content-Type:ext/html; charset={$cfg_ver_lang}");

35 
	gecho
 "<meta http-equiv=\"Content-Type\" content=\"text/html; charset={$cfg_ver_lang}\">\r\n";

36 
	gecho
 "æ²¡æœ‰æŒ‡å®šåˆ é™¤çš„æ–‡æ¡£ï¼";

37 
ex™
();

40 
	g$t™Ëss
 = 
¥l™
('`',
$t™Ës
);

42 if(
	g$chªÃlid
 < -1) {

43 
	g$Üd”by
 = (
$d–ty³
=='delnew' ? " ORDER BY‡id DESC " : " ORDER BY‡id ASC ");

45 
	g$Üd”by
 = (
$d–ty³
=='delnew' ? " ORDER BY id DESC " : " ORDER BY id ASC ");

48 
	g$tÙ®¬c
 = 0;

50 
fÜ—ch
(
$t™Ëss
 
as
 
$t™Ë
)

52 
	g$t™Ë
 = 
Œim
(
$t™Ë
);

53 
	g$t™Ë
 = 
add¦ashes
Ğ
$t™Ë
=='' ? '' : 
u¾decode
($title) );

54 if(
	g$chªÃlid
 < -1) {

55 
	g$q1
 = "SELECT‡id‡s id,title FROM `$maintable` WHERE channel='$channelid' ANDitle='$title' $orderby ";

58 
	g$q1
 = "SELECT id,title FROM `$maintable` WHERE channel='$channelid' ANDitle='$title' $orderby ";

60 
	g$dsql
->
S‘Qu”y
(
$q1
);

61 
	g$dsql
->
Execu‹
();

62 
	g$rownum
 = 
$dsql
->
G‘TÙ®Row
();

63 if(
	g$rownum
 < 2) ;

64 
	g$i
 = 1;

65 
	g$row
 = 
$dsql
->
G‘Objeù
())

67 
$i
++;

68 
	g$Çid
 = 
$row
->
id
;

69 
	g$Á™Ë
 = 
$row
->
t™Ë
;

70 if(
	g$i
 > 
	g$rownum
) ;

71 
	g$tÙ®¬c
++;

72 
D–Arc
(
$Çid
, 'OFF');

75 
	g$dsql
->
Execu‹NÚeQu”y
(" OPTIMIZE TABLE `$maintable`; ");

76 
ShowMsg
("ä¸€å…±åˆ é™¤äº†[{$totalarc}]ç¯‡é‡å¤çš„æ–‡æ¡£ï¼","javascript:;");

77 
ex™
();

81 
	g$chªÃlšfos
 = 
¬¿y
();

82 
	g$dsql
->
£tqu”y
("SELECT id,typename,maintable,addtable FROM `#@__channeltype` ");

83 
	g$dsql
->
execu‹
();

84 
	g$row
 = 
$dsql
->
g‘¬¿y
()è
$chªÃlšfos
[] = 
$row
;

85 
šşude
 
XAKINClude
('templets/article_test_same.htm');

	@E:\web\weixun\xakadmin\article_test_title.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
AjaxH—d
();

9 if(
em±y
(
$t
è|| 
	g$cfg_check_t™Ë
=='N'è
ex™
;

11 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__archives` WHEREitle LIKE '$t' ");

12 if(
	$is_¬¿y
(
$row
))

14 
echo
 "æç¤ºï¼šç³»ç»Ÿå·²ç»å­˜åœ¨æ ‡é¢˜ä¸º '<a href='../module/view.php?aid={$row['id']}' style='color:red'arget='_blank'><u>$t</u></a>' çš„æ–‡æ¡£ã€‚[<a href='#' onclick='javascript:HideObj(\"mytitle\")'>å…³é—­</a>]";

15 
	}
}

	@E:\web\weixun\xakadmin\article_writer_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

9 
CheckPurv›w
('sys_Writer');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
em±y
(
$®lwr™”
)è
	g$®lwr™”
 = '';

13 
	g$®lwr™”
 = 
¡r¦ashes
(
$®lwr™”
);

15 
	g$m_fe
 = 
XAKDATA
."/admin/writer.txt";

18 if(
	g$dİo¡
=="save")

20 
$å
 = 
fİ’
(
$m_fe
,'w');

21 
æock
(
$å
,3);

22 
fwr™e
(
$å
,
$®lwr™”
);

23 
fşo£
(
$å
);

24 
	gecho
 "<script>alert('Save OK!');</script>";

28 if(
em±y
(
$®lwr™”
è&& 
fesize
(
$m_fe
)>0)

30 
	g$å
 = 
fİ’
(
$m_fe
,'r');

31 
	g$®lwr™”
 = 
ä—d
(
$å
,
fesize
(
$m_fe
));

32 
fşo£
(
$å
);

34 
	g$wšt™Ë
 = "æ–‡ç« ä½œè€…ç®¡ç†";

35 
	g$wecome_šfo
 = "æ–‡ç« ä½œè€…ç®¡ç†";

36 
	g$wš
 = 
Ãw
 
OxWšdow
();

37 
	g$wš
->
In™
('article_writer_edit.php','js/blank.js','POST');

38 
	g$wš
->
AddHidd’
('dopost','save');

39 
	g$wš
->
AddT™Ë
("æŠŠä½œè€…å§“åç”¨åŠè§’é€—å·â€œ,â€åˆ†å¼€ï¼š");

40 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='allwriter' id='allwriter' style='width:100%;height:300px'>$allwriter</textarea>");

41 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

42 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\baidunews.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

9 if(
	$em±y
(
$do
))

11 
šşude
 
XAKADMIN
.'/templets/baidunews.htm';

12 
	}
} {

13 
	g$baiduÃws
 = "<?xmÈv”siÚ=\"1.0\"ƒncodšg=\"".
$cfg_soá_Ïng
."\" ?>\n";

14 
	g$baiduÃws
 .= "<document>\n";

15 
	g$baiduÃws
 .= "<webSite>$cfg_webname </webSite>\n";

16 
	g$baiduÃws
 .= "<webMaster>$cfg_adminemail </webMaster>\n";

17 
	g$baiduÃws
 .= "<updatePeri>$cfg_updateperi </updatePeri>\n";

19 
	g$lim™
 = 
$cfg_baiduÃws_lim™
;

20 if(
	g$lim™
 > 100 || $limit < 1)

22 
	g$lim™
 = 100;

25 
	g$qu”y
 = "SELECT maintable.*,‡ddtable.body,‡rctype.typename

26 
FROM
 #@
__¬chives
 
mašbË


27 
LEFT
 
JOIN
 #@
__addÚ¬tişe
 
addbË
 
ON
‡ddbË.
aid
=
mašbË
.
id


28 
LEFT
 
JOIN
 #@
__¬ùy³
 
¬ùy³
 
ON
‡rùy³.
ID
=
mašbË
.
ty³id


29 
WHERE
 
mašbË
.
chªÃl
=1 
ªd
 mašbË.
¬üªk
!=-1 
ORDER
 
BY
 mašbË.
pubd©e
 
DESC
 
LIMIT
 
$lim™


31 
$dsql
->
S‘Qu”y
(
$qu”y
);

32 
	g$dsql
->
Execu‹
();

33 
	g$row
 = 
$dsql
->
G‘A¼ay
())

35 
$t™Ë
 = 
html¥ecŸlch¬s
(
$row
['title']);

36 
	g$row1
 = 
G‘OÃArchive
(
$row
['id']);

37 if(
¡½os
(
$row1
['¬cu¾'],'h‰p://'è==ğ
çl£
)

39 
$lšk
 = (
$cfg_ba£ho¡
=='' ? 'h‰p://'.
$_SERVER
["HTTP_HOST"].
$cfg_cm¥©h
 : $cfg_ba£ho¡).
$row1
['arcurl'];

42 
	g$lšk
 = 
$row1
['arcurl'];

44 
	g$lšk
 = 
html¥ecŸlch¬s
(
$lšk
);

45 
	g$desütiÚ
 = 
html¥ecŸlch¬s
(
¡r_gs
(
$row
['description']));

46 
	g$‹xt
 = 
html¥ecŸlch¬s
(
¡r_gs
(
$row
['body']));

47 
	g$image
 = 
$row
['litpic'] =='' ? '' :$row['litpic'];

48 if(
	g$image
 !ğ'' && 
¡½os
(
$image
, 'h‰p://'è==ğ
çl£
)

50 
$image
 = (
$cfg_ba£ho¡
=='' ? 'h‰p://'.
$_SERVER
["HTTP_HOST"].
$cfg_cm¥©h
 : $cfg_basehost).$image;

54 
	g$keywÜds
 = 
html¥ecŸlch¬s
(
$row
['keywords']);

55 
	g$ÿ‹gÜy
 = 
html¥ecŸlch¬s
(
$row
['typename']);

56 
	g$authÜ
 = 
html¥ecŸlch¬s
(
$row
['writer']);

57 
	g$sourû
 = 
html¥ecŸlch¬s
(
$row
['source']);

58 
	g$pubd©e
 = 
html¥ecŸlch¬s
(
gmd©e
('Y-m-d H:i',
$row
['pubd©e'] + 
$cfg_şi_time
 * 3600));

60 
	g$baiduÃws
 .= "<item>\n";

61 
	g$baiduÃws
 .= "<title>$title </title>\n";

62 
	g$baiduÃws
 .= "<link>$link </link>\n";

63 
	g$baiduÃws
 .= "<description>$description </description>\n";

64 
	g$baiduÃws
 .= "<text>$text </text>\n";

65 
	g$baiduÃws
 .= "<image>$image </image>\n";

67 
	g$baiduÃws
 .= "<keywords>$keywords </keywords>\n";

68 
	g$baiduÃws
 .= "<category>$category </category>\n";

69 
	g$baiduÃws
 .= "<author>$author </author>\n";

70 
	g$baiduÃws
 .= "<source>$source </source>\n";

71 
	g$baiduÃws
 .= "<pubDate>$pubdate </pubDate>\n";

72 
	g$baiduÃws
 .= "</item>\n";

74 
	g$baiduÃws
 .= "</document>\n";

76 
	g$å
 = 
fİ’
(
dœÇme
(
__FILE__
).'/'.
$f’ame
,'w');

77 
fwr™e
(
$å
,
$baiduÃws
);

78 
fşo£
(
$å
);

79 
showmsg
("<a href='{$filename}'arget=\"_blank\">{$filename} make success</a>",'javascript:;');

	@E:\web\weixun\xakadmin\cards_make.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Card');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

10 if(
	g$dİo¡
 =ğ''è
šşude
(
XAKADMIN
."/templets/cards_make.htm");

13 
–£if
(
$dİo¡
 == 'make')

15 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__moneycard_record ORDER BY‡id DESC");

16 !
is_¬¿y
(
$row
è? 
	g$¡¬tid
=100000 : 
$¡¬tid
=$row['aid']+100000;

17 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__moneycard_type WHEREid='$cardtype'");

18 
	g$mÚey
 = 
$row
['money'];

19 
	g$num
 = 
$row
['num'];

20 
	g$mtime
 = 
time
();

21 
	g$utime
 = 0;

22 
	g$ùid
 = 
$ÿrdty³
;

23 
	g$¡¬tid
++;

24 
	g$’did
 = 
$¡¬tid
 + 
$mnum
;

26 
h—d”
("Content-Type:ext/html; charset={$cfg_soft_lang}");

28 ;
	g$¡¬tid
<
	g$’did
;$startid++)

30 
	g$ÿrdid
 = 
$¢´efix
.
$¡¬tid
.'-';

31 
	g$p
=0;$p<
	g$pwdgr
;$p++)

33 
	g$i
=0; $˜< 
	g$pwdËn
; $i++)

35 if(
	g$ùy³
==1)

37 
$c
 = 
mt_¿nd
(49,57); 
	g$c
 = 
chr
($c);

41 
	g$c
 = 
mt_¿nd
(65,90);

42 if(
	g$c
==79)

44 
$c
 = 'M';

48 
	g$c
 = 
chr
(
$c
);

51 
	g$ÿrdid
 .ğ
$c
;

53 if(
	g$p
<
	g$pwdgr
-1)

55 
	g$ÿrdid
 .= '-';

58 
	g$šqu”y
 = "INSERT INTO #@__moneycard_record(ctid,cardid,uid,isexp,mtime,utime,money,num)

59 
VALUES
('$ctid','$cardid','0','0','$mtime','$utime','$money','$num'); ";

60 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

61 
	gecho
 "æˆåŠŸç”Ÿæˆç‚¹å¡ï¼š{$cardid}<br/>";

63 
	gecho
 "æˆåŠŸç”Ÿæˆ {$mnum} ä¸ªç‚¹å¡ï¼";

	@E:\web\weixun\xakadmin\cards_manage.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

9 
	g$dİo¡
=
em±y
(
$dİo¡
)? "" : $dopost;

10 if(
	g$dİo¡
=="delete"){

11 
$ids
 = 
ex¶ode
('`',
$aids
);

12 
	g$dqu”y
 = "";

13 
fÜ—ch
(
$ids
 
as
 
$id
){

14 if(
	g$dqu”y
==""è
$dqu”y
 .= "aid='$id' ";

15 
	g$dqu”y
 .= " OR‡id='$id' ";

17 if(
	g$dqu”y
!=""è
$dqu”y
 = " WHERE ".$dquery;

18 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__moneycard_record $dquery");

19 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„è®°å½•ï¼","cards_manage.php");

20 
ex™
();

22 
	g$addsql
 = '';

23 if(
is£t
(
$i£xp
)è
	g$addsql
 = " WHERE isexp='$isexp' ";

25 
	g$sql
 = "SELECT * FROM #@__moneycard_record $addsql ORDER BY‡id DESC";

26 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

27 
	g$dli¡
->
	g·geSize
 = 25;

28 if(
is£t
(
$i£xp
)è
	g$dli¡
->
S‘P¬am‘”
("isexp",$isexp);

30 
	g$dli¡
->
	gdsql
->
S‘Qu”y
("SELECT * FROM #@__moneycard_type ");

31 
	g$dli¡
->
	gdsql
->
Execu‹
('ts');

32 
	g$rw
 = 
$dli¡
->
dsql
->
G‘A¼ay
('ts'))

34 
$Ty³Names
[
$rw
['tid']] = $rw['pname'];

36 
	g$lfe
 = 
XAKADMIN
."/templets/cards_manmage.htm";

39 
	g$dli¡
->
S‘Tem¶©e
(
$lfe
);

40 
	g$dli¡
->
S‘Sourû
(
$sql
);

41 
	g$dli¡
->
Di¥Ïy
();

44 
funùiÚ
 
	$G‘Memb”ID
(
$mid
)

46 
glob®
 
$dsql
;

47 if(
$mid
==0)  '0';

48 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT userid FROM `#@__member_list` WHERE mid='$mid' ");

49 if(
	`is_¬¿y
(
$row
))  "<a href='member_view.php?mid={$mid}'>".$row['userid']."</a>";

51 
	}
}

53 
funùiÚ
 
	$G‘U£D©e
(
$time
=0)

55 if(!
	`em±y
(
$time
)è 
	`G‘D©eMk
($time);

57 
	}
}

58 
funùiÚ
 
	$G‘S
(
$¡a
)

60 if(
$¡a
==1)  'å·²å”®å‡º';

61 if(
$¡a
==-1)  'å·²ä½¿ç”¨';

63 
	}
}

	@E:\web\weixun\xakadmin\cards_type.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('member_Type');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 if(
	g$dİo¡
=="save")

14 
$¡¬tID
 = 1;

15 
	g$’dID
 = 
$id’d
;

16 ;
	g$¡¬tID
<=
$’dID
;$startID++)

18 
	g$qu”y
 = '';

19 
	g$tid
 = 
$
{'ID_'.
$¡¬tID
};

20 
	g$²ame
 = 
$
{'²ame_'.
$¡¬tID
};

21 
	g$mÚey
 = 
$
{'mÚey_'.
$¡¬tID
};

22 
	g$num
 = 
$
{'num_'.
$¡¬tID
};

23 if(
is£t
(
$
{'check_'.
$¡¬tID
}))

25 if(
	g$²ame
!='')

27 
$qu”y
 = "UPDATE #@__moneycard_type SET…name='$pname',money='$money',num='$num' WHEREid='$tid'";

28 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

29 
	g$qu”y
 = "UPDATE #@__moneycard_record SET money='$money',num='$num' WHERE ctid='$tid' ; ";

30 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

35 
	g$qu”y
 = "DELETE FROM #@__moneycard_type WHEREid='$tid' ";

36 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

37 
	g$qu”y
 = "DELETE FROM #@__moneycard_record WHERE ctid='$tid' AND isexp<>-1 ; ";

38 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

43 if(
is£t
(
$check_Ãw
è&& 
	g$²ame_Ãw
!='')

45 
$qu”y
 = "INSERT INTO #@__moneycard_type(num,pname,money) VALUES('{$num_new}','{$pname_new}','{$money_new}');";

46 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

48 
h—d”
("Content-Type:ext/html; charset={$cfg_soft_lang}");

49 
	gecho
 "<script>‡lert('æˆåŠŸæ›´æ–°ç‚¹å¡äº§å“åˆ†ç±»è¡¨ï¼'); </script>";

51 
»quœe_Úû
(
XAKADMIN
."/templets/cards_type.htm");

	@E:\web\weixun\xakadmin\catalog_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

11 if(
em±y
(
$li¡ty³
)è
	g$li¡ty³
='';

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

13 if(
em±y
(
$upšyš
)è
	g$upšyš
 = 0;

14 if(
em±y
(
$chªÃlid
)è
	g$chªÃlid
 = 1;

15 if(
is£t
(
$chªÃÉy³
)è
	g$chªÃlid
 = $channeltype;

17 
	g$id
 = 
em±y
(
$id
è? 0 :
štv®
($id);

18 
	g$»id
 = 
em±y
(
$»id
è? 0 :
štv®
($reid);

19 
	g$nid
 = 'article';

21 if(
	g$id
==0 && 
$»id
==0)

23 
CheckPurv›w
('t_New');

27 
	g$checkID
 = 
em±y
(
$id
è? 
$»id
 : $id;

28 
CheckPurv›w
('t_AccNew');

29 
CheckC©®og
(
$checkID
, 'ä½ æ— æƒåœ¨æœ¬æ ç›®ä¸‹åˆ›å»ºå­ç±»ï¼');

32 if(
em±y
(
$myrow
)è
	g$myrow
 = 
¬¿y
();

34 
	g$dsql
->
S‘Qu”y
("SELECT id,typename,nid FROM `#@__channeltype` WHERE id<>-1 AND isshow=1 ORDER BY id");

35 
	g$dsql
->
Execu‹
();

36 
	g$row
=
$dsql
->
	$G‘Objeù
())

38 
$chªÃlA¼ay
[
$row
->
id
]['ty³Çme'] = $row->
ty³Çme
;

39 
$chªÃlA¼ay
[
$row
->
id
]['nid'] = $row->
nid
;

40 if(
$row
->
id
==
$chªÃlid
)

42 
$nid
 = 
$row
->
nid
;

44 
	}
}

45 if(
	g$dİo¡
=='quick')

47 
$
 = 
Ãw
 
Ty³Lšk
(0);

48 
	g$ty³O±iÚs
 = 
$
->
G‘O±iÚA¼ay
(0,0,0);

49 
šşude
 
XAKINClude
('templets/catalog_add_quick.htm');

50 
ex™
();

55 if(
	g$dİo¡
=='savequick')

57 if(!
is£t
(
$§v‘y³
)) $savetype = '';

58 
	g$isdeçuÉ
 = 
is£t
(
$isdeçuÉ
)? $isdefault : 0;

59 
	g$‹mpšdex
 = "{style}/index_{$nid}.htm";

60 
	g$‹m¶i¡
 = "{style}/list_{$nid}.htm";

61 
	g$‹m·¹işe
 = "{style}/article_{$nid}.htm";

62 
	g$qu”yTem¶©e
 = "INSERT INTO `#@__arctype`(reid,topid,sortrank,typename,typedir,isdefault,defaultname,issend,channeltype,

63 
‹mpšdex
,
	g‹m¶i¡
,
	g‹m·¹işe
,
	gmodÇme
,
	gÇm”uË
,
	gÇm”uË2
,
	gi¥¬t
,
	gcÜªk
,
	gdesütiÚ
,
	gkeywÜds
,
	g£Ù™Ë
,
	gmÜes™e
,
	gs™eu¾
,
	gs™•©h
,
	gishidd’
,`
	güoss
`,`
	güossid
`,`
	gcÚ‹Á
`,`
	gsm®Éy³s
`,`
	gİ’_Ãw
`)

64 
VALUES
('~reid~','~topid~','~rank~','~typename~','~typedir~','$isdefault','$defaultname','$issend','$channeltype',

67 ià(
em±y
(
$§v‘y³
))

69 
fÜ—ch
(
$_POST
 
as
 
$k
=>
$v
)

71 if(
´eg_m©ch
("#^po¡ty³#", 
$k
))

73 
$k
 = 
¡r_»¶aû
('posttype', '', $k);

79 
	g$¿nk
 = 
$
{'¿nk'.
$k
};

80 
	g$tİty³Çme
 = 
Œim
(
$
{'tİty³'.
$k
});

81 
	g$sÚty³
 = 
Œim
(
$
{'sÚty³'.
$k
});

84 
	g$tİÇme
 = 
Œim
(
$
{'tİÇme'.
$k
});

85 if(
em±y
(
$tİÇme
)){

86 
	g$tİty³dœ
 = 
G‘Pšyš
(
¡r¦ashes
(
$tİty³Çme
));

90 
	g$tİty³dœ
 = 
¡r¦ashes
(
$tİÇme
);

93 
	g$tİty³dœ
 = 
$»ã½©h
=='·»Á' ? 
$Ãxtdœ
.'/'.
$tİty³dœ
 : '/'.$toptypedir;

94 if(
em±y
(
$tİty³Çme
))

98 
	g$sql
 = 
¡r_»¶aû
('~»id~','0',
$qu”yTem¶©e
);

99 
	g$sql
 = 
¡r_»¶aû
('~tİid~','0',
$sql
);

100 
	g$sql
 = 
¡r_»¶aû
('~¿nk~',
$¿nk
,
$sql
);

101 
	g$sql
 = 
¡r_»¶aû
('~ty³Çme~',
$tİty³Çme
,
$sql
);

102 
	g$sql
 = 
¡r_»¶aû
('~ty³dœ~',
$tİty³dœ
,
$sql
);

103 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

104 
	g$tid
 = 
$dsql
->
G‘La¡ID
();

105 if(
	g$tid
>0 && 
	g$sÚty³
!='')

107 
$sÚty³s
 = 
ex¶ode
(',',
$sÚty³
);

108 
fÜ—ch
(
$sÚty³s
 
as
 
$k
=>
$v
)

110 
$v
 = 
Œim
($v);

111 if(
	g$v
=='')

115 
	g$ty³dœ
 = 
$tİty³dœ
.'/'.
G‘Pšyš
(
¡r¦ashes
(
$v
));

116 
	g$sql
 = 
¡r_»¶aû
('~»id~',
$tid
,
$qu”yTem¶©e
);

117 
	g$sql
 = 
¡r_»¶aû
('~tİid~',
$tid
,
$sql
);

118 
	g$sql
 = 
¡r_»¶aû
('~¿nk~',
$k
,
$sql
);

119 
	g$sql
 = 
¡r_»¶aû
('~ty³Çme~',
$v
,
$sql
);

120 
	g$sql
 = 
¡r_»¶aû
('~ty³dœ~',
$ty³dœ
,
$sql
);

121 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

128 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `typedir`,`topid` FROM `#@__arctype` WHERE `id`={$reid}");

129 if(
	g$row
['topid']!=0)

131 
$tİid
 = 
$row
['topid'];

135 
	g$tİid
 = 
$»id
;

137 
fÜ—ch
(
$_POST
 
as
 
$k
=>
$v
)

139 if(
´eg_m©ch
("#^po¡ty³#", 
$k
))

141 
$k
 = 
¡r_»¶aû
('posttype', '', $k);

147 
	g$¿nk
 = 
$
{'¿nk'.
$k
};

148 
	g$tİty³Çme
 = 
Œim
(
$
{'»Éy³'.
$k
});

150 
	g$tİÇme
 = 
Œim
(
$
{'»Éy³_Çme'.
$k
});

151 if(
em±y
(
$tİÇme
)){

152 
	g$tİty³dœ
 = 
G‘Pšyš
(
¡r¦ashes
(
$tİty³Çme
));

156 
	g$tİty³dœ
 = 
¡r¦ashes
(
$tİÇme
);

159 
	g$»ã½©h
) {

161 
$tİty³dœ
 = 
$Ãxtdœ
.'/'.$toptypedir;

164 
$tİty³dœ
 = 
is£t
(
$row
['typedir'])? $row['typedir'].'/'.$toptypedir : '/'.$toptypedir;

167 
$tİty³dœ
 = '/'.$toptypedir;

171 if(
em±y
(
$tİty³Çme
))

175 
	g$sql
 = 
¡r_»¶aû
('~»id~', 
$»id
, 
$qu”yTem¶©e
);

176 
	g$sql
 = 
¡r_»¶aû
('~tİid~', 
$tİid
, 
$sql
);

177 
	g$sql
 = 
¡r_»¶aû
('~¿nk~', 
$¿nk
, 
$sql
);

178 
	g$sql
 = 
¡r_»¶aû
('~ty³Çme~', 
$tİty³Çme
, 
$sql
);

179 
	g$sql
 = 
¡r_»¶aû
('~ty³dœ~', 
$tİty³dœ
, 
$sql
);

180 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

183 
UpD©eC©Cache
();

184 
ShowMsg
('æˆåŠŸå¢åŠ æŒ‡å®šæ ç›®ï¼','catalog_main.php');

185 
ex™
();

190 if(
	g$dİo¡
=='save')

192 
$sm®Éy³s
 = '';

193 if(
em±y
(
$sm®Éy³
)è
	g$sm®Éy³
 = '';

194 if(
is_¬¿y
(
$sm®Éy³
)è
	g$sm®Éy³s
 = 
još
(',',$smalltype);

197 if(!
is£t
(
$autokey
)è
	g$autokey
 = 0;

198 if(!
is£t
(
$»mÙe
)è
	g$»mÙe
 = 0;

199 if(!
is£t
(
$d–lšk
)è
	g$d–lšk
 = 0;

200 if(!
is£t
(
$autŞ™pic
)è
	g$autŞ™pic
 = 0;

202 if(!
is£t
(
$s™•©h
)è
	g$s™•©h
 = '';

203 if(
	g$tİid
==0 && 
$»id
>0è
$tİid
 = $reid;

204 if(
	g$i¥¬t
!=0è
$üoss
 = 0;

206 
	g$desütiÚ
 = 
Html2Text
(
$desütiÚ
,1);

207 
	g$keywÜds
 = 
Html2Text
(
$keywÜds
,1);

210 
	g$cÚ‹Á
 = 
AÇly£HtmlBody
(
$cÚ‹Á
);

212 if(
	g$i¥¬t
 != 2 )

215 if(
$»ã½©h
=='cm¥©h'è
$Ãxtdœ
 = '{cmspath}';

216 if(
	g$»ã½©h
=='ba£·th'è
$Ãxtdœ
 = '';

218 if(
	g$upšyš
==1 || 
$ty³dœ
=='')

220 
$ty³dœ
 = 
G‘Pšyš
(
¡r¦ashes
(
$ty³Çme
));

222 
	g$ty³dœ
 = 
$Ãxtdœ
.'/'.
$ty³dœ
;

223 
	g$ty³dœ
 = 
´eg_»¶aû
("#\/{1,}#", "/", 
$ty³dœ
);

227 if(
	g$»id
==0 && 
$mÜes™e
==1)

229 
$s™•©h
 = 
$ty³dœ
;

232 if(
	g$s™eu¾
!='')

234 
$s™eu¾
 = 
´eg_»¶aû
("#\/$#", "", $siteurl);

235 if(!
´eg_m©ch
("#h‰p:\/\/#i", 
$s™eu¾
))

237 
ShowMsg
("ä½ ç»‘å®šçš„äºŒçº§åŸŸåæ— æ•ˆï¼Œè¯·ç”¨(http://host)çš„å½¢å¼ï¼","-1");

238 
ex™
();

240 if(
´eg_m©ch
("#".
$cfg_ba£ho¡
."#i", 
$s™eu¾
))

242 
ShowMsg
("ä½ ç»‘å®šçš„äºŒçº§åŸŸåä¸å½“å‰ç«™ç‚¹æ˜¯åŒä¸€ä¸ªåŸŸï¼Œä¸éœ€è¦ç»‘å®šï¼","-1");

243 
ex™
();

249 if(
	g$i¥¬t
 != 2)

251 
$Œue_ty³dœ
 = 
¡r_»¶aû
("{cm¥©h}", 
$cfg_cm¥©h
, 
$ty³dœ
);

252 
	g$Œue_ty³dœ
 = 
´eg_»¶aû
("#\/{1,}#", "/", 
$Œue_ty³dœ
);

253 if(!
C»©eDœ
(
$Œue_ty³dœ
))

255 
ShowMsg
("åˆ›å»ºç›®å½• {$true_typedir} å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä½ çš„è·¯å¾„æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼","-1");

256 
ex™
();

260 
	g$š_qu”y
 = "INSERT INTO `#@__arctype`(reid,topid,sortrank,typename,typedir,isdefault,defaultname,issend,channeltype,

261 
‹mpšdex
,
	g‹m¶i¡
,
	g‹m·¹işe
,
	gmodÇme
,
	gÇm”uË
,
	gÇm”uË2
,

262 
	gi¥¬t
,
	gcÜªk
,
	gdesütiÚ
,
	gkeywÜds
,
	g£Ù™Ë
,
	gmÜes™e
,
	gs™eu¾
,
	gs™•©h
,
	gishidd’
,`
	güoss
`,`
	güossid
`,`
	gcÚ‹Á
`,`
	gsm®Éy³s
`,
	gty³pic
,
	gİ’_Ãw
,
	gddimg_width
,
	gddimg_height
)

263 
VALUES
('$reid','$topid','$sortrank','$typename','$typedir','$isdefault','$defaultname','$issend','$channeltype',

267 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$š_qu”y
))

269 
ShowMsg
("ä¿å­˜ç›®å½•æ•°æ®æ—¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä½ çš„è¾“å…¥èµ„æ–™æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼","-1");

270 
ex™
();

272 
UpD©eC©Cache
();

273 if(
	g$»id
>0)

275 
PutCook›
('Ï¡Cid',
G‘Tİid
(
$»id
),3600*24,'/');

277 
ShowMsg
("æˆåŠŸåˆ›å»ºä¸€ä¸ªåˆ†ç±»ï¼","catalog_main.php");

278 
ex™
();

283 if(
	g$dİo¡
=='')

285 
$chªÃlid
 = 1;

286 
	g$is£nd
 = 1;

287 
	g$cÜªk
 = 0;

288 
	g$»id
 = 0;

289 
	g$tİid
 = 0;

290 
	g$ty³dœ
 = '';

291 
	g$mÜes™e
 = 0;

292 if(
	g$id
>0)

294 
	g$myrow
 = 
$dsql
->
G‘OÃ
(" SELECTp.*,ch.typename AS ctypename FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch ON ch.id=tp.channeltype WHEREp.id=$id ");

295 
	g$chªÃlid
 = 
$myrow
['channeltype'];

296 
	g$is£Âd
 = 
$myrow
['issend'];

297 
	g$cÜªk
 = 
$myrow
['corank'];

298 
	g$tİid
 = 
$myrow
['topid'];

299 
	g$ty³dœ
 = 
$myrow
['typedir'];

300 
	g$ddimg_width
 = 
$myrow
['ddimg_width'];

301 
	g$ddimg_height
 = 
$myrow
['ddimg_height'];

305 
	g$mÜes™e
 = 
em±y
(
$myrow
['moresite']) ? 0 : $myrow['moresite'];

308 
šşude
 
XAKINClude
('templets/catalog_add.htm');

	@E:\web\weixun\xakadmin\catalog_del.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

10 
CheckPurv›w
('t_Del,t_AccDel');

11 
»quœe_Úû
(
XAKINC
.'/typeunit.class.admin.php');

12 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

13 
	g$id
 = 
Œim
(
´eg_»¶aû
("#[^0-9]#", '', 
$id
));

16 
CheckC©®og
(
$id
,"ä½ æ— æƒåˆ é™¤æœ¬æ ç›®ï¼");

17 if(
em±y
(
$dİo¡
)è
	g$dİo¡
='';

18 if(
	g$dİo¡
=='ok')

20 
$ut
 = 
Ãw
 
Ty³Un™
();

21 
	g$ut
->
D–Ty³
(
$id
,
$d–fe
);

22 
UpD©eC©Cache
();

23 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªæ ç›®ï¼","catalog_main.php");

24 
ex™
();

26 
	g$dsql
->
S‘Qu”y
("SELECTy³Çme,ty³dœ FROM #@__¬ùy³ WHERE id=".
$id
);

27 
	g$row
 = 
$dsql
->
G‘OÃ
();

28 
	g$wšt™Ë
 = "åˆ é™¤æ ç›®ç¡®è®¤";

29 
	g$wecome_šfo
 = "<a href='catalog_main.php'>æ ç›®ç®¡ç†</a> &gt;&gt; åˆ é™¤æ ç›®ç¡®è®¤";

30 
	g$wš
 = 
Ãw
 
OxWšdow
();

31 
	g$wš
->
In™
('catalog_del.php','js/blank.js','POST');

32 
	g$wš
->
AddHidd’
('id',
$id
);

33 
	g$wš
->
AddHidd’
('dopost','ok');

34 
	g$wš
->
AddT™Ë
("ä½ è¦ç¡®å®è¦åˆ é™¤æ ç›®ï¼š [{$row['typename']}] å—ï¼Ÿ");

35 
	g$wš
->
AddI‹m
('æ ç›®çš„æ–‡ä»¶ä¿å­˜ç›®å½•ï¼š',
$row
['typedir']);

36 
	g$wš
->
AddI‹m
('æ˜¯å¦åˆ é™¤æ–‡ä»¶ï¼š',"<inputype='radio'‚ame='delfile' class='np' value='no' checked='1' />å¦ &nbsp;<inputype='radio'‚ame='delfile' class='np' value='yes' />æ˜¯");

37 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

38 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\catalog_do.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 if(
	$em±y
(
$dİo¡
))

10 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œè¯·æŒ‡å®šæ ç›®å‚æ•°ï¼","catalog_main.php");

11 
	`ex™
();

12 
	}
}

13 
	g$cid
 = 
em±y
(
$cid
è? 0 : 
štv®
($cid);

14 
	g$chªÃlid
 = 
em±y
(
$chªÃlid
è? 0 : 
štv®
($channelid);

20 if(
	g$dİo¡
=="addArchives")

23 if(
em±y
(
$cid
è&&ƒm±y(
$chªÃlid
))

25 
h—d”
("location:article_add.php");

26 
ex™
();

28 if(!
em±y
(
$chªÃlid
))

31 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT‡ddcon FROM #@__channeltype WHERE id='$channelid'");

36 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT ch.addcon FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch ON ch.id=tp.channeltype WHEREp.id='$cid' ");

38 
	g$gu¾
 = 
$row
["addcon"];

39 if(
	g$gu¾
=="")

41 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ æŒ‡çš„æ ç›®å¯èƒ½æœ‰è¯¯ï¼","catalog_main.php");

42 
ex™
();

46 
h—d”
("location:{$gurl}?channelid={$channelid}&cid={$cid}");

47 
ex™
();

53 if(
	g$dİo¡
=="listArchives")

55 if(!
em±y
(
$gu¾
))

57 if(
em±y
(
$¬üªk
))

59 
$¬üªk
 = '';

61 
	g$gu¾
 = 
¡r_»¶aû
('..','',
$gu¾
);

62 
h—d”
("location:{$gurl}?arcrank={$arcrank}&cid={$cid}");

63 
ex™
();

65 if(
	g$cid
>0)

67 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT #@__arctype.typename,#@__channeltype.typename AS channelname,#@__channeltype.id,#@__channeltype.mancon FROM #@__arctype LEFT JOIN #@__channeltype on #@__channeltype.id=#@__arctype.channeltype WHERE #@__arctype.id='$cid'");

68 
	g$gu¾
 = 
$row
["mancon"];

69 
	g$chªÃlid
 = 
$row
["id"];

70 
	g$ty³Çme
 = 
$row
["typename"];

71 
	g$chªÃÊame
 = 
$row
["channelname"];

72 if(
	g$gu¾
=="")

74 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ æŒ‡çš„æ ç›®å¯èƒ½æœ‰è¯¯ï¼","catalog_main.php");

75 
ex™
();

78 if(
	g$chªÃlid
>0)

80 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECTypename,id,mancon FROM #@__channeltype WHERE id='$channelid'");

81 
	g$gu¾
 = 
$row
["mancon"];

82 
	g$chªÃlid
 = 
$row
["id"];

83 
	g$ty³Çme
 = "";

84 
	g$chªÃÊame
 = 
$row
["typename"];

87 if(
em±y
(
$gu¾
)è
	g$gu¾
 = 'content_list.php';

88 
h—d”
("location:{$gurl}?channelid={$channelid}&cid={$cid}");

89 
ex™
();

95 if(
	g$dİo¡
=="viewTemplet")

97 
h—d”
("loÿtiÚ:l.php?·th=/".
$cfg_df_¡yË
);

98 
ex™
();

105 if(
	g$dİo¡
=="guestbook")

107 
ShowMsg
("æ­£åœ¨è·³è½¬åˆ°ç•™è¨€æœ¬&gt;&gt;", "{$cfg_phpurl}/guestbook.php?gotopagerank=admin");

108 
ex™
();

114 if(
	g$dİo¡
=="viewSgPage")

116 
»quœe_Úû
(
XAKINC
."/arc.listview.class.php");

117 
	g$lv
 = 
Ãw
 
Li¡V›w
(
$cid
);

118 
	g$·geu¾
 = 
$lv
->
MakeHtml
();

119 
ShowMsg
("æ›´æ–°ç¼“å†²ï¼Œè¯·ç¨å...",
$·geu¾
);

120 
ex™
();

126 if(
	g$dİo¡
=="upRank")

129 
CheckPurv›w
('t_Edit,t_AccEdit');

132 
CheckC©®og
(
$cid
,"ä½ æ— æƒæ›´æ”¹æœ¬æ ç›®ï¼");

133 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT„eid,sortrank FROM #@__arctype WHERE id='$cid'");

134 
	g$»id
 = 
$row
['reid'];

135 
	g$sÜŒªk
 = 
$row
['sortrank'];

136 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT sortrank FROM #@__arctype WHERE sortrank<=$sortrank AND„eid=$reid ORDER BY sortrank DESC ");

137 if(
is_¬¿y
(
$row
))

139 
	g$sÜŒªk
 = 
$row
['sortrank']-1;

140 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__arctype SET sortrank='$sortrank' WHERE id='$cid'");

142 
UpD©eC©Cache
();

143 
ShowMsg
("æ“ä½œæˆåŠŸï¼Œè¿”å›ç›®å½•...","catalog_main.php");

144 
ex™
();

146 if(
	g$dİo¡
=="upRankAll")

149 
CheckPurv›w
('t_Edit');

150 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM #@__arctype ORDER BY id DESC");

151 if(
is_¬¿y
(
$row
))

153 
	g$maxID
 = 
$row
['id'];

154 
	g$i
=1;$i<=
$maxID
;$i++)

156 if(
is£t
(
$
{'sÜŒªk'.
$i
}))

158 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__¬ùy³ SET sÜŒªk='".(
$
{'sÜŒªk'.
$i
})."' WHERE id='{$i}';");

162 
UpD©eC©Cache
();

163 
ShowMsg
("æ“ä½œæˆåŠŸï¼Œæ­£åœ¨è¿”å›...","catalog_main.php");

164 
ex™
();

170 if(
	g$dİo¡
=="upcatcache")

172 
UpD©eC©Cache
();

173 
	g$sql
 = " TRUNCATE TABLE `#@__arctiny`";

174 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

177 
	g$sql
 = "INSERT INTO `#@__arctiny`(id,ypeid,ypeid2,‡rcrank, channel, senddate, sortrank, mid)

178 
SELECT
 
id
, 
	gty³id
, 
	gty³id2
, 
	g¬üªk
, 
	gchªÃl
, 
	g£ndd©e
, 
	gsÜŒªk
, 
mid
 
	gFROM
 `#@
	g__¬chives
` ";

179 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

182 
	g$dsql
->
S‘Qu”y
("SELECT id,addtable FROM `#@__channeltype` WHERE id < -1 ");

183 
	g$dsql
->
Execu‹
();

184 
	g$dß¼ay
 = 
¬¿y
();

185 
	g$row
 = 
$dsql
->
G‘A¼ay
())

187 
$tb
 = 
¡r_»¶aû
('#@__', 
$cfg_db´efix
, 
$row
['addtable']);

188 if(
em±y
(
$tb
è|| 
is£t
(
$dß¼ay
[$tb]) )

194 
	g$sql
 = "INSERT INTO `#@__arctiny`(id,ypeid,ypeid2,‡rcrank, channel, senddate, sortrank, mid)

195 
SELECT
 
aid
, 
	gty³id
, 0, 
	g¬üªk
, 
	gchªÃl
, 
	g£ndd©e
, 0, 
mid
 
	gFROM
 `
	g$tb
` ";

196 
	g$rs
 = 
$dsql
->
execu‹nÚequ”y
(
$sql
);

197 
	g$dß¼ay
[
$tb
] = 1;

200 
ShowMsg
("æ“ä½œæˆåŠŸï¼Œæ­£åœ¨è¿”å›...","catalog_main.php");

201 
ex™
();

207 if(
	g$dİo¡
=="GetJs")

209 
h—d”
("location:makehtml_js.php");

210 
ex™
();

216 if(
	g$dİo¡
=="GetSunListsMenu")

218 
$u£rChªÃl
 = 
$cu£rLogš
->
g‘U£rChªÃl
();

219 
»quœe_Úû
(
XAKINC
."/typeunit.class.menu.php");

220 
AjaxH—d
();

221 
PutCook›
('Ï¡CidM’u',
$cid
,3600*24,"/");

222 
	g$tu
 = 
Ãw
 
Ty³Un™
(
$u£rChªÃl
);

223 
	g$tu
->
LogicLi¡AÎSunTy³
(
$cid
,"ã€€");

229 if(
	g$dİo¡
=="GetSunLists")

231 
»quœe_Úû
(
XAKINC
."/typeunit.class.admin.php");

232 
AjaxH—d
();

233 
PutCook›
('Ï¡Cid', 
$cid
, 3600*24, "/");

234 
	g$tu
 = 
Ãw
 
Ty³Un™
();

235 
	g$tu
->
	gdsql
 = 
$dsql
;

236 
	gecho
 " <table width='100%' border='0' cellspacing='0' cellpadding='0'>\r\n";

237 
	g$tu
->
LogicLi¡AÎSunTy³
(
$cid
, "ã€€");

238 
	gecho
 " </table>\r\n";

239 
	g$tu
->
Clo£
();

245 if(
	g$dİo¡
 == 'unitCatalog')

247 
CheckPurv›w
('t_Move');

248 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

249 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

250 
»quœe_Úû
(
XAKINC
.'/channelunit.func.php');

251 if(
em±y
(
$Ãxtjob
))

253 
	g$ty³id
 = 
is£t
(
$ty³id
è? 
štv®
($typeid) : 0;

254 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__arctype` WHERE„eid='$typeid' ");

255 
	g$
 = 
Ãw
 
Ty³Lšk
(
$ty³id
);

256 
	g$ty³Çme
 = 
$
->
Ty³Infos
['typename'];

257 
	g$»id
 = 
$
->
Ty³Infos
['reid'];

258 
	g$chªÃlid
 = 
$
->
Ty³Infos
['channeltype'];

259 if(!
em±y
(
$row
['dd']))

261 
ShowMsg
("æ ç›®ï¼š $typename($typeid) æœ‰å­æ ç›®ï¼Œä¸èƒ½è¿›è¡Œåˆå¹¶æ“ä½œï¼", '-1');

262 
ex™
();

264 
	g$ty³O±iÚs
 = 
$
->
G‘O±iÚA¼ay
(0, 0, 
$chªÃlid
);

265 
	g$wšt™Ë
 = 'åˆå¹¶æ ç›®';

266 
	g$wecome_šfo
 = "<a href='catalog_main.php'>æ ç›®ç®¡ç†</a> &gt;&gt; åˆå¹¶æ ç›®";

267 
	g$wš
 = 
Ãw
 
OxWšdow
();

268 
	g$wš
->
In™
('catalog_do.php', 'js/blank.js', 'POST');

269 
	g$wš
->
AddHidd’
('dopost', 'unitCatalog');

270 
	g$wš
->
AddHidd’
('ty³id', 
$ty³id
);

271 
	g$wš
->
AddHidd’
('chªÃlid', 
$chªÃlid
);

272 
	g$wš
->
AddHidd’
('nextjob', 'unitok');

273 
	g$wš
->
AddT™Ë
("åˆå¹¶ç›®å½•æ—¶ä¸ä¼šåˆ é™¤åŸæ¥çš„æ ç›®ç›®å½•ï¼Œåˆå¹¶åéœ€æ‰‹åŠ¨æ›´æ–°ç›®æ ‡æ ç›®çš„æ–‡æ¡£HTMLå’Œåˆ—è¡¨HTMLã€‚");

274 
	g$wš
->
AddI‹m
('ä½ é€‰æ‹©çš„æ ç›®æ˜¯ï¼š', "<font color='red'>$typename($typeid)</font>");

275 
	g$wš
->
AddI‹m
('ä½ å¸Œæœ›åˆå¹¶åˆ°é‚£ä¸ªæ ç›®ï¼Ÿ', "<select‚ame='unittype'>\r\n{$typeOptions}\r\n</select>");

276 
	g$wš
->
AddI‹m
('æ³¨æ„äº‹é¡¹ï¼š', 'æ ç›®ä¸èƒ½æœ‰ä¸‹çº§å­æ ç›®ï¼Œåªå…è®¸å­çº§åˆ°æ›´é«˜çº§æˆ–åŒçº§æˆ–ä¸åŒçˆ¶çº§çš„æƒ…å†µã€‚');

277 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

278 
	g$wš
->
Di¥Ïy
();

279 
ex™
();

283 if(
	g$ty³id
==
$un™ty³
)

285 
ShowMsg
("åŒä¸€æ ç›®æ— æ³•åˆå¹¶,è¯·åé€€é‡è¯•ï¼", '-1');

286 
ex™
();

288 if(
IsP¬’t
(
$un™ty³
, 
$ty³id
))

290 
ShowMsg
('ä¸èƒ½ä»çˆ¶ç±»åˆå¹¶åˆ°å­ç±»ï¼', 'catalog_main.php');

291 
ex™
();

293 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id='$channelid' ");

294 
	g$addbË
 = (
em±y
(
$row
['addtable']) ? '#@__addonarticle' : $row['addtable'] );

295 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctiny` SETypeid='$unittype' WHEREypeid='$typeid' ");

296 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__feedback` SETypeid='$unittype' WHEREypeid='$typeid' ");

297 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SETypeid='$unittype' WHEREypeid='$typeid' ");

298 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SETypeid2='$unittype' WHEREypeid2='$typeid' ");

299 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__addonspec` SETypeid='$unittype' WHEREypeid='$typeid' ");

300 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `$addtable` SETypeid='$unittype' WHEREypeid='$typeid' ");

301 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctype` WHERE id='$typeid' ");

302 
UpD©eC©Cache
();

303 
ShowMsg
('æˆåŠŸåˆå¹¶æŒ‡å®šæ ç›®ï¼', 'catalog_main.php');

304 
ex™
();

311 if(
	g$dİo¡
 == 'moveCatalog')

313 
CheckPurv›w
('t_Move');

314 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

315 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

316 
»quœe_Úû
(
XAKINC
.'/channelunit.func.php');

317 if(
em±y
(
$Ãxtjob
))

319 
	g$
 = 
Ãw
 
Ty³Lšk
(
$ty³id
);

320 
	g$ty³Çme
 = 
$
->
Ty³Infos
['typename'];

321 
	g$»id
 = 
$
->
Ty³Infos
['reid'];

322 
	g$chªÃlid
 = 
$
->
Ty³Infos
['channeltype'];

323 
	g$ty³O±iÚs
 = 
$
->
G‘O±iÚA¼ay
(0,0,
$chªÃlid
);

324 
	g$wšt™Ë
 = "ç§»åŠ¨æ ç›®";

325 
	g$wecome_šfo
 = "<a href='catalog_main.php'>æ ç›®ç®¡ç†</a> &gt;&gt; ç§»åŠ¨æ ç›®";

326 
	g$wš
 = 
Ãw
 
OxWšdow
();

327 
	g$wš
->
In™
('catalog_do.php', 'js/blank.js', 'POST');

328 
	g$wš
->
AddHidd’
('dopost', 'moveCatalog');

329 
	g$wš
->
AddHidd’
('ty³id', 
$ty³id
);

330 
	g$wš
->
AddHidd’
('chªÃlid', 
$chªÃlid
);

331 
	g$wš
->
AddHidd’
('nextjob', 'unitok');

332 
	g$wš
->
AddT™Ë
("ç§»åŠ¨ç›®å½•æ—¶ä¸ä¼šåˆ é™¤åŸæ¥å·²åˆ›å»ºçš„åˆ—è¡¨ï¼Œç§»åŠ¨åéœ€é‡æ–°å¯¹æ ç›®åˆ›å»ºHTMLã€‚");

333 
	g$wš
->
AddI‹m
('ä½ é€‰æ‹©çš„æ ç›®æ˜¯ï¼š',"$typename($typeid)");

334 
	g$wš
->
AddI‹m
('ä½ å¸Œæœ›ç§»åŠ¨åˆ°é‚£ä¸ªæ ç›®ï¼Ÿ',"<select‚ame='movetype'>\r\n<option value='0'>ç§»åŠ¨ä¸ºé¡¶çº§æ ç›®</option>\r\n$typeOptions\r\n</select>");

335 
	g$wš
->
AddI‹m
('æ³¨æ„äº‹é¡¹ï¼š','ä¸å…è®¸ä»çˆ¶çº§ç§»åŠ¨åˆ°å­çº§ç›®å½•ï¼Œåªå…è®¸å­çº§åˆ°æ›´é«˜çº§æˆ–åŒçº§æˆ–ä¸åŒçˆ¶çº§çš„æƒ…å†µã€‚');

336 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok');

337 
	g$wš
->
Di¥Ïy
();

338 
ex™
();

342 if(
	g$ty³id
==
$mov‘y³
)

344 
ShowMsg
('ç§»å¯¹å¯¹è±¡å’Œç›®æ ‡ä½ç½®ç›¸åŒï¼', 'catalog_main.php');

345 
ex™
();

347 if(
IsP¬’t
(
$mov‘y³
, 
$ty³id
))

349 
ShowMsg
('ä¸èƒ½ä»çˆ¶ç±»ç§»åŠ¨åˆ°å­ç±»ï¼', 'catalog_main.php');

350 
ex™
();

352 
	g$dsql
->
Execu‹NÚeQu”y
(" UPDATE `#@__arctype` SET„eid='$movetype' WHERE id='$typeid' ");

353 
UpD©eC©Cache
();

354 
ShowMsg
('æˆåŠŸç§»åŠ¨ç›®å½•ï¼', 'catalog_main.php');

355 
ex™
();

	@E:\web\weixun\xakadmin\catalog_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 
	g$id
 = 
is£t
(
$id
è? 
	$štv®
(
$id
) : 0;

14 
	`CheckPurv›w
('t_Edit,t_AccEdit');

17 
	`CheckC©®og
(
$id
, 'ä½ æ— æƒæ›´æ”¹æœ¬æ ç›®ï¼');

22 if(
$dİo¡
=="save")

24 
$desütiÚ
 = 
	`Html2Text
($description,1);

25 
$keywÜds
 = 
	`Html2Text
($keywords,1);

26 
$u±İsql
 = 
$sm®Éy³s
 = '';

29 if(!
	`is£t
(
$autokey
)) $autokey = 0;

30 if(!
	`is£t
(
$»mÙe
)) $remote = 0;

31 if(!
	`is£t
(
$d–lšk
)) $dellink = 0;

32 if(!
	`is£t
(
$autŞ™pic
)) $autolitpic = 0;

34 if(
	`is£t
(
$sm®Éy³
è&& 
	`is_¬¿y
($sm®Éy³)è
$sm®Éy³s
 = 
	`još
(',',$smalltype);

35 if(
$tİid
==0)

37 
$s™•©h
 = 
$ty³dœ
;

38 
$u±İsql
 = " ,siteurl='$siteurl',sitepath='$sitepath',ishidden='$ishidden' ";

42 if(
$i¥¬t
!=0è
$üoss
 = 0;

45 
$cÚ‹Á
 = 
	`AÇly£HtmlBody
($content);

47 
$upqu”y
 = "UPDATE `#@__arctype` SET

48 
is£nd
='$issend',

49 
sÜŒªk
='$sortrank',

50 
ty³Çme
='$typename',

51 
ty³dœ
='$typedir',

52 
isdeçuÉ
='$isdefault',

53 
deçuÉÇme
='$defaultname',

54 
is£nd
='$issend',

55 
ishidd’
='$ishidden',

56 
chªÃÉy³
='$channeltype',

57 
‹mpšdex
='$tempindex',

58 
‹m¶i¡
='$templist',

59 
‹m·¹işe
='$temparticle',

60 
Çm”uË
='$namerule',

61 
Çm”uË2
='$namerule2',

62 
i¥¬t
='$ispart',

63 
cÜªk
='$corank',

64 
desütiÚ
='$description',

65 
keywÜds
='$keywords',

66 
£Ù™Ë
='$seotitle',

67 
mÜes™e
='$moresite',

68 
ty³pic
='$typepic',

69 
İ’_Ãw
='$open_new',

70 
ddimg_width
='$ddimg_width',

71 
ddimg_height
='$ddimg_height',

72 `
üoss
`='$cross',

73 `
cÚ‹Á
`='$content',

74 `
üossid
`='$crossid',

75 `
sm®Éy³s
`='$smalltypes'

76 
$u±İsql


77 
WHERE
 
id
='$id' ";

79 if(!
$dsql
->
	`Execu‹NÚeQu”y
(
$upqu”y
))

81 
	`ShowMsg
("ä¿å­˜å½“å‰æ ç›®æ›´æ”¹æ—¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä½ çš„è¾“å…¥èµ„æ–™æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼","-1");

82 
	`ex™
();

86 if(
$tİid
>0 && 
$is£nd
==1)

88 
$dsql
->
	`Execu‹NÚeQu”y
("UPDATE `#@__arctype` SET issend='$issend' WHERE id='$topid'; ");

90 
$¦šks
 = " id IN (".
	`G‘SÚIds
(
$id
).")";

93 if(
$tİid
==0 && 
	`´eg_m©ch
("#,#", 
$¦šks
))

95 
$upqu”y
 = "UPDATE `#@__arctype` SET moresite='$moresite', siteurl='$siteurl',sitepath='$sitepath' WHERE 1=1 AND $slinks";

96 
$dsql
->
	`Execu‹NÚeQu”y
(
$upqu”y
);

100 if(!
	`em±y
(
$u²ext
))

102 
$upqu”y
 = "UPDATE `#@__arctype` SET

103 
is£nd
='$issend',

104 
deçuÉÇme
='$defaultname',

105 
chªÃÉy³
='$channeltype',

106 
‹mpšdex
='$tempindex',

107 
‹m¶i¡
='$templist',

108 
‹m·¹işe
='$temparticle',

109 
Çm”uË
='$namerule',

110 
Çm”uË2
='$namerule2',

111 
ddimg_width
='$ddimg_width',

112 
ddimg_height
='$ddimg_height'

113 
WHERE
 1=1 
AND
 
$¦šks
";

117 if(!
$dsql
->
	`Execu‹NÚeQu”y
(
$upqu”y
))

119 
	`ShowMsg
("æ›´æ”¹å½“å‰æ ç›®æˆåŠŸï¼Œä½†æ›´æ”¹ä¸‹çº§æ ç›®å±æ€§æ—¶å¤±è´¥ï¼","-1");

120 
	`ex™
();

123 
	`UpD©eC©Cache
();

124 
	`ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªåˆ†ç±»ï¼","catalog_main.php");

125 
	`ex™
();

126 
	}
}

127 ià(
	g$dİo¡
=="savetime")

129 
$u±İsql
 = '';

130 
	g$¦šks
 = " id IN (".
G‘SÚIds
(
$id
).")";

133 if(
	g$tİid
==0 && 
$mÜes™e
==1)

135 
$s™•©h
 = 
$ty³dœ
;

136 
	g$u±İsql
 = " ,sitepath='$sitepath' ";

137 if(
´eg_m©ch
("#,#", 
$¦šks
))

139 
	g$upqu”y
 = "UPDATE `#@__arctype` SET sitepath='$sitepath' WHERE $slinks";

140 
	g$dsql
->
Execu‹NÚeQu”y
(
$upqu”y
);

144 if(
	g$tİid
 > 0 && 
	g$is£nd
==1)

146 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctype` SET issend='$issend' WHERE id='$topid'; ");

149 
	g$upqu”y
 = "UPDATE `#@__arctype` SET

150 
is£nd
='$issend',

151 
	gsÜŒªk
='$sortrank',

152 
	gty³dœ
='$typedir',

153 
	gty³Çme
='$typename',

154 
	gisdeçuÉ
='$isdefault',

155 
	gdeçuÉÇme
='$defaultname',

156 
	gishidd’
='$ishidden',

157 
	gİ’_Ãw
='$open_new',

158 
	gi¥¬t
='$ispart',

159 
	gcÜªk
='$cÜªk' 
$u±İsql


160 
WHERE
 
id
='$id' ";

162 if(!
$dsql
->
Execu‹NÚeQu”y
(
$upqu”y
))

164 
ShowMsg
("ä¿å­˜å½“å‰æ ç›®æ›´æ”¹æ—¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä½ çš„è¾“å…¥èµ„æ–™æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼","-1");

165 
ex™
();

167 
UpD©eC©Cache
();

168 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªåˆ†ç±»ï¼","catalog_main.php");

169 
ex™
();

173 
	g$dsql
->
S‘Qu”y
("SELECTp.*,ch.typename‡s ctypename FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch ON ch.id=tp.channeltype WHEREp.id=$id");

174 
	g$myrow
 = 
$dsql
->
G‘OÃ
();

175 
	g$tİid
 = 
$myrow
['topid'];

176 if(
	g$tİid
>0)

178 
	g$tİrow
 = 
$dsql
->
G‘OÃ
("SELECT moresite,siteurl,sitepath FROM `#@__arctype` WHERE id=$topid");

179 
fÜ—ch
(
$tİrow
 
as
 
$k
=>
$v
)

181 if(!
´eg_m©ch
("#[0-9]#", 
$k
))

183 
$myrow
[
$k
] = 
$v
;

187 
	g$myrow
['cÚ‹Á']=
em±y
(
$myrow
['content'])? "&nbsp;" : $myrow['content'];

190 
	g$chªÃlid
 = 
$myrow
['channeltype'];

191 
	g$dsql
->
S‘Qu”y
("SELECT id,typename,nid FROM `#@__channeltype` WHERE id<>-1 AND isshow=1 ORDER BY id");

192 
	g$dsql
->
Execu‹
();

193 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

195 
$chªÃlA¼ay
[
$row
->
id
]['ty³Çme'] = $row->
ty³Çme
;

196 
$chªÃlA¼ay
[
$row
->
id
]['nid'] = $row->
nid
;

197 if(
$row
->
id
==
$chªÃlid
)

199 
$nid
 = 
$row
->
nid
;

201 
	}
}

202 
PutCook›
('Ï¡Cid',
G‘Tİid
(
$id
),3600*24,"/");

203 if(
	g$dİo¡
 == 'time')

206 <
fÜm
 
Çme
="fÜm1" 
aùiÚ
="ÿlog_ed™.php" 
m‘hod
="po¡" 
ÚSubm™
="return checkSubmit();">

207 <
šput
 
ty³
="hidd’" 
Çme
="dİo¡" 
v®ue
="savetime" />

208 <
šput
 
ty³
="hidd’" 
Çme
="id" 
v®ue
="<?phpƒcho $id; ?>" />

209 <
šput
 
ty³
="hidd’" 
Çme
="tİid" 
v®ue
="<?phpƒcho $myrow['topid']; ?>" />

210 <
šput
 
ty³
="hidd’" 
Çme
="mÜes™e" 
v®ue
="<?phpƒcho $myrow['moresite']; ?>" />

211 <
bË
 
width
="100%" 
bÜd”
="0" 
ûÎ·ddšg
="0" 
ûÎ¥acšg
="0">

212 <?
php
 if(
$İ’_memb”
){ ?>

213 <
Œ
>

214 <
td
 
şass
='blše' 
height
="26" 
®ign
="right">æ˜¯å¦æ”¯æŒæŠ•ç¨¿ï¼š</td>

215 <
td
 
şass
='blše'> <
šput
 
ty³
='¿dio' 
Çme
='is£nd' 
v®ue
='0' cÏss='Å' <?
php
 if(
$myrow
['is£nd']=="0"è
echo
 " checked='1' ";?> />

216 ä¸æ”¯æŒ&
	gnb¥
; <
šput
 
	gty³
='¿dio' 
Çme
='is£nd' 
v®ue
='1' 
şass
='Å' <?
php
 if(
$myrow
['is£nd']=="1"è
echo
 " checked='1' ";?> />

217 æ”¯æŒ </
	gtd
>

218 </
	gŒ
>

219 <?
	gphp
 }{ ?>

220 <
	gŒ
>

221 <
td
 
	gşass
='blše' 
height
="26" 
®ign
="ûÁ”" 
cŞ¥ª
="2">

222 <
a
 
h»f
='ÿlog_ed™.php?id=<?ph°echØ$id; ?>'><
u
>å½“å‰æ˜¯å¿«æ·ç¼–è¾‘æ¨¡å¼ï¼Œå¦‚æœæ‚¨è¦ä¿®æ”¹æ›´è¯¦ç»†çš„å‚æ•°ï¼Œè¯·ä½¿ç”¨é«˜çº§æ¨¡å¼&
gt
;&
	ggt
;</
	gu
></
	ga
>

223 </
	gtd
>

224 </
	gŒ
>

225 <
šput
 
	gty³
="hidd’" 
Çme
="is£nd" 
v®ue
="1" />

226 <?
php
 } ?>

227 <
	gŒ
>

228 <
td
 
	gşass
='blše' 
height
="26" 
®ign
="right">æ˜¯å¦éšè—æ ç›®ï¼š</td>

229 <
td
 
şass
='blše'> <
šput
 
ty³
='¿dio' 
Çme
='ishidd’' 
v®ue
='0' cÏss='Å' <?
php
 if(
$myrow
['ishidd’']=="0"è
echo
 " checked='1' ";?> />

230 æ˜¾ç¤º&
	gnb¥
; <
šput
 
	gty³
='¿dio' 
Çme
='ishidd’' 
v®ue
='1' 
şass
='Å' <?
php
 if(
$myrow
['ishidd’']=="1"è
echo
 " checked='1' ";?> />

231 éšè— </
	gtd
>

232 </
	gŒ
>

233 <
	gŒ
>

234 <
td
 
	gşass
='blše' 
height
="26" 
®ign
="right">æ˜¯å¦æ–°çª—å£æ‰“å¼€ï¼š</td>

235 <
td
 
şass
='blše'> <
šput
 
ty³
='¿dio' 
Çme
='İ’_Ãw' 
v®ue
='1' cÏss='Å' <?
php
 if(
$myrow
['İ’_Ãw']=="1"è
echo
 " checked='1' ";?> />

236 æ˜¯&
	gnb¥
; <
šput
 
	gty³
='¿dio' 
Çme
='İ’_Ãw' 
v®ue
='0' 
şass
='Å' <?
php
 if(
$myrow
['İ’_Ãw']=="0"è
echo
 " checked='1' ";?> />

237 å¦ </
	gtd
>

238 </
	gŒ
>

240 <
	gŒ
>

241 <
td
 
	gwidth
="150" 
şass
='blše' 
height
="26" 
®ign
="right"><
fÚt
 
cŞÜ
='red'>å†…å®¹æ¨¡å‹ï¼š</font> </td>

242 <
td
 
şass
='bline'>

243 <?
php


244 
fÜ—ch
(
$chªÃlA¼ay
 
as
 
$k
=>
$¬r
)

246 if(
$k
==
$chªÃlid
è
echo
 "{$arr['typename']} | {$arr['nid']}";

249 <
a
 
	gh»f
='ÿlog_ed™.php?id=<?ph°echØ$id; ?>'><
u
>[ä¿®æ”¹]</u></a>

250 </
td
>

251 </
Œ
>

253 <
Œ
>

254 <
td
 
şass
='blše' 
height
="26" 
®ign
="right"><
fÚt
 
cŞÜ
='red'>æ ç›®åç§°ï¼š</font></td>

255 <
td
 
şass
='blše'><
šput
 
Çme
="ty³Çme" 
ty³
="‹xt" 
id
="ty³Çme" 
size
="30" 
v®ue
="<?phpƒcho $myrow['typename']?>" class="iptxt" /></td>

256 </
Œ
>

257 <
Œ
>

258 <
td
 
şass
='blše' 
height
="26" 
®ign
="right"> æ’åˆ—é¡ºåºï¼š </td>

259 <
td
 
şass
='blše'> <
šput
 
Çme
="sÜŒªk" 
size
="6" 
ty³
="‹xt" 
v®ue
="<?phpƒcho $myrow['sortrank']?>" class="iptxt" />

260 ï¼ˆç”±ä½ -&
gt
; é«˜ï¼‰ </
	gtd
>

261 </
	gŒ
>

262 <?
php
 if(
	g$İ’_memb”
){ ?>

263 <
	gŒ
>

264 <
td
 
	gşass
='blše' 
height
="26" 
®ign
="right">æµè§ˆæƒé™ï¼š</td>

265 <
td
 
şass
='blše'> <
£Ëù
 
Çme
="cÜªk" 
id
="cÜªk" 
¡yË
="width:100">

266 <?
php


267 
$dsql
->
S‘Qu”y
("SELECT * FROM #@__arcrank WHERE„ank >= 0");

268 
	g$dsql
->
Execu‹
();

269 
	g$row
 = 
$dsql
->
G‘Objeù
())

271 if(
$myrow
['cÜªk']==
$row
->
¿nk
)

272 
echo
 "<İtiÚ v®ue='".
$row
->
¿nk
."' s–eùed>".$row->
memb”Çme
."</option>\r\n";

274 
	gecho
 "<İtiÚ v®ue='".
	g$row
->
	g¿nk
."'>".$row->
	gmemb”Çme
."</option>\r\n";

277 </
	g£Ëù
>

278 (ä»…é™åˆ¶æ ç›®é‡Œçš„æ–‡æ¡£æµè§ˆæƒé™è</
	gtd
>

279 </
	gŒ
>

280 <?
	gphp
 }{ ?>

281 <
šput
 
	gty³
="hidd’" 
Çme
="cÜªk" 
v®ue
="0" />

282 <?
php
 } ?>

283 <
	gŒ
>

284 <
td
 
	gşass
='blše' 
height
="26" 
®ign
="right">æ–‡ä»¶ä¿å­˜ç›®å½•ï¼š</td>

285 <
td
 
şass
='blše'><
šput
 
Çme
="ty³dœ" 
ty³
="‹xt" 
id
="ty³dœ" 
v®ue
="<?ph°echØ$myrow['ty³dœ']?>" 
¡yË
="width:300px" class="iptxt" /></td>

286 </
Œ
>

288 <
Œ
>

289 <
td
 
height
="26" 
®ign
="right" 
şass
='bline'>æ ç›®åˆ—è¡¨é€‰é¡¹ï¼š</td>

290 <
td
 
şass
='blše'> <
šput
 
ty³
='¿dio' 
Çme
='isdeçuÉ' 
v®ue
='1' cÏss='Å'<?
php
 if(
$myrow
['isdeçuÉ']==1è
echo
 " checked='1' ";?>/>

292 <
šput
 
	gty³
='¿dio' 
Çme
='isdeçuÉ' 
v®ue
='0' 
şass
='Å'<?
php
 if(
$myrow
['isdeçuÉ']==0è
echo
 " checked='1' ";?>/>

294 <
šput
 
	gty³
='¿dio' 
Çme
='isdeçuÉ' 
v®ue
='-1' 
şass
='Å'<?
php
 if(
$myrow
['isdeçuÉ']==-1è
echo
 " checked='1' ";?>/>

296 <
šput
 
	gty³
='¿dio' 
Çme
='isdeçuÉ' 
v®ue
='2' 
şass
='Å'<?
php
 if(
$myrow
['isdeçuÉ']==2è
echo
 " checked='1' ";?>/>

297 <
fÚt
 
	gcŞÜ
="#FF0000">é“¾æ¥åˆ°å­åˆ†ç±»</fÚt></
td
>

298 </
Œ
>

300 <
Œ
>

301 <
td
 
şass
='blše' 
height
="26" 
®ign
="right">é»˜è®¤é¡µçš„åç§°ï¼š </td>

302 <
td
 
şass
='blše'><
šput
 
Çme
="deçuÉÇme" 
ty³
="‹xt" 
v®ue
="<?phpƒcho $myrow['defaultname']?>" class="iptxt" /></td>

303 </
Œ
>

304 <?
php
 if(
$İ’_memb”
){ ?>

305 <
Œ
>

306 <
td
 
height
="26" 
şass
='blše' 
®ign
="right">æ ç›®å±æ€§ï¼š</td>

307 <
td
 
şass
='bline'>

308 <
šput
 
Çme
="i¥¬t" 
ty³
="¿dio" 
id
="¿dio" 
v®ue
="0" 
şass
='Å'<?
php
 if(
$myrow
['i¥¬t']==0è
echo
 " checked='1' ";?>/>

310 <
šput
 
	gÇme
="i¥¬t" 
ty³
="¿dio" 
id
="¿dio2" 
v®ue
="1" 
şass
='Å'<?
php
 if(
$myrow
['i¥¬t']==1è
echo
 " checked='1' ";?>/>

312 <
šput
 
	gÇme
="i¥¬t" 
ty³
="¿dio" 
id
="¿dio3" 
v®ue
="2" 
şass
='Å'<?
php
 if(
$myrow
['i¥¬t']==2è
echo
 " checked='1' ";?>/>

314 </
	gtd
>

315 </
	gŒ
>

316 <?
	gphp
 }{ ?>

317 <
	gŒ
>

318 <
td
 
	gheight
="26" 
şass
='blše' 
®ign
="center">æ ç›®å±æ€§ï¼š</td>

319 <
td
 
şass
='bline'>

320 <
šput
 
Çme
="i¥¬t" 
ty³
="¿dio" 
id
="¿dio" 
v®ue
="0" 
şass
='Å'<?
php
 if(
$myrow
['i¥¬t']==0è
echo
 " checked='1' ";?>/>

321 æœ€ç»ˆåˆ—è¡¨æ ç›®ï¼ˆå…è®¸åœ¨æœ¬æ ç›®å‘å¸ƒæ–‡æ¡£ï¼Œå¹¶ç”Ÿæˆæ–‡æ¡£åˆ—è¡¨ï¼‰<
	gbr
>

322 <
šput
 
	gÇme
="i¥¬t" 
ty³
="¿dio" 
id
="¿dio2" 
v®ue
="1" 
şass
='Å'<?
php
 if(
$myrow
['i¥¬t']==1è
echo
 " checked='1' ";?>/>

324 é¢‘é“å°é¢ï¼ˆæ ç›®æœ¬èº«ä¸å…è®¸å‘å¸ƒæ–‡æ¡£ï¼‰<
	gbr
>

325 <
šput
 
	gÇme
="i¥¬t" 
ty³
="¿dio" 
id
="¿dio3" 
v®ue
="2" 
şass
='Å'<?
php
 if(
$myrow
['i¥¬t']==2è
echo
 " checked='1' ";?>/>

326 å¤–éƒ¨è¿æ¥ï¼ˆåœ¨"æ–‡ä»¶ä¿å­˜ç›®å½•"å¤„å¡«å†™ç½‘å€ï¼‰ </
	gtd
>

327 </
	gŒ
>

328 <?
	gphp
 } ?>

329 <
	gŒ
>

330 <
td
 
	g®ign
="ûÁ”" 
cŞ¥ª
="2" 
height
="45" 
bgcŞÜ
='#FAFEE0'>

331 <
šput
 
Çme
="imageF›ld" 
ty³
="image" 
¤c
="images/bu‰Ú_ok.gif" 
width
="60" 
height
="22" 
bÜd”
="0" 
şass
="np"/>

332 &
nb¥
;&
	gnb¥
;&nbsp;

333 <
a
 
	gt™Ë
='å…³é—­' 
Úşick
='Clo£Msg()'><
img
 
¤c
="images/bu‰Ú_back.gif" 
width
="60" 
height
="22" 
bÜd”
="0"></a>

334 </
td
>

335 </
Œ
>

336 </
bË
>

337 </
fÜm
>

338 <?
php


339 
ex™
();

343 
šşude
 
XAKINClude
('templets/catalog_edit.htm');

	@E:\web\weixun\xakadmin\catalog_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typeunit.class.admin.php");

9 
	g$u£rChªÃl
 = 
$cu£rLogš
->
g‘U£rChªÃl
();

10 
šşude
 
XAKINClude
('templets/catalog_main.htm');

	@E:\web\weixun\xakadmin\catalog_menu.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typeunit.class.menu.php");

9 
	g$u£rChªÃl
 = 
$cu£rLogš
->
g‘U£rChªÃl
();

10 if(
em±y
(
$İ’dœ
)è
	g$İ’dœ
=-1;

11 if(
	g$u£rChªÃl
>0è
	g$İ’dœ
=
$u£rChªÃl
;

13 if(
	g$cu£rLogš
->
	gadmšStyË
=='xak.cn')

15 
šşude
 
XAKINClude
('templets/catalog_menu.htm');

16 
ex™
();

20 
šşude
 
XAKINClude
('templets/catalog_menu2.htm');

21 
ex™
();

	@E:\web\weixun\xakadmin\co_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('co_AddNote');

9 if(
em±y
(
$¡•
)è
	g$¡•
 = "";

10 if(
em±y
(
$exruË
)è
	g$exruË
 = "";

16 if(
	$em±y
(
$¡•
))

18 
	`»quœe_Úû
(
XAKADMIN
."/templets/co_add_step0.htm");

19 
	`ex™
();

20 
	}
}

21 if(
	g$¡•
==1)

23 
»quœe_Úû
(
XAKADMIN
."/templets/co_add_step1.htm");

24 
ex™
();

30 if(
	g$¡•
==2)

33 if(
$dİo¡
=='test')

35 
šşude
(
XAKINC
."/xakcollection.class.php");

36 
	g$u£mÜe
 = (!
is£t
(
$u£mÜe
) ? 0 : 1);

37 
	g$li¡cÚfig
 = "{xak:noteinfo‚otename=\\\"$notename\\\" channelid=\\\"$channelid\\\" macthtype=\\\"$macthtype\\\"

38 
»fu¾
=\\\"$refurl\\\" sourcelang=\\\"$sourcelang\\\" cosort=\\\"$cosort\\\" isref=\\\"$isref\\\"ƒxptime=\\\"$exptime\\\" usemore=\\\"$usemore\\\" /}

40 {
xak
:
li¡ruË
 
sourûty³
=\\\"$sourcetype\\\"„ssurl=\\\"$rssurl\\\"„egxurl=\\\"$regxurl\\\"

41 
¡¬tid
=\\\"$startid\\\"ƒndid=\\\"$endid\\\"‡ddv=\\\"$addv\\\" urlrule=\\\"$urlrule\\\"

42 
mu¡has
=\\\"$musthas\\\"‚othas=\\\"$nothas\\\"†istpic=\\\"$listpic\\\" usemore=\\\"$usemore\\\"}

43 {
xak
:
addu¾s
}
$addu¾s
{/xak:addurls}

44 {
xak
:
b©chruË
}
$b©chruË
{/xak:batchrule}

45 {
xak
:
»gxruË
}
$»gxruË
{/xak:regxrule}

46 {
xak
:
¬—¡¬t
}
$¬—¡¬t
{/xak:areastart}

47 {
xak
:
¬—’d
}
$¬—’d
{/xak:areaend}

48 {/
xak
:
li¡ruË
}\
r
\
n
";

49 
$tm¶i¡cÚfig
 = 
¡r¦ashes
(
$li¡cÚfig
);

50 
	g$nÙ’ame
 = 
¡r¦ashes
(
$nÙ’ame
);

51 if(
	g$sourûty³
=='rss' && 
$»fu¾
='')

53 
$»fu¾
 = 
$rssu¾
;

55 
	g$»fu¾
 = 
¡r¦ashes
(
$»fu¾
);

56 
	g$”rmsg
 = '';

57 
	g$äeq
 = 
em±y
(
$äeq
)? "" : $freq;

58 
	g$exty³id
 = 
em±y
(
$äeq
)? "" : 
$exty³id
;

61 if(
	g$sourûty³
=='rss')

63 
$lšks
 = 
G‘RssLšks
(
¡r¦ashes
(
$rssu¾
));

64 
	g$demİage
 = 
$rssu¾
;

68 
	g$lšks
 = 
¬¿y
();

69 
	g$li¡s
 = 
G‘U¾FromLi¡RuË
(
$»gxu¾
,
¡r¦ashes
(
$addu¾s
),
$¡¬tid
,
$’did
,
$addv
,
$u£mÜe
,¡r¦ashes(
$b©chruË
));

70 if(
is£t
(
$li¡s
[0][0]))

72 
	g$demİage
 = 
$li¡s
[0][0];

73 
	g$dc
 = 
Ãw
 
XakCŞËùiÚ
();

74 
	g$dc
->
LßdLi¡CÚfig
(
$tm¶i¡cÚfig
);

75 
	g$li¡u¾
 = '';

76 
	g$lšks
 = 
$dc
->
Te¡li¡s
(
$li¡u¾
);

77 
	g$”rmsg
 = 
$dc
->
”rSŒšg
;

81 
	g$demİage
 = 'æ²¡æœ‰åŒ¹é…åˆ°é€‚åˆçš„åˆ—è¡¨é¡µ!';

84 
»quœe_Úû
(
XAKADMIN
."/templets/co_add_step1_test.htm");

85 
ex™
();

91 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT‚id,channelid FROM `#@__co_note` WHERE isok=0 AND‚otename LIKE '$notename' ");

92 if(!
is_¬¿y
(
$row
))

94 
	g$u±ime
 = 
time
();

95 
	g$li¡cÚfig
 = 
u¾decode
(
$li¡cÚfig
);

96 
	g$šqu”y
 = " INSERT INTO `#@__co_note`(`channelid`,`notename`,`sourcelang`,`uptime`,`cotime`,`pnum`,`isok`,`usemore`,`listconfig`,`itemconfig`)

97 
VALUES
 ('$channelid','$notename','$sourcelang','$uptime','0','0','0','$usemore','$listconfig',''); ";

98 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

99 if(!
	g$rs
)

101 
ShowMsg
("ä¿å­˜ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼".
$dsql
->
G‘E¼Ü
(),"-1");

102 
ex™
();

104 
	g$nid
 = 
$dsql
->
G‘La¡ID
();

108 
	g$chªÃlid
=
$row
['channelid'];

109 
	g$u±ime
 = 
time
();

110 if(
em±y
(
$äeq
)è
	g$äeq
 = 1;

111 if(
em±y
(
$exty³id
)è
	g$exty³id
 = 0;

112 if(
em±y
(
$i¦i¡’
)è
	g$i¦i¡’
 = 0;

113 
	g$u£mÜe
 = (!
is£t
(
$u£mÜe
) ? 0 : 1);

115 
	g$qu”y
 = " UPDATE `#@__co_note` SET

116 `
chªÃlid
`='$channelid',

117 `
	gnÙ’ame
`='$notename',

118 `
	gsourûÏng
`='$sourcelang',

119 `
	gu±ime
`='$uptime',

120 `
	gisok
`='1',

121 `
	gu£mÜe
`='$usemore',

122 `
	gli¡cÚfig
`='$li¡cÚfig' 
WHERE
 
nid
='$nid'; ";

123 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

124 
	g$nid
 = 
$row
['nid'];

126 if(!
is£t
(
$´ev›wu¾
)è
	g$´ev›wu¾
 = '';

127 
»quœe_Úû
(
XAKINC
.'/xaktag.class.php');

128 
»quœe_Úû
(
XAKADMIN
."/templets/co_add_step2.htm");

129 
ex™
();

137 if(
	g$¡•
==5)

142 
$™emcÚfig
 = "{xak:sppage sptype=\\'$sptype\\' sptype=\\'$sptype\\' srul=\\'$srul\\'ƒrul=\\'$erul\\'}$sppage{/xak:sppage}\r\n";

143 
	g$™emcÚfig
 .= "{xak:previewurl}$previewurl{/xak:previewurl}\r\n";

144 
	g$™emcÚfig
 .= "{xak:keywordtrim}$keywordtrim{/xak:keywordtrim}\r\n";

145 
	g$™emcÚfig
 .= "{xak:descriptiontrim}$descriptiontrim{/xak:descriptiontrim}\r\n";

146 
	g$fs
 = 
ex¶ode
(',','value,match,isunit,isdown,trim,function');

147 
fÜ—ch
(
$f›lds
 
as
 
$f›ld
)

149 
fÜ—ch
(
$fs
 
as
 
$f
)

151 
	g$GLOBALS
[
$f
.'_'.
$f›ld
] = (!
is£t
(
$GLOBALS
[$f.'_'.$field]) ? '' : $GLOBALS[$f.'_'.$field]);

153 
	g$m©ch¡r
 = 
$GLOBALS
["m©ch_".
$f›ld
];

154 
	g$Œim¡r
 = 
$GLOBALS
["Œim_".
$f›ld
];

155 
	g$Œim¡r
 = 
Œim
(
¡r_»¶aû
('&nb¥;','#n#',
$Œim¡r
));

156 
	g$m©ch¡r
 = 
Œim
(
¡r_»¶aû
('&nb¥;','#n#',
$m©ch¡r
));

157 if(
	g$Œim¡r
!='' && !
´eg_m©ch
("#{xak:Œim#i", 
$Œim¡r
))

159 
	g$Œim¡r
 = " {xak:trim}$trimstr{/xak:trim}\r\n";

161 
	g$™emcÚfig
 .ğ"{xak:™em f›ld=\\'".
$f›ld
."\\' v®ue=\\'".
$GLOBALS
["value_".$field]."\\' isunit=\\'".$GLOBALS["isunit_".$field]."\\' isdown=\\'".$GLOBALS["isdown_".$field]."\\'}

162 {
xak
:
m©ch
}".$matchstr."{/xak:match}

163 
$Œim¡r


164 {
xak
:
funùiÚ
}".$GLOBALS["
funùiÚ_
".$field]."{/xak:function}

165 {/
xak
:
™em
}\
r
\
n
";

167 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_note` SET itemconfig='$itemconfig' WHERE‚id='$nid' ");

169 
»quœe_Úû
(
XAKINC
.'/xakcollection.class.php');

170 
»quœe_Úû
(
XAKADMIN
."/templets/co_add_step2_test.htm");

171 
ex™
();

173 if(
	g$¡•
==6)

175 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_note` SET isok='1' WHERE‚id='$nid' ");

176 
ShowMsg
("æˆåŠŸè®¾ç½®ä¸€ä¸ªè§„åˆ™ï¼","co_main.php");

177 
ex™
();

179 if(
	g$¡•
==7)

181 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_note` SET isok='1' WHERE‚id='$nid' ");

182 
ShowMsg
("æˆåŠŸè®¾ç½®ä¸€ä¸ªè§„åˆ™ï¼Œç°åœ¨è½¬å‘é‡‡é›†é¡µé¢ï¼","co_gather_start.php?nid=$nid");

183 
ex™
();

	@E:\web\weixun\xakadmin\co_do.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

9 if(!
is£t
(
$nid
)è
	g$nid
=0;

10 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
["ENV_GOBACK_URL"]) ? "co_url.php" : $_COOKIE["ENV_GOBACK_URL"];

17 if(
	g$dİo¡
=="delete")

19 
CheckPurv›w
('co_Del');

20 
	g$nid
 = 
štv®
(
$nid
);

21 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__co_htmls` WHERE‚id='$nid'");

22 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__co_note` WHERE‚id='$nid'");

23 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__co_urls` WHERE‚id='$nid'");

24 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹!","co_main.php");

25 
ex™
();

33 if(
	g$dİo¡
=="clear")

35 
CheckPurv›w
('co_Del');

36 if(!
is£t
(
$ids
)è
	g$ids
='';

37 if(
em±y
(
$ids
))

39 if(!
em±y
(
$nid
))

41 
	g$nid
 = 
štv®
(
$nid
);

42 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__co_htmls` WHERE‚id='$nid'");

44 
ShowMsg
("æˆåŠŸæ¸…ç©ºä¸€ä¸ªèŠ‚ç‚¹é‡‡é›†çš„å†…å®¹!","co_main.php");

45 
ex™
();

49 if(!
em±y
(
$şshash
))

51 
	g$dsql
->
S‘Qu”y
("SELECT‚id,url FROM `#@__co_htmls` WHERE‡id IN($ids) ");

52 
	g$dsql
->
Execu‹
();

53 
	g$¬r
 = 
$dsql
->
G‘A¼ay
())

55 
$nhash
 = 
md5
(
$¬r
['url']);

56 
	g$nid
 = 
$row
['nid'];

57 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__co_urls ` WHERE‚id='$nid' AND hash='$nhash' ");

60 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__co_htmls` WHERE‡id IN($ids) ");

61 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„ç½‘å€å†…å®¹!",
$ENV_GOBACK_URL
);

62 
ex™
();

65 if(
	g$dİo¡
=="clearct")

67 
CheckPurv›w
('co_Del');

68 if(!
em±y
(
$ids
))

70 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_htmls` SET isdown=0,result='' WHERE‡id IN($ids) ");

72 
ShowMsg
("æˆåŠŸæ¸…é™¤æ‰€æœ‰å†…å®¹!",
$ENV_GOBACK_URL
);

73 
ex™
();

78 if(
	g$dİo¡
=="clearall")

80 
CheckPurv›w
('co_Del');

81 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__co_htmls` ");

82 
ShowMsg
("æˆåŠŸæ¸…ç©ºæ‰€æœ‰é‡‡é›†çš„ä¸´æ—¶å†…å®¹!","co_main.php");

83 
ex™
();

89 if(
	g$dİo¡
=="replace")

93 
$½¡ršg
 = 
Œim
($rpstring);

94 if(
	g$»gty³
=='string')

96 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_htmls` SET `result`=REPLACE(`result`,'$fdstring','$rpstring') WHERE‚id='$nid' ");

101 if(
em±y
(
$½ok
))

103 
	g$fd¡ršg
 = 
¡r¦ashes
(
$fd¡ršg
);

104 
	g$½¡ršg
 = 
¡r¦ashes
(
$½¡ršg
);

105 
	g$hidd’½v®ue
 = "<textarea‚ame='fdstring' style='display:none'>{$fdstring}</textarea>\r\n<textarea‚ame='rpstring' style='display:none'>{$rpstring}</textarea>\r\n";

106 
	g$fd¡ršg
 = 
¡r_»¶aû
("\\/","#ASZZ#",
$fd¡ršg
);

107 
	g$fd¡ršg
 = 
¡r_»¶aû
('/',"\\/",
$fd¡ršg
);

108 
	g$fd¡ršg
 = 
¡r_»¶aû
('#ASZZ#',"\\/",
$fd¡ršg
);

109 
	g$»suÉ
 = 
$rs
 = 
¡r¦ashes
($rs);

110 if(
	g$fd¡ršg
!='')

112 
$»suÉ
 = 
Œim
(
´eg_»¶aû
("/$fd¡ršg/isU",
$½¡ršg
,
$rs
));

114 
	g$wšt™Ë
 = "é‡‡é›†ç®¡ç†-å†…å®¹æ›¿æ¢";

115 
	g$wecome_šfo
 = "<a href='co_main.php'>é‡‡é›†ç®¡ç†</a>::å†…å®¹æ›¿æ¢";

116 
	g$wš
 = 
Ãw
 
OxWšdow
();

117 
	g$wš
->
In™
("co_do.php","js/blank.js","POST");

118 
	g$wš
->
AddHidd’
('dİo¡',
$dİo¡
);

119 
	g$wš
->
AddHidd’
('nid',
$nid
);

120 
	g$wš
->
AddHidd’
('regtype','regex');

121 
	g$wš
->
AddHidd’
('aid',
$aid
);

122 
	g$wš
->
AddHidd’
('rpok','ok');

123 
	g$wš
->
AddT™Ë
("å†…å®¹æ›¿æ¢æ“ä½œç¡®è®¤ï¼šå¦‚æœä¸‹é¢ç»“æœæ­£ç¡®ï¼Œç‚¹å‡»ç¡®è®¤ï¼Œç³»ç»Ÿå°†æ›¿æ¢å½“å‰èŠ‚ç‚¹æ‰€æœ‰å†…å®¹ï¼{$hiddenrpvalue}");

124 
	g$wš
->
AddI‹m
("åŸæ¥çš„å†…å®¹ï¼š","<textarea‚ame='rs' style='width:90%;height:250px'>{$rs}</textarea>\r\n");

125 
	g$wš
->
AddI‹m
("æŒ‰è§„åˆ™æ›¿æ¢åçš„å†…å®¹ï¼š","<textarea‚ame='okrs' style='width:90%;height:250px'>{$result}</textarea>\r\n");

126 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

127 
	g$wš
->
Di¥Ïy
();

128 
ex™
();

132 if(
	g$fd¡ršg
!='')

134 
$dsql
->
S‘Qu”y
("SELECT `aid`,`result` FROM `#@__co_htmls` WHERE‚id='$nid' ");

135 
	g$dsql
->
Execu‹
();

136 
	g$row
 = 
$dsql
->
G‘A¼ay
())

138 
$fd¡ršg
 = 
¡r¦ashes
($fdstring);

139 
	g$½¡ršg
 = 
¡r¦ashes
(
$½¡ršg
);

140 
	g$fd¡ršg
 = 
¡r_»¶aû
("\\/","#ASZZ#",
$fd¡ršg
);

141 
	g$fd¡ršg
 = 
¡r_»¶aû
('/',"\\/",
$fd¡ršg
);

142 
	g$fd¡ršg
 = 
¡r_»¶aû
('#ASZZ#',"\\/",
$fd¡ršg
);

143 
	g$»suÉ
 = 
Œim
(
´eg_»¶aû
("/$fd¡ršg/isU",
$½¡ršg
,
$row
['result']));

144 
	g$»suÉ
 = 
add¦ashes
(
$»suÉ
);

145 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_htmls` SET `result`='$result' WHERE‡id='{$row['aid']}' ");

150 
ShowMsg
("æˆåŠŸæ›¿æ¢å½“å‰èŠ‚ç‚¹æ‰€æœ‰æ•°æ®ï¼","co_view.php?aid=$aid");

151 
ex™
();

157 if(
	g$dİo¡
=="copy")

159 
CheckPurv›w
('co_AddNote');

160 if(
em±y
(
$mynÙ’ame
))

162 
	g$wšt™Ë
 = "é‡‡é›†ç®¡ç†-å¤åˆ¶èŠ‚ç‚¹";

163 
	g$wecome_šfo
 = "<a href='co_main.php'>é‡‡é›†ç®¡ç†</a>::å¤åˆ¶èŠ‚ç‚¹";

164 
	g$wš
 = 
Ãw
 
OxWšdow
();

165 
	g$wš
->
In™
("co_do.php","js/blank.js","POST");

166 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

167 
	g$wš
->
AddHidd’
("nid",
$nid
);

168 
	g$wš
->
AddT™Ë
("è¯·è¾“å…¥æ–°èŠ‚ç‚¹åç§°ï¼š");

169 
	g$wš
->
AddI‹m
("æ–°èŠ‚ç‚¹åç§°ï¼š","<inputype='text'‚ame='mynotename' value='' size='30' />");

170 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

171 
	g$wš
->
Di¥Ïy
();

172 
ex™
();

174 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__co_note` WHERE‚id='$nid'");

175 
fÜ—ch
(
$row
 
as
 
$k
=>
$v
)

177 if(!
is£t
(
$$k
))

179 
$$k
 = 
add¦ashes
(
$v
);

182 
	g$u£mÜe
 = (
em±y
(
$u£mÜe
) ? '0' : $usemore);

183 
	g$šQu”y
 = " INSERT INTO `#@__co_note`(`channelid`,`notename`,`sourcelang`,`uptime`,`cotime`,`pnum`,`isok`,`listconfig`,`itemconfig`,`usemore`)

184 
VALUES
 ('$channelid','$mynotename','$sourcelang','".time()."','0','0','0','$listconfig','$itemconfig','$usemore'); ";

185 
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
);

186 
ShowMsg
("æˆåŠŸå¤åˆ¶ä¸€ä¸ªèŠ‚ç‚¹!",
$ENV_GOBACK_URL
);

187 
ex™
();

193 if(
	g$dİo¡
=="testrss")

195 
CheckPurv›w
('co_AddNote');

196 
	g$msg
 = '';

197 if(
	g$rssu¾
=='')

199 
$msg
 = 'ä½ æ²¡æœ‰æŒ‡å®šRSSåœ°å€ï¼';

203 
šşude
(
XAKINC
."/xakcollection.func.php");

204 
	g$¬r
 = 
G‘RssLšks
(
$rssu¾
);

205 
	g$msg
 = "ä» {$rssurl} å‘ç°çš„ç½‘å€ï¼š<br />";

206 
	g$i
=1;

207 if(
is_¬¿y
(
$¬r
))

209 
fÜ—ch
(
$¬r
 
as
 
$¬
)

211 
	g$msg
 .= "<hr size='1' />\r\n";

212 
	g$msg
 .= "link: {$ar['link']}<br />title: {$ar['title']}<br />image: {$ar['image']}\r\n";

213 
	g$i
++;

217 
	g$wšt™Ë
 = "é‡‡é›†ç®¡ç†-æµ‹è¯•";

218 
	g$wecome_šfo
 = "<a href='co_main.php'>é‡‡é›†ç®¡ç†</a>::RSSåœ°å€æµ‹è¯•";

219 
	g$wš
 = 
Ãw
 
OxWšdow
();

220 
	g$wš
->
AddMsgI‹m
(
$msg
);

221 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hand");

222 
	g$wš
->
Di¥Ïy
();

223 
ex™
();

229 if(
	g$dİo¡
=="testregx")

231 
CheckPurv›w
('co_AddNote');

232 
	g$msg
 = '';

233 if(
	g$»gxu¾
=='')

235 
$msg
 = 'ä½ æ²¡æœ‰æŒ‡å®šåŒ¹é…çš„ç½‘å€ï¼';

239 
šşude
(
XAKINC
."/xakcollection.func.php");

240 
	g$msg
 = "åŒ¹é…çš„ç½‘å€ï¼š<br />";

241 
	g$li¡s
 = 
G‘U¾FromLi¡RuË
(
$»gxu¾
, '', 
$¡¬tid
, 
$’did
, 
$addv
);

242 
fÜ—ch
(
$li¡s
 
as
 
$su¾
)

244 
	g$msg
 .ğ
$su¾
[0]."<br />\r\n";

247 
	g$wšt™Ë
 = "é‡‡é›†ç®¡ç†-æµ‹è¯•åŒ¹é…è§„åˆ™";

248 
	g$wecome_šfo
 = "<a href='co_main.php'>é‡‡é›†ç®¡ç†</a>::æµ‹è¯•åŒ¹é…åˆ—è¡¨ç½‘å€è§„åˆ™";

249 
	g$wš
 = 
Ãw
 
OxWšdow
();

250 
	g$wš
->
AddMsgI‹m
(
$msg
);

251 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hand");

252 
	g$wš
->
Di¥Ïy
();

253 
ex™
();

260 if(
	g$dİo¡
=="coall")

262 
CheckPurv›w
('co_PlayNote');

263 
	g$mrow
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__co_htmls` ");

264 
	g$tÙ®num
 = 
$mrow
['dd'];

265 if(
	g$tÙ®num
==0)

267 
ShowMsg
("æ²¡å‘ç°å¯ä¸‹è½½çš„å†…å®¹ï¼","-1");

268 
ex™
();

270 
	g$wšt™Ë
 = "é‡‡é›†ç®¡ç†-é‡‡é›†æœªä¸‹è½½å†…å®¹";

271 
	g$wecome_šfo
 = "<a href='co_main.php'>é‡‡é›†ç®¡ç†</a>::é‡‡é›†æœªä¸‹è½½å†…å®¹";

272 
	g$wš
 = 
Ãw
 
OxWšdow
();

273 
	g$wš
->
In™
("co_gather_start_action.php","js/blank.js","GET");

274 
	g$wš
->
AddHidd’
('startdd','0');

275 
	g$wš
->
AddHidd’
('pagesize','5');

276 
	g$wš
->
AddHidd’
('sptime','0');

277 
	g$wš
->
AddHidd’
('nid','0');

278 
	g$wš
->
AddHidd’
('tÙ®num',
$tÙ®num
);

279 
	g$wš
->
AddMsgI‹m
("æœ¬æ“ä½œä¼šæ£€æµ‹å¹¶ä¸‹è½½â€˜<a href='co_url.php'><u>ä¸´æ—¶å†…å®¹</u></a>â€™ä¸­æ‰€æœ‰æœªä¸‹è½½çš„å†…å®¹ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ");

280 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

281 
	g$wš
->
Di¥Ïy
();

282 
ex™
();

	@E:\web\weixun\xakadmin\co_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('co_EditNote');

9 
»quœe_Úû
(
XAKINC
.'/xaktag.class.php');

10 
	g$nid
 = (
is£t
(
$nid
è? 
	$štv®
(
$nid
) : '');

11 if(
$nid
=='')

13 
	`ShowMsg
('å‚æ•°æ— æ•ˆ!','-1');

14 
	`ex™
();

15 
	}
}

16 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

21 if(
	g$dİo¡
=='§ve' || 
$dİo¡
=='saveandtest')

23 
$u£mÜe
 = (!
is£t
($usemore) ? 0 : 1);

24 
	g$li¡cÚfig
 = "{xak:noteinfo‚otename=\\\"$notename\\\" channelid=\\\"$channelid\\\" macthtype=\\\"$macthtype\\\"

25 
»fu¾
=\\\"$refurl\\\" sourcelang=\\\"$sourcelang\\\" cosort=\\\"$cosort\\\"

26 
i¤ef
=\\\"$isref\\\"ƒxptime=\\\"$exptime\\\" usemore=\\\"$usemore\\\" /}

27 {
xak
:
li¡ruË
 
sourûty³
=\\\"$sourcetype\\\"„ssurl=\\\"$rssurl\\\"„egxurl=\\\"$regxurl\\\"

28 
¡¬tid
=\\\"$startid\\\"ƒndid=\\\"$endid\\\"‡ddv=\\\"$addv\\\" urlrule=\\\"$urlrule\\\" musthas=\\\"$musthas\\\"

29 
nÙhas
=\\\"$nothas\\\"†istpic=\\\"$listpic\\\" usemore=\\\"$usemore\\\"}

30 {
xak
:
addu¾s
}
$addu¾s
{/xak:addurls}

31 {
xak
:
b©chruË
}
$b©chruË
{/xak:batchrule}

32 {
xak
:
»gxruË
}
$»gxruË
{/xak:regxrule}

33 {
xak
:
¬—¡¬t
}
$¬—¡¬t
{/xak:areastart}

34 {
xak
:
¬—’d
}
$¬—’d
{/xak:areaend}

35 {/
xak
:
li¡ruË
}\
r
\
n
";

36 
$™emcÚfig
 = "{xak:sppage sptype=\\'$sptype\\' srul=\\'$srul\\'ƒrul=\\'$erul\\'}$sppage{/xak:sppage}\r\n";

37 
	g$™emcÚfig
 .= "{xak:previewurl}$previewurl{/xak:previewurl}\r\n";

38 
	g$™emcÚfig
 .= "{xak:keywordtrim}$keywordtrim{/xak:keywordtrim}\r\n";

39 
	g$™emcÚfig
 .= "{xak:descriptiontrim}$descriptiontrim{/xak:descriptiontrim}\r\n";

40 
	g$fs
 = 
ex¶ode
(',','value,match,isunit,isdown,trim,function');

41 
fÜ—ch
(
$f›lds
 
as
 
$f›ld
)

43 
fÜ—ch
(
$fs
 
as
 
$f
)

45 
	g$GLOBALS
[
$f
.'_'.
$f›ld
] = (!
is£t
(
$GLOBALS
[$f.'_'.$field]) ? '' : $GLOBALS[$f.'_'.$field]);

47 
	g$m©ch¡r
 = 
$GLOBALS
["m©ch_".
$f›ld
];

48 
	g$Œim¡r
 = 
$GLOBALS
["Œim_".
$f›ld
];

49 
	g$Œim¡r
 = 
Œim
(
¡r_»¶aû
('&nb¥;', '#n#', 
$Œim¡r
));

50 
	g$m©ch¡r
 = 
Œim
(
¡r_»¶aû
('&nb¥;', '#n#', 
$m©ch¡r
));

51 if(
	g$Œim¡r
!='' && !
´eg_m©ch
("#{xak:Œim#isU", 
$Œim¡r
))

53 
	g$Œim¡r
 = " {xak:trim}$trimstr{/xak:trim}\r\n";

55 
	g$™emcÚfig
 .ğ"{xak:™em f›ld=\\'".
$f›ld
."\\' v®ue=\\'".
$GLOBALS
["value_".$field]."\\' isunit=\\'".$GLOBALS["isunit_".$field]."\\' isdown=\\'".$GLOBALS["isdown_".$field]."\\'}

56 {
xak
:
m©ch
}".$matchstr."{/xak:match}

57 
$Œim¡r


58 {
xak
:
funùiÚ
}".$GLOBALS["
funùiÚ_
".$field]."{/xak:function}

59 {/
xak
:
™em
}";

62 
$u±ime
 = 
time
();

63 if(
em±y
(
$äeq
)è
	g$äeq
 = 1;

64 if(
em±y
(
$exty³id
)è
	g$exty³id
 = 0;

65 if(
em±y
(
$i¦i¡’
)è
	g$i¦i¡’
 = 0;

67 
	g$qu”y
 = " UPDATE `#@__co_note` SET

68 `
chªÃlid
`='$channelid',

69 `
	gnÙ’ame
`='$notename',

70 `
	gsourûÏng
`='$sourcelang',

71 `
	gu±ime
`='$uptime',

72 `
	gisok
`='1',

73 `
	gu£mÜe
`='$usemore',

74 `
	gli¡cÚfig
`='$listconfig',

75 `
	g™emcÚfig
`='$itemconfig'

76 
WHERE
 
nid
='$nid'; ";

77 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

78 
echo
 
	g$dsql
->
G‘E¼Ü
();

79 if(
	g$dÚext
=='save')

81 
ShowMsg
("æˆåŠŸä¿å­˜é…ç½®ï¼","co_main.php");

85 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/co_test_rule.php");

87 
ex™
();

89 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__co_note` WHERE‚id='$nid'");

92 if(
Œim
(
$¬r
['itemconfig'])=='')

94 
$chªÃlid
 = 
$¬r
['channelid'];

95 
	g$nid
 = 
$¬r
['nid'];

96 if(!
is£t
(
$´ev›wu¾
)è
	g$´ev›wu¾
 = '';

98 
»quœe_Úû
(
XAKINC
.'/xaktag.class.php');

99 
»quœe_Úû
(
XAKADMIN
."/templets/co_add_step2.htm");

100 
ex™
();

102 
	g$u£mÜe
 = 
$¬r
['usemore'];

103 
	g$nÙ’ame
 = 
$¬r
['notename'];

104 
	g$nÙes
 = 
¬¿y
();

105 
	g$dsql
->
F»eResuÉ
();

106 
	g$d
 = 
Ãw
 
XakTagP¬£
();

107 
	g$d2
 = 
Ãw
 
XakTagP¬£
();

108 
	g$d
->
LßdSŒšg
(
$¬r
['listconfig'].$arr['itemconfig']);

109 
	g$chªÃlid
 = 
$¬r
['channelid'];

110 
	g$nÙes
['keywordtrim'] = '';

111 
	g$nÙes
['descriptiontrim'] = '';

112 
fÜ—ch
(
$d
->
CTags
 
as
 
$tid
 => 
$ùag
)

114 if(
$ùag
->
G‘Name
()=='item')

116 
$f
 = 
$ùag
->
G‘A‰
('field');

117 
	g$nÙes
[
$f
]['™em'] = 
$ùag
;

118 
	g$d2
->
LßdSŒšg
(
$ùag
->
G‘IÂ”Text
());

119 
	g$nÙes
[
$f
]['trim'] = '';

120 
fÜ—ch
(
$d2
->
CTags
 
as
 
$ùag2
)

122 if(
	g$ùag2
->
G‘Name
()=='trim')

124 
$nÙes
[
$f
]['Œim'] .ğ"{xak:Œim„•Ïû=\"".
$ùag2
->
G‘A‰
('»¶aû')."\"}".$ùag2->
G‘IÂ”Text
()."{/xak:trim}\r\n";

126 if(
	g$ùag2
->
G‘Name
()=='match')

128 
$nÙes
[
$f
]['m©ch'] = 
$ùag2
->
G‘IÂ”Text
()."\r\n";

130 if(
	g$ùag2
->
G‘Name
()=='function')

132 
$nÙes
[
$f
]['funùiÚ'] = 
$ùag2
->
G‘IÂ”Text
()."\r\n";

136 if(
	g$ùag
->
G‘Name
()=='keywordtrim')

138 
$nÙes
['keywÜdŒim'] = 
$ùag
->
G‘IÂ”Text
();

140 if(
	g$ùag
->
G‘Name
()=='descriptiontrim')

142 
$nÙes
['desütiÚŒim'] = 
$ùag
->
G‘IÂ”Text
();

144 if(
	g$ùag
->
G‘Name
()=='noteinfo')

146 
$nÙešfo
 = 
$ùag
;

148 if(
	g$ùag
->
G‘Name
()=='listrule')

150 
$li¡ruË
 = 
$ùag
;

151 
	g$d2
->
LßdSŒšg
(
$ùag
->
G‘IÂ”Text
());

152 
	g$addu¾s
 = 
$d2
->
G‘TagByName
('addurls');

153 
	g$»gxruË
 = 
$d2
->
G‘TagByName
('regxrule');

154 
	g$¬—¡¬t
 = 
$d2
->
G‘TagByName
('areastart');

155 
	g$¬—’d
 = 
$d2
->
G‘TagByName
('areaend');

156 
	g$b©chruË
 = 
$d2
->
G‘TagByName
('batchrule');

158 if(
	g$ùag
->
G‘Name
()=='sppage')

160 
$¥·ge
 = 
$ùag
;

162 if(
	g$ùag
->
G‘Name
()=='previewurl')

164 
$´ev›wu¾
 = 
Œim
(
$ùag
->
G‘IÂ”Text
());

167 if(!
is£t
(
$´ev›wu¾
)è
	g$´ev›wu¾
 = '';

168 
»quœe_Úû
(
XAKADMIN
.'/templets/co_edit.htm');

	@E:\web\weixun\xakadmin\co_edit_text.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('co_EditNote');

9 if(
em±y
(
$job
)è
	g$job
='';

11 if(
	g$job
=='')

13 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

14 
	g$wšt™Ë
 = "æ›´æ”¹é‡‡é›†è§„åˆ™";

15 
	g$wecome_šfo
 = "<a href='co_main.php'><u>é‡‡é›†ç‚¹ç®¡ç†</u></a>::æ›´æ”¹é‡‡é›†è§„åˆ™ - ä¸“å®¶æ›´æ”¹æ¨¡å¼";

16 
	g$wš
 = 
Ãw
 
OxWšdow
();

17 
	g$wš
->
In™
("co_edit_text.php", "js/blank.js", "POST");

18 
	g$wš
->
AddHidd’
("job", "yes");

19 
	g$wš
->
AddHidd’
("nid", 
$nid
);

20 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__co_note` WHERE‚id='$nid' ");

21 
	g$wš
->
AddT™Ë
("ç´¢å¼•ä¸åŸºæœ¬ä¿¡æ¯é…ç½®ï¼š");

22 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='listconfig' style='width:100%;height:200px'>{$row['listconfig']}</textarea>");

23 
	g$wš
->
AddT™Ë
("å­—æ®µé…ç½®ï¼š");

24 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='itemconfig' style='width:100%;height:300px'>{$row['itemconfig']}</textarea>");

25 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

26 
	g$wš
->
Di¥Ïy
();

27 
ex™
();

31 
CheckPurv›w
('co_EditNote');

32 
	g$qu”y
 = "UPDATE `#@__co_note` SET†istconfig='$listconfig',itemconfig='$itemconfig' WHERE‚id='$nid' ";

33 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

34 
ShowMsg
("æˆåŠŸä¿®æ”¹ä¸€ä¸ªè§„åˆ™!","co_main.php");

35 
ex™
();

	@E:\web\weixun\xakadmin\co_export.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('co_Export');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
	g$dİo¡
!='done')

13 
»quœe_Úû
(
XAKADMIN
."/inc/inc_catalog_options.php");

14 
	g$tÙ®cc
 = 
$chªÃlid
 = 
$u£mÜe
 = 0;

15 if(!
em±y
(
$nid
))

17 
	g$mrow
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__co_htmls` WHERE‚id='$nid' AND isdown='1' ");

18 
	g$tÙ®cc
 = 
$mrow
['dd'];

19 
	g$¼ow
 = 
$dsql
->
G‘OÃ
("SELECT channelid,usemore FROM `#@__co_note` WHERE‚id='$nid' ");

20 
	g$chªÃlid
 = 
$¼ow
['channelid'];

21 
	g$u£mÜe
 = 
$¼ow
['usemore'];

25 
	g$mrow
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__co_htmls` WHERE isdown='1' ");

26 
	g$tÙ®cc
 = 
$mrow
['dd'];

28 
šşude
 
XAKINClude
("templets/co_export.htm");

29 
ex™
();

33 
»quœe_Úû
(
XAKINC
.'/xakcollection.class.php');

34 
	g$chªÃlid
 = 
is£t
(
$chªÃlid
è&& 
is_num”ic
($channelid) ? $channelid : 0;

35 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

36 
	g$·g’o
 = 
is£t
(
$·g’o
è&& 
is_num”ic
($pageno) ? $pageno : 1;

37 
	g$¡¬tid
 = 
is£t
(
$¡¬tid
è&& 
is_num”ic
($startid) ? $startid : 0;

38 
	g$’did
 = 
is£t
(
$’did
è&& 
is_num”ic
($endid) ? $endid : 0;

40 if(!
is£t
(
$makehtml
)è
	g$makehtml
 = 0;

41 if(!
is£t
(
$Úlyt™Ë
)è
	g$Úlyt™Ë
 = 0;

42 if(!
is£t
(
$u£t™Ë
)è
	g$u£t™Ë
 = 0;

43 if(!
is£t
(
$autÙy³
)è
	g$autÙy³
 = 0;

45 
	g$co
 = 
Ãw
 
XakCŞËùiÚ
();

46 
	g$co
->
LßdNÙe
(
$nid
);

47 
	g$Üd”way
 = ((
$co
->
nÙeInfos
['cosort']=='desc' || $co->noteInfos['cosort']=='asc') ? $co->noteInfos['cosort'] : 'desc');

48 if(
	g$chªÃlid
==0 && 
$ty³id
==0)

50 
ShowMsg
('è¯·æŒ‡å®šé»˜è®¤å¯¼å‡ºæ ç›®æˆ–é¢‘é“IDï¼','javascript:;');

51 
ex™
();

53 if(
	g$chªÃlid
==0)

55 
$row
 = 
$dsql
->
G‘OÃ
("SELECT ch.* FROM `#@__arctype`p LEFT JOIN `#@__channeltype` ch ON ch.id=tp.channeltype WHEREp.id='$typeid'; ");

59 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$channelid'; ");

61 if(!
is_¬¿y
(
$row
))

63 
	gecho
 "æ‰¾ä¸åˆ°é¢‘é“å†…å®¹æ¨¡å‹ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œï¼";

64 
ex™
();

68 
	g$chªÃlid
 = 
$row
['id'];

69 
	g$mašbË
 = 
$row
['maintable'];

70 
	g$addbË
 = 
$row
['addtable'];

71 if(
em±y
(
$mašbË
)è
	g$mašbË
 = '#@__archives';

72 if(
em±y
(
$addbË
))

74 
	gecho
 "æ‰¾ä¸ä¸»è¡¨é…ç½®ä¿¡æ¯ï¼Œæ— æ³•å®Œæˆæ“ä½œï¼";

75 
ex™
();

77 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

80 
	g$šdexSqlTem¶©e
 = "INSERT INTO `#@__arctiny`(`arcrank`,`typeid`,`channel`,`senddate`,`sortrank`) VALUES ('$arcrank','@typeid@' ,'$channelid','@senddate@', '@sortrank@'); ";

83 
	g$mašSqlTem¶©e
 = "INSERT INTO `$maintable`(id,typeid,sortrank,flag,ismake,channel,arcrank,click,money,title,shorttitle,color,writer,source,litpic,pubdate,senddate,mid,description,keywords)

84 
VALUES
 ('@aid@','@typeid@','@sortrank@','@flag@','0','$channelid','$arcrank','0','0','@title@','','','@writer@','@source@','@litpic@','@pubdate@','@senddate@','$adminid','@description@','@keywords@'); ";

87 
	g$šadd_f
 = 
$šadd_v
 = '';

88 
	g$d
 = 
Ãw
 
XakTagP¬£
();

89 
	g$d
->
S‘NameS·û
('field','<','>');

90 
	g$d
->
LßdSŒšg
(
$row
['fieldset']);

91 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

93 
	g$Šame
 = 
$ùag
->
G‘TagName
();

94 
	g$šadd_f
 .= ",`$tname`";

95 
	g$nÙ£nd
 = 
$ùag
->
G‘A‰
('notsend');

96 
	g$f›ldty³
 = 
$ùag
->
G‘A‰
('type');

97 if(
	g$nÙ£nd
==1)

100 if(
$ùag
->
G‘A‰
('default')!='')

102 
$dfv®ue
 = 
$ùag
->
G‘A‰
('default');

104 if(
	g$f›ldty³
=='št' || 
$f›ldty³
=='float' || $fieldtype=='number')

106 
$dfv®ue
 = '0';

108 if(
	g$f›ldty³
=='dtime')

110 
$dfv®ue
 = 
time
();

114 
	g$dfv®ue
 = '';

116 
	g$šadd_v
 .= ",'$dfvalue'";

120 
	g$šadd_v
 .= ",'@$tname@'";

123 
	g$addSqlTem¶©e
 = "INSERT INTO `{$addtable}`(`aid`,`typeid`{$inadd_f}) Values('@aid@','@typeid@'{$inadd_v})";

126 
	g$d
 = 
Ãw
 
XakTagP¬£
();

127 
	g$tÙ®·ge
 = 
$tÙ®cc
 / 
$·gesize
;

128 
	g$¡¬tdd
 = (
$·g’o
-1è* 
$·gesize
;

129 if(!
em±y
(
$nid
))

131 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__co_htmls` WHERE‚id='$nid' AND isdown='1' ORDER BY‡id $orderway LIMIT $startdd,$pagesize");

135 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__co_htmls` WHERE isdown='1' ORDER BY‡id $orderway LIMIT $startdd,$pagesize");

137 
	g$dsql
->
Execu‹
();

138 
	g$row
 = 
$dsql
->
G‘Objeù
())

140 if(
Œim
(
$row
->
»suÉ
=='')) ;

143 
	g$Áy³id
 = (
$autÙy³
==1 && 
$row
->
ty³id
 !ğ0è? $row->ty³id : 
$ty³id
;

144 
	g$šdexSql
 = 
¡r_»¶aû
('@ty³id@', 
$Áy³id
, 
$šdexSqlTem¶©e
);

145 
	g$mašSql
 = 
¡r_»¶aû
('@ty³id@', 
$Áy³id
, 
$mašSqlTem¶©e
);

146 
	g$addSql
 = 
¡r_»¶aû
('@ty³id@', 
$Áy³id
, 
$addSqlTem¶©e
);

147 
	g$d
->
LßdSŒšg
(
$row
->
»suÉ
);

148 
	g$exid
 = 
$row
->
aid
;

149 if(!
is_¬¿y
(
$d
->
CTags
)) ;

152 
	g$pubd©e
 = 
$sÜŒªk
 = 
time
();

153 
	g$t™Ë
 = 
$row
->
t™Ë
;

154 
	g$l™pic
 = '';

155 
fÜ—ch
 (
$d
->
CTags
 
as
 
$ùag
)

157 
	g$™emName
 = 
$ùag
->
G‘A‰
('name');

158 if(
	g$™emName
 =ğ't™Ë' && 
$u£t™Ë
==0)

160 
$t™Ë
 = 
Œim
(
$ùag
->
G‘IÂ”Text
());

161 if(
	g$t™Ë
=='')

163 
$t™Ë
 = 
$row
->
t™Ë
;

166 if(
	g$™emName
 == 'pubdate')

168 
$pubd©e
 = 
Œim
(
$ùag
->
G‘IÂ”Text
());

169 if(
´eg_m©ch
("#[^0-9]#", 
$pubd©e
))

171 
	g$pubd©e
 = 
$sÜŒªk
 = 
G‘MkTime
(
$pubd©e
);

175 
	g$pubd©e
 = 
$sÜŒªk
 = 
time
();

178 if(
	g$™emName
 == 'litpic')

180 
$l™pic
 = 
Œim
(
$ùag
->
G‘IÂ”Text
());

185 
	g$t™Ë
 = 
add¦ashes
(
$t™Ë
);

186 if(
	g$Úlyt™Ë
)

188 
	g$‹¡row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(ID) AS dd FROM `$maintable` WHEREitle LIKE '$title'");

189 if(
	g$‹¡row
['dd']>0)

191 
	gecho
 "æ•°æ®åº“å·²å­˜åœ¨æ ‡é¢˜ä¸º: {$title} çš„æ–‡æ¡£ï¼Œç¨‹åºé˜»æ­¢äº†æ­¤æœ¬æ¡å†…å®¹å¯¼å…¥<br />\r\n";

197 
	g$£ndd©e
 = 
time
();

198 
	g$æag
 = '';

199 if(
	g$l™pic
!=''è
$æag
 = 'p';

202 if(
	g$¿ndcc
>0)

204 
	g$ræag
 = 
mt_¿nd
(1, 
$¿ndcc
);

205 if(
	g$ræag
==
$¿ndcc
)

207 
$æag
 = ($flag=='' ? 'c' : $flag.',c');

210 
	g$šdexSql
 = 
¡r_»¶aû
('@£ndd©e@', 
$£ndd©e
, 
$šdexSql
);

211 
	g$šdexSql
 = 
¡r_»¶aû
('@sÜŒªk@', 
$sÜŒªk
, 
$šdexSql
);

212 
	g$mašSql
 = 
¡r_»¶aû
('@æag@', 
$æag
, 
$mašSql
);

213 
	g$mašSql
 = 
¡r_»¶aû
('@sÜŒªk@', 
$sÜŒªk
, 
$mašSql
);

214 
	g$mašSql
 = 
¡r_»¶aû
('@pubd©e@', 
$pubd©e
, 
$mašSql
);

215 
	g$mašSql
 = 
¡r_»¶aû
('@£ndd©e@', 
$£ndd©e
, 
$mašSql
);

216 
	g$mašSql
 = 
¡r_»¶aû
('@t™Ë@', 
ú_sub¡r
(
$t™Ë
, 60), 
$mašSql
);

217 
	g$addSql
 = 
¡r_»¶aû
('@sÜŒªk@', 
$sÜŒªk
, 
$addSql
);

218 
	g$addSql
 = 
¡r_»¶aû
('@£ndd©e@', 
$£ndd©e
, 
$addSql
);

221 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

223 if(
	g$ùag
->
G‘Name
()!='field')

227 
	g$™emÇme
 = 
$ùag
->
G‘A‰
('name');

228 
	g$™emv®ue
 = 
add¦ashes
(
Œim
(
$ùag
->
G‘IÂ”Text
()));

229 
	g$mašSql
 = 
¡r_»¶aû
("@$™emÇme@", 
$™emv®ue
, 
$mašSql
);

230 
	g$addSql
 = 
¡r_»¶aû
("@$™emÇme@", 
$™emv®ue
, 
$addSql
);

234 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šdexSql
);

235 if(
	g$rs
)

237 
	g$aid
 = 
$dsql
->
G‘La¡ID
();

238 
	g$mašSql
 = 
¡r_»¶aû
('@aid@', 
$aid
, 
$mašSql
);

239 
	g$addSql
 = 
¡r_»¶aû
('@aid@', 
$aid
, 
$addSql
);

240 
	g$mašSql
 = 
´eg_»¶aû
("#@([a-z0-9]{1,})@#", '', 
$mašSql
);

241 
	g$addSql
 = 
´eg_»¶aû
("#@([a-z0-9]{1,})@#", '', 
$addSql
);

242 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$mašSql
);

243 if(!
	g$rs
)

245 
	gecho
 "å¯¼å…¥ '$t™Ë' æ—¶é”™è¯¯ï¼š".
	g$dsql
->
G‘E¼Ü
()."<br />";

246 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$aid' ");

250 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$addSql
);

251 if(!
	g$rs
)

253 
	gecho
 "å¯¼å…¥ '$t™Ë' æ—¶é”™è¯¯ï¼š".
	g$dsql
->
G‘E¼Ü
()."<br />";

254 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHERE id='$aid' ");

255 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `$maintable` WHERE id='$aid' ");

259 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_htmls` SET isexport=1 WHERE‡id='$exid' ");

263 if(
	g$tÙ®·ge
 <ğ
$·g’o
)

265 if(
$chªÃlid
>0 && 
$makehtml
==1)

267 ifĞ
$autÙy³
==0 && !
em±y
(
$nid
) )

269 
$mhtml
 = "makehtml_archives_action.php?typeid=$typeid&startid=$startid&endid=$endid&pagesize=20";

270 
ShowMsg
("å®Œæˆæ•°æ®å¯¼å…¥ï¼Œå‡†å¤‡ç”Ÿæˆæ–‡æ¡£HTML...",
$mhtml
);

271 
ex™
();

275 
ShowMsg
("å®Œæˆæ‰€æœ‰æ•°æ®å¯¼å…¥ï¼Œè¯·æ‰‹å·¥æ›´æ–°HTMLï¼","javascript:;");

276 
ex™
();

281 
ShowMsg
("å®Œæˆæ‰€æœ‰æ•°æ®å¯¼å…¥ï¼","javascript:;");

282 
ex™
();

287 if(
	g$tÙ®·ge
>0)

289 
	g$rs
 = 
sub¡r
((
$·g’o
 / 
$tÙ®·ge
 * 100), 0, 2);

293 
	g$rs
 = 100;

295 
	g$·g’o
++;

296 
	g$gou¾
 = "co_export.php?dopost=done&nid=$nid&totalcc=$totalcc&channelid=$channelid&pageno=$pageno";

297 
	g$gou¾
 .= "&nid=$nid&typeid=$typeid&autotype=$autotype&arcrank=$arcrank&pagesize=$pagesize&randcc=$randcc";

298 
	g$gou¾
 .= "&startid=$startid&endid=$endid&onlytitle=$onlytitle&usetitle=$usetitle&makehtml=$makehtml";

299 
ShowMsg
("å®Œæˆ {$rs}% å¯¼å…¥ï¼Œç»§ç»­æ‰§è¡Œæ“ä½œ...",
$gou¾
,'',500);

300 
ex™
();

	@E:\web\weixun\xakadmin\co_export_corule.php

1 <?
php


8 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

9 
CheckPurv›w
('co_EditNote');

10 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

11 
	g$nid
 = 
”eg_»¶aû
('[^0-9]','',
$nid
);

12 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * From `#@__co_note` where‚id='$nid'");

13 
	g$nÙecÚfig
 = "{xak:li¡cÚfig}\r\n".
$row
['listconfig']."\r\n{/xak:listconfig}\r\n\r\n";

14 
	g$nÙecÚfig
 .ğ"{xak:™emcÚfig}\r\n".
$row
['itemconfig']."\r\n{/xak:itemconfig}";

15 if(
em±y
(
$exty³
è|| 
	g$exty³
=='base64')

17 
$nÙecÚfig
 = "BASE64:".
ba£64_’code
($noteconfig).":END";

18 
	g$exmsg
 = " &nbsp; <a href='co_export_corule.php?nid={$nid}&extype=text'>ã€å¯¼å‡ºä¸ºæ™®é€šæ ¼å¼ã€‘</a> ";

22 
	g$exmsg
 = " &nbsp; <a href='co_export_corule.php?nid={$nid}&extype=base64'>ã€å¯¼å‡ºä¸ºBase64æ ¼å¼ã€‘</a> ";

24 
	g$wšt™Ë
 = "å¯¼å‡ºé‡‡é›†è§„åˆ™";

25 
	g$wecome_šfo
 = "<a href='co_main.php'><u>é‡‡é›†èŠ‚ç‚¹ç®¡ç†</u></a>::å¯¼å‡ºé‡‡é›†è§„åˆ™ $exmsg";

26 
	g$wš
 = 
Ãw
 
OxWšdow
();

27 
	g$wš
->
In™
();

28 
	g$wš
->
AddT™Ë
("ä»¥ä¸‹ä¸ºè§„åˆ™ [{$row['notename']}] çš„æ–‡æœ¬é…ç½®ï¼Œä½ å¯ä»¥å…±äº«ç»™ä½ çš„æœ‹å‹ï¼š");

29 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","<‹x»¨Çme='cÚfig' styË='width:100%;height:450px;wÜd-w¿p: b»ak-wÜd;wÜd-b»ak:b»ak-®l;'>".
$nÙecÚfig
."</textarea>");

30 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\co_gather_start.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/xakcollection.class.php");

9 if(!
	$em±y
(
$nid
))

11 
$Á™Ë
 = 'é‡‡é›†æŒ‡å®šèŠ‚ç‚¹ï¼š';

12 
$nid
 = 
	`štv®
($nid);

13 
$co
 = 
Ãw
 
	`XakCŞËùiÚ
();

14 
$co
->
	`LßdNÙe
(
$nid
);

15 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT COUNT(aid) AS dd FROM `#@__co_htmls` WHERE‚id='$nid'; ");

16 if(
$row
['dd']==0)

18 
$unum
 = "æ²¡æœ‰è®°å½•æˆ–ä»æ¥æ²¡æœ‰é‡‡é›†è¿‡è¿™ä¸ªèŠ‚ç‚¹ï¼";

22 
$unum
 = "å…±æœ‰ {$row['dd']} ä¸ªå†å²ç§å­ç½‘å€ï¼<a href='javascript:SubmitNew();'>[<u>æ›´æ–°ç§å­ç½‘å€ï¼Œå¹¶é‡‡é›†</u>]</a>";

24 
	}
} {

25 
	g$nid
 = "";

26 
	g$row
['dd'] = "";

27 
	g$Á™Ë
 = 'ç›‘æ§å¼é‡‡é›†ï¼š';

28 
	g$unum
 = "æ²¡æŒ‡å®šé‡‡é›†èŠ‚ç‚¹ï¼Œå°†ä½¿ç”¨æ£€æµ‹æ–°å†…å®¹é‡‡é›†æ¨¡å¼ï¼";

30 
šşude
 
XAKINClude
('templets/co_gather_start.htm');

	@E:\web\weixun\xakadmin\co_gather_start_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('co_PlayNote');

9 
»quœe_Úû
(
XAKINC
.'/xakcollection.class.php');

10 if(
	g$tÙ®num
==0)

12 
ShowMsg
('è·å–åˆ°çš„ç½‘å€ä¸ºé›¶ï¼šå¯èƒ½æ˜¯è§„åˆ™ä¸å¯¹æˆ–æ²¡å‘ç°æ–°å†…å®¹ï¼','javascript:;');

13 
ex™
();

15 if(!
is£t
(
$Şd¡¬t
)è
	g$Şd¡¬t
 = 
$¡¬tdd
;

16 if(
em±y
(
$nÙckpic
)è
	g$nÙckpic
 = 0;

18 if(
	g$tÙ®num
 > 
	g$¡¬tdd
+
	g$·gesize
è
	g$lim™Sql
 = " LIMIT $startdd,$pagesize ";

19 
	g$lim™Sql
 = " LIMIT $¡¬tdd,".(
$tÙ®num
 - 
$¡¬tdd
);

21 if(
	g$tÙ®num
 - 
	g$¡¬tdd
 < 1)

23 if(
em±y
(
$nid
))

25 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_nÙe` SET cÙime='".
time
()."'; ");

29 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_nÙe` SET cÙime='".
time
()."' WHERE‚id='$nid'; ");

31 
ShowMsg
('å®Œæˆå½“å‰ä¸‹è½½ä»»åŠ¡ï¼','javascript:;');

32 
ex™
();

35 
	g$co
 = 
Ãw
 
XakCŞËùiÚ
();

36 if(!
em±y
(
$nid
)è
	g$co
->
LßdNÙe
($nid);

39 if(!
	$em±y
(
$nid
))

41 
$dsql
->
	`S‘Qu”y
("SELECT‡id,nid,url,isdown,litpic FROM `#@__co_htmls` WHERE‚id=$nid $limitSql ");

42 
	}
}

45 
	g$dsql
->
S‘Qu”y
("SELECT‡id,nid,url,isdown,litpic FROM `#@__co_htmls` $limitSql ");

47 
	g$dsql
->
Execu‹
(99);

48 
	g$tjnum
 = 
$¡¬tdd
;

49 
	g$row
 = 
$dsql
->
	$G‘Objeù
(99))

51 if(
$row
->
isdown
==0)

53 if(
	`em±y
(
$nid
)è
$co
->
	`LßdNÙe
(
$row
->
nid
);

54 
$co
->
	`DownU¾
(
$row
->
aid
,$row->
u¾
,$row->
l™pic
);

56 
$tjnum
++;

57 if(
$¥time
>0è
	`¦“p
($sptime);

58 
	}
}

59 if(
	g$tÙ®num
-
	g$Şd¡¬t
!=0)

61 
$tjËn
 = 
û
Ğ((
$tjnum
-
$Şd¡¬t
)/(
$tÙ®num
-$oldstart)) * 100 );

62 
	g$dvËn
 = 
$tjËn
 * 2;

63 
	g$tj¡a
 = "<div style='width:200;height:15;border:1px solid #898989;text-align:left'><div style='width:$dvlen;height:15;background-color:#829D83'></div></div>";

64 
	g$tj¡a
 .= "<br/>å®Œæˆå½“å‰ä»»åŠ¡çš„ï¼š$tjlen %ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡...";

66 if(
	g$tjnum
 < 
	g$tÙ®num
)

68 
ShowMsg
(
$tj¡a
, "co_g©h”_¡¬t_aùiÚ.php?nÙckpic=$nÙckpic&¥time=$¥time&nid=$nid&Şd¡¬t=$Şd¡¬t&tÙ®num=$tÙ®num&¡¬tdd=".(
$¡¬tdd
+
$·gesize
)."&pagesize=$pagesize","",0);

69 
ex™
();

73 if(
em±y
(
$nid
))

75 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_nÙe` SET cÙime='".
time
()."'; ");

79 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_nÙe` SET cÙime='".
time
()."' WHERE‚id='$nid'; ");

81 
ShowMsg
("å®Œæˆå½“å‰ä¸‹è½½ä»»åŠ¡ï¼","javascript:;");

82 
ex™
();

	@E:\web\weixun\xakadmin\co_get_corule.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('co_AddNote');

9 if(
	$em±y
(
$job
))

11 
$job
='';

12 
	}
}

13 if(
	g$job
=='')

15 
»quœe_Úû
(
XAKINC
."/../functions/oxwindow.class.php");

16 
	g$wšt™Ë
 = "å¯¼å…¥é‡‡é›†è§„åˆ™";

17 
	g$wecome_šfo
 = "<a href='co_main.php'><u>é‡‡é›†ç‚¹ç®¡ç†</u></a>::å¯¼å…¥é‡‡é›†è§„åˆ™";

18 
	g$wš
 = 
Ãw
 
OxWšdow
();

19 
	g$wš
->
In™
("co_get_corule.php","js/blank.js","POST");

20 
	g$wš
->
AddHidd’
("job","yes");

21 
	g$wš
->
AddT™Ë
("è¯·åœ¨ä¸‹é¢è¾“å…¥ä½ è¦å¯¼å…¥çš„æ–‡æœ¬é…ç½®ï¼š(å»ºè®®ç”¨base64ç¼–ç [æ”¯æŒä¸ç¼–ç çš„è§„åˆ™ï¼Œä½†ä¸å…¼å®¹æ—§ç‰ˆè§„åˆ™])");

22 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='notes' style='width:100%;height:300px'></textarea>");

23 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

24 
	g$wš
->
Di¥Ïy
();

25 
ex™
();

29 
CheckPurv›w
('co_AddNote');

30 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

31 
	g$nÙes
 = 
Œim
(
$nÙes
);

34 if(
”eg
('^BASE64:',
$nÙes
))

36 if(!
”eg
(':END$',
$nÙes
))

38 
ShowMsg
('è¯¥è§„åˆ™ä¸åˆæ³•ï¼ŒBase64æ ¼å¼çš„é‡‡é›†è§„åˆ™ä¸ºï¼šBASE64:base64ç¼–ç åçš„é…ç½®:END !','-1');

39 
ex™
();

41 
	g$nÙess
 = 
ex¶ode
(':',
$nÙes
);

42 
	g$nÙes
 = 
$nÙess
[1];

43 
	g$nÙes
 = 
ba£64_decode
(
”eg_»¶aû
("[\r\n\ˆ]",'',
$nÙes
)è
OR
 
d›
('é…ç½®å­—ç¬¦ä¸²æœ‰é”™è¯¯ï¼');

47 
	g$nÙes
 = 
¡r¦ashes
(
$nÙes
);

49 
	g$d
 = 
Ãw
 
XakTagP¬£
();

50 
	g$d
->
LßdSŒšg
(
$nÙes
);

51 if(!
is_¬¿y
(
$d
->
CTags
))

53 
ShowMsg
('è¯¥è§„åˆ™ä¸åˆæ³•ï¼Œæ— æ³•å¯¼å…¥!','-1');

54 
ex™
();

56 
	g$ùag1
 = 
$d
->
G‘TagByName
('listconfig');

57 
	g$ùag2
 = 
$d
->
G‘TagByName
('itemconfig');

58 
	g$li¡cÚfig
 = 
$ùag1
->
G‘IÂ”Text
();

59 
	g$™emcÚfig
 = 
add¦ashes
(
$ùag2
->
G‘IÂ”Text
());

60 
	g$d
->
LßdSŒšg
(
$li¡cÚfig
);

61 
	g$li¡cÚfig
 = 
add¦ashes
(
$li¡cÚfig
);

62 
	g$nÙešfo
 = 
$d
->
G‘TagByName
('noteinfo');

63 if(!
is_objeù
(
$nÙešfo
))

65 
ShowMsg
("è¯¥è§„åˆ™ä¸åˆæ³•ï¼Œæ— æ³•å¯¼å…¥!","-1");

66 
ex™
();

68 
fÜ—ch
(
$nÙešfo
->
CA‰ribu‹
->
I‹ms
 
as
 
$k
=>
$v
)

70 
$$k
 = 
add¦ashes
(
$v
);

72 
	g$u±ime
 = 
time
();

73 if(
em±y
(
$äeq
))

75 
	g$äeq
 = 1;

77 if(
em±y
(
$exty³id
))

79 
	g$exty³id
 = 0;

81 if(
em±y
(
$i¦i¡’
))

83 
	g$i¦i¡’
 = 0;

85 
	g$šqu”y
 = " INSERT INTO `#@__co_note`(`channelid`,`notename`,`sourcelang`,`uptime`,`cotime`,`pnum`,`isok`,`usemore`,`listconfig`,`itemconfig`)

86 
VALUES
 ('$channelid','$notename','$sourcelang','$uptime','0','0','0','$usemore','$listconfig','$itemconfig'); ";

87 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

88 if(!
	g$rs
)

90 
ShowMsg
("ä¿å­˜ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼".
$dsql
->
G‘E¼Ü
(),"-1");

91 
ex™
();

93 
ShowMsg
("æˆåŠŸå¯¼å…¥ä¸€ä¸ªè§„åˆ™!","co_main.php");

94 
ex™
();

	@E:\web\weixun\xakadmin\co_getsource_url_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('co_PlayNote');

9 
»quœe_Úû
(
XAKINC
.'/xakcollection.class.php');

11 if(
em±y
(
$i¦i¡’
)è
	g$i¦i¡’
 = 0;

12 if(
em±y
(
$gl¡¬t
)è
	g$gl¡¬t
 = 0;

13 if(
em±y
(
$tÙ®num
)è
	g$tÙ®num
 = 0;

14 if(
em±y
(
$nÙckpic
)è
	g$nÙckpic
 = 0;

16 
	g$nid
 = (
is£t
(
$nid
è? 
	$štv®
(
$nid
) : 0);

22 if(
$i¦i¡’
==0)

24 
$mrow
 = 
$dsql
->
	`G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__co_htmls` WHERE‚id='$nid' ");

25 
$tÙ®num
 = 
$mrow
['dd'];

26 
$gu¾
 = "co_gather_start_action.php?notckpic=$notckpic&islisten=$islisten&nid=$nid&startdd=$startdd&pagesize=$pagesize&sptime=$sptime";

27 if(
$tÙ®num
 <= 0)

29 
	`ShowMsg
("ä½ æŒ‡å®šçš„æ¨¡å¼ä¸ºï¼š<font color='red'>[ä¸‹è½½ç§å­ç½‘å€ä¸­æœªä¸‹è½½å†…å®¹]</font>ï¼Œ<br />ä½¿ç”¨è¿™ä¸ªæ¨¡å¼èŠ‚ç‚¹å¿…é¡»å·²ç»æœ‰ç§å­ç½‘å€ï¼Œå¦åˆ™è¯·ä½¿ç”¨å…¶å®ƒæ¨¡å¼ï¼","javascript:;");

30 
	`ex™
();

34 
	`ShowMsg
("æ£€æµ‹èŠ‚ç‚¹æ­£å¸¸ï¼Œç°è½¬å‘ç½‘é¡µé‡‡é›†...",
$gu¾
."&totalnum=$totalnum");

35 
	`ex™
();

37 
	}
}

43 if(
	g$i¦i¡’
==1)

45 
$gu¾
 = "co_gather_start_action.php?notckpic=$notckpic&islisten=1&nid=$nid&startdd=$startdd&pagesize=$pagesize&sptime=$sptime";

46 
	g$gu¾Li¡
 = "co_getsource_url_action.php?islisten=1&nid=0&pagesize=$pagesize&sptime=$sptime";

48 if(!
em±y
(
$nid
))

50 
	g$co
 = 
Ãw
 
XakCŞËùiÚ
();

51 
	g$co
->
LßdNÙe
(
$nid
);

52 
	g$lim™Li¡
 = 
$co
->
G‘SourûU¾
(1,0,100);

53 
	g$row
 = 
$co
->
dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd FROM `#@__co_htmls` WHERE‚id='$nid' ");

54 
	g$tÙ®num
 = 
$row
['dd'];

55 if(
	g$tÙ®num
==0)

57 
ShowMsg
("åœ¨è¿™èŠ‚ç‚¹ä¸­æ²¡å‘ç°æœ‰æ–°å†…å®¹....","javascript:;");

58 
ex™
();

62 
ShowMsg
("å·²è·å¾—æ‰€æœ‰ç§å­ç½‘å€ï¼Œè½¬å‘ç½‘é¡µé‡‡é›†...",
$gu¾
."&totalnum=$totalnum");

63 
ex™
();

69 
	g$cu½os
 = (
is£t
(
$cu½os
è? 
štv®
($curpos) : 0);

70 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT‚id FROM `#@__co_note` ORDER BY‚id ASC LIMIT $curpos,1");

71 
	g$Âid
 = 
$row
['nid'];

72 if(!
is_¬¿y
(
$row
))

74 
ShowMsg
("å®Œæˆæ‰€æœ‰èŠ‚ç‚¹æ£€æµ‹....","co_g©h”_¡¬t_aùiÚ.php?nÙckpic=0&¥time=0&nid=0&¡¬tdd=0&·gesize=5&tÙ®num=".
$tÙ®num
);

75 
ex™
();

79 
	g$co
 = 
Ãw
 
XakCŞËùiÚ
();

80 
	g$co
->
LßdNÙe
(
$Âid
);

81 
	g$lim™Li¡
 = 
$co
->
G‘SourûU¾
(1,0,100);

82 
	g$cu½os
++;

83 
ShowMsg
("å·²æ£€æµ‹èŠ‚ç‚¹Ğ{$Âid} )ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹...",
$gu¾Li¡
."&curpos=$curpos");

84 
ex™
();

94 
	g$gu¾
 = "co_gather_start_action.php?notckpic=$notckpic&islisten=$islisten&nid=$nid&startdd=$startdd&pagesize=$pagesize&sptime=$sptime";

95 
	g$gu¾Li¡
 = "co_getsource_url_action.php?islisten=$islisten&nid=$nid&startdd=$startdd&pagesize=$pagesize&sptime=$sptime";

96 
	g$co
 = 
Ãw
 
XakCŞËùiÚ
();

97 
	g$co
->
LßdNÙe
(
$nid
);

98 
	g$lim™Li¡
 = 
$co
->
G‘SourûU¾
(
$i¦i¡’
, 
$gl¡¬t
, 
$·gesize
);

99 if(
	g$lim™Li¡
==0)

101 
$row
 = 
$co
->
dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd FROM `#@__co_htmls` WHERE‚id='$nid'");

102 
	g$tÙ®num
 = 
$row
['dd'];

103 
ShowMsg
("å·²è·å¾—æ‰€æœ‰ç§å­ç½‘å€ï¼Œè½¬å‘ç½‘é¡µé‡‡é›†...",
$gu¾
."&totalnum=$totalnum");

104 
ex™
();

106 if(
	g$lim™Li¡
>0)

108 
ShowMsg
("é‡‡é›†åˆ—è¡¨å‰©ä½™ï¼š{$lim™Li¡} ä¸ªé¡µé¢ï¼Œç»§ç»­é‡‡é›†...",
$gu¾Li¡
."&gl¡¬t=".(
$gl¡¬t
+
$·gesize
),0,100);

109 
ex™
();

	@E:\web\weixun\xakadmin\co_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
£tcook›
("ENV_GOBACK_URL", 
$xakNowu¾
, 
time
()+3600, "/");

10 
	g$sql
 = "SELECT co.nid,co.channelid,co.notename,co.sourcelang,co.uptime,co.cotime,co.pnum,ch.typename";

11 
	g$sql
 .= " FROM `#@__co_note` co LEFT JOIN `#@__channeltype` ch ON ch.id=co.channelid ORDER BY co.nid DESC";

12 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

13 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/co_main.htm");

14 
	g$dli¡
->
S‘Sourû
(
$sql
);

15 
	g$dli¡
->
di¥Ïy
();

17 
funùiÚ
 
	$G‘D©ePage
(
$mktime
)

19  
$mktime
=='0' ? 'ä»æœªé‡‡é›†è¿‡' : 
	`MyD©e
('Y-m-d',$mktime);

20 
	}
}

22 
funùiÚ
 
	$TjU¾Num
(
$nid
)

24 
glob®
 
$dsql
;

25 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__co_htmls` WHERE‚id='$nid' ");

26  
$row
['dd'];

27 
	}
}

	@E:\web\weixun\xakadmin\co_test_rule.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/xakcollection.class.php");

9 
	g$nid
 = 
štv®
(
$nid
);

10 
	g$co
 = 
Ãw
 
XakCŞËùiÚ
();

11 
	g$co
->
LßdNÙe
(
$nid
);

12 
šşude
 
XAKINClude
('templets/co_test_rule.htm');

13 
ex™
();

	@E:\web\weixun\xakadmin\co_url.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

10 
	g$wh”e
 = "";

12 if(!
is£t
(
$nid
)è
	g$nid
="";

13 if(!
em±y
(
$nid
)è
	g$wh”e
 = " where cu.nid='$nid' ";

14 if(
em±y
(
$sm®l
)è
	g$sm®l
 = 0;

16 if(
	g$nid
!='')

18 
$expÜtbt
 = "

19 <
šput
 
ty³
='bu‰Ú' 
Çme
='b0' 
v®ue
='å¯¼å‡ºå†…å®¹' 
şass
='coolbg‚p'

20 
ÚClick
=\"location.href='co_export.php?nid=$nid';\" />

21 <
šput
 
ty³
='bu‰Ú' 
Çme
='b0' 
v®ue
='é‡‡é›†æœ¬èŠ‚ç‚¹' 
şass
='coolbg‚p'

22 
ÚClick
=\"location.href='co_gather_start.php?nid=$nid';\" />

27 
	g$expÜtbt
 = "";

30 
	g$sql
 = "SELECT cu.aid,cu.nid,cu.isexport AS isex,cu.title,cu.url,cu.dtime,cu.isdown,cn.notename,tp.typename FROM `#@__co_htmls` cu

31 
LEFT
 
JOIN
 `#@
__co_nÙe
` 
ú
 
ON
 cn.
nid
=
cu
.nid

32 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
cu
.
ty³id


33 
$wh”e
 
ORDER
 
BY
 
cu
.
aid
 
DESC
";

34 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

35 
	g$dli¡
->
S‘P¬am‘”
("nid", 
$nid
);

36 
	g$dli¡
->
S‘P¬am‘”
("sm®l", 
$sm®l
);

37 if(
	g$sm®l
==0)

39 
$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/co_url.htm");

43 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/co_url_2.htm");

45 
	g$dli¡
->
S‘Sourû
(
$sql
);

46 
	g$dli¡
->
di¥Ïy
();

48 
funùiÚ
 
	$IsDownLßd
(
$isd
)

50 if(
$isd
=="0")  "æœªä¸‹è½½";

52 
	}
}

54 
funùiÚ
 
	$IsExD©a
(
$i£x
)

56 if(
$i£x
==0)  "æœªå¯¼å‡º";

58 
	}
}

	@E:\web\weixun\xakadmin\co_view.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
»quœe_Úû
(
XAKINC
."/xakcollection.class.php");

7 
	g$backu¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "co_url.php";

8 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
='';

9 if(
	g$aid
=='')

11 
ShowMsg
('å‚æ•°æ— æ•ˆ!','-1');

12 
ex™
();

16 if(
	g$aùiÚ
=="save")

18 
$»suÉ
 = '';

19 
	g$i
=0;$˜< 
	g$’did
;$i++)

21 
	g$»suÉ
 .ğ"{xak:f›ld‚ame=\\'".
$
{"noteid_$i"}."\\'}".${"value_$i"}."{/xak:field}\r\n";

23 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__co_htmls` SET„esult='$result' WHERE‡id='$aid'; ");

24 
ShowMsg
("æˆåŠŸä¿å­˜ä¸€æ¡è®°å½•ï¼",
$backu¾
);

25 
ex™
();

27 
	g$dsql
->
S‘Sql
("SELECT * FROM `#@__co_htmls` WHERE‡id='$aid'");

28 
	g$dsql
->
Execu‹
();

29 
	g$row
 = 
$dsql
->
G‘Objeù
();

30 
	g$isdown
 = 
$row
->
isdown
;

31 
	g$nid
 = 
$row
->
nid
;

32 
	g$u¾
 = 
$row
->
u¾
;

33 
	g$dtime
 = 
$row
->
dtime
;

34 
	g$body
 = 
$row
->
»suÉ
;

35 
	g$l™pic
 = 
$row
->
l™pic
;

36 
	g$f›lds
 = 
¬¿y
();

37 if(
	g$isdown
 == 0)

39 
$co
 = 
Ãw
 
XakCŞËùiÚ
();

40 
	g$co
->
LßdNÙe
(
$nid
);

41 
	g$co
->
DownU¾
(
$aid
, 
$u¾
, 
$l™pic
);

42 
	g$co
->
	gdsql
->
S‘Sql
("SELECT * FROM `#@__co_htmls` WHERE‡id='$aid'");

43 
	g$co
->
	gdsql
->
Execu‹
();

44 
	g$row
 = 
$co
->
dsql
->
G‘Objeù
();

45 
	g$isdown
 = 
$row
->
isdown
;

46 
	g$nid
 = 
$row
->
nid
;

47 
	g$u¾
 = 
$row
->
u¾
;

48 
	g$dtime
 = 
$row
->
dtime
;

49 
	g$body
 = 
$row
->
»suÉ
;

50 
	g$l™pic
 = 
$row
->
l™pic
;

52 
	g$d
 = 
Ãw
 
XakTagP¬£
();

53 
	g$d
->
S‘NameS·û
("xak", "{", "}");

54 
	g$d
->
LßdSŒšg
(
$body
);

55 
šşude
 
XAKINClude
('templets/co_view.htm');

	@E:\web\weixun\xakadmin\config.php

1 <?
php


7 
defše
('XAKADMIN', 
¡r_»¶aû
("\\", '/', 
dœÇme
(
__FILE__
) ) );

8 
»quœe_Úû
(
XAKADMIN
.'/../functions/common.inc.php');

9 
»quœe_Úû
(
XAKADMIN
.'/conn.php');

10 
»quœe_Úû
(
XAKINC
.'/userlogin.class.php');

11 
h—d”
('Cache-Control:private');

12 
	g$dsql
->
	g§ãCheck
 = 
FALSE
;

13 
	g$dsql
->
S‘LÚgLšk
();

14 
	g$cfg_admš_skš
 = 1;

16 if(
fe_exi¡s
(
XAKDATA
.'/admin/skin.txt'))

18 
	g$skš
 = 
fe_g‘_cÚ‹Ás
(
XAKDATA
.'/admin/skin.txt');

19 
	g$cfg_admš_skš
 = !
š_¬¿y
(
$skš
, 
¬¿y
(1,2,3,4))? 1 : $skin;

23 
	g$xakNowu¾
 = 
$s_sütName
 = '';

24 
	g$isU¾O³n
 = @
ši_g‘
('allow_url_fopen');

25 
	g$xakNowu¾
 = 
G‘CurU¾
();

26 
	g$xakNowu¾s
 = 
ex¶ode
('?', 
$xakNowu¾
);

27 
	g$s_sütName
 = 
$xakNowu¾s
[0];

28 
	g$cfg_»mÙe_s™e
 = 
em±y
(
$cfg_»mÙe_s™e
)? 'N' : $cfg_remote_site;

31 
	g$cu£rLogš
 = 
Ãw
 
u£rLogš
();

32 if(
	g$cu£rLogš
->
g‘U£rID
()==-1)

34 
h—d”
("loÿtiÚ:logš.php?gÙİage=".
u¾’code
(
$xakNowu¾
));

35 
ex™
();

38 if(
	g$cfg_xak_log
=='Y')

40 
$s_nŞogfe
 = '_main|_list';

41 
	g$s_Ãedlogfe
 = 'sys_|file_';

42 
	g$s_m‘hod
 = 
is£t
(
$_SERVER
['REQUEST_METHOD']) ? $_SERVER['REQUEST_METHOD'] : '';

43 
	g$s_qu”y
 = 
is£t
(
$xakNowu¾s
[1]) ? $xakNowurls[1] : '';

44 
	g$s_sütNames
 = 
ex¶ode
('/', 
$s_sütName
);

45 
	g$s_sütNames
 = 
$s_sütNames
[
couÁ
($s_scriptNames)-1];

46 
	g$s_u£r
 = 
G‘IP
();

47 ifĞ
	g$s_m‘hod
=='POST' || (!
´eg_m©ch
("#".
$s_nŞogfe
."#i", 
$s_sütNames
è&& 
	g$s_qu”y
!=''è||…»g_m©ch("#".
$s_Ãedlogfe
."#i",$s_scriptNames) )

49 
	g$šqu”y
 = "INSERT INTO `#@__log`(adminid,filename,method,query,cip,dtime)

50 
VALUES
 ('".$cuserLogin->getUserID()."','{$s_scriptNames}','{$s_method}','".addslashes($s_query)."','{$s_userip}','".time()."');";

51 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

56 if(
	g$cfg_»mÙe_s™e
=='Y')

58 
»quœe_Úû
(
XAKINC
.'/ftp.class.php');

59 if(
fe_exi¡s
(
XAKDATA
."/cache/inc_remote_config.php"))

61 
»quœe_Úû
 
	gXAKDATA
."/cache/inc_remote_config.php";

63 if(
em±y
(
$»mÙeu¶ßds
)è
	g$»mÙeu¶ßds
 = 0;

64 if(
em±y
(
$»mÙeupU¾
)è
	g$»mÙeupU¾
 = '';

65 
	g$cÚfig
 = 
¬¿y
(

66 'ho¡Çme' => 
$GLOBALS
['cfg_ftp_host'],

67 'u£ºame' => 
$GLOBALS
['cfg_ftp_user'],

68 '·sswÜd' => 
$GLOBALS
['cfg_ftp_pwd'],

71 
	g$áp
 = 
Ãw
 
FTP
(
$cÚfig
);

74 if(
	g$»mÙeu¶ßds
==1){

75 
$ápcÚfig
 = 
¬¿y
(

76 'ho¡Çme'=>
$rmho¡
,

77 'pÜt'=>
$rmpÜt
,

78 'u£ºame'=>
$rmÇme
,

79 '·sswÜd'=>
$rmpwd


85 
	g$ÿche1
 = 
XAKDATA
.'/cache/inc_catalog_base.inc';

86 if(!
	$fe_exi¡s
(
$ÿche1
)è
	`UpD©eC©Cache
();

87 
$ÿcheFe
 = 
XAKDATA
.'/ÿche/admšÿt_'.
$cu£rLogš
->
u£rID
.'.inc';

88 if(
	$fe_exi¡s
(
$ÿcheFe
)è
	`»quœe_Úû
($cacheFile);

91 
	`»quœe_Úû
 (
XAKDATA
.'/admin/config_update.php');

99 
funùiÚ
 
	$UpD©eC©Cache
()

101 
glob®
 
$dsql
, 
$cfg_muÉi_s™e
, 
$ÿche1
, 
$ÿcheFe
, 
$cu£rLogš
;

102 
$ÿche2
 = 
XAKDATA
.'/cache/channelsonlist.inc';

103 
$ÿche3
 = 
XAKDATA
.'/cache/channeltoplist.inc';

104 
$dsql
->
	`S‘Qu”y
("SELECT id,reid,channeltype,issend,typename FROM `#@__arctype`");

105 
$dsql
->
	`Execu‹
();

106 
$å1
 = 
	`fİ’
(
$ÿche1
,'w');

107 
$phph
 = '?';

108 
$å1H—d”
 = "<{$phph}php\r\nglobal \$cfg_Cs;\r\n\$cfg_Cs=array();\r\n";

109 
	`fwr™e
(
$å1
,
$å1H—d”
);

110 
$row
=
$dsql
->
	`G‘Objeù
())

113 
$row
->
ty³Çme
 = 
	`ba£64_’code
($row->typename);

114 
	`fwr™e
(
$å1
,"\$cfg_Cs[{$row->id}]=array({$row->reid},{$row->channeltype},{$row->issend},'{$row->typename}');\r\n");

116 
	`fwr™e
(
$å1
, "{$phph}>");

117 
	`fşo£
(
$å1
);

118 
$cu£rLogš
->
	`ReWr™eAdmšChªÃl
();

119 @
	`uÆšk
(
$ÿche2
);

120 @
	`uÆšk
(
$ÿche3
);

121 
	}
}

124 
funùiÚ
 
	$CË¬O±Cache
()

126 
$lCache
 = 
XAKDATA
.'/tplcache/';

127 
$feA¼ay
 = 
	`glob
(
$lCache
."inc_option_*.inc");

128 ià(
	`couÁ
(
$feA¼ay
) > 1)

130 
	`fÜ—ch
 (
$feA¼ay
 
as
 
$key
 => 
$v®ue
)

132 ià(
	`fe_exi¡s
(
$v®ue
)è
	`uÆšk
($value);

135  
TRUE
;

137  
FALSE
;

138 
	}
}

146 
funùiÚ
 
	$UpD©eMemb”ModCache
()

148 
glob®
 
$dsql
;

149 
$ÿchefe
 = 
XAKDATA
.'/cache/member_model.inc';

151 
$dsql
->
	`S‘Qu”y
("SELECT * FROM `#@__member_model` WHERE state='1'");

152 
$dsql
->
	`Execu‹
();

153 
$å1
 = 
	`fİ’
(
$ÿchefe
,'w');

154 
$phph
 = '?';

155 
$å1H—d”
 = "<{$phph}php\r\nglobal \$_MemberMod;\r\n\$_MemberMod=array();\r\n";

156 
	`fwr™e
(
$å1
,
$å1H—d”
);

157 
$row
=
$dsql
->
	`G‘Objeù
())

159 
	`fwr™e
(
$å1
,"\$_MemberMod[{$row->id}]=array('{$row->name}','{$row->table}');\r\n");

161 
	`fwr™e
(
$å1
,"{$phph}>");

162 
	`fşo£
(
$å1
);

163 
	}
}

173 
funùiÚ
 
	$XAKINClude
(
$f’ame
, 
$i§bs
=
FALSE
)

175  
$i§bs
 ? 
$f’ame
 : 
XAKADMIN
.'/'.$filename;

176 
	}
}

186 
funùiÚ
 
G‘F
(
$cu¼’t
='', 
$fÜmÇme
='')

188 
glob®
 
$dsql
;

189 
	g$fÜmÇme
 = 
em±y
(
$fÜmÇme
)? 'serviterm' : $formname;

190 
	g$cu£rLogš
 = 
Ãw
 
u£rLogš
();

191 
	g$row
=
$dsql
->
G‘OÃ
("SELECT servinfo FROM `#@__multiserv_config`");

192 
	g$row
['£rvšfo']=
Œim
(
$row
['servinfo']);

193 if(!
em±y
(
$row
['servinfo'])){

194 
	g$£rvšfos
 = 
ex¶ode
("\n", 
$row
['servinfo']);

195 
	g$£Ëù
="";

196 
	gecho
 '<£Ëù‚ame="'.
	g$fÜmÇme
.'" size="1" id="serviterm">';

197 
	g$i
=0;

198 
fÜ—ch
(
$£rvšfos
 
as
 
$£rvšfo
){

199 
	g$£rvšfo
 = 
Œim
(
$£rvšfo
);

200 
li¡
(
$£rvÇme
,
$£rvu¾
,
$£rvpÜt
,
$£rvu£r
,
$£rvpwd
,
$u£¾i¡
èğ
ex¶ode
('|',
$£rvšfo
);

201 
	g$£rvÇme
 = 
Œim
(
$£rvÇme
);

202 
	g$£rvu¾
 = 
Œim
(
$£rvu¾
);

203 
	g$£rvpÜt
 = 
Œim
(
$£rvpÜt
);

204 
	g$£rvu£r
 = 
Œim
(
$£rvu£r
);

205 
	g$£rvpwd
 = 
Œim
(
$£rvpwd
);

206 
	g$u£¾i¡
 = 
Œim
(
$u£¾i¡
);

207 
	g$checked
 = (
$cu¼’t
 =ğ
$i
)? ' selected="selected"' : '';

208 if(
¡r¡r
(
$u£¾i¡
,
$cu£rLogš
->
g‘U£rName
()))

210 
	g$£Ëù
.="<İtiÚ v®ue='".
$£rvu¾
.",".
$£rvu£r
.",".
$£rvpwd
."'{$checked}>".
$£rvÇme
."</option>";

212 
	g$i
++;

214 
echo
 
	g$£Ëù
."</select>";

217 
h–³r
('cache');

225 if(!
funùiÚ_exi¡s
('GetMemberName')){

226 
funùiÚ
 
G‘Memb”Name
(
$mid
=0)

228 
glob®
 
$dsql
;

229 
	g$rs
 = 
G‘Cache
('memb”logš', 
$mid
);

230 ifĞ
em±y
(
$rs
) )

232 
	g$rs
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE mid='{$mid}' ");

233 
S‘Cache
('memb”logš', 
$mid
, 
$rs
, 1800);

235  
	g$rs
['uname'];

	@E:\web\weixun\xakadmin\conn.php

1 <?
php


2 if(!
defšed
('XAKADMIN')è
ex™
("Warning...");

9 
	g$İ’_cÚ‹Á
 = 1;

10 
	g$İ’_ÿ‹gÜy
 = 1;

11 
	g$İ’_html
 = 1;

12 
	g$İ’_‹m¶‘s
 = 0;

13 
	g$İ’_cŞËùiÚ
 = 1;

14 
	g$İ’_memb”
 = 1;

15 
	g$İ’_moduË
 = 1;

16 
	g$İ’_cÚfig
 = 1;

19 
	g$İ’_comm’t
 = 0;

20 
	g$İ’_h–p
 = 0;

24 
	g$İ’_syscÚfig
 = 
¬¿y
(

	@E:\web\weixun\xakadmin\content_att.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Att');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
	g$dİo¡
=="save")

14 
$¡¬tID
 = 1;

15 
	g$’dID
 = 
$id’d
;

16 ; 
	g$¡¬tID
<=
$’dID
; $startID++)

18 
	g$©t
 = 
$
{'©t_'.
$¡¬tID
};

19 
	g$©Šame
 = 
$
{'©Šame_'.
$¡¬tID
};

20 
	g$sÜtid
 = 
$
{'sÜtid_'.
$¡¬tID
};

21 
	g$qu”y
 = "UPDATE `#@__arcatt` SET `attname`='$attname',`sortid`='$sortid' WHERE‡tt='$att' ";

22 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

24 
	gecho
 "<script>‡lert('æˆåŠŸæ›´æ–°è‡ªå®šæ–‡æ¡£ä¹‰å±æ€§è¡¨ï¼'); </script>";

27 
šşude
 
XAKINClude
('templets/content_att.htm');

	@E:\web\weixun\xakadmin\content_batch_up.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

9 
šşude
 
XAKINClude
('templets/content_batch_up.htm');

	@E:\web\weixun\xakadmin\content_batchup_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_ArcBatch');

9 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

10 
»quœe_Úû
(
XAKADMIN
."/inc/inc_batchup.php");

11 @
£t_time_lim™
(0);

17 if(
em±y
(
$¡¬tid
)è
	g$¡¬tid
 = 0;

18 if(
em±y
(
$’did
)è
	g$’did
 = 0;

19 if(
em±y
(
$£Éime
)è
	g$£Éime
 = 0;

20 if(
em±y
(
$ty³id
)è
	g$ty³id
 = 0;

21 if(
em±y
(
$u£rid
)è
	g$u£rid
 = '';

24 if(
	g$aùiÚ
=="makehtml")

26 
$jumpu¾
 = "makehtml_archives_action.php?endid=$endid&startid=$startid";

27 
	g$jumpu¾
 .= "&typeid=$typeid&pagesize=20&seltime=$seltime";

28 
	g$jumpu¾
 .ğ"&¡ime=".
u¾’code
(
$¡¬‰ime
)."&‘ime=".u¾’code(
$’dtime
);

29 
h—d”
("Location: $jumpurl");

30 
ex™
();

33 
	g$gwh”e
 = " WHERE 1 ";

34 if(
	g$¡¬tid
 >0 ) 
	g$gwh”e
 .= " AND id>= $startid ";

35 if(
	g$’did
 > 
	g$¡¬tid
è
	g$gwh”e
 .= " AND id<= $endid ";

36 
	g$idsql
 = '';

38 if(
	g$ty³id
!=0)

40 
$ids
 = 
G‘SÚIds
(
$ty³id
);

41 
	g$gwh”e
 .= " ANDypeid IN($ids) ";

43 if(
	g$£Éime
==1)

45 
$t1
 = 
G‘MkTime
(
$¡¬‰ime
);

46 
	g$t2
 = 
G‘MkTime
(
$’dtime
);

47 
	g$gwh”e
 .= " AND (senddate >= $t1 AND senddate <= $t2) ";

49 if(!
	$em±y
(
$u£rid
))

51 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT `mid` FROM `#@__member_list` WHERE `userid` LIKE '$userid'");

52 if(
	`is_¬¿y
(
$row
))

54 
$gwh”e
 .= " AND mid = {$row['mid']} ";

56 
	}
}

58 if(!
em±y
(
$heightdÚe
)è
	g$aùiÚ
=$heightdone;

61 if(
	g$aùiÚ
=='check')

63 if(
em±y
(
$¡¬tid
è||ƒm±y(
$’did
) || $endid < $startid)

65 
ShowMsg
('è¯¥æ“ä½œå¿…é¡»æŒ‡å®šèµ·å§‹IDï¼','javascript:;');

66 
ex™
();

68 
	g$jumpu¾
 = "makehtml_archives_action.php?endid=$endid&startid=$startid";

69 
	g$jumpu¾
 .= "&typeid=$typeid&pagesize=20&seltime=$seltime";

70 
	g$jumpu¾
 .ğ"&¡ime=".
u¾’code
(
$¡¬‰ime
)."&‘ime=".u¾’code(
$’dtime
);

71 
	g$dsql
->
S‘Qu”y
("SELECT id,arcrank FROM `#@__arctiny` $gwhere");

72 
	g$dsql
->
Execu‹
('c');

73 
	g$row
 = 
$dsql
->
G‘Objeù
('c'))

75 if(
$row
->
¬üªk
==-1)

77 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctiny` SET‡rcrank=0 WHERE id='{$row->id}'");

78 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SET‡rcrank=0 WHERE id='{$row->id}'");

81 
ShowMsg
("å®Œæˆæ•°æ®åº“çš„å®¡æ ¸å¤„ç†ï¼Œå‡†å¤‡æ›´æ–°HTML...",
$jumpu¾
);

82 
ex™
();

85 if(
	g$aùiÚ
=='del')

87 if(
em±y
(
$¡¬tid
è||ƒm±y(
$’did
) || $endid < $startid)

89 
ShowMsg
('è¯¥æ“ä½œå¿…é¡»æŒ‡å®šèµ·å§‹IDï¼','javascript:;');

90 
ex™
();

92 
	g$dsql
->
S‘Qu”y
("SELECT id FROM `#@__archives` $gwhere");

93 
	g$dsql
->
Execu‹
('x');

94 
	g$tdd
 = 0;

95 
	g$row
 = 
$dsql
->
G‘Objeù
('x'))

97 if(
D–Arc
(
$row
->
id
)è
$tdd
++;

99 
ShowMsg
("æˆåŠŸåˆ é™¤ $tdd æ¡è®°å½•ï¼","javascript:;");

100 
ex™
();

103 if(
	g$aùiÚ
=='delnulltitle')

105 
$dsql
->
S‘Qu”y
("SELECT id FROM `#@__archives` WHERErim(title)='' ");

106 
	g$dsql
->
Execu‹
('x');

107 
	g$tdd
 = 0;

108 
	g$row
 = 
$dsql
->
G‘Objeù
('x'))

110 if(
D–Arc
(
$row
->
id
)è
$tdd
++;

112 
ShowMsg
("æˆåŠŸåˆ é™¤ $tdd æ¡è®°å½•ï¼","javascript:;");

113 
ex™
();

116 if(
	g$aùiÚ
=='delnullbody')

118 
$dsql
->
S‘Qu”y
("SELECT‡id FROM `#@__addonarticle` WHERE LENGTH(body) < 10 ");

119 
	g$dsql
->
Execu‹
('x');

120 
	g$tdd
 = 0;

121 
	g$row
 = 
$dsql
->
G‘Objeù
('x'))

123 if(
D–Arc
(
$row
->
aid
)è
$tdd
++;

125 
ShowMsg
("æˆåŠŸåˆ é™¤ $tdd æ¡è®°å½•ï¼","javascript:;");

126 
ex™
();

129 if(
	g$aùiÚ
=='modddpic')

131 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SET†itpic='' WHERErim(litpic)='litpic' ");

132 
ShowMsg
("æˆåŠŸä¿®æ­£ç¼©ç•¥å›¾é”™è¯¯ï¼","javascript:;");

133 
ex™
();

136 if(
	g$aùiÚ
=='move')

138 if(
em±y
(
$ty³id
))

140 
ShowMsg
('è¯¥æ“ä½œå¿…é¡»æŒ‡å®šæ ç›®ï¼','javascript:;');

141 
ex™
();

143 
	g$ty³Şd
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__arctype WHERE id='$typeid'; ");

144 
	g$ty³Ãw
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__arctype WHERE id='$newtypeid'; ");

145 if(!
is_¬¿y
(
$ty³Ãw
))

147 
ShowMsg
("æ— æ³•æ£€æµ‹ç§»åŠ¨åˆ°çš„æ–°æ ç›®çš„ä¿¡æ¯ï¼Œä¸èƒ½å®Œæˆæ“ä½œï¼", "javascript:;");

148 
ex™
();

150 if(
	g$ty³Ãw
['ispart']!=0)

152 
ShowMsg
("ä½ ä¸èƒ½æŠŠæ•°æ®ç§»åŠ¨åˆ°éæœ€ç»ˆåˆ—è¡¨çš„æ ç›®ï¼", "javascript:;");

153 
ex™
();

155 if(
	g$ty³Ãw
['chªÃÉy³']!=
$ty³Şd
['channeltype'])

157 
ShowMsg
("ä¸èƒ½æŠŠæ•°æ®ç§»åŠ¨åˆ°å†…å®¹ç±»å‹ä¸åŒçš„æ ç›®ï¼","javascript:;");

158 
ex™
();

160 
	g$gwh”e
 .ğ" And chªÃl='".
$ty³Ãw
['channeltype']."' Anditle†ike '%$keyword%'";

162 
	g$ch
 = 
$dsql
->
G‘OÃ
("SELECT‡ddtable FROM `#@__channeltype` WHERE id={$typenew['channeltype']} ");

163 
	g$addbË
 = 
$ch
['addtable'];

165 
	g$dsql
->
S‘Qu”y
("SELECT id FROM `#@__archives` $gwhere");

166 
	g$dsql
->
Execu‹
('m');

167 
	g$tdd
 = 0;

168 
	g$row
 = 
$dsql
->
G‘Objeù
('m'))

170 
$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctiny` SETypeid='$newtypeid' WHERE id='{$row->id}'");

171 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SETypeid='$newtypeid' WHERE id='{$row->id}'");

172 if(
	g$addbË
!='')

174 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `$addtable` SETypeid='$newtypeid' WHERE‡id='{$row->id}' ");

176 if(
	g$rs
è
	g$tdd
++;

180 if(
	g$tdd
>0)

182 
	g$jumpu¾
 = "makehtml_archives_action.php?endid=$endid&startid=$startid";

183 
	g$jumpu¾
 .= "&typeid=$newtypeid&pagesize=20&seltime=$seltime";

184 
	g$jumpu¾
 .ğ"&¡ime=".
u¾’code
(
$¡¬‰ime
)."&‘ime=".u¾’code(
$’dtime
);

185 
ShowMsg
("æˆåŠŸç§»åŠ¨ $tdd æ¡è®°å½•ï¼Œå‡†å¤‡é‡æ–°ç”ŸæˆHTML...",
$jumpu¾
);

189 
ShowMsg
("å®Œæˆæ“ä½œï¼Œæ²¡ç§»åŠ¨ä»»ä½•æ•°æ®...","javascript:;");

193 if(
	g$aùiÚ
=='delnulltitle')

195 
$dsql
->
S‘Qu”y
("SELECT id FROM #@__archives WHERErim(title)='' ");

196 
	g$dsql
->
Execu‹
('x');

197 
	g$tdd
 = 0;

198 
	g$row
 = 
$dsql
->
G‘Objeù
('x'))

200 if(
D–Arc
(
$row
->
id
)è
$tdd
++;

202 
ShowMsg
("æˆåŠŸåˆ é™¤ $tdd æ¡è®°å½•ï¼","javascript:;");

203 
ex™
();

206 if(
	g$aùiÚ
=='modddpic')

208 
$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__archives SET†itpic='' WHERErim(litpic)='litpic' ");

209 
ShowMsg
("æˆåŠŸä¿®æ­£ç¼©ç•¥å›¾é”™è¯¯ï¼","javascript:;");

210 
ex™
();

	@E:\web\weixun\xakadmin\content_i_list.php

1 <?
php


7 
	g$s_tm¶‘s
 = "templets/content_i_list.htm";

8 
šşude
(
dœÇme
(
__FILE__
)."/content_list.php");

	@E:\web\weixun\xakadmin\content_list.php

1 <?
php


9 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

10 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

11 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

12 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_list_functions.php');

15 
CheckPurv›w
('a_List,a_AccList,a_MyList');

17 if(!
is£t
(
$u·‹_weight
)è
	g$u·‹_weight
 = '';

20 
	g$u£rC©®ogSql
 = '';

21 if(
Te¡Purv›w
('a_List'))

25 if(
Te¡Purv›w
('a_AccList'))

27 if(
	g$cid
==0 && 
$cfg_admš_chªÃl
 == 'array')

29 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

30 
	g$u£rC©®ogSql
 = "‡rc.typeid IN($admin_catalog) ";

34 
CheckC©®og
(
$cid
, 'ä½ æ— æƒæµè§ˆéæŒ‡å®šæ ç›®çš„å†…å®¹ï¼');

36 if(
Te¡Purv›w
('a_MyLi¡')è
	g$mid
 = 
$cu£rLogš
->
g‘U£rID
();

40 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

41 
	g$mašbË
 = '#@__archives';

42 
£tcook›
('ENV_GOBACK_URL', 
$xakNowu¾
, 
time
()+3600, '/');

44 
	g$cid
 = 
is£t
(
$cid
è? 
	$štv®
(
$cid
) : 0;

45 
$chªÃlid
 = 
	`is£t
($chªÃlidè? 
	$štv®
(
$chªÃlid
) : 0;

46 
$mid
 = 
	`is£t
($midè? 
	$štv®
(
$mid
) : 0;

47 if(!
	`is£t
(
$keywÜd
)) $keyword = '';

48 if(!
	`is£t
(
$æag
)) $flag = '';

49 if(!
	`is£t
(
$¬üªk
)) $arcrank = '';

50 if(!
	`is£t
(
$dİo¡
)) $dopost = '';

54 if(
$u·‹_weight
 == 'Yes')

57 
$mid
 = 
	`is£t
(
$·g’o
è? 
	`štv®
($pageno) : 0;

58 
$mid
 = 
	`is£t
(
$tÙ®»suÉ
è? 
	`štv®
($totalresult) : 0;

59 
$·ge_u¾
 = '';

60 if(
$tÙ®»suÉ
 > 0)

62 
$·ge_u¾
 .ğ'&tÙ®»suÉ='.
$tÙ®»suÉ
.'&·g’o='.
$·g’o
;

64 if(
$s_tm¶‘s
 !='')

66 
$·ge_u¾
 .ğ'&tÙ®»suÉ='.
$tÙ®»suÉ
.'&·g’o='.
$·g’o
.'&s_tm¶‘s='.
$s_tm¶‘s
;

68 
$loÿl_u¾
 = 'cÚ‹Á_li¡.php?dİo¡öi¡Archives&keywÜd='.
$keywÜd
.'&cid='.
$cid
.'&æag='.
$æag
.'&Üd”by='.
$Üd”by
.'&¬üªk='.
$¬üªk
.'&chªÃlid='.
$chªÃlid
.
$·ge_u¾
;

71 if(
	`is_¬¿y
(
$weight
))

73 
	`fÜ—ch
(
$weight
 
as
 
$key
 => 
$v®
)

75 
$dsql
->
	`Execu‹NÚeQu”y
("UPDATE #@__¬chive SET weight='".
$v®
."' WHERE id='{$key}';");

78 
	`ShowMsg
("æ“ä½œæˆåŠŸï¼Œæ­£åœ¨è¿”å›...",
$loÿl_u¾
);

79 
	`ex™
();

80 
	}
}

83 
	g$
 = 
Ãw
 
Ty³Lšk
(
$cid
);

88 if(
em±y
(
$tÙ®»suÉ
è&&ƒm±y(
$keywÜd
è&&ƒm±y(
$Üd”by
è&&ƒm±y(
$æag
))

90 
	g$tšyQu”ys
 = 
¬¿y
();

92 if(!
em±y
(
$u£rC©®ogSql
))

94 
	g$tšyQu”ys
[] = 
¡r_»¶aû
('¬c.', '', 
$u£rC©®ogSql
);

97 if(!
em±y
(
$chªÃlid
è&&ƒm±y(
$cid
))

99 
	g$tšyQu”ys
[] = " channel = '$channelid' ";

103 
	g$tšyQu”ys
[] = " channel>0 ";

106 if(!
em±y
(
$¬üªk
))

108 
	g$tšyQu”ys
[] = "‡rcrank='$arcrank' ";

112 
	g$tšyQu”ys
[] = "‡rcrank > -2 ";

115 if(!
em±y
(
$mid
))

117 
	g$tšyQu”ys
[] = " mid='$mid' ";

120 if(!
em±y
(
$cid
))

122 
	g$tšyQu”ys
[] = "y³id in(".
G‘SÚIds
(
$cid
).") ";

125 if(
couÁ
(
$tšyQu”ys
)>0)

127 
	g$tšyQu”y
 = "WHERE ".
još
(' AND ',
$tšyQu”ys
);

130 
	g$sql
 = "SELECT COUNT(*) AS dd FROM `#@__arctiny` $tinyQuery ";

131 
	g$ÿchekey
 = 
md5
(
$sql
);

138 
	g$tÙ®»suÉ
 = 
$¬r
['dd'];

141 if(
	g$cid
==0)

143 if(
$chªÃlid
==0)

145 
$pos™iÚÇme
 = 'æ‰€æœ‰æ ç›®&gt;';

149 
	g$row
 = 
$
->
dsql
->
G‘OÃ
("SELECT id,typename,maintable FROM `#@__channeltype` WHERE id='$channelid'");

150 
	g$pos™iÚÇme
 = 
$row
['typename']." &gt; ";

151 
	g$mašbË
 = 
$row
['maintable'];

152 
	g$chªÃlid
 = 
$row
['id'];

157 
	g$pos™iÚÇme
 = 
¡r_»¶aû
(
$cfg_li¡_symbŞ
," &gt; ",
$
->
G‘Pos™iÚName
())." &gt; ";

161 if(
em±y
(
$chªÃlid
è&& 
is£t
(
$
->
Ty³Infos
['channeltype']))

163 
	g$chªÃlid
 = 
$
->
Ty³Infos
['channeltype'];

166 if(
	g$chªÃlid
 < -1 )

168 
h—d”
("location:content_sg_list.php?cid=$cid&channelid=$channelid&keyword=$keyword");

169 
ex™
();

174 
	g$İtHash
 = 
md5
(
$cid
.
$admš_ÿlogs
.
$chªÃlid
);

175 
	g$İtCache
 = 
XAKDATA
."/tplcache/inc_option_$optHash.inc";

177 
	g$ty³CouÁ
 = 0;

178 ià(
fe_exi¡s
(
$ÿche1
)è
»quœe_Úû
($cache1);

179 
	g$cfg_Cs
 = 
¬¿y
();

180 
	g$ty³CouÁ
 = 
couÁ
(
$cfg_Cs
);

181 iàĞ
	g$ty³CouÁ
 > 800)

183 ià(
fe_exi¡s
(
$İtCache
))

185 
	g$İtiÚ¬r
 = 
fe_g‘_cÚ‹Ás
(
$İtCache
);

187 
	g$İtiÚ¬r
 = 
$
->
G‘O±iÚA¼ay
(
$cid
, 
$admš_ÿlogs
, 
$chªÃlid
);

188 
fe_put_cÚ‹Ás
(
$İtCache
, 
$İtiÚ¬r
);

191 
	g$İtiÚ¬r
 = 
$
->
G‘O±iÚA¼ay
(
$cid
, 
$admš_ÿlogs
, 
$chªÃlid
);

194 
	g$wh”eSql
 = 
em±y
(
$chªÃlid
) ? " WHERE‡rc.channel > 0 AND‡rc.arcrank > -2 " : " WHERE‡rc.channel = '$channelid' AND‡rc.arcrank > -2 ";

196 
	g$æagsA¼
 = '';

197 
	g$dsql
->
Execu‹
('f', 'SELECT * FROM `#@__arcatt` ORDER BY sortid ASC');

198 
	g$äow
 = 
$dsql
->
G‘A¼ay
('f'))

200 
$æagsA¼
 .ğ(
$äow
['©t']==
$æag
 ? "<option value='{$frow['att']}' selected>{$frow['attname']}</option>\r\n" : "<option value='{$frow['att']}'>{$frow['attname']}</option>\r\n");

204 if(!
em±y
(
$u£rC©®ogSql
))

206 
	g$wh”eSql
 .ğ" AND ".
$u£rC©®ogSql
;

208 if(!
em±y
(
$mid
))

210 
	g$wh”eSql
 .= " AND‡rc.mid = '$mid' ";

212 if(
	g$keywÜd
 != '')

214 
$wh”eSql
 .= " AND ( CONCAT(arc.title,arc.writer) LIKE '%$keyword%') ";

216 if(
	g$æag
 != '')

218 
$wh”eSql
 .= " AND FIND_IN_SET('$flag',‡rc.flag) ";

220 if(
	g$cid
 != 0)

222 
$wh”eSql
 .ğ' AND‡rc.ty³id IN ('.
G‘SÚIds
(
$cid
).')';

224 if(
	g$¬üªk
 != '')

226 
$wh”eSql
 .= " AND‡rc.arcrank = '$arcrank' ";

227 
	g$CheckU£rS’d
 = "<špuˆty³='bu‰Ú' cÏss='coŞbg‚p' onClick=\"loÿtiÚ='ÿlog_do.php?cid=".
$cid
."&dopost=listArchives&gurl=content_list.php';\" value='æ‰€æœ‰æ–‡æ¡£' />";

231 
	g$CheckU£rS’d
 = "<špuˆty³='bu‰Ú' cÏss='coŞbg‚p' onClick=\"loÿtiÚ='ÿlog_do.php?cid=".
$cid
."&dopost=listArchives&arcrank=-1&gurl=content_list.php';\" value='ç¨¿ä»¶å®¡æ ¸' />";

234 
	g$Üd”by
 = 
em±y
(
$Üd”by
è? 'id' : 
´eg_»¶aû
("#[^a-z0-9]#", "", $orderby);

235 
	g$Üd”byF›ld
 = '¬c.'.
$Üd”by
;

237 
	g$qu”y
 = "SELECT‡rc.id,arc.weight,arc.typeid,arc.senddate,arc.flag,arc.ismake,

238 
¬c
.
chªÃl
,
	g¬c
.
	g¬üªk
,¬c.
	gşick
,¬c.
	gt™Ë
,¬c.
	gcŞÜ
,¬c.
	gl™pic
,¬c.
	gpubd©e
,¬c.
mid


239 
	gFROM
 `
	g$mašbË
` 
¬c


240 
$wh”eSql


241 
ORDER
 
BY
 
$Üd”byF›ld
 
	gDESC
";

243 if(
em±y
(
$f
è|| !
´eg_m©ch
("#fÜm#", $f)è
	g$f
 = 'form1.arcid1';

246 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

247 
	g$dli¡
->
	g·geSize
 = 20;

250 
	g$dli¡
->
S‘P¬am‘”
('dopost', 'listArchives');

251 
	g$dli¡
->
S‘P¬am‘”
('keywÜd', 
$keywÜd
);

252 if(!
em±y
(
$mid
)è
	g$dli¡
->
S‘P¬am‘”
('mid', $mid);

253 
	g$dli¡
->
S‘P¬am‘”
('cid', 
$cid
);

254 
	g$dli¡
->
S‘P¬am‘”
('æag', 
$æag
);

255 
	g$dli¡
->
S‘P¬am‘”
('Üd”by', 
$Üd”by
);

256 
	g$dli¡
->
S‘P¬am‘”
('¬üªk', 
$¬üªk
);

257 
	g$dli¡
->
S‘P¬am‘”
('chªÃlid', 
$chªÃlid
);

258 
	g$dli¡
->
S‘P¬am‘”
('f', 
$f
);

261 if(
em±y
(
$s_tm¶‘s
)è
	g$s_tm¶‘s
 = 'templets/content_list.htm';

262 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
.'/'.
$s_tm¶‘s
);

265 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

268 
	g$dli¡
->
Di¥Ïy
();

270 
	g$dli¡
->
Clo£
();

	@E:\web\weixun\xakadmin\content_s_list.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('spec_List');

9 
	g$s_tm¶‘s
 = "templets/content_s_list.htm";

10 
	g$chªÃlid
 = -1;

11 
šşude
(
dœÇme
(
__FILE__
)."/content_list.php");

	@E:\web\weixun\xakadmin\content_select_list.php

1 <?
php


7 
	g$s_tm¶‘s
 = "templets/content_select_list.htm";

8 
šşude
(
dœÇme
(
__FILE__
)."/content_list.php");

	@E:\web\weixun\xakadmin\content_sg_list.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
	g$cid
 = 
is£t
(
$cid
è? 
	$štv®
(
$cid
) : 0;

9 
$chªÃlid
 = 
	`is£t
($chªÃlidè? 
	$štv®
(
$chªÃlid
) : 0;

10 
$mid
 = 
	`is£t
($midè? 
	$štv®
(
$mid
) : 0;

11 if(!
	`is£t
(
$keywÜd
)) $keyword = '';

12 if(!
	`is£t
(
$¬üªk
)) $arcrank = '';

14 if(
	`em±y
(
$cid
è&& 
	$em±y
(
$chªÃlid
))

16 
	`ShowMsg
("è¯¥é¡µé¢å¿…é¡»æŒ‡å®šæ ç›®IDæˆ–å†…å®¹æ¨¡å‹IDæ‰èƒ½æµè§ˆï¼","javascript:;");

17 
	`ex™
();

18 
	}
}

21 
CheckPurv›w
('a_List,a_AccList,a_MyList');

24 if(
Te¡Purv›w
('a_List'))

28 if(
Te¡Purv›w
('a_AccList'))

30 if(
	g$cid
==0)

32 
$ucid
 = 
$cid
 = 
$cu£rLogš
->
g‘U£rChªÃl
();

36 
CheckC©®og
(
$cid
,"ä½ æ— æƒæµè§ˆéæŒ‡å®šæ ç›®çš„å†…å®¹ï¼");

40 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

41 
	g$mašbË
 = '#@__archives';

42 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

43 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

44 
»quœe_Úû
(
XAKADMIN
."/inc/inc_list_functions.php");

45 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

46 
	g$
 = 
Ãw
 
Ty³Lšk
(
$cid
);

47 
	g$li¡bË
 = 
Œim
(
$
->
Ty³Infos
['addtable']);

48 ifĞ!
em±y
(
$chªÃlid
è&& !em±y(
$ucid
è&& 
	g$
->
	gTy³Infos
['channeltype'] != $channelid)

50 
ShowMsg
('ä½ æ²¡æƒé™è®¿é—®æ­¤é¡µï¼','javascript:;');

51 
ex™
();

54 if(
	g$cid
==0)

56 
$row
 = 
$
->
dsql
->
G‘OÃ
("SELECTypename,addtable FROM `#@__channeltype` WHERE id='$channelid'");

57 
	g$pos™iÚÇme
 = 
$row
['typename']." &gt; ";

58 
	g$li¡bË
 = 
$row
['addtable'];

62 
	g$pos™iÚÇme
 = 
¡r_»¶aû
(
$cfg_li¡_symbŞ
, " &gt; ", 
$
->
G‘Pos™iÚName
())." &gt; ";

65 
	g$İtiÚ¬r
 = 
$
->
G‘O±iÚA¼ay
(
$cid
, 
$admš_ÿlogs
, 
$chªÃlid
);

66 
	g$wh”eSql
 = 
$chªÃlid
==0 ? " WHERE‡rc.channel < -1 " : " WHERE‡rc.channel = '$channelid' ";

68 if(!
em±y
(
$mid
)è
	g$wh”eSql
 .= " AND‡rc.mid = '$mid' ";

69 if(
	g$keywÜd
!=''è
$wh”eSql
 .= " AND (arc.title†ike '%$keyword%') ";

70 if(
	g$cid
!=0è
$wh”eSql
 .ğ" AND‡rc.ty³id iÀ(".
G‘SÚIds
(
$cid
).")";

72 if(
	g$¬üªk
!='')

74 
$wh”eSql
 .= " AND‡rc.arcrank = '$arcrank' ";

75 
	g$CheckU£rS’d
 = "<inputype='button' class='coolbg‚p' onClick=\"location='content_sg_list.php?cid={$cid}&channelid={$channelid}&dopost=listArchives';\" value='æ‰€æœ‰æ–‡æ¡£' />";

79 
	g$CheckU£rS’d
 = "<inputype='button' class='coolbg‚p' onClick=\"location='content_sg_list.php?cid={$cid}&channelid={$channelid}&dopost=listArchives&arcrank=-1';\" value='ç¨¿ä»¶å®¡æ ¸' />";

82 
	g$qu”y
 = "SELECT‡rc.aid,arc.aid‡s id,arc.typeid,arc.arcrank,arc.flag,arc.senddate,arc.channel,arc.title,arc.mid,arc.click,tp.typename,ch.typename‡s channelname

83 
FROM
 `
$li¡bË
` 
¬c


84 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


85 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl


86 
$wh”eSql


87 
ORDER
 
BY
 
¬c
.
aid
 
DESC
";

88 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

89 
	g$dli¡
->
	g·geSize
 = 20;

90 
	g$dli¡
->
S‘P¬am‘”
("dopost", "listArchives");

91 
	g$dli¡
->
S‘P¬am‘”
("keywÜd", 
$keywÜd
);

92 
	g$dli¡
->
S‘P¬am‘”
("cid", 
$cid
);

93 
	g$dli¡
->
S‘P¬am‘”
("chªÃlid", 
$chªÃlid
);

94 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/content_sg_list.htm");

95 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

96 
	g$dli¡
->
Di¥Ïy
();

97 
	g$dli¡
->
Clo£
();

	@E:\web\weixun\xakadmin\content_tj.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_ArcTj');

9 
	g$row1
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__arctiny` ");

10 
	g$row2
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__feedback` ");

11 
	g$row3
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__member_list` ");

20 
funùiÚ
 
	$G‘Archives
(
$dsql
, 
$Üd”ty³
)

22 
$¡¬‰ime
 = 
	`time
() - (24*3600*30);

23 if(
$Üd”ty³
=='monthFeedback' ||$ordertype=='monthHot')

25 
$swh”e
 = " where senddate>$starttime ";

29 
$swh”e
 = "";

31 if(
	`´eg_m©ch
("#ãedback#", 
$Üd”ty³
))

33 
$Üd”sql
 = " ORDER BY scores DESC ";

37 
$Üd”sql
 = " ORDER BY click DESC ";

39 
$qu”y
 = "SELECT id,title,click,scores FROM #@__archives $swhere $ordersql LIMIT 0,20 ";

40 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

41 
$dsql
->
	`Execu‹
('ga');

42 
$row
 = 
$dsql
->
	`G‘Objeù
('ga'))

44 if(
	`´eg_m©ch
("#ãedback#i", 
$Üd”ty³
))

46 
$mÜešfo
 = "[<¨rg‘='_bÏnk' h»f='".
$GLOBALS
['cfg_phpurl']."/feedback.php?aid={$row->id}'><u>è¯„è®ºï¼š{$row->scores}</u></a>]";

50 
$mÜešfo
 = "[ç‚¹å‡»ï¼š{$row->click}]";

52 
echo
 "Â·<a href='archives_do.php?aid={$row->id}&dopost=viewArchives'arget='_blank'>";

53 
echo
 
	`ú_sub¡r
(
$row
->
t™Ë
, 30)."</a>{$moreinfo}<br/>\r\n";

55 
	}
}

56 
šşude
 
XAKINClude
('templets/content_tj.htm');

	@E:\web\weixun\xakadmin\diy_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_New');

9 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

10 
	g$mysql_v”siÚs
 = 
ex¶ode
(".",
Œim
(
$mysql_v”siÚ
));

11 
	g$mysql_v”siÚ
 = 
$mysql_v”siÚs
[0].".".$mysql_versions[1];

12 if(
	$em±y
(
$aùiÚ
))

14 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT diyid FROM #@__diyforms ORDER BY diyid DESC LIMIT 0,1 ");

15 if(
	`is_¬¿y
(
$row
)è
$Ãwdiyid
 = $row['diyid']+1;

16 
$Ãwdiyid
 = 1;

17 
	`šşude
(
XAKADMIN
."/templets/diy_add.htm");

18 
	}
}

21 if(
´eg_m©ch
("#[^0-9-]#", 
$diyid
è|| 
em±y
($diyid))

23 
ShowMsg
("<font color=red>'è‡ªå®šä¹‰è¡¨å•diyid'</font>å¿…é¡»ä¸ºæ•°å­—ï¼","-1");

24 
ex™
();

26 if(
	g$bË
=="")

28 
ShowMsg
("è¡¨åä¸èƒ½ä¸ºç©ºï¼", "-1");

29 
ex™
();

31 
	g$public
 = 
is£t
(
$public
è&& 
is_num”ic
($public) ? $public : 0;

32 
	g$Çme
 = 
html¥ecŸlch¬s
(
$Çme
);

33 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__diyforms WHERE diyid='$diyid' OR `table` LIKE '$table' OR‚ame LIKE '$name' ");

34 if(
is_¬¿y
(
$row
))

36 
ShowMsg
("å¯èƒ½è‡ªå®šä¹‰è¡¨å•çš„â€˜diyidâ€™ã€â€˜åç§°â€™åœ¨æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨ï¼","-1");

37 
ex™
();

39 
	g$qu”y
 = "SHOW TABLES FROM {$dsql->dbName} ";

40 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

41 
	g$dsql
->
Execu‹
();

42 
	g$row
 = 
$dsql
->
g‘¬¿y
())

44 if(
em±y
(
$row
[0])) $row[0] = '';

45 if(
	g$bË
 =ğ
$row
[0])

47 
showmsg
('æŒ‡å®šçš„è¡¨åœ¨æ•°æ®åº“ä¸­é‡å¤', '-1');

48 
ex™
();

51 
	g$sql
 = "CREATE TABLE IF NOT EXISTS `$table`(

52 `
id
` (10è
NOT
 
NULL
 
auto_šüem’t
,

53 `
	gifcheck
` 
tšyšt
(1è
NOT
 
NULL
  '0',

55 if(
	g$mysql_v”siÚ
 < 4.1)

57 
	g$sql
 .= " PRIMARY KEY (`id`)\r\n) TYPE=MyISAM; ";

61 
	g$sql
 .ğ" PRIMARY KEY (`id`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

63 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
))

65 
	g$qu”y
 = "INSERT INTO #@__diyforms (`diyid`, `name`, `table`, `info`, `listtemplate`, `viewtemplate`, `posttemplate`, `public` ) VALUES ('$diyid', '$name', '$table', '', '$listtemplate', '$viewtemplate', '$posttemplate', '$public')";

66 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

67 
showmsg
('è‡ªå®šä¹‰è¡¨å•åˆ›å»ºæˆåŠŸï¼Œè¯·è‡ªè¡Œæ·»åŠ å­—æ®µ', 'diy_main.php');

71 
showmsg
('è‡ªå®šä¹‰è¡¨å•åˆ›å»ºå¤±è´¥', '-1');

	@E:\web\weixun\xakadmin\diy_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_Edit');

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
="";

13 
	g$diyid
 = (
em±y
(
$diyid
è? 0 : 
štv®
($diyid));

18 if(
	g$dİo¡
=="save")

20 
$public
 = 
is£t
($publicè&& 
is_num”ic
($public) ? $public : 0;

21 
	g$Çme
 = 
html¥ecŸlch¬s
(
$Çme
);

22 
	g$qu”y
 = "UPDATE `#@__diyforms` SET‚ame = '$name',†isttemplate='$listtemplate', viewtemplate='$viewtemplate',…osttemplate='$posttemplate',…ublic='$public' WHERE diyid='$diyid' ";

23 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

24 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªè‡ªå®šä¹‰è¡¨å•ï¼","diy_main.php");

25 
ex™
();

30 if(
	g$dİo¡
=="delete")

32 @
£t_time_lim™
(0);

33 
CheckPurv›w
('c_Del');

34 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__diyforms WHERE diyid='$diyid'");

35 if(
em±y
(
$job
)è
	g$job
 = "";

38 if(
	g$job
=="")

40 
$wšt™Ë
 = "è‡ªå®šä¹‰è¡¨å•ç®¡ç†-åˆ é™¤è‡ªå®šä¹‰è¡¨å•";

41 
	g$wecome_šfo
 = "<a href='diy_main.php'>è‡ªå®šä¹‰è¡¨å•ç®¡ç†</a>::åˆ é™¤è‡ªå®šä¹‰è¡¨å•";

42 
	g$wš
 = 
Ãw
 
OxWšdow
();

43 
	g$wš
->
In™
("diy_edit.php", "js/blank.js", "POST");

44 
	g$wš
->
AddHidd’
("job", "yes");

45 
	g$wš
->
AddHidd’
("dİo¡", 
$dİo¡
);

46 
	g$wš
->
AddHidd’
("diyid", 
$diyid
);

47 
	g$wš
->
AddT™Ë
("ï¼å°†åˆ é™¤æ‰€æœ‰ä¸è¯¥è‡ªå®šä¹‰è¡¨å•ç›¸å…³çš„æ–‡ä»¶å’Œæ•°æ®<b¸/>ä½ ç¡®å®è¦åˆ é™¤ \"".
$row
['name']."\" è¿™ä¸ªè‡ªå®šä¹‰è¡¨å•ï¼Ÿ");

48 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

49 
	g$wš
->
Di¥Ïy
();

50 
ex™
();

54 if(
	g$job
=="yes")

56 
$row
 = 
$dsql
->
G‘OÃ
("SELECT `bË` FROM `#@__diyfÜms` WHERE diyid='$diyid'",
MYSQL_ASSOC
);

57 if(!
is_¬¿y
(
$row
))

59 
ShowMsg
("ä½ æ‰€æŒ‡å®šçš„è‡ªå®šä¹‰è¡¨å•ä¿¡æ¯ä¸å­˜åœ¨!","-1");

60 
ex™
();

64 
	g$dsql
->
Execu‹NÚeQu”y
("DROP TABLE IF EXISTS `{$row['table']}`;");

67 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__diyforms` WHERE diyid='$diyid'");

68 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªè‡ªå®šä¹‰è¡¨å•ï¼","diy_main.php");

69 
ex™
();

76 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * From #@__diyforms where diyid='$diyid'");

77 
šşude
 
	gXAKADMIN
."/templets/diy_edit.htm";

	@E:\web\weixun\xakadmin\diy_field_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

10 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_admin_channel.php');

11 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

13 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

14 
	g$mysql_v”siÚs
 = 
ex¶ode
(".",
Œim
(
$mysql_v”siÚ
));

15 
	g$mysql_v”siÚ
 = 
$mysql_v”siÚs
[0].".".$mysql_versions[1];

19 if(
	g$aùiÚ
=='save')

22 
$f›ldÇme
 = 
¡¹Şow”
($fieldname);

23 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `table`,`info` FROM #@__diyforms WHERE diyid='$diyid'");

24 
	g$f›ld£t
 = 
$row
['info'];

25 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

26 
	g$d
 = 
Ãw
 
XakTagP¬£
();

27 
	g$d
->
S‘NameS·û
("field","<",">");

28 
	g$d
->
LßdSourû
(
$f›ld£t
);

29 
	g$ŒueTabË
 = 
$row
['table'];

32 
	g$dfv®ue
 = 
Œim
(
$vdeçuÉ
);

33 
	g$i¢uÎ
 = (
$i¢uÎ
==1 ? "true" : "false");

34 
	g$mxËn
 = 
$maxËngth
;

37 
	g$f›ldšfos
 = 
G‘F›ldMake
(
$dty³
,
$f›ldÇme
,
$dfv®ue
,
$mxËn
);

38 
	g$Áabsql
 = 
$f›ldšfos
[0];

39 
	g$buideTy³
 = 
$f›ldšfos
[1];

41 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(" ALTER TABLE `$trueTable` ADD $ntabsql ");

43 if(!
	g$rs
)

45 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

46 
ShowMsg
("å¢åŠ å­—æ®µå¤±è´¥ï¼Œé”™è¯¯æç¤ºä¸ºï¼š".
$g”r
,"javascript:;");

47 
ex™
();

49 
	g$ok
 = 
FALSE
;

52 if(
is_¬¿y
(
$d
->
CTags
))

55 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

57 if(
$f›ldÇme
 =ğ
¡¹Şow”
(
$ùag
->
G‘Name
()))

59 
$d
->
Assign
(
$gid
,
¡r¦ashes
(
$f›ld¡ršg
), 
FALSE
);

60 
	g$ok
 = 
TRUE
;

64 
	g$ok£‰šg
 = 
$ok
 ? 
$d
->
G‘ResuÉNP
(è: 
$f›ld£t
."\n".
¡r¦ashes
(
$f›ld¡ršg
);

69 
	g$ok£‰šg
 = 
$f›ld£t
."\n".
¡r¦ashes
(
$f›ld¡ršg
);

71 
	g$addli¡
 = 
G‘AddF›ldLi¡
(
$d
,
$ok£‰šg
);

72 
	g$ok£‰šg
 = 
add¦ashes
(
$ok£‰šg
);

73 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("Update #@__diyforms set `info`='$oksetting' where diyid='$diyid' ");

74 if(!
	g$rs
)

76 
	g$g¼
 = 
$dsql
->
G‘E¼Ü
();

77 
ShowMsg
("ä¿å­˜èŠ‚ç‚¹é…ç½®å‡ºé”™ï¼".
$g¼
,"javascript:;");

78 
ex™
();

80 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªå­—æ®µï¼","diy_edit.php?diyid=$diyid");

81 
ex™
();

88 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `table` FROM #@__diyforms WHERE diyid='$diyid'");

89 
	g$ŒueTabË
 = 
$row
['table'];

90 
	g$bsql
 = "CREATE TABLE IF NOT EXISTS `$trueTable`(

91 `
id
` (10è
NOT
 
NULL
 
auto_šüem’t
,

92 `
ifcheck
` 
	$tšyšt
(1è
NOT
 
NULL
  '0',

94 if(
$mysql_v”siÚ
 < 4.1)

96 
$bsql
 .= " PRIMARY KEY (`id`)\r\n) TYPE=MyISAM; ";

97 
	}
}

100 
	g$bsql
 .ğ" PRIMARY KEY (`id`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

102 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

105 
	g$f›lds
 = 
¬¿y
();

106 
	g$rs
 = 
$dsql
->
S‘Qu”y
("show fields from `$trueTable`");

107 
	g$dsql
->
Execu‹
('a');

108 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('a',
MYSQL_ASSOC
))

110 
	g$f›lds
[
¡¹Şow”
(
$Äow
['Field'])] = 1;

112 
	g$f
 = '';

113 
fÜ—ch
(
$f›lds
 
as
 
$k
=>
$v
)

115 
$f
 .ğ($f=='' ? 
$k
 : ' '.$k);

117 
»quœe_Úû
(
XAKADMIN
."/templets/diy_field_add.htm");

	@E:\web\weixun\xakadmin\diy_field_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

11 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

12 
»quœe_Úû
(
XAKADMIN
."/inc/inc_admin_channel.php");

13 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

16 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

17 
	g$mysql_v”siÚs
 = 
ex¶ode
(".",
Œim
(
$mysql_v”siÚ
));

18 
	g$mysql_v”siÚ
 = 
$mysql_v”siÚs
[0].".".$mysql_versions[1];

19 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `table`,`info` FROM #@__diyforms WHERE diyid='$diyid'");

20 
	g$f›ld£t
 = 
$row
['info'];

21 
	g$ŒueTabË
 = 
$row
['table'];

22 
	g$d
 = 
Ãw
 
XakTagP¬£
();

23 
	g$d
->
S‘NameS·û
("field","<",">");

24 
	g$d
->
LßdSourû
(
$f›ld£t
);

25 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

27 if(
¡¹Şow”
(
$ùag
->
G‘Name
())==¡¹Şow”(
$âame
)) ;

31 
	g$ds
 = 
fe
(
XAKADMIN
."/inc/fieldtype.txt");

32 
	$fÜ—ch
(
$ds
 
as
 
$d
)

34 
$dds
 = 
	`ex¶ode
(',',
	`Œim
(
$d
));

35 
$f›ldty³s
[
$dds
[0]] = $dds[1];

36 
	}
}

42 if(
	g$aùiÚ
=='save')

45 if(!
is£t
(
$f›ldty³s
[
$dty³
]))

47 
ShowMsg
("ä½ ä¿®æ”¹çš„æ˜¯ç³»ç»Ÿä¸“ç”¨ç±»å‹çš„æ•°æ®ï¼Œç¦æ­¢æ“ä½œï¼","-1");

48 
ex™
();

52 
	g$bsql
 = "CREATE TABLE IF NOT EXISTS `$trueTable`(

53 `
id
` (10è
NOT
 
NULL
 
auto_šüem’t
,

54 `
	gifcheck
` 
tšyšt
(1è
NOT
 
NULL
  '0',

56 if(
	g$mysql_v”siÚ
 < 4.1)

58 
	g$bsql
 .= " PRIMARY KEY (`id`)\r\n) TYPE=MyISAM; ";

62 
	g$bsql
 .ğ" PRIMARY KEY (`id`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

64 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

67 
	g$f›lds
 = 
¬¿y
();

68 
	g$rs
 = 
$dsql
->
S‘Qu”y
("show fields from `$trueTable`");

69 
	g$dsql
->
Execu‹
('a');

70 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('a',
MYSQL_ASSOC
))

72 
	g$f›lds
[ 
¡¹Şow”
(
$Äow
['Field']) ] = $nrow['Type'];

76 
	g$dfv®ue
 = 
$vdeçuÉ
;

77 
	g$i¢uÎ
 = (
$i¢uÎ
==1 ? "true" : "false");

78 
	g$mxËn
 = 
$maxËngth
;

79 
	g$f›ldÇme
 = 
¡¹Şow”
(
$âame
);

82 
	g$f›ldšfos
 = 
G‘F›ldMake
(
$dty³
,
$f›ldÇme
,
$dfv®ue
,
$mxËn
);

83 
	g$Áabsql
 = 
$f›ldšfos
[0];

84 
	g$buideTy³
 = 
$f›ldšfos
[1];

85 
	g$bsql
 = '';

88 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

90 if(
Œim
(
$f›ldÇme
)=ñrim(
¡¹Şow”
(
$ùag
->
G‘Name
())))

93 if(
is£t
(
$f›lds
[
$f›ldÇme
]è&& $f›lds[$f›ldÇme]!=
$buideTy³
)

95 
$bsql
 = "ALTER TABLE `$ŒueTabË` CHANGE `$f›ldÇme` ".
$Áabsql
;

96 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

98 if(!
is£t
(
$f›lds
[
$f›ldÇme
]))

100 
	g$bsql
 = "ALTER TABLE `$ŒueTabË` ADD ".
$Áabsql
;

101 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

105 
	g$bsql
 = '';

107 
	g$d
->
Assign
(
$gid
,
¡r¦ashes
(
$f›ld¡ršg
), 
FALSE
);

111 
	g$ok£‰šg
 = 
$d
->
G‘ResuÉNP
();

112 
	g$ok£‰šg
 = 
add¦ashes
(
$ok£‰šg
);

113 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__diyforms SET info='$oksetting' WHERE diyid='$diyid' ");

114 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªå­—æ®µçš„é…ç½®ï¼","diy_edit.php?diyid={$diyid}");

115 
ex™
();

121 if(
	g$aùiÚ
=="delete")

124 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

126 if(
¡¹Şow”
(
$ùag
->
G‘Name
())==¡¹Şow”(
$âame
))

128 
$d
->
Assign
(
$gid
,"#@Delete@#");

131 
	g$ok£‰šg
 = 
add¦ashes
(
$d
->
G‘ResuÉNP
());

132 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__diyforms SET info='$oksetting' WHERE diyid='$diyid' ");

133 
	g$dsql
->
Execu‹NÚeQu”y
("ALTER TABLE `$trueTable` DROP `$fname` ");

134 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªå­—æ®µï¼","diy_edit.php?diyid=$diyid");

135 
ex™
();

137 
»quœe_Úû
(
XAKADMIN
."/templets/diy_field_edit.htm");

	@E:\web\weixun\xakadmin\diy_list.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_New');

9 
	g$diyid
 = 
is£t
(
$diyid
è&& 
is_num”ic
($diyid) ? $diyid : 0;

10 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è&& 
š_¬¿y
($aùiÚ, 
¬¿y
('post', 'list', 'edit', 'check', 'delete')) ? $action : '';

11 if(
	$em±y
(
$diyid
))

13 
	`showMsg
("éæ³•æ“ä½œ!", 'javascript:;');

14 
	`ex™
();

15 
	}
}

16 
»quœe_Úû
 
	gXAKINC
.'/diyform.cls.php';

17 
	g$diy
 = 
Ãw
 
diyfÜm
(
$diyid
);

18 if(
	g$aùiÚ
 == 'post')

20 if(
em±y
(
$do
))

22 
$po¡fÜm
 = 
$diy
->
g‘FÜm
('post','','admin');

23 
šşude
 
	gXAKADMIN
.'/templets/diy_post.htm';

25 if(
	g$do
 == 2)

27 
$xak_f›lds
 = 
em±y
($xak_f›ldsè? '' : 
Œim
($xak_fields);

28 
	g$xak_f›ldshash
 = 
em±y
(
$xak_f›ldshash
è? '' : 
Œim
($xak_fieldshash);

29 if(!
em±y
(
$xak_f›lds
))

31 if(
	g$xak_f›ldshash
 !ğ
md5
(
$xak_f›lds
.
$cfg_cook›_’code
))

33 
showMsg
("æ•°æ®æ ¡éªŒä¸å¯¹ï¼Œç¨‹åºè¿”å›", '-1');

34 
ex™
();

37 
	g$diyfÜm
 = 
$dsql
->
g‘OÃ
("SELECT * FROM #@__diyforms WHERE diyid=$diyid");

38 if(!
is_¬¿y
(
$diyfÜm
))

40 
showmsg
("è‡ªå®šä¹‰è¡¨å•ä¸å­˜åœ¨", '-1');

41 
ex™
();

43 
	g$addv¬
 = 
$addv®ue
 = '';

44 if(!
em±y
(
$xak_f›lds
))

46 
	g$f›ld¬r
 = 
ex¶ode
(';', 
$xak_f›lds
);

47 if(
is_¬¿y
(
$f›ld¬r
))

49 
fÜ—ch
(
$f›ld¬r
 
as
 
$f›ld
)

51 if(
	g$f›ld
 == '')

55 
	g$f›ldšfo
 = 
ex¶ode
(',', 
$f›ld
);

56 if(
	g$f›ldšfo
[1] =ğ'htmÉext' || 
$f›ldšfo
[1] == 'textdata')

58 
$
{
$f›ldšfo
[0]} = 
f‹rsüt
(
¡r¦ashes
(${$fieldinfo[0]}));

59 
	g$
{
	g$f›ldšfo
[0]} = 
add¦ashes
(
$
{
$f›ldšfo
[0]});

60 
	g$
{
	g$f›ldšfo
[0]} = 
g‘F›ldV®ue
(
$
{
$f›ldšfo
[0]}, $fieldinfo[1],0,'add','','member');

64 
	g$
{
	g$f›ldšfo
[0]} = 
g‘F›ldV®ue
(
$
{
$f›ldšfo
[0]}, $fieldinfo[1],0,'add','','member');

66 
	g$addv¬
 .ğ', `'.
$f›ldšfo
[0].'`';

67 
	g$addv®ue
 .ğ", '".
$
{
$f›ldšfo
[0]}."'";

71 
	g$qu”y
 = "INSERT INTO `{$diy->table}` (`id`, `ifcheck` $addvar) VALUES (NULL, 0 $addvalue)";

72 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

74 
	g$gÙo
 = "diy_list.php?action=list&diyid={$diy->diyid}";

75 
showmsg
('å‘å¸ƒæˆåŠŸ', 
$gÙo
);

79 
showmsg
('å¯¹ä¸èµ·ï¼Œå‘å¸ƒä¸æˆåŠŸ', '-1');

82 } ià(
	g$aùiÚ
 == 'list')

84 
šşude_Úû
 
XAKINC
.'/datalistcp.class.php';

85 
	g$qu”y
 = "SELECT * FROM {$diy->table} ORDER BY id DESC";

86 
	g$d©®i¡
 = 
Ãw
 
D©aLi¡CP
();

87 
	g$d©®i¡
->
	g·geSize
 = 10;

88 
	g$d©®i¡
->
S‘P¬am‘”
('action', 'list');

89 
	g$d©®i¡
->
S‘P¬am‘”
('diyid', 
$diyid
);

90 
	g$d©®i¡
->
S‘Tem¶©e
(
XAKADMIN
.'/templets/diy_list.htm');

91 
	g$d©®i¡
->
S‘Sourû
(
$qu”y
);

92 
	g$f›ldli¡
 = 
$diy
->
g‘F›ldLi¡
();

93 
	g$d©®i¡
->
Di¥Ïy
();

94 } ià(
	g$aùiÚ
 == 'edit')

96 if(
em±y
(
$do
))

98 
$id
 = 
is£t
($idè&& 
is_num”ic
($id) ? $id : 0;

99 if(
em±y
(
$id
))

101 
showMsg
('éæ³•æ“ä½œï¼æœªæŒ‡å®šid', 'javascript:;');

102 
ex™
();

104 
	g$qu”y
 = "SELECT * FROM {$diy->table} WHERE id=$id";

105 
	g$row
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

106 if(!
is_¬¿y
(
$row
))

108 
showmsg
("ä½ è®¿é—®çš„è®°å½•ä¸å­˜åœ¨æˆ–æœªç»å®¡æ ¸", '-1');

109 
ex™
();

111 
	g$po¡fÜm
 = 
$diy
->
g‘FÜm
('ed™', 
$row
, 'admin');

112 
	g$f›ldli¡
 = 
$diy
->
g‘F›ldLi¡
();

113 
	g$c1
 = 
$row
['ifcheck'] == 1 ? 'checked' : '';

114 
	g$c2
 = 
$row
['ifcheck'] == 0 ? 'checked' : '';

115 
šşude
 
	gXAKADMIN
.'/templets/diy_edit_content.htm';

117 if(
	g$do
 == 2)

119 
$xak_f›lds
 = 
em±y
($xak_f›ldsè? '' : 
Œim
($xak_fields);

120 
	g$diyfÜm
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__diyforms WHERE diyid=$diyid");

121 
	g$diyco
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `$diy->table` WHERE id='$id'");

122 if(!
is_¬¿y
(
$diyfÜm
))

124 
showmsg
("è‡ªå®šä¹‰è¡¨å•ä¸å­˜åœ¨", '-1');

125 
ex™
();

127 
	g$addsql
 = '';

128 if(!
em±y
(
$xak_f›lds
))

130 
	g$f›ld¬r
 = 
ex¶ode
(';', 
$xak_f›lds
);

131 if(
is_¬¿y
(
$f›ld¬r
))

133 
fÜ—ch
(
$f›ld¬r
 
as
 
$f›ld
)

135 if(
	g$f›ld
 == '')

139 
	g$f›ldšfo
 = 
ex¶ode
(',', 
$f›ld
);

140 if(
	g$f›ldšfo
[1] =ğ'htmÉext' || 
$f›ldšfo
[1] == 'textdata')

142 
$
{
$f›ldšfo
[0]} = 
f‹rsüt
(
¡r¦ashes
(${$fieldinfo[0]}));

143 
	g$
{
	g$f›ldšfo
[0]} = 
add¦ashes
(
$
{
$f›ldšfo
[0]});

144 
	g$
{
	g$f›ldšfo
[0]} = 
G‘F›ldV®ue
(
$
{
$f›ldšfo
[0]}, $fieldinfo[1],0,'add','','member');

145 
	g$
{
	g$f›ldšfo
[0]} = 
em±y
(
$
{
$f›ldšfo
[0]}è? 
$diyco
[$fieldinfo[0]] : ${$fieldinfo[0]};

150 
	g$
{
	g$f›ldšfo
[0]} = 
G‘F›ldV®ue
(
$
{
$f›ldšfo
[0]}, $fieldinfo[1],0,'add','','diy', $fieldinfo[0]);

151 
	g$
{
	g$f›ldšfo
[0]} = 
em±y
(
$
{
$f›ldšfo
[0]}è? 
$diyco
[$fieldinfo[0]] : ${$fieldinfo[0]};

153 
	g$addsql
 .ğ!
em±y
(
$addsql
)?',`'.
$f›ldšfo
[0]."`='".
$
{$fieldinfo[0]}."'" : '`'.$fieldinfo[0]."`='".${$fieldinfo[0]}."'";

157 
	g$qu”y
 = "UPDATE `$diy->table` SET $addsql WHERE id=$id";

158 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

160 
	g$gÙo
 = "diy_list.php?action=list&diyid={$diy->diyid}";

161 
showmsg
('ç¼–è¾‘æˆåŠŸ', 
$gÙo
);

165 
showmsg
('ç¼–è¾‘æˆåŠŸ', '-1');

168 }
–£if
(
$aùiÚ
 == 'check')

170 if(
is_¬¿y
(
$id
))

172 
$ids
 = 
im¶ode
(',', 
$id
);

176 
showmsg
('æœªé€‰ä¸­è¦æ“ä½œçš„å†…å®¹', '-1');

177 
ex™
();

179 
	g$qu”y
 = "UPDATE `$diy->table` SET ifcheck=1 WHERE id IN ($ids)";

180 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

182 
showmsg
('å®¡æ ¸æˆåŠŸ', "diy_list.php?action=list&diyid={$diy->diyid}");

186 
showmsg
('å®¡æ ¸å¤±è´¥', "diy_list.php?action=list&diyid={$diy->diyid}");

188 }
–£if
(
$aùiÚ
 == 'delete')

190 if(
em±y
(
$do
))

192 if(
is_¬¿y
(
$id
))

194 
$ids
 = 
im¶ode
(',', 
$id
);

197 
showmsg
('æœªé€‰ä¸­è¦æ“ä½œçš„å†…å®¹', '-1');

198 
ex™
();

200 
	g$qu”y
 = "DELETE FROM `$diy->table` WHERE id IN ($ids)";

201 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

203 
showmsg
('åˆ é™¤æˆåŠŸ', "diy_list.php?action=list&diyid={$diy->diyid}");

207 
showmsg
('åˆ é™¤å¤±è´¥', "diy_list.php?action=list&diyid={$diy->diyid}");

209 } if(
	g$do
=1){

210 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `$diy->table` WHERE id='$id'");

211 if(
fe_exi¡s
(
$cfg_ba£dœ
.
$row
[
$Çme
])){

212 
uÆšk
(
$cfg_ba£dœ
.
$row
[
$Çme
]);

213 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `$diy->table` SET $name='' WHERE id='$id'");

214 
showmsg
('æ–‡ä»¶åˆ é™¤æˆåŠŸ',"diy_list.php?action=list&diyid={$diy->diyid}");

216 
showmsg
('æ–‡ä»¶ä¸å­˜åœ¨','-1');

221 
showmsg
('æœªå®šä¹‰æ“ä½œ', "-1");

	@E:\web\weixun\xakadmin\diy_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_List');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
»quœe_Úû
(
XAKINC
."/common.func.php");

11 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$sql
 = "Select `diyid`,`name`,`table` From #@__diyforms order by diyid‡sc";

13 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

14 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/diy_main.htm");

15 
	g$dli¡
->
S‘Sourû
(
$sql
);

16 
	g$dli¡
->
di¥Ïy
();

17 
	g$dli¡
->
Clo£
();

	@E:\web\weixun\xakadmin\erraddsave.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

9 
»quœe_Úû
(
XAKINC
.'/common.func.php');

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 ='';

12 if(
em±y
(
$fmdo
)è
	g$fmdo
 = '';

14 
funùiÚ
 
	$u£ºame
(
$mid
)

16 
glob®
 
$dsql
;

17 if(!
	`is£t
(
$mid
è|| 
	`em±y
($mid))

20 
	`ex™
();

24 
$sql
 = "SELECT uname FROM `#@__member_list` WHERE `mid` = '$mid'";

25 
$row
 = 
$dsql
->
	`G‘OÃ
(
$sql
);

26  
$row
['uname'];

27 
	`ex™
();

29 
	`ex™
();

30 
	}
}

32 
funùiÚ
 
	$ty³Çme
(
$me
)

34 
$me
)

36 
$me
 == 1:

37  
$me
 = "é”™åˆ«å­—";

39 
$me
 == 2:

40  
$me
 = "æˆè¯­è¿ç”¨ä¸å½“";

42 
$me
 == 3:

43  
$me
 = "ä¸“ä¸šæœ¯è¯­å†™æ³•ä¸è§„åˆ™";

45 
$me
 == 4:

46  
$me
 = "äº§å“ä¸å›¾ç‰‡ä¸ç¬¦";

48 
$me
 == 5:

49  
$me
 = "äº‹å®å¹´ä»£ä»¥åŠå†…å®¹é”™è¯¯";

51 
$me
 == 6:

52  
$me
 = "äº‹å®å¹´ä»£ä»¥åŠå†…å®¹é”™è¯¯";

54 
$me
 == 7:

55  
$me
 = "å…¶ä»–é”™è¯¯";

58  
$me
 = "æœªçŸ¥é”™è¯¯";

61 
	}
}

63 if(
	g$dİo¡
 == "delete")

65 if(
$id
=='')

67 
ShowMsg
("å‚æ•°æ— æ•ˆï¼","-1");

68 
ex™
();

72 if(
	g$fmdo
=='yes')

74 
$id
 = 
ex¶ode
("`", $id);

75 
fÜ—ch
 (
$id
 
as
 
$v¬
)

77 
	g$qu”y
 = "DELETE FROM `#@__erradd` WHERE `id` = '$var'";

78 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

80 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„æ–‡æ¡£ï¼","erraddsave.php");

81 
ex™
();

85 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

86 
	g$wšt™Ë
 = "åˆ é™¤";

87 
	g$wecome_šfo
 = "<a href='erraddsave.php'>é”™è¯¯ç®¡ç†</a>::åˆ é™¤é”™è¯¯";

88 
	g$wš
 = 
Ãw
 
OxWšdow
();

89 
	g$wš
->
In™
("erraddsave.php","js/blank.js","POST");

90 
	g$wš
->
AddHidd’
("fmdo","yes");

91 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

92 
	g$wš
->
AddHidd’
("id",
$id
);

93 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦åˆ é™¤â€œ $id â€è¿™äº›é”™è¯¯æç¤ºï¼Ÿ");

94 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

95 
	g$wš
->
Di¥Ïy
();

96 
ex™
();

98 
ex™
();

101 
	g$sql
 = "SELECT * FROM `#@__erradd`";

102 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

103 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/erradd.htm");

104 
	g$dli¡
->
S‘Sourû
(
$sql
);

105 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\exit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/../functions/common.inc.php');

8 
»quœe_Úû
(
XAKINC
.'/userlogin.class.php');

9 
	g$cu£rLogš
 = 
Ãw
 
u£rLogš
();

10 
	g$cu£rLogš
->
ex™U£r
();

11 if(
	$em±y
(
$Ãedşo£
))

13 
$msg
 = "<script†anguage='javascript'>window.top.location.href='login.php';</script>";

14 
echo
 
$msg
;

15 
ex™
;

17 
	}
}

20 
	g$msg
 = "<script†anguage='javascript'>

21 if(
docum’t
.
®l
è
wšdow
.
İ’”
=
Œue
;

22 
	gwšdow
.
şo£
();

23 </
	gsüt
>";

24 
echo
 
	g$msg
;

25 
	gex™
;

	@E:\web\weixun\xakadmin\feedback_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Feedback');

9 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

10 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL'])? "feedback_main.php" : $_COOKIE['ENV_GOBACK_URL'];

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

13 if(
	g$dİo¡
=='edit')

15 
$msg
 = 
ú_sub¡rR
($msg, 3500);

16 
	g$admšmsg
 = 
Œim
(
$admšmsg
);

17 if(
	g$admšmsg
!="")

19 
$admšmsg
 = 
ú_sub¡rR
($adminmsg, 1500);

20 
	g$admšmsg
 = 
¡r_»¶aû
("<","&É;", 
$admšmsg
);

21 
	g$admšmsg
 = 
¡r_»¶aû
(">","&gt;", 
$admšmsg
);

22 
	g$admšmsg
 = 
¡r_»¶aû
(" ","&nb¥;&nb¥;", 
$admšmsg
);

23 
	g$admšmsg
 = 
¡r_»¶aû
("\r\n","<br/>\n", 
$admšmsg
);

24 
	g$msg
 = 
$msg
."<br/>\n"."<font color=red>ç®¡ç†å‘˜å›å¤ï¼š $adminmsg</font>\n";

26 
	g$qu”y
 = "UPDATE `#@__feedback` SET username='$username',msg='$msg',ischeck=1 WHERE id=$id";

27 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

28 
ShowMsg
("æˆåŠŸå›å¤ä¸€åˆ™ç•™è¨€ï¼",
$ENV_GOBACK_URL
);

29 
ex™
();

31 
	g$qu”y
 = "SELECT * FROM `#@__feedback` WHERE id=$id";

32 
	g$row
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

33 
šşude
 
XAKINClude
('templets/feedback_edit.htm');

	@E:\web\weixun\xakadmin\feedback_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

10 
CheckPurv›w
('sys_Feedback');

11 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

12 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

13 
£tcook›
("ENV_GOBACK_URL", 
$xakNowu¾
, 
time
()+3600, "/");

15 
funùiÚ
 
	$IsCheck
(
$¡
)

17  
$¡
==1 ? "[å·²å®¡æ ¸]" : "<font color='red'>[æœªå®¡æ ¸]</font>";

18 
	}
}

20 
funùiÚ
 
	$jsTrimjajx
(
$¡r
,
$Ën
)

22 
$¡r
 = 
	`´eg_»¶aû
("/{quote}(.*){\/quote}/is",'',$str);

23 
$¡r
 = 
	`¡r_»¶aû
('&lt;br/&gt;',' ',$str);

24 
$¡r
 = 
	`ú_sub¡r
($¡r,
$Ën
);

25 
$¡r
 = 
	`´eg_»¶aû
("/['\"\r\n]/","",$str);

26 
$¡r
 = 
	`¡r_»¶aû
('&lt;', '<', $str);

27 
$¡r
 = 
	`¡r_»¶aû
('&gt;', '>', $str);

28  
$¡r
;

29 
	}
}

31 if(!
	$em±y
(
$job
))

33 
$ids
 = 
	`´eg_»¶aû
("#[^0-9,]#", '', 
$fid
);

34 if(
	`em±y
(
$ids
))

36 
	`ShowMsg
("ä½ æ²¡é€‰ä¸­ä»»ä½•é€‰é¡¹ï¼",
$_COOKIE
['ENV_GOBACK_URL'],0,500);

37 
ex™
;

39 
	}
}

42 
	g$job
 = '';

46 ifĞ
	g$job
 == 'del' )

48 
$qu”y
 = "DELETE FROM `#@__feedback` WHERE id IN($ids) ";

49 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

50 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„è¯„è®º!",
$_COOKIE
['ENV_GOBACK_URL'],0,500);

51 
ex™
();

54 ifĞ
	g$job
 == 'delall' )

56 
$dsql
->
S‘Qu”y
("SELECT ip FROM `#@__feedback` WHERE id IN ($ids) ");

57 
	g$dsql
->
Execu‹
();

58 
	g$s
 = '';

59 
	g$row
 = 
$dsql
->
G‘A¼ay
())

61 
$s
 .= ($ips=='' ? " ip = '{$row['ip']}' " : " Or ip = '{$row['ip']}' ");

63 if(
	g$s
!='')

65 
$qu”y
 = "DELETE FROM `#@__feedback` WHERE $ips ";

66 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

68 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šç›¸åŒIPçš„æ‰€æœ‰è¯„è®º!",
$_COOKIE
['ENV_GOBACK_URL'],0,500);

69 
ex™
();

72 if(
	g$job
=='check')

74 
$qu”y
 = "UPDATE `#@__feedback` SET ischeck=1 WHERE id IN($ids) ";

75 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

76 
ShowMsg
("æˆåŠŸå®¡æ ¸æŒ‡å®šè¯„è®º!", 
$_COOKIE
['ENV_GOBACK_URL'], 0, 500);

77 
ex™
();

82 
	g$bgcŞÜ
 = '';

83 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

84 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

85 
	g$keywÜd
 = !
is£t
(
$keywÜd
) ? '' : $keyword;

86 
	g$
 = !
is£t
(
$
) ? '' : $ip;

88 
	g$
 = 
Ãw
 
Ty³Lšk
(
$ty³id
);

89 
	g$İ’¬¿y
 = 
$
->
G‘O±iÚA¼ay
(
$ty³id
,
$admš_ÿlogs
,0);

91 
	g$addsql
 = (
$ty³id
 !ğ0 ? " Andy³id IN (".
G‘SÚIds
($typeid).")" : '');

92 
	g$addsql
 .ğ(
$aid
 != 0 ? " And‡id=$aid " : '');

93 
	g$addsql
 .ğ(
$
 != '' ? " And ip LIKE '$ip' " : '');

94 
	g$qu”y¡ršg
 = "SELECT * FROM `#@__feedback` WHERE msg LIKE '%$keyword%' $addsql ORDER BY dtime DESC";

96 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

97 
	g$dli¡
->
	g·geSize
 = 15;

98 
	g$dli¡
->
S‘P¬am‘”
('aid', 
$aid
);

99 
	g$dli¡
->
S‘P¬am‘”
('', 
$
);

100 
	g$dli¡
->
S‘P¬am‘”
('ty³id', 
$ty³id
);

101 
	g$dli¡
->
S‘P¬am‘”
('keywÜd', 
$keywÜd
);

102 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
.'/templets/feedback_main.htm');

103 
	g$dli¡
->
S‘Sourû
(
$qu”y¡ršg
);

104 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\file_class.php

1 <?
php
 if(!
defšed
('XAKINC')è
ex™
('Warning...');

7 şas 
	cFeMªagem’t


9 
v¬
 
	m$ba£Dœ
="";

10 
v¬
 
	m$aùiveDœ
="";

14 
v¬
 
	m$®lowD–‘eDœ
=0;

17 
funùiÚ
 
	$In™
()

19 
glob®
 
$cfg_ba£dœ
, 
$aùiv•©h
;

20 
$this
->
ba£Dœ
 = 
$cfg_ba£dœ
;

21 
$this
->
aùiveDœ
 = 
$aùiv•©h
;

25 
funùiÚ
 
	$R’ameFe
(
$ŞdÇme
,
$ÃwÇme
)

27 
$ŞdÇme
 = 
$this
->
ba£Dœ
.$this->
aùiveDœ
."/".$oldname;

28 
$ÃwÇme
 = 
$this
->
ba£Dœ
.$this->
aùiveDœ
."/".$newname;

29 if((
$ÃwÇme
!=
$ŞdÇme
è&& 
	`is_wr™abË
($oldname))

31 
	`»Çme
(
$ŞdÇme
,
$ÃwÇme
);

33 
	`ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªæ–‡ä»¶åï¼","fe_mªage_maš.php?aùiv•©h=".
$this
->
aùiveDœ
);

35 
	}
}

38 
funùiÚ
 
	$NewDœ
(
$dœÇme
)

40 
$Ãwdœ
 = 
$dœÇme
;

41 
$dœÇme
 = 
$this
->
ba£Dœ
.$this->
aùiveDœ
."/".$dirname;

42 if(
	`is_wr™abË
(
$this
->
ba£Dœ
.$this->
aùiveDœ
))

44 
	`MkdœAÎ
(
$dœÇme
,
$GLOBALS
['cfg_dir_purview']);

45 
	`Clo£F
();

46 
	`ShowMsg
("æˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼","fe_mªage_maš.php?aùiv•©h=".
$this
->
aùiveDœ
."/".
$Ãwdœ
);

51 
	`ShowMsg
("åˆ›å»ºæ–°ç›®å½•å¤±è´¥ï¼Œå› ä¸ºè¿™ä¸ªä½ç½®ä¸å…è®¸å†™å…¥ï¼","fe_mªage_maš.php?aùiv•©h=".
$this
->
aùiveDœ
);

54 
	}
}

64 
funùiÚ
 
	$MoveFe
(
$mfe
, 
$m·th
)

66 if(
$m·th
!="" && !
	`´eg_m©ch
("#\.\.#", $mpath))

68 
$Şdfe
 = 
$this
->
ba£Dœ
.$this->
aùiveDœ
."/$mfile";

69 
$m·th
 = 
	`¡r_»¶aû
("\\","/",$mpath);

70 
$m·th
 = 
	`´eg_»¶aû
("#\/{1,}#", "/", $mpath);

71 if(!
	`´eg_m©ch
("#^/#", 
$m·th
))

73 
$m·th
 = 
$this
->
aùiveDœ
."/".$mpath;

75 
$Œu•©h
 = 
$this
->
ba£Dœ
.
$m·th
;

76 if(
	`is_»adabË
(
$Şdfe
è&& is_»adabË(
$Œu•©h
è&& 
	`is_wr™abË
($truepath))

78 if(
	`is_dœ
(
$Œu•©h
))

80 
	`cİy
(
$Şdfe
, 
$Œu•©h
."/$mfile");

84 
	`MkdœAÎ
(
$Œu•©h
, 
$GLOBALS
['cfg_dir_purview']);

85 
	`Clo£F
();

86 
	`cİy
(
$Şdfe
,
$Œu•©h
."/$mfile");

88 
	`uÆšk
(
$Şdfe
);

89 
	`ShowMsg
("æˆåŠŸç§»åŠ¨æ–‡ä»¶ï¼","file_manage_main.php?activepath=$mpath",0,1000);

94 
	`ShowMsg
("ç§»åŠ¨æ–‡ä»¶ $oldfile -&gt; $truepath/$mfile å¤±è´¥ï¼Œå¯èƒ½æ˜¯æŸä¸ªä½ç½®æƒé™ä¸è¶³ï¼","file_manage_main.php?activepath=$mpath",0,1000);

100 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ ç§»åŠ¨çš„è·¯å¾„ä¸åˆæ³•ï¼","-1",0,5000);

103 
	}
}

110 
funùiÚ
 
	$RmDœFes
(
$šdœ
)

112 if(!
	`is_dœ
(
$šdœ
))

116 
$dh
 = 
	`dœ
(
$šdœ
);

117 
$f’ame
 = 
$dh
->
	`»ad
())

119 if(
$f’ame
 == "." || $filename == "..")

123 if(
	`is_fe
("$indir/$filename"))

125 @
	`uÆšk
("$indir/$filename");

129 
$this
->
	`RmDœFes
("$indir/$filename");

132 
$dh
->
	`şo£
();

133 @
	`rmdœ
(
$šdœ
);

134 
	}
}

143 
funùiÚ
 
	$G‘M©chFes
(
$šdœ
, 
$f“xp
, &
$f—¼
)

145 
$dh
 = 
	`dœ
(
$šdœ
);

146 
$f’ame
 = 
$dh
->
	`»ad
())

148 
$Œuefe
 = 
$šdœ
.'/'.
$f’ame
;

149 if(
$f’ame
 == "." || $filename == "..")

153 if(
	`is_dœ
(
$Œuefe
))

155 
$this
->
	`G‘M©chFes
(
$Œuefe
, 
$f“xp
, 
$f—¼
);

157 if(
	`´eg_m©ch
("/\.(".
$f“xp
.")/i",
$f’ame
))

159 
$f—¼
[] = 
$Œuefe
;

162 
$dh
->
	`şo£
();

163 
	}
}

171 
funùiÚ
 
	$D–‘eFe
(
$f’ame
)

173 
$f’ame
 = 
$this
->
ba£Dœ
.$this->
aùiveDœ
."/$filename";

174 if(
	`is_fe
(
$f’ame
))

176 @
	`uÆšk
(
$f’ame
); 
$t
="æ–‡ä»¶";

180 
$t
 = "ç›®å½•";

181 if(
$this
->
®lowD–‘eDœ
==1)

183 
$this
->
	`RmDœFes
(
$f’ame
);

187 
	`ShowMsg
("ç³»ç»Ÿç¦æ­¢åˆ é™¤".
$t
."ï¼","fe_mªage_maš.php?aùiv•©h=".
$this
->
aùiveDœ
);

188 
ex™
;

192 
	`ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ª".
$t
."ï¼","fe_mªage_maš.php?aùiv•©h=".
$this
->
aùiveDœ
);

194 
	}
}

198 şas 
	cS·ûU£


200 
v¬
 
	m$tÙ®size
=0;

202 
funùiÚ
 
	$checksize
(
$šdœ
)

204 
$dh
=
	`dœ
(
$šdœ
);

205 
$f’ame
=
$dh
->
	`»ad
())

207 if(!
	`´eg_m©ch
("#^\.#", 
$f’ame
))

209 if(
	`is_dœ
("$indir/$filename"))

211 
$this
->
	`checksize
("$indir/$filename");

215 
$this
->
tÙ®size
=$this->tÙ®siz+ 
	`fesize
("$indir/$filename");

221 
funùiÚ
 
	$£tkb
(
$size
)

223 
$size
=$size/1024;

225 if(
$size
>0)

227 
	`li¡
(
$t1
,
$t2
)=
	`ex¶ode
(".",
$size
);

228 
$size
=
$t1
.".".
	`sub¡r
(
$t2
,0,1);

230  
$size
;

231 
	}
}

233 
funùiÚ
 
	$£tmb
(
$size
)

235 
$size
=$size/1024/1024;

236 if(
$size
>0)

238 
	`li¡
(
$t1
,
$t2
)=
	`ex¶ode
(".",
$size
);

239 
$size
=
$t1
.".".
	`sub¡r
(
$t2
,0,2);

241  
$size
;

242 
	}
}

	@E:\web\weixun\xakadmin\file_manage_control.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_æ–‡ä»¶ç®¡ç†å™¨');

9 
»quœe
(
XAKINC
."/oxwindow.class.php");

10 
»quœe_Úû
(
XAKADMIN
.'/file_class.php');

11 
	g$aùiv•©h
 = 
¡r_»¶aû
("..", "", 
$aùiv•©h
);

12 
	g$aùiv•©h
 = 
´eg_»¶aû
("#^\/{1,}#", "/", 
$aùiv•©h
);

13 if(
	g$aùiv•©h
 =ğ"/"è
$aùiv•©h
 = "";

14 if(
	g$aùiv•©h
 =ğ""è
$š·th
 = 
$cfg_ba£dœ
;

15 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

18 
	g$fmm
 = 
Ãw
 
FeMªagem’t
();

19 
	g$fmm
->
In™
();

24 if(
	g$fmdo
=="rename")

26 
$fmm
->
R’ameFe
(
$Şdf’ame
,
$Ãwf’ame
);

34 if(
	g$fmdo
=="newdir")

36 
$fmm
->
NewDœ
(
$Ãw·th
);

44 if(
	g$fmdo
=="move")

46 
$fmm
->
MoveFe
(
$f’ame
,
$Ãw·th
);

54 if(
	g$fmdo
=="del")

56 
$fmm
->
D–‘eFe
(
$f’ame
);

64 if(
	g$fmdo
=="edit")

66 
$f’ame
 = 
¡r_»¶aû
("..", "", $filename);

67 
	g$fe
 = "$cfg_basedir$activepath/$filename";

68 
	g$¡r
 = 
¡r¦ashes
(
$¡r
);

69 
	g$å
 = 
fİ’
(
$fe
, "w");

70 
åuts
(
$å
, 
$¡r
);

71 
fşo£
(
$å
);

72 if(
em±y
(
$backu¾
))

74 
ShowMsg
("æˆåŠŸä¿å­˜ä¸€ä¸ªæ–‡ä»¶ï¼","file_manage_main.php?activepath=$activepath");

78 
ShowMsg
("æˆåŠŸä¿å­˜æ–‡ä»¶ï¼",
$backu¾
);

80 
ex™
();

106 if(
	g$fmdo
=="upload")

108 
$j
=0;

109 
	g$i
=1; $i<=50; $i++)

111 
	g$upfe
 = "upfe".
$i
;

112 
	g$upfe_Çme
 = "upfe".
$i
."_name";

113 if(!
is£t
(
$
{
$upfe
}è|| !is£t(${
$upfe_Çme
}))

117 
	g$upfe
 = 
$
{
$upfe
};

118 
	g$upfe_Çme
 = 
$
{
$upfe_Çme
};

119 if(
is_u¶ßded_fe
(
$upfe
))

121 if(!
fe_exi¡s
(
$cfg_ba£dœ
.
$aùiv•©h
."/".
$upfe_Çme
))

123 
move_u¶ßded_fe
(
$upfe
, 
$cfg_ba£dœ
.
$aùiv•©h
."/".
$upfe_Çme
);

125 @
uÆšk
(
$upfe
);

126 
	g$j
++;

129 
ShowMsg
("æˆåŠŸä¸Šä¼  $j ä¸ªæ–‡ä»¶åˆ°: $activepath","file_manage_main.php?activepath=$activepath");

130 
ex™
();

134 if(
	g$fmdo
=="space")

136 if(
$aùiv•©h
=="")

138 
$eı©h
 = "æ‰€æœ‰ç›®å½•";

142 
	g$eı©h
 = 
$aùiv•©h
;

144 
	g$t™Ëšfo
 = "ç›®å½• <a href='file_manage_main.php?activepath=$activepath'><b><u>$ecpath</u></b></a> ç©ºé—´ä½¿ç”¨çŠ¶å†µï¼š<br/>";

145 
	g$wšt™Ë
 = "æ–‡ä»¶ç®¡ç†";

146 
	g$wecome_šfo
 = "æ–‡ä»¶ç®¡ç†::ç©ºé—´å¤§å°æ£€æŸ¥ [<a href='file_manage_main.php?activepath=$activepath'>æ–‡ä»¶æµè§ˆå™¨</a>]</a>";

147 
	g$aùiv•©h
=
$cfg_ba£dœ
.
$aùiv•©h
;

148 
	g$¥aû
 = 
Ãw
 
S·ûU£
;

149 
	g$¥aû
->
checksize
(
$aùiv•©h
);

150 
	g$tÙ®
=
$¥aû
->
tÙ®size
;

151 
	g$tÙ®kb
=
$¥aû
->
£tkb
(
$tÙ®
);

152 
	g$tÙ®mb
=
$¥aû
->
£tmb
(
$tÙ®
);

153 
	g$wš
 = 
Ãw
 
OxWšdow
();

154 
	g$wš
->
In™
("","js/blank.js","POST");

155 
	g$wš
->
AddT™Ë
(
$t™Ëšfo
);

156 
	g$wš
->
AddMsgI‹m
("ã€€ã€€$totalmb M<br/>ã€€ã€€$totalkb KB<br/>ã€€ã€€$total å­—èŠ‚");

157 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("");

158 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\file_manage_main.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_æ–‡ä»¶ç®¡ç†å™¨');

9 if(!
is£t
(
$aùiv•©h
)è
	g$aùiv•©h
=
$cfg_cm¥©h
;

11 
	g$š·th
 = "";

12 
	g$aùiv•©h
 = 
¡r_»¶aû
("..", "", 
$aùiv•©h
);

13 
	g$aùiv•©h
 = 
´eg_»¶aû
("#^\/{1,}#", "/", 
$aùiv•©h
);

14 if(
	g$aùiv•©h
 =ğ"/"è
$aùiv•©h
 = "";

16 if(
	g$aùiv•©h
 =ğ""è
$š·th
 = 
$cfg_ba£dœ
;

17 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

19 
	g$aùiveu¾
 = 
$aùiv•©h
;

20 if(
´eg_m©ch
("#".
$cfg_‹m¶‘s_dœ
."#i", 
$aùiv•©h
))

22 
	g$i¡em¶‘s
 = 
TRUE
;

26 
	g$i¡em¶‘s
 = 
FALSE
;

28 
šşude
 
XAKINClude
('templets/file_manage_main.htm');

	@E:\web\weixun\xakadmin\file_manage_view.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_æ–‡ä»¶ç®¡ç†å™¨');

9 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

10 
	g$aùiv•©h
 = 
¡r_»¶aû
("..", "", 
$aùiv•©h
);

11 
	g$aùiv•©h
 = 
´eg_»¶aû
("#^\/{1,}#", "/", 
$aùiv•©h
);

12 if(
	g$aùiv•©h
 =ğ"/"è
$aùiv•©h
 = "";

13 if(
	g$aùiv•©h
 =ğ""è
$š·th
 = 
$cfg_ba£dœ
;

14 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

18 if(
	g$fmdo
=="rename")

20 if(
$aùiv•©h
==""è
$ndœ¡ršg
 = "æ ¹ç›®å½•";

21 
	g$ndœ¡ršg
 = 
$aùiv•©h
;

22 
	g$wšt™Ë
 = "&nbsp;æ–‡ä»¶ç®¡ç†";

23 
	g$wecome_šfo
 = "æ–‡ä»¶ç®¡ç†::æ›´æ”¹æ–‡ä»¶å [<a href='file_manage_main.php?activepath=$activepath'>æ–‡ä»¶æµè§ˆå™¨</a>]</a>";

24 
	g$wš
 = 
Ãw
 
OxWšdow
();

25 
	g$wš
->
In™
("file_manage_control.php","js/blank.js","POST");

26 
	g$wš
->
AddHidd’
("fmdo",
$fmdo
);

27 
	g$wš
->
AddHidd’
("aùiv•©h",
$aùiv•©h
);

28 
	g$wš
->
AddHidd’
("f’ame",
$f’ame
);

29 
	g$wš
->
AddT™Ë
("æ›´æ”¹æ–‡ä»¶åï¼Œå½“å‰è·¯å¾„ï¼š$ndirstring");

30 
	g$wš
->
AddI‹m
("æ—§åç§°ï¼š","<input‚ame='oldfilename'ype='input' class='alltxt' id='oldfilename' size='40' value='$filename'>");

31 
	g$wš
->
AddI‹m
("æ–°åç§°ï¼š","<input‚ame='newfilename'ype='input' class='alltxt' size='40' id='newfilename'>");

32 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

33 
	g$wš
->
Di¥Ïy
();

36 if(
	g$fmdo
=="newdir")

38 if(
$aùiv•©h
==""è
$aùiv•©hÇme
="æ ¹ç›®å½•";

39 
	g$aùiv•©hÇme
=
$aùiv•©h
;

41 
	g$wšt™Ë
 = "&nbsp;æ–‡ä»¶ç®¡ç†";

42 
	g$wecome_šfo
 = "&nbsp;æ–‡ä»¶ç®¡ç†::æ–°å»ºç›®å½• [<a href='file_manage_main.php?activepath=$activepath'>æ–‡ä»¶æµè§ˆå™¨</a>]</a>";

43 
	g$wš
 = 
Ãw
 
OxWšdow
();

44 
	g$wš
->
In™
("file_manage_control.php","js/blank.js","POST");

45 
	g$wš
->
AddHidd’
("fmdo",
$fmdo
);

46 
	g$wš
->
AddHidd’
("aùiv•©h",
$aùiv•©h
);

47 
	g$wš
->
AddT™Ë
("å½“å‰ç›®å½• $activepathname ");

48 
	g$wš
->
AddI‹m
("æ–°ç›®å½•ï¼š","<input‚ame='newpath'ype='input' class='alltxt' id='newpath'>");

49 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

50 
	g$wš
->
Di¥Ïy
();

54 if(
	g$fmdo
=="move")

56 
$wšt™Ë
 = "&nbsp;æ–‡ä»¶ç®¡ç†";

57 
	g$wecome_šfo
 = "&nbsp;æ–‡ä»¶ç®¡ç†::ç§»åŠ¨æ–‡ä»¶ [<a href='file_manage_main.php?activepath=$activepath'>æ–‡ä»¶æµè§ˆå™¨</a>]</a>";

58 
	g$wš
 = 
Ãw
 
OxWšdow
();

59 
	g$wš
->
In™
("file_manage_control.php","js/blank.js","POST");

60 
	g$wš
->
AddHidd’
("fmdo",
$fmdo
);

61 
	g$wš
->
AddHidd’
("aùiv•©h",
$aùiv•©h
);

62 
	g$wš
->
AddHidd’
("f’ame",
$f’ame
);

63 
	g$wš
->
AddT™Ë
("æ–°ä½ç½®å‰é¢ä¸åŠ '/'è¡¨ç¤ºç›¸å¯¹äºå½“å‰ä½ç½®ï¼ŒåŠ '/'è¡¨ç¤ºç›¸å¯¹äºæ ¹ç›®å½•ã€‚");

64 
	g$wš
->
AddI‹m
("è¢«ç§»åŠ¨æ–‡ä»¶ï¼š",
$f’ame
);

65 
	g$wš
->
AddI‹m
("å½“å‰ä½ç½®ï¼š",
$aùiv•©h
);

66 
	g$wš
->
AddI‹m
("æ–°ä½ç½®ï¼š","<input‚ame='newpath'ype='input' class='alltxt' id='newpath' size='40'>");

67 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

68 
	g$wš
->
Di¥Ïy
();

72 if(
	g$fmdo
=="del")

74 
$wšt™Ë
 = "&nbsp;æ–‡ä»¶ç®¡ç†";

75 
	g$wecome_šfo
 = "&nbsp;æ–‡ä»¶ç®¡ç†::åˆ é™¤æ–‡ä»¶ [<a href='file_manage_main.php?activepath=$activepath'>æ–‡ä»¶æµè§ˆå™¨</a>]</a>";

76 
	g$wš
 = 
Ãw
 
OxWšdow
();

77 
	g$wš
->
In™
("file_manage_control.php","js/blank.js","POST");

78 
	g$wš
->
AddHidd’
("fmdo",
$fmdo
);

79 
	g$wš
->
AddHidd’
("aùiv•©h",
$aùiv•©h
);

80 
	g$wš
->
AddHidd’
("f’ame",
$f’ame
);

81 if(@
is_dœ
(
$cfg_ba£dœ
.
$aùiv•©h
."/$filename"))

83 
	g$wmsg
 = "ä½ ç¡®ä¿¡è¦åˆ é™¤ç›®å½•ï¼š$filename å—ï¼Ÿ";

87 
	g$wmsg
 = "ä½ ç¡®ä¿¡è¦åˆ é™¤æ–‡ä»¶ï¼š$filename å—ï¼Ÿ";

89 
	g$wš
->
AddT™Ë
("åˆ é™¤æ–‡ä»¶ç¡®è®¤");

90 
	g$wš
->
AddMsgI‹m
(
$wmsg
,"50");

91 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

92 
	g$wš
->
Di¥Ïy
();

96 if(
	g$fmdo
=="edit")

98 if(!
is£t
(
$backu¾
))

100 
$backu¾
 = "";

103 
	g$aùiv•©h
 = 
¡r_»¶aû
("..","",
$aùiv•©h
);

104 
	g$f’ame
 = 
¡r_»¶aû
("..","",
$f’ame
);

105 
	g$fe
 = "$cfg_basedir$activepath/$filename";

106 
	g$cÚ‹Á
 = "";

107 if(
is_fe
(
$fe
))

109 
	g$å
 = 
fİ’
(
$fe
,"r");

110 
	g$cÚ‹Á
 = 
ä—d
(
$å
,
fesize
(
$fe
));

111 
fşo£
(
$å
);

112 
	g$cÚ‹Á
 = 
html¥ecŸlch¬s
(
$cÚ‹Á
);

114 
	g$cÚ‹ÁV›w
 = "<textarea‚ame='str' style='width:99%;height:450px;background:#ffffff;'>$content</textarea>\r\n";

115 
	g$GLOBALS
['f’ame'] = 
$f’ame
;

116 
	g$ùp
 = 
Ãw
 
XakTagP¬£
();

117 
	g$ùp
->
LßdTem¶©e
(
XAKADMIN
."/templets/file_edit.htm");

118 
	g$ùp
->
di¥Ïy
();

152 if(
	g$fmdo
=="newfile")

154 
$cÚ‹Á
 = "";

155 
	g$GLOBALS
['filename'] = "newfile.txt";

156 
	g$cÚ‹ÁV›w
 = "<textarea‚ame='str' style='width:99%;height:400'></textarea>\r\n";

157 
	g$ùp
 = 
Ãw
 
XakTagP¬£
();

158 
	g$ùp
->
LßdTem¶©e
(
XAKADMIN
."/templets/file_edit.htm");

159 
	g$ùp
->
di¥Ïy
();

163 if(
	g$fmdo
=="upload")

165 
$ùp
 = 
Ãw
 
XakTagP¬£
();

166 
	g$ùp
->
LßdTem¶©e
(
XAKADMIN
."/templets/file_upload.htm");

167 
	g$ùp
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\file_pic_view.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('pic_view');

9 if(
em±y
(
$aùiv•©h
)è
	g$aùiv•©h
=
$cfg_medŸs_dœ
;

11 
	g$aùiv•©h
 = 
´eg_»¶aû
("#\/{1,}#", "/", 
$aùiv•©h
);

12 
	g$ŒueP©h
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

13 
	g$li¡Size
=5;

14 
šşude
 
XAKINClude
('templets/file_pic_view.htm');

23 
funùiÚ
 
	$G‘P»P©h
(
$nowP©h
)

25 if(
$nowP©h
=="" || $nowPath=="/")

27 
	`echo
("å½“å‰ä¸ºæ ¹ç›®å½•\n");

31 
$dœs
 = 
	`¥l™
("/", 
$nowP©h
);

32 
$nowP©h
 = "";

33 
$i
=1;$˜< 
	`couÁ
(
$dœs
)-1; $i++)

35 
$nowP©h
 .ğ"/".
$dœs
[
$i
];

37 
	`echo
("<¨h»f=\"pic_v›w.php?aùiv•©h=".
$nowP©h
."\">è½¬åˆ°ä¸Šçº§ç›®å½•</a>\n");

39 
	}
}

49 
funùiÚ
 
	$Li¡Pic
(
$ŒueP©h
, 
$nowP©h
)

51 
glob®
 
$li¡Size
;

52 
$cŞ
=0;

53 
$rowdd
=0;

54 
$rowdd
++;

55 
$imgfe
="";

56 
$ŒueP©h
 = 
	`´eg_»¶aû
("#\/$#", "",…»g_»¶aû("#\\\\{1,}#", "/", 
	`Œim
($truePath)));

57 
$nowP©h
 = 
	`´eg_»¶aû
("#\/$#", "",…»g_»¶aû("#\/{1,}#", "/", 
	`Œim
($nowPath)));

58 
$dh
 = 
	`dœ
(
$ŒueP©h
);

59 
	`echo
("<tr‡lign='center'>\n");

60 
$f’ame
=
$dh
->
	`»ad
())

62 if(!
	`´eg_m©ch
("#\.$#", 
$f’ame
))

64 
$fuÎName
 = 
$ŒueP©h
."/".
$f’ame
;

65 
$feU¾
 = 
$nowP©h
."/".
$f’ame
;

66 if(
	`is_dœ
(
$fuÎName
))

68 if(
$cŞ
 % 
$li¡Size
 == 0 && $col != 0)

70 
	`echo
("</tr>\n<tr‡lign='center'>\n");

71 
$i
=
$rowdd
-
$li¡Size
; $i<$rowdd; $i++)

73 
	`echo
("<td>".
$f–i¡
[
$i
]."</td>\n");

75 
	`echo
("</tr>\n<tr‡lign='center'>\n");

77 
$lše
 = "

78 <
td
>

79 <
bË
 
width
='106' 
height
='106' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CCCCCC'>

80 <
Œ
><
td
 
®ign
='ûÁ”' 
bgcŞÜ
='#FFFFFF'>

81 <
a
 
h»f
='pic_view.php?activepath=".$fileUrl."'>

82 <
img
 
¤c
='images/pic_dœ.gif' 
width
='44' 
height
='42' 
bÜd”
='0'>

83 </
a
></
td
></
Œ
></
bË
></td>";

84 
$f–i¡
[
$rowdd
] = 
$f’ame
;

85 
$cŞ
++;

86 
$rowdd
++;

87 
echo
 
$lše
;

89 if(
	`IsImg
(
$f’ame
))

91 if(
$cŞ
%
$li¡Size
==0&&$col!=0)

93 
	`echo
("</tr>\n<tr‡lign='center'>\n");

94 
$i
=
$rowdd
-
$li¡Size
;$i<$rowdd;$i++)

96 
	`echo
("<td>".
$f–i¡
[
$i
]."</td>\n");

98 
	`echo
("</tr>\n<tr‡lign='center'>\n");

100 
$lše
 = "

101 <
td
>

102 <
bË
 
width
='106' 
height
='106' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CCCCCC'>

103 <
Œ
>

104 <
td
 
®ign
='ûÁ”' 
bgcŞÜ
='#FFFFFF'>

106 </
td
>

107 </
Œ
></
bË
></
td
>";

108 
$f–i¡
[
$rowdd
] = 
$f’ame
;

109 
$cŞ
++;

110 
$rowdd
++;

111 
echo
 
$lše
;

115 
	`echo
("</tr>\n");

116 if(!
	`em±y
(
$f–i¡
))

118 
	`echo
("<tr‡lign='center'>\n");

119 
$t
 = (
$rowdd
-1)%
$li¡Size
;

120 if(
$t
==0)

122 
$t
=
$li¡Size
;

124 
$i
=
$rowdd
-
$t
;$i<$rowdd;$i++)

126 
	`echo
("<td>".
$f–i¡
[
$i
]."</td>\n");

128 
	`echo
("</tr>\n");

130 
	}
}

141 
funùiÚ
 
	$G‘ImgFe
(
$ŒueP©h
, 
$nowP©h
, 
$feName
)

143 
$toW
=102;

144 
$toH
=102;

145 
$¤cFe
 = 
$ŒueP©h
."/".
$feName
;

146 
$šfo
 = "";

147 
$d©a
 = 
	`G‘ImageSize
(
$¤cFe
, 
$šfo
);

148 
$¤cW
=
$d©a
[0];

149 
$¤cH
=
$d©a
[1];

150 if(
$toW
>=
$¤cW
&&
$toH
>=
$¤cH
)

152 
$áoW
=
$¤cW
;

153 
$áoH
=
$¤cH
;

157 
$toWH
=
$toW
 / 
$toH
;

158 
$¤cWH
=
$¤cW
 / 
$¤cH
;

159 if(
$toWH
<=
$¤cWH
)

161 
$áoW
=
$toW
;

162 
$áoH
=
$áoW
*(
$¤cH
/
$¤cW
);

166 
$áoH
=
$toH
;

167 
$áoW
=
$áoH
*(
$¤cW
/
$¤cH
);

170 ("<¨h»f='".
$nowP©h
."/".
$feName
."'¬g‘='_bÏnk'><img src='".$nowP©h."/".$feName."' width='".
$áoW
."' height='".
$áoH
."' border='0'></a>");

171 
	}
}

173 
funùiÚ
 
	$IsImg
(
$feName
)

175 if(
	`´eg_m©ch
("#\.(jpg|gif|²g)$#", 
$feName
))  1;

177 
	}
}

	@E:\web\weixun\xakadmin\freelist_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_FreeList');

9 if(
	$em±y
(
$dİo¡
))

11 
»quœe_Úû
 
XAKINC
.'/typelink.class.php';

12 
šşude
 
	`XAKINClude
('templets/freelist_add.htm');

13 
	`ex™
();

14 
	}
}

15 if(
	g$dİo¡
=='save')

17 if(!
is£t
(
$ty³s
)) $types = '';

18 if(!
is£t
(
$nodeçuÉ
)è
	g$nodeçuÉ
 = '0';

19 
	g$©ts
 = "…agesize='$pagesize' col='$col'itlelen='$titlelen' orderby='$orderby' orderway='$order' ";

20 
	g$Áy³
 = '';

21 
	g$edtime
 = 
time
();

22 if(
em±y
(
$chªÃl
))

24 
showmsg
('é¢‘é“ç±»å‹ä¸èƒ½ä¸ºç©º','-1');

25 
ex™
();

27 if(
is_¬¿y
(
$ty³s
))

29 
fÜ—ch
(
$ty³s
 
as
 
$v
è
	g$Áy³
 .= $v.' ';

32 if(
	g$Áy³
!=''è
$©ts
 .ğ"y³='".
Œim
(
$Áy³
)."' ";

33 if(!
em±y
(
$ty³id
)è
	g$©ts
 .= "ypeid='$typeid' ";

34 if(!
em±y
(
$chªÃl
)è
	g$©ts
 .= " channel='$channel' ";

35 if(!
em±y
(
$subday
)è
	g$©ts
 .= " subday='$subday' ";

36 if(!
em±y
(
$keywÜd¬c
)è
	g$©ts
 .= " keyword='$keywordarc' ";

37 if(!
em±y
(
$©t
)è
	g$©ts
 .= "‡tt='$att' ";

39 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

40 if(!
em±y
(
$šÃ¹ext
)è
	g$šÃ¹ext
 = 
¡r¦ashes
($innertext);

42 
	g$li¡Tag
 = "{xak:list $atts}$innertext{/xak:list}";

43 
	g$li¡Tag
 = 
add¦ashes
(
$li¡Tag
);

44 
	g$šqu”y
 = "

45 
INSERT
 
INTO
 `#@
__ä“li¡
`(`
t™Ë
` , `
	gÇm”uË
` , `
	gli¡dœ
` , `
	gdeçuÉ·ge
` , `
	gnodeçuÉ
` , `
	g‹m¶‘
` , `
	gedtime
`, `
	gmax·ge
` , `
	gşick
` , `
	gli¡g
` , `
	gkeywÜds
` , `
	gdesütiÚ
`)

46 
VALUES
 ('$title','$namerule','$listdir','$defaultpage','$nodefault','$templet','$edtime', '$maxpage','0','$listTag','$keywords','$description');

48 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

49 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªè‡ªç”±åˆ—è¡¨!", "freelist_main.php");

50 
ex™
();

	@E:\web\weixun\xakadmin\freelist_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
	$em±y
(
$dİo¡
))

10 
»quœe_Úû
 
XAKINC
.'/typelink.class.php';

11 
»quœe_Úû
 
XAKINC
.'/xaktag.class.php';

12 
$aid
 = 
	`is£t
($aidè&& 
	`is_num”ic
($aid) ? $aid : 0;

13 
$row
 = 
$dsql
->
	`G‘OÃ
("Select * From `#@__freelist` where‡id='$aid' ");

14 
$d
 = 
Ãw
 
	`XakTagP¬£
();

15 
$d
->
	`S‘NameS·û
("xak","{","}");

16 
$d
->
	`LßdSourû
("--".
$row
['listtag']."--");

17 
$ùag
 = 
$d
->
	`G‘Tag
('list');

18 
šşude
 
	`XAKINClude
('templets/freelist_edit.htm');

19 
	`ex™
();

20 
	}
}

21 ifĞ
	g$dİo¡
=='save' )

23 if(!
is£t
(
$ty³s
)) $types = '';

24 if(!
is£t
(
$nodeçuÉ
)è
	g$nodeçuÉ
 = '0';

25 
	g$©ts
 = "…agesize='$pagesize' col='$col'itlelen='$titlelen' orderby='$orderby' orderway='$order' \r\n";

26 
	g$Áy³
 = '';

27 
	g$edtime
 = 
time
();

28 if(
is_¬¿y
(
$ty³s
))

30 
fÜ—ch
(
$ty³s
 
as
 
$v
è
	g$Áy³
 .= $v.' ';

33 if(
	g$Áy³
!=''è
$©ts
 .ğ"y³='".
Œim
(
$Áy³
)."' ";

34 if(!
em±y
(
$ty³id
)è
	g$©ts
 .= "ypeid='$typeid' ";

35 if(!
em±y
(
$chªÃl
)è
	g$©ts
 .= " channel='$channel' ";

36 if(!
em±y
(
$subday
)è
	g$©ts
 .= " subday='$subday' ";

37 if(!
em±y
(
$keywÜd¬c
)è
	g$©ts
 .= " keyword='$keywordarc' ";

38 if(!
em±y
(
$©t
)è
	g$©ts
 .= "‡tt='$att' ";

40 
	g$šÃ¹ext
 = 
Œim
(
$šÃ¹ext
);

41 if(!
em±y
(
$šÃ¹ext
)è
	g$šÃ¹ext
 = 
¡r¦ashes
($innertext);

43 
	g$li¡Tag
 = "{xak:list $atts}$innertext{/xak:list}";

44 
	g$li¡Tag
 = 
add¦ashes
(
$li¡Tag
);

45 
	g$šqu”y
 = "

46 
UPDATE
 `#@
__ä“li¡
` 
£t


47 
t™Ë
='$t™Ë', 
	gÇm”uË
='$namerule',

48 
	gli¡dœ
='$li¡dœ', 
	gdeçuÉ·ge
='$defaultpage',

49 
	gnodeçuÉ
='$nodeçuÉ', 
	g‹m¶‘
='$templet',

50 
	gedtime
='$edtime', `
	gmax·ge
`='$max·ge', 
	gli¡g
='$li¡Tag', 
	gkeywÜds
='$keywords',

51 
	gdesütiÚ
='$desütiÚ' 
WHERE
 
aid
='$aid';

53 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

54 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªè‡ªç”±åˆ—è¡¨!","freelist_main.php");

55 
ex™
();

	@E:\web\weixun\xakadmin\freelist_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_FreeList');

9 
»quœe_Úû
 
	gXAKINC
.'/channelunit.func.php';

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 if(
em±y
(
$·gesize
)è
	g$·gesize
 = 18;

13 if(
em±y
(
$·g’o
)è
	g$·g’o
 = 1;

14 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

15 if(
em±y
(
$Üd”by
)è
	g$Üd”by
 = 'aid';

16 if(
	$em±y
(
$keywÜd
))

18 
$keywÜd
 = '';

19 
$addg‘
 = '';

20 
$addsql
 = '';

21 
	}
} 

23 
	g$addg‘
 = '&keywÜd='.
u¾’code
(
$keywÜd
);

24 
	g$addsql
 = " whereitle†ike '%$keyword%' ";

28 if(
	g$dİo¡
=='getlist')

30 
AjaxH—d
();

31 
G‘TagLi¡
(
$dsql
,
$·g’o
,
$·gesize
,
$Üd”by
);

32 
ex™
();

36 if(
	g$dİo¡
=='del')

38 
$aid
 = 
´eg_»¶aû
("#[^0-9]#", "", $aid);

39 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__freelist WHERE‡id='$aid'; ");

40 
AjaxH—d
();

41 
G‘TagLi¡
(
$dsql
,
$·g’o
,
$·gesize
,
$Üd”by
);

42 
ex™
();

46 if(
	g$dİo¡
=='')

48 
$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM #@__freelist $addsql ");

49 
	g$tÙ®Row
 = 
$row
['dd'];

50 
šşude
(
XAKADMIN
."/templets/freelist_main.htm");

61 
funùiÚ
 
G‘TagLi¡
(
$dsql
,
$·g’o
,
$·gesize
,
$Üd”by
='aid')

63 
glob®
 
$cfg_phpu¾
,
$addsql
;

64 
	g$¡¬t
 = (
$·g’o
-1è* 
$·gesize
;

65 
	g$´šth—d
 ="<table width='98%' border='0' cellpadding='1' cellspacing='1'‡lign='center' class='tbtitle' style='background:#cfcfcf;margin-bottom:5px;'>

66 <
Œ
 
®ign
='ûÁ”' 
bgcŞÜ
='#F9FCFD'>

67 <
td
 
width
='5%' 
şass
='tb¢ame'><
a
 
h»f
='#' 
Úşick
=\"ReloadPage('aid')\"><u>ID</u></a></td>

68 <
td
 
width
='20%' 
şass
='tbsname'>åˆ—è¡¨åç§°</td>

69 <
td
 
width
='20%' 
şass
='tbsname'>æ¨¡æ¿æ–‡ä»¶</td>

70 <
td
 
width
='5%' 
şass
='tb¢ame'><
a
 
h»f
='#' 
Úşick
=\"ReloadPage('click')\"><u>ç‚¹å‡»</u></a></td>

71 <
td
 
width
='15%' 
şass
='tbsname'>åˆ›å»ºæ—¶é—´</td>

72 <
td
 
şass
='tbsname'>ç®¡ç†</td>

73 </
Œ
>\
r
\
n
";

74 
echo
 
$´šth—d
;

75 
	g$dsql
->
S‘Qu”y
("Select‡id,title,templet,click,edtime,namerule,listdir,defaultpage,nodefault From #@__freelist $addsql order by $orderby desc†imit $start,$pagesize ");

76 
	g$dsql
->
Execu‹
();

77 
	g$row
 = 
$dsql
->
G‘A¼ay
())

79 
$li¡u¾
 = 
G‘F»eLi¡U¾
(
$row
['aid'],$row['namerule'],$row['listdir'],$row['defaultpage'],$row['nodefault']);

80 
	g$lše
 = "

81 <
Œ
 
®ign
='ûÁ”' 
bgcŞÜ
='#FFFFFF' 
ÚMou£Move
=\"javascript:this.bgColor='#F9FCFD';\" onMouseOut=\"javascript:this.bgColor='#FFFFFF';\">

82 <
td
>{
$row
['aid']}</td>

83 <
td
> <
a
 
h»f
='$li¡u¾' 
rg‘
='_bÏnk'>{
$row
['title']}</a> </td>

84 <
td
> {
$row
['templet']} </td>

85 <
td
> {
$row
['click']} </td>

86 <
td
>".MyD©e("
y
-
m
-
d
",$row['edtime'])."</td>

87 <
td
> <
a
 
h»f
='#' 
Úşick
='Ed™NÙe({$row['
aid
']})'>æ›´æ”¹</a> |

88 <
a
 
h»f
='#' 
Úşick
='C»©eNÙe({$row['
aid
']})'>æ›´æ–°</a> |

89 <
a
 
h»f
='#' 
Úşick
='D–NÙe({$row['
aid
']})'>åˆ é™¤</a>

90 </
td
>

91 </
Œ
>";

92 
echo
 
$lše
;

94 
	gecho
 "</table>\r\n";

	@E:\web\weixun\xakadmin\friendlink_add.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_å‹æƒ…é“¾æ¥æ¨¡å—');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
="";

11 if(
	g$dİo¡
=="add")

13 
$dtime
 = 
time
();

14 if(
is_u¶ßded_fe
(
$logoimg
))

16 
	g$Çmes
 = 
¥l™
("\.", 
$logoimg_Çme
);

17 
	g$shÜŠame
 = ".".
$Çmes
[
couÁ
($names)-1];

18 if(!
´eg_m©ch
("#(jpg|gif|²g)$#", 
$shÜŠame
))

20 
	g$shÜŠame
 = '.gif';

22 
	g$f’ame
 = 
MyD©e
("ymdHis", 
time
()).
mt_¿nd
(1000,9999).
	g$shÜŠame
;

23 
	g$imgu¾
 = 
$cfg_medŸs_dœ
."/flink";

24 if(!
is_dœ
(
$cfg_ba£dœ
.
$imgu¾
))

26 
MkdœAÎ
(
$cfg_ba£dœ
.
$imgu¾
, 
$cfg_dœ_purv›w
);

27 
Clo£F
();

29 
	g$imgu¾
 = 
$imgu¾
."/".
$f’ame
;

30 
move_u¶ßded_fe
(
$logoimg
,
$cfg_ba£dœ
.
$imgu¾
è
Ü
 
d›
("å¤åˆ¶æ–‡ä»¶åˆ°:".$cfg_basedir.$imgurl."å¤±è´¥");

31 @
uÆšk
(
$logoimg
);

35 
	g$imgu¾
 = 
$logo
;

39 if(
em±y
(
$ty³id
è|| 
´eg_m©ch
("#[^0-9]#", $typeid))

41 
	g$ty³id
 = 0;

42 
	g$dsql
->
Execu‹NÚeQu”y
("ALTER TABLE `#@__flinktype` CHANGE `ID` `id` MEDIUMINT( 8 ) UNSIGNED DEFAULT NULL AUTO_INCREMENT; ");

45 
	g$qu”y
 = "INSERT INTO `#@__flink`(sortrank,url,webname,logo,msg,email,typeid,dtime,ischeck)

46 
VALUES
('$sortrank','$url','$webname','$imgurl','$msg','$email','$typeid','$dtime','$ischeck'); ";

47 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

48 
	g$bu¾
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? "friendlink_main.php" : $_COOKIE['ENV_GOBACK_URL'];

49 if(
	g$rs
)

51 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªé“¾æ¥!",
$bu¾
,0,500);

52 
ex™
();

56 
ShowMsg
("å¢åŠ é“¾æ¥æ—¶å‡ºé”™ï¼Œè¯·å‘å®˜æ–¹åé¦ˆï¼ŒåŸå› ï¼š".
$dsql
->
G‘E¼Ü
(),"javascript:;");

57 
ex™
();

60 
šşude
 
XAKINClude
('templets/friendlink_add.htm');

	@E:\web\weixun\xakadmin\friendlink_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_å‹æƒ…é“¾æ¥æ¨¡å—');

9 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? 'friendlink_main.php' : $_COOKIE['ENV_GOBACK_URL'];

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 if(
	$is£t
(
$®lid
))

14 
$aids
 = 
	`ex¶ode
(',',
$®lid
);

15 if(
	`couÁ
(
$aids
)==1)

17 
$id
 = 
$aids
[0];

18 
$dİo¡
 = "delete";

20 
	}
}

21 if(
	g$dİo¡
=="delete")

23 
$id
 = 
´eg_»¶aû
("#[^0-9]#", "", $id);

24 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__flink` WHERE id='$id'");

25 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªé“¾æ¥ï¼",
$ENV_GOBACK_URL
);

26 
ex™
();

28 if(
	g$dİo¡
=="delall")

30 
$aids
 = 
ex¶ode
(',',$aids);

31 if(
is£t
(
$aids
è&& 
is_¬¿y
($aids))

33 
fÜ—ch
(
$aids
 
as
 
$aid
)

35 
	g$aid
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$aid
);

36 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__flink` WHERE id='$aid'");

38 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šé“¾æ¥ï¼",
$ENV_GOBACK_URL
);

39 
ex™
();

43 
ShowMsg
("ä½ æ²¡é€‰å®šä»»ä½•é“¾æ¥ï¼",
$ENV_GOBACK_URL
);

44 
ex™
();

47 if(
	g$dİo¡
=="saveedit")

49 
»quœe_Úû
 
XAKINC
.'/request.class.php';

50 
	g$»que¡
 = 
Ãw
 
Reque¡
();

51 
	g$»que¡
->
In™
();

52 
	g$id
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$»que¡
->
I‹m
('id', 0));

53 
	g$logo
 = 
$»que¡
->
I‹m
('logo', '');

54 
	g$logoimg
 = 
$»que¡
->
Upfe
('logoimg', '');

55 if(!
em±y
(
$logoimg
))

57 
	g$»que¡
->
MoveU¶ßdFe
('logoimg', 
XAKROOT
.
$cfg_medŸs_dœ
.'/æšk/'.
$»que¡
->
G‘FeInfo
('logoimg', 'name'));

58 
	g$logo
 = 
$cfg_cm¥©h
.
$cfg_medŸs_dœ
.'/æšk/'.
$»que¡
->
G‘FeInfo
('logoimg', 'name');

60 
	g$sÜŒªk
 = 
$»que¡
->
I‹m
('sortrank', 1);

61 
	g$u¾
 = 
$»que¡
->
I‹m
('url', '');

62 
	g$webÇme
 = 
$»que¡
->
I‹m
('webname', '');

63 
	g$msg
 = 
$»que¡
->
I‹m
('msg', '');

64 
	g$ema
 = 
$»que¡
->
I‹m
('email', '');

65 
	g$ty³id
 = 
$»que¡
->
I‹m
('typeid', 0);

66 
	g$ischeck
 = 
$»que¡
->
I‹m
('ischeck', 0);

68 
	g$qu”y
 = "UPDATE `#@__flink` SET sortrank='$sortrank',url='$url',webname='$webname',logo='$logo',msg='$msg',

69 
ema
='$ema',
	gty³id
='$ty³id',
	gischeck
='$ischeck' 
WHERE
 
id
='$id' ";

70 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

71 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªé“¾æ¥ï¼",
$ENV_GOBACK_URL
);

72 
ex™
();

74 
	g$myLšk
 = 
$dsql
->
G‘OÃ
("SELECT #@__flink.*,#@__flinktype.typename FROM #@__flink LEFT JOIN #@__flinktype ON #@__flink.typeid=#@__flinktype.id WHERE #@__flink.id=$id");

75 
šşude
 
XAKINClude
('templets/friendlink_edit.htm');

	@E:\web\weixun\xakadmin\friendlink_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

9 
£tcook›
('ENV_GOBACK_URL', 
$xakNowu¾
, 
time
()+3600, '/');

11 if(
em±y
(
$keywÜd
)è
	g$keywÜd
 = '';

12 if(
	$em±y
(
$ischeck
)) {

13 
$ischeck
 = 0;

14 
$ischeckSql
 = '';

15 
	}
} {

16 if(
	g$ischeck
==-1è
$ischeckSql
 = " And ischeck < 1 ";

17 
	g$ischeckSql
 = " And ischeck='$ischeck' ";

20 
	g$£lCheckA¼
 = 
¬¿y
(0=>'ä¸é™ç±»å‹', -1=>'æœªå®¡æ ¸', 1=>'å†…é¡µ', 2=>'é¦–é¡µ');

22 
	g$sql
 = "SELECT * FROM `#@__flink` WHERE CONCAT(`url`,`webname`,`email`) LIKE '%$keyword%' $ischeckSql ORDER BY dtime desc";

24 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

25 
	g$dli¡
->
S‘P¬am‘”
('keywÜd', 
$keywÜd
);

26 
	g$dli¡
->
S‘P¬am‘”
('ischeck', 
$ischeck
);

27 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
.'/templets/friendlink_main.htm');

28 
	g$dli¡
->
S‘Sourû
(
$sql
);

29 
	g$dli¡
->
di¥Ïy
();

31 
funùiÚ
 
	$G‘Pic
(
$pic
)

33 if(
$pic
=='')  'æ— å›¾æ ‡';

35 
	}
}

37 
funùiÚ
 
	$G‘S
(
$¡a
)

39 if(
$¡a
==1)  'å†…é¡µ';

40 if(
$¡a
==2)  'é¦–é¡µ';

42 
	}
}

	@E:\web\weixun\xakadmin\friendlink_type.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
	g$dİo¡
=="save")

13 
$¡¬tID
 = 1;

14 
	g$’dID
 = 
$id’d
;

15 ;
	g$¡¬tID
<=
$’dID
;$startID++)

17 
	g$qu”y
 = '';

18 
	g$tid
 = 
$
{'ID_'.
$¡¬tID
};

19 
	g$²ame
 = 
$
{'²ame_'.
$¡¬tID
};

20 if(
is£t
(
$
{'check_'.
$¡¬tID
}))

22 if(
	g$²ame
!='')

24 
$qu”y
 = "UPDATE `#@__flinktype` SETypename='$pname' WHERE id='$tid' ";

25 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

30 
	g$qu”y
 = "DELETE FROM `#@__flinktype` WHERE id='$tid' ";

31 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

35 if(
is£t
(
$check_Ãw
è&& 
	g$²ame_Ãw
!='')

37 
$qu”y
 = "INSERT INTO `#@__flinktype`(typename) VALUES('{$pname_new}');";

38 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

40 
h—d”
("Content-Type:ext/html; charset={$cfg_soft_lang}");

41 
	gecho
 "<script>‡lert('æˆåŠŸæ›´æ–°å‹æƒ…é“¾æ¥ç½‘ç«™åˆ†ç±»è¡¨ï¼'); </script>";

44 
šşude
 
XAKINClude
('templets/friendlink_type.htm');

	@E:\web\weixun\xakadmin\group_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

9 
»quœe_Úû
(
XAKADMIN
."/inc/inc_archives_functions.php");

10 
CheckPurv›w
('group_Edit');

12 
	g$id
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$id
);

13 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

15 if(
$id
 < 1)

17 
	`ShowMsg
("å«æœ‰éæ³•æ“ä½œ!.","-1");

18 
	`ex™
();

19 
	}
}

22 
	g$row
 = 
$db
->
G‘OÃ
("SELECT * FROM #@__groups WHERE groupid='{$id}'");

23 
	g$group¢ame
 = 
$row
['groupname'];

24 
	g$group¡Üeid
 = 
$row
['storeid'];

25 
	g$groupishidd’
 = 
$row
['ishidden'];

26 
	g$groupissy¡em
 = 
$row
['issystem'];

27 
	g$groupü—‹r
 = 
$row
['creater'];

28 
	g$groupimg
 = 
$row
['groupimg'];

29 
	g$isma¡”
 = 
$row
['ismaster'];

30 
	g$groupdes
 = 
html¥ecŸlch¬s
(
$row
['des']);

31 
	g$groupisšdex
 = 
$row
['isindex'];

32 
	g$groupsm®Éy³
 = 
$row
['smalltype'];

35 
	g$sm®Éy³s
 = 
$row
['smalltype'];

36 
	g$li¡s
 = 
¬¿y
();

37 
	g$sm®Éy³s
 = @
ex¶ode
(",", 
$sm®Éy³s
);

38 
	$fÜ—ch
(
$sm®Éy³s
 
as
 
$k
)

40 
$kk
 = @
	`ex¶ode
("|",
$k
);

41 @
	`¬¿y_push
(
$li¡s
,
$kk
[1]);

42 
	}
}

46 if(
	g$aùiÚ
=="save")

48 
$grou²ame
 = 
ú_sub¡r
($groupname,75);

49 
	g$¡Üeid
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$¡Üe
);

50 
	g$issy¡em
 = 
´eg_»¶aû
("#[^0-1]#", "", 
$issy¡em
);

51 
	g$ishidd’
 = 
´eg_»¶aû
("#[^0-1]#", "", 
$ishidd’
);

52 if(!
is£t
(
$isšdex
))

54 
	g$isšdex
 = 
$groupisšdex
;

56 
	g$isšdex
 = 
´eg_»¶aû
("#[^0-1]#", "", 
$isšdex
);

57 
	g$ü—‹r
 = 
ú_sub¡r
(
$ü—‹r
, 15);

58 
	g$ma¡”
 = 
ú_sub¡r
(
$ma¡”
, 70);

59 
	g$desütiÚ
 = 
ú_sub¡r
(
$des
, 100);

60 
	g$row
 = 
$db
->
G‘OÃ
("SELECTops FROM #@__store_groups WHERE storeid='{$storeid}'");

61 if(
	g$row
['tops'] >0 )

63 
	g$roÙ¡Üeid
 = 
$row
['tops'];

67 
	g$roÙ¡Üeid
 = 
$¡Üeid
;

71 if(
em±y
(
$ddi¤emÙe
))

73 
	g$ddi¤emÙe
 = 0;

75 
	g$l™pic
 = 
G‘DDImage
('l™pic', 
$piúame
, 
$ddi¤emÙe
);

76 if(
em±y
(
$l™pic
))

78 
	g$l™pic
 = 
$groupimg
;

81 if(
	g$isšdex
 < 1)

83 
	g$isšdex
 = 0;

85 
	g$šQu”y
 = "UPDATE #@__group SET grou²ame='".
$grou²ame
."',des='".
$desütiÚ
."',groupimg='".
$l™pic
."',roÙ¡Üeid='{$roÙ¡Üeid}',¡Üeid='{$¡Üeid}',ü—‹r='".
$ü—‹r
."',isma¡”='".
$ma¡”
."',issy¡em='{$issy¡em}',ishidd’='{$ishidd’}',isšdex='".
$isšdex
."' WHERE groupid='{$id}'";

86 if(!
	g$db
->
Execu‹NÚeQu”y
(
$šQu”y
))

88 
ShowMsg
("æŠŠæ•°æ®æ›´æ–°åˆ°æ•°æ®åº“groupsè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼","-1");

89 
ex™
();

93 
ShowMsg
("æˆåŠŸæ›´æ”¹åœˆå­è®¾ç½®ï¼","-1");

94 
ex™
();

99 if(!
	g$groupimg
||
	$em±y
(
$groupimg
))

101 
$groupimg
 = "img/pview.gif";

102 
	}
}

105 
	g$db
->
S‘Qu”y
("SELECT * FROM #@__store_groups WHEREops=0 ORDER BY orders ASC");

106 
	g$db
->
Execu‹
(1);

107 
	g$İtiÚ
 = '';

108 
	g$rs
 = 
$db
->
	$G‘A¼ay
(1))

110 
$£Ëùed
 = "";

111 if(
$rs
['¡Üeid']==
$group¡Üeid
)

113 
$£Ëùed
 = "selected='selected'";

115 
$İtiÚ
 .ğ"<İtiÚ v®ue='".
$rs
['¡Üeid']."' ".
$£Ëùed
.">".$rs['storename']."</option>\n";

116 
$v
 = 
$rs
['storeid'];

117 
$db
->
	`S‘Qu”y
("SELECT * FROM #@__store_groups WHEREops='{$v}' ORDER BY orders ASC");

118 
$db
->
	`Execu‹
(2);

119 
$rs
 = 
$db
->
	`G‘A¼ay
(2))

121 
$£Ëùed
 = "";

122 if(
$rs
['¡Üeid']==
$group¡Üeid
)

124 
$£Ëùed
 = "selected='selected'";

126 
$İtiÚ
 .ğ"<İtiÚ v®ue='".
$rs
['¡Üeid']."' ".
$£Ëùed
.">--".$rs['storename']."</option>\n";

128 
	}
}

129 
	g$db
->
S‘Qu”y
("SELECT * FROM #@__group_smalltypes ORDER BY disorder ASC");

130 
	g$db
->
Execu‹
();

131 
	g$sm®Éy³s_İtiÚ
 = '';

132 
	g$rs
 = 
$db
->
	$G‘A¼ay
())

134 
$£Ëùed
 = "";

135 if(
	`š_¬¿y
(
$rs
['id'],
$li¡s
))

137 
$£Ëùed
 = "selected='selected'";

139 
$sm®Éy³s_İtiÚ
 .ğ"<İtiÚ v®ue='".
$rs
['Çme']."|".$rs['id']."' ".
$£Ëùed
.">".$rs['name']."</option>\n";

140 
	}
}

142 
»quœe_Úû
(
XAKADMIN
."/templets/group_edit.htm");

	@E:\web\weixun\xakadmin\group_guestbook.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

7 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

8 
CheckPurv›w
('group_Edit');

10 
	g$gid
 = 
is£t
(
$gid
è&& 
is_num”ic
($gid) ? $gid : 0;

11 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

12 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

14 
$keywÜd
 = 
	`is£t
($keywÜdè? 
	$Œim
(
$keywÜd
) : '';

15 
$keywÜd
 = 
	`¡r¦ashes
($keyword);

16 
$keywÜd
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#", " ", 
	`Œim
($keyword));

17 
$keywÜd
 = 
	`add¦ashes
($keyword);

19 
$u£ºame
 = 
	`is£t
($u£ºameè? 
	$Œim
(
$u£ºame
) : '';

20 
$u£ºame
 = 
	`¡r¦ashes
($username);

21 
$u£ºame
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#", " ", 
	`Œim
($username));

22 
$u£ºame
 = 
	`add¦ashes
($username);

24 if(
$gid
 < 1)

26 
	`ShowMsg
("å«æœ‰éæ³•æ“ä½œ!.","-1");

27 
	`ex™
();

28 
	}
}

30 if(
	g$aùiÚ
=="del")

32 if(
$id
 > 0)

34 
$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__group_guestbook WHERE bid='$id'");

37 if(
	g$aùiÚ
=="save")

39 if(
$id
 > 0)

41 
$row
 = 
$db
->
G‘OÃ
("SELECT * FROM #@__group_guestbook WHERE bid='$id'");

42 if(
em±y
(
$mes§ge
))

44 
	g$mes§ge
 = 
$row
['message'];

46 if(
em±y
(
$t™Ë
))

48 
	g$t™Ë
 = 
$row
['title'];

50 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__group_gue¡book SET mes§ge='".
$mes§ge
."',t™Ë='".
$t™Ë
."' WHERE bid='$id'");

53 if(
	g$aùiÚ
=="edit")

55 
$row
 = 
$db
->
G‘OÃ
("SELECT * FROM #@__group_guestbook WHERE bid='$id'");

56 
	g$t™Ë
 = 
$row
['title'];

57 
	g$mes§ge
 = 
$row
['message'];

62 
	g$wh”esql
 = "WHERE gid='{$gid}'";

63 if(!
	$em±y
(
$keywÜd
))

65 
$wh”esql
 .ğ" AND (t™Ë†ik'%".
$keywÜd
."%' OR message†ike '%".$keyword."%')";

66 
	}
}

67 if(!
	$em±y
(
$u£ºame
))

69 
$wh”esql
 .ğ" AND uÇmlik'%".
$u£ºame
."%'";

70 
	}
}

71 
	g$sql
 = "SELECT * FROM #@__group_guestbook $wheresql ORDER BY stime DESC";

73 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

74 
	g$dl
->
	g·geSize
 = 20;

75 
	g$dl
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

76 
	g$dl
->
S‘P¬am‘”
("u£ºame",
$u£ºame
);

77 
	g$dl
->
S‘P¬am‘”
("gid",
$gid
);

80 
	g$dl
->
S‘Tem¶©e
(
XAKADMIN
."/templets/group_guestbook.htm");

81 
	g$dl
->
S‘Sourû
(
$sql
);

82 
	g$dl
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\group_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('group_Main');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

13 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

15 
$keywÜd
 = 
	`is£t
($keywÜdè? 
	$Œim
(
$keywÜd
) : '';

16 
$keywÜd
 = 
	`¡r¦ashes
($keyword);

17 
$keywÜd
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#"," ",
	`Œim
($keyword));

18 
$keywÜd
 = 
	`add¦ashes
($keyword);

20 if(
$aùiÚ
=="close")

22 if(
$id
 > 0)

24 
$db
->
	`Execu‹NÚeQu”y
("UPDATE #@__groups SET ishidden=1 WHERE groupid='$id'");

26 
	}
}

27 if(
	g$aùiÚ
=="open")

29 if(
$id
 > 0)

31 
$db
->
Execu‹NÚeQu”y
("UPDATE #@__groups SET ishidden=0 WHERE groupid='$id'");

34 if(
	g$aùiÚ
=="del")

36 if(
$id
 > 0)

38 
$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__groups WHERE groupid='$id'");

39 
	g$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__group_threads WHERE gid='$id'");

40 
	g$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__group_posts WHERE gid='$id'");

44 
	g$db
->
S‘Qu”y
("SELECT * FROM #@__store_groups WHEREops=0 ORDER BY orders ASC");

45 
	g$db
->
Execu‹
(1);

46 
	g$İtiÚ
 = '';

47 
	g$rs
 = 
$db
->
	$G‘A¼ay
(1))

49 
$İtiÚ
 .ğ"<İtiÚ v®ue='".
$rs
['storeid']."'>".$rs['storename']."</option>\n";

50 
$v
 = 
$rs
['storeid'];

51 
$db
->
	`S‘Qu”y
("SELECT * FROM #@__store_groups WHEREops='{$v}' ORDER BY orders ASC");

52 
$db
->
	`Execu‹
(2);

53 
$rs
 = 
$db
->
	`G‘A¼ay
(2))

55 
$İtiÚ
 .ğ"<İtiÚ v®ue='".
$rs
['storeid']."'>--".$rs['storename']."</option>\n";

57 
	}
}

59 
	g$wh”esql
 = "WHERE groupid>0";

61 if(!
	$em±y
(
$keywÜd
))

63 
$wh”esql
 .ğ" AND (grou²amlik'%".
$keywÜd
."%' OR des†ike '%".$keyword."%' OR creater†ike '%".$keyword."%')";

64 
	}
}

65 if(!
	$is£t
(
$u£ºame
))

67 
$u£ºame
 = '';

68 
	}
}

69 if(!
	$em±y
(
$u£ºame
))

71 
$wh”esql
 .ğ" AND c»©”†ik'%".
$u£ºame
."%'";

72 
	}
}

73 if(!
	$is£t
(
$¡Üe
))

75 
$¡Üe
 = -1;

76 
	}
}

77 if(
	g$¡Üe
 > 0)

79 
	g$wh”esql
 .ğ" AND (¡Üeid='".
$¡Üe
."' OR„ootstoreid='".$store."')";

81 
	g$sql
 = "SELECT * FROM #@__groups $wheresql ORDER BY stime DESC";

83 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

84 
	g$dl
->
	g·geSize
 = 20;

85 
	g$dl
->
S‘P¬am‘”
("u£ºame",
$u£ºame
);

86 
	g$dl
->
S‘P¬am‘”
("¡Üe",
$¡Üe
);

87 
	g$dl
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

90 
	g$dl
->
S‘Tem¶©e
(
XAKADMIN
."/templets/group_main.htm");

91 
	g$dl
->
S‘Sourû
(
$sql
);

92 
	g$dl
->
Di¥Ïy
();

94 
funùiÚ
 
	$G‘Group¡Üe
(
$id
)

96 
glob®
 
$db
;

97 
$row
 = 
$db
->
	`G‘OÃ
("SELECT storename,tops FROM #@__store_groups WHERE storeid='{$id}'");

98 if(
	`is_¬¿y
(
$row
))

100 
$¡Üe
 = 
$row
['storename'];

101 if(!
$row
['tops'])

103  
$row
['storename'];

107 
$rs
 = 
$db
->
	`G‘OÃ
("SELECT stÜ’amFROM #@__¡Üe_group WHERE stÜeid='".
$row
['tops']."'");

108  
$rs
['¡Ü’ame'].">".
$¡Üe
;

113  
çl£
;

115 
	}
}

	@E:\web\weixun\xakadmin\group_notice.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

9 
CheckPurv›w
('group_Edit');

11 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

12 
	g$gid
 = 
is£t
(
$gid
è&& 
is_num”ic
($gid) ? $gid : 0;

13 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

15 
$keywÜd
 = 
	`is£t
($keywÜdè? 
	$Œim
(
$keywÜd
) : '';

16 
$keywÜd
 = 
	`¡r¦ashes
($keyword);

17 
$keywÜd
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#", " ", 
	`Œim
($keyword));

18 
$keywÜd
 = 
	`add¦ashes
($keyword);

20 
$u£ºame
 = 
	`is£t
($u£ºameè? 
	$Œim
(
$u£ºame
) : '';

21 
$u£ºame
 = 
	`¡r¦ashes
($username);

22 
$u£ºame
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#", " ", 
	`Œim
($username));

23 
$u£ºame
 = 
	`add¦ashes
($username);

25 if(
$gid
 < 1)

27 
	`ShowMsg
("å«æœ‰éæ³•æ“ä½œ!.","-1");

28 
	`ex™
();

29 
	}
}

31 if(
	g$aùiÚ
=="del")

33 if(
$id
 > 0)

35 
$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__group_notice WHERE id='$id'");

38 if(
	g$aùiÚ
=="edit")

40 
$row
 = 
$db
->
G‘OÃ
("SELECT * FROM #@__group_notice WHERE id='$id'");

41 
	g$t™Ë
 = 
$row
['title'];

42 
	g$nÙiû
 = 
$row
['notice'];

44 if(
	g$aùiÚ
=="save")

46 
$row
 = 
$db
->
G‘OÃ
("SELECT * FROM #@__group_notice WHERE id='$id'");

47 if(
em±y
(
$t™Ë
))

49 
	g$t™Ë
 = 
$row
['title'];

51 if(
em±y
(
$nÙiû
))

53 
	g$nÙiû
 = 
$row
['notice'];

55 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__group_nÙiû SET‚Ùiû='".
$nÙiû
."',t™Ë='".
$t™Ë
."' WHERE id='$id'");

57 
un£t
(
$row
);

60 
	g$wh”esql
 = "WHERE gid='{$gid}'";

61 if(!
	$em±y
(
$keywÜd
))

63 
$wh”esql
 .ğ" AND (t™Ë†ik'%".
$keywÜd
."%' OR‚otice†ike '%".$keyword."%')";

64 
	}
}

65 if(!
	$em±y
(
$u£ºame
))

67 
$wh”esql
 .ğ" AND uÇmlik'%".
$u£ºame
."%'";

68 
	}
}

69 
	g$sql
 = "SELECT * FROM #@__group_notice $wheresql ORDER BY stime DESC";

71 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

72 
	g$dl
->
	g·geSize
 = 20;

73 
	g$dl
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

74 
	g$dl
->
S‘P¬am‘”
("u£ºame",
$u£ºame
);

75 
	g$dl
->
S‘P¬am‘”
("gid",
$gid
);

78 
	g$dl
->
S‘Tem¶©e
(
XAKADMIN
."/templets/group_notice.htm");

79 
	g$dl
->
S‘Sourû
(
$sql
);

80 
	g$dl
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\group_store.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('group_Store');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

13 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

15 if(
$aùiÚ
=="add")

17 
$¡Ü’ame
 = 
	`ú_sub¡rR
(
	`HtmlR•Ïû
($storename, 2),20);

18 
$tİs
 = 
	`´eg_»¶aû
("#[^0-9]#","",$tops);

19 
$Üd”s
 = 
	`´eg_»¶aû
("#[^0-9]#","",$orders);

20 if(
$tİs
 < 1)

22 
$tİs
 = 0;

24 if(
$Üd”s
 < 1)

26 
$Üd”s
 = 0;

28 if(
	`em±y
(
$¡Ü’ame
))

30 
$msg
 = "é”™è¯¯,åˆ†ç±»åä¸èƒ½ä¸ºç©º!";

34 
$db
->
	`Execu‹NÚeQu”y
("INSERT INTO #@__¡Üe_groups(¡Ü’ame,tİs,Üd”sèVALUES('".
$¡Ü’ame
."','".
$tİs
."','".
$Üd”s
."');");

35 
$msg
 = "æˆåŠŸæ·»åŠ åˆ†ç±»";

37 
	}
}

38 if(
	g$aùiÚ
=="d–"&&
	$is£t
(
$id
))

40 
$db
->
	`Execu‹NÚeQu”y
("DELETE FROM #@__store_groups WHERE storeid='$id'");

41 
$msg
 = "åˆ é™¤åˆ†ç±»ï¼š{$id} ï¼";

42 
	}
}

43 
	g$bty³s
 = 
¬¿y
();

44 
	g$db
->
S‘Qu”y
("SELECT * FROM #@__store_groups WHEREops=0");

45 
	g$db
->
Execu‹
();

46 
	g$İtiÚs
 = '';

47 
	g$rs
 = 
$db
->
	$G‘A¼ay
())

49 
	`¬¿y_push
 (
$bty³s
,
$rs
);

50 
	}
}

51 
fÜ—ch
(
$bty³s
 
as
 
$k
=>
$v
)

53 
$İtiÚs
 .ğ"<İtiÚ v®ue='".
$v
['storeid']."'>".$v['storename']."</option>\r\n";

60 if(
	g$aùiÚ
=='editload')

62 
$row
 = 
$db
->
G‘OÃ
("Select * From #@__store_groups where storeid='$catid'");

63 
AjaxH—d
();

65 <
fÜm
 
	gÇme
='ed™fÜm' 
aùiÚ
='group_¡Üe.php' 
m‘hod
='get'>

66 <
šput
 
ty³
='hidd’' 
Çme
='aùiÚ' 
v®ue
='editsave' />

67 <
šput
 
ty³
='hidd’' 
Çme
='ÿtid' 
v®ue
='<?phpƒcho $catid; ?>' />

68 <
bË
 
width
="100%" 
bÜd”
="0" 
ûÎ¥acšg
="0" 
ûÎ·ddšg
="0">

69 <
Œ
>

70 <
td
 
width
="90" 
height
="28">æ ç›®åç§°ï¼š</td>

71 <
td
 
width
="101"><
šput
 
Çme
="¡Ü’ame" 
ty³
="‹xt" 
id
="¡Ü’ame" 
v®ue
="<?phpƒcho $row['storename']; ?>" /></td>

72 <
td
 
width
="20" 
®ign
="right" 
v®ign
="top"></td>

73 </
Œ
>

74 <
Œ
>

75 <
td
 
height
="28">éš¶å±æ ç›®ï¼š</td>

76 <
td
 
cŞ¥ª
="2">

77 <
£Ëù
 
Çme
="tİs" 
id
="tops">

78 <
İtiÚ
 
v®ue
="0">é¡¶çº§æ ç›®</option>

79 <?
php


80 
fÜ—ch
(
$bty³s
 
as
 
$k
=>
$v
)

82 if(
$row
['tİs']==
$v
['storeid'])

84 
echo
 "<İtiÚ v®ue='".
$v
['storeid']."' selected>".$v['storename']."</option>\r\n";

88 
	gecho
 "<İtiÚ v®ue='".
	g$v
['storeid']."'>".$v['storename']."</option>\r\n";

92 </
	g£Ëù
>

93 </
	gtd
>

94 </
	gŒ
>

95 <
	gŒ
>

96 <
td
 
	gheight
="28">æ’åºçº§åˆ«ï¼š</td>

97 <
td
 
cŞ¥ª
="2"><
šput
 
Çme
="Üd”s" 
ty³
="‹xt" 
id
="Üd”s" 
size
="5" 
v®ue
="<?phpƒcho $row['orders']; ?>" />

98 ï¼ˆæ•°å€¼å°é å‰ï¼‰</
td
>

99 </
Œ
>

100 <
Œ
>

101 <
td
 
height
="43">&
nb¥
;</
	gtd
>

102 <
td
 
	gcŞ¥ª
="2"><
šput
 
ty³
="subm™" 
Çme
="Subm™" 
v®ue
="ä¿å­˜æ›´æ”¹" 
şass
="Å coŞbg" 
¡yË
="width:80px"/></td>

103 </
Œ
>

104 </
bË
>

105 </
fÜm
>

106 <?
php


108 
ex™
();

110 if(
	g$aùiÚ
=='editsave')

112 
$db
->
Execu‹NÚeQu”y
("UPDATE #@__store_groups SET storename='$storename',tops='$tops',orders='$orders' WHERE storeid='$catid'");

113 
	g$msg
 = "æˆåŠŸä¿®æ”¹æ ç›®ï¼š{$catid} = {$storename} ï¼";

115 if(
	g$aùiÚ
=='uprank')

117 
fÜ—ch
(
$_POST
 
as
 
$rk
=>
$rv
)

119 if(
´eg_m©ch
('#¿nk#i',
$rk
))

121 
$ÿtid
 = 
¡r_»¶aû
('¿nk_','',
$rk
);

122 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__store_groups SET orders='{$rv}' WHERE storeid='{$catid}'");

125 
	g$msg
 = "æˆåŠŸæ›´æ”¹æ’åº ï¼";

128 
	g$sql
 = "SELECT storeid,storename,tops,orders FROM #@__store_groups WHEREops=0 ORDER BY orders ASC";

130 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

131 
	g$dl
->
	g·geSize
 = 20;

134 
	g$dl
->
S‘Tem¶©e
(
XAKADMIN
."/templets/group_store.htm");

135 
	g$dl
->
S‘Sourû
(
$sql
);

136 
	g$dl
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\group_threads.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('group_Main');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

13 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

15 
$keywÜd
 = 
	`is£t
($keywÜdè? 
	$Œim
(
$keywÜd
) : '';

16 
$keywÜd
 = 
	`¡r¦ashes
($keyword);

17 
$keywÜd
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#"," ",
	`Œim
($keyword));

18 
$keywÜd
 = 
	`add¦ashes
($keyword);

20 
$u£ºame
 = 
	`is£t
($u£ºameè? 
	$Œim
(
$u£ºame
) : '';

21 
$u£ºame
 = 
	`¡r¦ashes
($username);

22 
$u£ºame
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#"," ",
	`Œim
($username));

23 
$u£ºame
 = 
	`add¦ashes
($username);

25 if(!
	$em±y
(
$ids
))

27 
	`fÜ—ch
(
$ids
 
as
 
$v®
)

29 
$db
->
	`Execu‹NÚeQu”y
("DELETE FROM #@__group_threads WHEREid='{$val}'");

30 
$db
->
	`Execu‹NÚeQu”y
("DELETE FROM #@__group_posts WHEREid='$val'");

32 
	}
}

34 if(
	g$aùiÚ
 !ğ'' && 
$id
<1)

36 
ShowMsg
("æœªå®šä¹‰çš„æ“ä½œï¼","-1");

37 
ex™
();

41 if(
	g$aùiÚ
=="del")

43 if(
$id
 > 0)

45 
$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__group_threads WHEREid='$id'");

46 
	g$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__group_posts WHEREid='$id'");

49 if(
	g$aùiÚ
=="digest")

52 
$rs
 = 
$db
->
G‘OÃ
("SELECT dige¡ FROM #@__group_th»ad WHEREid='".
$id
."'");

53 if(
is_¬¿y
(
$rs
))

55 if(!
	g$rs
['digest'])

57 
	g$dige¡v®
 = 1;

61 
	g$dige¡v®
 = 0;

63 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__group_threads SET digest='$digestval' WHEREid='$id'");

66 if(
	g$aùiÚ
=="close")

69 
$rs
 = 
$db
->
G‘OÃ
("SELECT clo£d FROM #@__group_th»ad WHEREid='".
$id
."'");

70 if(
is_¬¿y
(
$rs
))

72 if(!
	g$rs
['closed'])

74 
	g$şo£v®
 = 1;

78 
	g$şo£v®
 = 0;

80 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__group_threads SET closed='$closeval' WHEREid='$id'");

83 if(
	g$aùiÚ
=="top")

86 
$rs
 = 
$db
->
G‘OÃ
("SELECT di¥ÏyÜd” FROM #@__group_th»ad WHEREid='".
$id
."'");

87 if(
is_¬¿y
(
$rs
))

89 if(!
	g$rs
['displayorder'])

91 
	g$di¥Ïyv®
 = 1;

95 
	g$di¥Ïyv®
 = 0;

97 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__group_threads SET displayorder='$displayval' WHEREid='$id'");

100 if(!
is£t
(
$Üd”s
)è
	g$Üd”s
 = '';

103 
	g$wh”esql
 = "WHEREid>0";

104 
	g$sqlÜd”s
 = "ORDER BY displayorder DESC,";

105 ià(
is£t
(
$gid
è&& !
	$em±y
(
$gid
))

107 
$wh”esql
 .= " AND gid=$gid";

108 
	}
}

110 if(
	g$Üd”s
=="digest")

112 
$wh”esql
 .= " AND digest=1";

114 if(
	g$Üd”s
=="close")

116 
$wh”esql
 .= " AND closed=1";

118 if(!
	$em±y
(
$keywÜd
))

120 
$wh”esql
 .ğ" AND subjeù†ik'%".
$keywÜd
."%'";

121 
	}
}

122 if(!
	$em±y
(
$u£ºame
))

124 
$wh”esql
 .ğ" AND (authÜ†ik'%".
$u£ºame
."%' OR†astposter†ike '%".$username."%')";

125 
	}
}

126 if(
	g$Üd”s
=="rep")

128 
$sqlÜd”s
 = "ORDER BY„eplies DESC,";

130 
	g$sqlÜd”s
 .= " dateline DESC";

132 
	g$sql
 = "SELECT * FROM #@__group_threads $wheresql $sqlorders";

134 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

135 
	g$dl
->
	g·geSize
 = 20;

136 
	g$dl
->
S‘P¬am‘”
("u£ºame", 
$u£ºame
);

137 
	g$dl
->
S‘P¬am‘”
("Üd”s", 
$Üd”s
);

138 
	g$dl
->
S‘P¬am‘”
("keywÜd", 
$keywÜd
);

141 
	g$dl
->
S‘Tem¶©e
(
XAKADMIN
."/templets/group_threads.htm");

142 
	g$dl
->
S‘Sourû
(
$sql
);

143 
	g$dl
->
Di¥Ïy
();

145 
funùiÚ
 
	$G‘Grou²ame
(
$id
)

147 
glob®
 
$db
;

148 
$rs
 = 
$db
->
	`G‘OÃ
("SELECT grou²amFROM #@__group WHERE groupid='".
$id
."'");

149 if(
	`is_¬¿y
(
$rs
))  $rs['groupname'];

150 
»tuº_nuÎs
;

151 
	}
}

	@E:\web\weixun\xakadmin\group_user.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

9 
CheckPurv›w
('group_Edit');

11 
	g$gid
 = 
is£t
(
$gid
è&& 
is_num”ic
($gid) ? $gid : 0;

12 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

13 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

15 
$u£ºame
 = 
	`is£t
($u£ºameè? 
	$Œim
(
$u£ºame
) : '';

16 
$u£ºame
 = 
	`¡r¦ashes
($username);

17 
$u£ºame
 = 
	`´eg_»¶aû
("#[\"\r\n\t\*\?\(\)\$%']#", " ", 
	`Œim
($username));

18 
$u£ºame
 = 
	`add¦ashes
($username);

20 if(
$gid
 < 1)

22 
	`ShowMsg
("å«æœ‰éæ³•æ“ä½œ!.","-1");

23 
	`ex™
();

24 
	}
}

26 
	g$row
 = 
$db
->
G‘OÃ
("SELECT ismaster,uid FROM #@__groups WHERE groupid='{$gid}'");

27 
	g$isma¡”
 = 
$row
['ismaster'];

28 
	g$isma¡”id
 = 
$row
['uid'];

30 if(
	g$aùiÚ
=="del")

32 if(
$isma¡”id
 =ğ
$id
)

34 
ShowMsg
("åœˆä¸»ä¸èƒ½è„±ç¦»ç¾¤å…³ç³»!","-1");

35 
ex™
();

37 
	g$row
 = 
$db
->
G‘OÃ
("SELECT username FROM #@__group_user WHERE uid='$id' AND gid='$gid'");

38 if(
is_¬¿y
(
$row
))

40 
	g$u£ºame
 = 
$row
['username'];

41 
	g$ma¡”
 = 
ex¶ode
(",",
$isma¡”
);

42 if(
š_¬¿y
(
$u£ºame
,
$ma¡”
))

45 
	g$k
 = 
¬¿y_£¬ch
(
$u£ºame
,
$ma¡”
);

46 
un£t
(
$ma¡”
[
$k
]);

48 
	g$ma¡”
 = 
¬¿y_f‹r
(
$ma¡”
, "filter");

49 
	g$isma¡”
 = 
im¶ode
(",",
$ma¡”
);

50 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__groups SET ismaster='{$ismaster}' WHERE groupid='{$gid}'");

52 if(
	g$id
 > 0)

54 
	g$db
->
Execu‹NÚeQu”y
("DELETE FROM #@__group_user WHERE uid='$id' AND gid='$gid'");

56 
ShowMsg
("å·²å°†è¯¥ä¼šå‘˜ç§»å‡ºæœ¬ç¾¤!.","-1");

57 
ex™
();

59 if(
	g$aùiÚ
=="admin")

61 if(
$isma¡”id
 =ğ
$id
)

63 
ShowMsg
("åœˆä¸»åº”åŒæ—¶æœ‰ç®¡ç†æƒ!","-1");

64 
ex™
();

66 
	g$row
 = 
$db
->
G‘OÃ
("SELECT username FROM #@__group_user WHERE uid='$id' AND gid='$gid'");

67 if(
is_¬¿y
(
$row
))

69 
	g$u£ºame
 = 
$row
['username'];

70 
	g$ma¡”
 = 
ex¶ode
(",",
$isma¡”
);

71 if(
š_¬¿y
(
$u£ºame
,
$ma¡”
))

74 
	g$k
 = 
¬¿y_£¬ch
(
$u£ºame
,
$ma¡”
);

75 
un£t
(
$ma¡”
[
$k
]);

76 
	g$msg
 = "å·²å°† {$username},è®¾ä¸ºæ™®é€šä¼šå‘˜!";

81 
¬¿y_push
(
$ma¡”
,
$u£ºame
);

82 
	g$msg
 = "å·²å°† {$username},è®¾ä¸ºç®¡ç†å‘˜!";

84 
	g$ma¡”
 = 
¬¿y_f‹r
(
$ma¡”
, "filter");

85 
	g$isma¡”
 = 
im¶ode
(",",
$ma¡”
);

86 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__groups SET ismaster='{$ismaster}' WHERE groupid='{$gid}'");

88 
ShowMsg
("{$msg}","-1");

89 
ex™
();

91 if(
	g$aùiÚ
=="add")

93 
$uÇme
 = 
ú_sub¡r
($uname,15);

94 if(
em±y
(
$uÇme
))

96 
ShowMsg
("è¯·å¡«å†™ç”¨æˆ·å!.","-1");

97 
ex™
();

99 
	g$rs
 = 
$db
->
G‘OÃ
("SELECT COUNT(*) AS c FROM #@__group_user WHERE username†ike '$uname' AND gid='$gid'");

100 if(
	g$rs
['c'] > 0)

102 
ShowMsg
("ç”¨æˆ·å·²åŠ å…¥è¯¥åœˆå­!.","-1");

103 
ex™
();

105 
	g$row
 = 
$db
->
G‘OÃ
("SELECT userid,mid FROM `#@__member_list` WHERE userid†ike '$uname'");

106 if(!
is_¬¿y
(
$row
))

108 
ShowMsg
("ç«™å†…ä¸å­˜åœ¨è¯¥ç”¨æˆ·!.","-1");

109 
ex™
();

113 
	g$row
['id'] = 
$row
['mid'];

114 
	g$db
->
Execu‹NÚeQu”y
("INSERT INTO #@__group_u£r(uid,u£ºame,gid,joštimeèVALUES('".
$row
['id']."','".$row['u£rid']."','$gid','".
time
()."');");

116 if(
	g$£tma¡”
)

118 
	g$ma¡”
 = 
ex¶ode
(",",
$isma¡”
);

119 
¬¿y_push
(
$ma¡”
,
$uÇme
);

120 
	g$ma¡”
 = 
¬¿y_f‹r
(
$ma¡”
, "filter");

121 
	g$isma¡”
 = 
im¶ode
(",",
$ma¡”
);

122 
	g$db
->
Execu‹NÚeQu”y
("UPDATE #@__groups SET ismaster='{$ismaster}' WHERE groupid='{$gid}'");

125 
ShowMsg
("æˆåŠŸæ·»åŠ ç”¨æˆ·:{$uname}","-1");

126 
ex™
();

130 
	g$wh”esql
 = "WHERE gid='{$gid}'";

131 if(!
	$em±y
(
$u£ºame
))

133 
$wh”esql
 .ğ" AND u£ºamlik'%".
$u£ºame
."%'";

134 
	}
}

135 
	g$sql
 = "SELECT * FROM #@__group_user $wheresql ORDER BY jointime DESC";

138 
	g$dl
 = 
Ãw
 
D©aLi¡CP
();

139 
	g$dl
->
	g·geSize
 = 20;

140 
	g$dl
->
S‘P¬am‘”
("u£ºame",
$u£ºame
);

141 
	g$dl
->
S‘P¬am‘”
("id",
$id
);

142 
	g$dl
->
S‘P¬am‘”
("gid",
$gid
);

145 
	g$dl
->
S‘Tem¶©e
(
XAKADMIN
."/templets/group_user.htm");

146 
	g$dl
->
S‘Sourû
(
$sql
);

147 
	g$dl
->
Di¥Ïy
();

150 
funùiÚ
 
	$f‹r
(
$v¬
)

152  
$v¬
 =ğ'' ? 
çl£
 : 
Œue
;

153 
	}
}

155 
funùiÚ
 
	$G‘Ma¡”
(
$u£r
)

157 
glob®
 
$isma¡”
;

158 
$ma¡”
 = 
	`ex¶ode
(",",
$isma¡”
);

159 if(
	`š_¬¿y
(
$u£r
,
$ma¡”
))

167 
	}
}

	@E:\web\weixun\xakadmin\imagecut.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

9 if(
	$em±y
(
$aùiÚ
))

11 if(!@
	`is_fe
(
$cfg_ba£dœ
.
$fe
))

13 
	`ShowMsg
("å¯¹ä¸èµ·ï¼Œå¿…é¡»é€‰æ‹©ç«™å†…çš„å›¾ç‰‡æ‰èƒ½è¿›è¡Œè£å‰ªï¼<br />ç‚¹å‡»'<a href='/include/dialog/select_images.php?f=form1.picname&imgstick=small'>ç«™å†…é€‰æ‹©</a>', ä¸Šä¼ æˆ–é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡ï¼Œç„¶åæ‰èƒ½è¿›è¡Œè£å‰ªï¼", "../functions/dialog/select_images.php?f=form1.picname&imgstick=small", 0 , 10000);

14 
	`ex™
();

16 
šşude
 
XAKADMIN
.'/templets/imagecut.htm';

17 
	`ex™
();

18 
	}
}

19 
–£if
(
$aùiÚ
 == 'cut')

21 
»quœe_Úû
(
XAKINC
.'/image.func.php');

23 if(!@
is_fe
(
$cfg_ba£dœ
.
$fe
))

25 
ShowMsg
('å¯¹ä¸èµ·ï¼Œè¯·é‡æ–°é€‰æ‹©è£å‰ªå›¾ç‰‡ï¼', '-1');

26 
ex™
();

28 if(
em±y
(
$width
))

30 
ShowMsg
('å¯¹ä¸èµ·ï¼Œè¯·é€‰æ‹©è£å‰ªå›¾ç‰‡çš„å°ºå¯¸ï¼', '-1');

31 
ex™
();

33 if(
em±y
(
$height
))

35 
ShowMsg
('å¯¹ä¸èµ·ï¼Œè¯·é€‰æ‹©è£å‰ªå›¾ç‰‡çš„å°ºå¯¸ï¼', '-1');

36 
ex™
();

38 
	g$imgšfo
 = 
g‘imagesize
(
$cfg_ba£dœ
.
$fe
);

39 
	g$imgw
 = 
$imgšfo
[0];

40 
	g$imgh
 = 
$imgšfo
[1];

41 
	g$‹mp
 = 400/
$imgw
;

42 
	g$Ãwwidth
 = 400;

43 
	g$Ãwheight
 = 
$imgh
 * 
$‹mp
;

44 
	g$¤cFe
 = 
$cfg_ba£dœ
.
$fe
;

45 
	g$thumb
 = 
imageü—‹ŒuecŞÜ
(
$Ãwwidth
, 
$Ãwheight
);

46 
	g$thumba
 = 
imageü—‹ŒuecŞÜ
(
$width
, 
$height
);

48 
	g$imgšfo
['mime'])

51 
$sourû
 = 
imageü—‹äomj³g
(
$¤cFe
);

54 
$sourû
 = 
imageü—‹äomgif
(
$¤cFe
);

57 
$sourû
 = 
imageü—‹äom²g
(
$¤cFe
);

60 
ShowMsg
('å¯¹ä¸èµ·ï¼Œè£å‰ªå›¾ç‰‡ç±»å‹ä¸æ”¯æŒè¯·é€‰æ‹©å…¶ä»–ç±»å‹å›¾ç‰‡ï¼', '-1');

64 
imagecİy»sized
(
$thumb
, 
$sourû
, 0, 0, 0, 0 , 
$Ãwwidth
, 
$Ãwheight
, 
$imgw
, 
$imgh
);

65 
imagecİy
(
$thumba
, 
$thumb
, 0, 0, 
$Ëá
, 
$tİ
, 
$Ãwwidth
, 
$Ãwheight
);

67 
	g$ddn
 = 
sub¡r
(
$¤cFe
, -3);

69 
	g$ddpicok
 = 
$»ObjJs
 = '';

70 ifĞ
em±y
(
$isu¶ßd
) )

72 
	g$ddpicok
 = 
´eg_»¶aû
("#\.".
$ddn
."$#", '-Í.'.$ddn, 
$fe
);

73 
	g$»ObjJs
 = " var backObj = window.opener.document.form1.picname;

74 
v¬
 
´vObj
 = 
wšdow
.
İ’”
.
docum’t
.
g‘EËm’tById
('divpicv›w');\
	gr
\
	gn
";

78 
	g$ddpicok
 = 
$fe
;

79 
	g$»ObjJs
 = " var backObj = window.opener.parent.document.form1.picname;

80 
v¬
 
´vObj
 = 
wšdow
.
İ’”
.
·»Á
.
docum’t
.
g‘EËm’tById
('divpicv›w');\
	gr
\
	gn
";

83 
	g$ddpicoku¾
 = 
$cfg_ba£dœ
.
$ddpicok
;

85 
	g$imgšfo
['mime'])

88 
imagej³g
(
$thumba
, 
$ddpicoku¾
, 85);

91 
imagegif
(
$thumba
, 
$ddpicoku¾
);

94 
imag•ng
(
$thumba
, 
$ddpicoku¾
);

97 
ShowMsg
("å¯¹ä¸èµ·ï¼Œè£å‰ªå›¾ç‰‡ç±»å‹ä¸æ”¯æŒè¯·é€‰æ‹©å…¶ä»–ç±»å‹å›¾ç‰‡ï¼", "-1");

102 if(
	g$Ãwwidth
 > 
	g$cfg_ddimg_width
 || 
	g$Ãwheight
 > 
	g$cfg_ddimg_height
)

104 
ImageResize
(
$ddpicoku¾
, 
$cfg_ddimg_width
, 
$cfg_ddimg_height
);

108 ifĞ
em±y
(
$isu¶ßd
) )

110 
	g$šqu”y
 = "INSERT INTO `#@__uploads`(title,url,mediatype,width,height,playtime,filesize,uptime,mid)

111 
VALUES
 ('$ddpicok','$ddpicok','1','0','0','0','".filesize($ddpicokurl)."','".time()."','".$cuserLogin->getUserID()."'); ";

112 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

113 
	g$fid
 = 
$dsql
->
G‘La¡ID
();

114 
AddMyAddÚ
(
$fid
, 
$ddpicok
);

118 <
SCRIPT
 
	gÏnguage
=
JavaSüt
>

119 
funùiÚ
 
R‘uºImg
(
»img
)

121 <?
php
 
echo
 
$»ObjJs
; ?>

122 
	gbackObj
.
	gv®ue
 = 
»img
;

123 if(
	g´vObj
)

125 
	g´vObj
.
	g¡yË
.
	gwidth
 = '150px';

126 
	g´vObj
.
	gšÃrHTML
 = "<img src='"+
»img
+"?n' width='150' />";

128 if(
	gdocum’t
.
	g®l
) {

129 
	gwšdow
.
	gİ’”
=
Œue
;

131 
	gwšdow
.
şo£
();

133 
R‘uºImg
("<?phpƒcho $ddpicok; ?>");

134 </
	gSCRIPT
>

135 <?
	gphp


	@E:\web\weixun\xakadmin\inc\inc_action_info.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

8 
	g$cu£rLogš
 = 
Ãw
 
u£rLogš
();

10 
	g$aùiÚS—rch
[0] =
¬¿y
(

14 'sÚ™”m' => 
¬¿y
(

15 0 => 
¬¿y
(

21 1 => 
¬¿y
(

27 2 => 
¬¿y
(

31 'lšku¾' =>'cÚ‹Á_li¡.php?mid='.
$cu£rLogš
->
u£rID


33 3 => 
¬¿y
(

39 4 => 
¬¿y
(

47 
	g$aùiÚS—rch
[1] = 
¬¿y
(

51 'sÚ™”m' => 
¬¿y
(

52 0 => 
¬¿y
(

60 
	g$aùiÚS—rch
[2] = 
¬¿y
(

64 'sÚ™”m' => 
¬¿y
(

65 0 => 
¬¿y
(

71 1 => 
¬¿y
(

77 2 => 
¬¿y
(

85 
	g$aùiÚS—rch
[3] = 
¬¿y
(

89 'sÚ™”m' => 
¬¿y
(

90 0 => 
¬¿y
(

98 
	g$aùiÚS—rch
[4] = 
¬¿y
(

102 'sÚ™”m' => 
¬¿y
(

103 0 => 
¬¿y
(

109 1 => 
¬¿y
(

115 2 => 
¬¿y
(

121 3 => 
¬¿y
(

127 4 => 
¬¿y
(

133 5 => 
¬¿y
(

139 6 => 
¬¿y
(

147 
	g$aùiÚS—rch
[5] = 
¬¿y
(

151 'sÚ™”m' => 
¬¿y
(

152 0 => 
¬¿y
(

158 1 => 
¬¿y
(

166 
	g$aùiÚS—rch
[6] = 
¬¿y
(

170 'sÚ™”m' => 
¬¿y
(

171 0 => 
¬¿y
(

177 1 => 
¬¿y
(

183 2 => 
¬¿y
(

189 3 => 
¬¿y
(

197 
	g$aùiÚS—rch
[7] = 
¬¿y
(

201 'sÚ™”m' => 
¬¿y
(

202 0 => 
¬¿y
(

208 1 => 
¬¿y
(

216 
	g$aùiÚS—rch
[8] = 
¬¿y
(

220 'sÚ™”m' => 
¬¿y
(

221 0 => 
¬¿y
(

227 1 => 
¬¿y
(

233 2 => 
¬¿y
(

241 
	g$aùiÚS—rch
[9] = 
¬¿y
(

245 'sÚ™”m' => 
¬¿y
(

246 0 => 
¬¿y
(

252 1 => 
¬¿y
(

260 
	g$aùiÚS—rch
[10] = 
¬¿y
(

264 'sÚ™”m' => 
¬¿y
(

265 0 => 
¬¿y
(

271 1 => 
¬¿y
(

277 2 => 
¬¿y
(

283 3 => 
¬¿y
(

289 4 => 
¬¿y
(

295 5 => 
¬¿y
(

301 6 => 
¬¿y
(

307 7 => 
¬¿y
(

313 8 => 
¬¿y
(

319 9 => 
¬¿y
(

327 
	g$aùiÚS—rch
[11] = 
¬¿y
(

331 'sÚ™”m' => 
¬¿y
(

332 0 => 
¬¿y
(

338 1 => 
¬¿y
(

344 2 => 
¬¿y
(

350 3 => 
¬¿y
(

356 4 => 
¬¿y
(

362 5 => 
¬¿y
(

	@E:\web\weixun\xakadmin\inc\inc_admin_channel.php

1 <?
php


12 
funùiÚ
 
	$G‘F›ldMake
(
$dty³
, 
$f›ldÇme
, 
$dfv®ue
, 
$mxËn
)

14 
$f›lds
 = 
	`¬¿y
();

15 if(
$dty³
 == "int" || $dtype == "datetime")

17 if(
$dfv®ue
 =ğ"" || 
	`´eg_m©ch
("#[^0-9-]#", $dfvalue))

19 
$dfv®ue
 = 0;

21 
$f›lds
[0] = " `$fieldname` int(11) NOT NULL default '$dfvalue';";

22 
$f›lds
[1] = "int(11)";

24 if(
$dty³
 == "stepselect")

26 if(
$dfv®ue
 =ğ"" || 
	`´eg_m©ch
("#[^0-9\.-]#", $dfvalue))

28 
$dfv®ue
 = 0;

30 
$f›lds
[0] = " `$fieldname` char(20) NOT NULL default '$dfvalue';";

31 
$f›lds
[1] = "char(20)";

33 if(
$dty³
 == "float")

35 if(
$dfv®ue
 =ğ"" || 
	`´eg_m©ch
("#[^0-9\.-]#", $dfvalue))

37 
$dfv®ue
 = 0;

39 
$f›lds
[0] = " `$fieldname` float NOT NULL default '$dfvalue';";

40 
$f›lds
[1] = "float";

42 if(
$dty³
 == "img" || $dtype == "media" || $dtype == "addon" || $dtype == "imgfile")

44 if(
	`em±y
(
$dfv®ue
)) $dfvalue = '';

45 if(
$mxËn
=="") $mxlen = 200;

46 if(
$mxËn
 > 255) $mxlen = 100;

48 
$f›lds
[0] = " `$fieldname` varchar($mxlen) NOT NULL default '$dfvalue';";

49 
$f›lds
[1] = "varchar($mxlen)";

51 if(
$dty³
 == "multitext" || $dtype == "htmltext")

53 
$f›lds
[0] = " `$fieldname` mediumtext;";

54 
$f›lds
[1] = "mediumtext";

56 if(
$dty³
=="textdata")

58 if(
	`em±y
(
$dfv®ue
)) $dfvalue = '';

60 
$f›lds
[0] = " `$fieldname` varchar(100) NOT NULL default '';";

61 
$f›lds
[1] = "varchar(100)";

63 if(
$dty³
=="textchar")

65 if(
	`em±y
(
$dfv®ue
)) $dfvalue = '';

67 
$f›lds
[0] = " `$fieldname` char(100) NOT NULL default '$dfvalue';";

68 
$f›lds
[1] = "char(100)";

70 if(
$dty³
=="checkbox")

72 
$dfv®ue
 = 
	`¡r_»¶aû
(',',"','",$dfvalue);

73 
$dfv®ue
 = "'".$dfvalue."'";

74 
$f›lds
[0] = " `$fieldname` SET($dfvalue) NULL;";

75 
$f›lds
[1] = "SET($dfvalue)";

77 if(
$dty³
=="select" || $dtype=="radio")

79 
$dfv®ue
 = 
	`¡r_»¶aû
(',', "','", $dfvalue);

80 
$dfv®ue
 = "'".$dfvalue."'";

81 
$f›lds
[0] = " `$fieldname`ƒnum($dfvalue) NULL;";

82 
$f›lds
[1] = "enum($dfvalue)";

86 if(
	`em±y
(
$dfv®ue
))

88 
$dfv®ue
 = '';

90 if(
	`em±y
(
$mxËn
))

92 
$mxËn
 = 100;

94 if(
$mxËn
 > 255)

96 
$mxËn
 = 250;

98 
$f›lds
[0] = " `$fieldname` varchar($mxlen) NOT NULL default '$dfvalue';";

99 
$f›lds
[1] = "varchar($mxlen)";

101  
$f›lds
;

102 
	}
}

112 
funùiÚ
 
	$G‘AddF›ldLi¡
(&
$d
,&
$ok£‰šg
)

114 
$okli¡
 = '';

115 
$d
->
	`S‘NameS·û
("field","<",">");

116 
$d
->
	`LßdSourû
(
$ok£‰šg
);

117 if(
	`is_¬¿y
(
$d
->
CTags
))

119 
	`fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

121 if(
$ùag
->
	`G‘A‰
('islist')==1)

123 
$okli¡
 .ğ($okli¡=='' ? 
	`¡¹Şow”
(
$ùag
->
	`G‘Name
()) : ','.strtolower($ctag->GetName()) );

127  
$okli¡
;

128 
	}
}

	@E:\web\weixun\xakadmin\inc\inc_archives_all.php

1 <?
php


15 
funùiÚ
 
	$G‘FÜmI‹m
(
$ùag
)

17 
$f›ldÇme
 = 
$ùag
->
	`G‘Name
();

18 
$fÜm™em
 = "

19 <
bË
 
width
=\"800\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">

20 <
Œ
>

21 <
td
 
width
=\"80\">~name~</td>

22 <
td
 
width
=\"720\">~form~</td>

23 </
Œ
>

24 </
bË
>\
r
\
n
";

25 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

26 if(
$šÃ¹ext
 != "")

28 if(
$ùag
->
	`G‘A‰
("type") == 'select')

30 
$myfÜmI‹m
 = '';

31 
$™ems
 = 
	`ex¶ode
(',', 
$šÃ¹ext
);

32 
$myfÜmI‹m
 = "<select‚ame='$fieldname' style='width:150px'>";

33 
	`fÜ—ch
(
$™ems
 
as
 
$v
)

35 
$v
 = 
	`Œim
($v);

36 if(
$v
!='')

38 
$myfÜmI‹m
.= "<option value='$v'>$v</option>\r\n";

41 
$myfÜmI‹m
 .= "</select>\r\n";

42 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~", 
$ùag
->
	`G‘A‰
('itemname'), $formitem);

43 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~", 
$myfÜmI‹m
,$formitem);

44  
$fÜm™em
;

46 if(
$ùag
->
	`G‘A‰
("type") == 'radio')

48 
$myfÜmI‹m
 = '';

49 
$™ems
 = 
	`ex¶ode
(',', 
$šÃ¹ext
);

50 
	`fÜ—ch
(
$™ems
 
as
 
$v
)

52 
$v
 = 
	`Œim
($v);

53 
$i
 = 0;

54 if(
$v
!='')

56 if(
$i
==0)

58 
$myfÜmI‹m
 .= "<inputype='radio'‚ame='$fieldname' class='np' value='$v' checked>$v\r\n";

62 
$myfÜmI‹m
 .= "<inputype='radio'‚ame='$fieldname' class='np' value='$v'>$v\r\n";

66 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~", 
$ùag
->
	`G‘A‰
('itemname'), $formitem);

67 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~", 
$myfÜmI‹m
,$formitem);

68  
$fÜm™em
;

72 
$fÜm™em
 = 
	`¡r_»¶aû
('~Çme~', 
$ùag
->
	`G‘A‰
('itemname'), $formitem);

73 
$fÜm™em
 = 
	`¡r_»¶aû
('~fÜm~', 
$šÃ¹ext
,$formitem);

74 
$fÜm™em
 = 
	`¡r_»¶aû
('@value', '', $formitem);

75  
$fÜm™em
;

78 if(
$ùag
->
	`G‘A‰
("type")=="htmltext"||$ctag->GetAtt("type")=="textdata")

80 
$fÜm™em
 = "";

81 
$fÜm™em
 .ğ"<bË width=\"800\" bÜd”=\"0\" c–l¥acšg=\"0\" c–Íaddšg=\"0\"><Œ><td width=\"80\">".
$ùag
->
	`G‘A‰
('itemname')."</td><td>";

82 
$fÜm™em
 .ğ
	`G‘Ed™Ü
(
$f›ldÇme
,'',350,'Basic','string');

83 
$fÜm™em
 .= "</td></tr></table>\r\n";

84  
$fÜm™em
;

86 if(
$ùag
->
	`G‘A‰
("type")=="multitext")

88 
$šÃ¹ext
 = "<textarea‚ame='$fieldname' id='$fieldname' style='width:100%;height:80'></textarea>\r\n";

89 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

90 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

91  
$fÜm™em
;

93 if(
$ùag
->
	`G‘A‰
("type")=="datetime")

95 
$nowtime
 = 
	`G‘D©eTimeMk
(
	`time
());

96 
$šÃ¹ext
 = "<input‚ame=\"$fieldname\" value=\"$nowtime\"ype=\"text\" id=\"$fieldname\" style=\"width:200\">";

97 
$šÃ¹ext
 .= "<input‚ame=\"selPubtime\"ype=\"button\" id=\"selkeyword\" value=\"é€‰æ‹©\" onClick=\"showCalendar('$fieldname', 'Y-m-d H:i:00', '24');\">";

98 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

99 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

100  
$fÜm™em
;

102 if(
$ùag
->
	`G‘A‰
("type")=="img")

104 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' styË='width:300'><špuˆÇme='".
$f›ldÇme
."_bt'ype='button' value='æµè§ˆ...' onClick=\"SelectImage('form1.$fieldname','big')\">\r\n";

105 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

106 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

107  
$fÜm™em
;

109 if(
$ùag
->
	`G‘A‰
("type")=="media")

111 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' styË='width:300'><špuˆÇme='".
$f›ldÇme
."_bt'ype='button' value='æµè§ˆ...' onClick=\"SelectMedia('form1.$fieldname')\">\r\n";

112 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

113 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

114  
$fÜm™em
;

116 if(
$ùag
->
	`G‘A‰
("type")=="addon")

118 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' styË='width:300'><špuˆÇme='".
$f›ldÇme
."_bt'ype='button' value='æµè§ˆ...' onClick=\"SelectSoft('form1.$fieldname')\">\r\n";

119 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

120 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

121  
$fÜm™em
;

123 if(
$ùag
->
	`G‘A‰
("type")=="media")

125 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' styË='width:300'><špuˆÇme='".
$f›ldÇme
."_bt'ype='button' value='æµè§ˆ...' onClick=\"SelectMedia('form1.$fieldname')\">\r\n";

126 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

127 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

128  
$fÜm™em
;

132 if(
$ùag
->
	`G‘A‰
('deçuÉ')!=""è
$dfv®ue
 = $ctag->GetAtt('default');

133 
$dfv®ue
 = "";

134 
$šÃ¹ext
 = "<inputype='text'‚ame='$fieldname' id='$fieldname' style='width:200' value='$dfvalue'>\r\n";

135 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

136 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

137  
$fÜm™em
;

139 
	}
}

152 
funùiÚ
 
G‘F›ldV®ue
(
$dv®ue
,
$dty³
,
$aid
=0,
$job
='add',
$addv¬
='')

154 
glob®
 
$cfg_cook›_’code
,
$cfg_dœ_purv›w
;

155 if(
	g$dty³
=="int")

157 
$dv®ue
 = 
Œim
(
´eg_»¶aû
("#[^0-9]#", "", $dvalue));

158 if(
	g$dv®ue
==""è
$dv®ue
 = 0;

159  
	g$dv®ue
;

161 if(
	g$dty³
=="float")

163 
$dv®ue
 = 
Œim
(
´eg_»¶aû
("#[^0-9\.]#", "", $dvalue));

164 if(
	g$dv®ue
==""è
$dv®ue
 = 0;

165  
	g$dv®ue
;

167 if(
	g$dty³
=="datetime")

169  
G‘MkTime
(
$dv®ue
);

171 if(
	g$dty³
=="textdata")

173 if(
$job
=='edit')

175 
$addv¬Dœs
 = 
ex¶ode
('/', 
$addv¬
);

176 
	g$addv¬Dœ
 = 
´eg_»¶aû
("#\/".
$addv¬Dœs
[
couÁ
($addv¬Dœs)-1]."$#", "", 
$addv¬
);

177 
	g$mdœ
 = 
$GLOBALS
['cfg_ba£dœ'].
$addv¬Dœ
;

178 if(!
is_dœ
(
$mdœ
))

180 
MkdœAÎ
(
$mdœ
, 
$GLOBALS
['cfg_dir_purview']);

182 
	g$å
 = 
fİ’
(
$GLOBALS
['cfg_ba£dœ'].
$addv¬
, "w");

183 
fwr™e
(
$å
, 
¡r¦ashes
(
$dv®ue
));

184 
fşo£
(
$å
);

185 
Clo£F
();

186  
	g$addv¬
;

190 
	g$©h
 = 
$GLOBALS
['cfg_cmspath']."/config/textdata";

191 
	g$©h
 = 
û
(
$aid
/5000);

192 if(!
is_dœ
(
$GLOBALS
['cfg_ba£dœ'].
$©h
))

194 
MkdœAÎ
(
$GLOBALS
['cfg_ba£dœ'].
$©h
,
$cfg_dœ_purv›w
);

196 if(!
is_dœ
(
$GLOBALS
['cfg_ba£dœ'].
$©h
.'/'.
$©h
))

198 
MkdœAÎ
(
$GLOBALS
['cfg_ba£dœ'].
$©h
.'/'.
$©h
,
$cfg_dœ_purv›w
);

200 
	g$©h
 = 
$©h
.'/'.
$©h
;

201 
	g$f’ame
 = "{$©h}/{$aid}-".
ú_sub¡r
(
md5
(
$cfg_cook›_’code
), 0, 16).".txt";

202 
	g$å
 = 
fİ’
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
,"w");

203 
fwr™e
(
$å
, 
¡r¦ashes
(
$dv®ue
));

204 
fşo£
(
$å
);

205 
Clo£F
();

206  
	g$f’ame
;

209 if(
	g$dty³
=="img")

211 
$iu¾
 = 
¡r¦ashes
(
$dv®ue
);

212 if(
Œim
(
$iu¾
)=="")

216 
	g$iu¾
 = 
Œim
(
¡r_»¶aû
(
$GLOBALS
['cfg_ba£ho¡'],"",
$iu¾
));

217 
	g$imgu¾
 = "{xak:imgext='' width='' height=''} ".
$iu¾
." {/xak:img}";

218 if(
´eg_m©ch
("#^h‰p:\/\/#i", 
$iu¾
è&& 
	g$GLOBALS
['isUrlOpen'])

221 
	g$»imgs
 = "";

222 if(
	g$isU¾O³n
)

224 
	g$»imgs
 = 
G‘RemÙeImage
(
$iu¾
,
$GLOBALS
['adminid']);

225 if(
is_¬¿y
(
$»imgs
))

227 
	g$imgu¾
 = "{xak:imgext='' width='".
$»imgs
[1]."' height='".$reimgs[2]."'} ".$reimgs[0]." {/xak:img}";

232 
	g$imgu¾
 = "{xak:imgext='' width='' height=''} ".
$iu¾
." {/xak:img}";

235 if(
	g$iu¾
!="")

238 
$imgfe
 = 
$GLOBALS
['cfg_ba£dœ'].
$iu¾
;

239 if(
is_fe
(
$imgfe
))

241 
	g$imgšfos
 = 
G‘ImageSize
(
$imgfe
,&
$šfo
);

242 
	g$imgu¾
 = "{xak:imgext='' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}";

245  
add¦ashes
(
$imgu¾
);

249  
	g$dv®ue
;

262 
funùiÚ
 
	$G‘FÜmI‹mV®ue
(
$ùag
, 
$fv®ue
)

264 
$f›ldÇme
 = 
$ùag
->
	`G‘Name
();

265 
$fÜm™em
 = "

266 <
bË
 
width
=\"800\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">

267 <
Œ
>

268 <
td
 
width
=\"80\">~name~</td>

269 <
td
 
width
=\"720\">~form~</td>

270 </
Œ
>

271 </
bË
>\
r
\
n
";

272 
$šÃ¹ext
 = 
	`Œim
(
$ùag
->
	`G‘IÂ”Text
());

273 if(
$šÃ¹ext
 != "")

275 if(
$ùag
->
	`G‘A‰
("type") == 'select')

277 
$myfÜmI‹m
 = '';

278 
$™ems
 = 
	`ex¶ode
(',', 
$šÃ¹ext
);

279 
$myfÜmI‹m
 = "<select‚ame='$fieldname' style='width:150px'>";

280 
	`fÜ—ch
(
$™ems
 
as
 
$v
)

282 
$v
 = 
	`Œim
($v);

283 if(
$v
!='')

285 if(
$fv®ue
==
$v
)

287 
$myfÜmI‹m
.= "<option value='$v' selected>$v</option>\r\n";

291 
$myfÜmI‹m
.= "<option value='$v'>$v</option>\r\n";

295 
$myfÜmI‹m
 .= "</select>\r\n";

296 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~", 
$ùag
->
	`G‘A‰
('itemname'), $formitem);

297 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~", 
$myfÜmI‹m
,$formitem);

298  
$fÜm™em
;

300 if(
$ùag
->
	`G‘A‰
("type")=='radio')

302 
$myfÜmI‹m
 = '';

303 
$™ems
 = 
	`ex¶ode
(',', 
$šÃ¹ext
);

304 
	`fÜ—ch
(
$™ems
 
as
 
$v
)

306 
$v
 = 
	`Œim
($v);

307 if(
$v
!='')

309 if(
$fv®ue
==
$v
)

311 
$myfÜmI‹m
.= "<inputype='radio'‚ame='$fieldname' class='np' value='$v' checked>$v\r\n";

315 
$myfÜmI‹m
.= "<inputype='radio'‚ame='$fieldname' class='np' value='$v'>$v\r\n";

319 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~", 
$ùag
->
	`G‘A‰
('itemname'), $formitem);

320 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~", 
$myfÜmI‹m
,$formitem);

321  
$fÜm™em
;

325 
$fÜm™em
 = 
	`¡r_»¶aû
('~Çme~', 
$ùag
->
	`G‘A‰
('itemname'), $formitem);

326 
$fÜm™em
 = 
	`¡r_»¶aû
('~fÜm~', 
$šÃ¹ext
, $formitem);

327 
$fÜm™em
 = 
	`¡r_»¶aû
('@v®ue', 
$fv®ue
, $formitem);

328  
$fÜm™em
;

333 if(
$ùag
->
	`G‘A‰
("type")=="textdata")

335 if(
	`is_fe
(
$GLOBALS
['cfg_ba£dœ'].
$fv®ue
))

337 
$å
 = 
	`fİ’
(
$GLOBALS
['cfg_ba£dœ'].
$fv®ue
, 'r');

338 
$okfv®ue
 = "";

339 !
	`ãof
(
$å
))

341 
$okfv®ue
 .ğ
	`fg‘s
(
$å
,1024);

343 
	`fşo£
(
$å
);

347 
$okfv®ue
="";

349 
$fÜm™em
 = "<bË width=\"800\" bÜd”=\"0\" c–l¥acšg=\"0\" c–Íaddšg=\"0\"><Œ><td width=\"80\">".
$ùag
->
	`G‘A‰
('itemname')."</td>\r\n";

350 
$fÜm™em
 .ğ"<td>\r\n".
	`G‘Ed™Ü
(
$f›ldÇme
,
$okfv®ue
,350,'Basic','string')."</td>\r\n";

351 
$fÜm™em
 .= "</tr></table>\r\n";

352 
$fÜm™em
 .= "<inputype='hidden'‚ame='{$fieldname}_file' value='{$fvalue}'>\r\n";

353  
$fÜm™em
;

355 if(
$ùag
->
	`G‘A‰
("type")=="htmltext")

357 
$fÜm™em
 = "<bË width=\"800\" bÜd”=\"0\" c–l¥acšg=\"0\" c–Íaddšg=\"0\"><Œ><td width=\"80\">".
$ùag
->
	`G‘A‰
('itemname')."</td>\r\n";

358 
$fÜm™em
 .ğ"<td>\r\n".
	`G‘Ed™Ü
(
$f›ldÇme
,
$fv®ue
,350,'Basic','string')."</td>\r\n";

359 
$fÜm™em
 .= "</tr></table>\r\n";

360  
$fÜm™em
;

362 if(
$ùag
->
	`G‘A‰
("type")=="multitext")

364 
$šÃ¹ext
 = "<textarea‚ame='$fieldname' id='$fieldname' style='width:100%;height:80'>$fvalue</textarea>\r\n";

365 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

366 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

367  
$fÜm™em
;

369 if(
$ùag
->
	`G‘A‰
("type")=="datetime")

371 
$nowtime
 = 
	`G‘D©eTimeMk
(
$fv®ue
);

372 
$šÃ¹ext
 = "<input‚ame=\"$fieldname\" value=\"$nowtime\"ype=\"text\" id=\"$fieldname\" style=\"width:200\">";

373 
$šÃ¹ext
 .= "<input‚ame=\"selPubtime\"ype=\"button\" id=\"selkeyword\" value=\"é€‰æ‹©\" onClick=\"showCalendar('$fieldname', 'Y-m-d H:i:00', '24');\">";

374 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

375 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

376  
$fÜm™em
;

378 if(
$ùag
->
	`G‘A‰
("type")=="img")

380 
$nd
 = 
Ãw
 
	`XakTagP¬£
();

381 
$nd
->
	`LßdSourû
(
$fv®ue
);

382 if(!
	`is_¬¿y
(
$nd
->
CTags
))

384 
$nd
->
	`CË¬
();

385 
$fv®ue
 = "";

387 
$Áag
 = 
$nd
->
	`G‘Tag
("img");

388 
$fv®ue
 = 
	`Œim
(
$Áag
->
	`G‘IÂ”Text
());

389 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' v®ue='$fv®ue' id='$f›ldÇme' styË='width:300'><špuˆÇme='".
$f›ldÇme
."_bt'ype='button' value='æµè§ˆ...' onClick=\"SelectImage('form1.$fieldname','big')\">\r\n";

390 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

391 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

392  
$fÜm™em
;

394 if(
$ùag
->
	`G‘A‰
("type")=="media")

396 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' v®ue='$fv®ue' id='$f›ldÇme' styË='width:300'><špuˆÇme='".
$f›ldÇme
."_bt'ype='button' value='æµè§ˆ...' onClick=\"SelectMedia('form1.$fieldname')\">\r\n";

397 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

398 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

399  
$fÜm™em
;

401 if(
$ùag
->
	`G‘A‰
("type")=="addon")

403 
$šÃ¹ext
 = "<špuˆty³='‹xt'‚ame='$f›ldÇme' id='$f›ldÇme' v®ue='$fv®ue' styË='width:300'><špuˆÇme='".
$f›ldÇme
."_bt'ype='button' value='æµè§ˆ...' onClick=\"SelectSoft('form1.$fieldname')\">\r\n";

404 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

405 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

406  
$fÜm™em
;

410 
$šÃ¹ext
 = "<inputype='text'‚ame='$fieldname' id='$fieldname' style='width:200' value='$fvalue'>\r\n";

411 
$fÜm™em
 = 
	`¡r_»¶aû
("~Çme~",
$ùag
->
	`G‘A‰
('itemname'),$formitem);

412 
$fÜm™em
 = 
	`¡r_»¶aû
("~fÜm~",
$šÃ¹ext
,$formitem);

413  
$fÜm™em
;

415 
	}
}

	@E:\web\weixun\xakadmin\inc\inc_archives_functions.php

1 <?
php


7 
»quœe_Úû
(
XAKINC
.'/xakhttpdown.class.php');

8 
»quœe_Úû
(
XAKINC
.'/image.func.php');

9 
»quœe_Úû
(
XAKINC
.'/archives.func.php');

10 
»quœe_Úû
(
XAKINC
.'/arc.partview.class.php');

11 
	g$backu¾
 = !
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : '';

12 
	g$backu¾
 = 
´eg_m©ch
("#cÚ‹Á_#", 
$backu¾
) ? "<a href='$backurl'>[<u>è®°å¿†çš„åˆ—è¡¨é¡µ</u>]</a> &nbsp;" : '';

13 if(!
	$is£t
(
$_NOT_ARCHIVES
))

15 
	`»quœe_Úû
(
XAKINC
.'/customfields.func.php');

16 
	}
}

27 
funùiÚ
 
	$G‘CurCÚ‹ÁAlbum
(
$body
, 
$rfu¾
, &
$fœ¡dd
)

29 
glob®
 
$dsql
,
$cfg_muÉi_s™e
,
$cfg_ba£ho¡
,
$cfg_ddimg_width
;

30 
glob®
 
$cfg_ba£dœ
,
$·ge¡yË
,
$cu£rLogš
,
$cfg_addÚ_§v‘y³
;

31 
	`»quœe_Úû
(
XAKINC
.'/xakcollection.func.php');

32 if(
	`em±y
(
$cfg_ddimg_width
)) $cfg_ddimg_width = 320;

33 
$rsimg
 = '';

34 
$cfg_u¶ßddœ
 = 
$GLOBALS
['cfg_image_dir'];

35 
$cfg_ba£dœ
 = 
$GLOBALS
['cfg_basedir'];

36 
$ba£ho¡
 = 'h‰p://'.
$_SERVER
['HTTP_HOST'];

37 
$img_¬¿y
 = 
	`¬¿y
();

38 
	`´eg_m©ch_®l
("/(¤c)=[\"|'| ]{0,}(h‰p:\/\/([^>]*)\.(gif|jpg|²g))/isU",
$body
,
$img_¬¿y
);

39 
$img_¬¿y
 = 
	`¬¿y_unique
($img_array[2]);

40 
$imgU¾
 = 
$cfg_u¶ßddœ
.'/'.
	`MyD©e
(
$cfg_addÚ_§v‘y³
, 
	`time
());

41 
$imgP©h
 = 
$cfg_ba£dœ
.
$imgU¾
;

42 if(!
	`is_dœ
(
$imgP©h
.'/'))

44 
	`MkdœAÎ
(
$imgP©h
,
$GLOBALS
['cfg_dir_purview']);

45 
	`Clo£F
();

47 
$mliSecÚd
 = 'co'.
	`dd2ch¬
Ğ
	`MyD©e
('ymdHis',
	`time
())) ;

48 
	`fÜ—ch
(
$img_¬¿y
 
as
 
$key
=>
$v®ue
)

50 
$v®ue
 = 
	`Œim
($value);

51 if(
	`´eg_m©ch
("#".
$ba£ho¡
."#i", 
$v®ue
) || !preg_match("#^http:\/\/#i", $value)

52 || (
$cfg_ba£ho¡
 !ğ
$ba£ho¡
 && 
	`´eg_m©ch
("#".$cfg_ba£ho¡."#i", 
$v®ue
)))

56 
$™y³
 = 
	`sub¡r
(
$v®ue
, -4, 4);

57 ifĞ!
	`´eg_m©ch
("#\.(gif|jpg|²g)#", 
$™y³
) ) $itype = ".jpg";

59 
$ºdFeName
 = 
$imgP©h
.'/'.
$mliSecÚd
.'-'.
$key
.
$™y³
;

60 
$iu¾
 = 
$imgU¾
.'/'.
$mliSecÚd
.'-'.
$key
.
$™y³
;

63 
$rs
 = 
	`DownImageK“p
(
$v®ue
, 
$rfu¾
, 
$ºdFeName
, '', 0, 30);

64 if(
$rs
)

66 
$šfo
 = '';

67 
$imgšfos
 = 
	`G‘ImageSize
(
$ºdFeName
, 
$šfo
);

68 
$fsize
 = 
	`fesize
(
$ºdFeName
);

69 
$f’ame
 = 
$mliSecÚd
.'-'.
$key
.
$™y³
;

71 
$šqu”y
 = "INSERT INTO `#@__uploads`(arcid,title,url,mediatype,width,height,playtime,filesize,uptime,mid)

72 
	`VALUES
 ('0','$filename','$iurl','1','{$imginfos[0]}','$imginfos[1]','0','$fsize','".time()."','".$cuserLogin->getUserID()."'); ";

73 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

74 
$fid
 = 
$dsql
->
	`G‘La¡ID
();

75 
	`AddMyAddÚ
(
$fid
, 
$iu¾
);

76 if(
$·ge¡yË
 > 2)

78 
$l™piúame
 = 
	`G‘ImageM­DD
(
$iu¾
, 
$cfg_ddimg_width
);

82 
$l™piúame
 = 
$iu¾
;

84 if(
	`em±y
(
$fœ¡dd
è&& !em±y(
$l™piúame
))

86 
$fœ¡dd
 = 
$l™piúame
;

87 if(!
	`fe_exi¡s
(
$cfg_ba£dœ
.
$fœ¡dd
))

89 
$fœ¡dd
 = 
$iu¾
;

92 @
	`W©”Img
(
$ºdFeName
, 'down');

93 
$rsimg
 .ğ"{xak:img ddimg='$l™piúame'ext='' width='".
$imgšfos
[0]."' height='".$imginfos[1]."'} $iurl {/xak:img}\r\n";

96  
$rsimg
;

97 
	}
}

106 
funùiÚ
 
	$G‘CurCÚ‹Á
(
$body
)

108 
glob®
 
$cfg_muÉi_s™e
,
$cfg_ba£ho¡
,
$cfg_ba£dœ
,
$cfg_image_dœ
,
$¬cID
,
$cu£rLogš
,
$dsql
;

109 
$cfg_u¶ßddœ
 = 
$cfg_image_dœ
;

110 
$htd
 = 
Ãw
 
	`XakH‰pDown
();

111 
$ba£ho¡
 = "h‰p://".
$_SERVER
["HTTP_HOST"];

112 
$img_¬¿y
 = 
	`¬¿y
();

113 
	`´eg_m©ch_®l
("/¤c=[\"|'|\s]{0,}(h‰p:\/\/([^>]*)\.(gif|jpg|²g))/isU",
$body
,
$img_¬¿y
);

114 
$img_¬¿y
 = 
	`¬¿y_unique
($img_array[1]);

115 
$imgU¾
 = 
$cfg_u¶ßddœ
.'/'.
	`MyD©e
("ymd", 
	`time
());

116 
$imgP©h
 = 
$cfg_ba£dœ
.
$imgU¾
;

117 if(!
	`is_dœ
(
$imgP©h
.'/'))

119 
	`MkdœAÎ
(
$imgP©h
, 
$GLOBALS
['cfg_dir_purview']);

120 
	`Clo£F
();

122 
$mliSecÚd
 = 
	`MyD©e
('His',
	`time
());

123 
	`fÜ—ch
(
$img_¬¿y
 
as
 
$key
=>
$v®ue
)

125 if(
	`´eg_m©ch
("#".
$ba£ho¡
."#i", 
$v®ue
))

129 if(
$cfg_ba£ho¡
 !ğ
$ba£ho¡
 && 
	`´eg_m©ch
("#".$cfg_ba£ho¡."#i", 
$v®ue
))

133 if(!
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$v®ue
))

137 
$htd
->
	`O³nU¾
(
$v®ue
);

138 
$™y³
 = 
$htd
->
	`G‘H—d
("content-type");

139 
$™y³
 = 
	`sub¡r
(
$v®ue
, -4, 4);

140 if(!
	`´eg_m©ch
("#\.(jpg|gif|²g)#i", 
$™y³
))

142 if(
$™y³
=='image/gif')

144 
$™y³
 = ".gif";

146 if(
$™y³
=='image/png')

148 
$™y³
 = ".png";

152 
$™y³
 = '.jpg';

155 
$mliSecÚdN
 = 
	`dd2ch¬
(
$mliSecÚd
.
	`mt_¿nd
(1000, 8000));

156 
$v®ue
 = 
	`Œim
($value);

157 
$ºdFeName
 = 
$imgP©h
.'/'.
$mliSecÚdN
.'-'.
$key
.
$™y³
;

158 
$feu¾
 = 
$imgU¾
.'/'.
$mliSecÚdN
.'-'.
$key
.
$™y³
;

160 
$rs
 = 
$htd
->
	`SaveToBš
(
$ºdFeName
);

161 if(
$rs
)

163 
$šfo
 = '';

164 
$imgšfos
 = 
	`G‘ImageSize
(
$ºdFeName
, 
$šfo
);

165 
$fsize
 = 
	`fesize
(
$ºdFeName
);

167 
$šqu”y
 = "INSERT INTO `#@__uploads`(arcid,title,url,mediatype,width,height,playtime,filesize,uptime,mid)

168 
	`VALUES
 ('{$arcID}','$rndFileName','$fileurl','1','{$imginfos[0]}','$imginfos[1]','0','$fsize','".time()."','".$cuserLogin->getUserID()."'); ";

169 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

170 
$fid
 = 
$dsql
->
	`G‘La¡ID
();

171 
	`AddMyAddÚ
(
$fid
, 
$feu¾
);

172 if(
$cfg_muÉi_s™e
 == 'Y')

174 
$feu¾
 = 
$cfg_ba£ho¡
.$fileurl;

176 
$body
 = 
	`¡r_»¶aû
(
$v®ue
, 
$feu¾
, $body);

177 @
	`W©”Img
(
$ºdFeName
, 'down');

180 
$htd
->
	`Clo£
();

181  
$body
;

182 
	}
}

192 
funùiÚ
 
	$G‘RemÙeImage
(
$u¾
, 
$uid
=0)

194 
glob®
 
$cfg_ba£dœ
, 
$cfg_image_dœ
, 
$cfg_addÚ_§v‘y³
;

195 
$cfg_u¶ßddœ
 = 
$cfg_image_dœ
;

196 
$»v®ues
 = 
	`A¼ay
();

197 
$ok
 = 
çl£
;

198 
$htd
 = 
Ãw
 
	`XakH‰pDown
();

199 
$htd
->
	`O³nU¾
(
$u¾
);

200 
$¥¬r
 = 
	`A¼ay
("image/pjpeg", "image/jpeg", "image/gif", "image/png", "image/xpng", "image/wbmp");

201 if(!
	`š_¬¿y
(
$htd
->
	`G‘H—d
("cÚ‹Á-ty³"),
$¥¬r
))

207 
$imgU¾
 = 
$cfg_u¶ßddœ
.'/'.
	`MyD©e
(
$cfg_addÚ_§v‘y³
, 
	`time
());

208 
$imgP©h
 = 
$cfg_ba£dœ
.
$imgU¾
;

209 
	`C»©eDœ
(
$imgU¾
);

210 
$™y³
 = 
$htd
->
	`G‘H—d
("content-type");

211 if(
$™y³
=="image/gif")

213 
$™y³
 = '.gif';

215 if(
$™y³
=="image/png")

217 
$™y³
 = '.png';

219 if(
$™y³
=="image/wbmp")

221 
$™y³
 = '.bmp';

225 
$™y³
 = '.jpg';

227 
$ºdÇme
 = 
	`dd2ch¬
(
$uid
.'_'.
	`MyD©e
('mdHis',
	`time
()).
	`mt_¿nd
(1000,9999));

228 
$ºdŒueName
 = 
$imgP©h
.'/'.
$ºdÇme
.
$™y³
;

229 
$feu¾
 = 
$imgU¾
.'/'.
$ºdÇme
.
$™y³
;

230 
$ok
 = 
$htd
->
	`SaveToBš
(
$ºdŒueName
);

231 @
	`W©”Img
(
$ºdŒueName
, 'down');

232 if(
$ok
)

234 
$d©a
 = 
	`G‘ImageSize
(
$ºdŒueName
);

235 
$»v®ues
[0] = 
$feu¾
;

236 
$»v®ues
[1] = 
$d©a
[0];

237 
$»v®ues
[2] = 
$d©a
[1];

240 
$htd
->
	`Clo£
();

241  (
$ok
 ? 
$»v®ues
 : '');

242 
	}
}

252 
funùiÚ
 
	$G‘RemÙeFÏsh
(
$u¾
, 
$uid
=0)

254 
glob®
 
$cfg_addÚ_§v‘y³
, 
$cfg_medŸ_dœ
, 
$cfg_ba£dœ
;

255 
$cfg_u¶ßddœ
 = 
$cfg_medŸ_dœ
;

256 
$»v®ues
 = '';

257 
$¥¬r
 = 'application/x-shockwave-flash';

258 
$htd
 = 
Ãw
 
	`XakH‰pDown
();

259 
$htd
->
	`O³nU¾
(
$u¾
);

260 if(
$htd
->
	`G‘H—d
("cÚ‹Á-ty³")!=
$¥¬r
)

266 
$imgU¾
 = 
$cfg_u¶ßddœ
.'/'.
	`MyD©e
(
$cfg_addÚ_§v‘y³
, 
	`time
());

267 
$imgP©h
 = 
$cfg_ba£dœ
.
$imgU¾
;

268 
	`C»©eDœ
(
$imgU¾
);

269 
$™y³
 = '.swf';

270 
$mliSecÚd
 = 
$uid
.'_'.
	`MyD©e
('mdHis', 
	`time
());

271 
$ºdFeName
 = 
$imgP©h
.'/'.
$mliSecÚd
.
$™y³
;

272 
$feu¾
 = 
$imgU¾
.'/'.
$mliSecÚd
.
$™y³
;

273 
$ok
 = 
$htd
->
	`SaveToBš
(
$ºdFeName
);

274 if(
$ok
)

276 
$»v®ues
 = 
$feu¾
;

279 
$htd
->
	`Clo£
();

280  
$»v®ues
;

281 
	}
}

291 
funùiÚ
 
	$CheckChªÃl
(
$ty³id
, 
$chªÃlid
)

293 
glob®
 
$dsql
;

294 if(
$ty³id
==0è 
TRUE
;

296 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT ispart,channeltype FROM `#@__arctype` WHERE id='$typeid' ");

297 if(
$row
['i¥¬t']!=0 || $row['chªÃÉy³'] !ğ
$chªÃlid
è 
FALSE
;

298  
TRUE
;

299 
	}
}

309 
funùiÚ
 
	$CheckArcAdmš
(
$aid
, 
$admšid
)

311 
glob®
 
$dsql
;

312 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT mid FROM `#@__archives` WHERE id='$aid' ");

313 if(
$row
['mid']!=
$admšid
è 
FALSE
;

314  
TRUE
;

315 
	}
}

326 
funùiÚ
 
	$SpLÚgBody
(
$mybody
, 
$¥size
, 
$¥g
)

328 if(
	`¡¾’
(
$mybody
è< 
$¥size
)

330  
$mybody
;

332 
$mybody
 = 
	`¡r¦ashes
($mybody);

333 
$bds
 = 
	`ex¶ode
('<', 
$mybody
);

334 
$ÅageBody
 = '';

335 
$i¡abË
 = 0;

336 
$mybody
 = '';

337 
	`fÜ—ch
(
$bds
 
as
 
$i
=>
$k
)

339 if(
$i
==0)

341 
$ÅageBody
 .ğ
$bds
[
$i
]; ;

343 
$bds
[
$i
] = "<".$bds[$i];

344 if(
	`¡¾’
(
$bds
[
$i
])>6)

346 
$Šame
 = 
	`sub¡r
(
$bds
[
$i
],1,5);

347 if(
	`¡¹Şow”
(
$Šame
)=='table')

349 
$i¡abË
++;

351 if(
	`¡¹Şow”
(
$Šame
)=='/tabl')

353 
$i¡abË
--;

355 if(
$i¡abË
>0)

357 
$ÅageBody
 .ğ
$bds
[
$i
]; ;

361 
$ÅageBody
 .ğ
$bds
[
$i
];

366 
$ÅageBody
 .ğ
$bds
[
$i
];

368 if(
	`¡¾’
(
$ÅageBody
)>
$¥size
)

370 
$mybody
 .ğ
$ÅageBody
.
$¥g
;

371 
$ÅageBody
 = '';

374 if(
$ÅageBody
!='')

376 
$mybody
 .ğ
$ÅageBody
;

378  
	`add¦ashes
(
$mybody
);

379 
	}
}

390 
funùiÚ
 
	$MakeA¹
(
$aid
, 
$mkšdex
=
FALSE
, 
$ismakesign
=FALSE, 
$i¤emÙe
=0)

392 
glob®
 
$’vs
, 
$ty³id
;

393 
	`»quœe_Úû
(
XAKINC
.'/arc.archives.class.php');

394 if(
$ismakesign
è
$’vs
['makesign'] = 'yes';

395 
$¬c
 = 
Ãw
 
	`Archives
(
$aid
);

396 
$»u¾
 = 
$¬c
->
	`MakeHtml
(
$i¤emÙe
);

397  
$»u¾
;

398 
	}
}

407 
funùiÚ
 
	$G‘DDImgFromBody
(&
$body
)

409 
$l™pic
 = '';

410 
	`´eg_m©ch_®l
("/(¤c)=[\"|'| ]{0,}([^>]*\.(gif|jpg|bmp|²g))/isU",
$body
,
$img_¬¿y
);

411 
$img_¬¿y
 = 
	`¬¿y_unique
($img_array[2]);

412 if(
	`couÁ
(
$img_¬¿y
)>0)

414 
$piúame
 = 
	`´eg_»¶aû
("/[\"|'| ]{1,}/", '', 
$img_¬¿y
[0]);

415 if(
	`´eg_m©ch
("#_l™\.#", 
$piúame
)è
$l™pic
 = $picname;

416 
$l™pic
 = 
	`G‘DDImage
('ddfœ¡', 
$piúame
,1);

418  
$l™pic
;

419 
	}
}

430 
funùiÚ
 
	$G‘DDImage
(
$l™pic
, 
$piúame
, 
$i¤emÙe
)

432 
glob®
 
$cu£rLogš
,
$cfg_ddimg_width
,
$cfg_ddimg_height
,
$cfg_ba£dœ
,
$ddcfg_image_dœ
,
$cfg_addÚ_§v‘y³
;

433 
$Áime
 = 
	`time
();

434 ifĞ(
$l™pic
 != 'none' || $litpic != 'ddfirst') &&

435 !
	`em±y
(
$_FILES
[
$l™pic
]['tmp_Çme']è&& 
	`is_u¶ßded_fe
($_FILES[$litpic]['tmp_name']))

438 
$i¡y³
 = 0;

439 
$¥¬r
 = 
	`A¼ay
("image/pjpeg", "image/jpeg", "image/gif", "image/png");

440 
$_FILES
[
$l™pic
]['ty³'] = 
	`¡¹Şow”
(
	`Œim
($_FILES[$litpic]['type']));

441 if(!
	`š_¬¿y
(
$_FILES
[
$l™pic
]['ty³'], 
$¥¬r
))

443 
	`ShowMsg
("ä¸Šä¼ çš„å›¾ç‰‡æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨JPEGã€GIFã€PNGæ ¼å¼çš„å…¶ä¸­ä¸€ç§ï¼","-1");

444 
	`ex™
();

446 
$§v•©h
 = 
$ddcfg_image_dœ
.'/'.
	`MyD©e
(
$cfg_addÚ_§v‘y³
, 
$Áime
);

448 
	`C»©eDœ
(
$§v•©h
);

449 
$fuÎU¾
 = 
$§v•©h
.'/'.
	`dd2ch¬
(
	`MyD©e
('mdHis', 
$Áime
).
$cu£rLogš
->
	`g‘U£rID
().
	`mt_¿nd
(1000, 9999));

450 if(
	`¡¹Şow”
(
$_FILES
[
$l™pic
]['type']) == "image/gif")

452 
$fuÎU¾
 = $fullUrl.".gif";

454 if(
	`¡¹Şow”
(
$_FILES
[
$l™pic
]['type']) == "image/png")

456 
$fuÎU¾
 = $fullUrl.".png";

460 
$fuÎU¾
 = $fullUrl.".jpg";

463 @
	`move_u¶ßded_fe
(
$_FILES
[
$l™pic
]['tmp_Çme'], 
$cfg_ba£dœ
.
$fuÎU¾
);

464 
$l™pic
 = 
$fuÎU¾
;

466 if(
$GLOBALS
['cfg_ddimg_fuÎ']=='Y'è@
	`ImageResizeNew
(
$cfg_ba£dœ
.
$fuÎU¾
,
$cfg_ddimg_width
,
$cfg_ddimg_height
);

467 @
	`ImageResize
(
$cfg_ba£dœ
.
$fuÎU¾
,
$cfg_ddimg_width
,
$cfg_ddimg_height
);

469 
$img
 = 
$cfg_ba£dœ
.
$l™pic
;

475 
$piúame
 = 
	`Œim
($picname);

476 if(
$i¤emÙe
==1 && 
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$piúame
))

478 
$l™pic
 = 
$piúame
;

479 
$ddšfos
 = 
	`G‘RemÙeImage
(
$l™pic
, 
$cu£rLogš
->
	`g‘U£rID
());

481 if(!
	`is_¬¿y
(
$ddšfos
))

483 
$l™pic
 = '';

487 
$l™pic
 = 
$ddšfos
[0];

488 if(
$ddšfos
[1] > 
$cfg_ddimg_width
 || $ddšfos[2] > 
$cfg_ddimg_height
)

490 if(
$GLOBALS
['cfg_ddimg_fuÎ']=='Y'è@
	`ImageResizeNew
(
$cfg_ba£dœ
.
$l™pic
,
$cfg_ddimg_width
,
$cfg_ddimg_height
);

491 @
	`ImageResize
(
$cfg_ba£dœ
.
$l™pic
,
$cfg_ddimg_width
,
$cfg_ddimg_height
);

497 if(
$l™pic
=='ddfœ¡' && !
	`´eg_m©ch
("#^h‰p:\/\/#i", 
$piúame
))

499 
$Şdpic
 = 
$cfg_ba£dœ
.
$piúame
;

500 
$l™pic
 = 
	`¡r_»¶aû
('.', '-Í.', 
$piúame
);

501 if(
$GLOBALS
['cfg_ddimg_fuÎ']=='Y'è@
	`ImageResizeNew
(
$Şdpic
,
$cfg_ddimg_width
,
$cfg_ddimg_height
,
$cfg_ba£dœ
.
$l™pic
);

502 @
	`ImageResize
(
$Şdpic
,
$cfg_ddimg_width
,
$cfg_ddimg_height
,
$cfg_ba£dœ
.
$l™pic
);

503 if(!
	`is_fe
(
$cfg_ba£dœ
.
$l™pic
)) $litpic = '';

507 
$l™pic
 = 
$piúame
;

508  
$l™pic
;

512 if(
$l™pic
=='litpic' || $litpic=='ddfirst') $litpic = '';

513  
$l™pic
;

514 
	}
}

523 
funùiÚ
 
	$G‘FÜmI‹mA
(
$ùag
)

525  
	`G‘FÜmI‹m
(
$ùag
, 'admin');

526 
	}
}

539 
funùiÚ
 
G‘F›ldV®ueA
(
$dv®ue
, 
$dty³
, 
$aid
=0, 
$job
='add', 
$addv¬
='')

541  
G‘F›ldV®ue
(
$dv®ue
, 
$dty³
, 
$aid
, 
$job
, 
$addv¬
, 'admin');

552 
funùiÚ
 
	$G‘FÜmI‹mV®ueA
(
$ùag
, 
$fv®ue
)

554  
	`G‘FÜmI‹mV®ue
(
$ùag
, 
$fv®ue
, 'admin');

555 
	}
}

565 
funùiÚ
 
PrštAutoF›ldsAdd
(&
$f›ld£t
, 
$lßdty³
='all')

567 
$d
 = 
Ãw
 
XakTagP¬£
();

568 
	g$d
->
S‘NameS·û
('field','<','>');

569 
	g$d
->
LßdSourû
(
$f›ld£t
);

570 
	g$xak_addÚf›lds
 = '';

571 if(
is_¬¿y
(
$d
->
CTags
))

573 
fÜ—ch
(
$d
->
CTags
 
as
 
$tid
=>
$ùag
)

575 if(
$lßdty³
!='autofield'

576 || (
$lßdty³
=='autof›ld' && 
$ùag
->
G‘A‰
('autofield')==1) )

578 
$xak_addÚf›lds
 .ğĞ$xak_addÚf›lds=="" ? 
$ùag
->
G‘Name
().",".$ùag->
G‘A‰
('type') : ";".$ctag->GetName().",".$ctag->GetAtt('type') );

579 
echo
 
G‘FÜmI‹mA
(
$ùag
);

583 
	gecho
 "<špuˆty³='hidd’'‚ame='xak_addÚf›lds' v®ue=\"".
	g$xak_addÚf›lds
."\">\r\n";

595 
funùiÚ
 
PrštAutoF›ldsEd™
(&
$f›ld£t
, &
$f›ldV®ues
, 
$lßdty³
='all')

597 
$d
 = 
Ãw
 
XakTagP¬£
();

598 
	g$d
->
S‘NameS·û
("field", "<", ">");

599 
	g$d
->
LßdSourû
(
$f›ld£t
);

600 
	g$xak_addÚf›lds
 = "";

601 if(
is_¬¿y
(
$d
->
CTags
))

603 
fÜ—ch
(
$d
->
CTags
 
as
 
$tid
=>
$ùag
)

605 if(
$lßdty³
 != 'autofield'

606 || (
$lßdty³
 =ğ'autof›ld' && 
$ùag
->
G‘A‰
('autofield') == 1) )

608 
$xak_addÚf›lds
 .ğĞ$xak_addÚf›lds=='' ? 
$ùag
->
G‘Name
().",".$ùag->
G‘A‰
('type') : ";".$ctag->GetName().",".$ctag->GetAtt('type') );

609 
echo
 
G‘FÜmI‹mV®ueA
(
$ùag
, 
$f›ldV®ues
[$ùag->
G‘Name
()]);

613 
	gecho
 "<špuˆty³='hidd’'‚ame='xak_addÚf›lds' v®ue=\"".
	g$xak_addÚf›lds
."\">\r\n";

629 
funùiÚ
 
AÇly£HtmlBody
(
$body
,&
$desütiÚ
,&
$l™pic
,&
$keywÜds
,
$dty³
='')

631 
glob®
 
$autŞ™pic
,
$»mÙe
,
$d–lšk
,
$autokey
,
$cfg_ba£ho¡
,
$cfg_auÙ_desütiÚ
,
$id
,
$t™Ë
,
$cfg_soá_Ïng
;

632 
	g$autŞ™pic
 = (
em±y
(
$autŞ™pic
) ? '' : $autolitpic);

633 
	g$body
 = 
¡r¦ashes
(
$body
);

636 if(
	g$»mÙe
==1)

638 
$body
 = 
G‘CurCÚ‹Á
($body);

642 if(
	g$d–lšk
==1)

644 
$®low_u¾s
 = 
¬¿y
(
$_SERVER
['HTTP_HOST']);

646 if(
fe_exi¡s
(
XAKDATA
."/admin/allowurl.txt"))

648 
	g$®low_u¾s
 = 
¬¿y_m”ge
(
$®low_u¾s
, 
fe
(
XAKDATA
."/admin/allowurl.txt"));

650 
	g$body
 = 
R•Ïû_Lšks
(
$body
, 
$®low_u¾s
);

654 if(
	g$desütiÚ
=='' && 
$cfg_auÙ_desütiÚ
>0)

656 
$desütiÚ
 = 
ú_sub¡r
(
html2‹xt
(
$body
),
$cfg_auÙ_desütiÚ
);

657 
	g$desütiÚ
 = 
Œim
(
´eg_»¶aû
('/#p#|#e#/','',
$desütiÚ
));

658 
	g$desütiÚ
 = 
add¦ashes
(
$desütiÚ
);

662 if(
	g$autŞ™pic
==1 && 
$l™pic
=='')

664 
$l™pic
 = 
G‘DDImgFromBody
(
$body
);

668 if(
	g$autokey
==1 && 
$keywÜds
=='')

670 
$subjeù
 = 
$t™Ë
;

671 
	g$mes§ge
 = 
$body
;

672 
šşude_Úû
(
XAKINC
.'/splitword.class.php');

673 
	g$keywÜds
 = '';

674 
	g$¥
 = 
Ãw
 
S¶™WÜd
(
$cfg_soá_Ïng
, $cfg_soft_lang);

675 
	g$¥
->
S‘Sourû
(
$subjeù
, 
$cfg_soá_Ïng
, $cfg_soft_lang);

676 
	g$¥
->
S¹AÇlysis
();

677 
	g$t™Ëšdexs
 = 
´eg_»¶aû
("/#p#|#e#/",'',
$¥
->
G‘Fš®lyIndex
());

678 
	g$¥
->
S‘Sourû
(
Html2Text
(
$mes§ge
), 
$cfg_soá_Ïng
, $cfg_soft_lang);

679 
	g$¥
->
S¹AÇlysis
();

680 
	g$®lšdexs
 = 
´eg_»¶aû
("/#p#|#e#/",'',
$¥
->
G‘Fš®lyIndex
());

682 if(
is_¬¿y
(
$®lšdexs
è&& is_¬¿y(
$t™Ëšdexs
))

684 
fÜ—ch
(
$t™Ëšdexs
 
as
 
$k
 => 
$v
)

686 if(
¡¾’
(
$keywÜds
.
$k
)>=60)

692 if(
¡¾’
(
$k
) <= 2) ;

693 
	g$keywÜds
 .ğ
$k
.',';

696 
fÜ—ch
(
$®lšdexs
 
as
 
$k
 => 
$v
)

698 if(
¡¾’
(
$keywÜds
.
$k
)>=60)

702 if(!
š_¬¿y
(
$k
,
$t™Ëšdexs
))

704 if(
¡¾’
(
$k
) <= 2) ;

705 
	g$keywÜds
 .ğ
$k
.',';

709 
	g$¥
 = 
nuÎ
;

711 
	g$body
 = 
G‘F›ldV®ueA
(
$body
,
$dty³
,
$id
);

712 
	g$body
 = 
add¦ashes
(
$body
);

713  
	g$body
;

724 
funùiÚ
 
R•Ïû_Lšks
Ğ&
$body
, 
$®low_u¾s
=
	$¬¿y
() )

726 
$ho¡_ruË
 = 
	`još
('|', 
$®low_u¾s
);

727 
$ho¡_ruË
 = 
	`´eg_»¶aû
("#[\n\r]#", '', $host_rule);

728 
$ho¡_ruË
 = 
	`¡r_»¶aû
('.', "\\.", $host_rule);

729 
$ho¡_ruË
 = 
	`¡r_»¶aû
('/', "\\/", $host_rule);

730 
$¬r
 = '';

731 
	`´eg_m©ch_®l
("#<a([^>]*)>(.*)<\/a>#iU", 
$body
, 
$¬r
);

732 ifĞ
	`is_¬¿y
(
$¬r
[0]) )

734 
$½¬r
 = 
	`¬¿y
();

735 
$tg¬r
 = 
	`¬¿y
();

736 
	`fÜ—ch
(
$¬r
[0] 
as
 
$i
=>
$v
)

738 ifĞ
$ho¡_ruË
 !ğ'' && 
	`´eg_m©ch
('#'.$ho¡_ruË.'#i', 
$¬r
[1][
$i
]) )

742 
$½¬r
[] = 
$v
;

743 
$tg¬r
[] = 
$¬r
[2][
$i
];

746 ifĞ!
	`em±y
(
$½¬r
) )

748 
$body
 = 
	`¡r_»¶aû
(
$½¬r
, 
$tg¬r
, $body);

751 
$¬r
 = 
$½¬r
 = 
$tg¬r
 = '';

752  
$body
;

753 
	}
}

763 
funùiÚ
 
	$G‘ImageM­DD
(
$f’ame
, 
$maxwidth
)

765 
glob®
 
$cu£rLogš
, 
$dsql
, 
$cfg_ddimg_height
, 
$cfg_ddimg_fuÎ
;

766 
$ddn
 = 
	`sub¡r
(
$f’ame
, -3);

767 
$ddpicok
 = 
	`´eg_»¶aû
("#\.".
$ddn
."$#", "-Í.".$ddn, 
$f’ame
);

768 
$toFe
 = 
$GLOBALS
['cfg_ba£dœ'].
$ddpicok
;

770 if(
$cfg_ddimg_fuÎ
=='Y'è
	`ImageResizeNew
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
, 
$maxwidth
, 
$cfg_ddimg_height
, 
$toFe
);

771 
	`ImageResize
(
$GLOBALS
['cfg_ba£dœ'].
$f’ame
, 
$maxwidth
, 
$cfg_ddimg_height
, 
$toFe
);

774 
$fsize
 = 
	`fesize
(
$toFe
);

775 
$ddpicoks
 = 
	`ex¶ode
('/', 
$ddpicok
);

776 
$f’ame
 = 
$ddpicoks
[
	`couÁ
($ddpicoks)-1];

777 
$šqu”y
 = "INSERT INTO `#@__uploads`(arcid,title,url,mediatype,width,height,playtime,filesize,uptime,mid)

778 
	`VALUES
 ('0','$filename','$ddpicok','1','0','0','0','$fsize','".time()."','".$cuserLogin->getUserID()."'); ";

779 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

780 
$fid
 = 
$dsql
->
	`G‘La¡ID
();

781 
	`AddMyAddÚ
(
$fid
, 
$ddpicok
);

783  
$ddpicok
;

784 
	}
}

797 
funùiÚ
 
U¶ßdOÃImage
(
$u²ame
,
$hªdu¾
='',
$i¤emÙe
=1,
$Á™Ë
='')

799 
glob®
 
$cu£rLogš
,
$cfg_ba£dœ
,
$cfg_image_dœ
,
$t™Ë
, 
$dsql
;

800 if(
	g$Á™Ë
!='')

802 
$t™Ë
 = 
$Á™Ë
;

804 
	g$Áime
 = 
time
();

805 
	g$f’ame
 = '';

806 
	g$i¤m_up
 = 
FALSE
;

807 
	g$hªdu¾
 = 
Œim
(
$hªdu¾
);

810 if(!
em±y
(
$_FILES
[
$u²ame
]['tmp_Çme']è&& 
is_u¶ßded_fe
($_FILES[$upname]['tmp_name']))

812 
	g$i¡y³
 = 0;

813 
	g$¥¬r
 = 
A¼ay
("image/pjpeg", "image/jpeg", "image/gif", "image/png");

814 
	g$_FILES
[
$u²ame
]['ty³'] = 
¡¹Şow”
(
Œim
(
$_FILES
[$upname]['type']));

815 if(!
š_¬¿y
(
$_FILES
[
$u²ame
]['ty³'], 
$¥¬r
))

817 
ShowMsg
("ä¸Šä¼ çš„å›¾ç‰‡æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨JPEGã€GIFã€PNGæ ¼å¼çš„å…¶ä¸­ä¸€ç§ï¼","-1");

818 
ex™
();

820 if(!
em±y
(
$hªdu¾
è&& !
´eg_m©ch
("#^h‰p:\/\/#i", $hªdu¾è&& 
fe_exi¡s
(
$cfg_ba£dœ
.$handurl) )

822 if(!
is_objeù
(
$dsql
))

824 
	g$dsql
 = 
Ãw
 
XakSql
();

826 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__uploads` WHERE url LIKE '$handurl' ");

827 
	g$fuÎU¾
 = 
´eg_»¶aû
("#\.([a-z]*)$#i", "", 
$hªdu¾
);

831 
	g$§v•©h
 = 
$cfg_image_dœ
.'/'.
¡ráime
("%Y-%m",
$Áime
);

832 
C»©eDœ
(
$§v•©h
);

833 
	g$fuÎU¾
 = 
$§v•©h
.'/'.
¡ráime
("%d",
$Áime
).
dd2ch¬
(¡ráime("%H%M%S", $Áime).'0'.
$cu£rLogš
->
g‘U£rID
().'0'.
mt_¿nd
(1000, 9999));

835 if(
¡¹Şow”
(
$_FILES
[
$u²ame
]['type'])=="image/gif")

837 
$fuÎU¾
 = $fullUrl.".gif";

839 if(
¡¹Şow”
(
$_FILES
[
$u²ame
]['type'])=="image/png")

841 
$fuÎU¾
 = $fullUrl.".png";

845 
	g$fuÎU¾
 = 
$fuÎU¾
.".jpg";

849 @
move_u¶ßded_fe
(
$_FILES
[
$u²ame
]['tmp_Çme'], 
$cfg_ba£dœ
.
$fuÎU¾
);

850 
	g$f’ame
 = 
$fuÎU¾
;

853 @
W©”Img
(
$imgfe
, 'up');

854 
	g$i¤m_up
 = 
TRUE
;

860 if(
	g$hªdu¾
=='')

866 if(
	g$i¤emÙe
==1 && 
´eg_m©ch
("#^h‰p:\/\/#i", 
$hªdu¾
))

868 
	g$ddšfos
 = 
G‘RemÙeImage
(
$hªdu¾
, 
$cu£rLogš
->
g‘U£rID
());

869 if(!
is_¬¿y
(
$ddšfos
))

871 
	g$l™pic
 = "";

875 
	g$f’ame
 = 
$ddšfos
[0];

877 
	g$i¤m_up
 = 
TRUE
;

883 
	g$f’ame
 = 
$hªdu¾
;

886 
	g$imgfe
 = 
$cfg_ba£dœ
.
$f’ame
;

887 if(
is_fe
(
$imgfe
è&& 
	g$i¤m_up
 && 
	g$f’ame
!='')

889 
$šfo
 = "";

890 
	g$imgšfos
 = 
G‘ImageSize
(
$imgfe
, 
$šfo
);

893 
	g$šqu”y
 = "

894 
INSERT
 
INTO
 #@
__u¶ßds
(
t™Ë
,
u¾
,
medŸty³
,
width
,
height
,
¶aytime
,
fesize
,
u±ime
,
mid
)

895 
VALUES
 ('$title','$filename','1','".$imginfos[0]."','".$imginfos[1]."','0','".filesize($imgfile)."','".time()."','".$cuserLogin->getUserID()."');

897 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

899  
	g$f’ame
;

908 
funùiÚ
 
	$G‘Upd©eTe¡
()

910 
glob®
 
$¬cID
, 
$ty³id
, 
$cfg_make_ªdÿt
, 
$cfg_makešdex
, 
$cfg_make_´’ext
;

911 
$»v®ue
 = 
$dŞi¡
 = '';

912 if(
$cfg_makešdex
=='Y' || 
$cfg_make_ªdÿt
=='Y' || 
$cfg_make_´’ext
=='Y')

914 if(
$cfg_make_´’ext
=='Y' && !
	`em±y
(
$ty³id
)è
$dŞi¡
 = 'makeprenext';

915 if(
$cfg_makešdex
=='Y'è
$dŞi¡
 .ğ
	`em±y
($dolist) ? 'makeindex' : ',makeindex';

916 if(
$cfg_make_ªdÿt
=='Y'è
$dŞi¡
 .ğ
	`em±y
($dolist) ? 'makeparenttype' : ',makeparenttype';

917 
$dŞi¡s
 = 
	`ex¶ode
(',', 
$dŞi¡
);

918 
$jumpU¾
 = "sk_do.php?ty³id={$ty³id}&aid={$¬cID}&dİo¡={$dŞi¡s[0]}&Ãxtdo=".
	`´eg_»¶aû
("#".
$dŞi¡s
[0]."[,]{0,1}#", '', 
$dŞi¡
);

919 
$»v®ue
 = "<table width='80%' style='border:1px dashed #cdcdcd;margin-left:20px;margin-bottom:15px' id='tgtable'‡lign='left'><tr><td bgcolor='#EBF5C9'>&nbsp;<strong>æ­£åœ¨è¿›è¡Œç›¸å…³å†…å®¹æ›´æ–°ï¼Œè¯·å®Œæˆå‰ä¸è¦è¿›è¡Œå…¶å®ƒæ“ä½œï¼š</strong>\r\n</td></tr>\r\n";

920 
$»v®ue
 .= "<tr><td>\r\n<iframe‚ame='stafrm' frameborder='0' id='stafrm' width='100%' height='200px' src='$jumpUrl'></iframe>\r\n</td></tr>\r\n";

921 
$»v®ue
 .= "</table>";

925 
$»v®ue
 = '';

927  
$»v®ue
;

928 
	}
}

	@E:\web\weixun\xakadmin\inc\inc_batchup.php

1 <?
php


17 
funùiÚ
 
D–Arc
(
$aid
, 
$ty³
='ON', 
$Úlyfe
=
FALSE
,
$»cyşe
=0)

19 
glob®
 
$dsql
,
$cfg_cook›_’code
,
$cfg_muÉi_s™e
,
$cfg_medŸs_dœ
;

20 
glob®
 
	g$cu£rLogš
,
	g$cfg_u¶ßd_sw™ch
,
	g$cfg_d–‘e
,
	g$cfg_ba£dœ
;

21 
glob®
 
	g$admš_ÿlogs
, 
	g$cfg_admš_chªÃl
;

23 if(
	g$cfg_d–‘e
 =ğ'N'è
$ty³
 = 'OK';

24 if(
em±y
(
$aid
))  ;

25 
	g$aid
 = 
´eg_»¶aû
("#[^0-9]#i", '', 
$aid
);

26 
	g$¬ù™Ë
 = 
$¬cu¾
 = '';

27 if(
	g$»cyşe
 =ğ1è
$wh””ecyşe
 = "AND‡rcrank = '-2'";

28 
	g$wh””ecyşe
 = "";

31 
	g$qu”y
 = "SELECT ch.maintable,ch.addtable,ch.nid,ch.issystem FROM `#@__arctiny`‡rc

32 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=
¬c
.
ty³id


33 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
=
¬c
.
chªÃl
 
WHERE
‡rc.id='$aid' ";

34 
$row
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

35 
	g$nid
 = 
$row
['nid'];

36 
	g$mašbË
 = (
Œim
(
$row
['maintable'])=='' ? '#@__archives' :rim($row['maintable']));

37 
	g$addbË
 = 
Œim
(
$row
['addtable']);

38 
	g$issy¡em
 = 
$row
['issystem'];

41 if(
	g$issy¡em
==-1)

43 
$¬cQu”y
 = "SELECT‡rc.*,tp.* from `$addtable`‡rc LEFT JOIN `#@__arctype`p ON‡rc.typeid=tp.id WHERE‡rc.aid='$aid' ";

47 
	g$¬cQu”y
 = "SELECT‡rc.*,tp.*,arc.id AS‡id FROM `$maintable`‡rc LEFT JOIN `#@__arctype`p ON‡rc.typeid=tp.id WHERE‡rc.id='$aid' ";

50 
	g$¬cRow
 = 
$dsql
->
G‘OÃ
(
$¬cQu”y
);

53 if(!
Te¡Purv›w
('a_Del,sys_ArcBatch'))

55 if(
Te¡Purv›w
('a_AccDel'))

57 ifĞ!
š_¬¿y
(
$¬cRow
['ty³id'], 
$admš_ÿlogs
è&& (
couÁ
($admš_ÿlogsè!ğ0 || 
$cfg_admš_chªÃl
 != 'all') )

59  
FALSE
;

62 if(
Te¡Purv›w
('a_MyDel'))

64 if(
	g$¬cRow
['mid'] !ğ
$cu£rLogš
->
g‘U£rID
())

66  
FALSE
;

71  
	gFALSE
;

76 if(
	g$issy¡em
 =ğ-1è
$ty³
 = 'OK';

77 if(!
is_¬¿y
(
$¬cRow
)è 
	gFALSE
;

80 if(
	g$cfg_d–‘e
 =ğ'Y' && 
$ty³
 == 'ON')

82 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `$maintable` SET‡rcrank='-2' WHERE id='$aid' ");

83 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__arctiny` SET `arcrank` = '-2' WHERE id = '$aid'; ");

88 if(!
	g$Úlyfe
)

90 
	g$qu”y
 = "Delete From `#@__arctiny` where id='$aid' $whererecycle";

91 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

93 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__feedback` where‡id='$aid' ");

94 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__member_stow` where‡id='$aid' ");

95 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__taglist` where‡id='$aid' ");

96 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__erradd` where‡id='$aid' ");

97 if(
	g$addbË
 != '')

99 
$dsql
->
Execu‹NÚeQu”y
("Delete From `$addtable` where‡id='$aid'");

101 if(
	g$issy¡em
 != -1)

103 
$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__archives` where id='$aid' $whererecycle");

106 if(
	g$cfg_u¶ßd_sw™ch
 == 'Y')

108 
$dsql
->
Execu‹
("me", "SELECT * FROM `#@__uploads` WHERE‡rcid = '$aid'");

109 
	g$row
 = 
$dsql
->
G‘A¼ay
('me'))

111 
$addfe
 = 
$row
['url'];

112 
	g$aid
 = 
$row
['aid'];

113 
	g$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__uploads` where‡id = '$aid' ");

114 
	g$upfe
 = 
$cfg_ba£dœ
.
$addfe
;

115 if(@
fe_exi¡s
(
$upfe
)è@
uÆšk
($upfile);

121 
	g$f’ameh
 = 
XAKDATA
."/‹xtd©a/".(
û
(
$aid
/5000))."/{$aid}-".
sub¡r
(
md5
(
$cfg_cook›_’code
),0,16).".txt";

122 if(@
is_fe
(
$f’ameh
)è@
uÆšk
($filenameh);

126 if(
em±y
(
$¬cRow
['mÚey'])è
	g$¬cRow
['money'] = 0;

127 if(
em±y
(
$¬cRow
['ismake'])è
	g$¬cRow
['ismake'] = 1;

128 if(
em±y
(
$¬cRow
['¬üªk'])è
	g$¬cRow
['arcrank'] = 0;

129 if(
em±y
(
$¬cRow
['f’ame'])è
	g$¬cRow
['filename'] = '';

132 if(
	g$¬cRow
['ismake']==-1 || 
$¬cRow
['arcrank']!=0 || $arcRow['typeid']==0 || $arcRow['money']>0)

134  
TRUE
;

138 
	g$GLOBALS
['cfg_multi_site'] = 'N';

139 
	g$¬cu¾
 = 
G‘FeU¾
(
$¬cRow
['aid'],$arcRow['typeid'],$arcRow['senddate'],$arcRow['title'],$arcRow['ismake'],

140 
$¬cRow
['arcrank'],$arcRow['namerule'],$arcRow['typedir'],$arcRow['money'],$arcRow['filename']);

141 if(!
´eg_m©ch
("#\?#", 
$¬cu¾
))

143 
	g$htmlfe
 = 
G‘TrueP©h
().
¡r_»¶aû
(
$GLOBALS
['cfg_ba£ho¡'],'',
$¬cu¾
);

144 if(
fe_exi¡s
(
$htmlfe
è&& !
is_dœ
($htmlfile))

146 @
uÆšk
(
$htmlfe
);

147 
	g$¬cu¾s
 = 
ex¶ode
(".", 
$htmlfe
);

148 
	g$¢ame
 = 
$¬cu¾s
[
couÁ
($arcurls)-1];

149 
	g$âame
 = 
´eg_»¶aû
("#(\.$¢ame)$#", "", 
$htmlfe
);

150 
	g$i
=2; $i<=100; $i++)

152 
	g$htmlfe
 = 
$âame
."_{$i}.".
$¢ame
;

153 ifĞ@
fe_exi¡s
(
$htmlfe
èè@
uÆšk
($htmlfile);

159  
	gŒue
;

163 
funùiÚ
 
G‘TrueP©h
(
$s™”eãr
='', 
$s™•©h
='')

165 
$Œu•©h
 = 
$GLOBALS
['cfg_basedir'];

166  
	g$Œu•©h
;

	@E:\web\weixun\xakadmin\inc\inc_catalog_options.php

1 <?
php


17 
funùiÚ
 
	$G‘O±iÚLi¡
(
$£lid
=0, 
$u£rC©®og
=0, 
$chªÃÉy³
=0)

19 
glob®
 
$O±iÚA¼ayLi¡
, 
$chªÃls
, 
$dsql
, 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
;

21 
$dsql
->
	`S‘Qu”y
("SELECT id,typename FROM `#@__channeltype` ");

22 
$dsql
->
	`Execu‹
();

23 
$chªÃls
 = 
	`A¼ay
();

24 
$row
 = 
$dsql
->
	`G‘Objeù
()è
$chªÃls
[$row->
id
] = $row->
ty³Çme
;

26 
$O±iÚA¼ayLi¡
 = '';

29 if(
$£lid
 > 0)

31 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id,typename,ispart,channeltype FROM `#@__arctype` WHERE id='$selid'");

32 if(
$row
['i¥¬t']==1è
$O±iÚA¼ayLi¡
 .= "<option value='".$row['id']."' class='option1' selected='selected'>".$row['typename']."(å°é¢é¢‘é“)</option>\r\n";

33 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
['id']."' selected='selected'>".$row['typename']."</option>\r\n";

37 ifĞ
$cfg_admš_chªÃl
=='array' )

39 if(
	`couÁ
(
$admš_ÿlogs
)==0)

41 
$qu”y
 = "SELECT id,typename,ispart,channeltype FROM `#@__arctype` WHERE 1=2 ";

45 
$admš_ÿlog
 = 
	`još
(',', 
$admš_ÿlogs
);

46 
$dsql
->
	`S‘Qu”y
("SELECT„eid FROM `#@__arctype` WHERE id IN($admin_catalog) GROUP BY„eid ");

47 
$dsql
->
	`Execu‹
();

48 
$tİid¡r
 = '';

49 
$row
 = 
$dsql
->
	`G‘Objeù
())

51 if(
$row
->
»id
==0) ;

52 
$tİid¡r
 .ğ($tİid¡r=='' ? 
$row
->
»id
 : ','.$row->reid);

54 
$admš_ÿlog
 .ğ','.
$tİid¡r
;

55 
$admš_ÿlogs
 = 
	`ex¶ode
(',', 
$admš_ÿlog
);

56 
$admš_ÿlogs
 = 
	`¬¿y_unique
($admin_catalogs);

57 
$admš_ÿlog
 = 
	`još
(',', 
$admš_ÿlogs
);

58 
$admš_ÿlog
 = 
	`´eg_»¶aû
("#,$#", '', $admin_catalog);

59 
$qu”y
 = "SELECT id,typename,ispart,channeltype FROM `#@__arctype` WHERE id IN($admin_catalog) AND„eid=0 AND ispart<>2 ";

64 
$qu”y
 = "SELECT id,typename,ispart,channeltype FROM `#@__arctype` WHERE ispart<>2 AND„eid=0 ORDER BY sortrank ASC ";

67 
$dsql
->
	`S‘Qu”y
(
$qu”y
);

68 
$dsql
->
	`Execu‹
();

70 
$row
=
$dsql
->
	`G‘Objeù
())

72 
$sÚC©s
 = '';

73 
	`LogicG‘O±iÚA¼ay
(
$row
->
id
, 'â”€', 
$chªÃÉy³
, 
$dsql
, 
$sÚC©s
);

74 if(
$sÚC©s
 != '')

76 if(
$row
->
i¥¬t
==1è
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".$row->
id
."' cÏss='İtiÚ1'>".$row->
ty³Çme
."(å°é¢é¢‘é“)</option>\r\n";

77 if(
$row
->
i¥¬t
==2è
$O±iÚA¼ayLi¡
 .= '';

78 ifĞ
	`em±y
(
$chªÃÉy³
è&& 
$row
->
i¥¬t
 !ğ0 ) 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".$row->
id
."' cÏss='İtiÚ2'>".$row->
ty³Çme
."(".
$chªÃls
[$row->
chªÃÉy³
].")</option>\r\n";

79 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ3'>".$row->
ty³Çme
."</option>\r\n";

80 
$O±iÚA¼ayLi¡
 .ğ
$sÚC©s
;

84 if(
$row
->
i¥¬t
==0 && (!
	`em±y
(
$chªÃÉy³
è&& $row->
chªÃÉy³
 == $channeltype) )

86 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ3'>".$row->
ty³Çme
."</option>\r\n";

87 } if(
$row
->
i¥¬t
==0 && 
	`em±y
(
$chªÃÉy³
) )

90 
$O±iÚA¼ayLi¡
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ3'>".$row->
ty³Çme
."</option>\r\n";

94  
$O±iÚA¼ayLi¡
;

95 
	}
}

97 
funùiÚ
 
	$LogicG‘O±iÚA¼ay
(
$id
,
$¡•
,
$chªÃÉy³
,&
$dsql
, &
$sÚC©s
)

99 
glob®
 
$O±iÚA¼ayLi¡
, 
$chªÃls
, 
$cfg_admš_chªÃl
, 
$admš_ÿlogs
;

100 
$dsql
->
	`S‘Qu”y
("S–eù id,ty³Çme,i¥¬t,chªÃÉy³ From `#@__¬ùy³` wh”»id='".
$id
."' And ispart<>2 order by sortrank‡sc");

101 
$dsql
->
	`Execu‹
(
$id
);

102 
$row
=
$dsql
->
	`G‘Objeù
(
$id
))

104 if(
$cfg_admš_chªÃl
 !ğ'®l' && !
	`š_¬¿y
(
$row
->
id
, 
$admš_ÿlogs
))

108 if(
$row
->
chªÃÉy³
==
$chªÃÉy³
 && $row->
i¥¬t
==1)

110 
$sÚC©s
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ1'>$¡•".$row->
ty³Çme
."</option>\r\n";

112 ifĞ(
$row
->
chªÃÉy³
==
$chªÃÉy³
 && $row->
i¥¬t
==0è|| 
	`em±y
($channeltype) )

114 
$sÚC©s
 .ğ"<İtiÚ v®ue='".
$row
->
id
."' cÏss='İtiÚ3'>$¡•".$row->
ty³Çme
."</option>\r\n";

116 
	`LogicG‘O±iÚA¼ay
(
$row
->
id
,
$¡•
.'â”€',
$chªÃÉy³
,
$dsql
, 
$sÚC©s
);

118 
	}
}

	@E:\web\weixun\xakadmin\inc\inc_coonepage.php

1 <?
php


7 
»quœe_Úû
(
XAKINC
.'/charset.func.php');

16 
funùiÚ
 
	$CoOÃPage
(
$gu¾
)

18 
glob®
 
$dsql
,
$cfg_auÙ_desütiÚ
, 
$cfg_soá_Ïng
;

19 
$»d©as
 = 
	`¬¿y
('title' => '','body' => '','source' => '','writer' => '','description' => '','keywords' => '');

20 
$»d©as
['sourû'] = 
	`´eg_»¶aû
("/h‰p:\/\//i","",
$gu¾
);

21 
$»d©as
['sourû'] = 
	`´eg_»¶aû
("/\/(.*)$/i","",$redatas['source']);

22 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__co_Ú•age` WHERE u¾ LIKE '".
$»d©as
['source']."' ");

23 
$s
 = 
$e
 = '';

24 if(
	`is_¬¿y
(
$row
))

26 
	`li¡
(
$s
,
$e
èğ
	`ex¶ode
('{@body}',
$row
['rule']);

27 
$s
 = 
	`Œim
($s);

28 
$e
 = 
	`Œim
($e);

29 if(
$row
['issource']==1)

31 
$»d©as
['sourû'] = 
$row
['title'];

34 
$htd
 = 
Ãw
 
	`XakH‰pDown
();

35 
$htd
->
	`O³nU¾
(
$gu¾
);

36 
$body
 = 
$htd
->
	`G‘Html
();

37 if(
$body
!='')

40 if(
$cfg_soá_Ïng
=='utf-8')

42 if(
$row
['lang']=='gb2312')

44 
$body
 = 
	`gb2utf8
($body);

47 if(
$cfg_soá_Ïng
=='gb2312')

49 if(
$row
['lang']=='utf-8')

51 
$body
 = 
	`utf82gb
($body);

56 
$š¬r
 = 
	`¬¿y
();

57 
	`´eg_m©ch
("/<t™Ë>(.*)<\/t™Ë>/isU",
$body
,
$š¬r
);

58 if(
	`is£t
(
$š¬r
[1]))

60 
$»d©as
['t™Ë'] = 
$š¬r
[1];

64 
$š¬r
 = 
	`¬¿y
();

65 
	`´eg_m©ch
("/<m‘a[\s]+Çme=['\"]keywÜds['\"] cÚ‹Á=['\"](.*)['\"]/isU",
$body
,
$š¬r
);

66 if(
	`is£t
(
$š¬r
[1]))

68 
$»d©as
['keywÜds'] = 
	`ú_sub¡r
(
	`html2‹xt
(
$š¬r
[1]),30);

72 
$š¬r
 = 
	`¬¿y
();

73 
	`´eg_m©ch
("/<m‘a[\s]+Çme=['\"]desütiÚ['\"] cÚ‹Á=['\"](.*)['\"]/isU",
$body
,
$š¬r
);

74 if(
	`is£t
(
$š¬r
[1]))

76 
$»d©as
['desütiÚ'] = 
	`ú_sub¡r
(
	`html2‹xt
(
$š¬r
[1]),
$cfg_auÙ_desütiÚ
);

80 if(
$s
!='' && 
$e
!='')

82 
$»d©as
['body'] = 
	`G‘HtmlA»aA
(
$s
,
$e
,
$body
);

83 if(
$»d©as
['body']!='' && $redatas['description']=='')

85 
$»d©as
['desütiÚ'] = 
	`ú_sub¡r
(
	`html2‹xt
($»d©as['body']),
$GLOBALS
['cfg_auot_description']);

89  
$»d©as
;

90 
	}
}

101 
funùiÚ
 
	$G‘HtmlA»aA
(
$s
, 
$e
, &
$html
)

103 if(
$html
==""||
$s
=="")

107 
$pos¡¬t
 = @
	`¡½os
(
$html
,
$s
);

108 if(
$pos¡¬t
 ==ğ
FALSE
)

112 
$po£nd
 = 
	`¡½os
(
$html
, 
$e
, 
$pos¡¬t
);

113 if(
$po£nd
 > 
$pos¡¬t
 && $po£nd !=ğ
FALSE
)

115  
	`sub¡r
(
$html
, 
$pos¡¬t
+
	`¡¾’
(
$s
), 
$po£nd
-$posstart-strlen($s));

120 
	}
}

	@E:\web\weixun\xakadmin\inc\inc_list_functions.php

1 <?
php


7 if(!
	$is£t
(
$»gi¡”Glob®s
))

9 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
)."/../../functions/common.inc.php");

10 
	}
}

13 
funùiÚ
 
	$G‘Ty³Çme
(
$tid
)

15 
glob®
 
$dsql
;

16 ià(
	`em±y
(
$tid
))  '';

17 ià(
	`fe_exi¡s
(
XAKDATA
.'/cache/inc_catalog_base.inc'))

19 
	`»quœe_Úû
(
XAKDATA
.'/cache/inc_catalog_base.inc');

20 
glob®
 
$cfg_Cs
;

21 ià(
	`is£t
(
$cfg_Cs
[
$tid
]))

23  
	`ba£64_decode
(
$cfg_Cs
[
$tid
][3]);

26 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECTypename FROM #@__arctype WHERE id = '{$tid}'");

27 
	`un£t
(
$dsql
);

28 
	`un£t
(
$cfg_Cs
);

29  
	`is£t
(
$row
['typename'])? $row['typename'] : '';

32 
	}
}

35 
	g$¬ÿ‰s
 = 
¬¿y
();

36 
	g$dsql
->
Execu‹
('n', 'SELECT * FROM `#@__arcatt` ');

37 
	g$¬r
 = 
$dsql
->
G‘A¼ay
('n'))

39 
$¬ÿ‰s
[
$¬r
['att']] = $arr['attname'];

42 
funùiÚ
 
	$IsComm’dArchives
(
$iscomm’d
)

44 
glob®
 
$¬ÿ‰s
;

45 
$¢
 = '';

46 
	`fÜ—ch
(
$¬ÿ‰s
 
as
 
$k
=>
$v
)

48 
$v
 = 
	`ú_sub¡r
($v, 2);

49 
$¢
 .ğ(
	`´eg_m©ch
("#".
$k
."#", 
$iscomm’d
è? ' '.
$v
 : '');

51 
$¢
 = 
	`Œim
($sn);

52 if(
$¢
=='')  '';

54 
	}
}

57 
funùiÚ
 
	$G‘Comm’dT™Ë
(
$t™Ë
,
$iscomm’d
)

63  
$t™Ë
;

64 
	}
}

67 
	g$GLOBALS
['RndTrunID'] = 1;

68 
funùiÚ
 
	$G‘CŞÜ
(
$cŞÜ1
,
$cŞÜ2
)

70 
$GLOBALS
['RndTrunID']++;

71 if(
$GLOBALS
['RndTrunID']%2==0)

73  
$cŞÜ1
;

77  
$cŞÜ2
;

79 
	}
}

82 
funùiÚ
 
	$CheckPic
(
$piúame
)

84 if(
$piúame
!="")

86  
$piúame
;

92 
	}
}

95 
funùiÚ
 
	$IsHtmlArchives
(
$ismake
)

97 if(
$ismake
==1)

101 if(
$ismake
==-1)

109 
	}
}

112 
funùiÚ
 
	$G‘RªkName
(
$¬üªk
)

114 
glob®
 
$¬cA¼ay
,
$dsql
;

115 if(!
	`is_¬¿y
(
$¬cA¼ay
))

117 
$dsql
->
	`S‘Qu”y
("SELECT * FROM `#@__arcrank` ");

118 
$dsql
->
	`Execu‹
();

119 
$row
 = 
$dsql
->
	`G‘Objeù
())

121 
$¬cA¼ay
[
$row
->
¿nk
]=$row->
memb”Çme
;

124 if(
	`is£t
(
$¬cA¼ay
[
$¬üªk
]))

126  
$¬cA¼ay
[
$¬üªk
];

132 
	}
}

135 
funùiÚ
 
	$IsPicArchives
(
$piúame
)

137 if(
$piúame
 != '')

145 
	}
}

	@E:\web\weixun\xakadmin\inc\inc_menu.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

10 
	g$add£t
 = '';

13 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

15 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

16 
	g$dsql
->
S‘Qu”y
(" SELECT channeltype FROM `#@__arctype` WHERE id IN({$admin_catalog}) GROUP BY channeltype ");

20 
	g$dsql
->
S‘Qu”y
(" SELECT channeltype FROM `#@__arctype` GROUP BY channeltype ");

22 
	g$dsql
->
Execu‹
();

23 
	g$ÿndoChªÃl
 = '';

24 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

26 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

27 
	}
}

28 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

29 
	g$dsql
->
S‘Qu”y
("SELECT id,typename,addcon,mancon FROM `#@__channeltype` WHERE id IN({$candoChannel}) AND id<>-1 AND isshow=1 ORDER BY id ASC");

30 
	g$dsql
->
Execu‹
();

31 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

33 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

34 
	}
}

37 
	g$admšM’u1
 = 
$admšM’u2
 = '';

38 if(
	g$cu£rLogš
->
g‘U£rTy³
() >= 10)

40 
$admšM’u1
 = "<m:top item='1_'‚ame='é¢‘é“æ¨¡å‹' display='block'„ank='t_List,t_AccList,c_List,temp_One'>

41 <
m
:
™em
 
Çme
='å†…å®¹æ¨¡å‹ç®¡ç†' 
lšk
='mychªÃl_maš.php' 
¿nk
='c_Li¡' 
rg‘
='main' />

42 <
m
:
™em
 
Çme
='å•é¡µæ–‡æ¡£ç®¡ç†' 
lšk
='‹m¶‘s_Úe.php' 
¿nk
='‹mp_OÃ' 
rg‘
='main'/>

43 <
m
:
™em
 
Çme
='è”åŠ¨ç±»åˆ«ç®¡ç†' 
lšk
='¡•£Ëù_maš.php' 
¿nk
='c_S‹p£şeù' 
rg‘
='main' />

44 <
m
:
™em
 
Çme
='è‡ªç”±åˆ—è¡¨ç®¡ç†' 
lšk
='ä“li¡_maš.php' 
¿nk
='c_Li¡' 
rg‘
='main' />

45 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰è¡¨å•' 
lšk
='diy_maš.php' 
¿nk
='c_Li¡' 
rg‘
='main' />

46 </
m
:
tİ
>

48 
$admšM’u2
 = "<m:top item='7_'‚ame='æ¨¡æ¿ç®¡ç†' display='none'„ank='temp_One,temp_Other,temp_MyTag,temp_test,temp_All'>

49 <
m
:
™em
 
Çme
='é»˜è®¤æ¨¡æ¿ç®¡ç†' 
lšk
='‹m¶‘s_maš.php' 
¿nk
='‹mp_AÎ' 
rg‘
='main'/>

50 <
m
:
™em
 
Çme
='æ ‡ç­¾æºç ç®¡ç†' 
lšk
='‹m¶‘s_gsourû.php' 
¿nk
='‹mp_AÎ' 
rg‘
='main'/>

51 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰å®æ ‡è®°' 
lšk
='myg_maš.php' 
¿nk
='‹mp_MyTag' 
rg‘
='main'/>

52 <
m
:
™em
 
Çme
='æ™ºèƒ½æ ‡è®°å‘å¯¼' 
lšk
='myg_g_guide.php' 
¿nk
='‹mp_Oth”' 
rg‘
='main'/>

53 <
m
:
™em
 
Çme
='å…¨å±€æ ‡è®°æµ‹è¯•' 
lšk
='g_‹¡.php' 
¿nk
='‹mp_Te¡' 
rg‘
='main'/>

54 </
m
:
tİ
>

56 <
m
:
tİ
 
™em
='10_' 
Çme
='ç³»ç»Ÿè®¾ç½®' 
di¥Ïy
='nÚe' 
¿nk
='sys_User,sys_Group,sys_Edit,sys_Log,sys_Data'>

57 <
m
:
™em
 
Çme
='ç³»ç»ŸåŸºæœ¬å‚æ•°' 
lšk
='sys_šfo.php' 
¿nk
='sys_Ed™' 
rg‘
='main' />

58 <
m
:
™em
 
Çme
='ç³»ç»Ÿç”¨æˆ·ç®¡ç†' 
lšk
='sys_admš_u£r.php' 
¿nk
='sys_U£r' 
rg‘
='main' />

59 <
m
:
™em
 
Çme
='ç”¨æˆ·ç»„è®¾å®š' 
lšk
='sys_group.php' 
¿nk
='sys_Group' 
rg‘
='main' />

60 <
m
:
™em
 
Çme
='æœåŠ¡å™¨åˆ†å¸ƒ/è¿œç¨‹' 
lšk
='sys_muÉi£rv.php' 
¿nk
='sys_Group' 
rg‘
='main' />

61 <
m
:
™em
 
Çme
='ç³»ç»Ÿæ—¥å¿—ç®¡ç†' 
lšk
='log_li¡.php' 
¿nk
='sys_Log' 
rg‘
='main' />

62 <
m
:
™em
 
Çme
='éªŒè¯å®‰å…¨è®¾ç½®' 
lšk
='sys_§ã.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

63 <
m
:
™em
 
Çme
='å›¾ç‰‡æ°´å°è®¾ç½®' 
lšk
='sys_šfo_m¬k.php' 
¿nk
='sys_Ed™' 
rg‘
='main' />

64 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰æ–‡æ¡£å±æ€§' 
lšk
='cÚ‹Á_©t.php' 
¿nk
='sys_A‰' 
rg‘
='main' />

65 <
m
:
™em
 
Çme
='è½¯ä»¶é¢‘é“è®¾ç½®' 
lšk
='soá_cÚfig.php' 
¿nk
='sys_SoáCÚfig' 
rg‘
='main' />

66 <
m
:
™em
 
Çme
='é˜²é‡‡é›†ä¸²æ··æ·†' 
lšk
='¬tişe_¡ršg_mix.php' 
¿nk
='sys_SŒšgMix' 
rg‘
='main' />

67 <
m
:
™em
 
Çme
='éšæœºæ¨¡æ¿è®¾ç½®' 
lšk
='¬tişe_‹m¶©e_¿nd.php' 
¿nk
='sys_SŒšgMix' 
rg‘
='main' />

68 <
m
:
™em
 
Çme
='è®¡åˆ’ä»»åŠ¡ç®¡ç†' 
lšk
='sys_sk.php' 
¿nk
='sys_Task' 
rg‘
='main' />

69 <
m
:
™em
 
Çme
='æ•°æ®åº“å¤‡ä»½/è¿˜åŸ' 
lšk
='sys_d©a.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

70 <
m
:
™em
 
Çme
='SQLå‘½ä»¤è¡Œå·¥å…·' 
lšk
='sys_sql_qu”y.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

71 <
m
:
™em
 
Çme
='æ–‡ä»¶æ ¡éªŒ[S]' 
lšk
='sys_v”if›s.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

72 <
m
:
™em
 
Çme
='ç—…æ¯’æ‰«æ[S]' 
lšk
='sys_§ã‹¡.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

73 <
m
:
™em
 
Çme
='ç³»ç»Ÿé”™è¯¯ä¿®å¤[S]' 
lšk
='sys_»·œ.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

74 </
m
:
tİ
>

76 <
m
:
tİ
 
™em
='10_6_' 
Çme
='æ”¯ä»˜å·¥å…·' 
di¥Ïy
='nÚe' 
¿nk
='sys_Data'>

77 <
m
:
™em
 
Çme
='ç‚¹å¡äº§å“åˆ†ç±»' 
lšk
='ÿrds_ty³.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

78 <
m
:
™em
 
Çme
='ç‚¹å¡äº§å“ç®¡ç†' 
lšk
='ÿrds_mªage.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

79 <
m
:
™em
 
Çme
='ä¼šå‘˜äº§å“åˆ†ç±»' 
lšk
='memb”_ty³.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

80 <
m
:
™em
 
Çme
='ä¼šå‘˜æ¶ˆè´¹è®°å½•' 
lšk
='memb”_İ”©iÚs.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

81 <
m
:
™em
 
Çme
='å•†åº—è®¢å•è®°å½•' 
lšk
='shİs_İ”©iÚs.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

82 <
m
:
™em
 
Çme
='æ”¯ä»˜æ¥å£è®¾ç½®' 
lšk
='sys_·ym’t.php' .
php
'„ªk='
sys_D©a
'¬g‘='
maš
' />

83 <
m
:
™em
 
Çme
='é…è´§æ–¹å¼è®¾ç½®' 
lšk
='shİs_d–iv”y.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

84 </
m
:
tİ
>

87 
$»mÙeM’u
 = (
$cfg_»mÙe_s™e
=='Y')? "<m:item‚ame='è¿œç¨‹æœåŠ¡å™¨åŒæ­¥'†ink='makeremote_all.php'„ank='sys_ArcBatch'arget='main' />" : "";

88 
	g$m’usMaš
 = "

91 <
m
:
tİ
 
™em
='1_' 
Çme
='å¸¸ç”¨æ“ä½œ' 
di¥Ïy
='block'>

92 <
m
:
™em
 
Çme
='ç½‘ç«™æ ç›®ç®¡ç†' 
lšk
='ÿlog_maš.php' 
ischªÃl
='1' 
add®t
='åˆ›å»ºæ ç›®' 
lškadd
='ÿlog_add.php?li¡ty³÷Î' 
¿nk
='t_Li¡,t_AccLi¡' 
rg‘
='main' />

93 <
m
:
™em
 
Çme
='æ‰€æœ‰æ¡£æ¡ˆåˆ—è¡¨' 
lšk
='cÚ‹Á_li¡.php' 
¿nk
='a_Li¡,a_AccLi¡' 
rg‘
='main' />

94 <
m
:
™em
 
Çme
='ç­‰å®¡æ ¸çš„æ¡£æ¡ˆ' 
lšk
='cÚ‹Á_li¡.php?¬üªk=-1' 
¿nk
='a_Check,a_AccCheck' 
rg‘
='main' />

95 <
m
:
™em
 
Çme
='æˆ‘å‘å¸ƒçš„æ–‡æ¡£' 
lšk
='cÚ‹Á_li¡.php?mid=".$cu£rLogš->g‘U£rID()."' 
¿nk
='a_Li¡,a_AccLi¡,a_MyLi¡' 
rg‘
='main' />

96 <
m
:
™em
 
Çme
='è¯„è®ºç®¡ç†' 
lšk
='ãedback_maš.php' 
¿nk
='sys_F“dback' 
rg‘
='main' />

97 <
m
:
™em
 
Çme
='å†…å®¹å›æ”¶ç«™' 
lšk
='»cyşšg.php' 
ischªÃl
='1' 
add®t
='æ¸…ç©ºå›æ”¶ç«™' 
addico
='images/gtk-d–.²g' 
lškadd
='¬chives_do.php?dİo¡=ş—r&aidòo&»cyşe=1' 
¿nk
='a_Li¡,a_AccLi¡,a_MyLi¡' 
rg‘
='main' />

98 </
m
:
tİ
>

100 <
m
:
tİ
 
™em
='1_' 
Çme
='å†…å®¹ç®¡ç†' 
di¥Ïy
='block'>

101 
$add£t


102 <
m
:
™em
 
Çme
='ä¸“é¢˜ç®¡ç†' 
ischªÃl
='1' 
lšk
='cÚ‹Á_s_li¡.php' 
lškadd
='¥ec_add.php' 
chªÃlid
='-1' 
¿nk
='¥ec_New' 
rg‘
='main' />

103 </
m
:
tİ
>

105 <
m
:
tİ
 
™em
='1_' 
Çme
='é™„ä»¶ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='sys_Upload,sys_MyUpload,plus_æ–‡ä»¶ç®¡ç†å™¨'>

106 <
m
:
™em
 
Çme
='ä¸Šä¼ æ–°æ–‡ä»¶' 
lšk
='medŸ_add.php' 
¿nk
='' 
rg‘
='main' />

107 <
m
:
™em
 
Çme
='é™„ä»¶æ•°æ®ç®¡ç†' 
lšk
='medŸ_maš.php' 
¿nk
='sys_U¶ßd,sys_MyU¶ßd' 
rg‘
='main' />

108 <
m
:
™em
 
Çme
='æ–‡ä»¶å¼ç®¡ç†å™¨' 
lšk
='medŸ_maš.php?dİo¡=femªag”' 
¿nk
='¶us_æ–‡ä»¶ç®¡ç†å™¨' 
rg‘
='main' />

109 </
m
:
tİ
>

111 
$admšM’u1


113 <
m
:
tİ
 
™em
='3_' 
Çme
='é‡‡é›†ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='co_NewRule,co_ListNote,co_ViewNote,co_Switch,co_GetOut'>

114 <
m
:
™em
 
Çme
='é‡‡é›†èŠ‚ç‚¹ç®¡ç†' 
lšk
='co_maš.php' 
¿nk
='co_Li¡NÙe' 
rg‘
='main' />

115 <
m
:
™em
 
Çme
='ä¸´æ—¶å†…å®¹ç®¡ç†' 
lšk
='co_u¾.php' 
¿nk
='co_V›wNÙe' 
rg‘
='main' />

116 <
m
:
™em
 
Çme
='å¯¼å…¥é‡‡é›†è§„åˆ™' 
lšk
='co_g‘_cÜuË.php' 
¿nk
='co_G‘Out' 
rg‘
='main'/>

117 <
m
:
™em
 
Çme
='ç›‘æ§é‡‡é›†æ¨¡å¼' 
lšk
='co_g©h”_¡¬t.php' 
¿nk
='co_G‘Out' 
rg‘
='main'/>

118 <
m
:
™em
 
Çme
='é‡‡é›†æœªä¸‹è½½å†…å®¹' 
lšk
='co_do.php?dİo¡=cßÎ' 
¿nk
='co_G‘Out' 
rg‘
='main'/>

119 </
m
:
tİ
>

121 <
m
:
tİ
 
™em
='1_3_3' 
Çme
='æ‰¹é‡ç»´æŠ¤' 
di¥Ïy
='block'>

122 <
m
:
™em
 
Çme
='æ›´æ–°ç³»ç»Ÿç¼“å­˜' 
lšk
='sys_ÿche_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

123 <
m
:
™em
 
Çme
='æ–‡æ¡£æ‰¹é‡ç»´æŠ¤' 
lšk
='cÚ‹Á_b©ch_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

124 <
m
:
™em
 
Çme
='æœç´¢å…³é”®è¯ç»´æŠ¤' 
lšk
='£¬ch_keywÜds_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

125 <
m
:
™em
 
Çme
='æ–‡æ¡£å…³é”®è¯ç»´æŠ¤' 
lšk
='¬tişe_keywÜds_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

126 <
m
:
™em
 
Çme
='é‡å¤æ–‡æ¡£æ£€æµ‹' 
lšk
='¬tişe_‹¡_§me.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

127 <
m
:
™em
 
Çme
='è‡ªåŠ¨æ‘˜è¦|åˆ†é¡µ' 
lšk
='¬tişe_desütiÚ_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

128 <
m
:
™em
 
Çme
='TAGæ ‡ç­¾ç®¡ç†' 
lšk
='gs_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

129 <
m
:
™em
 
Çme
='æ•°æ®åº“å†…å®¹æ›¿æ¢' 
lšk
='sys_d©a_»¶aû.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

130 </
m
:
tİ
>

132 <
m
:
tİ
 
™em
='5_' 
Çme
='è‡ªåŠ¨ä»»åŠ¡' 
nÙshow®l
='1' 
di¥Ïy
='block' 
¿nk
='sys_MakeHtml'>

133 <
m
:
™em
 
Çme
='ä¸€é”®æ›´æ–°ç½‘ç«™' 
lšk
='makehtml_®l.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

134 <
m
:
™em
 
Çme
='æ›´æ–°ç³»ç»Ÿç¼“å­˜' 
lšk
='sys_ÿche_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

135 {
$»mÙeM’u
}

136 </
m
:
tİ
>

138 <
m
:
tİ
 
™em
='5_' 
Çme
='HTMLæ›´æ–°' 
nÙshow®l
='1' 
di¥Ïy
='nÚe' 
¿nk
='sys_MakeHtml'>

139 <
m
:
™em
 
Çme
='æ›´æ–°ä¸»é¡µHTML' 
lšk
='makehtml_hom•age.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

140 <
m
:
™em
 
Çme
='æ›´æ–°æ ç›®HTML' 
lšk
='makehtml_li¡.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

141 <
m
:
™em
 
Çme
='æ›´æ–°æ–‡æ¡£HTML' 
lšk
='makehtml_¬chives.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

142 <
m
:
™em
 
Çme
='æ›´æ–°ç½‘ç«™åœ°å›¾' 
lšk
='makehtml_m­_guide.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

143 <
m
:
™em
 
Çme
='æ›´æ–°RSSæ–‡ä»¶' 
lšk
='makehtml_rss.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

144 <
m
:
™em
 
Çme
='è·å–JSæ–‡ä»¶' 
lšk
='makehtml_js.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

145 <
m
:
™em
 
Çme
='æ›´æ–°ä¸“é¢˜HTML' 
lšk
='makehtml_¥ec.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

146 </
m
:
tİ
>

148 <
m
:
tİ
 
™em
='6_' 
Çme
='ä¼šå‘˜ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='member_List,member_Type'>

149 <
m
:
™em
 
Çme
='æ³¨å†Œä¼šå‘˜åˆ—è¡¨' 
lšk
='memb”_maš.php' 
¿nk
='memb”_Li¡' 
rg‘
='main' />

150 <
m
:
™em
 
Çme
='ä¼šå‘˜çº§åˆ«è®¾ç½®' 
lšk
='memb”_¿nk.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

151 <
m
:
™em
 
Çme
='ç§¯åˆ†å¤´è¡”è®¾ç½®' 
lšk
='memb”_scÜes.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

152 <
m
:
™em
 
Çme
='ä¼šå‘˜æ¨¡å‹ç®¡ç†' 
lšk
='memb”_mod–_maš.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

153 <
m
:
™em
 
Çme
='ä¼šå‘˜çŸ­ä¿¡ç®¡ç†' 
lšk
='memb”_pm.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

154 <
m
:
™em
 
Çme
='ä¼šå‘˜ç•™è¨€ç®¡ç†' 
lšk
='memb”_gue¡book.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

155 <
m
:
™em
 
Çme
='ä¼šå‘˜åŠ¨æ€ç®¡ç†' 
lšk
='memb”_šfo_maš.php?ty³=ãed' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

156 <
m
:
™em
 
Çme
='ä¼šå‘˜å¿ƒæƒ…ç®¡ç†' 
lšk
='memb”_šfo_maš.php?ty³=mood' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

157 </
m
:
tİ
>

159 
$admšM’u2


	@E:\web\weixun\xakadmin\inc\inc_menu_func.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

8 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
	g$h—dTem¶‘
 = "<dl class='bitem' id='sunitems~cc~'><dt onClick='showHide(\"items~cc~\")'><b class='~classname~'>~channelname~</b></dt>

11 <
dd
 
¡yË
='di¥Ïy:~di¥Ïy~' 
şass
='s™em' 
id
='items~cc~'>

12 <
ul
 
şass
='s™emu'>\
r
\
n
";

14 
$foÙTem¶‘
 = "</ul>\r\n</dd>\r\n</dl>\r\n";

16 
	g$™emTem¶‘
 = "<li class='~classname~'>~link~</li>\r\n";

18 
funùiÚ
 
G‘M’us
(
$u£¼ªk
,
$tİos
='main')

20 
glob®
 
$İ’™em
,
$h—dTem¶‘
,
$foÙTem¶‘
,
$™emTem¶‘
;

21 if(
	g$tİos
=='main')

23 
$İ’™em
 = (
em±y
($openitem) ? 1 : $openitem);

24 
	g$m’us
 = 
$GLOBALS
['menusMain'];

26 if(
	g$tİos
=='module')

28 
$İ’™em
 = 100;

29 
	g$m’us
 = 
$GLOBALS
['menusMoudle'];

31 
	g$d
 = 
Ãw
 
XakTagP¬£
();

32 
	g$d
->
S‘NameS·û
('m','<','>');

33 
	g$d
->
LßdSourû
(
$m’us
);

34 
	g$d2
 = 
Ãw
 
XakTagP¬£
();

35 
	g$d2
->
S‘NameS·û
('m','<','>');

36 
	g$m
 = 0;

37 
fÜ—ch
(
$d
->
CTags
 
as
 
$i
=>
$ùag
)

39 if(
$ùag
->
G‘Name
()=='tİ' && ($ùag->
G‘A‰
('¿nk')=='' || 
Te¡Purv›w
($ctag->GetAtt('rank')) ))

41 if(
$İ’™em
!=999 && !
´eg_m©ch
("#".$İ’™em.'_'."#", 
$ùag
->
G‘A‰
('™em')è&& 
	g$İ’™em
!=100) ;

42 
	g$m
++;

43 
	gecho
 "<!-- I‹m ".(
	g$m
+1)." Strat -->\r\n";

44 
	g$htmp
 = 
¡r_»¶aû
("~chªÃÊame~",
$ùag
->
G‘A‰
("Çme"),
$h—dTem¶‘
);

45 
	g$htmp
 = 
¡r_»¶aû
("~şas¢ame~",
$ùag
->
G‘A‰
("şass"),
$htmp
);

46 if(
em±y
(
$İ’™em
è|| 
	g$İ’™em
==100)

48 if(
$ùag
->
G‘A‰
('notshowall')=='1') ;

49 
	g$htmp
 = 
¡r_»¶aû
('~di¥Ïy~',
$ùag
->
G‘A‰
('di¥Ïy'),
$htmp
);

53 if(
	g$İ’™em
==
$ùag
->
G‘A‰
('™em'è|| 
´eg_m©ch
("#".
$İ’™em
.'_'."#", $ctag->GetAtt('item')) || $openitem=='-1')

54 
$htmp
 = 
¡r_»¶aû
('~display~','block',$htmp);

56 
	g$htmp
 = 
¡r_»¶aû
('~di¥Ïy~','nÚe',
$htmp
);

58 
	g$htmp
 = 
¡r_»¶aû
('~cc~',
$m
.'_'.
$İ’™em
,
$htmp
);

59 
echo
 
	g$htmp
;

60 
	g$d2
->
LßdSourû
(
$ùag
->
IÂ”Text
);

61 
fÜ—ch
(
$d2
->
CTags
 
as
 
$j
=>
$ùag2
)

63 
$ischªÃl
 = 
Œim
(
$ùag2
->
G‘A‰
('ischannel'));

64 if(
	g$ùag2
->
G‘Name
()=='™em' && (
$ùag2
->
G‘A‰
('¿nk')=='' || 
Te¡Purv›w
($ctag2->GetAtt('rank')) ) )

66 
$lšk
 = "<¨h»f='".
$ùag2
->
G‘A‰
('link')."'arget='".$ctag2->GetAtt('target')."'>".$ctag2->GetAtt('name')."</a>";

67 if(
	g$ischªÃl
=='1')

69 if(
$ùag2
->
G‘A‰
('addalt')!='') {

70 
$add®t
 = 
$ùag2
->
G‘A‰
('addalt');

73 
	g$add®t
 = 'å½•å…¥æ–°å†…å®¹';

76 if(
	g$ùag2
->
G‘A‰
('addico')!='') {

77 
$addico
 = 
$ùag2
->
G‘A‰
('addico');

80 
	g$addico
 = 'images/gtk-sadd.png';

84 
	g$lšk
 = " <div class='items'>

85 <
div
 
şass
='ælù'>
$lšk
</div>\
r
\
n


86 <
div
 
şass
='flrct'>

87 <
a
 
h»f
='".$ùag2->G‘A‰('
lškadd
')."' 
rg‘
='".$ùag2->G‘A‰('rg‘')."'><
img
 
¤c
='$addico' 
®t
='$add®t' 
t™Ë
='$addalt'/></a>

88 </
div
>

89 </
div
>\
r
\
n
";

94 
	g$lšk
 .= "\r\n";

96 
	g$™emtmp
 = 
¡r_»¶aû
('~lšk~',
$lšk
,
$™emTem¶‘
);

97 
	g$™emtmp
 = 
¡r_»¶aû
('~şas¢ame~',
$ùag2
->
G‘A‰
('şass'),
$™emtmp
);

98 
echo
 
	g$™emtmp
;

101 
echo
 
	g$foÙTem¶‘
;

102 
	gecho
 "<!-- I‹m ".(
	g$m
+1)." End -->\r\n";

	@E:\web\weixun\xakadmin\inc\inc_menu_map.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

9 
	g$m­¬¿y
 = 
¬¿y
(1=>'æ–‡æ¡£ç›¸å…³',2=>'ç³»ç»Ÿè®¾ç½®',3=>'å¿…é¡»è¾…åŠ©åŠŸèƒ½',4=>'ç½‘ç«™æ›´æ–°æ“ä½œ',5=>'ä¼šå‘˜ç›¸å…³',6=>'åŸºæœ¬æ¨¡å—æ’ä»¶');

12 
	g$add£t
 = '';

15 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

17 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

18 
	g$dsql
->
S‘Qu”y
(" SELECT channeltype FROM `#@__arctype` WHERE id IN({$admin_catalog}) GROUP BY channeltype ");

22 
	g$dsql
->
S‘Qu”y
(" SELECT channeltype FROM `#@__arctype` GROUP BY channeltype ");

24 
	g$dsql
->
Execu‹
();

25 
	g$ÿndoChªÃl
 = '';

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

29 
	}
}

30 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

31 
	g$dsql
->
S‘Qu”y
("SELECT id,typename,addcon,mancon FROM `#@__channeltype` WHERE id IN({$candoChannel}) AND id<>-1 AND isshow=1 ORDER BY id ASC");

32 
	g$dsql
->
Execu‹
();

33 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

35 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

36 
	}
}

38 
	g$m’usMaš
 = "

41 <
m
:
tİ
 
m­™em
='1' 
™em
='1_' 
Çme
='å¸¸ç”¨æ“ä½œ' 
di¥Ïy
='block'>

42 <
m
:
™em
 
Çme
='ç½‘ç«™æ ç›®ç®¡ç†' 
lšk
='ÿlog_maš.php' 
ischªÃl
='1' 
add®t
='åˆ›å»ºæ ç›®' 
lškadd
='ÿlog_add.php?li¡ty³÷Î' 
¿nk
='t_Li¡,t_AccLi¡' 
rg‘
='main' />

43 <
m
:
™em
 
Çme
='æ‰€æœ‰æ¡£æ¡ˆåˆ—è¡¨' 
lšk
='cÚ‹Á_li¡.php' 
¿nk
='a_Li¡,a_AccLi¡' 
rg‘
='main' />

44 <
m
:
™em
 
Çme
='ç­‰å®¡æ ¸çš„æ¡£æ¡ˆ' 
lšk
='cÚ‹Á_li¡.php?¬üªk=-1' 
¿nk
='a_Check,a_AccCheck' 
rg‘
='main' />

45 <
m
:
™em
 
Çme
='æˆ‘å‘å¸ƒçš„æ–‡æ¡£' 
lšk
='cÚ‹Á_li¡.php?mid=".$cu£rLogš->g‘U£rID()."' 
¿nk
='a_Li¡,a_AccLi¡,a_MyLi¡' 
rg‘
='main' />

46 <
m
:
™em
 
Çme
='è¯„è®ºç®¡ç†' 
lšk
='ãedback_maš.php' 
¿nk
='sys_F“dback' 
rg‘
='main' />

47 <
m
:
™em
 
Çme
='å†…å®¹å›æ”¶ç«™' 
lšk
='»cyşšg.php' 
ischªÃl
='1' 
add®t
='æ¸…ç©ºå›æ”¶ç«™' 
addico
='img/gtk-d–.²g' 
lškadd
='¬chives_do.php?dİo¡=ş—r&aidòo' 
¿nk
='a_Li¡' 
rg‘
='main' />

48 </
m
:
tİ
>

50 <
m
:
tİ
 
m­™em
='1' 
™em
='1_' 
Çme
='å†…å®¹ç®¡ç†' 
di¥Ïy
='block'>

51 
$add£t


52 <
m
:
™em
 
Çme
='ä¸“é¢˜ç®¡ç†' 
ischªÃl
='1' 
lšk
='cÚ‹Á_s_li¡.php' 
lškadd
='¥ec_add.php' 
chªÃlid
='-1' 
¿nk
='¥ec_New' 
rg‘
='main' />

53 </
m
:
tİ
>

55 <
m
:
tİ
 
m­™em
='1' 
™em
='1_' 
Çme
='é¢‘é“æ¨¡å‹' 
di¥Ïy
='block' 
¿nk
='t_List,t_AccList,c_List,temp_One'>

56 <
m
:
™em
 
Çme
='å†…å®¹æ¨¡å‹ç®¡ç†' 
lšk
='mychªÃl_maš.php' 
¿nk
='c_Li¡' 
rg‘
='main' />

57 <
m
:
™em
 
Çme
='å•é¡µæ–‡æ¡£ç®¡ç†' 
lšk
='‹m¶‘s_Úe.php' 
¿nk
='‹mp_OÃ' 
rg‘
='main'/>

58 <
m
:
™em
 
Çme
='è”åŠ¨ç±»åˆ«ç®¡ç†' 
lšk
='¡•£Ëù_maš.php' 
¿nk
='c_S‹p£şeù' 
rg‘
='main' />

59 <
m
:
™em
 
Çme
='è‡ªç”±åˆ—è¡¨ç®¡ç†' 
lšk
='ä“li¡_maš.php' 
¿nk
='c_Li¡' 
rg‘
='main' />

60 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰è¡¨å•' 
lšk
='diy_maš.php' 
¿nk
='c_Li¡' 
rg‘
='main' />

61 </
m
:
tİ
>

63 <
m
:
tİ
 
m­™em
='3' 
™em
='3_' 
Çme
='é‡‡é›†ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='co_NewRule,co_ListNote,co_ViewNote,co_Switch,co_GetOut'>

64 <
m
:
™em
 
Çme
='é‡‡é›†èŠ‚ç‚¹ç®¡ç†' 
lšk
='co_maš.php' 
¿nk
='co_Li¡NÙe' 
rg‘
='main' />

65 <
m
:
™em
 
Çme
='ä¸´æ—¶å†…å®¹ç®¡ç†' 
lšk
='co_u¾.php' 
¿nk
='co_V›wNÙe' 
rg‘
='main' />

66 <
m
:
™em
 
Çme
='å¯¼å…¥é‡‡é›†è§„åˆ™' 
lšk
='co_g‘_cÜuË.php' 
¿nk
='co_G‘Out' 
rg‘
='main'/>

67 <
m
:
™em
 
Çme
='ç›‘æ§é‡‡é›†æ¨¡å¼' 
lšk
='co_g©h”_¡¬t.php' 
¿nk
='co_G‘Out' 
rg‘
='main'/>

68 <
m
:
™em
 
Çme
='é‡‡é›†æœªä¸‹è½½å†…å®¹' 
lšk
='co_do.php?dİo¡=cßÎ' 
¿nk
='co_G‘Out' 
rg‘
='main'/>

69 </
m
:
tİ
>

71 <
m
:
tİ
 
m­™em
='3' 
™em
='1_3_3' 
Çme
='æ‰¹é‡ç»´æŠ¤' 
di¥Ïy
='block'>

72 <
m
:
™em
 
Çme
='æ›´æ–°ç³»ç»Ÿç¼“å­˜' 
lšk
='sys_ÿche_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

73 <
m
:
™em
 
Çme
='æ–‡æ¡£æ‰¹é‡ç»´æŠ¤' 
lšk
='cÚ‹Á_b©ch_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

74 <
m
:
™em
 
Çme
='æœç´¢å…³é”®è¯ç»´æŠ¤' 
lšk
='£¬ch_keywÜds_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

75 <
m
:
™em
 
Çme
='æ–‡æ¡£å…³é”®è¯ç»´æŠ¤' 
lšk
='¬tişe_keywÜds_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

76 <
m
:
™em
 
Çme
='è‡ªåŠ¨æ‘˜è¦|åˆ†é¡µ' 
lšk
='¬tişe_desütiÚ_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

77 <
m
:
™em
 
Çme
='TAGæ ‡ç­¾ç®¡ç†' 
lšk
='gs_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='main' />

78 <
m
:
™em
 
Çme
='æ•°æ®åº“å†…å®¹æ›¿æ¢' 
lšk
='sys_d©a_»¶aû.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

79 </
m
:
tİ
>

81 <
m
:
tİ
 
m­™em
='4' 
™em
='5_' 
Çme
='è‡ªåŠ¨ä»»åŠ¡' 
nÙshow®l
='1' 
di¥Ïy
='block' 
¿nk
='sys_MakeHtml'>

82 <
m
:
™em
 
Çme
='ä¸€é”®æ›´æ–°ç½‘ç«™' 
lšk
='makehtml_®l.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

83 <
m
:
™em
 
Çme
='æ›´æ–°ç³»ç»Ÿç¼“å­˜' 
lšk
='sys_ÿche_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='main' />

84 </
m
:
tİ
>

86 <
m
:
tİ
 
m­™em
='4' 
™em
='5_' 
Çme
='HTMLæ›´æ–°' 
nÙshow®l
='1' 
di¥Ïy
='nÚe' 
¿nk
='sys_MakeHtml'>

87 <
m
:
™em
 
Çme
='æ›´æ–°ä¸»é¡µHTML' 
lšk
='makehtml_hom•age.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

88 <
m
:
™em
 
Çme
='æ›´æ–°æ ç›®HTML' 
lšk
='makehtml_li¡.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

89 <
m
:
™em
 
Çme
='æ›´æ–°æ–‡æ¡£HTML' 
lšk
='makehtml_¬chives.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

90 <
m
:
™em
 
Çme
='æ›´æ–°ç½‘ç«™åœ°å›¾' 
lšk
='makehtml_m­_guide.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

91 <
m
:
™em
 
Çme
='æ›´æ–°RSSæ–‡ä»¶' 
lšk
='makehtml_rss.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

92 <
m
:
™em
 
Çme
='è·å–JSæ–‡ä»¶' 
lšk
='makehtml_js.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

93 <
m
:
™em
 
Çme
='æ›´æ–°ä¸“é¢˜HTML' 
lšk
='makehtml_¥ec.php' 
¿nk
='sys_MakeHtml' 
rg‘
='main' />

94 </
m
:
tİ
>

96 <
m
:
tİ
 
m­™em
='3' 
™em
='1_6_' 
Çme
='é™„ä»¶ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='sys_Upload,sys_MyUpload,plus_æ–‡ä»¶ç®¡ç†å™¨'>

97 <
m
:
™em
 
Çme
='ä¸Šä¼ æ–°æ–‡ä»¶' 
lšk
='medŸ_add.php' 
¿nk
='' 
rg‘
='main' />

98 <
m
:
™em
 
Çme
='é™„ä»¶æ•°æ®ç®¡ç†' 
lšk
='medŸ_maš.php' 
¿nk
='sys_U¶ßd,sys_MyU¶ßd' 
rg‘
='main' />

99 <
m
:
™em
 
Çme
='æ–‡ä»¶å¼ç®¡ç†å™¨' 
lšk
='medŸ_maš.php?dİo¡=femªag”' 
¿nk
='¶us_æ–‡ä»¶ç®¡ç†å™¨' 
rg‘
='main' />

100 </
m
:
tİ
>

102 <
m
:
tİ
 
m­™em
='5' 
™em
='6_' 
Çme
='ä¼šå‘˜ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='member_List,member_Type'>

103 <
m
:
™em
 
Çme
='æ³¨å†Œä¼šå‘˜åˆ—è¡¨' 
lšk
='memb”_maš.php' 
¿nk
='memb”_Li¡' 
rg‘
='main' />

104 <
m
:
™em
 
Çme
='ä¼šå‘˜çº§åˆ«è®¾ç½®' 
lšk
='memb”_¿nk.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

105 <
m
:
™em
 
Çme
='ç§¯åˆ†å¤´è¡”è®¾ç½®' 
lšk
='memb”_scÜes.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

106 <
m
:
™em
 
Çme
='ä¼šå‘˜æ¨¡å‹ç®¡ç†' 
lšk
='memb”_mod–_maš.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

107 <
m
:
™em
 
Çme
='ä¼šå‘˜çŸ­ä¿¡ç®¡ç†' 
lšk
='memb”_pm.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

108 <
m
:
™em
 
Çme
='ä¼šå‘˜ç•™è¨€ç®¡ç†' 
lšk
='memb”_gue¡book.php' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

109 <
m
:
™em
 
Çme
='ä¼šå‘˜åŠ¨æ€ç®¡ç†' 
lšk
='memb”_šfo_maš.php?ty³=ãed' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

110 <
m
:
™em
 
Çme
='ä¼šå‘˜å¿ƒæƒ…ç®¡ç†' 
lšk
='memb”_šfo_maš.php?ty³=mood' 
¿nk
='memb”_Ty³' 
rg‘
='main' />

111 </
m
:
tİ
>

113 <
m
:
tİ
 
m­™em
='2' 
™em
='10_' 
Çme
='ç³»ç»Ÿè®¾ç½®' 
di¥Ïy
='nÚe' 
¿nk
='sys_User,sys_Group,sys_Edit,sys_Log,sys_Data'>

114 <
m
:
™em
 
Çme
='ç³»ç»ŸåŸºæœ¬å‚æ•°' 
lšk
='sys_šfo.php' 
¿nk
='sys_Ed™' 
rg‘
='main' />

115 <
m
:
™em
 
Çme
='ç³»ç»Ÿç”¨æˆ·ç®¡ç†' 
lšk
='sys_admš_u£r.php' 
¿nk
='sys_U£r' 
rg‘
='main' />

116 <
m
:
™em
 
Çme
='ç”¨æˆ·ç»„è®¾å®š' 
lšk
='sys_group.php' 
¿nk
='sys_Group' 
rg‘
='main' />

117 <
m
:
™em
 
Çme
='æœåŠ¡å™¨åˆ†å¸ƒ/è¿œç¨‹' 
lšk
='sys_muÉi£rv.php' 
¿nk
='sys_Group' 
rg‘
='main' />

118 <
m
:
™em
 
Çme
='ç³»ç»Ÿæ—¥å¿—ç®¡ç†' 
lšk
='log_li¡.php' 
¿nk
='sys_Log' 
rg‘
='main' />

119 <
m
:
™em
 
Çme
='éªŒè¯å®‰å…¨è®¾ç½®' 
lšk
='sys_§ã.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

120 <
m
:
™em
 
Çme
='å›¾ç‰‡æ°´å°è®¾ç½®' 
lšk
='sys_šfo_m¬k.php' 
¿nk
='sys_Ed™' 
rg‘
='main' />

121 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰æ–‡æ¡£å±æ€§' 
lšk
='cÚ‹Á_©t.php' 
¿nk
='sys_A‰' 
rg‘
='main' />

122 <
m
:
™em
 
Çme
='è½¯ä»¶é¢‘é“è®¾ç½®' 
lšk
='soá_cÚfig.php' 
¿nk
='sys_SoáCÚfig' 
rg‘
='main' />

123 <
m
:
™em
 
Çme
='é˜²é‡‡é›†ä¸²æ··æ·†' 
lšk
='¬tişe_¡ršg_mix.php' 
¿nk
='sys_SŒšgMix' 
rg‘
='main' />

124 <
m
:
™em
 
Çme
='éšæœºæ¨¡æ¿è®¾ç½®' 
lšk
='¬tişe_‹m¶©e_¿nd.php' 
¿nk
='sys_SŒšgMix' 
rg‘
='main' />

125 <
m
:
™em
 
Çme
='è®¡åˆ’ä»»åŠ¡ç®¡ç†' 
lšk
='sys_sk.php' 
¿nk
='sys_Task' 
rg‘
='main' />

126 <
m
:
™em
 
Çme
='æ•°æ®åº“å¤‡ä»½/è¿˜åŸ' 
lšk
='sys_d©a.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

127 <
m
:
™em
 
Çme
='SQLå‘½ä»¤è¡Œå·¥å…·' 
lšk
='sys_sql_qu”y.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

128 <
m
:
™em
 
Çme
='æ–‡ä»¶æ ¡éªŒ[S]' 
lšk
='sys_v”if›s.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

129 <
m
:
™em
 
Çme
='ç—…æ¯’æ‰«æ[S]' 
lšk
='sys_§ã‹¡.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

130 <
m
:
™em
 
Çme
='ç³»ç»Ÿé”™è¯¯ä¿®å¤[S]' 
lšk
='sys_»·œ.php' 
¿nk
='sys_v”ify' 
rg‘
='main' />

131 </
m
:
tİ
>

133 <
m
:
tİ
 
m­™em
='5' 
™em
='10_6_' 
Çme
='æ”¯ä»˜å·¥å…·' 
di¥Ïy
='nÚe' 
¿nk
='sys_Data'>

134 <
m
:
™em
 
Çme
='ç‚¹å¡äº§å“åˆ†ç±»' 
lšk
='ÿrds_ty³.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

135 <
m
:
™em
 
Çme
='ç‚¹å¡äº§å“ç®¡ç†' 
lšk
='ÿrds_mªage.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

136 <
m
:
™em
 
Çme
='ä¼šå‘˜äº§å“åˆ†ç±»' 
lšk
='memb”_ty³.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

137 <
m
:
™em
 
Çme
='ä¼šå‘˜æ¶ˆè´¹è®°å½•' 
lšk
='memb”_İ”©iÚs.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

138 <
m
:
™em
 
Çme
='å•†åº—è®¢å•è®°å½•' 
lšk
='shİs_İ”©iÚs.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

139 <
m
:
™em
 
Çme
='æ”¯ä»˜æ¥å£è®¾ç½®' 
lšk
='sys_·ym’t.php' .
php
'„ªk='
sys_D©a
'¬g‘='
maš
' />

140 <
m
:
™em
 
Çme
='é…è´§æ–¹å¼è®¾ç½®' 
lšk
='shİs_d–iv”y.php' 
¿nk
='sys_D©a' 
rg‘
='main' />

141 </
m
:
tİ
>

143 <
m
:
tİ
 
m­™em
='2' 
™em
='10_7_' 
Çme
='æ¨¡æ¿ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='temp_One,temp_Other,temp_MyTag,temp_test,temp_All'>

144 <
m
:
™em
 
Çme
='é»˜è®¤æ¨¡æ¿ç®¡ç†' 
lšk
='‹m¶‘s_maš.php' 
¿nk
='‹mp_AÎ' 
rg‘
='main'/>

145 <
m
:
™em
 
Çme
='æ ‡ç­¾æºç ç®¡ç†' 
lšk
='‹m¶‘s_gsourû.php' 
¿nk
='‹mp_AÎ' 
rg‘
='main'/>

146 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰å®æ ‡è®°' 
lšk
='myg_maš.php' 
¿nk
='‹mp_MyTag' 
rg‘
='main'/>

147 <
m
:
™em
 
Çme
='æ™ºèƒ½æ ‡è®°å‘å¯¼' 
lšk
='myg_g_guide.php' 
¿nk
='‹mp_Oth”' 
rg‘
='main'/>

148 <
m
:
™em
 
Çme
='å…¨å±€æ ‡è®°æµ‹è¯•' 
lšk
='g_‹¡.php' 
¿nk
='‹mp_Te¡' 
rg‘
='main'/>

149 </
m
:
tİ
>

154 
$¶us£t
 = '';

155 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__plus` WHERE isshow=1 ORDER BY‡id ASC");

156 
	g$dsql
->
Execu‹
();

157 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

159 
$¶us£t
 .ğ
$row
->
m’u¡ršg
."\r\n";

160 
	}
}

162 
	g$m’usMaš
 .= "

163 <
m
:
tİ
 
m­™em
='6' 
Çme
='æ¨¡å—ç®¡ç†' 
c
='6,' 
di¥Ïy
='block'>

164 <
m
:
™em
 
Çme
='æ¨¡å—ç®¡ç†' 
lšk
='moduË_maš.php' 
¿nk
='sys_moduË' 
rg‘
='main' />

165 <
m
:
™em
 
Çme
='ä¸Šä¼ æ–°æ¨¡å—' 
lšk
='moduË_u¶ßd.php' 
¿nk
='sys_moduË' 
rg‘
='main' />

166 <
m
:
™em
 
Çme
='æ¨¡å—ç”Ÿæˆå‘å¯¼' 
lšk
='moduË_make.php' 
¿nk
='sys_moduË' 
rg‘
='main' />

167 </
m
:
tİ
>

169 <
m
:
tİ
 
m­™em
='6' 
™em
='7' 
Çme
='è¾…åŠ©æ’ä»¶' 
di¥Ïy
='block'>

170 <
m
:
™em
 
Çme
='æ’ä»¶ç®¡ç†å™¨' 
lšk
='¶us_maš.php' 
¿nk
='10' 
rg‘
='main' />

171 
$¶us£t


172 </
m
:
tİ
>

175 
$m­¡ršg
 = '';

176 
	g$d
 = 
Ãw
 
XakTag·r£
();

177 
	g$d
->
S‘NameS·û
('m','<','>');

178 
	g$d
->
LßdSŒšg
(
$m’usMaš
);

180 
fÜ—ch
(
$m­¬¿y
 
as
 
$k
=>
$bigÇme
)

182 
$m­¡ršg
 .= "<dl class='maptop'>\r\n";

183 
	g$m­¡ršg
 .= "<dt class='bigitem'>$bigname</dt>\r\n";

184 
	g$m­¡ršg
 .= "<dd>\r\n";

185 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

187 if(
	g$ùag
->
G‘A‰
('m­™em'è=ğ
$k
)

189 
$m­¡ršg
 .= "<dl class='mapitem'>\r\n";

190 
	g$m­¡ršg
 .ğ"<dt>".
$ùag
->
G‘A‰
('name')."</dt>\r\n";

191 
	g$m­¡ršg
 .= "<dd>\r\n<ul class='item'>\r\n";

192 
	g$d2
 = 
Ãw
 
XakTagP¬£
();

193 
	g$d2
->
S‘NameS·û
('m', '<', '>');

194 
	g$d2
->
LßdSourû
(
$ùag
->
IÂ”Text
);

195 
fÜ—ch
(
$d2
->
CTags
 
as
 
$j
=>
$ùag2
)

197 
$m­¡ršg
 .ğ"<li><¨h»f='".
$ùag2
->
G‘A‰
('link')."'arget='".$ctag2->GetAtt('target')."'>".$ctag2->GetAtt('name')."</a></li>\r\n";

199 
	g$m­¡ršg
 .= "</ul>\r\n</dd>\r\n</dl>\r\n";

202 
	g$m­¡ršg
 .= "</dd>\r\n</dl>\r\n";

	@E:\web\weixun\xakadmin\inc\inc_menu_module.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

20 
	g$moduË£t
 = '';

21 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__sys_module` ORDER BY id DESC");

22 
	g$dsql
->
Execu‹
();

23 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

25 
$moduË£t
 .ğ
$row
->
m’u¡ršg
."\r\n";

26 
	}
}

29 
	g$¶us£t
 = '';

30 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__plus` WHERE isshow=1 ORDER BY‡id ASC");

31 
	g$dsql
->
Execu‹
();

32 
	g$row
 = 
$dsql
->
	$G‘Objeù
()) {

33 
$row
->
m’u¡ršg
 = 
	`¡r_»¶aû
('plus_å‹æƒ…é“¾æ¥', 'plus_å‹æƒ…é“¾æ¥æ¨¡å—', $row->menustring);

34 
$¶us£t
 .ğ
$row
->
m’u¡ršg
."\r\n";

35 
	}
}

37 
	g$admšM’u
 = '';

38 if(
	g$cu£rLogš
->
g‘U£rTy³
() >= 10)

40 
$admšM’u
 = "<m:top‚ame='æ¨¡å—ç®¡ç†' c='6,' display='block'>

41 <
m
:
™em
 
Çme
='æ¨¡å—ç®¡ç†' 
lšk
='moduË_maš.php' 
¿nk
='sys_moduË' 
rg‘
='main' />

42 <
m
:
™em
 
Çme
='ä¸Šä¼ æ–°æ¨¡å—' 
lšk
='moduË_u¶ßd.php' 
¿nk
='sys_moduË' 
rg‘
='main' />

43 <
m
:
™em
 
Çme
='æ¨¡å—ç”Ÿæˆå‘å¯¼' 
lšk
='moduË_make.php' 
¿nk
='sys_moduË' 
rg‘
='main' />

44 </
m
:
tİ
>";

47 
$m’usMoudË
 = "

49 
$admšM’u


50 <
m
:
tİ
 
™em
='7' 
Çme
='è¾…åŠ©æ’ä»¶' 
di¥Ïy
='block'>

51 <
m
:
™em
 
Çme
='æ’ä»¶ç®¡ç†å™¨' 
lšk
='¶us_maš.php' 
¿nk
='10' 
rg‘
='main' />

52 
$¶us£t


53 </
m
:
tİ
>

55 
$moduË£t


	@E:\web\weixun\xakadmin\inc\xmenu2.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='å¸¸ç”¨æ“ä½œ' 
di¥Ïy
='block' 
şass
='cycc'>

34 <
m
:
™em
 
Çme
='æ‰€æœ‰æ¡£æ¡ˆåˆ—è¡¨' 
lšk
='cÚ‹Á_li¡.php' 
¿nk
='a_Li¡,a_AccLi¡' 
rg‘
='maš' 
şass
='sydalb' />

35 <
m
:
™em
 
Çme
='å†…å®¹å›æ”¶ç«™' 
lšk
='»cyşšg.php' 
ischªÃl
='1' 
add®t
='æ¸…ç©ºå›æ”¶ç«™' 
addico
='images/gtk-d–.²g' 
lškadd
='¬chives_do.php?dİo¡=ş—r&aidòo' 
¿nk
='a_Li¡,a_AccLi¡,a_MyLi¡' 
rg‘
='maš' 
şass
='nrhsz' />

36 <
m
:
™em
 
Çme
='å‹æƒ…é“¾æ¥' 
lšk
='ä›ndlšk_maš.php' 
rg‘
='maš' 
şass
='yqlj' />

37 <
m
:
™em
 
Çme
='å¹¿å‘Šç®¡ç†' 
lšk
='½ad_maš.php' 
rg‘
='maš' 
şass
='gggl' />

39 </
m
:
tİ
>

40 <
m
:
tİ
 
™em
='1_' 
Çme
='å†…å®¹ç®¡ç†' 
di¥Ïy
='block' 
şass
='cycc'>

41 
$add£t


42 </
m
:
tİ
>

43 <
m
:
tİ
 
™em
='1_' 
Çme
='é™„ä»¶ç®¡ç†' 
di¥Ïy
='block' 
¿nk
='sys_U¶ßd,sys_MyU¶ßd,¶us_æ–‡ä»¶ç®¡ç†å™¨' 
şass
='fjgl'>

44 <
m
:
™em
 
Çme
='ä¸Šä¼ æ–°æ–‡ä»¶' 
lšk
='medŸ_add.php' 
¿nk
='' 
rg‘
='maš' 
şass
='scxwj' />

45 <
m
:
™em
 
Çme
='é™„ä»¶æ•°æ®ç®¡ç†' 
lšk
='medŸ_maš.php' 
¿nk
='sys_U¶ßd,sys_MyU¶ßd' 
rg‘
='maš' 
şass
='fjsjgl' />

46 <
m
:
™em
 
Çme
='æ–‡ä»¶å¼ç®¡ç†å™¨' 
lšk
='medŸ_maš.php?dİo¡=femªag”' 
¿nk
='¶us_æ–‡ä»¶ç®¡ç†å™¨' 
rg‘
='maš' 
şass
='wjsglq' />

47 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\inc\xmenu3.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='æ ç›®ç®¡ç†' 
di¥Ïy
='block' 
şass
='lmgl'>

34 <
m
:
™em
 
Çme
='ç½‘ç«™æ ç›®ç®¡ç†' 
lšk
='ÿlog_maš.php' 
rg‘
='maš' 
şass
='wzlmgl' />

35 <
m
:
™em
 
Çme
='æ·»åŠ æ ç›®' 
lšk
='ÿlog_add.php?li¡ty³÷Î' 
rg‘
='maš' 
şass
='tjlm' />

36 </
m
:
tİ
>

37 <
m
:
tİ
 
™em
='1_' 
Çme
='æ‰¹é‡ç»´æŠ¤' 
di¥Ïy
='block' 
şass
='plwh'>

38 <
m
:
™em
 
Çme
='æ›´æ–°ç³»ç»Ÿç¼“å­˜' 
lšk
='sys_ÿche_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='maš' 
şass
='gxxthc' />

39 <
m
:
™em
 
Çme
='æ–‡æ¡£æ‰¹é‡ç»´æŠ¤' 
lšk
='cÚ‹Á_b©ch_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='maš' 
şass
='wdplwh' />

40 <
m
:
™em
 
Çme
='æœç´¢å…³é”®è¯ç»´æŠ¤' 
lšk
='£¬ch_keywÜds_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='maš' 
şass
='ssgjcwh' />

41 <
m
:
™em
 
Çme
='æ–‡æ¡£å…³é”®è¯ç»´æŠ¤' 
lšk
='¬tişe_keywÜds_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='maš' 
şass
='wdgjcwh' />

42 <
m
:
™em
 
Çme
='é‡å¤æ–‡æ¡£æ£€æµ‹' 
lšk
='¬tişe_‹¡_§me.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='maš' 
şass
='cfwdjc' />

43 <
m
:
™em
 
Çme
='è‡ªåŠ¨æ‘˜è¦|åˆ†é¡µ' 
lšk
='¬tişe_desütiÚ_maš.php' 
¿nk
='sys_KeywÜd' 
rg‘
='maš' 
şass
='zdzy' />

44 <
m
:
™em
 
Çme
='æ•°æ®åº“å†…å®¹æ›¿æ¢' 
lšk
='sys_d©a_»¶aû.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='maš' 
şass
='sjknrth' />

45 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\inc\xmenu4.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='è‡ªåŠ¨ä»»åŠ¡' 
nÙshow®l
='1' 
di¥Ïy
='block' 
¿nk
='sys_MakeHtml' 
şass
='zdrw'>

34 <
m
:
™em
 
Çme
='ä¸€é”®æ›´æ–°ç½‘ç«™' 
lšk
='makehtml_®l.php' 
¿nk
='sys_MakeHtml' 
rg‘
='maš' 
şass
='yjgxwz' />

35 <
m
:
™em
 
Çme
='æ›´æ–°ç³»ç»Ÿç¼“å­˜' 
lšk
='sys_ÿche_up.php' 
¿nk
='sys_ArcB©ch' 
rg‘
='maš' 
şass
='gxxthc' />

36 </
m
:
tİ
>

37 <
m
:
tİ
 
™em
='1_' 
Çme
='HTMLæ›´æ–°' 
nÙshow®l
='1' 
di¥Ïy
='nÚe' 
¿nk
='sys_MakeHtml' 
şass
='htmlgx'>

38 <
m
:
™em
 
Çme
='æ›´æ–°ä¸»é¡µHTML' 
lšk
='makehtml_hom•age.php' 
¿nk
='sys_MakeHtml' 
rg‘
='maš' 
şass
='gxzyhtml' />

39 <
m
:
™em
 
Çme
='æ›´æ–°æ ç›®HTML' 
lšk
='makehtml_li¡.php' 
¿nk
='sys_MakeHtml' 
rg‘
='maš' 
şass
='gxlmhtml' />

40 <
m
:
™em
 
Çme
='æ›´æ–°æ–‡æ¡£HTML' 
lšk
='makehtml_¬chives.php' 
¿nk
='sys_MakeHtml' 
rg‘
='maš' 
şass
='gxwdhtml' />

41 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\inc\xmenu5.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='æ¨¡æ¿ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='‹mp_OÃ,‹mp_Oth”,‹mp_MyTag,‹mp_‹¡,‹mp_AÎ' 
şass
='mbgl'>

34 <
m
:
™em
 
Çme
='é»˜è®¤æ¨¡æ¿ç®¡ç†' 
lšk
='‹m¶‘s_maš.php' 
¿nk
='‹mp_AÎ' 
rg‘
='maš' 
şass
='mrmbgl'/>

35 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰å®æ ‡è®°' 
lšk
='myg_maš.php' 
¿nk
='‹mp_MyTag' 
rg‘
='maš' 
şass
='zdyhbj'/>

36 <
m
:
™em
 
Çme
='å…¨å±€æ ‡è®°æµ‹è¯•' 
lšk
='g_‹¡.php' 
¿nk
='‹mp_Te¡' 
rg‘
='maš' 
şass
='qjbjcs'/>

37 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\inc\xmenu6.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='é‡‡é›†ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='co_NewRuË,co_Li¡NÙe,co_V›wNÙe,co_Sw™ch,co_G‘Out' 
şass
='cjgl'>

34 <
m
:
™em
 
Çme
='é‡‡é›†èŠ‚ç‚¹ç®¡ç†' 
lšk
='co_maš.php' 
¿nk
='co_Li¡NÙe' 
rg‘
='maš' 
şass
='cjjdgl' />

35 <
m
:
™em
 
Çme
='ä¸´æ—¶å†…å®¹ç®¡ç†' 
lšk
='co_u¾.php' 
¿nk
='co_V›wNÙe' 
rg‘
='maš' 
şass
='lsnrgl' />

36 <
m
:
™em
 
Çme
='å¯¼å…¥é‡‡é›†è§„åˆ™' 
lšk
='co_g‘_cÜuË.php' 
¿nk
='co_G‘Out' 
rg‘
='maš' 
şass
='drcjgz'/>

37 <
m
:
™em
 
Çme
='ç›‘æ§é‡‡é›†æ¨¡å¼' 
lšk
='co_g©h”_¡¬t.php' 
¿nk
='co_G‘Out' 
rg‘
='maš' 
şass
='jkcjms'/>

38 <
m
:
™em
 
Çme
='é‡‡é›†æœªä¸‹è½½å†…å®¹' 
lšk
='co_do.php?dİo¡=cßÎ' 
¿nk
='co_G‘Out' 
rg‘
='maš' 
şass
='cjwxznr'/>

39 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\inc\xmenu7.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='ä¼šå‘˜ç®¡ç†' 
di¥Ïy
='nÚe' 
¿nk
='memb”_Li¡,memb”_Ty³' 
şass
='hygl'>

34 <
m
:
™em
 
Çme
='æ³¨å†Œä¼šå‘˜åˆ—è¡¨' 
lšk
='memb”_maš.php' 
¿nk
='memb”_Li¡' 
rg‘
='maš' 
şass
='zchylb' />

35 <
m
:
™em
 
Çme
='ä¼šå‘˜çº§åˆ«è®¾ç½®' 
lšk
='memb”_¿nk.php' 
¿nk
='memb”_Ty³' 
rg‘
='maš' 
şass
='hyjbsz' />

36 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\inc\xmenu8.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='ç³»ç»Ÿè®¾ç½®' 
di¥Ïy
='nÚe' 
¿nk
='sys_U£r,sys_Group,sys_Ed™,sys_Log,sys_D©a' 
şass
='xtsz'>

34 <
m
:
™em
 
Çme
='ç³»ç»ŸåŸºæœ¬å‚æ•°' 
lšk
='sys_šfo.php' 
¿nk
='sys_Ed™' 
rg‘
='maš' 
şass
='xtjbcs' />

35 <
m
:
™em
 
Çme
='ç³»ç»Ÿç”¨æˆ·ç®¡ç†' 
lšk
='sys_admš_u£r.php' 
¿nk
='sys_U£r' 
rg‘
='maš' 
şass
='xtyhgl' />

36 <
m
:
™em
 
Çme
='ç”¨æˆ·ç»„è®¾å®š' 
lšk
='sys_group.php' 
¿nk
='sys_Group' 
rg‘
='maš' 
şass
='yhzsd' />

37 <
m
:
™em
 
Çme
='ç³»ç»Ÿæ—¥å¿—ç®¡ç†' 
lšk
='log_li¡.php' 
¿nk
='sys_Log' 
rg‘
='maš' 
şass
='xtrzgl' />

38 <
m
:
™em
 
Çme
='éªŒè¯å®‰å…¨è®¾ç½®' 
lšk
='sys_§ã.php' 
¿nk
='sys_v”ify' 
rg‘
='maš' 
şass
='yzaqsz' />

39 <
m
:
™em
 
Çme
='å›¾ç‰‡æ°´å°è®¾ç½®' 
lšk
='sys_šfo_m¬k.php' 
¿nk
='sys_Ed™' 
rg‘
='maš' 
şass
='tpsysz' />

40 <
m
:
™em
 
Çme
='è‡ªå®šä¹‰æ–‡æ¡£å±æ€§' 
lšk
='cÚ‹Á_©t.php' 
¿nk
='sys_A‰' 
rg‘
='maš' 
şass
='zdywdsx' />

41 <
m
:
™em
 
Çme
='æ•°æ®åº“å¤‡ä»½/è¿˜åŸ' 
lšk
='sys_d©a.php' 
¿nk
='sys_D©a' 
rg‘
='maš' 
şass
='sjkbf' />

42 <
m
:
™em
 
Çme
='SQLå‘½ä»¤è¡Œå·¥å…·' 
lšk
='sys_sql_qu”y.php' 
¿nk
='sys_D©a' 
rg‘
='maš' 
şass
='sql' />

43 <
m
:
™em
 
Çme
='ç³»ç»Ÿé”™è¯¯ä¿®å¤[S]' 
lšk
='sys_»·œ.php' 
¿nk
='sys_v”ify' 
rg‘
='maš' 
şass
='xtcwxf' />

44 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\inc\xmenu9.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../config.php");

5 
	g$add£t
 = '';

8 if(
	g$cfg_admš_chªÃl
 = '¬¿y' && 
couÁ
(
$admš_ÿlogs
) > 0)

10 
$admš_ÿlog
 = 
još
(',', 
$admš_ÿlogs
);

11 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` where id in({$admin_catalog}) group by channeltype ");

15 
	g$dsql
->
S‘Qu”y
(" Select channeltype From `#@__arctype` group by channeltype ");

17 
	g$dsql
->
Execu‹
();

18 
	g$ÿndoChªÃl
 = '';

19 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

21 
$ÿndoChªÃl
 .ğ($ÿndoChªÃl=='' ? 
$row
->
chªÃÉy³
 : ','.$row->channeltype);

22 
	}
}

23 if(
em±y
(
$ÿndoChªÃl
)è
	g$ÿndoChªÃl
 = 1;

24 
	g$dsql
->
S‘Qu”y
("Select id,typename,addcon,mancon From `#@__channeltype` where id in({$candoChannel}) And id<>-1 And isshow=1 order by id‡sc");

25 
	g$dsql
->
Execu‹
();

26 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

28 
$add£t
 .= " <m:item‚ame='{$row->typename}' ischannel='1'†ink='{$row->mancon}?channelid={$row->id}'†inkadd='{$row->addcon}?channelid={$row->id}' channelid='{$row->id}'„ank=''arget='main' />\r\n";

29 
	}
}

31 
	g$m’usMaš
 = "

33 <
m
:
tİ
 
™em
='1_' 
Çme
='è®¢å•ç®¡ç†' 
di¥Ïy
='block' 
¿nk
='sys_D©a' 
şass
='pdmx'>

34 <
m
:
™em
 
Çme
='è®¢å•' 
lšk
='shİs_İ”©iÚs.php' 
¿nk
='sys_D©a' 
rg‘
='maš' 
şass
='nrmxgl' />

35 </
m
:
tİ
>

36 <
m
:
tİ
 
™em
='1_' 
Çme
='æ”¯ä»˜/é…é€' 
di¥Ïy
='block' 
¿nk
='sys_D©a' 
şass
='pdmx'>

37 <
m
:
™em
 
Çme
='æ”¯ä»˜æ¥å£è®¾ç½®' 
lšk
='sys_·ym’t.php' 
¿nk
='sys_D©a' 
rg‘
='maš' 
şass
='nrmxgl' />

38 <
m
:
™em
 
Çme
='é…é€æ–¹å¼è®¾ç½®' 
lšk
='shİs_d–iv”y.php' 
¿nk
='sys_D©a' 
rg‘
='maš' 
şass
='nrmxgl' />

39 </
m
:
tİ
>

40 <
m
:
tİ
 
™em
='1_' 
Çme
='é¢‘é“æ¨¡å‹' 
di¥Ïy
='block' 
¿nk
='t_Li¡,t_AccLi¡,c_Li¡,‹mp_OÃ' 
şass
='pdmx'>

41 <
m
:
™em
 
Çme
='å†…å®¹æ¨¡å‹ç®¡ç†' 
lšk
='mychªÃl_maš.php' 
¿nk
='c_Li¡' 
rg‘
='maš' 
şass
='nrmxgl' />

42 </
m
:
tİ
>

	@E:\web\weixun\xakadmin\index.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
.'/xaktag.class.php');

9 
	g$deçuÉIcoFe
 = 
XAKDATA
.'/admin/quickmenu.txt';

10 
	g$myIcoFe
 = 
XAKDATA
.'/admš/quickm’u-'.
$cu£rLogš
->
g‘U£rID
().'.txt';

12 if(
	$em±y
(
$doout
))

14 if(!
	`fe_exi¡s
(
$myIcoFe
)è$myIcoFğ
$deçuÉIcoFe
;

15 
	`šşude
(
XAKADMIN
.'/templets/index.htm');

16 
	`ex™
();

17 
	}
}

19 if(
	g$doout
 == 'header')

21 
šşude
(
XAKADMIN
.'/templets/header.htm');

22 
ex™
();

26 
šşude
(
XAKADMIN
.'/templets/frame.htm');

27 
ex™
();

	@E:\web\weixun\xakadmin\index_body.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe
(
XAKINC
.'/image.func.php');

9 
»quœe
(
XAKINC
.'/xaktag.class.php');

10 
	g$deçuÉIcoFe
 = 
XAKDATA
.'/admin/quickmenu.txt';

11 
	g$myIcoFe
 = 
XAKDATA
.'/admš/quickm’u-'.
$cu£rLogš
->
g‘U£rID
().'.txt';

12 if(!
fe_exi¡s
(
$myIcoFe
)è
	g$myIcoFe
 = 
$deçuÉIcoFe
;

15 if(
	$em±y
(
$dİo¡
))

17 
	`»quœe
(
XAKINC
.'/inc/inc_fun_funAdmin.php');

18 
$v”LockFe
 = 
XAKDATA
.'/admin/ver.txt';

19 
$å
 = 
	`fİ’
(
$v”LockFe
,'r');

20 
$upTime
 = 
	`Œim
(
	`ä—d
(
$å
,64));

21 
	`fşo£
(
$å
);

22 
$oktime
 = 
	`sub¡r
(
$upTime
,0,4).'-'.substr($upTime,4,2).'-'.substr($upTime,6,2);

23 
$offU¾
 = 
	`SpG‘NewInfo
();

25 
$myMoveFe
 = 
XAKDATA
.'/admš/move-'.
$cu£rLogš
->
	`g‘U£rID
().'.txt';

26 if(
	`fe_exi¡s
(
$myMoveFe
))

28 
$å
 = 
	`fİ’
(
$myMoveFe
,'r');

29 
$moved©a
ğ
	`ä—d
(
$å
,
	`fesize
(
$myMoveFe
));

30 
$moved©a
 = 
	`un£rŸlize
($movedata);

31 
$cŞumn1
 = 
	`¬¿y
();

32 
$cŞumn2
 = 
	`¬¿y
();

33 
	`fÜ—ch
 (
$moved©a
['™ems'] 
as
 
$key
 => 
$v®ue
) {

34 if(
$v®ue
['cŞumn'] =ğ'cŞumn1'è
$cŞumn1
 = $cŞumn1 + 
	`¬¿y
(
$key
 => $value['id']);

35 if(
$v®ue
['cŞumn'] =ğ'cŞumn2'è
$cŞumn2
 = $cŞumn2 + 
	`¬¿y
(
$key
 => $value['id']);

37 
šşude
 
	`XAKINClude
('templets/index_body_move.htm');

39 
šşude
 
	`XAKINClude
('templets/index_body.htm');

41 
	`ex™
();

42 
	}
}

47 if(
	g$dİo¡
=='addnew')

49 if(
em±y
(
$lšk
è||ƒm±y(
$t™Ë
))

51 
ShowMsg
("é“¾æ¥ç½‘å€æˆ–æ ‡é¢˜ä¸èƒ½ä¸ºç©ºï¼","-1");

52 
ex™
();

55 
	g$å
 = 
fİ’
(
$myIcoFe
,'r');

56 
	g$Şdù
 = 
Œim
(
ä—d
(
$å
, 
fesize
(
$myIcoFe
)));

57 
fşo£
(
$å
);

59 
	g$lšk
 = 
´eg_»¶aû
("#['\"]#", '`', 
$lšk
);

60 
	g$t™Ë
 = 
´eg_»¶aû
("#['\"]#", '`', 
$t™Ë
);

61 
	g$ico
 = 
´eg_»¶aû
("#['\"]#", '`', 
$ico
);

62 
	g$Şdù
 .= "\r\n<menu:item ico=\"{$ico}\"†ink=\"{$link}\"itle=\"{$title}\" />";

64 
	g$myIcoFeTrue
 = 
XAKDATA
.'/admš/quickm’u-'.
$cu£rLogš
->
g‘U£rID
().'.txt';

65 
	g$å
 = 
fİ’
(
$myIcoFeTrue
, 'w');

66 
fwr™e
(
$å
, 
$Şdù
);

67 
fşo£
(
$å
);

69 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªé¡¹ç›®ï¼","šdex_body.php?".
time
());

70 
ex™
();

76 if(
	g$dİo¡
=='editsave')

78 
$quickm’u
 = 
¡r¦ashes
($quickmenu);

80 
	g$myIcoFeTrue
 = 
XAKDATA
.'/admš/quickm’u-'.
$cu£rLogš
->
g‘U£rID
().'.txt';

81 
	g$å
 = 
fİ’
(
$myIcoFeTrue
,'w');

82 
fwr™e
(
$å
,
$quickm’u
);

83 
fşo£
(
$å
);

85 
ShowMsg
("æˆåŠŸä¿®æ”¹å¿«æ·æ“ä½œé¡¹ç›®ï¼","šdex_body.php?".
time
());

86 
ex™
();

92 if(
	g$dİo¡
=='movesave')

94 
$moved©a
 = 
¡r_»¶aû
('\\',"",
$sÜtÜd”
);

95 
	g$moved©a
 = 
jsÚ_decode
(
$moved©a
,
TRUE
);

96 
	g$moved©a
 = 
£rŸlize
(
$moved©a
);

97 
	g$myIcoFeTrue
 = 
XAKDATA
.'/admš/move-'.
$cu£rLogš
->
g‘U£rID
().'.txt';

98 
	g$å
 = 
fİ’
(
$myIcoFeTrue
,'w');

99 
fwr™e
(
$å
,
$moved©a
);

100 
fşo£
(
$å
);

106 if(
	g$dİo¡
=='editshow')

108 
$å
 = 
fİ’
(
$myIcoFe
,'r');

109 
	g$Şdù
 = 
Œim
(
ä—d
(
$å
,
fesize
(
$myIcoFe
)));

110 
fşo£
(
$å
);

112 <
fÜm
 
	gÇme
='ed™fÜm' 
aùiÚ
='šdex_body.php' 
m‘hod
='post'>

113 <
šput
 
ty³
='hidd’' 
Çme
='dİo¡' 
v®ue
='editsave' />

114 <
bË
 
width
="100%" 
bÜd”
="0" 
ûÎ¥acšg
="0" 
ûÎ·ddšg
="0">

115 <
Œ
>

116 <
td
 
height
='28' 
background
="images/tbg.gif">

117 <
div
 
¡yË
='æßt:Ëá'><
b
>ä¿®æ”¹å¿«æ·æ“ä½œé¡¹</b></div>

118 <
div
 
¡yË
='float:right;padding:3px 10px 0 0;'>

119 <
a
 
h»f
="javasüt:Clo£Tab('ed™Tab')"><
img
 
¤c
="images/şo£.gif" 
width
="12" 
height
="12" 
bÜd”
="0" /></a>

120 </
div
>

121 </
td
>

122 </
Œ
>

123 <
Œ
><
td
 
¡yË
="height:6px;fÚt-size:1px;bÜd”-tİ:1px sŞid #8DA659">&
nb¥
;</
	gtd
></
	gŒ
>

124 <
	gŒ
>

125 <
	gtd
>

126 æŒ‰åŸæ ¼å¼ä¿®æ”¹/å¢åŠ 
	gXML
é¡¹ã€‚

127 </
	gtd
>

128 </
	gŒ
>

129 <
	gŒ
>

130 <
td
 
	g®ign
='center'>

131 <
‹x»a
 
Çme
="quickm’u" 
rows
="10" 
cŞs
="50" 
¡yË
="width:94%;height:220px"><?
php
 
echo
 
$Şdù
; ?></
	g‹x»a
>

132 </
	gtd
>

133 </
	gŒ
>

134 <
	gŒ
>

135 <
td
 
	gheight
="45" 
®ign
="center">

136 <
šput
 
ty³
="subm™" 
Çme
="Subm™" 
v®ue
="ä¿å­˜é¡¹ç›®" 
şass
="Å coŞbg" 
¡yË
="width:80px;cursor:pointer" />

137 &
nb¥
;

138 <
šput
 
	gty³
="»£t" 
Çme
="»£t" 
v®ue
="é‡è®¾" 
şass
="Å coŞbg" 
¡yË
="width:50px;cursor:pointer" />

139 </
td
>

140 </
Œ
>

141 </
bË
>

142 </
fÜm
>

143 <?
php


144 
ex™
();

150 if(
	g$dİo¡
=='getRightSide')

152 
$qu”y
 = " SELECT COUNT(*) AS dd FROM `#@__member_list` ";

153 
	g$row1
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

154 
	g$qu”y
 = " SELECT COUNT(*) AS dd FROM `#@__feedback` ";

155 
	g$row2
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

157 
	g$chA¼Names
 = 
¬¿y
();

158 
	g$qu”y
 = "SELECT id,ypename FROM `#@__channeltype` ";

159 
	g$dsql
->
Execu‹
('c', 
$qu”y
);

160 
	g$row
 = 
$dsql
->
G‘A¼ay
('c'))

162 
$chA¼Names
[
$row
['id']] = $row['typename'];

165 
	g$qu”y
 = "SELECT COUNT(channel) AS dd, channel FROM `#@__arctiny` GROUP BY channel ";

166 
	g$®lArc
 = 0;

167 
	g$chA¼
 = 
¬¿y
();

168 
	g$dsql
->
Execu‹
('a', 
$qu”y
);

169 
	g$row
 = 
$dsql
->
G‘A¼ay
('a'))

171 
$®lArc
 +ğ
$row
['dd'];

172 
	g$row
['ty³Çme'] = 
$chA¼Names
[
$row
['channel']];

173 
	g$chA¼
[] = 
$row
;

176 <
bË
 
	gwidth
="100%" 
şass
="dboxtable">

177 <
Œ
>

178 <
td
 
width
='50%' 
şass
='Æše' 
¡yË
="text-align:left"> ä¼šå‘˜æ•°ï¼š </td>

179 <
td
 
şass
='Æše' 
¡yË
="‹xt-®ign:Ëá"> <?
php
 
echo
 
$row1
['dd']; ?> </
	gtd
>

180 </
	gŒ
>

181 <
	gŒ
>

182 <
td
 
	gşass
='Æše' 
¡yË
="text-align:left"> æ–‡æ¡£æ•°ï¼š </td>

183 <
td
 
şass
='Æše' 
¡yË
="‹xt-®ign:Ëá"> <?
php
 
echo
 
$®lArc
; ?> </
	gtd
>

184 </
	gŒ
>

185 <?
php


186 
fÜ—ch
(
$chA¼
 
as
 
$row
)

189 <
	gŒ
>

190 <
td
 
	gşass
='Æše' 
¡yË
="‹xt-®ign:Ëá"> <?
php
 
echo
 
$row
['ty³Çme']; ?>ï¼š </
	gtd
>

191 <
td
 
	gşass
='Æše' 
¡yË
="‹xt-®ign:Ëá"> <?
php
 
echo
 
$row
['dd']; ?>&
	gnb¥
; </
	gtd
>

192 </
	gŒ
>

193 <?
	gphp


196 <
	gŒ
>

197 <
td
 
	g¡yË
="text-align:left"> è¯„è®ºæ•°ï¼š </td>

198 <
td
 
¡yË
="‹xt-®ign:Ëá"> <?
php
 
echo
 
$row2
['dd']; ?> </
	gtd
>

199 </
	gŒ
>

200 </
	gbË
>

201 <?
php


202 
ex™
();

203 } ià(
	g$dİo¡
=='getRightSideNews')

205 
$qu”y
 = "SELECT‡rc.id,‡rc.arcrank,‡rc.title,‡rc.channel, ch.editcon FROM `#@__archives`‡rc

206 
LEFT
 
JOIN
 `#@
__chªÃÉy³
` 
ch
 
ON
 ch.
id
 = 
¬c
.
chªÃl


207 
WHERE
 
¬c
.
¬üªk
<>-2 
ORDER
 
BY
‡rc.
id
 
DESC
 
LIMIT
 0, 6 ";

208 
	g$¬cA¼
 = 
¬¿y
();

209 
	g$dsql
->
Execu‹
('m', 
$qu”y
);

210 
	g$row
 = 
$dsql
->
G‘A¼ay
('m'))

212 
$¬cA¼
[] = 
$row
;

214 
AjaxH—d
();

216 <
bË
 
	gwidth
="100%" 
şass
="dboxtable">

217 <?
php


218 
fÜ—ch
(
$¬cA¼
 
as
 
$row
)

220 if(
Œim
(
$row
['editcon'])=='') {

221 
$row
['editcon'] = 'archives_edit.php';

223 
	g$lšk¡r
 = "Â·<a href='{$row['editcon']}?aid={$row['id']}&channelid={$row['channel']}'>{$row['title']}</a>";

224 if(
	g$row
['¬üªk']==-1è
$lšk¡r
 .= "<font color='red'>(æœªå®¡æ ¸)</font>";

226 <
	gŒ
>

227 <
td
 
	gşass
='nline'>

228 <?
php
 
echo
 
$lšk¡r
; ?>

229 </
	gtd
>

230 </
	gŒ
>

231 <?
	gphp


234 </
	gbË
>

235 <?
php


236 
	gex™
;

237 } ià(
	g$dİo¡
=='showauth')

239 
šşude
('templets/index_body_showauth.htm');

240 
	gex™
;

241 } ià(
	g$dİo¡
=='showad')

243 
šşude
('templets/index_body_showad.htm');

244 
	gex™
;

245 } if(
	g$dİo¡
=='setskin')

247 
$cskš
 = 
em±y
($cskin)? 1 : $cskin;

248 
	g$skš
 = !
š_¬¿y
(
$cskš
, 
¬¿y
(1,2,3,4))? 1 : $cskin;

249 
	g$skšcÚfig
 = 
XAKDATA
.'/admin/skin.txt';

250 
PutFe
(
$skšcÚfig
, 
$skš
);

	@E:\web\weixun\xakadmin\index_menu.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe
(
XAKADMIN
.'/inc/inc_menu.php');

9 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

10 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

11 
šşude
 
XAKINClude
('templets/index_menu2.htm');

	@E:\web\weixun\xakadmin\index_menu_load.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
AjaxH—d
();

9 if(
	g$İ’™em
 != 100)

11 
»quœe
(
dœÇme
(
__FILE__
).'/inc/inc_menu.php');

12 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

13 
G‘M’us
(
$cu£rLogš
->
g‘U£rRªk
(),'main');

14 
ex™
();

18 
	g$İ’™em
 = 0;

19 
»quœe
(
dœÇme
(
__FILE__
).'/inc/inc_menu_module.php');

20 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

21 
G‘M’us
(
$cu£rLogš
->
g‘U£rRªk
(),'module');

22 
ex™
();

	@E:\web\weixun\xakadmin\index_menu_module.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 if(
	g$cu£rLogš
->
	gadmšStyË
!='xak.cn')

10 
h—d”
("location:index_menu.php?openitem=100");

11 
ex™
();

14 
»quœe
(
XAKADMIN
.'/inc/inc_menu_module.php');

15 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

17 <
	ghtml
>

18 <
	gh—d
>

19 <
	gt™Ë
>ç³»ç»Ÿèœå•</title>

20 <
lšk
 
	g»l
="¡yËsh“t" 
h»f
="images/ba£.css" 
ty³
="text/css" />

21 <
lšk
 
»l
="¡yËsh“t" 
h»f
="images/m’uŞd.css" 
ty³
="text/css" />

22 <
m‘a
 
h‰p
-
equiv
="CÚ‹Á-Ty³" 
cÚ‹Á
="text/html; charset=<?phpƒcho $cfg_soft_lang; ?>" />

23 <
ba£
 
rg‘
="main" />

24 </
h—d
>

25 <
süt
 
Ïnguage
="javascript">

26 
funùiÚ
 
	$showHide
(
objÇme
)

28 
v¬
 
obj
 = 
docum’t
.
	`g‘EËm’tById
(
objÇme
);

29 if(
obj
.
¡yË
.
di¥Ïy
 == 'block' || obj.style.display =='') obj.style.display = 'none';

30 
obj
.
¡yË
.
di¥Ïy
 = 'block';

31 
	}
}

32 </
	gsüt
>

33 <
ba£
 
	grg‘
="main">

34 <
body
 
Ëám¬gš
="0" 
tİm¬gš
="0" 
rg‘
="main">

35 <
bË
 
width
='100%' 
height
="100%" 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

36 <
Œ
>

37 <
td
 
¡yË
='·ddšg-Ëá:3px;·ddšg-tİ:8px' 
v®ign
="top">

38 <?
php


39 
G‘M’us
(
$cu£rLogš
->
g‘U£rRªk
(),'module');

41 </
	gtd
>

42 </
	gŒ
>

43 </
	gbË
>

44 <
bË
 
	gwidth
="120" 
bÜd”
="0" 
®ign
="ûÁ”" 
ûÎ·ddšg
="0" 
ûÎ¥acšg
="0">

45 <
Œ
><
td
 
height
="6"></td></tr>

46 </
bË
>

47 </
body
>

48 </
html
>

	@E:\web\weixun\xakadmin\index_testenv.php

1 <?
	gphp


2 @
£t_time_lim™
(0);

4 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

5 
AjaxH—d
();

6 if(!
funùiÚ_exi¡s
('TestWriteable'))

9 
funùiÚ
 
Te¡Wr™—bË
(
$d
, 
$c
=
çl£
)

11 
$tfe
 = '_write_able.txt';

12 
	g$d
 = 
´eg_»¶aû
("/\/$/", '', 
$d
);

13 
	g$å
 = @
fİ’
(
$d
.'/'.
$tfe
,'w');

14 if(!
	g$å
)

16 ifĞ
	g$c
==
çl£
 )

18 @
chmod
(
$d
, 0777);

19  
	gçl£
;

21  
Te¡Wr™—bË
(
$d
, 
Œue
);

25 
fşo£
(
$å
);

26  @
uÆšk
(
$d
.'/'.
$tfe
è? 
	gŒue
 : 
çl£
;

31 if(!
funùiÚ_exi¡s
('TestExecuteable'))

34 
funùiÚ
 
Te¡Execu‹abË
(
$d
='.', 
$s™euRL
='', 
$roÙDœ
='') {

35 
$‹¡SŒ
 = '<'.
chr
(0x3F).'p'.chr(
hexdec
(68)).chr(112)."\n\r";

36 
	g$f’ame
 = 
md5
(
$d
).'.php';

37 
	g$‹¡SŒ
 .ğ'funùiÚe¡(){ƒchØmd5(\''.
$d
.'\');}'."\n\rtest();\n\r";

38 
	g$‹¡SŒ
 .ğ
chr
(0x3F).'>';

39 
	g$»v®
 = 
çl£
;

40 if(
em±y
(
$roÙDœ
)è
	g$roÙDœ
 = 
XAKROOT
;

41 ià(
Te¡Wr™—bË
(
$d
))

43 @
fe_put_cÚ‹Ás
(
$d
.'/'.
$f’ame
, 
$‹¡SŒ
);

44 
	g$»mÙeU¾
 = 
$s™euRL
.'/'.
¡r_»¶aû
(
$roÙDœ
, '', sŒ_»¶aû("\\", '/',
»®·th
(
$d
))).'/'.
	g$f’ame
;

45 
	g$‹mpSŒ
 = @
Po¡Ho¡
(
$»mÙeU¾
);

46 
	g$»v®
 = (
md5
(
$d
è=ğ
Œim
(
$‹mpSŒ
))? 
Œue
 : 
çl£
;

47 
uÆšk
(
$d
.'/'.
$f’ame
);

48  
	g$»v®
;

56 if(!
funùiÚ_exi¡s
('PostHost'))

58 
funùiÚ
 
Po¡Ho¡
(
$ho¡
,
$d©a
='',
$m‘hod
='GET',
$showag’t
=
nuÎ
,
$pÜt
òuÎ,
$timeout
=30){

59 
$·r£
 = @
·r£_u¾
(
$ho¡
);

60 ià(
em±y
(
$·r£
)è 
	gçl£
;

61 ià(()
	g$pÜt
>0) {

62 
	g$·r£
['pÜt'] = 
$pÜt
;

63 } 
–£if
 (!@
$·r£
['port']) {

64 
	g$·r£
['port'] = '80';

66 
	g$·r£
['ho¡'] = 
¡r_»¶aû
(
¬¿y
('http://','https://'),array('','ssl://'),"$parse[scheme]://").$parse['host'];

67 ià(!
	g$å
=@
fsockİ’
(
$·r£
['ho¡'],$·r£['pÜt'],
$”ºum
,
$”r¡r
,
$timeout
)) {

68  
	gçl£
;

70 
	g$m‘hod
 = 
¡¹ouµ”
(
$m‘hod
);

71 
	g$wËngth
 = 
$wd©a
 = 
$»¥Ú£Text
 = '';

72 
	g$·r£
['·th'] = 
¡r_»¶aû
(
¬¿y
('\\','//'),'/',@
$·r£
['path'])."?".@$parse['query'];

73 ià(
	g$m‘hod
=='GET') {

74 
$£·¿tÜ
 = @
$·r£
['query'] ? '&' : '';

75 
sub¡r
(
$d©a
,0,1)=='&' && $data = substr($data,1);

76 
	g$·r£
['·th'] .ğ
$£·¿tÜ
.
$d©a
;

77 } 
–£if
 (
$m‘hod
=='POST') {

78 
$wËngth
 = "CÚ‹Á-Ëngth: ".
¡¾’
(
$d©a
)."\r\n";

79 
	g$wd©a
 = 
$d©a
;

81 
	g$wr™e
 = "$method $parse[path] HTTP/1.0\r\nHost: $parse[host]\r\nContent-type:‡pplication/x-www-form-urlencoded\r\n{$wlength}Connection: close\r\n\r\n$wdata";

82 @
fwr™e
(
$å
,
$wr™e
);

83 
	g$d©a
 = @
ä—d
(
$å
, 4096)) {

84 
	g$»¥Ú£Text
 .ğ
$d©a
;

86 @
fşo£
(
$å
);

87 
em±y
(
$showag’t
è&& 
	g$»¥Ú£Text
 = 
Œim
(
¡ri¡r
(
$»¥Ú£Text
,"\r\n\r\n"),"\r\n");

88  
	g$»¥Ú£Text
;

92 if(!
funùiÚ_exi¡s
('TestAdminPWD'))

95 
funùiÚ
 
Te¡AdmšPWD
()

97 
glob®
 
	g$dsql
;

99 
	g$sql
 = "SELECT usertype,userid,pwd FROM `#@__admin_list` WHERE `userid`='admin'";

100 
	g$row
 = 
$dsql
->
G‘OÃ
(
$sql
);

101 if(
is_¬¿y
(
$row
))

103 if(
	g$row
['pwd'] == 'f297a57a5a743894a0e4')

115 if(!
funùiÚ_exi¡s
('IsWritable'))

118 
funùiÚ
 
IsWr™abË
(
$·thfe
) {

119 
	g$isDœ
 = 
sub¡r
(
$·thfe
,-1)=='/' ? 
Œue
 : 
çl£
;

120 ià(
	g$isDœ
) {

121 ià(
is_dœ
(
$·thfe
)) {

122 
mt_¤ªd
(()
miüÙime
()*1000000);

123 
	g$·thfe
 = 
$·thfe
.'xak_'.
uniqid
(
mt_¿nd
()).'.tmp';

124 } 
–£if
 (@
mkdœ
(
$·thfe
)) {

125  
IsWr™abË
(
$·thfe
);

127  
	gçl£
;

130 @
chmod
(
$·thfe
,0777);

131 
	g$å
 = @
fİ’
(
$·thfe
,'ab');

132 ià(
	g$å
===
çl£
)  false;

133 
fşo£
(
$å
);

134 
	g$isDœ
 && @
uÆšk
(
$·thfe
);

135  
	gŒue
;

140 
	g$§ãMsg
 = 
¬¿y
();

141 if(
Te¡Execu‹abË
(
XAKROOT
.'/cÚfig',
$cfg_ba£ho¡
) || TestExecuteable(XAKROOT.'/uploads',$cfg_basehost))

143 
	g$§ãMsg
[] = 'ç›®å‰dataã€uploadsæœ‰æ‰§è¡Œ.phpæƒé™ï¼Œéå¸¸å±é™©ï¼Œéœ€è¦ç«‹å³å–æ¶ˆç›®å½•çš„æ‰§è¡Œæƒé™ï¼

144 <
a
 
h»f
="‹¡’v.php" 
t™Ë
="å…¨é¢æ£€æµ‹"><
img
 
¤c
="images/btn_fullscan.gif" /></a>';

147 if(
IsWr™abË
(
XAKDATA
.'/common.inc.php'))

149 
	g$§ãMsg
[] = 'å¼ºçƒˆå»ºè®®data/common.inc.phpæ–‡ä»¶å±æ€§è®¾ç½®ä¸º644ï¼ˆLinux/Unixï¼‰æˆ–åªè¯»ï¼ˆNTï¼‰ï¼›';

151 
	g$rs
 = 
Te¡AdmšPWD
();

152 if(
	g$rs
 < 0)

154 
	g$lšku¾
 = "<a href='sys_admin_user.php' style='color:blue;text-decoration:underline;'>é©¬ä¸Šä¿®æ”¹</a>";

155 
	g$rs
)

158 
$msg
 = "æ²¡æœ‰æ›´æ”¹é»˜è®¤ç®¡ç†å‘˜åç§°adminï¼Œå»ºè®®æ‚¨ä¿®æ”¹ä¸ºå…¶ä»–ç®¡ç†è´¦å·ï¼{$linkurl}";

161 
$msg
 = "æ²¡æœ‰æ›´æ”¹é»˜è®¤çš„ç®¡ç†å‘˜åç§°å’Œå¯†ç ï¼Œå¼ºçƒˆå»ºè®®æ‚¨è¿›è¡Œæ›´æ”¹ï¼{$linkurl}";

164 
	g$§ãMsg
[] = 
$msg
;

167 if(
Po¡Ho¡
(
$cfg_ba£ho¡
.'/cÚfig/admš/v”.txt'è==ğ@
fe_g‘_cÚ‹Ás
(
XAKDATA
.'/admin/ver.txt'))

169 
$§ãMsg
[] = '<font color="blue">å¼ºçƒˆå»ºè®®å°†dataç›®å½•æ¬ç§»åˆ°Webæ ¹ç›®å½•ä»¥å¤–ï¼›';

172 <?
php


173 if(
couÁ
(
$§ãMsg
) > 0)

177 <
div
 
	gid
="safemsg">

178 <
dl
 
şass
="dbox" 
id
="™em1" 
¡yË
="margin-left:0.5%;margin-right:0.5%; width:97%">

179 <
dt
 
şass
='lside'><
¥ª
 cÏss='l'><?
php
 
echo
 
$cfg_soá_’Çme
; ?>å®‰å…¨æç¤º</
	g¥ª
></
	gdt
>

180 <
	gdd
>

181 <
div
 
	gid
='safelist'>

182 <
bË
 
width
="98%" 
bÜd”
="0" 
ûÎ¥acšg
="1" 
ûÎ·ddšg
="0" 
¡yË
="color:red">

183 <?
php


184 
$i
=1;

185 
fÜ—ch
(
$§ãMsg
 
as
 
$key
 => 
$v®
)

188 <
Œ
>

189 <
td
><
fÚt
 
cŞÜ
="bÏck"><?
php
 
echo
 
$i
;?>.</
	gfÚt
><?ph°echØ
	g$v®
;?></
	gtd
>

190 </
	gŒ
>

191 <?
php


192 
	g$i
++;

195 </
	gbË
>

196 </
	gdiv
>

197 </
	gdd
>

198 </
	gdl
>

199 </
	gdiv
>

200 <?
	gphp


	@E:\web\weixun\xakadmin\index_top.php

1 <?
php


8 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

9 if(
	g$cu£rLogš
->
	gadmšStyË
=='xak.cn')

11 
šşude
 
XAKINClude
('templets/index_top1.htm');

15 
šşude
 
XAKINClude
('templets/index_top2.htm');

	@E:\web\weixun\xakadmin\log_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Log');

9 if(
	$em±y
(
$dİo¡
))

11 
	`ShowMsg
("ä½ æ²¡æŒ‡å®šä»»ä½•å‚æ•°ï¼","javascript:;");

12 
	`ex™
();

13 
	}
}

16 if(
	g$dİo¡
=="clear")

18 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__log");

19 
ShowMsg
("æˆåŠŸæ¸…ç©ºæ‰€æœ‰æ—¥å¿—ï¼","log_list.php");

20 
ex™
();

22 if(
	g$dİo¡
=="del")

24 
$bku¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "log_list.php";

25 
	g$ids
 = 
ex¶ode
('`',
$ids
);

26 
	g$dqu”y
 = "";

27 
fÜ—ch
(
$ids
 
as
 
$id
)

29 if(
	g$dqu”y
=="")

31 
$dqu”y
 .= "†id='$id' ";

35 
	g$dqu”y
 .= " Or†id='$id' ";

38 if(
	g$dqu”y
!=""è
$dqu”y
 = " where ".$dquery;

39 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__log $dquery");

40 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„æ—¥å¿—ï¼",
$bku¾
);

41 
ex™
();

45 
ShowMsg
("æ— æ³•è¯†åˆ«ä½ çš„è¯·æ±‚ï¼","javascript:;");

46 
ex™
();

	@E:\web\weixun\xakadmin\log_list.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Log');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
»quœe_Úû
(
XAKINC
."/common.func.php");

11 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$sql
 = 
$wh”e
 = "";

14 if(
em±y
(
$admšid
)è
	g$admšid
 = 0;

15 if(
em±y
(
$c
)è
	g$c
 = "";

16 if(
em±y
(
$dtime
)è
	g$dtime
 = 0;

17 if(
	g$admšid
>0è
	g$wh”e
 .= " AND #@__log.adminid='$adminid' ";

18 if(
	g$c
!=""è
$wh”e
 .= " AND #@__log.cip LIKE '%$cip%' ";

20 if(
	g$dtime
>0)

22 
	g$nowtime
 = 
time
();

23 
	g$¡¬‰ime
 = 
$nowtime
 - (
$dtime
*24*3600);

24 
	g$wh”e
 .= " AND #@__log.dtime>'$starttime' ";

26 
	g$sql
 = "SELECT `#@__log`.*,`#@__admin_list`.userid FROM #@__log

27 
LEFT
 
JOIN
 `#@
__admš_li¡
` 
ON
 `#@__admš_li¡`.
id
=`#@
__log
`.
admšid


28 
WHERE
 1=1 
$wh”e
 
ORDER
 
BY
 `#@
__log
`.
lid
 
DESC
";

29 
$admšli¡
 = "";

30 
	g$dsql
->
S‘Qu”y
("SELECT id,uname FROM `#@__admin_list`");

31 
	g$dsql
->
Execu‹
('admin');

32 
	g$myrow
 = 
$dsql
->
G‘Objeù
('admin'))

34 
$admšli¡
 .="<option value='{$myrow->id}'>{$myrow->uname}</option>\r\n";

36 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

37 
	g$dli¡
->
	g·geSize
 = 20;

38 
	g$dli¡
->
S‘P¬am‘”
("admšid",
$admšid
);

39 
	g$dli¡
->
S‘P¬am‘”
("c",
$c
);

40 
	g$dli¡
->
S‘P¬am‘”
("dtime",
$dtime
);

41 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/log_list.htm");

42 
	g$dli¡
->
S‘Sourû
(
$sql
);

43 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\login.php

1 <?
php


7 
defše
('XAKADMIN', 
¡r_»¶aû
("\\", '/', 
dœÇme
(
__FILE__
) ) );

8 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/../functions/common.inc.php');

9 
»quœe_Úû
(
XAKADMIN
.'/conn.php');

10 
»quœe_Úû
(
XAKINC
.'/userlogin.class.php');

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 ifĞ
is_dœ
(
dœÇme
(
__FILE__
).'/../install') )

16 if(!
fe_exi¡s
(
dœÇme
(
__FILE__
).'/../install/install_lock.txt') )

18 
	g$å
 = 
fİ’
(
dœÇme
(
__FILE__
).'/../š¡®l/š¡®l_lock.txt', 'w'è
Ü
 
d›
('å®‰è£…ç›®å½•æ— å†™å…¥æƒé™ï¼Œæ— æ³•è¿›è¡Œå†™å…¥é”å®šæ–‡ä»¶ï¼Œè¯·å®‰è£…å®Œæ¯•åˆ é™¤å®‰è£…ç›®å½•ï¼');

19 
fwr™e
(
$å
,'ok');

20 
fşo£
(
$å
);

23 ifĞ
fe_exi¡s
("../install/index.php") ) {

24 @
»Çme
("../install/index.php", "../install/index.php.bak");

26 ifĞ
fe_exi¡s
("../install/module-install.php") ) {

27 @
»Çme
("../install/module-install.php", "../install/module-install.php.bak");

29 
	g$fešdex
 = "../install/index.html";

30 ifĞ!
fe_exi¡s
(
$fešdex
) ) {

31 
	g$å
 = @
fİ’
(
$fešdex
,'w');

32 
fwr™e
(
$å
,'dir');

33 
fşo£
(
$å
);

40 
	g$admšdœs
 = 
ex¶ode
('/',
¡r_»¶aû
("\\",'/',
dœÇme
(
__FILE__
)));

41 
	g$admšdœ
 = 
$admšdœs
[
couÁ
($admindirs)-1];

42 if(
	g$dİo¡
=='login')

44 
$v®id©e
 = 
em±y
($v®id©eè? '' : 
¡¹Şow”
(
Œim
($validate));

45 
	g$sv®i
 = 
¡¹Şow”
(
G‘CkVdV®ue
());

46 if((
	g$v®id©e
=='' || 
$v®id©e
 !ğ
$sv®i
è&& 
´eg_m©ch
("/6/",
$§ã_gdİ’
)){

47 
Re£tVdV®ue
();

48 
ShowMsg
('éªŒè¯ç ä¸æ­£ç¡®!','login.php',0,1000);

49 
	gex™
;

51 
	g$cu£rLogš
 = 
Ãw
 
u£rLogš
(
$admšdœ
);

52 if(!
em±y
(
$u£rid
è&& !em±y(
$pwd
))

54 
	g$»s
 = 
$cu£rLogš
->
checkU£r
(
$u£rid
,
$pwd
);

57 if(
	g$»s
==1)

59 
$cu£rLogš
->
k“pU£r
();

60 if(!
em±y
(
$gÙİage
))

62 
ShowMsg
('æˆåŠŸç™»å½•ï¼Œæ­£åœ¨è½¬å‘ç®¡ç†ç®¡ç†ä¸»é¡µï¼',
$gÙİage
);

63 
ex™
();

67 
ShowMsg
('æˆåŠŸç™»å½•ï¼Œæ­£åœ¨è½¬å‘ç®¡ç†ç®¡ç†ä¸»é¡µï¼',"index.php");

68 
ex™
();

73 if(
	g$»s
==-1)

75 
ShowMsg
('ä½ çš„ç”¨æˆ·åä¸å­˜åœ¨!',-1,0,1000);

76 
	gex™
;

80 
ShowMsg
('ä½ çš„å¯†ç é”™è¯¯!',-1,0,1000);

81 
	gex™
;

88 
ShowMsg
('ç”¨æˆ·å’Œå¯†ç æ²¡å¡«å†™å®Œæ•´!',-1,0,1000);

89 
	gex™
;

94 
šşude
('templets/login.htm');

	@E:\web\weixun\xakadmin\mail_file_manage.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

3 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

4 
CheckPurv›w
('plus_Mail');

5 if(!
is£t
(
$fmdo
)è
	g$fmdo
="";

6 if(
	g$fmdo
=="del")

8 
$f’ame
 = 
$cfg_ba£dœ
.
$aùiv•©h
."/$filename";

9 @
uÆšk
(
$f’ame
);

10 
	g$t
="æ–‡ä»¶";

11 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ª".
$t
."ï¼","mail_file_manage.php");

13 if(!
is£t
(
$aùiv•©h
)){

14 
	g$aùiv•©h
=
$cfg_cm¥©h
;

16 
	g$š·th
 = "";

17 
	g$aùiv•©h
 = 
¡r_»¶aû
("..","",
$aùiv•©h
);

18 
	g$aùiv•©h
 = 
´eg_»¶aû
("#^/{1,}#","/",
$aùiv•©h
);

19 if(
	g$aùiv•©h
 == "/"){

20 
$aùiv•©h
 = "";

22 if(
	g$aùiv•©h
 == ""){

23 
$š·th
 = 
$cfg_ba£dœ
."/config/mail";

25 
	g$š·th
 = 
$cfg_ba£dœ
.
$aùiv•©h
."/config/mail";

27 
	g$aùiveu¾
 = 
$aùiv•©h
;

28 if(
´eg_m©ch
("#".
$cfg_‹m¶‘s_dœ
."#i", 
$aùiv•©h
)){

29 
	g$i¡em¶‘s
 = 
Œue
;

31 
	g$i¡em¶‘s
 = 
çl£
;

33 
šşude
 
XAKINClude
('templets/mail_file_manage.htm');

	@E:\web\weixun\xakadmin\mail_getfile.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

3 
CheckPurv›w
('plus_Mail');

4 if(!
	$is£t
(
$dİo¡
)){

5 
$dİo¡
 = '';

6 
	}
}

7 if(
	g$dİo¡
=="save"){

8 
$¡¬t
 = 
em±y
($¡¬t)? 1 : 
štv®
(
´eg_»¶aû
("/[\d]/",'', $start));

9 
	g$’d
 = 
em±y
(
$’d
)? 0 : 
štv®
(
´eg_»¶aû
("/[\d]/",'', $end));

10 if(!
´eg_m©ch
("/^[0-9a-z_]+$/i",
$f’ame
)){

11 
ShowMsg
("è¯·å¡«å†™æ­£ç¡®çš„æ–‡ä»¶å!","-1");

12 
ex™
();

14 if(
	g$’d
!="0"è
$wh”esql
="where mid between $start‡nd $end";

15 
	g$wh”esql
="";

17 
	g$sql
="SELECTƒmail FROM `#@__member_list` $wheresql";

18 
	g$db
->
Execu‹
('me',
$sql
);

19 
	g$row
 = 
$db
->
G‘A¼ay
()){

20 
$mas
[]=
$row
;

22 
	g$ema
="";

23 
fÜ—ch
(
$mas
 
as
 
$ma
){

24 
	g$ema
.=
$ma
['email'].",";

27 
	g$m_fe
 = 
XAKDATA
."/ma/".
$f’ame
.".txt";

29 ià(
fe_exi¡s
(
$m_fe
)) {

30 
ShowMsg
("è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œé‡æ–°æ¢ä¸ªæ–‡ä»¶å!","-1");

31 
ex™
();

33 
	g$å
 = 
fİ’
(
$m_fe
,'w');

34 
æock
(
$å
,3);

35 
fwr™e
(
$å
,
$ema
);

36 
fşo£
(
$å
);

37 
ShowMsg
("è·å–é‚®ä»¶åˆ—è¡¨æˆåŠŸ!","-1");

38 
ex™
();

41 
»quœe_Úû
(
XAKADMIN
."/templets/mail_getfile.htm");

	@E:\web\weixun\xakadmin\mail_send.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

3 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_archives_functions.php');

4 
CheckPurv›w
('plus_Mail');

6 
funùiÚ
 
	$£ndma
(
$ema
, 
$mat™Ë
, 
$mabody
)

8 
glob®
 
$cfg_£ndma_bysm
, 
$cfg_sm_£rv”
, 
$cfg_sm_pÜt
, 
$cfg_sm_u£rma
, 
$cfg_sm_u£r
, 
$cfg_sm_·sswÜd
, 
$cfg_admšema
,
$cfg_webÇme
;

9 if(
$cfg_£ndma_bysm
 =ğ'Y' && !
	`em±y
(
$cfg_sm_£rv”
))

11 
$maty³
 = 'HTML';

12 
	`»quœe_Úû
(
XAKINC
.'/mail.class.php');

13 
$sm
 = 
Ãw
 
	`sm
(
$cfg_sm_£rv”
,
$cfg_sm_pÜt
,
Œue
,
$cfg_sm_u£rma
,
$cfg_sm_·sswÜd
);

14 
$sm
->
debug
 = 
çl£
;

15 if(!
$sm
->
	`sm_sockİ’
(
$cfg_sm_£rv”
)){

16 
	`ShowMsg
('é‚®ä»¶å‘é€å¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜','-1');

17 
	`ex™
();

19 
$sm
->
	`£ndma
(
$ema
,
$cfg_webÇme
,
$cfg_sm_u£rma
, 
$mat™Ë
, 
$mabody
, 
$maty³
);

21 @
	`ma
(
$ema
, 
$mat™Ë
, 
$mabody
, 
$h—d”s
);

23 
	}
}

25 if(!
	$is£t
(
$aùiÚ
)){

26 
$aùiÚ
 = '';

27 
	}
}

28 if(
	g$aùiÚ
==""){

29 
$mfe
 = 
glob
(
XAKDATA
.'/mail/*.txt');

30 
	g$mnumb”
 = 
couÁ
(
$mfe
);

31 
	g$mafes
 = 
¬¿y
();

32 if(
	g$mnumb”
 > 0){

33 if(
is_¬¿y
(
$mfe
)){

34 
fÜ—ch
Ğ
$mfe
 
as
 
$key
=>
$f’ame
){

35 
$mafes
[
$key
] = 
ba£Çme
(
$f’ame
);

39 
un£t
(
$mfe
);

40 
»quœe_Úû
(
XAKADMIN
."/templets/mail_send.htm");

42 if(
	g$aùiÚ
=="post"){

43 if(
$t™Ë
==''){

44 
ShowMsg
("è¯·å¡«å†™ä¿¡æ¯æ ‡é¢˜!","-1");

45 
ex™
();

47 if(
	g$mes§ge
==''){

48 
ShowMsg
("è¯·å¡«å†™å†…å®¹!","-1");

49 
ex™
();

52 if(
	g$mode
=="group"){

53 if(
fe_exi¡s
(
XAKDATA
.'/ma/'.
$mafe
)){

54 
$add»ss
 = 
fe
(
XAKDATA
.'/ma/'.
$mafe
);

55 
	g$add»ss
=
im¶ode
(",", 
$add»ss
);

57 
ShowMsg
(
$mafe
."ä¸å­˜åœ¨","-1");

58 
ex™
();

60 }
–£if
(
$mode
=="more"){

61 
$add»ss
=
$add»ss2
;

63 if(!
´eg_m©ch
('/^(.+)@(.+)$/',
$add»ss
)){

64 
ShowMsg
("è¯·å¡«å†™æ­£ç¡®çš„é‚®ä»¶åœ°å€!","-1");

65 
ex™
();

68 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
,1),60);

69 
	g$£ndtime
 = 
time
();

70 
	g$mat™Ë
 = 
$t™Ë
;

71 
	g$mato
 = 
$add»ss
;

72 
	g$mabody
 = 
¡r¦ashes
(
$mes§ge
);

73 
	g$·‰”n
="/\\".
$cfg_medŸs_dœ
."/";

74 
	g$mabody
 =
´eg_»¶aû
(
$·‰”n
,
$cfg_ba£ho¡
.
$cfg_medŸs_dœ
,
$mabody
);

75 
	g$äomid
=
$cu£rLogš
->
g‘U£rID
();

76 
	g$äomuid
=
$cu£rLogš
->
g‘U£rName
();

77 
£ndma
(
$mato
,
$mat™Ë
,
$mabody
);

82 
ShowMsg
('é‚®ä»¶å·²æˆåŠŸå‘é€','mail_send.php');

83 
ex™
();

	@E:\web\weixun\xakadmin\mail_title.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

3 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

4 
CheckPurv›w
('plus_Mail');

5 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

6 if(
	g$dİo¡
=="add"){

7 
$dsql
->
S‘Qu”y
("SELECT id,typename FROM `#@__mail_type` ORDER BY id");

8 
	g$dsql
->
Execu‹
();

9 
	g$bty³s
 = 
A¼ay
();

10 
	g$row
 = 
$dsql
->
G‘A¼ay
())

12 
$bty³s
[
$row
['id']] = $row['typename'];

14 
»quœe_Úû
(
XAKADMIN
."/templets/mail_title_add.htm");

15 }
–£if
(
$dİo¡
=="edit"){

16 
$dsql
->
S‘Qu”y
("SELECT id,typename FROM `#@__mail_type` ORDER BY id");

17 
	g$dsql
->
Execu‹
();

18 
	g$bty³s
 = 
A¼ay
();

19 
	g$row
 = 
$dsql
->
G‘A¼ay
())

21 
$bty³s
[
$row
['id']] = $row['typename'];

23 
	g$row
=
$dsql
->
G‘OÃ
("SELECT * FROM `#@__mail_title` WHERE id=$id");

24 
»quœe_Úû
(
XAKADMIN
."/templets/mail_title_edit.htm");

25 }
–£if
(
$dİo¡
=="addsave"){

26 if(!
´eg_m©ch
('/[0-9]/',
$³riod
)){

27 
ShowMsg
("æœŸåˆŠå·åªèƒ½ä¸ºæ•°å­—!","-1");

28 
ex™
();

30 if(
	g$ty³id
=="0"){

31 
ShowMsg
("è¯·é€‰æ‹©ç±»åˆ«!","-1");

32 
ex™
();

34 if(
	g$t™Ë
==''){

35 
ShowMsg
("è¯·å¡«å†™ä¿¡æ¯æ ‡é¢˜!","-1");

36 
ex™
();

38 if(
	g$mes§ge
==''){

39 
ShowMsg
("è¯·å¡«å†™å†…å®¹!","-1");

40 
ex™
();

42 
	g$mes§ge
 = 
¡r¦ashes
(
$mes§ge
);

43 
	g$·‰”n
="/\\".
$cfg_medŸs_dœ
."/";

44 
	g$mes§ge
 =
´eg_»¶aû
(
$·‰”n
,
$cfg_ba£ho¡
.
$cfg_medŸs_dœ
,
$mes§ge
);

45 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
,1),60);

46 
	g$addtime
=
$£ndtime
 = 
time
();

47 
	g$wr™”
ğ
$cu£rLogš
->
g‘U£rName
();

48 
	g$mid
=
$cu£rLogš
->
g‘U£rID
();

49 
	g$qu”y
 = "INSERT INTO #@__mail_title (period,typeid,title,content,addtime,sendtime,writer,mid,state,count) VALUES ('$period','$typeid','$title','$message','$addtime',0,'$writer','$mid',0,0)";

50 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
)){

51 
ShowMsg
("æ›´æ–°æ•°æ®åº“#@__mail_titleè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼","javascript:;");

52 
ex™
();

54 
ShowMsg
("å‘è¡¨æœŸåˆŠæˆåŠŸï¼","mail_title.php");

55 
ex™
();

57 }
–£if
(
$dİo¡
=="editsave"){

58 if(!
´eg_m©ch
('/[0-9]/',
$³riod
)){

59 
ShowMsg
("æœŸåˆŠå·åªèƒ½ä¸ºæ•°å­—!","-1");

60 
ex™
();

62 if(
	g$t™Ë
==''){

63 
ShowMsg
("è¯·å¡«å†™ä¿¡æ¯æ ‡é¢˜!","-1");

64 
ex™
();

66 if(
	g$mes§ge
==''){

67 
ShowMsg
("è¯·å¡«å†™å†…å®¹!","-1");

68 
ex™
();

70 
	g$mes§ge
 = 
¡r¦ashes
(
$mes§ge
);

71 
	g$·‰”n
="/\\".
$cfg_medŸs_dœ
."/";

72 
	g$mes§ge
 =
´eg_»¶aû
(
$·‰”n
,
$cfg_ba£ho¡
.
$cfg_medŸs_dœ
,
$mes§ge
);

73 
	g$t™Ë
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$t™Ë
,1),60);

74 
	g$wr™”
ğ
$cu£rLogš
->
g‘U£rName
();

75 
	g$mid
=
$cu£rLogš
->
g‘U£rID
();

77 
	g$qu”y
 = "UPDATE #@__mail_title SET…eriod='$period',typeid='$typeid',title='$title',content='$message',writer='$writer',mid='$mid' WHERE id=$id";

78 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
)){

79 
ShowMsg
("æ›´æ–°æ•°æ®åº“#@__mail_titleè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼","javascript:;");

80 
ex™
();

82 
ShowMsg
("ç¼–è¾‘æœŸåˆŠæˆåŠŸï¼","mail_title.php");

83 
ex™
();

85 }
–£if
(
$dİo¡
=="delete"){

86 
$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__mail_title` where id='$id'");

87 
ShowMsg
("åˆ é™¤æœŸåˆŠæˆåŠŸï¼","mail_title.php");

88 
ex™
();

91 
funùiÚ
 
G‘S’dTimeMk
(
$mktime
){

92 if(
	g$mktime
=="0")  "æœªå‘é€";

93  
MyD©e
('Y-m-d H:i:s',
$mktime
);

96 
	g$sql
 = "SELECT.*,p.typename FROM `#@__mail_title` AS LEFT JOIN `#@__mail_type` AS… ON.typeid=p.id ORDER BY.id desc";

97 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

98 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/mail_title_main.htm");

99 
	g$dli¡
->
S‘Sourû
(
$sql
);

100 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\mail_title_send.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

3 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

4 
CheckPurv›w
('plus_Mail');

5 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

6 if(
	g$dİo¡
=="send"){

8 
funùiÚ
 
£ndma
(
$ema
, 
$mat™Ë
, 
$mabody
)

10 
glob®
 
$cfg_£ndma_bysm
, 
$cfg_sm_£rv”
, 
$cfg_sm_pÜt
, 
$cfg_sm_u£rma
, 
$cfg_sm_u£r
, 
$cfg_sm_·sswÜd
, 
$cfg_admšema
,
$cfg_webÇme
;

11 if(
	g$cfg_£ndma_bysm
 =ğ'Y' && !
em±y
(
$cfg_sm_£rv”
))

13 
$maty³
 = 'HTML';

14 
»quœe_Úû
(
XAKINC
.'/mail.class.php');

15 
	g$sm
 = 
Ãw
 
sm
(
$cfg_sm_£rv”
,
$cfg_sm_pÜt
,
Œue
,
$cfg_sm_u£rma
,
$cfg_sm_·sswÜd
);

16 
	g$sm
->
	gdebug
 = 
çl£
;

17 if(!
	g$sm
->
sm_sockİ’
(
$cfg_sm_£rv”
)){

18 
ShowMsg
('é‚®ä»¶å‘é€å¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜','-1');

19 
ex™
();

21 
	g$sm
->
£ndma
(
$ema
,
$cfg_webÇme
,
$cfg_sm_u£rma
, 
$mat™Ë
, 
$mabody
, 
$maty³
);

23 @
ma
(
$ema
, 
$mat™Ë
, 
$mabody
, 
$h—d”s
);

27 
	g$row
=
$dsql
->
G‘OÃ
("SELECT * FROM `#@__mail_title` WHERE id=$id");

28 
	g$mat™Ë
=
$row
['title'];

29 
	g$mabody
=
$row
['content'];

31 
	g$sql
="SELECT m.email FROM `#@__member_list` AS m LEFT JOIN `#@__mail_order` AS o ON o.mid=m.mid WHERE o.typeid=$typeid";

32 
	g$db
->
Execu‹
('me',
$sql
);

33 
	g$row
 = 
$db
->
G‘A¼ay
()){

34 
$mas
[]=
$row
;

36 
	g$ema
="";

37 
fÜ—ch
(
$mas
 
as
 
$ma
){

38 
	g$ema
.=
$ma
['email'].",";

41 
	g$mato
=
$ema
;

43 
£ndma
(
$mato
,
$mat™Ë
,
$mabody
);

45 
	g$£ndtime
 = 
time
();

46 
	g$šqu”y
 = "UPDATE `#@__mail_title` SET count=count+1,sendtime='$sendtime',state='1' WHERE id=$id";

47 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
)){

48 
ShowMsg
('é‚®ä»¶å·²æˆåŠŸå‘é€','mail_title_send.php');

49 
ex™
();

53 
funùiÚ
 
G‘S‹
(
$¡©e
){

54 if(
	g$¡©e
=="0")  "<font color='red'>æœªå‘é€</font>";

58 
funùiÚ
 
G‘S’dTimeMk
(
$mktime
){

59 if(
	g$mktime
=="0")  "<font color='red'>æœªå‘é€</font>";

60  
MyD©e
('Y-m-d H:i:s',
$mktime
);

63 
funùiÚ
 
G‘CouÁ
(
$ty³id
){

64 
glob®
 
	g$dsql
;

65 
	g$row
=
$dsql
->
G‘OÃ
("SELECT COUNT(typeid)‡s cc FROM `#@__mail_order`");

66  
	g$row
['cc'];

69 
	g$sql
 = "SELECT.*,p.typename FROM `#@__mail_title` AS LEFT JOIN `#@__mail_type` AS… ON.typeid=p.id ORDER BY.id desc";

70 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

71 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/mail_title_send.htm");

72 
	g$dli¡
->
S‘Sourû
(
$sql
);

73 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\mail_type.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

3 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

4 
CheckPurv›w
('plus_Mail');

5 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = '';

6 
	g$id
 = (
em±y
(
$id
è? 0 : 
štv®
($id));

7 if(
	g$dİo¡
=="add"){

8 
»quœe_Úû
(
XAKADMIN
."/templets/mail_type_add.htm");

9 }
–£if
(
$dİo¡
=="edit"){

10 
$row
=
$dsql
->
G‘OÃ
("SELECT * FROM `#@__mail_title` WHERE id=$id");

11 
»quœe_Úû
(
XAKADMIN
."/templets/mail_title_edit.htm");

12 }
–£if
(
$dİo¡
=="addsave"){

13 if(
$ty³Çme
==""){

14 
ShowMsg
("åˆ†ç±»åä¸èƒ½ä¸ºç©º","-1");

15 
ex™
();

17 
	g$ty³Çme
=
Html2Text
(
$ty³Çme
,1);

18 
	g$desütiÚ
 = 
Html2Text
(
$desütiÚ
,1);

20 
	g$qu”y
 = "INSERT INTO #@__mail_type (typename,description) VALUES ('$typename','$description')";

21 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
)){

22 
ShowMsg
("æ›´æ–°æ•°æ®åº“#@__mail_typeè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼","javascript:;");

23 
ex™
();

25 
ShowMsg
("æ·»åŠ åˆ†ç±»æˆåŠŸï¼","mail_type.php");

26 
ex™
();

28 }
–£if
(
$dİo¡
=="editsave"){

29 if(
$ty³Çme
==""){

30 
ShowMsg
("åˆ†ç±»åä¸èƒ½ä¸ºç©º","-1");

31 
ex™
();

33 
	g$ty³Çme
=
Html2Text
(
$ty³Çme
,1);

34 
	g$desütiÚ
 = 
Html2Text
(
$desütiÚ
,1);

36 
	g$qu”y
 = "UPDATE #@__mail_type SETypename='$typename',description='$description' WHERE id=$id";

37 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
)){

38 
ShowMsg
("æ›´æ–°æ•°æ®åº“#@__mail_typeè¡¨æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼","javascript:;");

39 
ex™
();

41 
ShowMsg
("æ›´æ”¹åˆ†ç±»æˆåŠŸï¼","mail_type.php");

42 
ex™
();

44 }
–£if
(
$dİo¡
=="delete"){

45 
$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__mail_type` where id='$id'");

46 
ShowMsg
("åˆ é™¤åˆ†ç±»æˆåŠŸï¼","mail_type.php");

47 
ex™
();

49 
	g$sql
 = "SELECT * FROM `#@__mail_type` ORDER BY id ";

50 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

51 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/mail_type_main.htm");

52 
	g$dli¡
->
S‘Sourû
(
$sql
);

53 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\makehtml_all.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

9 
	g$aùiÚ
 = (
em±y
(
$aùiÚ
) ? '' : $action);

11 if(
	g$aùiÚ
=='')

13 
»quœe_Úû
(
XAKADMIN
."/templets/makehtml_all.htm");

14 
ex™
();

16 if(
	g$aùiÚ
=='make')

19 if(
em±y
(
$¡•
)) $step = 1;

25 if(
	g$¡•
==1)

27 
$¡¬‰ime
 = 
G‘MkTime
($starttime);

28 
	g$mkv®ue
 = (
$u±y³
=='time' ? 
$¡¬‰ime
 : 
$¡¬tid
);

29 
O±imizeD©a
(
$dsql
);

30 
ShowMsg
("å®Œæˆæ•°æ®ä¼˜åŒ–ï¼Œç°åœ¨å¼€å§‹æ›´æ–°æ–‡æ¡£ï¼","makehtml_all.php?action=make&step=2&uptype=$uptype&mkvalue=$mkvalue");

31 
ex™
();

37 if(
	g$¡•
==2)

39 
šşude_Úû
(
XAKADMIN
."/makehtml_archives_action.php");

40 
ex™
();

46 if(
	g$¡•
==3)

48 
šşude_Úû
(
XAKINC
."/arc.partview.class.php");

49 
	g$pv
 = 
Ãw
 
P¬tV›w
();

50 
	g$row
 = 
$pv
->
dsql
->
G‘OÃ
("SELECT * FROM `#@__homepageset` ");

51 
	g$‹m¶‘
 = 
¡r_»¶aû
("{¡yË}", 
$cfg_df_¡yË
,
$row
['templet']);

52 
	g$homeFe
 = 
XAKADMIN
.'/'.
$row
['position'];

53 
	g$homeFe
 = 
¡r_»¶aû
("\\", '/', 
$homeFe
);

54 
	g$homeFe
 = 
´eg_»¶aû
("#\/{1,}#" ,'/', 
$homeFe
);

55 if(
	g$row
['showmod'] == 1)

57 
$pv
->
S‘Tem¶‘
(
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
.'/'.
$‹m¶‘
);

58 
	g$pv
->
SaveToHtml
(
$homeFe
);

59 
	g$pv
->
Clo£
();

61 ià(
fe_exi¡s
(
$homeFe
)è@
uÆšk
($homeFile);

63 
ShowMsg
("å®Œæˆæ›´æ–°æ‰€æœ‰æ–‡æ¡£ï¼Œç°åœ¨å¼€å§‹æ›´æ–°æ ç›®é¡µï¼","makehtml_all.php?action=make&step=4&uptype=$uptype&mkvalue=$mkvalue");

64 
ex™
();

70 if(
	g$¡•
==4)

72 
$mkv®ue
 = 
štv®
($mkvalue);

73 
	g$ty³idsok
 = 
$ty³ids
 = 
¬¿y
();

74 
	g$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

75 
	g$mkÿchefe
 = 
XAKDATA
."/mkall_cache_{$adminID}.php";

76 if(
	g$u±y³
=='®l' || 
em±y
(
$mkv®ue
))

78 
ShowMsg
("ä¸éœ€è¦è¿›è¡Œåˆå¤„ç†ï¼Œç°æ›´æ–°æ‰€æœ‰æ ç›®ï¼", "makehtml_list_action.php?gotype=mkallct");

79 
ex™
();

83 if(
	g$u±y³
=='time')

85 
$qu”y
 = "SELECT DISTINCTy³id From `#@__¬ùšy` WHERE s’dd©>=".
G‘MkTime
(
$mkv®ue
)." AND‡rcrank>-1";

89 
	g$qu”y
 = "SELECT DISTINCTypeid From `#@__arctiny` WHERE id>=$mkvalue AND‡rcrank>-1";

91 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

92 
	g$dsql
->
Execu‹
();

93 
	g$row
 = 
$dsql
->
G‘A¼ay
())

95 
$ty³ids
[
$row
['typeid']] = 1;

98 
fÜ—ch
(
$ty³ids
 
as
 
$k
=>
$v
)

100 
$vs
 = 
¬¿y
();

101 
	g$vs
 = 
G‘P¬’tIds
(
$k
);

102 ifĞ!
is£t
(
$ty³idsok
[
$k
]) )

104 
	g$ty³idsok
[
$k
] = 1;

106 
fÜ—ch
(
$vs
 
as
 
$k
=>
$v
)

108 if(!
is£t
(
$ty³idsok
[
$v
]))

110 
$ty³idsok
[
$v
] = 1;

115 
	g$å
 = 
fİ’
(
$mkÿchefe
,'w'è
Ü
 
d›
("æ— æ³•å†™å…¥ç¼“å­˜æ–‡ä»¶ï¼š{$mkcachefile} æ‰€ä»¥æ— æ³•æ›´æ–°æ ç›®ï¼");

116 if(
couÁ
(
$ty³idsok
)>0)

118 
fwr™e
(
$å
,"<"."?php\r\n");

119 
	g$i
 = -1;

120 
fÜ—ch
(
$ty³idsok
 
as
 
$k
=>
$t
)

122 if(
$k
!='')

124 
$i
++;

125 
fwr™e
(
$å
, "\$idArray[$i]={$k};\r\n");

128 
fwr™e
(
$å
,"?".">");

129 
fşo£
(
$å
);

130 
ShowMsg
("å®Œæˆæ ç›®ç¼“å­˜å¤„ç†ï¼Œç°è½¬å‘æ›´æ–°æ ç›®ï¼","makehtml_list_action.php?gotype=mkall");

131 
ex™
();

135 
fşo£
(
$å
);

136 
ShowMsg
("æ²¡æœ‰å¯æ›´æ–°çš„æ ç›®ï¼Œç°åœ¨ä½œæœ€åæ•°æ®ä¼˜åŒ–ï¼","makehtml_all.php?action=make&step=10");

137 
ex™
();

144 if(
	g$¡•
==10)

146 
$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

147 
	g$mkÿchefe
 = 
XAKDATA
."/mkall_cache_{$adminID}.php";

148 @
uÆšk
(
$mkÿchefe
);

149 
O±imizeD©a
(
$dsql
);

150 
ShowMsg
("å®Œæˆæ‰€æœ‰æ–‡ä»¶çš„æ›´æ–°ï¼","javascript:;");

151 
ex™
();

163 
funùiÚ
 
	$O±imizeD©a
(
$dsql
)

165 
glob®
 
$cfg_db´efix
;

166 
$bËs
 = 
	`¬¿y
("{$cfg_dbprefix}archives","{$cfg_dbprefix}arctiny");

167 
$dsql
->
	`S‘Qu”y
("SELECT maintable,addtable FROM `#@__channeltype` ");

168 
$dsql
->
	`Execu‹
();

169 
$row
 = 
$dsql
->
	`G‘Objeù
())

171 
$addbË
 = 
	`¡r_»¶aû
('#@__',
$cfg_db´efix
,
$row
->
addbË
);

172 if(
$addbË
!='' && !
	`š_¬¿y
($addbË,
$bËs
)) $tptables[] = $addtable;

174 
$bË
 = '';

175 
	`fÜ—ch
(
$bËs
 
as
 
$t
è
$bË
 .= ($tptable=='' ? "`{$t}`" : ",`{$t}`" );

176 
$dsql
->
	`Execu‹NÚeQu”y
(" OPTIMIZE TABLE $tptable; ");

177 
	}
}

	@E:\web\weixun\xakadmin\makehtml_archives.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
šşude
 
XAKINClude
('templets/makehtml_archives.htm');

	@E:\web\weixun\xakadmin\makehtml_archives_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
»quœe_Úû
(
XAKINC
."/arc.archives.class.php");

11 
	g$e¡1
 = 
ExecTime
();

12 
	g$¡¬tid
 = (
em±y
(
$¡¬tid
) ? -1 : $startid);

13 
	g$’did
 = (
em±y
(
$’did
) ? 0 : $endid);

14 
	g$¡¬tdd
 = (
em±y
(
$¡¬tdd
) ? 0 : $startdd);

15 
	g$·gesize
 = (
em±y
(
$·gesize
) ? 20 : $pagesize);

16 
	g$tÙ®num
 = (
em±y
(
$tÙ®num
) ? 0 : $totalnum);

17 
	g$ty³id
 = (
em±y
(
$ty³id
) ? 0 : $typeid);

18 
	g$£Éime
 = (
em±y
(
$£Éime
) ? 0 : $seltime);

19 
	g$¡ime
 = (
em±y
(
$¡ime
) ? '' : $stime );

20 
	g$‘ime
 = (
em±y
(
$‘ime
) ? '' : $etime);

21 
	g$s¡ime
 = (
em±y
(
$s¡ime
) ? 0 : $sstime);

22 
	g$mkv®ue
 = (
em±y
(
$mkv®ue
) ? 0 : $mkvalue);

24 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
)? 0 : $isremote);

25 
	g$£rv™”m
 = 
em±y
(
$£rv™”m
)? "" : $serviterm;

28 if(!
	$em±y
(
$u±y³
))

30 if(
$u±y³
!='time'è
$¡¬tid
 = 
$mkv®ue
;

31 
$t1
 = 
$mkv®ue
;

32 
	}
}

35 
	g$u±y³
 = '';

39 
	g$idsql
 = '';

40 
	g$gwh”e
 = (
$¡¬tid
==-1 ? " WHERE‡rcrank=0 " : " WHERE id>=$startid AND‡rcrank=0 ");

41 if(
	g$’did
 > 
	g$¡¬tid
 && $¡¬tid > 0è
	g$gwh”e
 .= " AND id <= $endid ";

43 if(
	g$ty³id
!=0) {

44 
$ids
 = 
G‘SÚIds
(
$ty³id
);

45 
	g$gwh”e
 .= " ANDypeid in($ids) ";

48 if(
	g$idsql
==''è
$idsql
 = 
$gwh”e
;

50 if(
	g$£Éime
==1)

52 
$t1
 = 
G‘MkTime
(
$¡ime
);

53 
	g$t2
 = 
G‘MkTime
(
$‘ime
);

54 
	g$idsql
 .= " And (senddate >= $t1 And senddate <= $t2) ";

56 if(
is£t
(
$t1
è&& 
	$is_num”ic
(
$t1
))

58 
$idsql
 .= " And senddate >= $t1 ";

59 
	}
}

62 if(
	g$tÙ®num
==0)

64 
$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__arctiny` $idsql");

65 
	g$tÙ®num
 = 
$row
['dd'];

67 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arccache` ");

71 if(
	g$tÙ®num
 > 
	g$¡¬tdd
+
	g$·gesize
)

73 
	g$lim™Sql
 = " LIMIT $startdd,$pagesize";

76 
	g$lim™Sql
 = " LIMIT $¡¬tdd,".(
$tÙ®num
 - 
$¡¬tdd
);

79 
	g$tjnum
 = 
$¡¬tdd
;

80 if(
em±y
(
$s¡ime
)è
	g$s¡ime
 = 
time
();

83 if(
	g$tÙ®num
 > 500 && 
	$em±y
(
$ty³id
))

85 
$dsql
->
	`Execu‹
('out',"SELECT id FROM `#@__arctiny` $idsql ORDER BYypeid ASC $limitSql");

86 
	}
} {

87 
	g$dsql
->
Execu‹
('out',"SELECT id FROM `#@__arctiny` $idsql $limitSql");

89 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

91 if(
$£rv™”m
!="")

93 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$£rv™”m
);

94 
	g$cÚfig
 = 
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

95 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

97 
	g$cÚfig
=
¬¿y
();

99 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

102 
	g$row
=
$dsql
->
G‘Objeù
('out'))

104 
$tjnum
++;

105 
	g$id
 = 
$row
->
id
;

106 
	g$ac
 = 
Ãw
 
Archives
(
$id
);

107 
	g$ru¾
 = 
$ac
->
MakeHtml
(
$i¤emÙe
);

110 
	g$t2
 = 
ExecTime
();

111 
	g$t2
 = (
$t2
 - 
$e¡1
);

112 
	g$‰ime
 = 
time
(è- 
$s¡ime
;

113 
	g$‰ime
 = 
numb”_fÜm©
((
$‰ime
 / 60),2);

116 
	g$tjËn
 = 
$tÙ®num
>0 ? 
û
Ğ(
$tjnum
/$totalnum) * 100 ) : 100;

117 
	g$dvËn
 = 
$tjËn
 * 2;

118 
	g$tj¡a
 = "<div style='width:200;height:15;border:1px solid #898989;text-align:left'><div style='width:$dvlen;height:15;background-color:#829D83'></div></div>";

119 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1"è
$tj¡a
 .= "<br/><font color='red'>æ‚¨å·²å¼€å¯è¿œç¨‹å‘å¸ƒåŠŸèƒ½,ç”Ÿæˆé€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢,è¯·æ‚¨è€å¿ƒç­‰å¾…..</font>";

120 
	g$tj¡a
 .ğ"<br/>æœ¬æ¬¡ç”¨æ—¶ï¼š".
numb”_fÜm©
(
$t2
,2)."ï¼Œæ€»ç”¨æ—¶ï¼š$‰imåˆ†é’Ÿï¼Œåˆ°è¾¾ä½ç½®ï¼š".(
	g$¡¬tdd
+
	g$·gesize
)."<br/>å®Œæˆåˆ›å»ºæ–‡ä»¶æ€»æ•°çš„ï¼š$tjlen %ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡...";

132 if(
	g$tjnum
 < 
	g$tÙ®num
)

134 
	g$nu¾
 = "makehtml_archives_action.php?endid=$endid&startid=$startid&typeid=$typeid";

135 
	g$nu¾
 .ğ"&tÙ®num=$tÙ®num&¡¬tdd=".(
$¡¬tdd
+
$·gesize
)."&pagesize=$pagesize";

136 
	g$nu¾
 .ğ"&£Éime=$£Éime&s¡ime=$s¡ime&¡ime=".
u¾’code
(
$¡ime
)."&‘ime=".u¾’code(
$‘ime
)."&uptype=$uptype&mkvalue=$mkvalue&isremote={$isremote}&serviterm={$serviterm}";

137 
ShowMsg
(
$tj¡a
,
$nu¾
,0,100);

138 
ex™
();

142 if(
	g$ty³id
!='')

144 
ShowMsg
("ç”Ÿæˆæ–‡ä»¶ï¼š$totalnum æ€»ç”¨æ—¶ï¼š{$ttime} åˆ†é’Ÿï¼Œç°è½¬å‘å½“å‰æ ç›®æ›´æ–°&gt;&gt;","makehtml_list_action.php?typeid=$typeid&uptype=all&maxpagesize=50&upnext=1&isremote={$isremote}&serviterm={$serviterm}");

148 if(
	g$u±y³
=='')

150 
ShowMsg
("å®Œæˆæ‰€æœ‰åˆ›å»ºä»»åŠ¡ï¼ï¼Œç”Ÿæˆæ–‡ä»¶ï¼š$totalnum æ€»ç”¨æ—¶ï¼š{$ttime} åˆ†é’Ÿã€‚","javascript:;");

152 
ShowMsg
("å®Œæˆæ–‡æ¡£HTMLæ›´æ–°ä»»åŠ¡ï¼Œç°åœ¨å¼€å§‹è¿›è¡Œä¸»é¡µæ›´æ–°...","makehtml_all.php?action=make&step=3&uptype=$uptype&mkvalue=$mkvalue");

	@E:\web\weixun\xakadmin\makehtml_freelist.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKADMIN
."/templets/makehtml_freelist.htm");

	@E:\web\weixun\xakadmin\makehtml_freelist_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
»quœe_Úû
(
XAKINC
."/arc.freelist.class.php");

10 if(
em±y
(
$¡¬tid
)è
	g$¡¬tid
 = 0;

11 
	g$ci
 = "‡id >= $startid ";

12 if(!
em±y
(
$’did
è&& 
	g$’did
>=
$¡¬tid
)

14 
$ci
 .= " And‡id <= $endid ";

16 
h—d”
("Content-Type:ext/html; charset={$cfg_soft_lang}");

17 
	g$dsql
->
S‘Qu”y
("Select‡id From #@__freelist where $ci");

18 
	g$dsql
->
Execu‹
();

19 
	g$row
=
$dsql
->
	$G‘A¼ay
())

21 
$idA¼ay
[] = 
$row
['aid'];

22 
	}
}

23 if(!
is£t
(
$·g’o
)è
	g$·g’o
=0;

24 if(
em±y
(
$idA¼ay
)è
	g$idA¼ay
 = '';

25 
	g$tÙ®·ge
 = 
couÁ
(
$idA¼ay
);

26 if(
	$is£t
(
$idA¼ay
[
$·g’o
]))

28 
$lid
 = 
$idA¼ay
[
$·g’o
];

29 
	}
} {

30 
ShowMsg
( "å®Œæˆæ‰€æœ‰æ–‡ä»¶åˆ›å»ºï¼", 'javascript:;');

31 
ex™
();

33 
	g$lv
 = 
Ãw
 
F»eLi¡
(
$lid
);

34 
	g$ÁÙ®·ge
 = 
$lv
->
TÙ®Page
;

35 if(
em±y
(
$mk·ge
)è
	g$mk·ge
 = 1;

36 if(
em±y
(
$max·gesize
)è
	g$max·gesize
 = 50;

39 if(
	g$ÁÙ®·ge
<=
$max·gesize
)

41 
$lv
->
MakeHtml
();

42 
	g$fšishTy³
 = 
Œue
;

45 
	g$lv
->
MakeHtml
(
$mk·ge
,
$max·gesize
);

46 
	g$fšishTy³
 = 
çl£
;

47 
	g$mk·ge
 = 
$mk·ge
 + 
$max·gesize
;

48 ifĞ
	g$mk·ge
 >ğ(
$ÁÙ®·ge
+1) )

50 
$fšishTy³
 = 
Œue
;

53 
	g$lv
->
Clo£
();

54 
	g$Ãxage
 = 
$·g’o
+1;

55 if(
	g$Ãxage
==
$tÙ®·ge
)

57 
ShowMsg
( "å®Œæˆæ‰€æœ‰æ–‡ä»¶åˆ›å»ºï¼", 'javascript:;');

61 if(
	g$fšishTy³
)

63 
	g$gou¾
 = "makehtml_freelist_action.php?maxpagesize=$maxpagesize&startid=$startid&endid=$endid&pageno=$nextpage";

64 
ShowMsg
("æˆåŠŸåˆ›å»ºåˆ—è¡¨ï¼š".
$tid
."ï¼Œç»§ç»­è¿›è¡Œæ“ä½œï¼",
$gou¾
,0,100);

68 
	g$gou¾
 = "makehtml_freelist_action.php?mkpage=$mkpage&maxpagesize=$maxpagesize&startid=$startid&endid=$endid&pageno=$pageno";

69 
ShowMsg
("åˆ—è¡¨ï¼š".
$tid
."ï¼Œç»§ç»­è¿›è¡Œæ“ä½œ...",
$gou¾
,0,100);

72 
	g$dsql
->
Execu‹NÚeQu”y
("Update `#@__freelist` set‚odefault='1' where‡id='$startid';");

	@E:\web\weixun\xakadmin\makehtml_homepage.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
	g$dİo¡
=="view")

14 
$pv
 = 
Ãw
 
P¬tV›w
();

15 
	g$‹m¶‘
 = 
¡r_»¶aû
("{¡yË}",
$cfg_df_¡yË
,
$‹m¶‘
);

16 
	g$pv
->
S‘Tem¶‘
(
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/".
$‹m¶‘
);

17 
	g$pv
->
Di¥Ïy
();

18 
ex™
();

20 if(
	g$dİo¡
=="make")

22 
$»mÙ•os
 = 
em±y
($remotepos)? '/index.html' : $remotepos;

23 
	g$i¤emÙe
 = 
em±y
(
$i¤emÙe
)? 0 : $isremote;

24 
	g$£rv™”m
 = 
em±y
(
$£rv™”m
)? "" : $serviterm;

25 
	g$homeFe
 = 
XAKADMIN
."/".
$pos™iÚ
;

26 
	g$homeFe
 = 
¡r_»¶aû
("\\","/",
$homeFe
);

27 
	g$homeFe
 = 
¡r_»¶aû
("//","/",
$homeFe
);

28 
	g$å
 = 
fİ’
(
$homeFe
,"w"è
Ü
 
d›
("ä½ æŒ‡å®šçš„æ–‡ä»¶åæœ‰é—®é¢˜ï¼Œæ— æ³•åˆ›å»ºæ–‡ä»¶");

29 
fşo£
(
$å
);

30 if(
	g$§ve£t
==1)

32 
$iqu”y
 = "UPDATE `#@__homepageset` SETemplet='$templet',position='$position' ";

33 
	g$dsql
->
Execu‹NÚeQu”y
(
$iqu”y
);

36 ià(
	g$showmod
 == 1)

39 
$‹m¶‘
 = 
¡r_»¶aû
("{¡yË}", 
$cfg_df_¡yË
, $templet);

40 
	g$pv
 = 
Ãw
 
P¬tV›w
();

41 
	g$GLOBALS
['_arclistEnv'] = 'index';

42 
	g$pv
->
S‘Tem¶‘
(
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/".
$‹m¶‘
);

43 
	g$pv
->
SaveToHtml
(
$homeFe
);

44 
	gecho
 "æˆåŠŸæ›´æ–°ä¸»é¡µHTMLï¼š".
	g$homeFe
."<br /><a href='{$position}'arget='_blank'>æµè§ˆ...</a><br />";

47 ià(
fe_exi¡s
(
$homeFe
)è@
uÆšk
($homeFile);

48 
	gecho
 "é‡‡ç”¨åŠ¨æ€æµè§ˆæ¨¡å¼ï¼š<a href='../index.php'arget='_blank'>æµè§ˆ...</a><br />";

51 
	g$iqu”y
 = "UPDATE `#@__homepageset` SET showmod='$showmod'";

52 
	g$dsql
->
Execu‹NÚeQu”y
(
$iqu”y
);

54 if(
	g$£rv™”m
 =="")

56 
$cÚfig
=
¬¿y
();

58 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',',
$£rv™”m
);

59 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

60 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

63 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$showmod
==1)

65 if(
$áp
->
cÚÃù
(
$cÚfig
è&& 
$i¤emÙe
 == 1)

67 if(
$áp
->
u¶ßd
(
$pos™iÚ
, 
$»mÙ•os
, 'ascii')è
echo
 "è¿œç¨‹å‘å¸ƒæˆåŠŸ!"."<br />";

70 
ex™
();

72 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__homepageset");

73 
šşude
 
XAKINClude
('templets/makehtml_homepage.htm');

	@E:\web\weixun\xakadmin\makehtml_js.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
šşude
 
XAKINClude
('templets/makehtml_js.htm');

	@E:\web\weixun\xakadmin\makehtml_js_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

10 if(
em±y
(
$ty³id
)è
	g$ty³id
 = 0;

12 
	g$i¤emÙe
 = 
em±y
(
$i¤emÙe
)? 0 : $isremote;

13 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

14 if(
em±y
(
$‹m¶‘
)è
	g$‹m¶‘
 = "module/js.htm";

15 if(
em±y
(
$u±y³
)è
	g$u±y³
 = "all";

17 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

19 if(
$£rv™”m
!="")

21 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',',
$£rv™”m
);

22 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

23 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

25 
	g$cÚfig
=
¬¿y
();

27 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

29 if(
	g$u±y³
 == "all")

31 
$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM #@__arctype WHERE id>'$typeid' AND ispart<>2 ORDER BY id ASC LIMIT 0,1;");

32 if(!
is_¬¿y
(
$row
))

34 
	gecho
 "å®Œæˆæ‰€æœ‰æ–‡ä»¶æ›´æ–°ï¼";

35 
ex™
();

37 
	g$pv
 = 
Ãw
 
P¬tV›w
(
$row
['id']);

38 
	g$pv
->
S‘Tem¶‘
(
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/".
$‹m¶‘
);

39 
	g$pv
->
SaveToHtml
(
$cfg_ba£dœ
.
$cfg_cm¥©h
."/cÚfig/js/".
$row
['id'].".js",
$i¤emÙe
);

40 
	g$ty³id
 = 
$row
['id'];;

41 
ShowMsg
("æˆåŠŸæ›´æ–°".
$cfg_cm¥©h
."/cÚfig/js/".
$row
['id'].".jsï¼Œç»§ç»­è¿›è¡Œæ“ä½œï¼","makehtml_js_action.php?typeid=$typeid&isremote=$isremote&serviterm=$serviterm",0,100);

42 
ex™
();

45 
	g$pv
 = 
Ãw
 
P¬tV›w
(
$ty³id
);

46 
	g$pv
->
S‘Tem¶‘
(
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/".
$‹m¶‘
);

47 
	g$pv
->
SaveToHtml
(
$cfg_ba£dœ
.
$cfg_cm¥©h
."/cÚfig/js/".
$ty³id
.".js",
$i¤emÙe
);

48 
	gecho
 "æˆåŠŸæ›´æ–°".
	g$cfg_cm¥©h
."/cÚfig/js/".
	g$ty³id
.".jsï¼";

49 
	gecho
 "é¢„è§ˆï¼š";

50 
	gecho
 "<hr>";

51 
	gecho
 "<süˆ¤c='".
	g$cfg_cm¥©h
."/cÚfig/js/".
	g$ty³id
.".js'></script>";

52 
ex™
();

	@E:\web\weixun\xakadmin\makehtml_list.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
šşude
 
XAKINClude
('templets/makehtml_list.htm');

	@E:\web\weixun\xakadmin\makehtml_list_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

10 
»quœe_Úû
(
XAKINC
."/channelunit.func.php");

12 if(!
is£t
(
$u²ext
)è
	g$u²ext
 = 1;

13 if(
em±y
(
$gÙy³
)è
	g$gÙy³
 = '';

14 if(
em±y
(
$·g’o
)è
	g$·g’o
 = 0;

15 if(
em±y
(
$mk·ge
)è
	g$mk·ge
 = 1;

16 if(
em±y
(
$ty³id
)è
	g$ty³id
 = 0;

17 if(!
is£t
(
$uµage
)è
	g$uµage
 = 0;

18 if(
em±y
(
$max·gesize
)è
	g$max·gesize
 = 50;

19 
	g$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

21 
	g$i¤emÙe
 = (
em±y
(
$i¤emÙe
) ? 0 : $isremote);

22 
	g$£rv™”m
 = 
em±y
(
$£rv™”m
)? "" : $serviterm;

26 if(
	g$gÙy³
=='' || 
$gÙy³
=='mkallct')

28 if(
$u²ext
==1 || 
$ty³id
==0)

30 if(
$ty³id
>0)

32 
$tidss
 = 
G‘SÚIds
(
$ty³id
,0);

33 
	g$idA¼ay
 = 
ex¶ode
(',',
$tidss
);

35 
fÜ—ch
(
$cfg_Cs
 
as
 
$k
=>
$v
è
$idA¼ay
[] = $k;

38 
	g$idA¼ay
 = 
¬¿y
();

39 
	g$idA¼ay
[] = 
$ty³id
;

43 if(
	g$gÙy³
=='mkall')

45 
$uµage
 = 1;

46 
	g$mkÿchefe
 = 
XAKDATA
."/mkall_cache_{$adminID}.php";

47 
	g$idA¼ay
 = 
¬¿y
();

48 if(
fe_exi¡s
(
$mkÿchefe
)è
»quœe_Úû
($mkcachefile);

52 
	g$tÙ®·ge
=
couÁ
(
$idA¼ay
);

53 if(
	$is£t
(
$idA¼ay
[
$·g’o
]))

55 
$tid
 = 
$idA¼ay
[
$·g’o
];

56 
	}
}

59 if(
	g$gÙy³
=='')

61 
ShowMsg
("å®Œæˆæ‰€æœ‰åˆ—è¡¨æ›´æ–°ï¼","javascript:;");

62 
ex™
();

64 if(
	g$gÙy³
=='mk®l' || 
$gÙy³
=='mkallct')

66 
ShowMsg
("å®Œæˆæ‰€æœ‰æ ç›®åˆ—è¡¨æ›´æ–°ï¼Œç°åœ¨ä½œæœ€åæ•°æ®ä¼˜åŒ–ï¼","makehtml_all.php?action=make&step=10");

67 
ex™
();

71 if(
	g$·g’o
==0 && 
$mk·ge
==1)

73 
$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__arccache` ");

76 
	g$»u¾
 = '';

79 if(!
	$em±y
(
$tid
))

81 if(!
	`is£t
(
$cfg_Cs
[
$tid
]))

83 
	`showmsg
('æ²¡æœ‰è¯¥æ ç›®æ•°æ®, å¯èƒ½ç¼“å­˜æ–‡ä»¶(/config/cache/inc_catalog_base.inc)æ²¡æœ‰æ›´æ–°, è¯·æ£€æŸ¥æ˜¯å¦æœ‰å†™å…¥æƒé™');

84 
	`ex™
();

86 if(
$cfg_Cs
[
$tid
][1]>0)

88 
	`»quœe_Úû
(
XAKINC
."/arc.listview.class.php");

89 
$lv
 = 
Ãw
 
	`Li¡V›w
(
$tid
);

90 
$pos™iÚ
ğ
	`MfTy³dœ
(
$lv
->
F›lds
['typedir']);

94 
	`»quœe_Úû
(
XAKINC
."/arc.sglistview.class.php");

95 
$lv
 = 
Ãw
 
	`SgLi¡V›w
(
$tid
);

98 if(
$lv
->
Ty³Lšk
->
Ty³Infos
['i¥¬t']==0 && $lv->Ty³Lšk->Ty³Infos['isdeçuÉ']!=-1è
$ÁÙ®·ge
 = $lv->
TÙ®Page
;

99 
$ÁÙ®·ge
 = 1;

100 if(
$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

102 if(
$£rv™”m
!="")

104 
	`li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
	`ex¶ode
(',',
$£rv™”m
);

105 
$cÚfig
 = 
	`¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

106 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

108 
$cÚfig
=
	`¬¿y
();

110 if(!
$áp
->
	`cÚÃù
(
$cÚfig
)è
	`ex™
('Error:None FTP Connection!');

113 if(
$ÁÙ®·ge
 <ğ
$max·gesize
 || 
$lv
->
Ty³Lšk
->
Ty³Infos
['ispart']!=0 || $lv->TypeLink->TypeInfos['isdefault']==-1)

115 
$»u¾
 = 
$lv
->
	`MakeHtml
('', '', 
$i¤emÙe
);

116 
$fšishTy³
 = 
TRUE
;

120 
$»u¾
 = 
$lv
->
	`MakeHtml
(
$mk·ge
, 
$max·gesize
, 
$i¤emÙe
);

121 
$fšishTy³
 = 
FALSE
;

122 
$mk·ge
 = $mk·g+ 
$max·gesize
;

123 ifĞ
$mk·ge
 >ğ(
$ÁÙ®·ge
+1èè
$fšishTy³
 = 
TRUE
;

125 
	}
}

127 
	g$Ãxage
 = 
$·g’o
+1;

128 if(
	g$Ãxage
 >ğ
$tÙ®·ge
 && 
$fšishTy³
)

130 if(
$gÙy³
=='')

132 if(
em±y
(
$»u¾
)è{ $»u¾ = '../moduË/li¡.php?tid='.
$tid
; }

133 
ShowMsg
("å®Œæˆæ‰€æœ‰æ ç›®åˆ—è¡¨æ›´æ–°ï¼<a href='$reurl'arget='_blank'>æµè§ˆæ ç›®</a>","javascript:;");

134 
ex™
();

136 if(
	g$gÙy³
=='mk®l' || 
$gÙy³
=='mkallct')

138 
ShowMsg
("å®Œæˆæ‰€æœ‰æ ç›®åˆ—è¡¨æ›´æ–°ï¼Œç°åœ¨ä½œæœ€åæ•°æ®ä¼˜åŒ–ï¼","makehtml_all.php?action=make&step=10");

139 
ex™
();

142 if(
	g$fšishTy³
)

144 
	g$gou¾
 = "makehtml_list_action.php?gotype={$gotype}&uppage=$uppage&maxpagesize=$maxpagesize&typeid=$typeid&pageno=$nextpage&isremote={$isremote}&serviterm={$serviterm}";

145 
ShowMsg
("æˆåŠŸåˆ›å»ºæ ç›®ï¼š".
$tid
."ï¼Œç»§ç»­è¿›è¡Œæ“ä½œï¼",
$gou¾
,0,100);

146 
ex™
();

148 
	g$gou¾
 = "makehtml_list_action.php?gotype={$gotype}&uppage=$uppage&mkpage=$mkpage&maxpagesize=$maxpagesize&typeid=$typeid&pageno=$pageno&isremote={$isremote}&serviterm={$serviterm}";

149 
ShowMsg
("æ ç›®ï¼š".
$tid
."ï¼Œç»§ç»­è¿›è¡Œæ“ä½œ...",
$gou¾
,0,100);

150 
ex™
();

	@E:\web\weixun\xakadmin\makehtml_map.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/sitemap.class.php");

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

11 if(
	$em±y
(
$dİo¡
))

13 
	`ShowMsg
("å‚æ•°é”™è¯¯!","-1");

14 
	`ex™
();

15 
	}
}

16 
	g$i¤emÙe
 = 
em±y
(
$i¤emÙe
)? 0 : $isremote;

17 
	g$£rv™”m
=
em±y
(
$£rv™”m
)? "" : $serviterm;

18 
	g$sm
 = 
Ãw
 
S™eM­
();

19 
	g$m­li¡
 = 
$sm
->
G‘S™eM­
(
$dİo¡
);

20 if(
	g$dİo¡
=="site")

22 
$mu¾
 = 
$cfg_cm¥©h
."/config/sitemap.html";

23 
	g$tmpfe
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/module/sitemap.htm";

27 
	g$mu¾
 = 
$cfg_cm¥©h
."/config/rssmap.html";

28 
	g$tmpfe
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
."/module/rssmap.htm";

30 
	g$d
 = 
Ãw
 
XakTagP¬£
();

31 
	g$d
->
LßdTem¶‘
(
$tmpfe
);

32 
	g$d
->
SaveTo
(
$cfg_ba£dœ
.
$mu¾
);

33 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
 == 1)

35 if(
$£rv™”m
!="")

37 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$£rv™”m
);

38 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

39 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

41 
	g$cÚfig
=
¬¿y
();

43 ifĞ
	g$áp
->
cÚÃù
(
$cÚfig
) )

46 
	g$»mÙefe
 = 
$mu¾
;

47 
	g$loÿlfe
 = '..'.
$»mÙefe
;

48 
	g$»mÙedœ
 = 
´eg_»¶aû
('#[^\/]*\.html#', '', 
$»mÙefe
);

49 
	g$áp
->
rmkdœ
(
$»mÙedœ
);

50 if(
	g$áp
->
u¶ßd
(
$loÿlfe
, 
$»mÙefe
, 'acii')è
	gecho
 "è¿œç¨‹å‘å¸ƒæˆåŠŸ!"."<br />";

53 
	g$d
->
CË¬
();

54 
	gecho
 "<a href='$murl'arget='_blank'>æˆåŠŸæ›´æ–°æ–‡ä»¶: $murl æµè§ˆ...</a>";

55 
ex™
();

	@E:\web\weixun\xakadmin\makehtml_map_guide.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
šşude
 
XAKINClude
('templets/makehtml_map_guide.htm');

	@E:\web\weixun\xakadmin\makehtml_rss.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
šşude
 
XAKINClude
('templets/makehtml_rss.htm');

	@E:\web\weixun\xakadmin\makehtml_rss_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
»quœe_Úû
(
XAKINC
."/arc.rssview.class.php");

10 
	g$i¤emÙe
 = 
em±y
(
$i¤emÙe
)? 0 : $isremote;

11 
	g$£rv™”m
 = 
em±y
(
$£rv™”m
)? "" : $serviterm;

13 if(
em±y
(
$tid
)è
	g$tid
 = 0;

14 if(
em±y
(
$max»cÜd
)è
	g$max»cÜd
 = 50;

16 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

18 if(
$£rv™”m
!="")

20 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$£rv™”m
);

21 
	g$cÚfig
 = 
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

22 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

24 
	g$cÚfig
=
¬¿y
();

26 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

28 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__arctype` WHERE id>'$tid' AND ispart<>2 ORDER BY id ASC LIMIT 0,1;");

29 if(!
	$is_¬¿y
(
$row
))

31 
echo
 "å®Œæˆæ‰€æœ‰æ–‡ä»¶æ›´æ–°ï¼";

32 
	}
} {

33 
	g$rv
 = 
Ãw
 
RssV›w
(
$row
['id'],
$max»cÜd
);

34 
	g$rssu¾
 = 
$rv
->
MakeRss
(
$i¤emÙe
);

35 
	g$tid
 = 
$row
['id'];

36 
ShowMsg
("æˆåŠŸæ›´æ–°".
$rssu¾
."ï¼Œç»§ç»­è¿›è¡Œæ“ä½œï¼","makehtml_rss_action.php?tid=$tid&maxrecord=$maxrecord&isremote=$isremote&serviterm={$serviterm}",0,100);

	@E:\web\weixun\xakadmin\makehtml_spec.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
	g$i¤emÙe
 = 
em±y
(
$i¤emÙe
)? 0 : $isremote;

10 
	g$£rv™”m
 = 
em±y
(
$£rv™”m
)? "" : $serviterm;

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

13 if(
	g$dİo¡
=="ok")

15 
»quœe_Úû
(
XAKINC
."/arc.specview.class.php");

16 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$i¤emÙe
=="1")

18 if(
$£rv™”m
!="")

20 
li¡
(
$£rvu¾
,
$£rvu£r
,
$£rvpwd
èğ
ex¶ode
(',',
$£rv™”m
);

21 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

22 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

24 
	g$cÚfig
=
¬¿y
();

26 if(!
	g$áp
->
cÚÃù
(
$cÚfig
)è
ex™
('Error:None FTP Connection!');

28 
	g$¥
 = 
Ãw
 
S³cV›w
();

29 
	g$ru¾
 = 
$¥
->
MakeHtml
(
$i¤emÙe
);

30 
	gecho
 "æˆåŠŸç”Ÿæˆæ‰€æœ‰ä¸“é¢˜HTMLåˆ—è¡¨ï¼<a href='$rurl'arget='_blank'>é¢„è§ˆ</a>";

31 
ex™
();

33 
šşude
 
XAKINClude
('templets/makehtml_spec.htm');

	@E:\web\weixun\xakadmin\makehtml_story.php

1 <?
php


13 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

14 
»quœe_Úû
(
XAKROOT
.'/book/include/story.view.class.php');

15 
CheckPurv›w
('sys_MakeHtml');

16 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

17 if(
em±y
(
$¡¬tid
)è
	g$¡¬tid
 = 0;

20 if(
	g$aùiÚ
=='make')

22 if(
em±y
(
$¡¬t
)) $start = 0;

23 
	g$addqu”y
 = " bid>='$startid' ";

24 if(!
em±y
(
$’did
è&& 
	g$’did
>
	g$¡¬tid
 ) 
	g$addqu”y
 .= " And bid<='$endid' ";

25 if(!
em±y
(
$ÿtid
)è
	g$addqu”y
 .= " And (catid='$catid' Or bcatid='$catid') ";

26 if(
em±y
(
$mak’um
)è
	g$mak’um
 = 50;

27 
	g$dsql
->
S‘Qu”y
("Select SQL_CALC_FOUND_ROWS bid From #@__story_books where $addquery†imit $start,$makenum ");

28 
	g$dsql
->
Execu‹
();

29 
	g$n
 = 0;

30 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT FOUND_ROWS()‡s dd ");

31 
	g$lim™row
 = 
$row
['dd'];

32 
	g$row
 = 
$dsql
->
G‘Objeù
()){

33 
$¡¬t
++;

34 
	g$bv
 = 
Ãw
 
BookV›w
(
$row
->
bid
,'book');

35 
	g$¬tU¾
 = 
$bv
->
MakeHtml
(
çl£
);

39 if(
	g$¡¬t
>=
$lim™row
){

40 
ShowMsg
("å®Œæˆæ‰€æœ‰HTMLçš„æ›´æ–°ï¼","javascript:;");

43 
	g$hasMake
 = 
$lim™row
 - 
$¡¬t
;

44 if(
	g$lim™row
>0è
	g$´İÜtiÚ
 = 100 - 
û
((
$hasMake
 / 
$lim™row
) * 100);

45 
ShowMsg
("å·²æ›´æ–°è‡³ï¼š{$proportion}% ç»§ç»­æ›´æ–°å…¶å®ƒå†…å®¹...","makehtml_story.php?start={$start}&action=make&startid={$startid}&endid={$endid}&catid={$catid}&makenum={$makenum}");

47 
ex™
();

50 
	g$dsql
->
S‘Qu”y
("Select id,classname,pid,rank,booktype From #@__story_catalog order by„ank‡sc");

51 
	g$dsql
->
Execu‹
();

52 
	g$¿nks
 = 
A¼ay
();

53 
	g$bty³s
 = 
A¼ay
();

54 
	g$¡y³s
 = 
A¼ay
();

55 
	g$bookty³s
 = 
A¼ay
();

56 
	g$row
 = 
$dsql
->
	$G‘A¼ay
()){

57 if(
$row
['pid']==0è
$bty³s
[$row['id']] = $row['classname'];

58 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

59 
$¿nks
[
$row
['id']] = $row['rank'];

60 if(
$row
['bookty³']=='0'è
$bookty³s
[$row['id']] = 'å°è¯´';

61 
$bookty³s
[
$row
['id']] = 'æ¼«ç”»';

62 
	}
}

63 
	g$Ï¡id
 = 
$row
['id'];

65 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/makehtml_story.htm");

	@E:\web\weixun\xakadmin\makeremote_all.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_MakeHtml');

9 
»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

11 if(
	g$cfg_»mÙe_s™e
=='N'è
ex™
('Error:$cfg_remote_site is OFF,Check it!');

14 if(
fe_exi¡s
(
XAKDATA
.'/config.file.inc.php'))

16 
»quœe_Úû
(
XAKDATA
.'/config.file.inc.php');

19 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

21 
	g$¡•
 = !
is£t
(
$¡•
)? 1 : $step;

22 
	g$¡a
 = !
is£t
(
$¡a
)? 0 : $sta;

23 
	g$tÙ®num
 = !
is£t
(
$tÙ®num
)? 0 : $totalnum;

24 
	g$mak‘y³
 = 
em±y
(
$mak‘y³
)? '' : $maketype;

27 
funùiÚ
 
	$G‘S‹
(
$v®
)

29 
$cŞÜ
 = (
$v®
 == 0)? 'red' : 'green';

30 
$sigÃr
 = (
$v®
 == 0)? 'æœªåŒæ­¥' : 'å·²åŒæ­¥';

31  '<fÚˆcŞÜ="'.
$cŞÜ
.'">'.
$sigÃr
.'</font>';

32 
	}
}

35 
funùiÚ
 
addDœ
(
$fedœ
='', 
$desütiÚ
='', 
$df£rv
=0, 
$¡©e
=0, 
$issy¡em
=0)

37  
¬¿y
(

38 'fedœ' => 
$fedœ
,

39 'desütiÚ' => 
$desütiÚ
,

40 'df£rv' => 
$df£rv
,

41 '¡©e' => 
$¡©e
,

42 'issy¡em' => 
$issy¡em


47 
funùiÚ
 
makeCÚfig
(
$dœ¬¿y
=
	$¬¿y
())

49 
$cÚfig_¡r
 = '';

50 
	`fÜ—ch
(
$dœ¬¿y
 
as
 
$k
 => 
$v®
)

52 
$cÚfig_¡r
 .ğ'$»mÙefe['.
$k
.'] =‡rray('."\n";

53 
$cÚfig_¡r
 .ğ' \'fedœ\'=>\''.
$v®
['filedir']."',\n";

54 
$cÚfig_¡r
 .ğ' \'desütiÚ\'=>\''.
$v®
['description']."',\n";

55 
$cÚfig_¡r
 .ğ' \'df£rv\'=>'.
$v®
['dfserv'].",\n";

56 
$cÚfig_¡r
 .ğ' \'¡©e\'=>'.
$v®
['state'].",\n";

57 
$cÚfig_¡r
 .ğ' \'issy¡em\'=>'.
$v®
['issystem']."\n";

58 
$cÚfig_¡r
 .= ");\n";

60  (
$cÚfig_¡r
 == '')? '' : $config_str;

61 
	}
}

64 
funùiÚ
 
g‘Dœs
(
$dœeùÜy
,
$exem±
 = 
¬¿y
('.','..','.ds_¡Üe','.svn'),&
$fes
 = 
	$¬¿y
())

67 if(
	`is_dœ
(
$dœeùÜy
è&& !
	`İ’dœ
($dœeùÜy)è
	`mkdœ
($dœeùÜy,0777,
TRUE
);

68 
$hªdË
 = 
	`İ’dœ
(
$dœeùÜy
);

70 
çl£
 !=ğ(
$»sourû
 = 
	`»addœ
(
$hªdË
)))

72 if(!
	`š_¬¿y
(
	`¡¹Şow”
(
$»sourû
),
$exem±
))

75 if(
	`is_dœ
(
$dœeùÜy
.
$»sourû
.'/'))

77 
	`¬¿y_m”ge
(
$fes
,

78 
	`g‘Dœs
(
$dœeùÜy
.
$»sourû
.'/',
$exem±
,
$fes
));

82 
$fes
[] = 
$dœeùÜy
.'/'.
$»sourû
;

87 
	`şo£dœ
(
$hªdË
);

88  
$fes
;

89 
	}
}

91 
funùiÚ
 
upd©eCÚfig
(
$dœ¬¿y
=
	$¬¿y
())

94 
$cÚfigfe
 = 
XAKDATA
.'/config.file.inc.php';

95 
$Şd_cÚfig
 = @
	`fe_g‘_cÚ‹Ás
(
$cÚfigfe
);

96 
$cÚfig_¡r
 = 
	`makeCÚfig
(
$dœ¬¿y
);

98 
$Ãw_cÚfig
 = 
	`´eg_»¶aû
("/#<s_cÚfig>(.*)#<e_cÚfig>/s", "#<s_cÚfig>\n\n{$cÚfig_¡r}#<e_cÚfig>", 
$Şd_cÚfig
);

99 
	`fe_put_cÚ‹Ás
(
$cÚfigfe
, 
$Ãw_cÚfig
);

100 
	}
}

102 if(
	g$dİo¡
 == '')

109 if(
$dİo¡
 == 'updateremote')

111 
$dœbox
 = 
¬¿y
();

113 
	g$qu”y
 = "SELECT id,typedir,ispart FROM #@__arctype WHERE ispart <> '3'";

114 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

115 
	g$dsql
->
Execu‹
('al');

116 
	g$dœ¬¿y
 = 
¬¿y
();

118 
	g$i
 = 0;

119 
	g$row
 = 
$dsql
->
G‘A¼ay
("al"))

121 
$d¬¿y
 = 
ex¶ode
('/', 
´eg_»¶aû
('/{cm¥©h}/', '', 
$row
['typedir']));

123 if(!
š_¬¿y
(
$d¬¿y
[1], 
$dœbox
))

125 
	g$dœ¬¿y
[
$i
] = 
addDœ
('/'.
$d¬¿y
[1], 'æ–‡æ¡£HTMLé»˜è®¤ä¿å­˜è·¯', 0, 0, 1);

126 
	g$dœbox
[] = 
$d¬¿y
[1];

127 
	g$i
++;

131 
	g$dœ¬¿y
[
$i
++] = 
addDœ
(
$cfg_medŸs_dœ
, 'å›¾ç‰‡/ä¸Šä¼ æ–‡ä»¶é»˜è®¤è·¯å¾„', 0, 0, 1);

133 
	g$dœ¬¿y
[
$i
++] = 
addDœ
('/special', 'ä¸“é¢˜ç›®å½•', 0, 0, 1);

135 
	g$dœ¬¿y
[
$i
++] = 
addDœ
('/config/js', 'ç”Ÿæˆjsç›®å½•', 0, 0, 1);

138 
fÜ—ch
 (
$»mÙefe
 
as
 
$key
 => 
$v®ue
)

141 if(
$v®ue
['issystem'] == 0)

143 
$dœ¬¿y
[
$i
++] = 
addDœ
(
$v®ue
['filedir'], $value['description'],

144 
$v®ue
['dfserv'], $value['state'], $value['issystem']);

148 
upd©eCÚfig
(
$dœ¬¿y
);

150 
ShowMsg
("æˆåŠŸæ›´æ–°åŒæ­¥ç›®å½•,è¯·é‡æ–°å¯¹ç›®å½•è¿›è¡ŒåŒæ­¥æ“ä½œ!","makeremote_all.php");

151 
	gex™
;

156 if(
	g$dİo¡
 == 'make')

158 if(
$¡•
 == 1)

160 if(
$mak‘y³
 == 'makeall')

163 
fÜ—ch
(
$»mÙefe
 
as
 
$key
 => 
$v®
)

165 
$I‹rm
[] = 
$v®
['filedir'];

169 
	g$I‹rm
 = !
is£t
(
$I‹rm
)? 
¬¿y
(): $Iterm;

172 
	g$£rv™”m
 = !
is£t
(
$£rv™”m
)? 
¬¿y
(): $serviterm;

173 
	g$ÿcheMakeFe
 = 
XAKDATA
.'/cache/filelist.inc.php';

174 
	g$dœli¡
 = 
$®Îi¡
 = 
$updœ
 = 
¬¿y
();

175 
	g$dœšdex
 = 0;

180 if(
couÁ
(
$I‹rm
) > 0)

183 
fÜ—ch
(
$I‹rm
 
as
 
$key
 => 
$v®
)

185 
$cÚfig
 = 
$£rv™”m
[
$key
];

186 if(
is_¬¿y
(
$dœli¡
 = 
g‘Dœs
(
XAKROOT
.
$v®
)))

188 
fÜ—ch
(
$dœli¡
 
as
 
$k
 => 
$v
)

190 
$®Îi¡
[] = 
$v
.'|'.
$cÚfig
;

191 if(!
š_¬¿y
(
$v®
, 
¬¿y_v®ues
(
$updœ
))è
	g$updœ
[] = $val;

197 
	g$ÿche¡r
 = "<?php \n global \$dirlist,\$upremote;\n \$dirlist=array();\n";

198 
fÜ—ch
(
$®Îi¡
 
as
 
$key
 => 
$v®
)

200 
li¡
(
$f’ame
,
$fecÚfig
èğ
ex¶ode
('|', 
$v®
);

201 if(
is_dœ
(
$f’ame
))

203 
	g$d“pDœ
 = 
g‘Dœs
(
$f’ame
);

204 
	g$dd
 = 0;

206 
fÜ—ch
(
$d“pDœ
 
as
 
$k
 => 
$v
)

208 if(
is_dœ
(
$v
)è
$dd
++;

210 if(
	g$dd
 > 3)

213 
fÜ—ch
(
$d“pDœ
 
as
 
$k
 => 
$v
)

215 
$v
 .ğ'|'.
$fecÚfig
;

216 
	g$ÿche¡r
 .= " \$dirlist['$dirindex']='$v';\n";

217 
	g$dœšdex
++;

220 
	g$ÿche¡r
 .= " \$dirlist['$dirindex']='$val';\n";

221 
	g$dœšdex
++;

226 
fÜ—ch
(
$updœ
 
as
 
$key
 => 
$v®
)

228 
$ÿche¡r
 .= " \$upremote['$key']='$val';\n";

230 
	g$ÿche¡r
 .= "?>";

231 
fe_put_cÚ‹Ás
(
$ÿcheMakeFe
, 
$ÿche¡r
);

232 
	g$Šum
 = 
couÁ
(
$®Îi¡
);

233 
ShowMsg
("æˆåŠŸè·å–è¿œç¨‹åˆ—è¡¨,ä¸‹é¢è¿›è¡Œæ–‡ä»¶è¿œç¨‹å‘å¸ƒ!","makeremote_all.php?dopost=make&step=2&sta=1&totalnum=$tnum");

234 
	gex™
;

236 
	gecho
 'æ‚¨æ²¡æœ‰é€‰æ‹©,è¯·å…ˆé€‰æ‹©å†ç‚¹å‡»æ›´æ–°!';

238 
	gex™
;

239 } 
–£if
 (
$¡•
 == 2)

241 if(
fe_exi¡s
(
XAKDATA
.'/cache/filelist.inc.php'))

243 
»quœe_Úû
(
XAKDATA
.'/cache/filelist.inc.php');

245 if(
is_¬¿y
(
$dœli¡
))

247 if(
	g$¡a
 > 0 && $¡¨< 
	g$tÙ®num
)

249 
li¡
(
$dœÇme
, 
$ápcÚfig
èğ
ex¶ode
('|', 
$dœli¡
[
$¡a
-1]);

250 
li¡
(
$£rvu¾
, 
$£rvu£r
, 
$£rvpwd
èğ
ex¶ode
(',', 
$ápcÚfig
);

251 
	g$cÚfig
=
¬¿y
Ğ'ho¡Çme' => 
$£rvu¾
, 'u£ºame' => 
$£rvu£r
,

252 '·sswÜd' => 
$£rvpwd
,'debug' => 'TRUE');

253 if(
	g$áp
->
cÚÃù
(
$cÚfig
))

256 if(
is_dœ
(
$dœÇme
))

259 
	g$»mÙedœ
 = 
¡r_»¶aû
(
XAKROOT
, '', 
$dœÇme
).'/';

260 
	g$loÿldœ
 = '..'.
$»mÙedœ
.'/';

261 
	g$áp
->
rmkdœ
(
$»mÙedœ
);

262 ifĞ
	g$áp
->
mœrÜ
(
$loÿldœ
, 
$»mÙedœ
))

264 
	g$¡a
++;

265 
ShowMsg
("æˆåŠŸåŒæ­¥æ–‡ä»¶å¤¹$remotedir,è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡","makeremote_all.php?dopost=make&step=2&sta={$sta}&totalnum=$totalnum");

266 
	gex™
;

269 
	g$»mÙefe
 = 
¡r_»¶aû
(
XAKROOT
, '', 
$dœÇme
);

270 
	g$loÿlfe
 = '..'.
$»mÙefe
;

272 
	g$»mÙedœ
 = 
´eg_»¶aû
('/[^\/]*\.(\w){0,}/', '', 
$»mÙefe
);

275 
	g$»mÙebox
 = 
¬¿y
();

276 
	g$áp
->
rmkdœ
(
$»mÙedœ
);

277 
fÜ—ch
(
$dœli¡
 
as
 
$key
 => 
$v®
)

279 
li¡
(
$f’ame
,
$fecÚfig
èğ
ex¶ode
('|', 
$v®
);

280 if(
´eg_»¶aû
('/[^\/]*\.(\w){0,}/', '', 
¡r_»¶aû
(
XAKROOT
, '', 
$f’ame
)è=ğ
$»mÙedœ
)

283 
$»mÙebox
[] = 
$key
;

288 if(
couÁ
(
$»mÙebox
) > 1)

291 
	g$loÿldœ
 = '..'.
$»mÙedœ
;

292 ifĞ
	g$áp
->
mœrÜ
(
$loÿldœ
, 
$»mÙedœ
))

294 
	g$¡a
 = 
’d
(
$»mÙebox
) + 1;

295 
ShowMsg
("æˆåŠŸåŒæ­¥æ–‡ä»¶å¤¹$remotedir,è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡","makeremote_all.php?dopost=make&step=2&sta={$sta}&totalnum=$totalnum");

296 
	gex™
;

299 ifĞ
	g$áp
->
u¶ßd
(
$loÿlfe
, 
$»mÙefe
) )

301 
	g$¡a
++;

302 
ShowMsg
("æˆåŠŸåŒæ­¥æ–‡ä»¶$remotefile,è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡","makeremote_all.php?dopost=make&step=2&sta={$sta}&totalnum=$totalnum");

303 
	gex™
;

310 
fÜ—ch
(
$»mÙefe
 
as
 
$key
 => 
$v®
)

312 if(
š_¬¿y
(
$v®
['fedœ'],
¬¿y_v®ues
(
$u´emÙe
)))

314 
$»mÙefe
[
$key
]['state'] = 1;

317 
upd©eCÚfig
(
$»mÙefe
);

318 @
uÆšk
(
XAKDATA
.'/cache/filelist.inc.php');

319 
	gecho
 'å…¨éƒ¨åŒæ­¥å®Œæ¯•!';
	gex™
;

322 
ex™
('Error:None„emote cache fileƒxist!');

324 
	gex™
;

327 
šşude
 
XAKINClude
('templets/makeremote_all.htm');

	@E:\web\weixun\xakadmin\media_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

13 if(
	g$dİo¡
=="upload")

15 
»quœe_Úû
(
XAKINC
."/image.func.php");

16 
	g$¥¬r_image
 = 
A¼ay
("image/pjpeg","image/jpeg","image/gif","image/png","image/x-png","image/xpng","image/wbmp");

17 
	g$¥¬r_æash
 = 
A¼ay
("application/xshockwaveflash");

18 
	g$okdd
 = 0;

19 
	g$u±ime
 = 
time
();

20 
	g$admšid
 = 
$cu£rLogš
->
g‘U£rID
();

21 
	g$width
 = 
$height
 = '';

25 
	g$i
=0; $i<=40; $i++)

27 if(
is£t
(
$
{"upfe".
$i
}è&& 
is_u¶ßded_fe
(${"upfile".$i}))

29 
	g$fesize
 = 
$
{"upfe".
$i
."_size"};

30 
	g$upfe_ty³
 = 
$
{"upfe".
$i
."_type"};

31 
	g$upfe_Çme
 = 
$
{"upfe".
$i
."_name"};

32 
	g$d·th
 = 
MyD©e
("ymd", 
$u±ime
);

34 if(
š_¬¿y
(
$upfe_ty³
, 
$¥¬r_image
))

36 
	g$medŸty³
 = 1;

37 
	g$§veP©h
 = 
$cfg_image_dœ
."/".
$d·th
;

39 if(
š_¬¿y
(
$upfe_ty³
, 
$¥¬r_æash
)){

40 
	g$medŸty³
 = 2;

41 
	g$§veP©h
 = 
$cfg_Ùh”_medŸs
."/".
$d·th
;

44 if(
´eg_m©ch
('#audio|medŸ|video#i', 
$upfe_ty³
è&&…»g_m©ch("#\.".
$cfg_medŸty³
."$#i", 
$upfe_Çme
))

46 
	g$medŸty³
=3;

47 
	g$§veP©h
 = 
$cfg_Ùh”_medŸs
."/".
$d·th
;

49 if(
´eg_m©ch
("#\.".
$cfg_soáty³
."+\.".$cfg_soáty³."$#i", 
$upfe_Çme
))

51 
	g$medŸty³
=4;

52 
	g$§veP©h
 = 
$cfg_soá_dœ
."/".
$d·th
;

58 
	g$f’ame
 = "{$admšid}_".
MyD©e
("His",
$u±ime
).
mt_¿nd
(100,999).
	g$i
;

59 
	g$fs
 = 
ex¶ode
(".",
$
{"upfe".
$i
."_name"});

60 
	g$f’ame
 = 
$f’ame
.".".
$fs
[
couÁ
($fs)-1];

61 
	g$f’ame
 = 
$§veP©h
."/".
$f’ame
;

62 if(!
is_dœ
(
$cfg_ba£dœ
.
$§veP©h
))

64 
MkdœAÎ
(
$cfg_ba£dœ
.
$§veP©h
,777);

65 
Clo£F
();

67 
	g$fuÎf’ame
 = 
$cfg_ba£dœ
.
$f’ame
;

68 if(
	g$medŸty³
==1)

70 @
move_u¶ßded_fe
(
$
{"upfe".
$i
}, 
$fuÎf’ame
);

71 
	g$šfo
 = '';

72 
	g$d©a
 = 
g‘Imagesize
(
$fuÎf’ame
, 
$šfo
);

73 
	g$width
 = 
$d©a
[0];

74 
	g$height
 = 
$d©a
[1];

75 if(
š_¬¿y
(
$upfe_ty³
, 
$cfg_phÙo_ty³Çmes
)è
W©”Img
(
$fuÎf’ame
, 'up');

79 @
move_u¶ßded_fe
(
$
{"upfe".
$i
}, 
$fuÎf’ame
);

81 if(
	g$i
>1)

83 
	g$Á™Ë
 = 
$t™Ë
."_".
$i
;

87 
	g$Á™Ë
 = 
$t™Ë
;

89 
	g$šqu”y
 = "INSERT INTO `#@__uploads`(title,url,mediatype,width,height,playtime,filesize,uptime,mid)

90 
VALUES
 ('$ntitle','$filename','$mediatype','$width','$height','$playtime','$filesize','$uptime','$adminid'); ";

91 
	g$okdd
++;

92 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

95 
ShowMsg
("æˆåŠŸä¸Šä¼  {$okdd} ä¸ªæ–‡ä»¶ï¼","media_main.php");

96 
ex™
();

98 
šşude
 
XAKINClude
('templets/media_add.htm');

	@E:\web\weixun\xakadmin\media_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

10 
CheckPurv›w
('sys_Upload,sys_MyUpload');

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 
	g$backu¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "javascript:history.go(-1);";

17 if(
	g$dİo¡
=='del')

19 
CheckPurv›w
('sys_DelUpload');

20 if(
em±y
(
$ids
))

22 
	g$ids
="";

24 if(
	g$ids
=="")

26 
$myrow
 = 
$dsql
->
G‘OÃ
("SELECT u¾ FROM #@__u¶ßd WHERE‡id='".
$aid
."'");

27 
	g$Œuefe
 = 
$cfg_ba£dœ
.
$myrow
['url'];

28 
	g$rs
 = 0;

29 if(!
fe_exi¡s
(
$Œuefe
)||
	g$myrow
['url']=="")

31 
$rs
 = 1;

33 
	g$rs
 = @
uÆšk
(
$Œuefe
);

35 if(
	g$cfg_»mÙe_s™e
=='Y')

37 if(
$áp
->
cÚÃù
(
$ápcÚfig
è&& 
$»mÙeu¶ßds
 == 1)

39 
$»mÙefe
 = 
¡r_»¶aû
(
XAKROOT
, '', 
$Œuefe
);

40 
	g$áp
->
d–‘e_fe
(
$»mÙefe
);

44 if(
	g$rs
==1)

46 
$msg
 = "æˆåŠŸåˆ é™¤ä¸€ä¸ªé™„ä»¶ï¼";

47 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__u¶ßd WHERE‡id='".
$aid
."'");

49 
ShowMsg
(
$msg
,
$backu¾
);

50 
ex™
();

52 
	g$ids
 = 
ex¶ode
(',', 
$ids
);

53 
	g$idqu”y
 = "";

54 
fÜ—ch
(
$ids
 
as
 
$aid
)

56 if(
	g$idqu”y
=="")

58 
$idqu”y
 .= " WHERE‡id='$aid' ";

62 
	g$idqu”y
 .= " OR‡id='$aid' ";

65 
	g$dsql
->
S‘Qu”y
("SELECT‡id,url FROM #@__uploads $idquery ");

66 
	g$dsql
->
Execu‹
();

69 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

71 
$áp
->
cÚÃù
(
$ápcÚfig
);

73 
	g$myrow
=
$dsql
->
G‘A¼ay
())

75 
$Œuefe
 = 
$cfg_ba£dœ
.
$myrow
['url'];

76 
	g$rs
 = 0;

77 if(!
fe_exi¡s
(
$Œuefe
è|| 
	g$myrow
['url']=="")

79 
$rs
 = 1;

83 
	g$rs
 = @
uÆšk
(
$Œuefe
);

84 if(
	g$cfg_»mÙe_s™e
=='Y' && 
$»mÙeu¶ßds
 == 1)

86 
$»mÙefe
 = 
¡r_»¶aû
(
XAKROOT
, '', 
$Œuefe
);

87 
	g$áp
->
d–‘e_fe
(
$»mÙefe
);

90 if(
	g$rs
==1)

92 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__u¶ßd WHERE‡id='".
$myrow
['aid']."'");

95 
ShowMsg
('æˆåŠŸåˆ é™¤é€‰å®šçš„æ–‡ä»¶ï¼',
$backu¾
);

96 
ex™
();

102 if(
	g$dİo¡
=='save')

104 if(
$aid
==""è
ex™
();

107 
	g$myrow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__u¶ßd WHERE‡id='".
$aid
."'");

108 if(
	g$myrow
['mid']!=
$cu£rLogš
->
g‘U£rID
())

110 
CheckPurv›w
('sys_Upload');

114 
	g$addqu”y
 = "";

115 if(
is_u¶ßded_fe
(
$upfe
))

117 if(
	g$medŸty³
==1)

119 
$¥¬r
 = 
A¼ay
("image/pjpeg","image/jpeg","image/gif","image/png","image/xpng","image/wbmp");

120 if(!
š_¬¿y
(
$upfe_ty³
,
$¥¬r
))

122 
ShowMsg
("ä½ ä¸Šä¼ çš„ä¸æ˜¯å›¾ç‰‡ç±»å‹çš„æ–‡ä»¶ï¼","javascript:history.go(-1);");

123 
ex™
();

126 if(
	g$medŸty³
==2)

128 
$¥¬r
 = 
A¼ay
("application/x-shockwave-flash");

129 if(!
š_¬¿y
(
$upfe_ty³
,
$¥¬r
))

131 
ShowMsg
("ä½ ä¸Šä¼ çš„ä¸æ˜¯Flashç±»å‹çš„æ–‡ä»¶ï¼","javascript:history.go(-1);");

132 
ex™
();

134 }if(
	g$medŸty³
==3)

136 if(!
´eg_m©ch
('#audio|medŸ|video#i', 
$upfe_ty³
))

138 
ShowMsg
("ä½ ä¸Šä¼ çš„ä¸ºä¸æ­£ç¡®ç±»å‹çš„å½±éŸ³æ–‡ä»¶ï¼","javascript:history.go(-1);");

139 
ex™
();

141 if(!
´eg_m©ch
("#\.".
$cfg_medŸty³
."#", 
$upfe_Çme
))

143 
ShowMsg
("ä½ ä¸Šä¼ çš„å½±éŸ³æ–‡ä»¶æ‰©å±•åæ— æ³•è¢«è¯†åˆ«ï¼Œè¯·æ›´æ”¹ç³»ç»Ÿé…ç½®çš„å‚æ•°ï¼","javascript:history.go(-1);");

144 
ex™
();

148 if(!
´eg_m©ch
("#\.".
$cfg_soáty³
."#", 
$upfe_Çme
))

150 
ShowMsg
("ä½ ä¸Šä¼ çš„é™„ä»¶æ‰©å±•åæ— æ³•è¢«è¯†åˆ«ï¼Œè¯·æ›´æ”¹ç³»ç»Ÿé…ç½®çš„å‚æ•°ï¼","javascript:history.go(-1);");

151 
ex™
();

156 
	g$nowtime
 = 
time
();

157 
	g$Şdfe
 = 
$myrow
['url'];

158 
	g$Şdfes
 = 
ex¶ode
('/', 
$Şdfe
);

159 
	g$fuÎf’ame
 = 
$cfg_ba£dœ
.
$Şdfe
;

160 
	g$Şdfe_·th
 = 
´eg_»¶aû
("#".
$Şdfes
[
couÁ
($Şdfes)-1]."$#", "", 
$Şdfe
);

161 if(!
is_dœ
(
$cfg_ba£dœ
.
$Şdfe_·th
))

163 
MkdœAÎ
(
$cfg_ba£dœ
.
$Şdfe_·th
, 777);

164 
Clo£F
();

166 @
move_u¶ßded_fe
(
$upfe
, 
$fuÎf’ame
);

167 if(
	g$medŸty³
==1)

169 
»quœe_Úû
(
XAKINC
."/image.func.php");

170 if(
š_¬¿y
(
$upfe_ty³
, 
$cfg_phÙo_ty³Çmes
))

172 
W©”Img
(
$fuÎf’ame
, 'up');

175 
	g$fesize
 = 
$upfe_size
;

176 
	g$imgw
 = 0;

177 
	g$imgh
 = 0;

178 if(
	g$medŸty³
==1)

180 
$šfo
 = "";

181 
	g$sizes
[0] = 0; $sizes[1] = 0;

182 
	g$sizes
 = @
g‘imagesize
(
$fuÎf’ame
, 
$šfo
);

183 
	g$imgw
 = 
$sizes
[0];

184 
	g$imgh
 = 
$sizes
[1];

186 if(
	g$imgw
>0)

188 
	g$addqu”y
 = ",width='$imgw',height='$imgh',filesize='$filesize' ";

192 
	g$addqu”y
 = ",filesize='$filesize' ";

197 
	g$feu¾
 = 
$f’ame
;

201 
	g$qu”y
 = " UPDATE #@__uploads SETitle='$title',mediatype='$mediatype',playtime='$playtime'";

202 
	g$qu”y
 .= "$addquery WHERE‡id='$aid' ";

203 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

204 
ShowMsg
('æˆåŠŸæ›´æ”¹ä¸€åˆ™é™„ä»¶æ•°æ®ï¼','medŸ_ed™.php?aid='.
$aid
);

205 
ex™
();

209 
	g$myrow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__u¶ßd WHERE‡id='".
$aid
."'");

210 if(!
	$is_¬¿y
(
$myrow
))

212 
	`ShowMsg
('é”™è¯¯ï¼Œæ‰¾ä¸åˆ°æ­¤ç¼–å·çš„æ¡£æ¡ˆï¼','javascript:;');

213 
	`ex™
();

214 
	}
}

215 
šşude
 
XAKINClude
('templets/media_edit.htm');

	@E:\web\weixun\xakadmin\media_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
»quœe_Úû
(
XAKINC
."/common.func.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

14 if(
	g$dİo¡
=='filemanager')

16 if(
fe_exi¡s
('./file_manage_main.php'))

18 
h—d”
("location:file_manage_main.php?activepath=$cfg_medias_dir");

22 
ShowMsg
("æ‰¾ä¸åˆ°æ–‡ä»¶ç®¡ç†å™¨ï¼Œå¯èƒ½å·²ç»å¸è½½!","-1");

24 
ex™
();

29 if(
em±y
(
$keywÜd
)è
	g$keywÜd
 = "";

30 
	g$addsql
 = " WHERE (u.title LIKE '%$keyword%' OR u.url LIKE '%$keyword%') ";

31 if(
	$em±y
(
$memb”ty³
))

33 
$memb”ty³
 = 0;

34 
	}
}

35 if(
	g$memb”ty³
==1)

37 
$addsql
 .= " AND u.mid>0 ";

39 if(
	g$memb”ty³
==2)

41 
$addsql
 .= " AND u.mid>0 ";

44 if(
	$em±y
(
$medŸty³
))

46 
$medŸty³
 = 0;

47 
	}
}

48 if(
	g$medŸty³
>1)

50 
	g$addsql
 .= " AND u.mediatype='$membertype' ";

52 
	g$sql
 = "SELECT u.aid,u.title,u.url,u.mediatype,u.filesize,u.mid,u.uptime

53 ,
	ga
.
u£rid
 
AS
 
	gadmšÇme
,
	gm
.u£rid AS 
memb”Çme


54 
	gFROM
 `#@
	g__u¶ßds
` 
u


55 
LEFT
 
	gJOIN
 `#@
	g__admš_li¡
` 
a
 
ON
 
	ga
.
	gid
 = 
u
.
mid


56 
LEFT
 
JOIN
 `#@
__memb”_li¡
` 
m
 
ON
 m.
mid
 = 
u
.mid

57 
$addsql
 
ORDER
 
BY
 
u
.
aid
 
DESC
";

58 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

59 
	g$dli¡
->
	g·geSize
 = 20;

60 
	g$dli¡
->
S‘P¬am‘”
("medŸty³",
$medŸty³
);

61 
	g$dli¡
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

62 
	g$dli¡
->
S‘P¬am‘”
("memb”ty³",
$memb”ty³
);

63 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/media_main.htm");

64 
	g$dli¡
->
S‘Sourû
(
$sql
);

65 
	g$dli¡
->
Di¥Ïy
();

67 
funùiÚ
 
	$MedŸTy³
(
$tid
,
$nu¾
)

69 if(
$tid
==1)

73 if(
$tid
==2)

77 if(
$tid
==3)

85 
	}
}

87 
funùiÚ
 
	$G‘FeSize
(
$fs
)

89 
$fs
 = $fs/1024;

90  
	`Œim
(
	`¥rštf
("%10.1f",
$fs
)." K");

91 
	}
}

93 
funùiÚ
 
	$U¶ßdAdmš
(
$admšid
,
$mid
)

95 if(
$admšid
!='')  $adminid;

96  
$mid
;

97 
	}
}

	@E:\web\weixun\xakadmin\member_do.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

10 if(
em±y
(
$fmdo
)è
	g$fmdo
 = '';

11 
	g$ENV_GOBACK_URL
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? 'member_main.php' : '';

17 if(
	g$dİo¡
=="delmember")

19 
CheckPurv›w
('member_Del');

20 if(
	g$fmdo
=='yes')

22 
$id
 = 
´eg_»¶aû
("#[^0-9]#", '', $id);

23 
	g$§ãcodeok
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
),0,24);

24 if(
	g$§ãcodeok
!=
$§ãcode
)

26 
ShowMsg
("è¯·å¡«å†™æ­£ç¡®çš„å®‰å…¨éªŒè¯ä¸²ï¼","member_do.php?id={$id}&dopost=delmember");

27 
ex™
();

29 if(!
em±y
(
$id
))

32 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE mid='$id' LIMIT 1 ");

33 
	g$rs
 = 0;

34 if(
	g$row
['matt'] == 10)

36 
$Äow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__admin_list` WHERE id='$id' LIMIT 1 ");

38 if(!
is_¬¿y
(
$Äow
)è
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y2
("DELETE FROM `#@__member_list` WHERE mid='$id' LIMIT 1");

42 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y2
("DELETE FROM `#@__member_list` WHERE mid='$id' LIMIT 1");

44 if(
	g$rs
 > 0)

46 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_tj` WHERE mid='$id' LIMIT 1");

47 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_space` WHERE mid='$id' LIMIT 1");

48 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_company` WHERE mid='$id' LIMIT 1");

49 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_person` WHERE mid='$id' LIMIT 1");

52 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_stow` WHERE mid='$id' ");

53 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_flink` WHERE mid='$id' ");

54 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_guestbook` WHERE mid='$id' ");

55 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_operation` WHERE mid='$id' ");

56 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_pms` WHEREoid='$id' Or fromid='$id' ");

57 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_friends` WHERE mid='$id' Or fid='$id' ");

58 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_vhistory` WHERE mid='$id' Or vid='$id' ");

59 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__feedback` WHERE mid='$id' ");

60 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__archives` SET mid='0' WHERE mid='$id'");

62 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php') {

63 
	g$šfoäomuc
=
uc_g‘_u£r
(
$row
['userid']);

64 
uc_u£r_d–‘e
(
$šfoäomuc
[0]);

66 #/
a
}}

70 
ShowMsg
("æ— æ³•åˆ é™¤æ­¤ä¼šå‘˜ï¼Œå¦‚æœè¿™ä¸ªä¼šå‘˜æ˜¯<b>[ç®¡ç†å‘˜]</b>ï¼Œ<b¸/>å¿…é¡»å…ˆåˆ é™¤è¿™ä¸ª<b>[ç®¡ç†å‘˜]</b>æ‰èƒ½åˆ é™¤æ­¤å¸å·ï¼", 
$ENV_GOBACK_URL
, 0, 5000);

71 
ex™
();

74 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªä¼šå‘˜ï¼",
$ENV_GOBACK_URL
);

75 
ex™
();

77 
	g$¿ndcode
 = 
mt_¿nd
(10000,99999);

78 
	g$§ãcode
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
),0,24);

79 
	g$wšt™Ë
 = "ä¼šå‘˜ç®¡ç†-åˆ é™¤ä¼šå‘˜";

80 
	g$wecome_šfo
 = "<¨h»f='".
$ENV_GOBACK_URL
."'>ä¼šå‘˜ç®¡ç†</a>::åˆ é™¤ä¼šå‘˜";

81 
	g$wš
 = 
Ãw
 
OxWšdow
();

82 
	g$wš
->
In™
("member_do.php","js/blank.js","POST");

83 
	g$wš
->
AddHidd’
("fmdo","yes");

84 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

85 
	g$wš
->
AddHidd’
("id",
$id
);

86 
	g$wš
->
AddHidd’
("¿ndcode",
$¿ndcode
);

87 
	g$wš
->
AddHidd’
("§ãcode",
$§ãcode
);

88 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦åˆ é™¤(ID:".
$id
.")è¿™ä¸ªä¼šå‘˜?");

89 
	g$wš
->
AddMsgI‹m
("å®‰å…¨éªŒè¯ä¸²ï¼š<input‚ame='safecode'ype='text' id='safecode' size='16' style='width:200px' />&nbsp;(å¤åˆ¶æœ¬ä»£ç ï¼š <font color='red'>$safecode</font> )","30");

90 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

91 
	g$wš
->
Di¥Ïy
();

92 }if(
	g$dİo¡
=="delmembers"){

93 
CheckPurv›w
('member_Del');

94 if(
	g$fmdo
=='yes')

96 
$§ãcodeok
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
),0,24);

97 if(
	g$§ãcodeok
!=
$§ãcode
)

99 
ShowMsg
("è¯·å¡«å†™æ­£ç¡®çš„å®‰å…¨éªŒè¯ä¸²ï¼","member_do.php?id={$id}&dopost=delmembers");

100 
ex™
();

102 if(!
em±y
(
$id
))

106 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y2
("DELETE FROM `#@__memb”_li¡` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") And matt<>10 ");

107 if(
	g$rs
 > 0)

109 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_tj` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

110 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_¥aû` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

111 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_com·ny` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

112 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_³rsÚ` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

115 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_¡ow` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

116 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_æšk` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

117 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_gue¡book` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

118 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_İ”©iÚ` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

119 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_pms` WHEREoid IN (".
¡r_»¶aû
("`",",",
$id
).") Or fromid IN (".str_replace("`",",",$id).") ");

120 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_ä›nds` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") Or fid IN (".str_replace("`",",",$id).") ");

121 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__memb”_vhi¡Üy` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") Or vid IN (".str_replace("`",",",$id).") ");

122 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__ãedback` WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).") ");

123 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__¬chives` SET mid='0' WHERE mid IN (".
¡r_»¶aû
("`",",",
$id
).")");

127 
ShowMsg
("æ— æ³•åˆ é™¤æ­¤ä¼šå‘˜ï¼Œå¦‚æœè¿™ä¸ªä¼šå‘˜æ˜¯ç®¡ç†å‘˜å…³è¿çš„IDï¼Œ<b¸/>å¿…é¡»å…ˆåˆ é™¤è¿™ä¸ªç®¡ç†å‘˜æ‰èƒ½åˆ é™¤æ­¤å¸å·ï¼",
$ENV_GOBACK_URL
,0,3000);

128 
ex™
();

131 
ShowMsg
("æˆåŠŸåˆ é™¤è¿™äº›ä¼šå‘˜ï¼",
$ENV_GOBACK_URL
);

132 
ex™
();

134 
	g$¿ndcode
 = 
mt_¿nd
(10000, 99999);

135 
	g$§ãcode
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
), 0, 24);

136 
	g$wšt™Ë
 = "ä¼šå‘˜ç®¡ç†-åˆ é™¤ä¼šå‘˜";

137 
	g$wecome_šfo
 = "<¨h»f='".
$ENV_GOBACK_URL
."'>ä¼šå‘˜ç®¡ç†</a>::åˆ é™¤ä¼šå‘˜";

138 
	g$wš
 = 
Ãw
 
OxWšdow
();

139 
	g$wš
->
In™
("member_do.php", "js/blank.js", "POST");

140 
	g$wš
->
AddHidd’
("fmdo", "yes");

141 
	g$wš
->
AddHidd’
("dİo¡", 
$dİo¡
);

142 
	g$wš
->
AddHidd’
("id",
$id
);

143 
	g$wš
->
AddHidd’
("¿ndcode", 
$¿ndcode
);

144 
	g$wš
->
AddHidd’
("§ãcode", 
$§ãcode
);

145 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦åˆ é™¤(ID:".
$id
.")è¿™ä¸ªä¼šå‘˜?");

146 
	g$wš
->
AddMsgI‹m
(" å®‰å…¨éªŒè¯ä¸²ï¼š<input‚ame='safecode'ype='text' id='safecode' size='16' style='width:200px' /> (å¤åˆ¶æœ¬ä»£ç ï¼š <font color='red'>$safecode</font>)","30");

147 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

148 
	g$wš
->
Di¥Ïy
();

154 ià(
	g$dİo¡
=="recommend")

156 
CheckPurv›w
('member_Edit');

157 
	g$id
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$id
);

158 if(
	g$m©t
==0)

160 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET matt=1 WHERE mid='$id' AND matt<>10 LIMIT 1");

161 
ShowMsg
("æˆåŠŸè®¾ç½®ä¸€ä¸ªä¼šå‘˜æ¨èï¼",
$ENV_GOBACK_URL
);

162 
ex™
();

166 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET matt=0 WHERE mid='$id' AND matt<>10 LIMIT 1");

167 
ShowMsg
("æˆåŠŸå–æ¶ˆä¸€ä¸ªä¼šå‘˜æ¨èï¼",
$ENV_GOBACK_URL
);

168 
ex™
();

175 ià(
	g$dİo¡
=='edituser')

177 
CheckPurv›w
('member_Edit');

178 if(!
is£t
(
$_POST
['id'])è
ex™
('Warning...');

180 
	g$pwdsql
 = 
em±y
(
$pwd
è? '' : ",pwd='".
PassJoš
($pwd)."'";

182 if(
em±y
(
$£x
)è
	g$£x
 = 'ç”·';

183 
	g$u±ime
=
G‘MkTime
(
$u±ime
);

185 if(
	g$m©t
==10 && 
$Şdm©t
!=10)

187 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä¸ºå®‰å…¨èµ·è§ï¼Œä¸æ”¯æŒç›´æ¥æŠŠå‰å°ä¼šå‘˜è½¬ä¸ºç®¡ç†çš„æ“ä½œï¼", "-1");

188 
ex™
();

190 
	g$qu”y
 = "UPDATE `#@__member_list` SET

191 
ema
 = '$email',

192 
	guÇme
 = '$uname',

193 
	g£x
 = '$sex',

194 
	gm©t
 = '$matt',

195 
	gmÚey
 = '$money',

196 
	gscÜes
 = '$scores',

197 
	g¿nk
 = '$rank',

198 
	g¥aû¡a
='$spacesta',

199 
	gu±ime
='$uptime',

200 
	gex±ime
='$exptime'

201 
$pwdsql


202 
WHERE
 
mid
='$id' 
AND
 
m©t
<>10 ";

203 
$rs
 = 
$dsql
->
Execu‹NÚeQu”y2
(
$qu”y
);

204 if(
	g$rs
==0)

206 
$qu”y
 = "UPDATE `#@__member_list` SET

207 
ema
 = '$email',

208 
	guÇme
 = '$uname',

209 
	g£x
 = '$sex',

210 
	gmÚey
 = '$money',

211 
	gscÜes
 = '$scores',

212 
	g¿nk
 = '$rank',

213 
	g¥aû¡a
='$spacesta',

214 
	gu±ime
='$uptime',

215 
	gex±ime
='$exptime'

216 
$pwdsql


217 
WHERE
 
mid
='$id' ";

218 
$rs
 = 
$dsql
->
Execu‹NÚeQu”y2
(
$qu”y
);

222 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/api/uc.func.php')

224 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `scores`,`userid` FROM `#@__member_list` WHERE `mid`='$id' AND `matt`<>10");

225 
	g$amouÁ
 = 
$scÜes
-
$row
['scores'];

226 
uc_üed™_nÙe
(
$row
['u£rid'],
$amouÁ
);

228 #/
a
}}

230 
ShowMsg
('æˆåŠŸæ›´æ”¹ä¼šå‘˜èµ„æ–™ï¼', 'memb”_v›w.php?id='.
$id
);

231 
ex™
();

237 ià(
	g$dİo¡
=="memberlogin")

239 
CheckPurv›w
('member_Edit');

240 
PutCook›
('XakU£rID',
$id
,1800);

241 
PutCook›
('XakLogšTime',
time
(),1800);

242 if(
em±y
(
$jumpu¾
)è
h—d”
("location:../user/index.php");

243 
h—d”
("location:$jumpurl");

244 } ià(
	g$dİo¡
 == "deoperations")

246 
$nid
 = 
´eg_»¶aû
('#[^0-9,]#', '',…reg_replace('#`#', ',', $nid));

247 
	g$nid
 = 
ex¶ode
(',', 
$nid
);

248 if(
is_¬¿y
(
$nid
))

250 
fÜ—ch
 (
$nid
 
as
 
$v¬
)

252 
	g$qu”y
 = "DELETE FROM `#@__member_operation` WHERE‡id = '$var'";

253 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

255 
ShowMsg
("åˆ é™¤æˆåŠŸï¼","member_operations.php");

256 
ex™
();

258 } ià(
	g$dİo¡
 == "upoperations")

260 
$nid
 = 
´eg_»¶aû
('#[^0-9,]#', '',…reg_replace('#`#', ',', $nid));

261 
	g$nid
 = 
ex¶ode
(',', 
$nid
);

262 if(
is_¬¿y
(
$nid
))

264 
fÜ—ch
 (
$nid
 
as
 
$v¬
)

266 
	g$qu”y
 = "UPDATE `#@__member_operation` SET sta = '1' WHERE‡id = '$var'";

267 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

268 
ShowMsg
("è®¾ç½®æˆåŠŸï¼","member_operations.php");

269 
ex™
();

272 } if(
	g$dİo¡
 == "okoperations")

274 
$nid
 = 
´eg_»¶aû
('#[^0-9,]#', '',…reg_replace('#`#', ',', $nid));

275 
	g$nid
 = 
ex¶ode
(',', 
$nid
);

276 if(
is_¬¿y
(
$nid
))

278 
fÜ—ch
 (
$nid
 
as
 
$v¬
)

280 
	g$qu”y
 = "UPDATE `#@__member_operation` SET sta = '2' WHERE‡id = '$var'";

281 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

282 
ShowMsg
("è®¾ç½®æˆåŠŸï¼","member_operations.php");

283 
ex™
();

	@E:\web\weixun\xakadmin\member_feed_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Log');

9 if(
	$em±y
(
$dİo¡
))

11 
	`ShowMsg
("ä½ æ²¡æŒ‡å®šä»»ä½•å‚æ•°ï¼","javascript:;");

12 
	`ex™
();

13 
	}
}

14 if(
em±y
(
$d–log
)è
	g$d–log
 = 0;

17 if(
	g$dİo¡
 == "clearcheck")

19 
$nowtime
 = 
time
();

20 
	g$¡¬‰ime
 = 
$nowtime
 - (24*3600);

21 
	g$’dtime
 =
$nowtime
 -(
$d–log
*24*3600);

22 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_feed` WHERE dtime BETWEEN $endtime AND $starttime ");

23 
ShowMsg
("æˆåŠŸæ¸…ç©ºè¿‡å»".
$d–log
."å¤©è®°å½•ï¼","member_info_main.php?type=feed");

24 
ex™
();

27 if(
	g$dİo¡
 == "clear")

29 
$dsql
->
Execu‹NÚeQu”y
("TRUNCATE TABLE `#@__member_feed` ");

30 
ShowMsg
("æˆåŠŸæ¸…ç©ºæ‰€æœ‰è®°å½•ï¼","memberlog_list.php");

31 
ex™
();

34 if(
	g$dİo¡
 == "del")

36 
$bku¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "member_feed_main.php";

37 
	g$ids
 = 
ex¶ode
('`', 
$ids
);

38 
	g$dqu”y
 = "";

39 
fÜ—ch
(
$ids
 
as
 
$id
)

41 if(
	g$dqu”y
==""è
$dqu”y
 .= " fid='$id' ";

42 
	g$dqu”y
 .= " OR fid='$id' ";

44 if(
	g$dqu”y
!=""è
$dqu”y
 = " WHERE ".$dquery;

45 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_feed` $dquery");

46 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„è®°å½•ï¼",
$bku¾
);

47 
ex™
();

50 if(
	g$dİo¡
=="check")

52 
$bku¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "member_feed_main.php";

53 
	g$ids
 = 
ex¶ode
('`', 
$ids
);

54 
	g$dqu”y
 = "";

55 
fÜ—ch
(
$ids
 
as
 
$id
)

57 if(
	g$dqu”y
==""è
$dqu”y
 .= " fid='$id' ";

58 
	g$dqu”y
 .= " OR fid='$id' ";

60 if(
	g$dqu”y
!=""è
$dqu”y
 = " WHERE ".$dquery;

61 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_feed` SET ischeck=1 $dquery");

62 
ShowMsg
("æˆåŠŸå®¡æ ¸æŒ‡å®šçš„è®°å½•ï¼",
$bku¾
);

63 
ex™
();

65 
ShowMsg
("æ— æ³•è¯†åˆ«ä½ çš„è¯·æ±‚ï¼","javascript:;");

66 
ex™
();

	@E:\web\weixun\xakadmin\member_guestbook.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_memberguestbook');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
»quœe_Úû
(
XAKINC
."/common.func.php");

11 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$dİo¡
 = 
em±y
(
$dİo¡
)? "" : $dopost;

13 
	g$uÇme
 = 
em±y
(
$uÇme
)? "" : $uname;

14 
	g$ways
 = 
em±y
(
$ways
)? "" : $ways;

16 
	g$sql
 = 
$wh”e
 = "";

17 
	g$mid
 = 
em±y
(
$mid
è? 0 : 
štv®
($mid);

18 if(
	g$mid
>0è
	g$wh”e
 .= "AND g.mid='$mid' ";

19 if(!
	g$uÇme
==''è
$wh”e
 .= "AND g.uname='$uname' ";

20 if(!
	g$ways
=='' && !
$body
=='')

22 
$body
 = 
´eg_»¶aû
 ("#^(ã€€| )+#i", '', $body);

23 
	g$body
 = 
´eg_»¶aû
 ("#(ã€€| )+$#i", '', 
$body
);

24 
	g$ways
) {

26 
$wh”e
 .="AND g.uname='$body'";

29 
$row
=
$dsql
->
G‘OÃ
("SELECT mid FROM `#@__member_list` WHERE userid='$body' LIMIT 1");

30 
	g$mid
=
$row
['mid'];

31 
	g$wh”e
 .="AND g.mid='$mid'";

34 
$wh”e
 .="AND g.msg LIKE '%$body%'";

40 if(
	g$dİo¡
=="del")

42 
$bku¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "member_guestbook.php";

43 
	g$ids
 = 
ex¶ode
('`',
$ids
);

44 
	g$dqu”y
 = "";

45 
fÜ—ch
(
$ids
 
as
 
$id
)

47 if(
	g$dqu”y
=="")

49 
$dqu”y
 .= "‡id='$id' ";

53 
	g$dqu”y
 .= " OR‡id='$id' ";

56 if(
	g$dqu”y
!=""è
$dqu”y
 = " WHERE ".$dquery;

57 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_guestbook` $dquery");

58 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„è®°å½•ï¼",
$bku¾
);

59 
ex™
();

63 ifĞ
	g$dİo¡
=="deluname" )

65 
$ids
 = 
´eg_»¶aû
("#[^0-9,]#i", ',', $ids);

66 
	g$dsql
->
S‘Qu”y
("SELECT uname FROM `#@__member_guestbook` WHERE‡id IN ($ids) ");

67 
	g$dsql
->
Execu‹
();

68 
	g$uÇmes
 = '';

69 
	g$row
 = 
$dsql
->
G‘A¼ay
())

71 
$uÇmes
 .= ($unames=='' ? " uname = '{$row['uname']}' " : " OR uname = '{$row['uname']}' ");

73 if(
	g$uÇmes
!='')

75 
$qu”y
 = "DELETE FROM `#@__member_guestbook` WHERE $unames ";

76 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

78 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šç›¸åŒç•™è¨€è€…çš„æ‰€æœ‰ç•™è¨€!",
$_COOKIE
['ENV_GOBACK_URL'],0,500);

79 
ex™
();

83 ifĞ
	g$dİo¡
=="delall" )

85 
$ids
 = 
´eg_»¶aû
("#[^0-9,]#i", ',', $ids);

86 
	g$dsql
->
S‘Qu”y
("SELECT ip FROM `#@__member_guestbook` WHERE‡id IN ($ids) ");

87 
	g$dsql
->
Execu‹
();

88 
	g$s
 = '';

89 
	g$row
 = 
$dsql
->
G‘A¼ay
())

91 
$s
 .= ($ips=='' ? " ip = '{$row['ip']}' " : " OR ip = '{$row['ip']}' ");

93 if(
	g$s
!='')

95 
$qu”y
 = "DELETE FROM `#@__member_guestbook` WHERE $ips ";

96 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

98 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šç›¸åŒIPçš„æ‰€æœ‰ç•™è¨€!",
$_COOKIE
['ENV_GOBACK_URL'],0,500);

99 
ex™
();

101 
	g$sql
 = "SELECT g.*,m.userid FROM `#@__member_guestbook` AS g LEFT JOIN `#@__member_list` AS m ON g.mid=m.mid WHERE 1=1 $where ORDER BY‡id DESC";

102 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

103 
	g$dli¡
->
	g·geSize
 = 20;

104 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/member_guestbook.htm");

105 
	g$dli¡
->
S‘Sourû
(
$sql
);

106 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\member_info_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Log');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
»quœe_Úû
(
XAKINC
."/common.func.php");

12 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

13 
	g$sql
 = 
$wh”e
 = "";

14 
	g$dtime
=(
em±y
(
$dtime
))? 0 : $dtime;

15 
	g$ischeck
=(
em±y
(
$ischeck
))? "" : $ischeck;

16 
	g$dİo¡
=(
em±y
(
$dİo¡
))? "" : $dopost;

18 if(
	g$ty³
=="feed")

20 
$bË
="#@__member_feed";

21 
	g$id
="aid";

22 
	g$l
=
XAKADMIN
."/templets/member_feed_main.htm";

24 
	g$bË
="`#@__member_msg`";

25 
	g$id
="id";

26 
	g$l
=
XAKADMIN
."/templets/member_mood_main.htm";

28 if(
š_¬¿y
(
$ischeck
, 
¬¿y
('-1', '1')))

30 
	g$ty³
 = 
¬¿y
('-1'=>'0', '1'=>'1');

31 if(
	g$dtime
>0)

33 
	g$nowtime
 = 
time
();

34 
	g$¡¬‰ime
 = 
$nowtime
 - (
$dtime
 * 24 * 3600);

35 
	g$wh”e
 .= " AND dtime>'$starttime' AND ischeck='$type[$ischeck]' ";

37 
	g$wh”e
 .= " AND ischeck='$type[$ischeck]' ";

39 } ià(
	g$dtime
>0)

41 
	g$nowtime
 = 
time
();

42 
	g$¡¬‰ime
 = 
$nowtime
 - (
$dtime
 * 24 * 3600);

43 
	g$wh”e
 .= " AND dtime>'$starttime' ";

44 } ià(
	g$dİo¡
=='pall')

46 
$wh”e
 .= " AND mid='$mid' ";

50 
funùiÚ
 
	$IsChecklog
(
$ischeck
)

52 
$s
 = '';

53 
$s
=(
$ischeck
=='1')? "<font color=blue>å·²å®¡æ ¸</font>" : "<font color=red>æœªå®¡æ ¸</font>";

54  
$s
;

55 
	}
}

57 
funùiÚ
 
	$J¡rimJajxLog
(
$¡r
,
$Ën
)

59 
$¡r
 = 
	`ú_sub¡r
($¡r,
$Ën
);

60 
$¡r
 = 
	`¡r_»¶aû
('&#039;', '"', $str);

61 
$¡r
 = 
	`¡r_»¶aû
('&lt;', '<', $str);

62 
$¡r
 = 
	`¡r_»¶aû
('&gt;', '>', $str);

63  
$¡r
;

64 
	}
}

66 
	g$row
=
$dsql
->
G‘OÃ
("SELECT COUNT($id) AS dd FROM $table");

67 
	g$tÙ®num
=
$row
['dd'];

68 
	g$rows
=
$dsql
->
G‘OÃ
("SELECT COUNT($id) AS dd FROM $table WHERE ischeck=1");

69 
	g$checknum
=
$rows
['dd'];

70 
	g$rowss
=
$dsql
->
G‘OÃ
("SELECT COUNT($id) AS dd FROM $table WHERE ischeck=0");

71 
	g$ischecknum
=
$rowss
['dd'];

72 
	g$sql
 = "SELECT * FROM $table WHERE 1=1 $where ORDER BY dtime DESC";

73 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

74 
	g$dli¡
->
	g·geSize
 = 20;

75 
	g$dli¡
->
S‘P¬am‘”
("ty³",
$ty³
);

76 
	g$dli¡
->
S‘P¬am‘”
("tÙ®num",
$tÙ®num
);

77 
	g$dli¡
->
S‘P¬am‘”
("checknum",
$checknum
);

78 
	g$dli¡
->
S‘P¬am‘”
("ischecknum",
$ischecknum
);

79 
	g$dli¡
->
S‘Tem¶©e
(
$l
);

80 
	g$dli¡
->
S‘Sourû
(
$sql
);

81 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\member_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_List');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 if(!
is£t
(
$£x
)è
	g$£x
 = '';

13 if(!
is£t
(
$mty³
)è
	g$mty³
 = '';

14 if(!
is£t
(
$¥aû¡a
)è
	g$¥aû¡a
 = -10;

15 if(!
is£t
(
$m©t
)è
	g$m©t
 = 10;

17 if(!
is£t
(
$keywÜd
)è
	g$keywÜd
 = '';

18 
	g$keywÜd
 = 
Œim
(
F‹rS—rch
(
$keywÜd
));

20 
	g$mty³fÜm
 = 
em±y
(
$mty³
) ? "<option value=''>ç±»å‹</option>\r\n" : "<option value='$mtype'>$mtype</option>\r\n";

21 
	g$£xfÜm
 = 
em±y
(
$£x
) ? "<option value=''>æ€§åˆ«</option>\r\n" : "<option value='$sex'>$sex</option>\r\n";

22 
	g$sÜtkey
 = 
em±y
(
$sÜtkey
è? 'mid' : 
´eg_»¶aû
("#[^a-z]#i",'',$sortkey);

24 
	g$¡aA¼
 = 
¬¿y
(-2=>'é™åˆ¶ç”¨æˆ·(ç¦è¨€)', -1=>'æœªé€šè¿‡å®¡æ ¸', 0=>'å®¡æ ¸é€šè¿‡ï¼Œæç¤ºå¡«å†™å®Œæ•´ä¿¡æ¯', 1=>'æ²¡å¡«å†™è¯¦ç»†èµ„æ–™', 2=>'æ­£å¸¸ä½¿ç”¨çŠ¶æ€');

25 
	g$¡aA¼m©t
 = 
¬¿y
(1=>'è¢«æ¨è', 0=>'éæ™®é€š ' );

26 
	g$Memb”Ty³s
 = 
¬¿y
();

27 
	g$dsql
->
S‘Qu”y
("Select„ank,membername From `#@__arcrank` where„ank>0 ");

28 
	g$dsql
->
Execu‹
();

29 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

31 
$Memb”Ty³s
[
$row
->
¿nk
] = $row->
memb”Çme
;

32 
	}
}

34 if(
	g$sÜtkey
=='mid')

36 
$sÜtfÜm
 = "<option value='mid'>mid/æ³¨å†Œæ—¶é—´</option>\r\n";

38 if(
	g$sÜtkey
=='rank')

40 
$sÜtfÜm
 = "<option value='rank'>ä¼šå‘˜ç­‰çº§</option>\r\n";

42 if(
	g$sÜtkey
=='money')

44 
$sÜtfÜm
 = "<option value='money'>ä¼šå‘˜é‡‘å¸</option>\r\n";

46 if(
	g$sÜtkey
=='scores')

48 
$sÜtfÜm
 = "<option value='scores'>ä¼šå‘˜ç§¯åˆ†</option>\r\n";

52 
	g$sÜtfÜm
 = "<option value='logintime'>ç™»å½•æ—¶é—´</option>\r\n";

55 
	g$wh”es
[] = " (userid LIKE '%$keyword%' OR uname LIKE '%$keyword%' ORƒmail LIKE '%$keyword%') ";

57 if(
	g$£x
 != '')

59 
$wh”es
[] = " sex LIKE '$sex' ";

62 if(
	g$mty³
 != '')

64 
$wh”es
[] = " mtype LIKE '$mtype' ";

67 if(
	g$¥aû¡a
 != -10)

69 
$wh”es
[] = " spacesta = '$spacesta' ";

72 if(
	g$m©t
 != 10)

74 
$wh”es
[] = " matt= '$matt' ";

77 
	g$wh”eSql
 = 
još
(' AND ',
$wh”es
);

78 if(
	g$wh”eSql
!='')

80 
$wh”eSql
 = ' WHERE '.$whereSql;

82 
	g$dsql
->
S‘Qu”y
("SELECT‚ame FROM `#@__member_model`");

83 
	g$dsql
->
Execu‹
();

84 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

86 
$Memb”Mod–s
[] = 
$row
;

87 
	}
}

88 
	g$sql
 = "SELECT * FROM `#@__member_list` $whereSql ORDER BY $sortkey DESC ";

89 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

90 
	g$dli¡
->
S‘P¬am‘”
('£x',
$£x
);

91 
	g$dli¡
->
S‘P¬am‘”
('¥aû¡a',
$¥aû¡a
);

92 
	g$dli¡
->
S‘P¬am‘”
('m©t',
$m©t
);

93 
	g$dli¡
->
S‘P¬am‘”
('mty³',
$mty³
);

94 
	g$dli¡
->
S‘P¬am‘”
('sÜtkey',
$sÜtkey
);

95 
	g$dli¡
->
S‘P¬am‘”
('keywÜd',
$keywÜd
);

96 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/member_main.htm");

97 
	g$dli¡
->
S‘Sourû
(
$sql
);

98 
	g$dli¡
->
di¥Ïy
();

100 
funùiÚ
 
	$G‘Memb”Name
(
$¿nk
,
$mt
)

102 
glob®
 
$Memb”Ty³s
;

103 if(
	`is£t
(
$Memb”Ty³s
[
$¿nk
]))

105 if(
$mt
=='ut'è " <fÚˆcŞÜ='»d'>å¾…å‡çº§ï¼š".
$Memb”Ty³s
[
$¿nk
]."</font>";

106  
$Memb”Ty³s
[
$¿nk
];

108 if(
$mt
=='ut')  '';

109  
$mt
;

111 
	}
}

113 
funùiÚ
 
	$G‘MA‰
(
$m
)

115 if(
$m
<1)  '';

116 if(
$m
==10)  "&nbsp;<font color='red'>[ç®¡ç†å‘˜]</font>";

118 
	}
}

	@E:\web\weixun\xakadmin\member_model_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_New');

9 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

10 
	g$mysql_v”siÚs
 = 
ex¶ode
(".", 
Œim
(
$mysql_v”siÚ
));

11 
	g$mysql_v”siÚ
 = 
$mysql_v”siÚs
[0].".".$mysql_versions[1];

12 if(
	$em±y
(
$aùiÚ
))

14 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT id FROM `#@__member_model` ORDER BY id DESC LIMIT 0,1 ");

15 if(
	`is_¬¿y
(
$row
)è
$Ãwid
 = $row['id']+1;

16 
$Ãwid
 = 1;

17 
	`šşude
(
XAKADMIN
."/templets/member_model_add.htm");

18 
	}
} {

19 if(
´eg_m©ch
("#[^0-9-]#", 
$id
è|| 
em±y
($id))

21 
ShowMsg
("<font color=red>'ä¼šå‘˜æ¨¡å‹ID'</font>å¿…é¡»ä¸ºæ•°å­—ï¼","-1");

22 
ex™
();

24 if(
	g$bË
=="")

26 
ShowMsg
("è¡¨åä¸èƒ½ä¸ºç©ºï¼","-1");

27 
ex™
();

29 
	g$¡©e
 = 
is£t
(
$¡©e
è&& 
is_num”ic
($state) ? $state : 0;

30 
	g$Çme
 = 
html¥ecŸlch¬s
(
$Çme
);

31 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$id' OR `table` LIKE '$table' OR‚ame LIKE '$name' ");

32 if(
is_¬¿y
(
$row
))

34 
ShowMsg
("å¯èƒ½ä¼šå‘˜æ¨¡å‹çš„â€˜IDâ€™ã€â€˜åç§°â€™åœ¨æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨ï¼","-1");

35 
ex™
();

37 
	g$qu”y
 = "SHOW TABLES FROM {$dsql->dbName} ";

38 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

39 
	g$dsql
->
Execu‹
();

40 
	g$row
 = 
$dsql
->
G‘A¼ay
())

42 if(
em±y
(
$row
[0])) $row[0] = '';

43 if(
	g$bË
 =ğ
$row
[0])

45 
ShowMsg
('æŒ‡å®šçš„è¡¨åœ¨æ•°æ®åº“ä¸­é‡å¤', '-1');

46 
ex™
();

49 
	g$sql
 = "CREATE TABLE IF NOT EXISTS `$table`(

50 `
mid
` (10è
NOT
 
NULL
 
auto_šüem’t
,

52 if(
	g$mysql_v”siÚ
 < 4.1){

53 
	g$sql
 .= " PRIMARY KEY (`mid`)\r\n) TYPE=MyISAM; ";

55 
	g$sql
 .ğ" PRIMARY KEY (`mid`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

57 if(
	g$dsql
->
ExecNÚeQu”y
(
$sql
)){

58 
	g$qu”y
 = "INSERT INTO `#@__member_model` (`id`, `name`, `table`, `description`, `issystem`, `state`) VALUES ('$id', '$name', '$table', '$description', 0, '$state')";

59 
	g$dsql
->
ExecNÚeQu”y
(
$qu”y
);

61 
UpD©eMemb”ModCache
();

62 
ShowMsg
('ä¼šå‘˜æ¨¡å‹åˆ›å»ºæˆåŠŸï¼Œè¯·è‡ªè¡Œæ·»åŠ å­—æ®µ', 'member_model_main.php');

64 
ShowMsg
('ä¼šå‘˜æ¨¡å‹åˆ›å»ºå¤±è´¥', '-1');

	@E:\web\weixun\xakadmin\member_model_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_Edit');

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
="";

13 
	g$id
 = (
em±y
(
$id
è? 0 : 
štv®
($id));

18 if(
	g$dİo¡
=="save")

20 
$¡©e
 = 
is£t
($¡©eè&& 
is_num”ic
($state) ? $state : 1;

21 
	g$desütiÚ
 = 
html¥ecŸlch¬s
(
$desütiÚ
);

22 
	g$Çme
 = 
html¥ecŸlch¬s
(
$Çme
);

23 
	g$qu”y
 = "UPDATE `#@__member_model` SET‚ame = '$name', description = '$description', state='$state' WHERE id='$id' ";

24 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

26 
UpD©eMemb”ModCache
();

27 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªä¼šå‘˜æ¨¡å‹ï¼", "member_model_main.php");

28 
ex™
();

33 if(
	g$dİo¡
=="disabled")

35 @
£t_time_lim™
(0);

36 
CheckPurv›w
('c_Del');

37 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$id'");

38 
	g$¡©’um
 = (
$row
['state']==0)? 1 : 0;

39 
	g$¡©e¡r
 = (
$row
['state']==0)? 'å¯ç”¨' : 'ç¦ç”¨';

41 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_model` SET state={$statenum} WHERE id='$id' ");

43 
UpD©eMemb”ModCache
();

44 
ShowMsg
("æˆåŠŸ{$statestr}ä¸€ä¸ªä¼šå‘˜æ¨¡å‹ï¼","member_model_main.php");

45 
ex™
();

50 if(
	g$dİo¡
=="copy")

52 @
£t_time_lim™
(0);

53 
CheckPurv›w
('c_Del');

54 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$id'");

55 
	g$thi¢ame
 = 
$row
['name'];

56 
	g$thi¡abË
 = 
$row
['table'];

57 
	g$thisšfo
 = 
$row
['info'];

58 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id From `#@__member_model` ORDER BY id DESC LIMIT 0,1 ");

59 if(
is_¬¿y
(
$row
)è
	g$Ãwid
 = $row['id'] + 1;

60 
	g$Ãwid
 = 1;

61 if(
em±y
(
$job
)è
	g$job
="";

64 if(
	g$job
=="")

66 
$wšt™Ë
 = "ä¼šå‘˜æ¨¡å‹ç®¡ç†-å¤åˆ¶ä¼šå‘˜æ¨¡å‹";

67 
	g$wecome_šfo
 = "<a href='member_model_main.php'>ä¼šå‘˜æ¨¡å‹ç®¡ç†</a>::å¤åˆ¶ä¼šå‘˜æ¨¡å‹";

68 
	g$wš
 = 
Ãw
 
OxWšdow
();

69 
	g$wš
->
In™
("member_model_edit.php","js/blank.js","POST");

70 
	g$wš
->
AddHidd’
("job","yes");

71 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

72 
	g$wš
->
AddHidd’
("id",
$id
);

73 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦å¤åˆ¶ \"".
$thi¢ame
."\" è¿™ä¸ªä¼šå‘˜æ¨¡å‹ï¼Ÿ");

74 
	g$msg
 ="";

75 
	g$msg
.="<table width='460' border='0' cellspacing='0' cellpadding='0'>\r\n";

76 
	g$msg
.="<tr>\r\n";

77 
	g$msg
.=" <td width='170' height='24'‡lign='center'>æ–°æ¨¡å‹IDï¼š</td>\r\n";

78 
	g$msg
.=" <td width='230'><input‚ame='newid'ype='text' id='newid' size='6' value='{$newid}'/></td>\r\n";

79 
	g$msg
.="</tr>\r\n";

80 
	g$msg
.="<tr>\r\n";

81 
	g$msg
.=" <td height='24'‡lign='center'>æ–°æ¨¡å‹åç§°ï¼š</td>\r\n";

82 
	g$msg
.=" <td><input‚ame='newname'ype='text' id='newname' value='{$thisname}{$newid}' style='width:250px'/></td>\r\n";

83 
	g$msg
.="</tr>\r\n";

84 
	g$msg
.="<tr>\r\n";

85 
	g$msg
.=" <td height='24'‡lign='center'>æ¨¡å‹æ•°æ®è¡¨ï¼š</td>\r\n";

86 
	g$msg
.=" <td><input‚ame='newtable'ype='text' id='newtable' value='{$thistable}{$newid}' style='width:250px'/></td>\r\n";

87 
	g$msg
.="</tr>\r\n";

88 
	g$msg
.="<tr>\r\n";

89 
	g$msg
.=" <td height='24'‡lign='center'>æ¨¡å‹å­—æ®µï¼š</td>\r\n";

90 
	g$msg
.=" <td><font color='red'>æ¨¡å‹å­—æ®µé»˜è®¤å·²ç»å¤åˆ¶,è¯·åœ¨ç¼–è¾‘å½“å‰æ¨¡å‹ä¸­æŸ¥çœ‹</font></td>\r\n";

91 
	g$msg
.="</tr>\r\n";

92 
	g$msg
.="<tr>\r\n";

93 
	g$msg
.=" <td height='24'‡lign='center'>æ–°æ¨¡å‹æè¿°ï¼š</td>\r\n";

94 
	g$msg
.=" <td><label>\r\n";

95 
	g$msg
.=" <textarea‚ame=\"description\" id=\"description\" cols=\"45\"„ows=\"5\" onClick=\"this.value=''\">æ–°æ¨¡å‹æè¿°</textarea>\r\n";

96 
	g$msg
.=" </label></td>\r\n";

97 
	g$msg
.="</tr>\r\n";

98 
	g$msg
.="<tr>\r\n";

99 
	g$msg
.=" <td height='24'‡lign='center'>æ¨¡å‹çŠ¶æ€ï¼š</td>\r\n";

100 
	g$msg
.=" <td><input‚ame='state'ype='radio' id='copytemplet' value='1' class='np' checked='checked'/>\r\n";

101 
	g$msg
.=" å¯ç”¨\r\n";

102 
	g$msg
.=" &nbsp;\r\n";

103 
	g$msg
.=" <input‚ame='state'ype='radio' id='copytemplet' class='np' value='0'/>\r\n";

104 
	g$msg
.=" ç¦ç”¨</td>\r\n";

105 
	g$msg
.="</tr>\r\n";

106 
	g$msg
.="</table>";

107 
	g$wš
->
AddMsgI‹m
("<div style='padding:20px;line-height:300%'>$msg</div>");

108 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

109 
	g$wš
->
Di¥Ïy
();

110 
ex™
();

114 if(
	g$job
=="yes")

116 if(
´eg_m©ch
("#[^0-9-]#", 
$Ãwid
è|| 
em±y
($newid))

118 
ShowMsg
("<font color=red>'ä¼šå‘˜æ¨¡å‹ID'</font>å¿…é¡»ä¸ºæ•°å­—ï¼","-1");

119 
ex™
();

121 if(
	g$ÃwbË
=="")

123 
ShowMsg
("è¡¨åä¸èƒ½ä¸ºç©ºï¼", "-1");

124 
ex™
();

126 
	g$¡©e
 = 
is£t
(
$¡©e
è&& 
is_num”ic
($state) ? $state : 0;

127 
	g$ÃwÇme
 = 
html¥ecŸlch¬s
(
$ÃwÇme
);

128 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$newid' OR `table` LIKE '$newtable' OR‚ame LIKE '$newname' ");

129 if(
is_¬¿y
(
$row
))

131 
ShowMsg
("å¯èƒ½ä¼šå‘˜æ¨¡å‹çš„â€˜IDâ€™ã€â€˜åç§°â€™åœ¨æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨ï¼","-1");

132 
ex™
();

135 if(!
	g$dsql
->
IsTabË
(
$ÃwbË
))

137 
	g$dsql
->
Execu‹
('me',"SHOW CREATE TABLE {$dsql->dbName}.{$thistable}");

138 
	g$row
 = 
$dsql
->
G‘A¼ay
('me', 
MYSQL_BOTH
);

139 
	g$bËSŒuù
 = 
$row
[1];

140 
	g$tb
 = 
¡r_»¶aû
('#@__', 
$cfg_db´efix
, 
$thi¡abË
);

141 
	g$bËSŒuù
 = 
´eg_»¶aû
("/CREATE TABLE `$thi¡abË`/iU","CREATE TABLE `$ÃwbË`",
$bËSŒuù
);

142 
	g$dsql
->
Execu‹NÚeQu”y
(
$bËSŒuù
);

144 
	g$qu”y
 = "INSERT INTO `#@__member_model` (`id`, `name`, `table`, `description`, `issystem`, `state`, `info`) VALUES ('$newid', '$newname', '$newtable', '$description', 0, '$state','$thisinfo')";

145 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

146 if(
	g$rs
)

148 
UpD©eMemb”ModCache
();

149 
ShowMsg
("æˆåŠŸå¤åˆ¶ä¼šå‘˜æ¨¡å‹ï¼Œç°è½¬åˆ°è¯¦ç»†å‚æ•°é¡µ... ","member_model_edit.php?id={$newid}&dopost=edit");

150 
ex™
();

154 
	g$”rv
 = 
$dsql
->
G‘E¼Ü
();

155 
ShowMsg
("ç³»ç»Ÿå‡ºé”™ï¼Œè¯·æŠŠé”™è¯¯ä»£ç å‘é€åˆ°å®˜æ–¹è®ºå›ï¼Œä»¥æ£€æŸ¥åŸå› ï¼<br /> é”™è¯¯ä»£ç ï¼šmember_model_edit.php?dopost=copy $errv","javascript:;");

156 
ex™
();

164 if(
	g$dİo¡
=="delete")

166 @
£t_time_lim™
(0);

167 
CheckPurv›w
('c_Del');

168 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$id'");

169 if(
	g$row
['issystem'] == 1)

171 
ShowMsg
("ç³»ç»Ÿæ¨¡å‹,ç¦æ­¢åˆ é™¤!","-1");

172 
ex™
();

174 if(
em±y
(
$job
)è
	g$job
="";

177 if(
	g$job
=="")

179 
$wšt™Ë
 = "ä¼šå‘˜æ¨¡å‹ç®¡ç†-åˆ é™¤ä¼šå‘˜æ¨¡å‹";

180 
	g$wecome_šfo
 = "<a href='member_model_main.php'>ä¼šå‘˜æ¨¡å‹ç®¡ç†</a>::åˆ é™¤ä¼šå‘˜æ¨¡å‹";

181 
	g$wš
 = 
Ãw
 
OxWšdow
();

182 
	g$wš
->
In™
("member_model_edit.php","js/blank.js","POST");

183 
	g$wš
->
AddHidd’
("job","yes");

184 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

185 
	g$wš
->
AddHidd’
("id",
$id
);

186 
	g$wš
->
AddT™Ë
("ï¼å°†åˆ é™¤æ‰€æœ‰ä¸è¯¥ä¼šå‘˜æ¨¡å‹ç›¸å…³çš„æ–‡ä»¶å’Œæ•°æ®<b¸/>ä½ ç¡®å®è¦åˆ é™¤ \"".
$row
['name']."\" è¿™ä¸ªä¼šå‘˜æ¨¡å‹ï¼Ÿ");

187 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

188 
	g$wš
->
Di¥Ïy
();

189 
ex™
();

193 if(
	g$job
=="yes")

195 
$row
 = 
$dsql
->
G‘OÃ
("SELECT `bË` FROM `#@__memb”_mod–` WHERE id='$id'",
MYSQL_ASSOC
);

196 if(!
is_¬¿y
(
$row
))

198 
ShowMsg
("ä½ æ‰€æŒ‡å®šçš„ä¼šå‘˜æ¨¡å‹ä¿¡æ¯ä¸å­˜åœ¨!","-1");

199 
ex™
();

203 
	g$dsql
->
Execu‹NÚeQu”y
("DROP TABLE IF EXISTS `{$row['table']}`;");

206 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_model` WHERE id='$id'");

207 
UpD©eMemb”ModCache
();

208 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªä¼šå‘˜æ¨¡å‹ï¼","member_model_main.php");

209 
ex™
();

216 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_model` WHERE id='$id'");

217 
šşude
 
	gXAKADMIN
."/templets/member_model_edit.htm";

	@E:\web\weixun\xakadmin\member_model_field_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

11 
»quœe_Úû
(
XAKADMIN
.'/inc/inc_admin_channel.php');

12 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

14 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

15 
	g$mysql_v”siÚs
 = 
ex¶ode
(".",
Œim
(
$mysql_v”siÚ
));

16 
	g$mysql_v”siÚ
 = 
$mysql_v”siÚs
[0].".".$mysql_versions[1];

20 if(
	g$aùiÚ
=='save')

23 
$f›ldÇme
 = 
¡¹Şow”
($fieldname);

24 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `table`,`info` FROM `#@__member_model` WHERE id='$id'");

25 
	g$f›ld£t
 = 
$row
['info'];

26 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

27 
	g$d
 = 
Ãw
 
XakTagP¬£
();

28 
	g$d
->
S‘NameS·û
("field","<",">");

29 
	g$d
->
LßdSourû
(
$f›ld£t
);

30 
	g$ŒueTabË
 = 
$row
['table'];

33 
	g$dfv®ue
 = 
Œim
(
$vdeçuÉ
);

34 
	g$i¢uÎ
 = (
$i¢uÎ
==1 ? "true" : "false");

35 
	g$mxËn
 = 
$maxËngth
;

38 
	g$f›ldšfos
 = 
G‘F›ldMake
(
$dty³
, 
$f›ldÇme
, 
$dfv®ue
, 
$mxËn
);

39 
	g$Áabsql
 = 
$f›ldšfos
[0];

40 
	g$buideTy³
 = 
$f›ldšfos
[1];

42 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(" ALTER TABLE `$trueTable` ADD $ntabsql ");

44 if(!
	g$rs
)

46 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

47 
ShowMsg
("å¢åŠ å­—æ®µå¤±è´¥ï¼Œé”™è¯¯æç¤ºä¸ºï¼š".
$g”r
,"javascript:;");

48 
ex™
();

50 
	g$ok
 = 
çl£
;

53 if(
is_¬¿y
(
$d
->
CTags
))

56 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

58 if(
$f›ldÇme
 =ğ
¡¹Şow”
(
$ùag
->
G‘Name
()))

60 
$d
->
Assign
(
$gid
,
¡r¦ashes
(
$f›ld¡ršg
),
çl£
);

61 
	g$ok
 = 
Œue
;

65 
	g$ok£‰šg
 = 
$ok
 ? 
$d
->
G‘ResuÉNP
(è: 
$f›ld£t
."\n".
¡r¦ashes
(
$f›ld¡ršg
);

70 
	g$ok£‰šg
 = 
$f›ld£t
."\n".
¡r¦ashes
(
$f›ld¡ršg
);

72 
	g$addli¡
 = 
G‘AddF›ldLi¡
(
$d
, 
$ok£‰šg
);

73 
	g$ok£‰šg
 = 
add¦ashes
(
$ok£‰šg
);

74 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_model` SET `info`='$oksetting' WHERE id='$id' ");

75 if(!
	g$rs
)

77 
	g$g¼
 = 
$dsql
->
G‘E¼Ü
();

78 
ShowMsg
("ä¿å­˜èŠ‚ç‚¹é…ç½®å‡ºé”™ï¼".
$g¼
,"javascript:;");

79 
ex™
();

81 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªå­—æ®µï¼","member_model_edit.php?id=$id");

82 
ex™
();

89 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `table` FROM `#@__member_model` WHERE id='$id'");

90 
	g$ŒueTabË
 = 
$row
['table'];

91 
	g$bsql
 = "CREATE TABLE IF NOT EXISTS `$trueTable`(

92 `
mid
` (10è
NOT
 
NULL
 
auto_šüem’t
,

94 if(
$mysql_v”siÚ
 < 4.1)

96 
$bsql
 .= " PRIMARY KEY (`mid`)\r\n) TYPE=MyISAM; ";

97 
	}
}

100 
	g$bsql
 .ğ" PRIMARY KEY (`mid`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

102 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

105 
	g$f›lds
 = 
¬¿y
();

106 
	g$rs
 = 
$dsql
->
S‘Qu”y
("SHOW fields FROM `$trueTable`");

107 
	g$dsql
->
Execu‹
('a');

108 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('a',
MYSQL_ASSOC
))

110 
	g$f›lds
[
¡¹Şow”
(
$Äow
['Field'])] = 1;

112 
	g$f
 = '';

113 
fÜ—ch
(
$f›lds
 
as
 
$k
=>
$v
)

115 
$f
 .ğ($f=='' ? 
$k
 : ' '.$k);

117 
»quœe_Úû
(
XAKADMIN
."/templets/member_model_field_add.htm");

	@E:\web\weixun\xakadmin\member_model_field_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

11 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

12 
»quœe_Úû
(
XAKADMIN
."/inc/inc_admin_channel.php");

13 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

16 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

17 
	g$mysql_v”siÚs
 = 
ex¶ode
(".", 
Œim
(
$mysql_v”siÚ
));

18 
	g$mysql_v”siÚ
 = 
$mysql_v”siÚs
[0].".".$mysql_versions[1];

19 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT `table`,`info` FROM `#@__member_model` WHERE id='$id'");

20 
	g$f›ld£t
 = 
$row
['info'];

21 
	g$ŒueTabË
 = 
$row
['table'];

22 
	g$d
 = 
Ãw
 
XakTagP¬£
();

23 
	g$d
->
S‘NameS·û
("field", "<",">");

24 
	g$d
->
LßdSourû
(
$f›ld£t
);

25 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

27 if(
¡¹Şow”
(
$ùag
->
G‘Name
())==¡¹Şow”(
$âame
)) ;

31 
	g$ds
 = 
fe
(
XAKADMIN
."/inc/fieldtype.txt");

32 
	$fÜ—ch
(
$ds
 
as
 
$d
)

34 
$dds
 = 
	`ex¶ode
(',',
	`Œim
(
$d
));

35 
$f›ldty³s
[
$dds
[0]] = $dds[1];

36 
	}
}

42 if(
	g$aùiÚ
=='save')

44 if(!
is£t
(
$f›ldty³s
[
$dty³
]))

46 
ShowMsg
("ä½ ä¿®æ”¹çš„æ˜¯ç³»ç»Ÿä¸“ç”¨ç±»å‹çš„æ•°æ®ï¼Œç¦æ­¢æ“ä½œï¼","-1");

47 
ex™
();

51 
	g$bsql
 = "CREATE TABLE IF NOT EXISTS `$trueTable`(

52 `
mid
` (10è
NOT
 
NULL
 
auto_šüem’t
,

54 if(
	g$mysql_v”siÚ
 < 4.1)

56 
	g$bsql
 .= " PRIMARY KEY (`mid`)\r\n) TYPE=MyISAM; ";

60 
	g$bsql
 .ğ" PRIMARY KEY (`mid`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

64 
	g$f›lds
 = 
¬¿y
();

65 
	g$rs
 = 
$dsql
->
S‘Qu”y
("SHOW fields FROM `$trueTable`");

66 
	g$dsql
->
Execu‹
('a');

67 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('a',
MYSQL_ASSOC
))

69 
	g$f›lds
[ 
¡¹Şow”
(
$Äow
['Field']) ] = $nrow['Type'];

73 
	g$dfv®ue
 = 
$vdeçuÉ
;

74 
	g$i¢uÎ
 = "true";

75 
	g$mxËn
 = 
$maxËngth
;

76 
	g$f›ldÇme
 = 
¡¹Şow”
(
$âame
);

79 
	g$f›ldšfos
 = 
G‘F›ldMake
(
$dty³
, 
$f›ldÇme
, 
$dfv®ue
, 
$mxËn
);

80 
	g$Áabsql
 = 
$f›ldšfos
[0];

81 
	g$buideTy³
 = 
$f›ldšfos
[1];

82 
	g$bsql
 = '';

85 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

87 if(
Œim
(
$f›ldÇme
)=ñrim(
¡¹Şow”
(
$ùag
->
G‘Name
())))

90 if(
is£t
(
$f›lds
[
$f›ldÇme
]è&& $f›lds[$f›ldÇme]!=
$buideTy³
)

92 
$bsql
 = "ALTER TABLE `$ŒueTabË` CHANGE `$f›ldÇme` ".
$Áabsql
;

93 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

95 if(!
is£t
(
$f›lds
[
$f›ldÇme
]))

97 
	g$bsql
 = "ALTER TABLE `$ŒueTabË` ADD ".
$Áabsql
;

98 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

102 
	g$bsql
 = '';

104 
	g$d
->
Assign
(
$gid
,
¡r¦ashes
(
$f›ld¡ršg
),
çl£
);

108 
	g$ok£‰šg
 = 
$d
->
G‘ResuÉNP
();

110 
	g$ok£‰šg
 = 
add¦ashes
(
$ok£‰šg
);

111 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_model` SET info='$oksetting' WHERE id='$id' ");

112 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªå­—æ®µçš„é…ç½®ï¼","member_model_edit.php?id={$id}");

113 
ex™
();

119 if(
	g$aùiÚ
=="disabled")

121 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

123 if(
¡¹Şow”
(
$ùag
->
G‘Name
())==¡¹Şow”(
$âame
))

125 
$¡©’um
 = (
$ùag
->
G‘A‰
('state')==1)? 0 : 1;

126 
	g$f›ld¡ršg
 = "<field:{$ctag->GetName()} itemname=\"{$ctag->GetAtt('itemname')}\"‡utofield=\"{$ctag->GetAtt('autofield')}\"ype=\"{$ctag->GetAtt('type')}\" isnull=\"{$ctag->GetAtt('isnull')}\" default=\"{$ctag->GetAtt('default')}\" maxlength=\"{$ctag->GetAtt('maxlength')}\" issearch=\"{$ctag->GetAtt('issearch')}\" isshow=\"{$ctag->GetAtt('isshow')}\" state=\"{$statenum}\">\r\n";

127 
	g$f›ld¡ršg
 .= "</field:{$ctag->GetName()}>";

128 
	g$d
->
Assign
(
$gid
,
¡r¦ashes
(
$f›ld¡ršg
),
çl£
);

131 
	g$ok£‰šg
 = 
add¦ashes
(
$d
->
G‘ResuÉNP
());

133 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_model` SET info='$oksetting' WHERE id='$id' ");

134 
ShowMsg
("æˆåŠŸç¦ç”¨ä¸€ä¸ªå­—æ®µï¼","member_model_edit.php?id={$id}");

135 
ex™
();

141 if(
	g$aùiÚ
=="delete")

144 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

146 if(
¡¹Şow”
(
$ùag
->
G‘Name
())==¡¹Şow”(
$âame
))

148 
$d
->
Assign
(
$gid
,"#@Delete@#");

151 
	g$ok£‰šg
 = 
add¦ashes
(
$d
->
G‘ResuÉNP
());

152 
	g$dsql
->
Execu‹NÚeQu”y
("Update `#@__member_model` set info='$oksetting' where id='$id' ");

153 
	g$dsql
->
Execu‹NÚeQu”y
("ALTER TABLE `$trueTable` DROP `$fname` ");

154 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªå­—æ®µï¼","member_model_edit.php?id={$id}");

155 
ex™
();

157 
»quœe_Úû
(
XAKADMIN
."/templets/member_model_field_edit.htm");

	@E:\web\weixun\xakadmin\member_model_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Type');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
»quœe_Úû
(
XAKINC
."/common.func.php");

11 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
funùiÚ
 
G‘TÙ®Memb”
(
$mbË
=''){

13 
glob®
 
$dsql
;

14 if(
	g$dsql
->
IsTabË
(
$mbË
)){

15 
	g$row
 =
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS‚ums FROM {$mtable}");

16  
em±y
(
$row
['nums'])? "0" : $row['nums'];

22 
	g$sql
 = "SELECT `id`,`name`,`table`,`description`,`state`,`issystem` FROM `#@__member_model` ORDER BY id ASC";

23 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

24 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/member_model_main.htm");

25 
	g$dli¡
->
S‘Sourû
(
$sql
);

26 
	g$dli¡
->
di¥Ïy
();

27 
	g$dli¡
->
Clo£
();

	@E:\web\weixun\xakadmin\member_msg_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Log');

9 if(
	$em±y
(
$dİo¡
))

11 
	`ShowMsg
("ä½ æ²¡æŒ‡å®šä»»ä½•å‚æ•°ï¼","javascript:;");

12 
	`ex™
();

13 
	}
}

14 if(
em±y
(
$d–log
)è
	g$d–log
 = 0;

17 if(
	g$dİo¡
=="del")

19 
$bku¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "member_msg_main.php";

20 
	g$ids
 = 
ex¶ode
('`',
$ids
);

21 
	g$dqu”y
 = "";

22 
fÜ—ch
(
$ids
 
as
 
$id
)

24 if(
	g$dqu”y
=="")

26 
$dqu”y
 .= "id='$id' ";

30 
	g$dqu”y
 .= " OR id='$id' ";

33 if(
	g$dqu”y
!=""è
$dqu”y
 = " WHERE ".$dquery;

34 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_msg` $dquery");

35 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„è®°å½•ï¼",
$bku¾
);

36 
ex™
();

39 if(
	g$dİo¡
=="check")

41 
$bku¾
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? $_COOKIE['ENV_GOBACK_URL'] : "member_msg_main.php";

42 
	g$ids
 = 
ex¶ode
('`',
$ids
);

43 
	g$dqu”y
 = "";

44 
fÜ—ch
(
$ids
 
as
 
$id
)

46 if(
	g$dqu”y
==""è
$dqu”y
 .= " id='$id' ";

47 
	g$dqu”y
 .= " Or id='$id' ";

49 if(
	g$dqu”y
!=""è
$dqu”y
 = " where ".$dquery;

50 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_msg` SET ischeck=1 $dquery");

51 
ShowMsg
("æˆåŠŸå®¡æ ¸æŒ‡å®šçš„è®°å½•ï¼",
$bku¾
);

52 
ex™
();

56 
ShowMsg
("æ— æ³•è¯†åˆ«ä½ çš„è¯·æ±‚ï¼","javascript:;");

57 
ex™
();

	@E:\web\weixun\xakadmin\member_operations.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Operations');

9 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

10 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

12 if(
em±y
(
$buyid
)è
	g$buyid
 = '';

13 
	g$addsql
 = " WHERE buyid LIKE '%$buyid%' ";

14 if(
is£t
(
$¡a
)è
	g$addsql
 .= " AND sta='$sta' ";

16 
	g$sql
 = "SELECT * FROM `#@__member_operation` $addsql ORDER BY‡id DESC";

17 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

20 
	g$dli¡
->
	g·geSize
 = 25;

21 
	g$dli¡
->
S‘P¬am‘”
("buyid",
$buyid
);

22 if(
is£t
(
$¡a
)è
	g$dli¡
->
S‘P¬am‘”
("sta",$sta);

24 
	g$dli¡
->
	gdsql
->
S‘Qu”y
("SELECT * FROM #@__moneycard_type ");

25 
	g$dli¡
->
	gdsql
->
Execu‹
('ts');

26 
	g$rw
 = 
$dli¡
->
dsql
->
G‘A¼ay
('ts'))

28 
$Ty³Names
[
$rw
['tid']] = $rw['pname'];

30 
	g$lfe
 = 
XAKADMIN
."/templets/member_operations.htm";

33 
	g$dli¡
->
S‘Tem¶©e
(
$lfe
);

34 
	g$dli¡
->
S‘Sourû
(
$sql
);

35 
	g$dli¡
->
Di¥Ïy
();

37 
funùiÚ
 
	$G‘Memb”ID
(
$mid
)

39 
glob®
 
$dsql
;

40 if(
$mid
==0)

44 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT userid FROM `#@__member_list` WHERE mid='$mid' ");

45 if(
	`is_¬¿y
(
$row
))

47  "<¨h»f='memb”_v›w.php?id={$mid}'>".
$row
['userid']."</a>";

53 
	}
}

55 
funùiÚ
 
	$G‘PTy³
(
$Šame
)

57 if(
$Šame
=='card')  'ç‚¹æ•°å¡';

58 if(
$Šame
=='archive')  'è´­ä¹°æ–‡ç« ';

59 if(
$Šame
=='stc')  'å…‘æ¢é‡‘å¸';

61 
	}
}

63 
funùiÚ
 
	$G‘S
(
$¡a
)

65 if(
$¡a
==0)

69 if(
$¡a
==1)

77 
	}
}

	@E:\web\weixun\xakadmin\member_pm.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Pm');

9 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

10 
»quœe_Úû
(
XAKINC
 .'/datalistcp.class.php');

12 if(!
is£t
(
$fŞd”
)è
	g$fŞd”
 = '';

13 if(!
is£t
(
$u£ºame
)è
	g$u£ºame
 = '';

14 if(!
is£t
(
$keywÜd
)è
	g$keywÜd
 = '';

16 if(
	$is£t
(
$dİo¡
))

18 
$ID
 = 
	`´eg_»¶aû
("#[^0-9]#", "", $ID);

19 if(
$dİo¡
=="d–"&&!
	`em±y
(
$ID
))

21 
$dsql
->
	`Execu‹NÚeQu”y
("DELETE FROM `#@__member_pms` WHERE id='$ID'");

23 
	}
}

25 
	g$wh”eSql
 = '';

26 if(!
em±y
(
$fŞd”
)è
	g$wh”eSql
 = "WHERE folder='$folder'";

27 
	g$po¡u£r
 = "æ”¶ä»¶äºº";

28 if(
	g$fŞd”
=="šbox"||
$fŞd”
==''è
$po¡u£r
 = "å‘ä»¶äºº";

30 if(!
	$em±y
(
$keywÜd
))

32 
$wh”eSql
 .ğ" AND (subjeù†ik'%".
$keywÜd
."%' OR message†ike '%".$keyword."%')";

33 
	}
}

34 if(!
	$em±y
(
$u£ºame
))

36 
$wh”eSql
 .ğ" AND flogšid†ik'%".
$u£ºame
."%'";

37 
	}
}

38 
	g$sql
 = "SELECT * FROM `#@__member_pms` $whereSql ORDER BY sendtime desc";

39 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

40 
	g$dli¡
->
	g·gesize
 = 25;

41 
	g$dli¡
->
S‘P¬am‘”
("fŞd”",
$fŞd”
);

42 
	g$dli¡
->
S‘P¬am‘”
("u£ºame",
$u£ºame
);

43 
	g$dli¡
->
S‘P¬am‘”
("keywÜd",
$keywÜd
);

44 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/member_pm.htm");

45 
	g$dli¡
->
S‘Sourû
(
$sql
);

46 
	g$dli¡
->
Di¥Ïy
();

47 
	g$dli¡
->
Clo£
();

49 
funùiÚ
 
	$G‘FŞd”s
(
$me
)

51 if(
$me
=="outbox")  'å‘ä»¶ç®±';

52 if(
$me
=="inbox")  'æ”¶ä»¶ç®±';

53 
	}
}

55 
funùiÚ
 
	$IsR—d”
(
$me
)

57 
$me
 = 
	`´eg_»¶aû
("#[^0-1]#", "", $me);

58 if(
$me
)  "<font color='green'>âˆš</font>";

60 
	}
}

	@E:\web\weixun\xakadmin\member_pmall.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Pm');

9 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

11 if(
	g$aùiÚ
=="post")

13 
$æogšid
 = 'admin';

14 
	g$äomid
 = 0;

15 
	g$toid
 = 0;

16 
	g$tŞogšid
 = 0;

17 
	g$£ndtime
 = 
time
();

18 
	g$wr™‘ime
 = 
time
();

19 
	g$subjeù
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$subjeù
),70);

20 
	g$mes§ge
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$mes§ge
),1000);

21 if(!
is£t
(
$subjeù
)||
em±y
($subject))

23 
ShowMsg
('çŸ­ä¿¡æ ‡é¢˜ä¸èƒ½ä¸ºç©º!','-1');

24 
ex™
();

25 } ià(!
is£t
(
$mes§ge
è|| 
em±y
($message))

27 
ShowMsg
('è¯·å¡«å†™çŸ­ä¿¡å†…å®¹!','-1');

28 
ex™
();

32 if(
defšed
('UC_API'è&& @
šşude_Úû
 
	gXAKROOT
.'/uc_client/client.php')

34 
uc_pm_£nd
(0,'',
$subjeù
,
$mes§ge
);

35 
ShowMsg
('çŸ­ä¿¡å·²æˆåŠŸå‘é€','-1'); 
	gex™
;

37 #/
a
}}

39 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__member_pms` (floginid,fromid,toid,tologinid,folder,hasview,subject,sendtime,writetime,message,isadmin) VALUES('$floginid','$fromid','$toid','$tologinid','outbox','0','$subject','$sendtime','$writetime','$message','1');");

40 
ShowMsg
('çŸ­ä¿¡å·²æˆåŠŸå‘é€','-1');

41 
ex™
();

43 
»quœe_Úû
(
XAKADMIN
."/templets/member_pmall.htm");

	@E:\web\weixun\xakadmin\member_pmone.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Pm');

10 
funùiÚ
 
CheckU£rID
(
$uid
,
$msgt™Ë
='ç”¨æˆ·å',
$ckhas
=
Œue
)

12 
glob®
 
$cfg_mb_nÙ®low
,
$cfg_mb_idmš
,
$cfg_md_idu¾
,
$cfg_soá_Ïng
,
$dsql
;

13 if(
	g$cfg_mb_nÙ®low
 != '')

15 
$Çs
 = 
ex¶ode
(',', 
$cfg_mb_nÙ®low
);

16 if(
š_¬¿y
(
$uid
, 
$Çs
))

18  
	g$msgt™Ë
.'ä¸ºç³»ç»Ÿç¦æ­¢çš„æ ‡è¯†ï¼';

21 if(
	g$cfg_md_idu¾
=='Y' && 
´eg_m©ch
("#[^a-z0-9]#i", 
$uid
))

23  
	g$msgt™Ë
.'å¿…é¡»ç”±è‹±æ–‡å­—æ¯æˆ–æ•°å­—ç»„æˆï¼';

26 if(
	g$cfg_soá_Ïng
=='utf-8'è
$ck_uid
 = 
utf82gb
(
$uid
);

27 
	g$ck_uid
 = 
$uid
;

29 
	g$i
=0;
is£t
(
$ck_uid
[
$i
]);$i++)

31 if(
Üd
(
$ck_uid
[
$i
]) > 0x80)

33 if(
is£t
(
$ck_uid
[
$i
+1]è&& 
Üd
($ck_uid[$i+1])>0x40)

35 
	g$i
++;

39  
	g$msgt™Ë
.'å¯èƒ½å«æœ‰ä¹±ç ï¼Œå»ºè®®ä½ æ”¹ç”¨è‹±æ–‡å­—æ¯å’Œæ•°å­—ç»„åˆï¼';

44 if(
´eg_m©ch
("#[^0-9a-z@\.-]i#", 
$ck_uid
[
$i
]))

46  
	g$msgt™Ë
.'ä¸èƒ½å«æœ‰ [@]ã€[.]ã€[-]ä»¥å¤–çš„ç‰¹æ®Šç¬¦å·ï¼';

50 if(
	g$ckhas
)

52 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE userid LIKE '$uid' ");

53 if(
is_¬¿y
(
$row
)è 
	g$msgt™Ë
."å·²ç»å­˜åœ¨ï¼";

58 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

59 if(
	g$aùiÚ
=="post")

61 
$æogšid
 = 
$cu£rLogš
->
g‘U£rName
();

62 
	g$äomid
 = 
$cu£rLogš
->
g‘U£rID
();

63 if(
	g$subjeù
=='')

65 
ShowMsg
("è¯·å¡«å†™ä¿¡æ¯æ ‡é¢˜!","-1");

66 
ex™
();

68 
	g$msg
 = 
CheckU£rID
(
$msgtoid
,"ç”¨æˆ·å",
çl£
);

69 if(
	g$msg
!='ok')

71 
ShowMsg
(
$msg
,"-1");

72 
ex™
();

74 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * From `#@__member_list` where userid†ike '$msgtoid' ");

75 if(!
is_¬¿y
(
$row
))

77 
ShowMsg
("ä½ æŒ‡å®šçš„ç”¨æˆ·ä¸å­˜åœ¨,ä¸èƒ½å‘é€ä¿¡æ¯!","-1");

78 
ex™
();

80 
	g$subjeù
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$subjeù
,1),60);

81 
	g$mes§ge
 = 
ú_sub¡rR
(
HtmlR•Ïû
(
$mes§ge
,0),1024);

82 
	g$£ndtime
 = 
$wr™‘ime
 = 
time
();

85 
	g$šqu”y
 = "INSERT INTO `#@__member_pms` (`floginid`,`fromid`,`toid`,`tologinid`,`folder`,`subject`,`sendtime`,`writetime`,`hasview`,`isadmin`,`message`)

86 
VALUES
 ('$æogšid','$äomid','{$row['
mid
']}','{$row['
u£rid
']}','inbox','$subject','$sendtime','$writetime','0','0','$message'); ";

88 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

89 
ShowMsg
('çŸ­ä¿¡å·²æˆåŠŸå‘é€','member_pmone.php');

90 
ex™
();

92 
»quœe_Úû
(
XAKADMIN
."/templets/member_pmone.htm");

	@E:\web\weixun\xakadmin\member_rank.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Type');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
	g$dİo¡
=='save')

14 
$¡¬tID
 = 1;

15 
	g$’dID
 = 
$id’d
;

16 ;
	g$¡¬tID
 <ğ
$’dID
;$startID++)

18 
	g$qu”y
 = '';

19 
	g$id
 = 
$
{"ID_".
$¡¬tID
};

20 
	g$Çme
 = 
$
{"Çme_".
$¡¬tID
};

21 
	g$¿nk
 = 
$
{"¿nk_".
$¡¬tID
};

22 
	g$mÚey
 = 
$
{"mÚey_".
$¡¬tID
};

23 
	g$scÜes
 = 
$
{"scÜes_".
$¡¬tID
};

24 if(
is£t
(
$
{"check_".
$¡¬tID
}))

26 if(
	g$¿nk
>0)

28 
	g$qu”y
 = "UPDATE `#@__arcrank` SET membername='$name',money='$money',rank='$rank',scores='$scores' WHERE id='$id' ";

33 
	g$qu”y
 = "DELETE FROM `#@__arcrank` WHERE id='$id' AND„ank<>10";

35 if(
	g$qu”y
!=''è
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

37 if(
is£t
(
$check_Ãw
))

39 if(
	g$¿nk_Ãw
 > 0 && 
	g$Çme_Ãw
 !ğ'' && 
$¿nk_Ãw
 > 10)

41 
$šqu”y
 = "INSERT INTO `#@__arcrank`(`rank`,`membername`,`adminrank`,`money`,`scores`,`purviews`) VALUES('$rank_new','$name_new','5','$money_new','$scores',''); ";

42 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

45 
	gecho
 "<script>‡lert('æˆåŠŸæ›´æ–°ä¼šå‘˜ç­‰çº§è¡¨ï¼'); </script>";

47 if(
	g$dİo¡
 == 'del')

49 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arcrank` WHERE id='$id' AND„ank<>10");

50 
ShowMsg
("åˆ é™¤æˆåŠŸï¼","member_rank.php");

51 
ex™
();

54 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__arcrank` WHERE„ank>0 ORDER BY„ank");

55 
	g$dsql
->
Execu‹
();

56 
šşude
 
XAKINClude
('templets/member_rank.htm');

	@E:\web\weixun\xakadmin\member_scores.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Scores');

9 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

11 if(
	g$aùiÚ
=='save')

13 if(!
em±y
(
$add_š‹g¿l
)&&!em±y(
$add_icÚ
)&&!em±y(
$add_t™Ës
))

15 
$š‹g¿l
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$add_š‹g¿l
);

16 
	g$add_icÚ
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$add_icÚ
);

17 
	g$add_t™Ës
 = 
ú_sub¡r
(
$add_t™Ës
, 15);

18 
	g$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__scores`(integral,icon,titles,isdefault) VALUES('$integral','$add_icon','$add_titles','$add_isdefault')");

20 
fÜ—ch
(
$_POST
 
as
 
$rk
=>
$rv
)

22 if(
´eg_m©ch
("#-#", 
$rk
))

24 
$ID
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$rk
);

25 
	g$fdes
 = 
´eg_»¶aû
("#[^a-z]#", "", 
$rk
);

26 
	g$k
 = 
$$rk
;

27 if(
em±y
(
$k
))

29 
	g$k
 = 0;

31 
	g$sql
 = 
$fdes
."='".
$k
."'";

32 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__scÜes` SET ".
$sql
." WHERE id='{$ID}'");

33 if(
´eg_m©ch
("#Ids-#", 
$rk
))

35 if(
	g$k
è
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__scores` WHERE id='$ID'");

41 
	g$ScÜes
 = 
¬¿y
();

42 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__scores` ORDER BY id ASC");

43 
	g$dsql
->
Execu‹
();

44 
	g$rs
 = 
$dsql
->
	$G‘A¼ay
())

46 
	`¬¿y_push
(
$ScÜes
,
$rs
);

47 
	}
}

48 
šşude
 
XAKINClude
('templets/member_scores.htm');

	@E:\web\weixun\xakadmin\member_toadmin.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Edit');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

10 if(
em±y
(
$fmdo
)è
	g$fmdo
 = '';

12 
	g$ENV_GOBACK_URL
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? 'member_main.php' : '';

13 
	g$row
 = 
¬¿y
();

18 if(
	g$dİo¡
 == "toadmin")

20 
$pwd
 = 
Œim
($pwd);

21 if(
	g$pwd
!='' && 
´eg_m©ch
("#[^0-9a-zA-Z_@!\.-]#", 
$pwd
))

23 
ShowMsg
('å¯†ç ä¸åˆæ³•ï¼Œè¯·ä½¿ç”¨[0-9a-zA-Z_@!.-]å†…çš„å­—ç¬¦ï¼','-1', 0, 3000);

24 
ex™
();

26 
	g$§ãcodeok
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
), 0, 24);

27 if(
	g$§ãcodeok
 !ğ
$§ãcode
)

29 
ShowMsg
("è¯·å¡«å†™æ­£ç¡®çš„å®‰å…¨éªŒè¯ä¸²ï¼", "member_toadmin.php?id={$id}");

30 
ex™
();

32 
	g$pwdm
 = '';

33 if(
	g$pwd
!='')

35 
$špuwd
 = ",pwd";

36 
	g$špuwdv
 = ",'".
PassJoš
(
$pwd
)."'";

37 
	g$pwdm
 = ",pwd='".
PassJoš
(
$pwd
)."'";

41 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE mid='$id'");

42 
	g$·sswÜd
 = 
$row
['pwd'];

43 
	g$špuwd
 = ",pwd";

45 
	g$pwd
 = 
$·sswÜd
;

46 
	g$špuwdv
 = ",'".
$pwd
."'";

47 
	g$pwdm
 = ",pwd='".
$·sswÜd
."'";

49 
	g$ty³ids
=(
em±y
(
$ty³ids
))? "" : $typeids;

50 if(
	g$ty³ids
=='')

52 
ShowMsg
("è¯·ä¸ºè¯¥ç®¡ç†å‘˜æŒ‡å®šç®¡ç†æ ç›®ï¼","member_toadmin.php?id={$id}");

53 
ex™
();

55 
	g$ty³id
 = 
još
(',', 
$ty³ids
);

56 if(
	g$ty³id
=='0'è
$ty³id
 = '';

57 if(
	g$id
!=1)

59 
$qu”y
 = "INSERT INTO `#@__admin_list`(id,usertype,userid$inputpwd,uname,typeid,tname,email)

60 
VALUES
('$id','$u£¹y³','$u£rid'
$špuwdv
,'$uname','$typeid','$tname','$email')";

64 
	g$qu”y
 = "INSERT INTO `#@__admin_list`(id,userid$inputpwd,uname,typeid,tname,email)

65 
VALUES
('$id','$u£rid'
$špuwdv
,'$uname','$typeid','$tname','$email')";

67 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

68 
	g$qu”y
 = "UPDATE `#@__member_list` SET„ank='100',uname='$uname',matt='10',email='$email'$pwdm WHERE mid='$id'";

69 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

70 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__admintype` WHERE„ank='$usertype'");

71 
	g$æogšid
 = 
$cu£rLogš
->
g‘U£rName
();

72 
	g$äomid
 = 
$cu£rLogš
->
g‘U£rID
();

73 
	g$subjeù
 = "æ­å–œæ‚¨å·²ç»æˆåŠŸæå‡ä¸ºç®¡ç†å‘˜";

74 
	g$mes§ge
 = "äº²çˆ±çš„ä¼šå‘˜{$userid},æ‚¨å·²ç»æˆåŠŸæå‡ä¸º{$row['typename']},å…·ä½“æ“ä½œæƒé™è¯·åŒç½‘ç«™è¶…çº§ç®¡ç†å‘˜è”ç³»ã€‚";

75 
	g$£ndtime
 = 
$wr™‘ime
 = 
time
();

76 
	g$šqu”y
 = "INSERT INTO `#@__member_pms` (`floginid`,`fromid`,`toid`,`tologinid`,`folder`,`subject`,`sendtime`,`writetime`,`hasview`,`isadmin`,`message`)

77 
VALUES
 ('$floginid','$fromid','$id','$userid','inbox','$subject','$sendtime','$writetime','0','0','$message'); ";

78 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

79 
ShowMsg
("æˆåŠŸå‡çº§ä¸€ä¸ªå¸æˆ·ï¼","member_main.php");

80 
ex™
();

82 
	g$id
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$id
);

85 
	g$¿ndcode
 = 
mt_¿nd
(10000, 99999);

86 
	g$§ãcode
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
), 0, 24);

87 
	g$ty³O±iÚs
 = '';

88 
	g$ty³id
=(
em±y
(
$ty³id
))? '' : $typeid;

89 
	g$ty³ids
 = 
ex¶ode
(',', 
$ty³id
);

90 
	g$dsql
->
S‘Qu”y
("SELECT id,typename FROM `#@__arctype` WHERE„eid=0 AND (ispart=0 OR ispart=1)");

91 
	g$dsql
->
Execu‹
('op');

92 
	g$Äow
 = 
$dsql
->
G‘Objeù
('op'))

94 
$ty³O±iÚs
 .ğ"<İtiÚ v®ue='{$Äow->id}' cÏss='bty³'".(
š_¬¿y
(
$Äow
->
id
, 
$ty³ids
) ? ' selected' : '').">{$nrow->typename}</option>\r\n";

95 
	g$dsql
->
S‘Qu”y
("SELECT id,typename FROM #@__arctype WHERE„eid={$nrow->id} AND (ispart=0 OR ispart=1)");

96 
	g$dsql
->
Execu‹
('s');

97 
	g$Äow
 = 
$dsql
->
G‘Objeù
('s'))

99 
$ty³O±iÚs
 .ğ"<İtiÚ v®ue='{$Äow->id}' cÏss='¡y³'".(
š_¬¿y
(
$Äow
->
id
, 
$ty³ids
) ? ' selected' : '').">â€”{$nrow->typename}</option>\r\n";

102 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__member_list` WHERE mid='$id'");

103 
šşude
 
XAKINClude
('templets/member_toadmin.htm');

	@E:\web\weixun\xakadmin\member_type.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Type');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 if(
	g$dİo¡
=="save")

14 
$¡¬tID
 = 1;

15 
	g$’dID
 = 
$id’d
;

16  ;
	g$¡¬tID
 <ğ
$’dID
; $startID++)

18 
	g$qu”y
 = '';

19 
	g$aid
 = 
$
{'ID_'.
$¡¬tID
};

20 
	g$²ame
 = 
$
{'²ame_'.
$¡¬tID
};

21 
	g$¿nk
 = 
$
{'¿nk_'.
$¡¬tID
};

22 
	g$mÚey
 = 
$
{'mÚey_'.
$¡¬tID
};

23 
	g$ex±ime
 = 
$
{'ex±ime_'.
$¡¬tID
};

24 if(
is£t
(
$
{'check_'.
$¡¬tID
}))

26 if(
	g$²ame
!='')

28 
$qu”y
 = "UPDATE `#@__member_type` SET…name='$pname',money='$money',rank='$rank',exptime='$exptime' WHERE‡id='$aid'";

33 
	g$qu”y
 = "DELETE FROM `#@__member_type` WHERE‡id='$aid' ";

35 if(
	g$qu”y
!='')

37 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

42 if(
is£t
(
$check_Ãw
è&& 
	g$²ame_Ãw
!='')

44 
$qu”y
 = "INSERT INTO `#@__member_type` (rank,pname,money,exptime) VALUES('{$rank_new}','{$pname_new}','{$money_new}','{$exptime_new}');";

45 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

47 
h—d”
("Content-Type:ext/html; charset={$cfg_soft_lang}");

48 
	gecho
 "<script>‡lert('æˆåŠŸæ›´æ–°ä¼šå‘˜äº§å“åˆ†ç±»è¡¨ï¼'); </script>";

50 
	g$¬üªks
 = 
¬¿y
();

51 
	g$dsql
->
S‘Qu”y
("SELECT * FROM #@__arcrank WHERE„ank>10 ");

52 
	g$dsql
->
Execu‹
();

53 
	g$row
=
$dsql
->
	$G‘A¼ay
())

55 
$¬üªks
[
$row
['rank']] = $row['membername'];

56 
	}
}

58 
	g$times
 = 
¬¿y
();

59 
	g$times
[7] = 'ä¸€å‘¨';

60 
	g$times
[30] = 'ä¸€ä¸ªæœˆ';

61 
	g$times
[90] = 'ä¸‰ä¸ªæœˆ';

62 
	g$times
[183] = 'åŠå¹´';

63 
	g$times
[366] = 'ä¸€å¹´';

64 
	g$times
[32767] = 'ç»ˆèº«';

66 
»quœe_Úû
(
XAKADMIN
."/templets/member_type.htm");

	@E:\web\weixun\xakadmin\member_view.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('member_Edit');

9 
	g$ENV_GOBACK_URL
 = 
is£t
(
$_COOKIE
['ENV_GOBACK_URL']) ? "member_main.php" : '';

10 
	g$id
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$id
);

11 
	g$row
 = 
$dsql
->
G‘OÃ
("select * from `#@__member_list` where mid='$id'");

13 
	g$¡aA¼
 = 
¬¿y
(

23 if(
	g$row
['m©t']==10è
CheckPurv›w
('sys_User');

25 if(
	g$row
['uptime']>0 && $row['exptime']>0)

27 
	g$mhasDay
 = 
$row
['ex±ime'] - 
û
((
time
() - $row['uptime'])/3600/24)+1;

29 
	g$mhasDay
 = 0;

31 
šşude
 
XAKINClude
('templets/member_view.htm');

	@E:\web\weixun\xakadmin\module_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_module');

9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/xakmodule.class.php");

10 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/oxwindow.class.php");

11 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

12 
»quœe_Úû
(
XAKDATA
."/admin/config_update.php");

13 
	g$mdœ
 = 
XAKDATA
.'/module';

15 
	g$mdu¾
 = '';

18 
funùiÚ
 
	$Te¡Wr™eAbË
(
$d
)

20 
$tfe
 = '_xak_test.txt';

21 
$d
 = 
	`´eg_»¶aû
("#\/$#", '', $d);

22 
$å
 = @
	`fİ’
(
$d
.'/'.
$tfe
,'w');

23 if(!
$å
è 
FALSE
;

26 
	`fşo£
(
$å
);

27 
$rs
 = @
	`uÆšk
(
$d
.'/'.
$tfe
);

28 if(
$rs
è 
TRUE
;

29  
FALSE
;

31 
	}
}

33 
funùiÚ
 
	$ReWr™eCÚfigAuto
()

35 
glob®
 
$dsql
;

36 
$cÚfigfe
 = 
XAKDATA
.'/config.cache.inc.php';

37 if(!
	`is_wr™—bË
(
$cÚfigfe
))

39 
echo
 "é…ç½®æ–‡ä»¶'{$configfile}'ä¸æ”¯æŒå†™å…¥ï¼Œæ— æ³•ä¿®æ”¹ç³»ç»Ÿé…ç½®å‚æ•°ï¼";

41 
	`ex™
();

43 
$å
 = 
	`fİ’
(
$cÚfigfe
,'w');

44 
	`æock
(
$å
,3);

45 
	`fwr™e
(
$å
,"<"."?php\r\n");

46 
$dsql
->
	`S‘Qu”y
("SELECT `varname`,`type`,`value`,`groupid` FROM `#@__sysconfig` ORDER BY‡id ASC ");

47 
$dsql
->
	`Execu‹
();

48 
$row
 = 
$dsql
->
	`G‘A¼ay
())

50 if(
$row
['ty³']=='numb”'è
	`fwr™e
(
$å
,"\${$row['varname']} = ".$row['value'].";\r\n");

51 
	`fwr™e
(
$å
,"\${$row['v¬Çme']} = '".
	`¡r_»¶aû
("'",'',
$row
['value'])."';\r\n");

53 
	`fwr™e
(
$å
,"?".">");

54 
	`fşo£
(
$å
);

55 
	}
}

58 
funùiÚ
 
S’dD©a
(
$hash
 = '',
$ty³
 = 1)

60  
FALSE
;

65 if(
	g$aùiÚ
=='')

67 
$ty³s
 = 
¬¿y
('soft'=>'æ¨¡å—','templets'=>'æ¨¡æ¿','plus'=>'å°æ’ä»¶','patch'=>'è¡¥ä¸');

68 
	g$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

69 if(
em±y
(
$moduËty³
)è
	g$moduËty³
 = '';

71 
	g$moduËs_»mÙe
 = 
$dm
->
G‘ModuËU¾Li¡
(
$moduËty³
,
$mdu¾
);

72 
	g$moduËs
 = 
¬¿y
();

73 
	g$moduËs
 = 
$dm
->
G‘ModuËLi¡
(
$moduËty³
);

74 
is_¬¿y
(
$moduËs
è|| 
	g$moduËs
 = 
¬¿y
();

75 
	g$moduËs
 = 
¬¿y_m”ge
(
$moduËs
,
$moduËs_»mÙe
);

76 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/module_main.htm");

77 
	g$dm
->
CË¬
();

78 
ex™
();

83 if(
	g$aùiÚ
=='setup')

85 
$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

86 
	g$šfos
 = 
$dm
->
G‘ModuËInfo
(
$hash
);

88 if(
	g$šfos
['u¾']==''è
$šfos
['url'] = '&nbsp;';

89 
	g$®”tMsg
 = (
$šfos
['Ïng'] =ğ
$cfg_soá_Ïng
 ? '' : '<br /><font color="red">(è¿™ä¸ªæ¨¡å—çš„è¯­è¨€ç¼–ç ä¸ä½ ç³»ç»Ÿçš„ç¼–ç ä¸ä¸€è‡´ï¼Œè¯·å‘å¼€å‘è€…ç¡®è®¤å®ƒçš„å…¼å®¹æ€§)</font>');

91 
	g$f–i¡s
 = 
$dm
->
G‘FeLi¡s
(
$hash
);

92 
	g$f–i¡
 = '';

93 
	g$´vdœs
 = 
¬¿y
();

94 
	g$šcdœ
 = 
¬¿y
();

95 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

97 if(
em±y
(
$v
['name'])) ;

98 if(
	g$v
['type']=='dir')

100 
$v
['type'] = 'ç›®å½•';

101 
	g$šcdœ
[] = 
$v
['name'];

105 
	g$v
['type'] = 'æ–‡ä»¶';

107 
	g$f–i¡
 .= "{$v['type']}|{$v['name']}\r\n";

110 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

112 
	g$´vdœ
 = 
´eg_»¶aû
("#\/([^\/]*)$#", '/', 
$v
['name']);

113 if(!
´eg_m©ch
("#^\.#", 
$´vdœ
)è
	g$´vdœ
 = './';

114 
	g$n
 = 
TRUE
;

115 
fÜ—ch
(
$šcdœ
 
as
 
$k
=>
$v
)

117 if(
´eg_m©ch
("#^".
$v
."#i", 
$´vdœ
))

119 
$n
 = 
FALSE
;

120 
	gBREAK
;

123 if(!
is£t
(
$´vdœs
[
$´vdœ
]è&& 
	g$n
 && 
is_dœ
($prvdir))

125 
	g$´vdœs
[
$´vdœ
][0] = 1;

126 
	g$´vdœs
[
$´vdœ
][1] = 
Te¡Wr™eAbË
($prvdir);

129 
	g$´vdœ
 = "<table cellpadding='1' cellspacing='1' width='350' bgcolor='#cfcfcf' style='margin-top:5px;'>\r\n";

130 
	g$´vdœ
 .= "<tr style='background:#F9FCFD'><th width='270'>ç›®å½•</td><th‡lign='center'>å¯å†™</td></tr>\r\n";

131 
fÜ—ch
(
$´vdœs
 
as
 
$k
=>
$v
)

133 if(
$v
è
$cw
 = 'âˆš';

134 
	g$cw
 = '<font color="red">Ã—</font>';

135 
	g$´vdœ
 .= "<tr bgcolor='#ffffff'><td >$k</td>";

136 
	g$´vdœ
 .= "<td‡lign='center' >$cw</td></tr>\r\n";

138 
	g$´vdœ
 .= "</table>";

140 
	g$wš
 = 
Ãw
 
OxWšdow
();

141 
	g$wš
->
In™
("module_main.php","js/blank.js","post");

142 
	g$wecome_šfo
 = "æ¨¡å—ç®¡ç†";

143 
	g$wš
->
AddT™Ë
("&nbsp;<a href='module_main.php'>æ¨¡å—ç®¡ç†</a> &gt;&gt; å®‰è£…æ¨¡å—ï¼š {$infos['name']}");

144 
	g$wš
->
AddHidd’
("hash",
$hash
);

145 
	g$wš
->
AddHidd’
("action",'setupstart');

146 if(
Œim
(
$šfos
['url'])=='') $infos['url'] = 'æ— ';

147 
	g$msg
 = "<style>.dtb{border-bottom:1px dotted #cccccc}</style>

148 <
bË
 
width
='98%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

149 <
Œ
>

150 <
td
 
width
='20%' 
height
='28' 
şass
='dtb'>æ¨¡å—åç§°ï¼š</td>

151 <
td
 
width
='80%' 
şass
='dtb'>{
$šfos
['name']}</td>

152 </
Œ
>

153 <
Œ
>

154 <
td
 
height
='28' 
şass
='dtb'>è¯­è¨€ï¼š</td>

155 <
td
 
şass
='dtb'>{
$šfos
['Ïng']} {
$®”tMsg
}</td>

156 </
Œ
>

157 <
Œ
>

158 <
td
 
height
='28' 
şass
='dtb'>æ–‡ä»¶å¤§å°ï¼š</td>

159 <
td
 
şass
='dtb'>{
$šfos
['filesize']}</td>

160 </
Œ
>

161 <
Œ
>

162 <
td
 
height
='28' 
şass
='dtb'>å›¢é˜Ÿåç§°ï¼š</td>

163 <
td
 
şass
='dtb'>{
$šfos
['team']}</td>

164 </
Œ
>

165 <
Œ
>

166 <
td
 
height
='28' 
şass
='dtb'>å‘å¸ƒæ—¶é—´ï¼š</td>

167 <
td
 
şass
='dtb'>{
$šfos
['time']}</td>

168 </
Œ
>

169 <
Œ
>

170 <
td
 
height
='28' 
şass
='dtb'>ç”µå­é‚®ç®±ï¼š</td>

171 <
td
 
şass
='dtb'>{
$šfos
['email']}</td>

172 </
Œ
>

173 <
Œ
>

174 <
td
 
height
='28' 
şass
='dtb'>å®˜æ–¹ç½‘å€ï¼š</td>

175 <
td
 
şass
='dtb'>{
$šfos
['url']}</td>

176 </
Œ
>

177 <
Œ
>

178 <
td
 
height
='28' 
şass
='dtb'>ä½¿ç”¨åè®®ï¼š</td>

179 <
td
 
şass
='dtb'><
a
 
h»f
='moduË_maš.php?aùiÚ=show»adme&hash={$hash}' 
rg‘
='_blank'>ç‚¹å‡»æµè§ˆ...</a></td>

180 </
Œ
>

181 <
Œ
>

182 <
td
 
height
='30' 
şass
='dtb' 
bgcŞÜ
='#F9FCFD' 
cŞ¥ª
='2'>

183 <
b
>æ³¨æ„äº‹é¡¹ï¼š</b>

184 å®‰è£…æ—¶è¯·ç¡®ä¿æ–‡ä»¶åˆ—è¡¨ä¸­æ¶‰åŠçš„ç›®å½•å‰å¯å†™å…¥æƒé™ï¼Œæ­¤å¤–â€œåå°ç®¡ç†ç›®å½•â€ã€â€œåå°ç®¡ç†ç›®å½•/
‹m¶‘s
â€ç›®å½•ä¹Ÿå¿…é¡»æš‚æ—¶è®¾ç½®å¯å†™å…¥æƒé™ã€‚

185 </
td
>

186 </
Œ
>

187 <
Œ
>

188 <
td
 
height
='30'><
b
>ç›®å½•æƒé™æ£€æµ‹ï¼š</b><
br
 /> ../ ä¸ºæ ¹ç›®å½• <br /> ./ è¡¨ç¤ºå½“å‰ç›®å½•</td>

189 <
td
>

190 
$´vdœ


191 </
td
>

192 </
Œ
>

193 <
Œ
>

194 <
td
 
height
='30'>æ¨¡å—åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ï¼š</td>

195 <
td
></td>

196 </
Œ
>

197 <
Œ
>

198 <
td
 
height
='164' 
cŞ¥ª
='2'>

199 <
‹x»a
 
Çme
='f–i¡s' 
id
='f–i¡s' 
¡yË
='width:90%;height:200px'>{
$f–i¡
}</textarea>

200 </
td
>

201 </
Œ
>

202 <
Œ
>

203 <
td
 
height
='28'>å¯¹äºå·²å­˜åœ¨æ–‡ä»¶å¤„ç†æ–¹æ³•ï¼š</td>

204 <
td
>

205 <
šput
 
Çme
='i¤•Ïû' 
ty³
='¿dio' 
v®ue
='1' 
checked
='checked' />

207 <
šput
 
Çme
='i¤•Ïû' 
ty³
='¿dio' 
v®ue
='3' />

209 <
šput
 
ty³
='¿dio' 
Çme
='i¤•Ïû' 
v®ue
='0' />

211 </
td
>

212 </
Œ
>

213 </
bË
>

215 
$wš
->
AddMsgI‹m
("<div style='padding-left:10px;line-height:150%'>$msg</div>");

216 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok","");

217 
	g$wš
->
Di¥Ïy
();

218 
	g$dm
->
CË¬
();

219 
ex™
();

224 if(
	g$aùiÚ
=='setupstart')

226 if(!
is_wr™—bË
(
$mdœ
))

228 
ShowMsg
("ç›®å½• {$mdir} ä¸æ”¯æŒå†™å…¥ï¼Œè¿™å°†å¯¼è‡´å®‰è£…ç¨‹åºæ²¡æ³•æ­£å¸¸åˆ›å»ºï¼","-1");

229 
ex™
();

231 
	g$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

233 
	g$mšfos
 = 
$dm
->
G‘ModuËInfo
(
$hash
);

234 
exŒaù
(
$mšfos
, 
EXTR_SKIP
);

236 
	g$m’u¡ršg
 = 
add¦ashes
(
$dm
->
G‘Sy¡emFe
(
$hash
,'menustring'));

237 
	g$šdexu¾
 = 
¡r_»¶aû
('**', '=', 
$šdexu¾
);

239 
	g$qu”y
 = "INSERT INTO `#@__sys_module`(`hashcode` , `modname` , `indexname` , `indexurl` , `ismember` , `menustring` )

240 
VALUES
 ('$hash' , '$name' , '$indexname' , '$indexurl' , '$ismember' , '$menustring' ) ";

242 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__sys_module` WHERE hashcode LIKE '$hash' ");

243 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

244 if(!
	g$rs
)

246 
ShowMsg
('ä¿å­˜æ•°æ®åº“ä¿¡æ¯å¤±è´¥ï¼Œæ— æ³•å®Œæˆå®‰è£…ï¼'.
$dsql
->
G‘E¼Ü
(),'javascript:;');

247 
ex™
();

250 
	g$dm
->
Wr™eFes
(
$hash
,
$i¤•Ïû
);

251 
	g$f’ame
 = '';

252 if(!
is£t
(
$auto£tup
è|| 
	g$auto£tup
==0è
$f’ame
 = 
$dm
->
Wr™eSy¡emFe
(
$hash
, 'setup');

253 if(!
is£t
(
$autod–
è|| 
	g$autod–
==0è
$dm
->
Wr™eSy¡emFe
(
$hash
, 'uninstall');

254 
	g$dm
->
Wr™eSy¡emFe
(
$hash
,'readme');

255 
	g$dm
->
CË¬
();

258 if(!
is£t
(
$auto£tup
è|| 
	g$auto£tup
==0)

260 
šşude
(
XAKDATA
.'/moduË/'.
$f’ame
);

261 
ex™
();

266 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
(
TRUE
);

268 
	g$£tupsql
 = 
$dm
->
G‘Sy¡emFe
(
$hash
, 'setupsql40');

270 
	g$£tupsql
 = 
´eg_»¶aû
("#ENGINE=MyISAM#i", 'TYPE=MyISAM', 
$£tupsql
);

271 
	g$sql41tmp
 = 'ENGINE=MyISAM DEFAULT CHARSET='.
$cfg_db_Ïnguage
;

273 if(
	g$mysql_v”siÚ
 >= 4.1)

275 
$£tupsql
 = 
´eg_»¶aû
("#TYPE=MyISAM#i", 
$sql41tmp
, $setupsql);

279 if(
	g$cfg_cm¥©h
=='/'è
$cfg_cm¥©h
 = '';

281 
	g$roÙu¾
 = 
$cfg_ba£ho¡
.
$cfg_cm¥©h
;

283 
	g$£tupsql
 = 
´eg_»¶aû
("#_ROOTURL_#i", 
$roÙu¾
, 
$£tupsql
);

284 
	g$£tupsql
 = 
´eg_»¶aû
("#[\r\n]{1,}#", "\n", 
$£tupsql
);

286 
	g$sqls
 = @
¥l™
(";[ \t]{0,}\n", 
$£tupsql
);

287 
fÜ—ch
(
$sqls
 
as
 
$sql
)

289 if(
Œim
(
$sql
)!=''è
$dsql
->
Execu‹NÚeQu”y
($sql);

292 
ReWr™eCÚfigAuto
();

294 
	g$ræwá
 = "<script†anguage='javascript'ype='text/javascript'>\r\n";

295 
	g$ræwá
 .= "if(window.navigator.userAgent.indexOf('MSIE')>=1)op.document.frames.menu.location = 'index_menu_module.php';\r\n";

296 
	g$ræwá
 .= "elseop.document.getElementById('menufra').src = 'index_menu_module.php';\r\n";

297 
	g$ræwá
 .= "</script>";

298 
echo
 
	g$ræwá
;

300 
UpD©eC©Cache
();

301 
S’dD©a
(
$hash
);

302 
ShowMsg
('æ¨¡å—å®‰è£…å®Œæˆ...', 'module_main.php');

303 
ex™
();

309 if(
	g$aùiÚ
=='del')

311 
$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

312 
	g$šfos
 = 
$dm
->
G‘ModuËInfo
(
$hash
);

314 if(
	g$šfos
['u¾']==''è
$šfos
['url'] = '&nbsp;';

315 
	g$®”tMsg
 = (
$šfos
['Ïng']==
$cfg_soá_Ïng
 ? '' : '<br /><font color="red">(è¿™ä¸ªæ¨¡å—çš„è¯­è¨€ç¼–ç ä¸ä½ ç³»ç»Ÿçš„ç¼–ç ä¸ä¸€è‡´ï¼Œè¯·å‘å¼€å‘è€…ç¡®è®¤å®ƒçš„å…¼å®¹æ€§)</font>');

317 
	g$wš
 = 
Ãw
 
OxWšdow
();

318 
	g$wš
->
In™
("module_main.php", "js/blank.js", "post");

319 
	g$wecome_šfo
 = "æ¨¡å—ç®¡ç†";

320 
	g$wš
->
AddT™Ë
("<a href='module_main.php'>æ¨¡å—ç®¡ç†</a> &gt;&gt; åˆ é™¤æ¨¡å—ï¼š {$infos['name']}");

321 
	g$wš
->
AddHidd’
('hash', 
$hash
);

322 
	g$wš
->
AddHidd’
('action', 'delok');

323 
	g$msg
 = "<style>.dtb{border-bottom:1px dotted #cccccc}</style>

324 <
bË
 
width
='750' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

325 <
Œ
>

326 <
td
 
width
='200' 
height
='28' 
şass
='dtb'>æ¨¡å—åç§°ï¼š</td>

327 <
td
 
width
='550' 
şass
='dtb'>{
$šfos
['name']}</td>

328 </
Œ
>

329 <
Œ
>

330 <
td
 
height
='28' 
şass
='dtb'>è¯­è¨€ï¼š</td>

331 <
td
 
şass
='dtb'>{
$šfos
['Ïng']} {
$®”tMsg
}</td>

332 </
Œ
>

333 <
Œ
>

334 <
td
 
width
='200' 
height
='28' 
şass
='dtb'>æ–‡ä»¶å¤§å°ï¼š</td>

335 <
td
 
width
='550' 
şass
='dtb'>{
$šfos
['filesize']}</td>

336 </
Œ
>

337 <
Œ
>

338 <
td
 
height
='28' 
şass
='dtb'>å›¢é˜Ÿåç§°ï¼š</td>

339 <
td
 
şass
='dtb'>{
$šfos
['team']}</td>

340 </
Œ
>

341 <
Œ
>

342 <
td
 
height
='28' 
şass
='dtb'>å‘å¸ƒæ—¶é—´ï¼š</td>

343 <
td
 
şass
='dtb'>{
$šfos
['time']}</td>

344 </
Œ
>

345 <
Œ
>

346 <
td
 
height
='28' 
şass
='dtb'>ç”µå­é‚®ç®±ï¼š</td>

347 <
td
 
şass
='dtb'>{
$šfos
['email']}</td>

348 </
Œ
>

349 <
Œ
>

350 <
td
 
height
='28' 
şass
='dtb'>å®˜æ–¹ç½‘å€ï¼š</td>

351 <
td
 
şass
='dtb'>{
$šfos
['url']}</td>

352 </
Œ
>

353 <
Œ
>

354 <
td
 
height
='28' 
şass
='dtb'>ä½¿ç”¨åè®®ï¼š</td>

355 <
td
 
şass
='dtb'><
a
 
h»f
='moduË_maš.php?aùiÚ=show»adme&hash={$hash}' 
rg‘
='_blank'>ç‚¹å‡»æµè§ˆ...</a></td>

356 </
Œ
>

357 <
Œ
>

358 <
td
 
height
='28' 
cŞ¥ª
='2'>

359 åˆ é™¤æ¨¡å—ä»…åˆ é™¤è¿™ä¸ªæ¨¡å—çš„å®‰è£…åŒ…æ–‡ä»¶ï¼Œå¦‚æœä½ å·²ç»å®‰è£…ï¼Œè¯·æ‰§è¡Œ<
a
 
h»f
='moduË_maš.php?hash={$hash}&aùiÚ=unš¡®l'><
u
>å¸è½½ç¨‹åº</u></a>æ¥åˆ é™¤ï¼

360 </
td
>

361 </
Œ
>

362 </
bË
>

364 
$wš
->
AddMsgI‹m
("<div style='padding-left:10px;line-height:150%'>$msg</div>");

365 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok","");

366 
	g$wš
->
Di¥Ïy
();

367 
	g$dm
->
CË¬
();

368 
ex™
();

370 if(
	g$aùiÚ
=='delok')

372 
$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

373 
	g$modfe
 = 
$mdœ
."/".
$dm
->
G‘HashFe
(
$hash
);

374 
uÆšk
(
$modfe
è
Ü
 
d›
("åˆ é™¤æ–‡ä»¶ {$modfile} å¤±è´¥ï¼");

375 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªæ¨¡å—æ–‡ä»¶ï¼","module_main.php");

376 
ex™
();

381 if(
	g$aùiÚ
=='uninstall')

383 
$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

384 
	g$šfos
 = 
$dm
->
G‘ModuËInfo
(
$hash
);

386 if(
	g$šfos
['u¾']==''è
$šfos
['url'] = '&nbsp;';

387 
	g$®”tMsg
 = (
$šfos
['Ïng']==
$cfg_soá_Ïng
 ? '' : '<br /><font color="red">(è¿™ä¸ªæ¨¡å—çš„è¯­è¨€ç¼–ç ä¸ä½ ç³»ç»Ÿçš„ç¼–ç ä¸ä¸€è‡´ï¼Œè¯·å‘å¼€å‘è€…ç¡®è®¤å®ƒçš„å…¼å®¹æ€§)</font>');

389 
	g$f–i¡s
 = 
$dm
->
G‘FeLi¡s
(
$hash
);

390 
	g$f–i¡
 = '';

391 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

393 if(
em±y
(
$v
['name'])) ;

394 if(
	g$v
['ty³']=='dœ'è
$v
['type'] = 'ç›®å½•';

395 
	g$v
['type'] = 'æ–‡ä»¶';

396 
	g$f–i¡
 .= "{$v['type']}|{$v['name']}\r\n";

398 
	g$wš
 = 
Ãw
 
OxWšdow
();

399 
	g$wš
->
In™
("module_main.php", "js/blank.js", "post");

400 
	g$wecome_šfo
 = "æ¨¡å—ç®¡ç†";

401 
	g$wš
->
AddT™Ë
("<a href='module_main.php'>æ¨¡å—ç®¡ç†</a> &gt;&gt; å¸è½½æ¨¡å—ï¼š {$infos['name']}");

402 
	g$wš
->
AddHidd’
("hash",
$hash
);

403 
	g$wš
->
AddHidd’
("action",'uninstallok');

404 
	g$msg
 = "<style>.dtb{border-bottom:1px dotted #cccccc}</style>

405 <
bË
 
width
='750' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

406 <
Œ
>

407 <
td
 
width
='200' 
height
='28' 
şass
='dtb'>æ¨¡å—åç§°ï¼š</td>

408 <
td
 
width
='550' 
şass
='dtb'>{
$šfos
['name']}</td>

409 </
Œ
>

410 <
Œ
>

411 <
td
 
height
='28' 
şass
='dtb'>è¯­è¨€ï¼š</td>

412 <
td
 
şass
='dtb'>{
$šfos
['Ïng']} {
$®”tMsg
}</td>

413 </
Œ
>

414 <
Œ
>

415 <
td
 
width
='200' 
height
='28' 
şass
='dtb'>æ–‡ä»¶å¤§å°ï¼š</td>

416 <
td
 
width
='550' 
şass
='dtb'>{
$šfos
['filesize']}</td>

417 </
Œ
>

418 <
Œ
>

419 <
td
 
height
='28' 
şass
='dtb'>å›¢é˜Ÿåç§°ï¼š</td>

420 <
td
 
şass
='dtb'>{
$šfos
['team']}</td>

421 </
Œ
>

422 <
Œ
>

423 <
td
 
height
='28' 
şass
='dtb'>å‘å¸ƒæ—¶é—´ï¼š</td>

424 <
td
 
şass
='dtb'>{
$šfos
['time']}</td>

425 </
Œ
>

426 <
Œ
>

427 <
td
 
height
='28' 
şass
='dtb'>ç”µå­é‚®ç®±ï¼š</td>

428 <
td
 
şass
='dtb'>{
$šfos
['email']}</td>

429 </
Œ
>

430 <
Œ
>

431 <
td
 
height
='28' 
şass
='dtb'>å®˜æ–¹ç½‘å€ï¼š</td>

432 <
td
 
şass
='dtb'>{
$šfos
['url']}</td>

433 </
Œ
>

434 <
Œ
>

435 <
td
 
height
='28' 
şass
='dtb'>ä½¿ç”¨åè®®ï¼š</td>

436 <
td
 
şass
='dtb'><
a
 
h»f
='moduË_maš.php?aùiÚ=show»adme&hash={$hash}' 
rg‘
='_blank'>ç‚¹å‡»æµè§ˆ...</a></td>

437 </
Œ
>

438 <
Œ
>

439 <
td
 
height
='28'>æ¨¡å—åŒ…å«çš„æ–‡ä»¶ï¼š<
br
 />(æ–‡ä»¶è·¯å¾„ç›¸å¯¹äºå½“å‰ç›®å½•)</td><td>&
nb¥
;</
	gtd
>

440 </
	gŒ
>

441 <
	gŒ
>

442 <
td
 
	gheight
='164' 
cŞ¥ª
='2'>

443 <
‹x»a
 
Çme
='f–i¡s' 
id
='f–i¡s' 
¡yË
='width:90%;height:200px'>{
$f–i¡
}</textarea>

444 </
td
>

445 </
Œ
>

446 <
Œ
>

447 <
td
 
height
='28'>å¯¹äºæ¨¡å—çš„æ–‡ä»¶å¤„ç†æ–¹æ³•ï¼š</td>

448 <
td
>

449 <
šput
 
ty³
='¿dio' 
Çme
='i¤•Ïû' 
v®ue
='0' 
checked
='checked' />

451 <
šput
 
Çme
='i¤•Ïû' 
ty³
='¿dio' 
v®ue
='2' />

453 </
td
>

454 </
Œ
>

455 </
bË
>

457 
$wš
->
AddMsgI‹m
("<div style='padding-left:10px;line-height:150%'>$msg</div>");

458 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok","");

459 
	g$wš
->
Di¥Ïy
();

460 
	g$dm
->
CË¬
();

461 
ex™
();

466 if(
	g$aùiÚ
=='uninstallok')

468 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__sys_module` WHERE hashcode LIKE '$hash' ");

469 
	g$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

471 
	g$mšfos
 = 
$dm
->
G‘ModuËInfo
(
$hash
);

472 
exŒaù
(
$mšfos
, 
EXTR_SKIP
);

474 if(!
is£t
(
$moduËty³
è|| 
	g$moduËty³
 != 'patch' )

476 
$dm
->
D–‘eFes
(
$hash
, 
$i¤•Ïû
);

478 @
	g$dm
->
D–Sy¡emFe
(
$hash
, 'readme');

479 @
	g$dm
->
D–Sy¡emFe
(
$hash
, 'setup');

480 
	g$dm
->
CË¬
();

481 if(!
is£t
(
$autod–
è|| 
	g$autod–
==0)

483 
šşude
(
XAKDATA
."/module/{$hash}-uninstall.php");

484 @
uÆšk
(
XAKDATA
."/module/{$hash}-uninstall.php");

485 
ex™
();

489 @
	g$dm
->
D–Sy¡emFe
(
$hash
, 'uninstall');

490 
	g$d–sql
 = 
$dm
->
G‘Sy¡emFe
(
$hash
, 'delsql');

491 if(
Œim
(
$d–sql
)!='')

493 
$sqls
 = 
ex¶ode
(';', 
$d–sql
);

494 
fÜ—ch
(
$sqls
 
as
 
$sql
)

496 if(
Œim
(
$sql
)!=''è
$dsql
->
Execu‹NÚeQu”y
($sql);

500 
ReWr™eCÚfigAuto
();

502 
	g$ræwá
 = "<script†anguage='javascript'ype='text/javascript'>\r\n";

503 
	g$ræwá
 .= "if(window.navigator.userAgent.indexOf('MSIE')>=1)op.document.frames.menu.location = 'index_menu_module.php';\r\n";

504 
	g$ræwá
 .= "elseop.document.getElementById('menufra').src = 'index_menu_module.php';\r\n";

505 
	g$ræwá
 .= "</script>";

506 
echo
 
	g$ræwá
;

507 
S’dD©a
(
$hash
,2);

508 
ShowMsg
('æ¨¡å—å¸è½½å®Œæˆ...','module_main.php');

509 
ex™
();

515 if(
	g$aùiÚ
=='showreadme')

517 
$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

518 
	g$msg
 = 
$dm
->
G‘Sy¡emFe
(
$hash
,'readme');

519 
	g$msg
 = 
´eg_»¶aû
("/(.*)<body/isU","",
$msg
);

520 
	g$msg
 = 
´eg_»¶aû
("/<\/body>(.*)/isU","",
$msg
);

521 
	g$dm
->
CË¬
();

522 
	g$wš
 = 
Ãw
 
OxWšdow
();

523 
	g$wš
->
In™
("module_main.php","js/blank.js","post");

524 
	g$wecome_šfo
 = "æ¨¡å—ç®¡ç†";

525 
	g$wš
->
AddT™Ë
("<a href='module_main.php'>æ¨¡å—ç®¡ç†</a> &gt;&gt; ä½¿ç”¨è¯´æ˜ï¼š");

526 
	g$wš
->
AddMsgI‹m
("<div style='padding-left:10px;line-height:150%'>$msg</div>");

527 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hand");

528 
	g$wš
->
Di¥Ïy
();

529 
ex™
();

534 if(
	g$aùiÚ
=='view')

536 
$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

537 
	g$šfos
 = 
$dm
->
G‘ModuËInfo
(
$hash
);

539 if(
	g$šfos
['u¾']==''è
$šfos
['url'] = '&nbsp;';

540 
	g$®”tMsg
 = (
$šfos
['Ïng'] =ğ
$cfg_soá_Ïng
 ? '' : '<br /><font color="red">(è¿™ä¸ªæ¨¡å—çš„è¯­è¨€ç¼–ç ä¸ä½ ç³»ç»Ÿçš„ç¼–ç ä¸ä¸€è‡´ï¼Œè¯·å‘å¼€å‘è€…ç¡®è®¤å®ƒçš„å…¼å®¹æ€§)</font>');

542 
	g$f–i¡s
 = 
$dm
->
G‘FeLi¡s
(
$hash
);

543 
	g$f–i¡
 = '';

544 
	g$£tupšfo
 = '';

545 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

547 if(
em±y
(
$v
['name'])) ;

548 if(
	g$v
['ty³']=='dœ'è
$v
['type'] = 'ç›®å½•';

549 
	g$v
['type'] = 'æ–‡ä»¶';

550 
	g$f–i¡
 .= "{$v['type']}|{$v['name']}\r\n";

552 if(
fe_exi¡s
(
XAKDATA
."/module/{$hash}-readme.php"))

554 
	g$£tupšfo
 = "å·²å®‰è£… <a href='module_main.php?action=uninstall&hash={$hash}'>å¸è½½</a>";

556 
	g$£tupšfo
 = "æœªå®‰è£… <a href='module_main.php?action=setup&hash={$hash}'>å®‰è£…</a>";

558 
	g$wš
 = 
Ãw
 
OxWšdow
();

559 
	g$wš
->
In™
("", "js/blank.js","");

560 
	g$wecome_šfo
 = "æ¨¡å—ç®¡ç†";

561 
	g$wš
->
AddT™Ë
("<a href='module_main.php'>æ¨¡å—ç®¡ç†</a> &gt;&gt; æ¨¡å—è¯¦æƒ…ï¼š {$infos['name']}");

562 
	g$msg
 = "<style>.dtb{border-bottom:1px dotted #cccccc}</style>

563 <
bË
 
width
='98%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

564 <
Œ
>

565 <
td
 
width
='20%' 
height
='28' 
şass
='dtb'>æ¨¡å—åç§°ï¼š</td>

566 <
td
 
width
='80%' 
şass
='dtb'>{
$šfos
['name']}</td>

567 </
Œ
>

568 <
Œ
>

569 <
td
 
height
='28' 
şass
='dtb'>è¯­è¨€ï¼š</td>

570 <
td
 
şass
='dtb'>{
$šfos
['Ïng']} {
$®”tMsg
}</td>

571 </
Œ
>

572 <
Œ
>

573 <
td
 
height
='28' 
şass
='dtb'>æ–‡ä»¶å¤§å°ï¼š</td>

574 <
td
 
şass
='dtb'>{
$šfos
['filesize']}</td>

575 </
Œ
>

576 <
Œ
>

577 <
td
 
height
='28' 
şass
='dtb'>æ˜¯å¦å·²å®‰è£…ï¼š</td>

578 <
td
 
şass
='dtb'>{
$£tupšfo
}</td>

579 </
Œ
>

580 <
Œ
>

581 <
td
 
height
='28' 
şass
='dtb'>å›¢é˜Ÿåç§°ï¼š</td>

582 <
td
 
şass
='dtb'>{
$šfos
['team']}</td>

583 </
Œ
>

584 <
Œ
>

585 <
td
 
height
='28' 
şass
='dtb'>å‘å¸ƒæ—¶é—´ï¼š</td>

586 <
td
 
şass
='dtb'>{
$šfos
['time']}</td>

587 </
Œ
>

588 <
Œ
>

589 <
td
 
height
='28' 
şass
='dtb'>ç”µå­é‚®ç®±ï¼š</td>

590 <
td
 
şass
='dtb'>{
$šfos
['email']}</td>

591 </
Œ
>

592 <
Œ
>

593 <
td
 
height
='28' 
şass
='dtb'>å®˜æ–¹ç½‘å€ï¼š</td>

594 <
td
 
şass
='dtb'>{
$šfos
['url']}</td>

595 </
Œ
>

596 <
Œ
>

597 <
td
 
height
='28' 
şass
='dtb'>ä½¿ç”¨åè®®ï¼š</td>

598 <
td
 
şass
='dtb'><
a
 
h»f
='moduË_maš.php?aùiÚ=show»adme&hash={$hash}' 
rg‘
='_blank'>ç‚¹å‡»æµè§ˆ...</a></td>

599 </
Œ
>

600 <
Œ
>

601 <
td
 
height
='28'>æ¨¡å—åŒ…å«çš„æ–‡ä»¶ï¼š<
br
 />(æ–‡ä»¶è·¯å¾„ç›¸å¯¹äºå½“å‰ç›®å½•)</td><td>&
nb¥
;</
	gtd
>

602 </
	gŒ
>

603 <
	gŒ
>

604 <
td
 
	gheight
='164' 
cŞ¥ª
='2'>

605 <
‹x»a
 
Çme
='f–i¡s' 
id
='f–i¡s' 
¡yË
='width:90%;height:200px'>{
$f–i¡
}</textarea>

606 </
td
>

607 </
Œ
>

608 </
bË
>

610 
$wš
->
AddMsgI‹m
("<div style='padding-left:10px;line-height:150%'>$msg</div>");

611 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('hand', '');

612 
	g$wš
->
Di¥Ïy
();

613 
	g$dm
->
CË¬
();

614 
ex™
();

619 if(
	g$aùiÚ
=='edit')

621 
$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

623 
	g$mšfos
 = 
$dm
->
G‘ModuËInfo
(
$hash
);

624 
exŒaù
(
$mšfos
, 
EXTR_SKIP
);

626 if(!
is£t
(
$Ïng
)è
	g$Ïng
 = 'gb2312';

627 if(!
is£t
(
$moduËty³
)è
	g$moduËty³
 = 'soft';

629 
	g$m’u¡ršg
 = 
$dm
->
G‘Sy¡emFe
(
$hash
, 'menustring');

630 
	g$£tupsql40
 = 
html¥ecŸlch¬s
(
$dm
->
G‘Sy¡emFe
(
$hash
, 'setupsql40'));

631 
	g$»adm‘xt
 = 
$dm
->
G‘Sy¡emFe
(
$hash
, 'readme');

632 
	g$d–sql
 = 
$dm
->
G‘Sy¡emFe
(
$hash
, 'delsql');

633 
	g$f–i¡
 = 
$dm
->
G‘Sy¡emFe
(
$hash
,'Şdf–i¡',
çl£
);

634 
	g$šdexu¾
 = 
¡r_»¶aû
('**', '=', 
$šdexu¾
);

635 
	g$dm
->
CË¬
();

637 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/templets/module_edit.htm');

638 
ex™
();

643 if(
	g$aùiÚ
=='download')

645 
echo
 '';

	@E:\web\weixun\xakadmin\module_make.php

1 <?
	gphp


7 @
£t_time_lim™
(0);

8 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/xakmodule.class.php");

10 
CheckPurv›w
('sys_module');

11 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

13 if(
	g$aùiÚ
=='')

15 
$moduËs
 = 
¬¿y
();

16 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/module_make.htm");

17 
ex™
();

23 if(
	g$aùiÚ
=='gethash')

25 
echo
 
md5
(
$moduÊame
.
$ema
);

26 
ex™
();

32 if(
	g$aùiÚ
=='make')

34 
$f–i¡
 = 
¡r_»¶aû
("\r", "\n", 
Œim
($filelist));

35 
	g$f–i¡
 = 
Œim
(
´eg_»¶aû
("#[\n]{1,}#", "\n", 
$f–i¡
));

36 if(
	g$f–i¡
=='')

38 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æŒ‡å®šæ¨¡å—çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå› æ­¤ä¸èƒ½åˆ›å»ºé¡¹ç›®ï¼","-1");

39 
ex™
();

43 
fÜ—ch
(
$_POST
 
as
 
$k
=>
$v
è
$$k
 = 
¡r¦ashes
($v);

45 if(!
is£t
(
$auto£tup
)è
	g$auto£tup
 = 0;

46 if(!
is£t
(
$autod–
)è
	g$autod–
 = 0;

47 
	g$mdœ
 = 
XAKDATA
.'/module';

48 
	g$hashcode
 = 
md5
(
$moduÊame
.
$ema
);

49 
	g$moduËF’ame
 = 
$mdœ
.'/'.
$hashcode
.'.xml';

50 
	g$m’u¡ršg
 = 
ba£64_’code
(
$m’u¡ršg
);

51 
	g$šdexu¾
 = 
¡r_»¶aû
('=', '**', 
$šdexu¾
);

52 
	g$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

54 if(
	g$dm
->
HasModuË
(
$hashcode
))

56 
	g$dm
->
CË¬
();

57 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ æŒ‡å®šåŒåæ¨¡å—å·²ç»å­˜åœ¨ï¼Œå› æ­¤ä¸èƒ½åˆ›å»ºé¡¹ç›®ï¼<br>å¦‚æœä½ è¦æ›´æ–°è¿™ä¸ªæ¨¡å—ï¼Œè¯·å…ˆåˆ é™¤ï¼šmodule/{$hashcode}.xml","-1");

58 
ex™
();

61 
	g$»admef
 = 
$£tupf
 = 
$unš¡®lf
 = '';

63 if(
em±y
(
$»adm‘xt
))

65 
move_u¶ßded_fe
(
$»adme
, 
$mdœ
."/{$hashcode}-r.html"è
Ü
 
d›
("ä½ æ²¡å¡«å†™è¯´æ˜æˆ–ä¸Šä¼ è¯´æ˜æ–‡ä»¶ï¼");

66 
	g$»admef
 = 
$dm
->
G‘EncodeFe
(
$mdœ
."/{$hashcode}-r.html", 
TRUE
);

70 
	g$»adm‘xt
 = "<°¡yË='lše-height:150%'>".
$»adm‘xt
;

71 
	g$»adm‘xt
 = 
´eg_»¶aû
("#[\r\n]{1,}#", "<b¸/>\r\n", 
$»adm‘xt
);

72 
	g$»adm‘xt
 .= "</p>";

73 
	g$»admef
 = 
ba£64_’code
(
Œim
(
$»adm‘xt
));

76 if(
	g$auto£tup
==0)

78 
move_u¶ßded_fe
(
$£tup
,
$mdœ
."/{$hashcode}-s.php"è
Ü
 
d›
("ä½ æ²¡ä¸Šä¼ ï¼Œæˆ–ç³»ç»Ÿæ— æ³•æŠŠsetupæ–‡ä»¶ç§»åŠ¨åˆ° module ç›®å½•ï¼");

79 
	g$£tupf
 = 
$dm
->
G‘EncodeFe
(
$mdœ
."/{$hashcode}-s.php",
TRUE
);

82 if(
	g$autod–
==0)

84 
move_u¶ßded_fe
(
$unš¡®l
, 
$mdœ
."/{$hashcode}-u.php"è
Ü
 
d›
("ä½ æ²¡ä¸Šä¼ ï¼Œæˆ–ç³»ç»Ÿæ— æ³•æŠŠuninstallæ–‡ä»¶ç§»åŠ¨åˆ° module ç›®å½•ï¼");

85 
	g$unš¡®lf
 = 
$dm
->
G‘EncodeFe
(
$mdœ
."/{$hashcode}-u.php", 
TRUE
);

88 if(
Œim
(
$£tupsql40
)=='') $setupsql40 = '';

89 
	g$£tupsql40
 = 
ba£64_’code
(
Œim
(
$£tupsql40
));

94 if(
Œim
(
$d–sql
)=='') $delsql = '';

95 
	g$d–sql
 = 
ba£64_’code
(
Œim
(
$d–sql
));

97 
	g$modulšfo
 = "<module>

98 <
ba£šfo
>

99 
Çme
={
$moduÊame
}

100 
‹am
={
$‹am
}

101 
time
={
$mtime
}

102 
ema
={
$ema
}

103 
u¾
={
$u¾
}

104 
hash
={
$hashcode
}

105 
šdexÇme
={
$šdexÇme
}

106 
šdexu¾
={
$šdexu¾
}

107 
ismemb”
={
$ismemb”
}

108 
auto£tup
={
$auto£tup
}

109 
autod–
={
$autod–
}

110 
Ïng
={
$Ïng
}

111 
moduËty³
={
$moduËty³
}

112 </
ba£šfo
>

113 <
sy¡emfe
>

114 <
m’u¡ršg
>

115 
$m’u¡ršg


116 </
m’u¡ršg
>

117 <
»adme
>

118 {
$»admef
}

119 </
»adme
>

120 <
£tupsql40
>

121 
$£tupsql40


122 </
£tupsql40
>

123 <
d–sql
>

124 
$d–sql


125 </
d–sql
>

126 <
£tup
>

127 {
$£tupf
}

128 </
£tup
>

129 <
unš¡®l
>

130 {
$unš¡®lf
}

131 </
unš¡®l
>

132 <
Şdf–i¡
>

133 
$f–i¡


134 </
Şdf–i¡
>

135 </
sy¡emfe
>

138 
$f–i¡s
 = 
ex¶ode
("\n", 
$f–i¡
);

139 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

141 
	g$v
 = 
Œim
(
$v
);

142 if(!
em±y
(
$v
)è
	g$dm
->
MakeEncodeFeTe¡
(
dœÇme
(
__FILE__
), $v);

145 
	g$å
 = 
fİ’
(
$moduËF’ame
, 'w');

146 
fwr™e
(
$å
, 
$modulšfo
);

147 
fwr™e
(
$å
, "<modulefiles>\r\n");

148 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

150 
	g$v
 = 
Œim
(
$v
);

151 if(!
em±y
(
$v
)è
	g$dm
->
MakeEncodeFe
(
dœÇme
(
__FILE__
), $v, 
$å
);

153 
fwr™e
(
$å
, "</modulefiles>\r\n");

154 
fwr™e
(
$å
, "</module>\r\n");

155 
fşo£
(
$å
);

156 
ShowMsg
("æˆåŠŸå¯¹ä¸€ä¸ªæ–°æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼", "module_main.php");

157 
ex™
();

163 if(
	g$aùiÚ
=='edit')

165 
$f–i¡
 = 
¡r_»¶aû
("\r", "\n", 
Œim
($filelist));

166 
	g$f–i¡
 = 
Œim
(
´eg_»¶aû
("#[\n]{1,}#", "\n", 
$f–i¡
));

167 if(
	g$f–i¡
=="")

169 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ æ²¡æœ‰æŒ‡å®šæ¨¡å—çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå› æ­¤ä¸èƒ½åˆ›å»ºé¡¹ç›®ï¼","-1");

170 
ex™
();

174 
fÜ—ch
(
$_POST
 
as
 
$k
=>
$v
è
$$k
 = 
¡r¦ashes
($v);

175 if(!
is£t
(
$auto£tup
)è
	g$auto£tup
 = 0;

176 if(!
is£t
(
$autod–
)è
	g$autod–
 = 0;

177 
	g$mdœ
 = 
XAKDATA
.'/module';

178 
	g$hashcode
 = 
$hash
;

179 
	g$moduËF’ame
 = 
$mdœ
.'/'.
$hashcode
.'.xml';

180 
	g$moduÊame
 = 
¡r_»¶aû
('=', '', 
$moduÊame
);

181 
	g$ema
 = 
¡r_»¶aû
('=', '', 
$ema
);

182 
	g$‹am
 = 
¡r_»¶aû
('=', '', 
$‹am
);

183 
	g$šdexu¾
 = 
¡r_»¶aû
('=', '**', 
$šdexu¾
);

184 
	g$m’u¡ršg
 = 
ba£64_’code
(
$m’u¡ršg
);

185 
	g$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

186 
	g$»admef
 = 
ba£64_’code
(
$»adm‘xt
);

187 
	g$£tupf
 = 
$unš¡®lf
 = '';

190 if(
is_u¶ßded_fe
(
$£tup
))

192 
move_u¶ßded_fe
(
$£tup
, 
$mdœ
."/{$hashcode}-s.php"è
Ü
 
d›
("ä½ æ²¡ä¸Šä¼ ï¼Œæˆ–ç³»ç»Ÿæ— æ³•æŠŠsetupæ–‡ä»¶ç§»åŠ¨åˆ° module ç›®å½•ï¼");

193 
	g$£tupf
 = 
$dm
->
G‘EncodeFe
(
$mdœ
."/{$hashcode}-s.php", 
TRUE
);

195 if(
	g$auto£tup
==0è
$£tupf
 = 
ba£64_’code
(
$dm
->
G‘Sy¡emFe
(
$hashcode
, 'setup'));

199 if(
is_u¶ßded_fe
(
$unš¡®l
))

201 
move_u¶ßded_fe
(
$unš¡®l
,
$mdœ
."/{$hashcode}-u.php"è
Ü
 
d›
("ä½ æ²¡ä¸Šä¼ ï¼Œæˆ–ç³»ç»Ÿæ— æ³•æŠŠuninstallæ–‡ä»¶ç§»åŠ¨åˆ° module ç›®å½•ï¼");

202 
	g$unš¡®lf
 = 
$dm
->
G‘EncodeFe
(
$mdœ
."/{$hashcode}-u.php",
Œue
);

204 if(
	g$autod–
==0è
$unš¡®lf
 = 
ba£64_’code
(
$dm
->
G‘Sy¡emFe
(
$hashcode
,'uninstall'));

207 if(
Œim
(
$£tupsql40
)=='') $setupsql40 = '';

208 
	g$£tupsql40
 = 
ba£64_’code
(
html¥ecŸlch¬s_decode
(
Œim
(
$£tupsql40
)));

212 if(
Œim
(
$d–sql
)=='') $delsql = '';

213 
	g$d–sql
 = 
ba£64_’code
(
¡r_gs
(
Œim
(
$d–sql
)));

215 
	g$modulšfo
 = "<module>

216 <
ba£šfo
>

217 
Çme
={
$moduÊame
}

218 
‹am
={
$‹am
}

219 
time
={
$mtime
}

220 
ema
={
$ema
}

221 
u¾
={
$u¾
}

222 
hash
={
$hashcode
}

223 
šdexÇme
={
$šdexÇme
}

224 
šdexu¾
={
$šdexu¾
}

225 
ismemb”
={
$ismemb”
}

226 
auto£tup
={
$auto£tup
}

227 
autod–
={
$autod–
}

228 
Ïng
={
$Ïng
}

229 
moduËty³
={
$moduËty³
}

230 </
ba£šfo
>

231 <
sy¡emfe
>

232 <
m’u¡ršg
>

233 
$m’u¡ršg


234 </
m’u¡ršg
>

235 <
»adme
>

236 {
$»admef
}

237 </
»adme
>

238 <
£tupsql40
>

239 
$£tupsql40


240 </
£tupsql40
>

241 <
d–sql
>

242 
$d–sql


243 </
d–sql
>

244 <
£tup
>

245 {
$£tupf
}

246 </
£tup
>

247 <
unš¡®l
>

248 {
$unš¡®lf
}

249 </
unš¡®l
>

250 <
Şdf–i¡
>

251 
$f–i¡


252 </
Şdf–i¡
>

253 </
sy¡emfe
>

256 if(
$»bud
=='yes')

258 
$f–i¡s
 = 
ex¶ode
("\n", 
$f–i¡
);

259 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

261 
	g$v
 = 
Œim
(
$v
);

262 if(!
em±y
(
$v
)è
	g$dm
->
MakeEncodeFeTe¡
(
dœÇme
(
__FILE__
),$v);

265 
	g$å
 = 
fİ’
(
$moduËF’ame
, 'w');

266 
fwr™e
(
$å
, 
$modulšfo
."\r\n");

267 
fwr™e
(
$å
, "<modulefiles>\r\n");

268 
fÜ—ch
(
$f–i¡s
 
as
 
$v
)

270 
	g$v
 = 
Œim
(
$v
);

271 if(!
em±y
(
$v
)è
	g$dm
->
MakeEncodeFe
(
dœÇme
(
__FILE__
),$v,
$å
);

273 
fwr™e
(
$å
,"</modulefiles>\r\n");

274 
fwr™e
(
$å
,"</module>\r\n");

275 
fşo£
(
$å
);

277 
	g$fxml
 = 
$dm
->
G‘FeXml
(
$hashcode
);

278 
	g$å
 = 
fİ’
(
$moduËF’ame
, 'w');

279 
fwr™e
(
$å
, 
$modulšfo
."\r\n");

280 
fwr™e
(
$å
, 
$fxml
);

281 
fşo£
(
$å
);

283 
ShowMsg
("æˆåŠŸå¯¹æ¨¡å—é‡æ–°ç¼–è¯‘ï¼", "module_main.php");

284 
ex™
();

	@E:\web\weixun\xakadmin\module_upload.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_module');

9 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/xakmodule.class.php");

10 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/oxwindow.class.php");

11 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

12 
	g$mdœ
 = 
XAKDATA
.'/module';

14 if(
	g$aùiÚ
=='upload')

16 ifĞ!
is_u¶ßded_fe
(
$upfe
) )

18 
ShowMsg
("è²Œä¼¼ä½ ä»€ä¹ˆéƒ½æ²¡æœ‰ä¸Šä¼ å“¦ï¼", "javascript:;");

19 
ex™
();

23 
šşude_Úû
(
dœÇme
(
__FILE__
)."/../functions/zip.class.php");

24 
	g$tmpf’ame
 = 
$mdœ
.'/'.
ExecTime
().
mt_¿nd
(10000,50000).'.tmp';

25 
move_u¶ßded_fe
(
$upfe
, 
$tmpf’ame
è
Ü
 
d›
("æŠŠä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°{$tmpfilename}æ—¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥{$mdir}ç›®å½•æ˜¯å¦æœ‰å†™å…¥æƒé™ï¼");

29 if(
	g$f‘y³
==1)

31 
$z
 = 
Ãw
 
z
();

32 
	g$fes
 = 
$z
->
g‘_Li¡
(
$tmpf’ame
);

33 
	g$xakfešdex
 = -1;

36 if(
is_¬¿y
(
$fes
))

38 
	g$i
=0; $i<
couÁ
(
$fes
); $i++)

40 ifĞ
´eg_m©ch
Ğ"#\.xml#i", 
$fes
[
$i
]['filename']) )

42 
	g$xakfe
 = 
$fes
[
$i
]['filename'];

43 
	g$xakfešdex
 = 
$i
;

48 if(
	g$xakfešdex
==-1)

50 
uÆšk
(
$tmpf’ame
);

51 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ ä¸Šä¼ çš„å‹ç¼©åŒ…ä¸­ä¸å­˜åœ¨æ¨¡å—æ–‡ä»¶ï¼<br /><br /><a href='javascript:history.go(-1);'>&gt;&gt;è¿”å›é‡æ–°ä¸Šä¼ &gt;&gt;</a>","javascript:;");

52 
ex™
();

54 
	g$ztmp
 = 
$mdœ
.'/ziptmp';

55 
	g$z
->
ExŒaù
(
$tmpf’ame
, 
$ztmp
, 
$xakfešdex
);

56 
uÆšk
(
$tmpf’ame
);

57 
	g$tmpf’ame
 = 
$mdœ
."/ztmp/".
$xakfe
;

60 
	g$dm
 = 
Ãw
 
XakModuË
(
$mdœ
);

61 
	g$šfos
 = 
$dm
->
G‘ModuËInfo
(
$tmpf’ame
,'file');

62 if(
em±y
(
$šfos
['hash']))

64 
uÆšk
(
$tmpf’ame
);

65 
	g$dm
->
CË¬
();

66 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ ä¸Šä¼ çš„æ–‡ä»¶å¯èƒ½ä¸æ˜¯æ¨¡å—çš„æ ‡å‡†æ ¼å¼æ–‡ä»¶ï¼<br /><br /><a href='javascript:history.go(-1);'>&gt;&gt;è¿”å›é‡æ–°ä¸Šä¼ &gt;&gt;</a>","javascript:;");

67 
ex™
();

69 
	g$okfe
 = 
$mdœ
.'/'.
$šfos
['hash'].'.xml';

70 if(
	g$dm
->
HasModuË
(
$šfos
['hash']è&& 
em±y
(
$d–has
))

72 
uÆšk
(
$tmpf’ame
);

73 
	g$dm
->
CË¬
();

74 
ShowMsg
("å¯¹ä¸èµ·ï¼Œä½ ä¸Šä¼ çš„æ¨¡å—å·²ç»å­˜åœ¨ï¼Œ<br />å¦‚æœè¦è¦†ç›–è¯·å…ˆåˆ é™¤åŸæ¥ç‰ˆæœ¬æˆ–é€‰æ‹©å¼ºåˆ¶åˆ é™¤çš„é€‰é¡¹ï¼<br /><br /><a href='javascript:history.go(-1);'>&gt;&gt;è¿”å›é‡æ–°ä¸Šä¼ &gt;&gt;</a>","javascript:;");

75 
ex™
();

77 @
uÆšk
(
$okfe
);

78 
cİy
(
$tmpf’ame
,
$okfe
);

79 @
uÆšk
(
$tmpf’ame
);

80 
	g$dm
->
CË¬
();

81 
ShowMsg
("æˆåŠŸä¸Šä¼ ä¸€ä¸ªæ–°çš„æ¨¡å—ï¼","module_main.php?action=view&hash={$infos['hash']}");

82 
ex™
();

87 
	g$wš
 = 
Ãw
 
OxWšdow
();

88 
	g$wš
->
In™
("module_upload.php", "js/blank.js", "POST'ƒnctype='multipart/form-data");

89 
	g$wš
->
	gmašT™Ë
 = "æ¨¡å—ç®¡ç†";

90 
	g$wecome_šfo
 = "<a href='module_main.php'>æ¨¡å—ç®¡ç†</a> &gt;&gt; ä¸Šä¼ æ¨¡å—";

91 
	g$wš
->
AddT™Ë
('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶:');

92 
	g$wš
->
AddHidd’
("action", 'upload');

93 
	g$msg
 = "

94 <
bË
 
width
='600' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

95 <
Œ
>

96 <
td
 
height
='30'>æ–‡ä»¶æ ¼å¼ï¼š</td>

97 <
td
>

98 <
šput
 
Çme
='f‘y³' 
ty³
='¿dio' 
v®ue
='0' 
checked
='checked' />

100 <
šput
 
ty³
='¿dio' 
Çme
='f‘y³' 
v®ue
='1' />

101 ç»è¿‡ 
z
 å‹ç¼©çš„æ¨¡å—åŒ… </
td
>

102 </
Œ
>

103 <
Œ
>

104 <
td
 
height
='30'>å·²æœ‰æ¨¡å—ï¼š</td>

105 <
td
>

106 <
šput
 
Çme
='d–has' 
ty³
='checkbox' 
id
='d–has' 
v®ue
='1' /> å¼ºåˆ¶åˆ é™¤åŒåæ¨¡å—(è¿™å¯èƒ½å¯¼è‡´å·²ç»å®‰è£…çš„æ¨¡å—æ— æ³•å¸è½½)

107 </
td
>

108 </
Œ
>

109 <
Œ
>

110 <
td
 
width
='96' 
height
='60'>è¯·é€‰æ‹©æ–‡ä»¶ï¼š</td>

111 <
td
 
width
='504'>

112 <
šput
 
Çme
='upfe' 
ty³
='fe' 
id
='upfe' 
¡yË
='width:380px' /> </
td
>

113 </
Œ
>

114 </
bË
>

116 
$wš
->
AddMsgI‹m
("<div style='padding-left:20px;line-height:150%;'>$msg</div>");

117 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok', '');

118 
	g$wš
->
Di¥Ïy
();

119 
ex™
();

	@E:\web\weixun\xakadmin\mychannel_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_New');

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 if(
em±y
(
$ismake
)è
	g$ismake
 = 0;

11 if(
em±y
(
$isd–
)è
	g$isd–
 = 0;

12 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

14 if(
	g$aùiÚ
=='add')

17 if(
em±y
(
$id
è|| 
´eg_m©ch
("#[^0-9-]#", $id))

19 
ShowMsg
("<font color=red>'é¢‘é“id'</font>å¿…é¡»ä¸ºæ•°å­—ï¼","-1");

20 
ex™
();

22 if(
´eg_m©ch
("#[^a-z0-9]#i", 
$nid
è|| 
	g$nid
 == "")

24 
ShowMsg
("<font color=red>'é¢‘é“åå­—æ ‡è¯†'</font>å¿…é¡»ä¸ºè‹±æ–‡å­—æ¯æˆ–ä¸æ•°å­—æ··åˆå­—ç¬¦ä¸²ï¼","-1");

25 
ex™
();

27 if(
	g$addbË
 == "")

29 
ShowMsg
("é™„åŠ è¡¨ä¸èƒ½ä¸ºç©ºï¼","-1");

30 
ex™
();

32 
	g$ŒueTabË2
 = 
¡r_»¶aû
("#@__",
$cfg_db´efix
,
$addbË
);

34 if(
	g$issy¡em
 =ğ-1 && 
$id
>0) $id = $id * -1;

37 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__channeltype WHERE id='$id' OR‚id LIKE '$nid' OR‡ddtable LIKE '$addtable'");

38 if(
is_¬¿y
(
$row
))

40 
ShowMsg
("å¯èƒ½â€˜é¢‘é“idâ€™ã€â€˜é¢‘é“åç§°æ ‡è¯†â€™ã€â€˜é™„åŠ è¡¨åç§°â€™åœ¨æ•°æ®åº“å·²å­˜åœ¨ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨ï¼","-1");

41 
ex™
();

43 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

46 if(
	g$ŒueTabË2
!='')

48 
$i¡b
 = 
$dsql
->
IsTabË
(
$ŒueTabË2
);

49 if(!
	g$i¡b
 || 
	g$isd–
==1)

52 
$dsql
->
Execu‹NÚeQu”y
("DROP TABLE IF EXISTS `{$trueTable2}`;");

53 if(
	g$issy¡em
 != -1)

55 
$bsql
 = "CREATE TABLE `$trueTable2`(

56 `
aid
` (11è
NOT
 
NULL
  '0',

57 `
	gty³id
` (11è
NOT
 
NULL
  '0',

58 `
	g»dœeùu¾
` 
v¬ch¬
(255è
NOT
 
NULL
  '',

59 `
	g‹m¶‘
` 
v¬ch¬
(30è
NOT
 
NULL
  '',

60 `
	gu£r
` (15è
NOT
 
NULL
  '',

65 
	g$bsql
 = "CREATE TABLE `$trueTable2`(

66 `
aid
` (11è
NOT
 
NULL
  '0',

67 `
	gty³id
` (11è
NOT
 
NULL
  '0',

68 `
	gchªÃl
` 
SMALLINT
 
NOT
 
NULL
 
	gDEFAULT
 '0',

69 `
	g¬üªk
` 
SMALLINT
 
NOT
 
NULL
 
	gDEFAULT
 '0',

70 `
	gmid
` 
MEDIUMINT
Ğ8 ) 
UNSIGNED
 
NOT
 
NULL
 
	gDEFAULT
 '0',

71 `
	gşick
` 
INT
Ğ10 ) 
UNSIGNED
 
NOT
 
NULL
 
	gDEFAULT
 '0',

72 `
	gt™Ë
` 
v¬ch¬
(60è
NOT
 
NULL
  '',

73 `
	g£ndd©e
` (11è
NOT
 
NULL
  '0',

74 `
	gæag
` 
£t
('c','h','p','f','s','j','a','b'è 
	gNULL
,

75 `
	gl™pic
` 
v¬ch¬
(60è
NOT
 
NULL
  '',

76 `
	gu£r
` (15è
NOT
 
NULL
  '',

77 `
	gÏ¡po¡
` 
INT
Ğ10 ) 
UNSIGNED
 
NOT
 
NULL
 
	gDEFAULT
 '0',

78 `
	gscÜes
` 
MEDIUMINT
Ğ8 ) 
NOT
 
NULL
 
	gDEFAULT
 '0',

79 `
	ggoodpo¡
` 
MEDIUMINT
Ğ8 ) 
UNSIGNED
 
NOT
 
NULL
 
	gDEFAULT
 '0',

80 `
	gbadpo¡
` 
MEDIUMINT
Ğ8 ) 
UNSIGNED
 
NOT
 
NULL
 
	gDEFAULT
 '0',

83 if(
	g$mysql_v”siÚ
 < 4.1)

85 
	g$bsql
 .= " PRIMARY KEY (`aid`), KEY `typeid` (`typeid`)\r\n) TYPE=MyISAM; ";

89 
	g$bsql
 .ğ" PRIMARY KEY (`aid`), KEY `ty³id` (`ty³id`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

91 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

92 if(!
	g$rs
)

94 
ShowMsg
("åˆ›å»ºé™„åŠ è¡¨å¤±è´¥!".
$dsql
->
G‘E¼Ü
(),"javascript:;");

95 
ex™
();

100 
	g$li¡f›lds
 = 
$f›ld£t
 = '';

101 if(
	g$issy¡em
 == -1)

103 
$f›ld£t
 = "<field:channel itemname=\"é¢‘é“id\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"10\"…age=\"\"></field:channel>

104 <
f›ld
:
¬üªk
 
™emÇme
=\"æµè§ˆæƒé™\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"5\"…age=\"\"></field:arcrank>

105 <
f›ld
:
mid
 
™emÇme
=\"ä¼šå‘˜id\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"8\"…age=\"\"></field:mid>

106 <
f›ld
:
şick
 
™emÇme
=\"ç‚¹å‡»\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"10\"…age=\"\"></field:click>

107 <
f›ld
:
t™Ë
 
™emÇme
=\"æ ‡é¢˜\"‡utofield=\"0\"‚otsend=\"0\"ype=\"text\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"60\"…age=\"\"></field:title>

108 <
f›ld
:
£ndd©e
 
™emÇme
=\"å‘å¸ƒæ—¶é—´\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"10\"…age=\"\"></field:senddate>

109 <
f›ld
:
æag
 
™emÇme
=\"æ¨èå±æ€§\"‡utofield=\"0\"‚otsend=\"0\"ype=\"checkbox\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"10\"…age=\"\"></field:flag>

110 <
f›ld
:
l™pic
 
™emÇme
=\"ç¼©ç•¥å›¾\"‡utofield=\"0\"‚otsend=\"0\"ype=\"text\" isnull=\"true\" islist=\"0\" default=\"\" maxlength=\"60\"…age=\"\"></field:litpic>

111 <
f›ld
:
u£r
 
™emÇme
=\"ä¼šå‘˜IP\"‡utofield=\"0\"‚otsend=\"0\"ype=\"text\" isnull=\"true\" islist=\"0\" default=\"0\" maxlength=\"15\"…age=\"\"></field:userip>

112 <
f›ld
:
Ï¡po¡
 
™emÇme
=\"æœ€åè¯„è®ºæ—¶é—´\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"10\"…age=\"\"></field:lastpost>

113 <
f›ld
:
scÜes
 
™emÇme
=\"è¯„è®ºç§¯åˆ†\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"8\"…age=\"\"></field:scores>

114 <
f›ld
:
goodpo¡
 
™emÇme
=\"å¥½è¯„æ•°\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"8\"…age=\"\"></field:goodpost>

115 <
f›ld
:
badpo¡
 
™emÇme
=\"å·®è¯„æ•°\"‡utofield=\"0\"‚otsend=\"0\"ype=\"int\" isnull=\"true\" islist=\"1\" default=\"0\" maxlength=\"8\"…age=\"\"></field:badpost>\r\n";

116 
	g$li¡f›lds
 = 'channel,arcrank,mid,click,title,senddate,flag,listpic,lastpost,scores,goodpost,badpost';

119 
	g$šQu”y
 = "INSERT INTO `#@__channeltype`(id,nid,typename,addtable,addcon,mancon,editcon,useraddcon,usermancon,usereditcon,fieldset,listfields,issystem,issend,arcsta,usertype,sendrank,needdes,needpic,titlename,onlyone,dfcid)

120 
VALUES
 ('$id','$nid','$typename','$addtable','$addcon','$mancon','$editcon','$useraddcon','$usermancon','$usereditcon','$fieldset','$listfields','$issystem','$issend','$arcsta','$usertype','$sendrank','$needdes','$needpic','$titlename','$onlyone','$dfcid');";

121 
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
);

122 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªé¢‘é“æ¨¡å‹ï¼", "mychªÃl_ed™.php?id=".
$id
);

123 
ex™
();

125 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__channeltype` ORDER BY id DESC LIMIT 0,1 ");

126 
	g$Ãwid
 = 
$row
['id'] + 1;

127 if(
	g$Ãwid
 < 10è$Ãwid = 
$Ãwid
+10;

129 
»quœe_Úû
(
XAKADMIN
."/templets/mychannel_add.htm");

	@E:\web\weixun\xakadmin\mychannel_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_Edit');

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
="";

13 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

18 if(
	g$dİo¡
=="show")

20 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET isshow=1 WHERE id='$id' ");

21 
ShowMsg
("æ“ä½œæˆåŠŸï¼", "mychannel_main.php");

22 
ex™
();

24 if(
	g$dİo¡
=="hide")

26 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET isshow=0 WHERE id='$id'");

27 
ShowMsg
("æ“ä½œæˆåŠŸï¼", "mychannel_main.php");

28 
ex™
();

33 if(
	g$dİo¡
=="copystart")

35 if(
$id
==-1)

37 
ShowMsg
("ä¸“é¢˜æ¨¡å‹ä¸æ”¯æŒå¤åˆ¶ï¼","-1");

38 
ex™
();

40 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$id'");

41 if(
	g$row
['id'] > -1)

43 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT MAX(id) AS id FROM `#@__channeltype` LIMIT 0,1 ");

44 
	g$Ãwid
 = 
$Äow
['id'] + 1;

45 if(
	g$Ãwid
 < 10)

47 
	g$Ãwid
 = 
$Ãwid
 + 10;

49 
	g$idÇme
 = 
$Ãwid
;

51 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT MIN(id) AS id FROM `#@__channeltype` LIMIT 0,1 ");

52 
	g$Ãwid
 = 
$Äow
['id'] - 1;

53 if(
	g$Ãwid
 < -10)

55 
	g$Ãwid
 = 
$Ãwid
 - 10;

57 
	g$idÇme
 = 'w'.(
$Ãwid
 * -1);

59 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$id'");

60 
	g$wšt™Ë
 = "é¢‘é“ç®¡ç†-æ¨¡å‹å¤åˆ¶";

61 
	g$wecome_šfo
 = "&nbsp;<a href='mychannel_main.php'>é¢‘é“ç®¡ç†</a> - æ¨¡å‹å¤åˆ¶";

62 
	g$wš
 = 
Ãw
 
OxWšdow
();

63 
	g$wš
->
In™
("mychannel_edit.php", "js/blank.js", "post");

64 
	g$wš
->
AddT™Ë
("&nb¥;è¢«å¤åˆ¶é¢‘é“ï¼š [<fÚˆcŞÜ='»d'>".
$row
['typename']."</font>]");

65 
	g$wš
->
AddHidd’
("cid", 
$id
);

66 
	g$wš
->
AddHidd’
("id", 
$id
);

67 
	g$wš
->
AddHidd’
("dopost", 'copysave');

68 
	g$msg
 = "

69 <
bË
 
width
='460' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

70 <
Œ
>

71 <
td
 
width
='170' 
height
='24' 
®ign
='ûÁ”'>æ–°é¢‘é“
id
ï¼š</td>

72 <
td
 
width
='230'><
šput
 
Çme
='Ãwid' 
ty³
='‹xt' 
id
='Ãwid' 
size
='6' 
v®ue
='{$newid}' /></td>

73 </
Œ
>

74 <
Œ
>

75 <
td
 
height
='24' 
®ign
='center'>æ–°é¢‘é“åç§°ï¼š</td>

76 <
td
><
šput
 
Çme
='Ãwty³Çme' 
ty³
='‹xt' 
id
='Ãwty³Çme' 
v®ue
='{$row['
ty³Çme
']}{$idÇme}' 
¡yË
='width:250px' /></td>

77 </
Œ
>

78 <
Œ
>

79 <
td
 
height
='24' 
®ign
='center'>æ–°é¢‘é“æ ‡è¯†ï¼š</td>

80 <
td
><
šput
 
Çme
='Ãwnid' 
ty³
='‹xt' 
id
='Ãwnid' 
v®ue
='{$row['
nid
']}{$idÇme}' 
¡yË
='width:250px' /></td>

81 </
Œ
>

82 <
Œ
>

83 <
td
 
height
='24' 
®ign
='center'>æ–°é™„åŠ è¡¨ï¼š</td>

84 <
td
><
šput
 
Çme
='ÃwaddbË' 
ty³
='‹xt' 
id
='ÃwaddbË' 
v®ue
='{$row['
addbË
']}{$idÇme}' 
¡yË
='width:250px' /></td>

85 </
Œ
>

86 <
Œ
>

87 <
td
 
height
='24' 
®ign
='center'>å¤åˆ¶æ¨¡æ¿ï¼š</td>

88 <
td
>

89 <
šput
 
Çme
='cİy‹m¶‘' 
ty³
='¿dio' 
id
='cİy‹m¶‘' 
v®ue
='1' 
şass
='Å' 
checked
='checked' /> å¤åˆ¶

90 &
nb¥
;

91 <
šput
 
	gÇme
='cİy‹m¶‘' 
ty³
='¿dio' 
id
='cİy‹m¶‘' 
şass
='Å' 
v®ue
='0' /> ä¸å¤åˆ¶

92 </
td
>

93 </
Œ
>

94 </
bË
>

96 
$wš
->
AddMsgI‹m
("<div style='padding:20px;line-height:300%'>$msg</div>");

97 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok", "");

98 
	g$wš
->
Di¥Ïy
();

99 
ex™
();

104 if(
	g$dİo¡
=="export")

106 if(
$id
==-1)

108 
ShowMsg
("ä¸“é¢˜æ¨¡å‹ä¸æ”¯æŒå¯¼å‡ºï¼","-1");

109 
ex™
();

111 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$id' ");

112 
	g$chªÃlcÚfig
 = '';

113 
	g$row
['mašbË'] = 
´eg_»¶aû
('#xak_#', '#@__', 
$row
['maintable']);

114 
	g$row
['addbË'] = 
´eg_»¶aû
('#xak_#', '#@__', 
$row
['addtable']);

115 
fÜ—ch
(
$row
 
as
 
$k
=>
$v
)

117 if(
$k
=='f›ld£t'è
$v
 = "\r\n$v\r\n";

118 
	g$chªÃlcÚfig
 .= "<channel:{$k}>$v</channel:{$k}>\r\n";

120 
	g$wšt™Ë
 = "å¯¼å‡ºå†…å®¹æ¨¡å‹è§„åˆ™";

121 
	g$wecome_šfo
 = "<a href='mychannel_main.php'><u>å†…å®¹æ¨¡å‹ç®¡ç†</u></a>:å¯¼å‡ºå†…å®¹æ¨¡å‹è§„åˆ™";

122 
	g$wš
 = 
Ãw
 
OxWšdow
();

123 
	g$wš
->
In™
();

124 
	g$wš
->
AddT™Ë
("ä»¥ä¸‹ä¸ºè§„åˆ™ [{$row['typename']}] çš„æ¨¡å‹è§„åˆ™ï¼Œä½ å¯ä»¥å…±äº«ç»™ä½ çš„æœ‹å‹ï¼š");

125 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","<‹x»¨Çme='cÚfig' styË='width:99%;height:450px;wÜd-w¿p: b»ak-wÜd;wÜd-b»ak:b»ak-®l;'>".
$chªÃlcÚfig
."</textarea>");

126 
	g$wš
->
Di¥Ïy
();

127 
ex™
();

132 if(
	g$dİo¡
=="exportin")

134 
$wšt™Ë
 = "å¯¼å…¥å†…å®¹æ¨¡å‹è§„åˆ™";

135 
	g$wecome_šfo
 = "<a href='mychannel_main.php'>å†…å®¹æ¨¡å‹ç®¡ç†</a>:å¯¼å…¥å†…å®¹æ¨¡å‹è§„åˆ™";

136 
	g$wš
 = 
Ãw
 
OxWšdow
();

137 
	g$wš
->
In™
("mychannel_edit.php", "js/blank.js", "post");

138 
	g$wš
->
AddHidd’
("dopost", "exportinok");

139 
	g$wš
->
AddT™Ë
("è¾“å…¥è§„åˆ™å†…å®¹ï¼š(å¯¼å…¥æ¨¡å‹ä¼šå’ŒåŸæœ‰æ¨¡å‹å†²çªï¼Œä¸è¿‡å¯ä»¥åœ¨å¯¼å…¥åä¿®æ”¹)");

140 
	g$wš
->
AddMsgI‹m
("<textarea‚ame='exconfig' style='width:99%;height:450px;word-wrap: break-word;word-break:break-all;'></textarea>");

141 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

142 
	g$wš
->
Di¥Ïy
();

143 
ex™
();

148 if(
	g$dİo¡
=="exportinok")

150 
»quœe_Úû
(
XAKADMIN
."/inc/inc_admin_channel.php");

151 
funùiÚ
 
GÙoSMsg
(
$msg
)

153 
glob®
 
	g$wšt™Ë
,
	g$wecome_šfo
,
	g$wšfÜm
;

154 
	g$wšt™Ë
 = "å¯¼å…¥å†…å®¹æ¨¡å‹è§„åˆ™";

155 
	g$wecome_šfo
 = "<a href='mychannel_main.php'>å†…å®¹æ¨¡å‹ç®¡ç†</a>:å¯¼å…¥å†…å®¹æ¨¡å‹è§„åˆ™";

156 
	g$wš
 = 
Ãw
 
OxWšdow
();

157 
	g$wš
->
In™
();

158 
	g$wš
->
AddT™Ë
("æ“ä½œçŠ¶æ€æç¤ºï¼š");

159 
	g$wš
->
AddMsgI‹m
(
$msg
);

160 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hand");

161 
	g$wš
->
Di¥Ïy
();

162 
ex™
();

165 
	g$msg
 = "æ— ä¿¡æ¯";

166 
	g$excÚfig
 = 
¡r¦ashes
(
$excÚfig
);

168 
	g$d
 = 
Ãw
 
XakTagP¬£
();

169 
	g$d
->
S‘NameS·û
('channel', '<', '>');

170 
	g$d
->
LßdSourû
(
$excÚfig
);

172 if(!
is_¬¿y
(
$d
->
CTags
)è
GÙoSMsg
("æ¨¡å‹è§„åˆ™ä¸æ˜¯åˆæ³•çš„æ¨¡å‹è§„åˆ™ï¼");

174 
	g$f›lds
 = 
¬¿y
();

175 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

177 
	g$âame
 = 
$ùag
->
G‘Name
('name');

178 
	g$f›lds
[
$âame
] = 
Œim
(
$ùag
->
G‘IÂ”Text
());

181 if(!
is£t
(
$f›lds
['nid']) || !isset($fields['fieldset']))

183 
GÙoSMsg
("æ¨¡å‹è§„åˆ™ä¸æ˜¯åˆæ³•çš„æ¨¡å‹è§„åˆ™ï¼");

187 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
(
Œue
);

189 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE‚id='{$fields['nid']}' ");

190 if(
is_¬¿y
(
$row
))

192 
GÙoSMsg
("ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨ç›¸åŒæ ‡è¯† {$fields['nid']} çš„è§„åˆ™ï¼");

196 if(
	g$f›lds
['issystem'] != -1)

198 
$bsql
 = "CREATE TABLE IF NOT EXISTS `{$fields['addtable']}`(

199 `
aid
` (11è
NOT
 
NULL
  '0',

200 `
	gty³id
` (11è
NOT
 
NULL
  '0',

201 `
	g»dœeùu¾
` 
v¬ch¬
(255è
NOT
 
NULL
  '',

202 `
	g‹m¶‘
` 
v¬ch¬
(30è
NOT
 
NULL
  '',

203 `
	gu£r
` (15è
NOT
 
NULL
  '',";

207 
	g$bsql
 = "CREATE TABLE IF NOT EXISTS `{$fields['addtable']}`(

208 `
aid
` (11è
NOT
 
NULL
  '0',

209 `
	gty³id
` (11è
NOT
 
NULL
  '0',

210 `
	gchªÃl
` 
SMALLINT
 
NOT
 
NULL
 
	gDEFAULT
 '0',

211 `
	g¬üªk
` 
SMALLINT
 
NOT
 
NULL
 
	gDEFAULT
 '0',

212 `
	gmid
` 
MEDIUMINT
Ğ8 ) 
UNSIGNED
 
NOT
 
NULL
 
	gDEFAULT
 '0',

213 `
	gşick
` 
INT
Ğ10 ) 
UNSIGNED
 
NOT
 
NULL
 
	gDEFAULT
 '0',

214 `
	gt™Ë
` 
v¬ch¬
(60è
NOT
 
NULL
  '',

215 `
	g£ndd©e
` (11è
NOT
 
NULL
  '0',

216 `
	gæag
` 
£t
('c','h','p','f','s','j','a','b'è 
	gNULL
,";

218 if(
	g$mysql_v”siÚ
 < 4.1)

220 
	g$bsql
 .= " PRIMARY KEY (`aid`), KEY `typeid` (`typeid`)\r\n) TYPE=MyISAM; ";

224 
	g$bsql
 .ğ" PRIMARY KEY (`aid`), KEY `ty³id` (`ty³id`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

226 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

227 if(!
	g$rs
)

229 
GÙoSMsg
("åˆ›å»ºè¡¨å¤±è´¥!".
$dsql
->
G‘E¼Ü
());

230 
ex™
();

233 if(
	g$f›lds
['issy¡em']==1è
$f›lds
['issystem'] = 0;

234 if(
	g$f›lds
['issystem'] == 0)

236 
$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__channeltype` ORDER BY id DESC ");

237 
	g$f›lds
['Ãwid'] = 
$row
['id'] + 1;

241 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__channeltype` ORDER BY id ASC ");

242 
	g$f›lds
['Ãwid'] = 
$row
['id'] - 1;

245 
	g$f›ld£t
 = 
$f›lds
['fieldset'];

246 
	g$f›lds
['f›ld£t'] = 
add¦ashes
(
$f›lds
['fieldset']);

248 
	g$šqu”y
 = " INSERT INTO `#@__channeltype`(`id` , `nid` , `typename` , `addtable` , `addcon` ,

249 `
mªcÚ
` , `
	ged™cÚ
` , `
	gu£¿ddcÚ
` , `
	gu£rmªcÚ
` , `
	gu£»d™cÚ
` ,

250 `
	gf›ld£t
` , `
	gli¡f›lds
` , `
	gissy¡em
` , `
	gisshow
` , `
	gis£nd
` ,

251 `
	g¬c¡a
`,`
	gu£¹y³
` , `
	g£nd¿nk
` )

252 
VALUES
('{$f›lds['
Ãwid
']}' , '{$f›lds['
nid
']}' , '{$f›lds['
ty³Çme
']}' , '{$f›lds['
addbË
']}' , '{$f›lds['
addcÚ
']}' ,

253 '{$f›lds['
mªcÚ
']}' , '{$f›lds['
ed™cÚ
']}' , '{$f›lds['
u£¿ddcÚ
']}' , '{$f›lds['
u£rmªcÚ
']}' , '{$f›lds['
u£»d™cÚ
']}' ,

254 '{$f›lds['
f›ld£t
']}' , '{$f›lds['
li¡f›lds
']}' , '{$f›lds['
issy¡em
']}' , '{$f›lds['
isshow
']}' , '{$f›lds['
is£nd
']}' ,

255 '{$f›lds['
¬c¡a
']}' , '{$f›lds['
u£¹y³
']}' , '{$f›lds['
£nd¿nk
']}' ); ";

257 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

259 if(!
	g$rs
è
GÙoSMsg
("å¯¼å…¥æ¨¡å‹æ—¶å‘ç”Ÿé”™è¯¯ï¼".
$dsql
->
G‘E¼Ü
());

260 
	g$d
 = 
Ãw
 
XakTagP¬£
();

261 
	g$d
->
S‘NameS·û
("field","<",">");

262 
	g$d
->
LßdSourû
(
$f›ld£t
);

263 
	g$®lf›lds
 = '';

264 if(
is_¬¿y
(
$d
->
CTags
))

266 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

269 
	g$dty³
 = 
$ùag
->
G‘A‰
('type');

270 
	g$f›ldÇme
 = 
$ùag
->
G‘Name
();

271 
	g$dfv®ue
 = 
$ùag
->
G‘A‰
('default');

272 
	g$i¦i¡
 = 
$ùag
->
G‘A‰
('islist');

273 
	g$mxËn
 = 
$ùag
->
G‘A‰
('maxlength');

274 
	g$f›ldšfos
 = 
G‘F›ldMake
(
$dty³
,
$f›ldÇme
,
$dfv®ue
,
$mxËn
);

275 
	g$Áabsql
 = 
$f›ldšfos
[0];

276 
	g$buideTy³
 = 
$f›ldšfos
[1];

277 if(
	g$i¦i¡
!='')

279 
$®lf›lds
 .ğ($®lf›lds=='' ? 
$f›ldÇme
 : ','.$fieldname);

281 
	g$dsql
->
Execu‹NÚeQu”y
(" ALTER TABLE `{$fields['addtable']}` ADD $ntabsql ");

285 if(
	g$®lf›lds
!='')

287 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET†istfields='$allfields' WHERE id='{$fields['newid']}' ");

289 
GÙoSMsg
("æˆåŠŸå¯¼å…¥ä¸€ä¸ªæ¨¡å‹ï¼");

294 if(
	g$dİo¡
=="copysave")

296 
$cid
 = 
štv®
($cid);

297 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__chªÃÉy³` WHERE id='$cid' ", 
MYSQL_ASSOC
);

298 
fÜ—ch
(
$row
 
as
 
$k
=>
$v
)

300 
$
{
¡¹Şow”
(
$k
)} = 
add¦ashes
(
$v
);

302 
	g$šqu”y
 = " INSERT INTO `#@__channeltype`(`id` , `nid` , `typename` , `addtable` , `addcon` ,

303 `
mªcÚ
` , `
	ged™cÚ
` , `
	gu£¿ddcÚ
` , `
	gu£rmªcÚ
` , `
	gu£»d™cÚ
` , `
	gf›ld£t
` , `
	gli¡f›lds
` ,

304 `
	gissy¡em
` , `
	gisshow
` , `
	gis£nd
` , `
	g¬c¡a
`,`
	gu£¹y³
` , `
	g£nd¿nk
` )

305 
VALUES
('$newid' , '$newnid' , '$newtypename' , '$newaddtable' , '$addcon' ,

309 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
(
TRUE
);

310 if(!
	g$dsql
->
IsTabË
(
$ÃwaddbË
))

312 
	g$dsql
->
Execu‹
('me', "SHOW CREATE TABLE {$dsql->dbName}.{$addtable}");

313 
	g$row
 = 
$dsql
->
G‘A¼ay
('me', 
MYSQL_BOTH
);

314 
	g$bËSŒuù
 = 
$row
[1];

315 
	g$tb
 = 
¡r_»¶aû
('#@__', 
$cfg_db´efix
, 
$addbË
);

316 
	g$bËSŒuù
 = 
´eg_»¶aû
("/CREATE TABLE `$addbË`/iU","CREATE TABLE `$ÃwaddbË`",
$bËSŒuù
);

317 
	g$dsql
->
Execu‹NÚeQu”y
(
$bËSŒuù
);

319 if(
	g$cİy‹m¶‘
==1)

321 
$tm¶‘dœ
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
.'/'.
$cfg_df_¡yË
;

322 
cİy
("{$tmpletdir}/article_{$nid}.htm","{$tmpletdir}/{$newnid}_article.htm");

323 
cİy
("{$tmpletdir}/list_{$nid}.htm","{$tmpletdir}/{$newnid}_list.htm");

324 
cİy
("{$tmpletdir}/index_{$nid}.htm","{$tmpletdir}/{$newnid}_index.htm");

326 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

327 if(
	g$rs
)

329 
ShowMsg
("æˆåŠŸå¤åˆ¶æ¨¡å‹ï¼Œç°è½¬åˆ°è¯¦ç»†å‚æ•°é¡µ... ","mychannel_edit.php?id={$newid}&dopost=edit");

330 
ex™
();

334 
	g$”rv
 = 
$dsql
->
G‘E¼Ü
();

335 
ShowMsg
("ç³»ç»Ÿå‡ºé”™ï¼Œè¯·æŠŠé”™è¯¯ä»£ç å‘é€åˆ°å®˜æ–¹è®ºå›ï¼Œä»¥æ£€æŸ¥åŸå› ï¼<br /> é”™è¯¯ä»£ç ï¼šmychannel_edit.php?dopost=savecopy $errv","javascript:;");

336 
ex™
();

342 if(
	g$dİo¡
=="save")

344 
$f›ld£t
 = 
´eg_»¶aû
("#[\r\n]{1,}#", "\r\n", $fieldset);

345 
	g$u£¹y³
 = 
em±y
(
$u£¹y³
)? '' : $usertype;

347 
	g$qu”y
 = "Update `#@__channeltype` set

348 
ty³Çme
 = '$typename',

349 
	gaddbË
 = '$addtable',

350 
	gaddcÚ
 = '$addcon',

351 
	gmªcÚ
 = '$mancon',

352 
	ged™cÚ
 = '$editcon',

353 
	gu£¿ddcÚ
 = '$useraddcon',

354 
	gu£rmªcÚ
 = '$usermancon',

355 
	gu£»d™cÚ
 = '$usereditcon',

356 
	gf›ld£t
 = '$fieldset',

357 
	gli¡f›lds
 = '$listfields',

358 
	gis£nd
 = '$issend',

359 
	g¬c¡a
 = '$arcsta',

360 
	gu£¹y³
 = '$usertype',

361 
	g£nd¿nk
 = '$sendrank',

362 
	gÃeddes
 = '$needdes',

363 
	gÃedpic
 = '$needpic',

364 
	gt™ËÇme
 = '$titlename',

365 
	gÚlyÚe
 = '$onlyone',

366 
	gdfcid
 = '$dfcid'

367 
wh”e
 
id
='$id' ";

368 if(
Œim
(
$f›ld£t
)!='')

370 
$d
 = 
Ãw
 
XakTagP¬£
();

371 
	g$d
->
S‘NameS·û
("field", "<", ">");

372 
	g$d
->
LßdSourû
(
¡r¦ashes
(
$f›ld£t
));

373 if(!
is_¬¿y
(
$d
->
CTags
))

375 
ShowMsg
("æ–‡æœ¬é…ç½®å‚æ•°æ— æ•ˆï¼Œæ— æ³•è¿›è¡Œè§£æï¼","-1");

376 
ex™
();

379 
	g$ŒueTabË
 = 
¡r_»¶aû
("#@__", 
$cfg_db´efix
, 
$addbË
);

380 if(!
	g$dsql
->
IsTabË
(
$ŒueTabË
))

382 
ShowMsg
("ç³»ç»Ÿæ‰¾ä¸åˆ°ä½ æ‰€æŒ‡å®šçš„è¡¨ $trueTable ï¼Œè¯·æ‰‹å·¥åˆ›å»ºè¿™ä¸ªè¡¨ï¼","-1");

383 
ex™
();

385 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

386 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªæ¨¡å‹ï¼","mychannel_main.php");

387 
ex™
();

392 if(
	g$dİo¡
=="gettemplets")

394 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

395 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$id'");

396 
	g$wšt™Ë
 = "&nbsp;é¢‘é“ç®¡ç†-æŸ¥çœ‹æ¨¡æ¿";

397 
	g$wecome_šfo
 = "<a href='mychannel_main.php'>é¢‘é“ç®¡ç†</a>:æŸ¥çœ‹æ¨¡æ¿";

398 
	g$wš
 = 
Ãw
 
OxWšdow
();

399 
	g$wš
->
In™
("", "js/blank.js", "");

400 
	g$wš
->
AddT™Ë
("&nb¥;é¢‘é“ï¼šï¼ˆ".
$row
['typename']."ï¼‰é»˜è®¤æ¨¡æ¿æ–‡ä»¶è¯´æ˜ï¼š");

401 
	g$deçuÉ‹m¶©e
 = 
$cfg_‹m¶‘s_dœ
.'/'.
$cfg_df_¡yË
;

402 
	g$msg
 = "

403 æ–‡æ¡£æ¨¡æ¿ï¼š{
$deçuÉ‹m¶©e
}/
¬tişe_
{
$row
['nid']}.
htm


404 <
a
 
h»f
='l.php?acdœ={$cfg_df_¡yË}&aùiÚód™&f’ame÷¹işe_{$row['
nid
']}.htm'>[ä¿®æ”¹]</a><
br
/>

405 åˆ—è¡¨æ¨¡æ¿ï¼š{
$deçuÉ‹m¶©e
}/
li¡_
{
$row
['nid']}.
htm


406 <
a
 
h»f
='l.php?acdœ={$cfg_df_¡yË}&aùiÚód™&f’ameöi¡_{$row['
nid
']}.htm'>[ä¿®æ”¹]</a>

407 <
br
/>

408 é¢‘é“å°é¢æ¨¡æ¿ï¼š{
$deçuÉ‹m¶©e
}/
šdex_
{
$row
['nid']}.
htm


409 <
a
 
h»f
='l.php?acdœ={$cfg_df_¡yË}&aùiÚód™&f’ame=šdex_{$row['
nid
']}.htm'>[ä¿®æ”¹]</a>

411 
$wš
->
AddMsgI‹m
("<div style='padding:20px;line-height:300%'>$msg</div>");

412 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hand","");

413 
	g$wš
->
Di¥Ïy
();

414 
ex™
();

419 if(
	g$dİo¡
=="delete")

421 
CheckPurv›w
('c_Del');

422 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$id'");

423 if(
	g$row
['issystem'] == 1)

425 
ShowMsg
("ç³»ç»Ÿæ¨¡å‹ä¸å…è®¸åˆ é™¤ï¼","mychannel_main.php");

426 
ex™
();

428 if(
em±y
(
$job
)è
	g$job
="";

430 if(
	g$job
 == "")

432 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

433 
	g$wšt™Ë
 = "é¢‘é“ç®¡ç†-åˆ é™¤æ¨¡å‹";

434 
	g$wecome_šfo
 = "<a href='mychannel_main.php'>é¢‘é“ç®¡ç†</a>::åˆ é™¤æ¨¡å‹";

435 
	g$wš
 = 
Ãw
 
OxWšdow
();

436 
	g$wš
->
In™
("mychannel_edit.php","js/blank.js","POST");

437 
	g$wš
->
AddHidd’
("job","yes");

438 
	g$wš
->
AddHidd’
("dİo¡",
$dİo¡
);

439 
	g$wš
->
AddHidd’
("id",
$id
);

440 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦åˆ é™¤ (".
$row
['typename'].") è¿™ä¸ªé¢‘é“ï¼Ÿ");

441 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

442 
	g$wš
->
Di¥Ïy
();

443 
ex™
();

444 } if(
	g$job
=="yes")

446 
»quœe_Úû
(
XAKINC
."/typeunit.class.admin.php");

447 
	g$myrow
 = 
$dsql
->
G‘OÃ
("SELECT‡ddbË FROM `#@__chªÃÉy³` WHERE id='$id'",
MYSQL_ASSOC
);

448 if(!
is_¬¿y
(
$myrow
))

450 
ShowMsg
('ä½ æ‰€æŒ‡å®šçš„é¢‘é“ä¿¡æ¯ä¸å­˜åœ¨!','-1');

451 
ex™
();

455 
	g$addbË
 = 
¡r_»¶aû
(
$cfg_db´efix
,'',¡r_»¶aû('#@__',$cfg_db´efix,
$myrow
['addtable']));

456 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(id) AS dd FROM `#@__channeltype` WHERE‡ddtable†ike '{$cfg_dbprefix}{$addtable}' OR‡ddtable LIKE CONCAT('#','@','__','$addtable') ; ");

457 
	g$isExşusive2
 = (
$row
['dd']>1 ? 0 : 1 );

460 
	g$tids
 = '';

461 
	g$dsql
->
Execu‹
('qm',"SELECT id FROM `#@__arctype` WHERE channeltype='$id'");

462 
	g$row
 = 
$dsql
->
G‘A¼ay
('qm'))

464 
$tids
 .ğ($tids=='' ? 
$row
['id'] : ','.$row['id']);

468 if(
	g$tids
!='')

470 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctiny` WHEREypeid IN($tids); ");

471 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `{$myrow['maintable']}` WHEREypeid IN($tids); ");

472 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__spec` WHEREypeid IN ($tids); ");

473 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__feedback` WHEREypeid IN ($tids); ");

474 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arctype` WHERE id IN ($tids); ");

478 if(
	g$isExşusive2
==1)

480 
$dsql
->
Execu‹NÚeQu”y
("DROP TABLE IF EXISTS `{$cfg_dbprefix}{$addtable}`;");

484 if(
	g$tids
!='' && 
$myrow
['addtable']!='')

486 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `{$myrow['addtable']}` WHEREypeid IN ($tids); ");

491 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__channeltype` WHERE id='$id' ");

494 
UpD©eC©Cache
(
$dsql
);

495 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªæ¨¡å‹ï¼","mychannel_main.php");

496 
ex™
();

502 if(
	g$dİo¡
 == 'modifysearch')

504 if(!
is£t
(
$¡•
)) $step=0;

505 if(
em±y
(
$¡•
))

507 
	g$¡•
 = 1;

508 
	g$mid
 = 
štv®
(
$mid
);

509 
	g$qu”y
 = "SELECT mainfields,‡ddonfields,emplate FROM #@__advancedsearch WHERE mid='$mid'";

510 
	g$£¬chšfo
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

511 if(!
is_¬¿y
(
$£¬chšfo
))

513 
	g$£¬chšfo
['mašf›lds'] = 
$£¬chšfo
['addonfields'] = $searchinfo['template'] = '';

515 
	g$£¬chšfo
['mašf›lds'] = 
ex¶ode
(',', 
$£¬chšfo
['mainfields']);

516 
	g$£¬chšfo
['addÚf›lds'] = 
ex¶ode
(',', 
$£¬chšfo
['addonfields']);

517 
	g$addÚf›ld§¼
 = 
¬¿y
();

518 
fÜ—ch
(
$£¬chšfo
['addÚf›lds'] 
as
 
$k
)

520 
	g$k¬r
 = 
ex¶ode
(':', 
$k
);

521 
	g$addÚf›ld§¼
[] = 
$k¬r
[0];

523 
	g$‹m¶©e
 = 
$£¬chšfo
['template'] == '' ? 'advancedsearch.htm' : $searchinfo['template'];

524 
	g$c1
 = 
š_¬¿y
('iscomm’d', 
$£¬chšfo
['mainfields']) ? 'checked' : '';

525 
	g$c2
 = 
š_¬¿y
('ty³id', 
$£¬chšfo
['mainfields']) ? 'checked' : '';

526 
	g$c3
 = 
š_¬¿y
('wr™”', 
$£¬chšfo
['mainfields']) ? 'checked' : '';

527 
	g$c4
 = 
š_¬¿y
('sourû', 
$£¬chšfo
['mainfields']) ? 'checked' : '';

528 
	g$c5
 = 
š_¬¿y
('£ndd©e', 
$£¬chšfo
['mainfields']) ? 'checked' : '';

530 
	g$mašf›lds
 = '<Ïb–><špuˆty³="checkbox"‚ame="mašf›lds[]" '.
$c1
.' value="iscommend" class="np" />æ˜¯å¦æ¨è</label>';

531 
	g$mašf›lds
 .ğ'<Ïb–><špuˆty³="checkbox"‚ame="mašf›lds[]" '.
$c2
.' value="typeid" class="np" />æ ç›®</label>';

533 
	g$mašf›lds
 .ğ'<Ïb–><špuˆty³="checkbox"‚ame="mašf›lds[]" '.
$c3
.' value="writer" class="np" />ä½œè€…</label>';

534 
	g$mašf›lds
 .ğ'<Ïb–><špuˆty³="checkbox"‚ame="mašf›lds[]" '.
$c4
.' value="source" class="np" />æ¥æº</label>';

535 
	g$mašf›lds
 .ğ'<Ïb–><špuˆty³="checkbox"‚ame="mašf›lds[]" '.
$c5
.' value="senddate" class="np" />å‘å¸ƒæ—¶é—´</label>';

543 
	g$qu”y
 = "SELECT * FROM `#@__channeltype` WHERE id='$mid'";

544 
	g$chªÃl
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

546 
	g$£¬chty³
 = 
¬¿y
('int', 'datetime', 'float', 'textdata', 'textchar', 'text', 'htmltext', 'multitext', 'select', 'radio', 'checkbox');

547 
	g$addÚf›lds
 = '';

548 
	g$d
 = 
Ãw
 
XakTagP¬£
();

549 
	g$d
->
S‘NameS·û
("field", "<", ">");

550 
	g$d
->
LßdSourû
(
$chªÃl
['fieldset']);

551 if(
	g$chªÃl
['issystem'] < 0)

553 
	g$checked
 = 
š_¬¿y
('ty³id', 
$addÚf›ld§¼
) ? 'checked' : '';

554 
	g$addÚf›lds
 .ğ'<Ïb–><špuˆty³="checkbox"‚ame="addÚf›lds[]" '.
$checked
.' value="typeid" class="np" />æ ç›®</label>';

555 
	g$checked
 = 
š_¬¿y
('£ndd©e', 
$addÚf›ld§¼
) ? 'checked' : '';

556 
	g$addÚf›lds
 .ğ'<Ïb–><špuˆty³="checkbox"‚ame="addÚf›lds[]" '.
$checked
.' value="senddate" class="np" />å‘å¸ƒæ—¶é—´</label>';

558 if(
is_¬¿y
(
$d
->
CTags
è&& !
em±y
($dtp->CTags))

560 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

562 
	g$d©©y³
 = 
$ùag
->
G‘A‰
('type');

563 
	g$v®ue
 = 
$ùag
->
G‘Name
();

564 if(
	g$chªÃl
['issystem'] < 0)

566 
	g$_oo
 = 
¬¿y
('channel','arcrank', 'title', 'senddate', 'mid', 'click', 'flag', 'litpic', 'userip', 'lastpost', 'scores', 'goodpost', 'badpost', 'endtime');

567 if(
š_¬¿y
(
$v®ue
, 
$_oo
)) ;

570 
	g$Ïb–
 = 
$ùag
->
G‘A‰
('itemname');

571 if(
š_¬¿y
(
$d©©y³
, 
$£¬chty³
)){

572 
	g$checked
 = 
š_¬¿y
(
$v®ue
, 
$addÚf›ld§¼
) ? 'checked' : '';

573 
	g$addÚf›lds
 .= "<label><inputype=\"checkbox\"‚ame=\"addonfields[]\" $checked value=\"$value\" class='np' />$label</label>";

577 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/templets/mychannel_modifysearch.htm");

578 } ià(
	g$¡•
 == 1)

580 
$qu”y
 = "SELECT * FROM `#@__channeltype` WHERE id='$mid'";

581 
	g$chªÃl
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

582 if(
em±y
(
$addÚf›lds
))

584 
	g$addÚf›lds
 = '';

586 
	g$‹m¶©e
 = 
Œim
(
$‹m¶©e
);

587 
	g$fÜms
 = '<fÜm‡ùiÚ="'.
$cfg_cm¥©h
.'/module/advancedsearch.php" method="post">';

588 
	g$fÜms
 .= "<inputype=\"hidden\"‚ame=\"mid\" value=\"$mid\" />";

589 
	g$fÜms
 .= "<inputype=\"hidden\"‚ame=\"dopost\" value=\"search\" />";

590 
	g$fÜms
 .= "å…³é”®è¯ï¼š<inputype=\"text\"‚ame=\"q\" /><br />";

591 
	g$maš¡ršg
 = '';

592 if(!
em±y
(
$mašf›lds
è&& 
is_¬¿y
($mainfields))

594 
	g$maš¡ršg
 = 
im¶ode
(',', 
$mašf›lds
);

595 
fÜ—ch
(
$mašf›lds
 
as
 
$mašf›ld
)

597 if(
	g$mašf›ld
 == 'typeid')

599 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/typelink.class.php");

600 
	g$
 = 
Ãw
 
Ty³Lšk
(0);

601 
	g$ty³O±iÚs
 = 
$
->
G‘O±iÚA¼ay
(0,0,
$mid
);

602 
	g$fÜms
 .= "<br />æ ç›®ï¼š<select‚ame='typeid' style='width:200'>\r\n";

603 
	g$fÜms
 .= "<option value='0' selected>--ä¸é™æ ç›®--</option>\r\n";

604 
	g$fÜms
 .ğ
$ty³O±iÚs
;

605 
	g$fÜms
 .= "</select>";

606 
	g$fÜms
 .= "<label><inputype=\"checkbox\"‚ame=\"includesons\" value=\"1\" />åŒ…å«å­æ ç›®</label><br />";

607 }ià(
	g$mašf›ld
 == 'iscommend')

609 
$fÜms
 .= "<label><inputype=\"checkbox\"‚ame=\"iscommend\" value=\"1\" />æ¨è</label><br />";

610 }ià(
	g$mašf›ld
 == 'writer')

612 
$fÜms
 .= "ä½œè€…ï¼š <inputype=\"text\"‚ame=\"writer\" value=\"\" /><br />";

613 }ià(
	g$mašf›ld
 == 'source')

615 
$fÜms
 .= "æ¥æºï¼š <inputype=\"text\"‚ame=\"source\" value=\"\" /><br />";

616 }ià(
	g$mašf›ld
 == 'senddate')

618 
$fÜms
 .= "å¼€å§‹æ—¶é—´ï¼š<inputype=\"text\"‚ame=\"startdate\" value=\"\" /><br />";

619 
	g$fÜms
 .= "ç»“æŸæ—¶é—´ï¼š<inputype=\"text\"‚ame=\"enddate\" value=\"\" /><br />";

625 
	g$addÚ¡ršg
 = '';

626 
	g$š¼
 = 
¬¿y
('int','float');

627 
	g$‹x¼
 = 
¬¿y
('textdata','textchar','text','htmltext','multitext');

629 if(
	g$chªÃl
['issystem'] < 0)

631 
fÜ—ch
(
$addÚf›lds
 
as
 
$addÚf›ld
)

633 if(
	g$addÚf›ld
 == 'typeid'){

634 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/../functions/typelink.class.php");

635 
	g$
 = 
Ãw
 
Ty³Lšk
(0);

636 
	g$ty³O±iÚs
 = 
$
->
G‘O±iÚA¼ay
(0,0,
$mid
);

637 
	g$fÜms
 .= "<br />æ ç›®ï¼š<select‚ame='typeid' style='width:200'>\r\n";

638 
	g$fÜms
 .= "<option value='0' selected>--ä¸é™æ ç›®--</option>\r\n";

639 
	g$fÜms
 .ğ
$ty³O±iÚs
;

640 
	g$fÜms
 .= "</select>";

641 
	g$fÜms
 .= "<label><inputype=\"checkbox\"‚ame=\"includesons\" value=\"1\" />åŒ…å«å­æ ç›®</label><br />";

642 
	g$addÚ¡ršg
 .= 'typeid:int,';

643 } 
–£if
(
$addÚf›ld
 == 'senddate') {

644 
$fÜms
 .= "å¼€å§‹æ—¶é—´ï¼š<inputype=\"text\"‚ame=\"startdate\" value=\"\" /><br />";

645 
	g$fÜms
 .= "ç»“æŸæ—¶é—´ï¼š<inputype=\"text\"‚ame=\"enddate\" value=\"\" /><br />";

646 
	g$addÚ¡ršg
 .= 'senddate:datetime,';

651 if(
is_¬¿y
(
$addÚf›lds
è&& !
em±y
($addonfields))

653 
	g$qu”y
 = "SELECT * FROM #@__channeltype WHERE id='$mid'";

654 
	g$chªÃl
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

656 
	g$d
 = 
Ãw
 
XakTagP¬£
();

657 
	g$d
->
S‘NameS·û
("field", "<", ">");

658 
	g$d
->
LßdSourû
(
$chªÃl
['fieldset']);

659 
	g$f›ld¬r
 = 
$™em¬r
 = 
$ty³¬r
 = 
¬¿y
();

660 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

662 
fÜ—ch
(
$addÚf›lds
 
as
 
$addÚf›ld
)

665 if(
	g$ùag
->
G‘Name
(è=ğ
$addÚf›ld
)

667 if(
$addÚf›ld
 == 'typeid' || $addonfield == 'senddate') ;

669 
	g$f›ld¬r
[] = 
$addÚf›ld
;

670 
	g$™em¬r
[] = 
$ùag
->
G‘A‰
('itemname');

671 
	g$ty³¬r
[] = 
$ùag
->
G‘A‰
('type');

672 
	g$v®u—¼
[] = 
$ùag
->
G‘A‰
('default');

677 
fÜ—ch
(
$f›ld¬r
 
as
 
$k
=>
$f›ld
)

679 
$™emÇme
 = 
$™em¬r
[
$k
];

680 
	g$Çme
 = 
$f›ld
;

681 
	g$ty³
 = 
$ty³¬r
[
$k
];

682 
	g$tmp
 = 
$Çme
.':'.
$ty³
;

683 if(
š_¬¿y
(
$ty³
, 
$š¼
))

685 
	g$fÜms
 .ğ"<b¸/>$™emÇm: <špuˆty³=\"‹xt\"‚ame=\"¡¬t".
$Çme
."\" value=\"\" /> åˆ° <inputype=\"text\"‚ame=\"end".$name."\" value=\"\" /><br />";

686 } ià(
š_¬¿y
(
$ty³
, 
$‹x¼
))

688 
	g$fÜms
 .= "$itemname : <inputype=\"text\"‚ame=\"$name\" value=\"\" /><br />";

690 } ià(
	g$ty³
 == 'select')

692 
$v®ues
 = 
ex¶ode
(',', 
$v®u—¼
[
$k
]);

693 if(
is_¬¿y
(
$v®ues
è&& !
em±y
($values))

695 
	g$fÜms
 .= "<br />$itemname : <select‚ame=\"$name\" ><option value=\"\">ä¸é™</option>";

696 
fÜ—ch
(
$v®ues
 
as
 
$v®ue
)

698 
	g$fÜms
 .= "<option value=\"$value\">$value</option>";

700 
	g$fÜms
 .= "</select>";

702 } ià(
	g$ty³
 == 'radio')

704 
$v®ues
 = 
ex¶ode
(',', 
$v®u—¼
[
$k
]);

705 if(
is_¬¿y
(
$v®ues
è&& !
em±y
($values)){

706 
	g$fÜms
 .ğ"<b¸/>$™emÇm: <Ïb–><špuˆty³=\"¿dio\"‚ame=\"".
$Çme
."\" value=\"\" checked />ä¸é™</label>";

707 
fÜ—ch
(
$v®ues
 
as
 
$v®ue
){

708 
	g$fÜms
 .ğ"<Ïb–><špuˆty³=\"¿dio\"‚ame=\"".
$Çme
."\" value=\"$value\" />$value</label>";

711 } ià(
	g$ty³
 == 'checkbox')

713 
$v®ues
 = 
ex¶ode
(',', 
$v®u—¼
[
$k
]);

714 if(
is_¬¿y
(
$v®ues
è&& !
em±y
($values))

716 
	g$fÜms
 .= "<br />$itemname : ";

717 
fÜ—ch
(
$v®ues
 
as
 
$v®ue
)

719 
	g$fÜms
 .ğ"<Ïb–><špuˆty³=\"checkbox\"‚ame=\"".
$Çme
."[]\" value=\"$value\" />$value</label>";

723 }
–£if
(
$ty³
 == 'datetime'){

724 
$fÜms
 .= "<br />å¼€å§‹æ—¶é—´ï¼š<inputype=\"text\"‚ame=\"startdate\" value=\"\" /><br />";

725 
	g$fÜms
 .= "ç»“æŸæ—¶é—´ï¼š<inputype=\"text\"‚ame=\"enddate\" value=\"\" /><br />";

727 
	g$tmp
 = '';

729 
	g$addÚ¡ršg
 .ğ
$tmp
.',';

732 
	g$fÜms
 .= '<inputype="submit"‚ame="submit" value="å¼€å§‹æœç´¢" /></form>';

733 
	g$fÜmssql
 = 
add¦ashes
(
$fÜms
);

734 
	g$qu”y
 = "REPLACE INTO #@__advancedsearch(mid, maintable, mainfields,‡ddontable,‡ddonfields, forms,emplate) VALUES('$mid','$maintable','$mainstring','$addontable','$addonstring','$formssql', '$template')";

735 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

736 
	g$fÜmshtml
 = 
html¥ecŸlch¬s
(
$fÜms
);

737 
	gecho
 '<m‘¨h‰p-equiv="CÚ‹Á-Ty³" cÚ‹Á="‹xt/html; ch¬£t='.
	g$cfg_soá_Ïng
.'">';

738 
	gecho
 "ä¸‹é¢ä¸ºç”Ÿæˆçš„htmlè¡¨å•ï¼Œè¯·è‡ªè¡Œå¤åˆ¶ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚ä¿®æ”¹æ ·å¼åç²˜è´´åˆ°å¯¹åº”çš„æ¨¡æ¿ä¸­<br><br><‹x»¨cŞs=\"100\"„ows=\"10\">".
	g$fÜms
."</textarea>";

739 
	gecho
 '<br />é¢„è§ˆï¼š<br /><hr>';

740 
echo
 
	g$fÜms
;

742 
	gex™
;

745 if(
	g$dİo¡
 == 'del')

747 
$mid
 = 
štv®
($mid);

748 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__advancedsearch` WHERE mid = '$mid'; ");

749 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªè‡ªå®šä¹‰æœç´¢ï¼","mychannel_main.php");

750 
ex™
();

752 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__channeltype` WHERE id='$id' ");

753 
»quœe_Úû
(
XAKADMIN
."/templets/mychannel_edit.htm");

	@E:\web\weixun\xakadmin\mychannel_field_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_New');

9 
»quœe_Úû
(
XAKADMIN
."/inc/inc_admin_channel.php");

10 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

12 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

13 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

18 if(
	g$aùiÚ
=='save')

21 
$dfv®ue
 = 
Œim
(
$vdeçuÉ
);

22 
	g$i¢uÎ
 = (
$i¢uÎ
==1 ? "true" : "false");

23 
	g$mxËn
 = 
$maxËngth
;

25 if(
´eg_m©ch
("#^(£Ëù|¿dio|checkbox)$#i", 
$dty³
))

27 if(!
´eg_m©ch
("#,#", 
$dfv®ue
))

29 
ShowMsg
("ä½ è®¾å®šäº†å­—æ®µä¸º {$dtype} ç±»å‹ï¼Œå¿…é¡»åœ¨é»˜è®¤å€¼ä¸­æŒ‡å®šå…ƒç´ åˆ—è¡¨ï¼Œå¦‚ï¼š'a,b,c' ","-1");

30 
ex™
();

34 if(
	g$dty³
=='stepselect')

36 
$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__stepselect` WHEREƒgroup='$fieldname' ");

37 if(!
is_¬¿y
(
$¬r
))

39 
ShowMsg
("ä½ è®¾å®šäº†å­—æ®µä¸ºè”åŠ¨ç±»å‹ï¼Œä½†ç³»ç»Ÿä¸­æ²¡æ‰¾åˆ°ä¸ä½ å®šä¹‰çš„å­—æ®µåç›¸åŒçš„è”åŠ¨ç»„å!","-1");

40 
ex™
();

45 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT fieldset,addtable,issystem FROM `#@__channeltype` WHERE id='$id'");

46 
	g$f›ld£t
 = 
$row
['fieldset'];

47 
	g$d
 = 
Ãw
 
XakTagP¬£
();

48 
	g$d
->
S‘NameS·û
("field", "<", ">");

49 
	g$d
->
LßdSourû
(
$f›ld£t
);

50 
	g$ŒueTabË
 = 
$row
['addtable'];

53 
	g$f›ldšfos
 = 
G‘F›ldMake
(
$dty³
, 
$f›ldÇme
, 
$dfv®ue
, 
$mxËn
);

54 
	g$Áabsql
 = 
$f›ldšfos
[0];

55 
	g$buideTy³
 = 
$f›ldšfos
[1];

56 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(" ALTER TABLE `$trueTable` ADD $ntabsql ");

57 if(!
	g$rs
)

59 
	g$g”r
 = 
$dsql
->
G‘E¼Ü
();

60 
ShowMsg
("å¢åŠ å­—æ®µå¤±è´¥ï¼Œé”™è¯¯æç¤ºä¸ºï¼š".
$g”r
,"javascript:;");

61 
ex™
();

65 
	g$ok
 = 
FALSE
;

66 
	g$f›ldÇme
 = 
¡¹Şow”
(
$f›ldÇme
);

67 if(
is_¬¿y
(
$d
->
CTags
))

69 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

71 if(
$f›ldÇme
 =ğ
¡¹Şow”
(
$ùag
->
G‘Name
()))

73 
$d
->
Assign
(
$gid
, 
¡r¦ashes
(
$f›ld¡ršg
), 
FALSE
);

74 
	g$ok
 = 
Œue
;

78 
	g$ok£‰šg
 = 
$ok
 ? 
$d
->
G‘ResuÉNP
(è: 
$f›ld£t
."\n".
¡r¦ashes
(
$f›ld¡ršg
);

82 
	g$ok£‰šg
 = 
$f›ld£t
."\r\n".
¡r¦ashes
(
$f›ld¡ršg
);

85 
	g$addli¡
 = 
G‘AddF›ldLi¡
(
$d
,
$ok£‰šg
);

86 
	g$ok£‰šg
 = 
add¦ashes
(
$ok£‰šg
);

87 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET fieldset='$oksetting',listfields='$addlist' WHERE id='$id' ");

88 if(!
	g$rs
)

90 
	g$g¼
 = 
$dsql
->
G‘E¼Ü
();

91 
ShowMsg
("ä¿å­˜èŠ‚ç‚¹é…ç½®å‡ºé”™ï¼".
$g¼
, "javascript:;");

92 
ex™
();

95 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªå­—æ®µï¼", "mychannel_edit.php?id={$id}&dopost=edit&openfield=1");

96 
ex™
();

103 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT '#@__archives' AS maintable,addtable FROM `#@__channeltype` WHERE id='$id'");

105 
	g$ŒueTabË
 = 
$row
['addtable'];

106 
	g$bsql
 = "CREATE TABLE IF NOT EXISTS `$trueTable`( `aid` int(11) NOT NULL default '0',\r\n `typeid` int(11) NOT NULL default '0',\r\n ";

108 if(
	g$mysql_v”siÚ
 < 4.1)

110 
	g$bsql
 .ğ" PRIMARY KEY (`aid`), KEY `".
$ŒueTabË
."_index` (`typeid`)\r\n) TYPE=MyISAM; ";

114 
	g$bsql
 .ğ" PRIMARY KEY (`aid`), KEY `".
$ŒueTabË
."_šdex` (`ty³id`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

117 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

120 
	g$f›lds
 = 
¬¿y
();

122 if(
em±y
(
$row
['mašbË'])è
	g$row
['maintable'] = '#@__archives';

124 
	g$rs
 = 
$dsql
->
S‘Qu”y
("SHOW fields FROM `{$row['maintable']}`");

125 
	g$dsql
->
Execu‹
('a');

126 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('a', 
MYSQL_ASSOC
))

128 
	g$f›lds
[
¡¹Şow”
(
$Äow
['Field'])] = 1;

131 
	g$dsql
->
Execu‹
("a", "SHOW fields FROM `{$row['addtable']}`");

132 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('a', 
MYSQL_ASSOC
))

134 if(!
is£t
(
$f›lds
[
¡¹Şow”
(
$Äow
['Field'])]))

136 
	g$f›lds
[
¡¹Şow”
(
$Äow
['Field'])] = 1;

140 
	g$f
 = '';

141 
fÜ—ch
(
$f›lds
 
as
 
$k
=>
$v
)

143 
$f
 .ğ($f=='' ? 
$k
 : ' '.$k);

146 
»quœe_Úû
(
XAKADMIN
."/templets/mychannel_field_add.htm");

	@E:\web\weixun\xakadmin\mychannel_field_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_New');

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/inc/inc_admin_channel.php");

12 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

13 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

14 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

17 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT fieldset,''‡s maintable,addtable,issystem FROM `#@__channeltype` WHERE id='$id'");

18 
	g$f›ld£t
 = 
$row
['fieldset'];

19 
	g$ŒueTabË
 = 
$row
['addtable'];

21 
	g$d
 = 
Ãw
 
XakTagP¬£
();

22 
	g$d
->
S‘NameS·û
("field", "<", ">");

23 
	g$d
->
LßdSourû
(
$f›ld£t
);

24 
fÜ—ch
(
$d
->
CTags
 
as
 
$ùag
)

26 if(
¡¹Şow”
(
$ùag
->
G‘Name
())==¡¹Şow”(
$âame
)) ;

30 
	g$ds
 = 
fe
(
dœÇme
(
__FILE__
)."/inc/fieldtype.txt");

31 
	$fÜ—ch
(
$ds
 
as
 
$d
)

33 
$dds
 = 
	`ex¶ode
(',', 
	`Œim
(
$d
));

34 
$f›ldty³s
[
$dds
[0]] = $dds[1];

35 
	}
}

40 if(
	g$aùiÚ
=='save')

42 if(!
is£t
(
$f›ldty³s
[
$dty³
]))

44 
ShowMsg
("ä½ ä¿®æ”¹çš„æ˜¯ç³»ç»Ÿä¸“ç”¨ç±»å‹çš„æ•°æ®ï¼Œç¦æ­¢æ“ä½œï¼","-1");

45 
ex™
();

48 
	g$dfv®ue
 = 
$vdeçuÉ
;

49 if(
´eg_m©ch
("#^(£Ëù|¿dio|checkbox)#", 
$dty³
))

51 if(!
´eg_m©ch
("#,#", 
$dfv®ue
))

53 
ShowMsg
("ä½ è®¾å®šäº†å­—æ®µä¸º {$dtype} ç±»å‹ï¼Œå¿…é¡»åœ¨é»˜è®¤å€¼ä¸­æŒ‡å®šå…ƒç´ åˆ—è¡¨ï¼Œå¦‚ï¼š'a,b,c' ","-1");

54 
ex™
();

58 if(
	g$dty³
=='stepselect')

60 
$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__stepselect` WHEREƒgroup='$fname' ");

61 if(!
is_¬¿y
(
$¬r
))

63 
ShowMsg
("ä½ è®¾å®šäº†å­—æ®µä¸ºè”åŠ¨ç±»å‹ï¼Œä½†ç³»ç»Ÿä¸­æ²¡æ‰¾åˆ°ä¸ä½ å®šä¹‰çš„å­—æ®µåç›¸åŒçš„è”åŠ¨ç»„å!","-1");

64 
ex™
();

69 
	g$bsql
 = "CREATE TABLE IF NOT EXISTS `{$row['addtable']}`( `aid` int(11) NOT NULL default '0',\r\n `typeid` int(11) NOT NULL default '0',\r\n ";

70 if(
	g$mysql_v”siÚ
 < 4.1)

72 
	g$bsql
 .ğ" PRIMARY KEY (`aid`), KEY `".
$ŒueTabË
."_index` (`typeid`)\r\n) TYPE=MyISAM; ";

76 
	g$bsql
 .ğ" PRIMARY KEY (`aid`), KEY `".
$ŒueTabË
."_šdex` (`ty³id`)\r\nèENGINE=MyISAM DEFAULT CHARSET=".
$cfg_db_Ïnguage
."; ";

78 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

81 
	g$f›lds
 = 
¬¿y
();

82 
	g$rs
 = 
$dsql
->
S‘Qu”y
("SHOW fields FROM `{$row['addtable']}`");

83 
	g$dsql
->
Execu‹
('a');

84 
	g$Äow
 = 
$dsql
->
G‘A¼ay
('a',
MYSQL_ASSOC
))

86 
	g$f›lds
[ 
¡¹Şow”
(
$Äow
['Field']) ] = $nrow['Type'];

90 
	g$i¢uÎ
 = (
$i¢uÎ
==1 ? "true" : "false");

91 
	g$mxËn
 = 
$maxËngth
;

92 
	g$f›ldÇme
 = 
¡¹Şow”
(
$âame
);

95 
	g$f›ldšfos
 = 
G‘F›ldMake
(
$dty³
,
$f›ldÇme
,
$dfv®ue
,
$mxËn
);

96 
	g$Áabsql
 = 
$f›ldšfos
[0];

97 
	g$buideTy³
 = 
$f›ldšfos
[1];

98 
	g$bsql
 = '';

101 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

103 if(
$f›ldÇme
==
¡¹Şow”
(
$ùag
->
G‘Name
()))

105 if(
is£t
(
$f›lds
[
$f›ldÇme
]è&& $f›lds[$f›ldÇme] !ğ
$buideTy³
)

107 
$bsql
 = "ALTER TABLE `$ŒueTabË` CHANGE `$f›ldÇme` ".
$Áabsql
;

108 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

109 }if(!
is£t
(
$f›lds
[
$f›ldÇme
]))

111 
	g$bsql
 = "ALTER TABLE `$ŒueTabË` ADD ".
$Áabsql
;

112 
	g$dsql
->
Execu‹NÚeQu”y
(
$bsql
);

115 
	g$bsql
 = '';

117 
	g$d
->
Assign
(
$gid
,
¡r¦ashes
(
$f›ld¡ršg
),
çl£
);

121 
	g$ok£‰šg
 = 
$d
->
G‘ResuÉNP
();

123 
	g$addli¡
 = 
G‘AddF›ldLi¡
(
$d
,
$ok£‰šg
);

124 
	g$ok£‰šg
 = 
add¦ashes
(
$ok£‰šg
);

125 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET fieldset='$oksetting',listfields='$addlist' WHERE id='$id' ");

127 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªå­—æ®µçš„é…ç½®ï¼","mychannel_edit.php?id={$id}&dopost=edit&openfield=1");

128 
ex™
();

134 if(
	g$aùiÚ
=="delete")

136 if(
$row
['issystem']==1)

138 
ShowMsg
("å¯¹ä¸èµ·ï¼Œç³»ç»Ÿæ¨¡å‹çš„å­—æ®µä¸å…è®¸åˆ é™¤ï¼","-1");

139 
ex™
();

143 
fÜ—ch
(
$d
->
CTags
 
as
 
$gid
=>
$ùag
)

145 if(
¡¹Şow”
(
$ùag
->
G‘Name
()è=ğ¡¹Şow”(
$âame
))

147 
$d
->
Assign
(
$gid
, "#@Delete@#");

151 
	g$ok£‰šg
 = 
add¦ashes
(
$d
->
G‘ResuÉNP
());

152 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET fieldset='$oksetting' WHERE id='$id' ");

153 
	g$dsql
->
Execu‹NÚeQu”y
("ALTER TABLE `$trueTable` DROP `$fname` ");

154 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªå­—æ®µï¼","mychannel_edit.php?id={$id}&dopost=edit&openfield=1");

155 
ex™
();

158 
»quœe_Úû
(
XAKADMIN
."/templets/mychannel_field_edit.htm");

	@E:\web\weixun\xakadmin\mychannel_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_List');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$sql
 = "SELECT id,nid,typename,addtable,isshow,issystem FROM `#@__channeltype` ORDER BY id DESC";

13 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

14 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/mychannel_main.htm");

15 
	g$dli¡
->
S‘Sourû
(
$sql
);

16 
	g$dli¡
->
di¥Ïy
();

18 
funùiÚ
 
	$G‘S
(
$¡a
,
$id
)

20 if(
$¡a
==1)

22  (
$id
!=-1 ? "å¯ç”¨ &gt; <a href='mychannel_edit.php?dopost=hide&id=$id'><u>ç¦ç”¨</u></a>" : "å›ºå®šé¡¹ç›®");

28 
	}
}

30 
funùiÚ
 
	$IsSy¡em
(
$s
)

32  
$s
==1 ? "ç³»ç»Ÿ" : "è‡ªåŠ¨";

33 
	}
}

	@E:\web\weixun\xakadmin\mynews_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_ç«™å†…æ–°é—»å‘å¸ƒ');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

11 if(
	g$dİo¡
=="save")

13 
$dtime
 = 
G‘MkTime
(
$sd©e
);

14 
	g$qu”y
 = "INSERT INTO `#@__mynews`(title,writer,senddate,body)

15 
VALUES
('$title','$writer','$dtime','$body')";

16 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

17 
ShowMsg
("æˆåŠŸå‘å¸ƒä¸€æ¡ç«™å†…æ–°é—»ï¼", "mynews_main.php");

18 
ex™
();

20 
šşude
 
XAKINClude
('templets/mynews_add.htm');

	@E:\web\weixun\xakadmin\mynews_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_ç«™å†…æ–°é—»å‘å¸ƒ');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

11 
	g$aid
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$aid
);

12 if(
	g$dİo¡
=="del")

14 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__mynews WHERE‡id='$aid';");

15 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€æ¡ç«™å†…æ–°é—»ï¼","mynews_main.php");

16 
ex™
();

18 if(
	g$dİo¡
=="editsave")

20 
$šqu”y
 = "UPDATE #@__myÃw SET™Ë='$t™Ë',ty³id='$ty³id',wr™”='$wr™”',£ndd©e='".
G‘MKTime
(
$sd©e
)."',body='$body' WHERE‡id='$aid';";

21 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

22 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€æ¡ç«™å†…æ–°é—»ï¼","mynews_main.php");

23 
ex™
();

25 
	g$myNews
 = 
$dsql
->
G‘OÃ
("SELECT #@__mynews.*,#@__arctype.typename FROM #@__mynews LEFT JOIN #@__arctype ON #@__arctype.id=#@__mynews.typeid WHERE #@__mynews.aid='$aid';");

26 
šşude
 
XAKINClude
('templets/mynews_edit.htm');

	@E:\web\weixun\xakadmin\mynews_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

11 
	g$sql
 = "SELECT

12 #@
__myÃws
.
aid
,#@__myÃws.
t™Ë
,#@__myÃws.
wr™”
,

13 #@
__myÃws
.
£ndd©e
,#@__myÃws.
ty³id
,

14 #@
__¬ùy³
.
ty³Çme


15 
	gFROM
 #@
__myÃws


16 
LEFT
 
	gJOIN
 #@
__¬ùy³
 
	gON
 #@
	g__¬ùy³
.
	gid
=#@
__myÃws
.
ty³id


17 
ORDER
 
BY
 
aid
 
DESC
";

18 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

19 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/mynews_main.htm");

20 
	g$dli¡
->
S‘Sourû
(
$sql
);

21 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\mytag_add.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_Other');

9 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 if(
	g$dİo¡
=="save")

14 
$gÇme
 = 
Œim
($tagname);

15 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECTypeid FROM #@__mytag WHEREypeid='$typeid' ANDagname LIKE '$tagname'");

16 if(
is_¬¿y
(
$row
))

18 
ShowMsg
("åœ¨ç›¸åŒæ ç›®ä¸‹å·²ç»å­˜åœ¨åŒåçš„æ ‡è®°ï¼","-1");

19 
ex™
();

21 
	g$¡¬‰ime
 = 
G‘MkTime
(
$¡¬‰ime
);

22 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

23 
	g$šQu”y
 = "INSERT INTO #@__mytag(typeid,tagname,timeset,starttime,endtime,normbody,expbody)

24 
VALUES
('$typeid','$tagname','$timeset','$starttime','$endtime','$normbody','$expbody'); ";

25 
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
);

26 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰æ ‡è®°ï¼","mytag_main.php");

27 
ex™
();

29 
	g$¡¬tDay
 = 
time
();

30 
	g$’dDay
 = 
AddDay
(
$¡¬tDay
,30);

31 
	g$¡¬tDay
 = 
G‘D©eTimeMk
(
$¡¬tDay
);

32 
	g$’dDay
 = 
G‘D©eTimeMk
(
$’dDay
);

33 
šşude
 
XAKINClude
('templets/mytag_add.htm');

	@E:\web\weixun\xakadmin\mytag_edit.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_Other');

9 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 
	g$aid
 = 
štv®
(
$aid
);

13 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? 'mytag_main.php' : $_COOKIE['ENV_GOBACK_URL'];

15 if(
	g$dİo¡
=='delete')

17 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__mytag WHERE‡id='$aid'");

18 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªè‡ªå®šä¹‰æ ‡è®°ï¼",
$ENV_GOBACK_URL
);

19 
ex™
();

21 if(
	g$dİo¡
=="saveedit")

23 
$¡¬‰ime
 = 
G‘MkTime
($starttime);

24 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

25 
	g$qu”y
 = "UPDATE `#@__mytag`

26 
SET


27 
ty³id
='$typeid',

28 
	gtime£t
='$timeset',

29 
	g¡¬‰ime
='$starttime',

30 
	g’dtime
='$endtime',

31 
	gnÜmbody
='$normbody',

32 
	gexpbody
='$expbody'

33 
WHERE
 
aid
='$aid' ";

34 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

35 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªè‡ªå®šä¹‰æ ‡è®°ï¼",
$ENV_GOBACK_URL
);

36 
ex™
();

38 if(
	g$dİo¡
=="getjs")

40 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

41 
	g$jscode
 = "<script src='{$cfg_phpurl}/mytag_js.php?aid=$aid'†anguage='javascript'></script>";

42 
	g$showhtml
 = "<xmp style='color:#333333;background-color:#ffffff'>\r\n\r\n$jscode\r\n\r\n</xmp>";

43 
	g$showhtml
 .= "<b>é¢„è§ˆï¼š</b><iframe‚ame='testfrm' frameborder='0' src='mytag_edit.php?aid={$aid}&dopost=testjs' id='testfrm' width='100%' height='250'></iframe>";

44 
	g$wšt™Ë
 = "å®æ ‡è®°å®šä¹‰-è·å–JS";

45 
	g$wecome_šfo
 = "<a href='mytag_main.php'><u>å®æ ‡è®°å®šä¹‰</u></a>::è·å–JS";

46 
	g$wš
 = 
Ãw
 
OxWšdow
();

47 
	g$wš
->
In™
();

48 
	g$wš
->
AddT™Ë
('ä»¥ä¸‹ä¸ºé€‰å®šå®æ ‡è®°çš„JSè°ƒç”¨ä»£ç ï¼š');

49 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('hªd', 
$showhtml
);

50 
	g$wš
->
Di¥Ïy
();

51 
ex™
();

53 if(
	g$dİo¡
=="testjs")

55 
echo
 "<body bgcolor='#ffffff'>";

56 
	gecho
 "<script src='{$cfg_phpurl}/mytag_js.php?aid=$aid&nocache=1'†anguage='javascript'></script>";

57 
ex™
();

59 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__mytag` WHERE‡id='$aid'");

60 
šşude
 
XAKINClude
('templets/mytag_edit.htm');

	@E:\web\weixun\xakadmin\mytag_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('temp_Other');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,'/');

12 
	g$sql
 = "SELECT myt.aid,myt.tagname,tp.typename,myt.timeset,myt.endtime

13 
FROM
 `#@
__myg
` 
myt
 
LEFT
 
JOIN
 `#@
__¬ùy³
` 

 
ON
p.
id
=myt.
ty³id
 
ORDER
 
BY
 myt.
aid
 
DESC
 ";

14 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

15 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
.'/templets/mytag_main.htm');

16 
	g$dli¡
->
S‘Sourû
(
$sql
);

17 
	g$dli¡
->
di¥Ïy
();

19 
funùiÚ
 
	$Te¡Ty³
(
$Šame
)

21  
$Šame
=='' ? 'æ‰€æœ‰æ ç›®' : $tname;

22 
	}
}

24 
funùiÚ
 
	$TimeS‘V®ue
(
$ts
)

26  
$ts
==0 ? 'ä¸é™æ—¶é—´' : 'é™æ—¶æ ‡è®°';

27 
	}
}

	@E:\web\weixun\xakadmin\mytag_tag_guide.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

9 
šşude
 
XAKINClude
('templets/mytag_tag_guide.htm');

	@E:\web\weixun\xakadmin\mytag_tag_guide_ok.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_Other');

11 
	g$©i¡
 = "";

12 
	g$©i¡
 .ğ"„ow='".
$row
."'";

13 
	g$©i¡
 .ğ"™ËËn='".
$t™ËËn
."'";

14 if(
	g$Üd”by
!='£ndd©e'è
$©i¡
 .ğ" ord”by='".
$Üd”by
."'";

15 if(
	g$Üd”
!='desc'è
$©i¡
 .ğ" ord”='".
$Üd”
."'";

16 if(
	g$ty³id
>0è
	g$©i¡
 .ğ"y³id='".
$ty³id
."'";

17 if(
is£t
(
$¬cid
)è
	g$©i¡
 .= " idlist='".$arcid."'";

18 if(
	g$chªÃl
>0è
	g$©i¡
 .ğ" chªÃlid='".
$chªÃl
."'";

19 if(
	g$©t
>0è
	g$©i¡
 .ğ"‡‰='".
$©t
."'";

20 if(
	g$cŞ
>1è
	g$©i¡
 .ğ" cŞ='".
$cŞ
."'";

21 if(
	g$subday
>0è
	g$©i¡
 .ğ" subday='".
$subday
."'";

23 if(!
	$em±y
(
$ty³s
))

25 
$©i¡
 .= "ype='";

26 
	`fÜ—ch
(
$ty³s
 
as
 
$v
)

28 
$©i¡
 .ğ
$v
.'.';

30 
$©i¡
 .= "'";

31 
	}
}

32 
	g$šÃ¹ext
 = 
¡r¦ashes
(
$šÃ¹ext
);

33 if(
	g$keywÜd
!="")

35 
$©i¡
 .= " keyword='$keyword'";

37 
	g$fuÎg
 = "{xak:arclist$attlist}

38 
$šÃ¹ext


39 {/
xak
:
¬şi¡
}\
r
\
n
";

40 if(
$dİo¡
=='savetag')

42 
$fuÎg
 = 
add¦ashes
($fulltag);

43 
	g$gÇme
 = "auto";

44 
	g$šQu”y
 = "

45 
INSERT
 
INTO
 #@
__myg
(
ty³id
,
gÇme
,
time£t
,
¡¬‰ime
,
’dtime
,
nÜmbody
,
expbody
)

46 
VALUES
('0','$tagname','0','0','0','$fulltag','');

48 
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
);

49 
	g$id
 = 
$dsql
->
G‘La¡ID
();

50 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__mytag SETagname='{$tagname}_{$id}' WHERE‡id='$id'");

51 
	g$fuÎg
 = "{xak:mytag‚ame='{$tagname}_{$id}' ismake='yes'/}";

53 
šşude
 
XAKINClude
('templets/mytag_tag_guide_ok.htm');

	@E:\web\weixun\xakadmin\pic_view.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('pic_view');

9 if(
em±y
(
$aùiv•©h
)è
	g$aùiv•©h
 = 
$cfg_medŸs_dœ
;

11 
	g$aùiv•©h
 = 
´eg_»¶aû
("#\/{1,}#", "/", 
$aùiv•©h
);

12 
	g$ŒueP©h
 = 
$cfg_ba£dœ
.
$aùiv•©h
;

13 
	g$li¡Size
=5;

14 
šşude
 
XAKINClude
('templets/pic_view.htm');

16 
funùiÚ
 
	$G‘P»P©h
(
$nowP©h
)

18 if(
$nowP©h
 == "" || $nowPath == "/")

20 
	`echo
("å½“å‰ä¸ºæ ¹ç›®å½•\n");

24 
$dœs
 = 
	`¥l™
("/", 
$nowP©h
);

25 
$nowP©h
 = "";

26 
$i
=1; $i<
	`couÁ
(
$dœs
)-1; $i++)

28 
$nowP©h
 .ğ"/".
$dœs
[
$i
];

30 
	`echo
("<¨h»f=\"pic_v›w.php?aùiv•©h=".
$nowP©h
."\">è½¬åˆ°ä¸Šçº§ç›®å½•</a>\n");

32 
	}
}

34 
funùiÚ
 
	$Li¡Pic
(
$ŒueP©h
, 
$nowP©h
)

36 
glob®
 
$li¡Size
;

37 
$cŞ
=0;

38 
$rowdd
=0;

39 
$rowdd
++;

40 
$imgfe
="";

41 
$ŒueP©h
 = 
	`´eg_»¶aû
("#\/$#", "",…»g_»¶aû("#\\\\{1,}#", "/", 
	`Œim
($truePath)));

42 
$nowP©h
 = 
	`´eg_»¶aû
("#\/$#", "",…»g_»¶aû("#\/{1,}#", "/", 
	`Œim
($nowPath)));

43 
$dh
 = 
	`dœ
(
$ŒueP©h
);

44 
	`echo
("<tr‡lign='center'>\n");

45  
$f’ame
 = 
$dh
->
	`»ad
() )

47 if(!
	`´eg_m©ch
("#\.$#", 
$f’ame
))

49 
$fuÎName
 = 
$ŒueP©h
."/".
$f’ame
;

50 
$feU¾
 = 
$nowP©h
."/".
$f’ame
;

51 if(
	`is_dœ
(
$fuÎName
))

53 if(
$cŞ
 % 
$li¡Size
==0 && $col != 0)

55 
	`echo
("</tr>\n<tr‡lign='center'>\n");

56 
$i
 = 
$rowdd
-
$li¡Size
; $i < $rowdd; $i++)

58 
	`echo
("<td>".
$f–i¡
[
$i
]."</td>\n");

60 
	`echo
("</tr>\n<tr‡lign='center'>\n");

62 
$lše
 = "

63 <
td
>

64 <
bË
 
width
='106' 
height
='106' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CCCCCC'>

65 <
Œ
><
td
 
®ign
='ûÁ”' 
bgcŞÜ
='#FFFFFF'>

66 <
a
 
h»f
='pic_view.php?activepath=".$fileUrl."'>

67 <
img
 
¤c
='images/pic_dœ.gif' 
width
='44' 
height
='42' 
bÜd”
='0'>

68 </
a
></
td
></
Œ
></
bË
></td>";

69 
$f–i¡
[
$rowdd
] = 
$f’ame
;

70 
$cŞ
++;

71 
$rowdd
++;

72 
echo
 
$lše
;

74 if(
	`IsImg
(
$f’ame
))

76 if(
$cŞ
 % 
$li¡Size
==0 && $col != 0)

78 
	`echo
("</tr>\n<tr‡lign='center'>\n");

79 
$i
=
$rowdd
-
$li¡Size
; $i<$rowdd; $i++)

81 
	`echo
("<td>".
$f–i¡
[
$i
]."</td>\n");

83 
	`echo
("</tr>\n<tr‡lign='center'>\n");

85 
$lše
 = "

86 <
td
>

87 <
bË
 
width
='106' 
height
='106' 
bÜd”
='0' 
ûÎ·ddšg
='0' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#CCCCCC'>

88 <
Œ
>

89 <
td
 
®ign
='ûÁ”' 
bgcŞÜ
='#FFFFFF'>

91 </
td
>

92 </
Œ
></
bË
></
td
>";

93 
$f–i¡
[
$rowdd
] = 
$f’ame
;

94 
$cŞ
++;

95 
$rowdd
++;

96 
echo
 
$lše
;

100 
	`echo
("</tr>\n");

101 ifĞ!
	`em±y
(
$f–i¡
) )

103 
	`echo
("<tr‡lign='center'>\n");

104 
$t
 = (
$rowdd
-1è% 
$li¡Size
;

105 ifĞ
$t
 == 0 )

107 
$t
 = 
$li¡Size
;

109 
$i
 = 
$rowdd
 - 
$t
; $i < $rowdd; $i++)

111 
	`echo
("<td>".
$f–i¡
[
$i
]."</td>\n");

113 
	`echo
("</tr>\n");

115 
	}
}

117 
funùiÚ
 
	$G‘ImgFe
(
$ŒueP©h
, 
$nowP©h
, 
$feName
)

119 
$toW
=102;

120 
$toH
=102;

121 
$¤cFe
 = 
$ŒueP©h
."/".
$feName
;

122 
$šfo
 = "";

123 
$d©a
 = 
	`G‘ImageSize
(
$¤cFe
, 
$šfo
);

124 
$¤cW
=
$d©a
[0];

125 
$¤cH
=
$d©a
[1];

126 if(
$toW
 >ğ
$¤cW
 && 
$toH
 >ğ
$¤cH
)

128 
$áoW
 = 
$¤cW
;

129 
$áoH
 = 
$¤cH
;

133 
$toWH
 = 
$toW
 / 
$toH
;

134 
$¤cWH
 = 
$¤cW
 / 
$¤cH
;

135 if(
$toWH
 <ğ
$¤cWH
)

137 
$áoW
 = 
$toW
;

138 
$áoH
 = 
$áoW
 * ( 
$¤cH
 / 
$¤cW
);

142 
$áoH
 = 
$toH
;

143 
$áoW
 = 
$áoH
 * ( 
$¤cW
 / 
$¤cH
 );

146 ("<¨h»f='".
$nowP©h
."/".
$feName
."'¬g‘='_bÏnk'><img src='".$nowP©h."/".$feName."' width='".
$áoW
."' height='".
$áoH
."' border='0'></a>");

147 
	}
}

149 
funùiÚ
 
	$IsImg
(
$feName
)

151 if(
	`´eg_m©ch
("#\.(jpg|gif|²g)$#", 
$feName
))  1;

153 
	}
}

	@E:\web\weixun\xakadmin\plus_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_plus');

9 
	g$aid
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$aid
);

10 if(
	g$dİo¡
=="show")

12 
$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__plus SET isshow=1 WHERE‡id='$aid';");

13 
ShowMsg
("æˆåŠŸå¯ç”¨ä¸€ä¸ªæ’ä»¶,è¯·åˆ·æ–°å¯¼èˆªèœå•!","plus_main.php");

14 
ex™
();

16 if(
	g$dİo¡
=="hide")

18 
$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__plus SET isshow=0 WHERE‡id='$aid';");

19 
ShowMsg
("æˆåŠŸç¦ç”¨ä¸€ä¸ªæ’ä»¶,è¯·åˆ·æ–°å¯¼èˆªèœå•!","plus_main.php");

20 
ex™
();

22 if(
	g$dİo¡
=="delete")

24 if(
em±y
(
$job
)) $job="";

25 if(
	g$job
=="")

27 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

28 
	g$wšt™Ë
 = "åˆ é™¤æ’ä»¶";

29 
	g$wecome_šfo
 = "<a href='plus_main.php'>æ’ä»¶ç®¡ç†</a>::åˆ é™¤æ’ä»¶";

30 
	g$wš
 = 
Ãw
 
OxWšdow
();

31 
	g$wš
->
In™
("plus_edit.php", "js/blank.js", "POST");

32 
	g$wš
->
AddHidd’
("job", "yes");

33 
	g$wš
->
AddHidd’
("dİo¡", 
$dİo¡
);

34 
	g$wš
->
AddHidd’
("aid", 
$aid
);

35 
	g$wš
->
AddT™Ë
("ä½ ç¡®å®è¦åˆ é™¤'".
$t™Ë
."'è¿™ä¸ªæ’ä»¶ï¼Ÿ");

36 
	g$wš
->
AddMsgI‹m
("<font color='red'>è­¦å‘Šï¼šåœ¨è¿™é‡Œåˆ é™¤ä»…ä»…åˆ é™¤èœå•é¡¹ï¼Œè¦å¹²å‡€åˆ é™¤è¯·åœ¨æ¨¡å—ç®¡ç†å¤„åˆ é™¤ï¼<br /><br /> <a href='module_main.php?moduletype=plus'>æ¨¡å—ç®¡ç†&gt;&gt;</a> </font>");

37 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

38 
	g$wš
->
Di¥Ïy
();

39 
ex™
();

41 if(
	g$job
=="yes")

43 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__plus WHERE‡id='$aid';");

44 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªæ’ä»¶,è¯·åˆ·æ–°å¯¼èˆªèœå•!","plus_main.php");

45 
ex™
();

48 if(
	g$dİo¡
=="saveedit")

50 
$šqu”y
 = "UPDATE #@__plus SET…lusname='$plusname',menustring='$menustring',filelist='$filelist' WHERE‡id='$aid';";

51 
	g$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

52 
ShowMsg
("æˆåŠŸæ›´æ”¹æ’ä»¶çš„é…ç½®!","plus_main.php");

53 
ex™
();

55 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__plus WHERE‡id='$aid'");

56 
šşude
 
XAKINClude
('templets/plus_edit.htm');

	@E:\web\weixun\xakadmin\plus_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_plus');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$sql
 = "SELECT‡id,plusname,writer,isshow FROM #@__plus ORDER BY‡id ASC";

13 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

14 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/plus_main.htm");

15 
	g$dli¡
->
S‘Sourû
(
$sql
);

16 
	g$dli¡
->
di¥Ïy
();

18 
funùiÚ
 
	$G‘S
(
$¡a
,
$id
,
$t™Ë
)

20 if(
$¡a
==1)

22  " &nb¥; <¨h»f='¶us_ed™.php?dİo¡ód™&aid=$id'><u>ä¿®æ”¹</u></a> &nb¥; å¯ç”¨ &gt; <¨h»f='¶us_ed™.php?dİo¡=hide&aid=$id'><u>ç¦ç”¨</u></a> &nb¥; <¨h»f='¶us_ed™.php?dİo¡=d–‘e&aid=$id&t™Ë=".
	`u¾’code
(
$t™Ë
)."'><u>åˆ é™¤</u></a>";

26  " &nb¥; <¨h»f='¶us_ed™.php?aid=$id'><u>ä¿®æ”¹</u></a> &nb¥; ç¦ç”¨ &gt; <¨h»f='¶us_ed™.php?dİo¡=show&aid=$id'><u>å¯ç”¨</u></a> &nb¥; <¨h»f='¶us_ed™.php?dİo¡=d–‘e&aid=$id&t™Ë=".
	`u¾’code
(
$t™Ë
)."'><u>å†Œé™¤</u></a>";

28 
	}
}

	@E:\web\weixun\xakadmin\public_guide.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

9 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

14 if(
	g$aùiÚ
=='setdefault')

16 
CheckPurv›w
('sys_Edit');

17 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET isdefault=0 WHERE id<>'$cid'");

18 if(
	g$cid
 != 0)

20 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__channeltype` SET isdefault=1 WHERE id='$cid'");

22 
	g$wš
 = 
Ãw
 
OxWšdow
();

23 
	g$wš
->
In™
();

24 
	g$wš
->
	gmašT™Ë
 = "å†…å®¹å‘å¸ƒå‘å¯¼";

25 
	g$wecome_šfo
 = "<a href='public_guide.php?action=edit'>å†…å®¹å‘å¸ƒå‘å¯¼</a>";

26 
	g$wš
->
AddT™Ë
("<a href='public_guide.php?action=edit'>å†…å®¹å‘å¸ƒå‘å¯¼</a> &gt;&gt; è®¾ç½®é»˜è®¤å‘å¸ƒè¡¨å•");

27 if(
	g$cid
==0)

29 
$msg
 = "

31 <
hr
 
¡yË
='width:90%' 
size
='1' />

32 ä½ ç›®å‰æƒ³è¦è¿›è¡Œçš„æ“ä½œï¼š <
a
 
h»f
='public_guide.php?action=edit'>è¿”å›å‘å¸ƒå‘å¯¼é¡µ</a>

37 
	g$msg
 = "

39 <
hr
 
¡yË
='width:90%' 
size
='1' />

40 ä½ ç›®å‰æƒ³è¦è¿›è¡Œçš„æ“ä½œï¼š <
a
 
h»f
='public_guide.php'>è½¬åˆ°é»˜è®¤å‘å¸ƒè¡¨å•</a> &
nb¥
; <¨
	gh»f
='public_guide.php?action=edit'>è¿”å›å‘å¸ƒå‘å¯¼é¡µ</a>

43 
	g$wš
->
AddMsgI‹m
("<div style='padding-left:20px;line-height:150%'>$msg</div>");

44 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hand");

45 
	g$wš
->
Di¥Ïy
();

46 
ex™
();

53 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id,addcon FROM `#@__channeltype` WHERE isdefault='1' ");

56 if(
is_¬¿y
(
$row
è&& 
	g$aùiÚ
!='edit')

58 
$addcÚ
 = 
$row
['addcon'];

59 if(
	g$addcÚ
=='')

61 
$addcÚ
='archives_add.php';

63 
	g$chªÃlid
 = 
$row
['id'];

64 
	g$cid
 = 0;

65 
»quœe_Úû
(
XAKADMIN
.'/'.
$addcÚ
);

66 
ex™
();

72 
	g$dsql
->
S‘Qu”y
("SELECT id,typename,mancon,isdefault,addtable FROM `#@__channeltype` WHERE id<>-1 And isshow=1 ");

73 
	g$dsql
->
Execu‹
();

75 
šşude
 
XAKINClude
('templets/public_guide.htm');

78 
funùiÚ
 
	$G‘C©®ogs
(&
$dsql
,
$cid
)

80 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__arctype` WHERE channeltype='$cid' ");

81  (!
	`is_¬¿y
(
$row
) ? '0' : $row['dd']);

82 
	}
}

	@E:\web\weixun\xakadmin\recycling.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('a_List,a_AccList,a_MyList');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

10 if(
	$em±y
(
$cid
))

12 
$cid
 = '0';

13 
$wh”eSql
 = '';

14 
	}
}

15 if(
	g$cid
!=0)

17 
»quœe_Úû
(
XAKINC
.'/channelunit.func.php');

18 
	g$wh”eSql
 = " AND‡rc.ty³id IN (".
G‘SÚIds
(
$cid
).")";

20 
	g$qu”y
 = "SELECT‡rc.*,tp.typename FROM `#@__archives` AS‡rc

21 
LEFT
 
JOIN
 #@
__¬ùy³
 
AS
 

 
ON
 
¬c
.
ty³id
 =p.
id


22 
WHERE
 
¬c
.
¬üªk
 = '-2' 
$wh”eSql
 
Üd”
 
by
‡rc.
id
 
desc
";

23 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

24 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/recycling.htm");

25 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

26 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\rpad_add.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

3 
CheckPurv›w
('plus_RPå¹¿å‘Šç®¡ç†');

4 
»quœe_Úû
 
	gXAKINC
."/typelink.class.php";

5 if(
	$em±y
(
$dİo¡
))

7 
$dİo¡
 = "";

8 
	}
}

10 if(
	g$dİo¡
=="save")

13 
$gÇme
 = 
Œim
($tagname);

14 if(
	g$gÇme
=='' || 
$adÇme
=='')

16 
ShowMsg
("å¹¿å‘Šæ ‡è¯†æˆ–å¹¿å‘Šåç§°ä¸èƒ½ä¸ºç©ºï¼","-1");

17 
ex™
();

19 
	g$row
 = 
$dsql
->
G‘OÃ
("Selectypeid From #@__rpad whereypeid='$typeid' Andagname†ike '$tagname'");

20 if(
is_¬¿y
(
$row
))

22 
ShowMsg
("åœ¨ç›¸åŒæ ç›®ä¸‹å·²ç»å­˜åœ¨åŒåçš„æ ‡è®°ï¼","-1");

23 
ex™
();

25 
	g$¡¬‰ime
 = 
G‘MkTime
(
$¡¬‰ime
);

26 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

28 if(
	g$adty³
=='code')

30 
$nÜm·¿ms
 = 
$htmlcode
;

32 
–£if
(
$adty³
=='text')

34 
$nÜm·¿ms
 = 
£rŸlize
(
$‹xt
);

36 
–£if
(
$adty³
=='image')

38 
$nÜm·¿ms
 = 
£rŸlize
(
$image
);

40 
–£if
(
$adty³
=='slide')

42 
$nÜm·¿ms
 = 
£rŸlize
(
$¦ide
);

44 
–£if
(
$adty³
=='flash')

46 
$nÜm·¿ms
 = 
£rŸlize
(
$æash
);

50 
ShowMsg
("æœªçŸ¥å¹¿å‘Šç±»å‹ï¼","-1");

51 
ex™
();

53 
	g$qu”y
 = "

54 
In£¹
 
IÁo
 #@
__½ad
(
ty³id
,
gÇme
,
adÇme
,
time£t
,
¡¬‰ime
,
’dtime
,
adty³
,
nÜm·¿ms
,
expbody
)

55 
V®ues
('$typeid','$tagname','$adname','$timeset','$starttime','$endtime','$adtype','$normparams','$expbody');

57 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

58 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªå¹¿å‘Šï¼","rpad_main.php");

59 
ex™
();

61 
	g$¡¬tDay
 = 
time
();

62 
	g$’dDay
 = 
AddDay
(
$¡¬tDay
,30);

63 
	g$¡¬tDay
 = 
G‘D©eTimeMk
(
$¡¬tDay
);

64 
	g$’dDay
 = 
G‘D©eTimeMk
(
$’dDay
);

65 
šşude
 
XAKINClude
('templets/rpad_add.htm');

	@E:\web\weixun\xakadmin\rpad_edit.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

3 
CheckPurv›w
('plus_RPå¹¿å‘Šç®¡ç†');

4 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

5 if(
	$em±y
(
$dİo¡
))

7 
$dİo¡
 = '';

8 
	}
}

9 
	g$aid
 = 
”eg_»¶aû
('[^0-9]','',
$aid
);

10 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? "rpad_main.php" : $_COOKIE['ENV_GOBACK_URL'];

12 if(
	g$dİo¡
=='del')

14 
šşude
 
XAKINClude
('templets/rpad_del.htm');

15 
ex™
();

17 if(
	g$dİo¡
=='delete')

19 if(
$okd–
=='xak.cn')

21 
$dsql
->
Execu‹NÚeQu”y
("Delete From `#@__rpad` where‡id='$aid' ");

22 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€åˆ™å¹¿å‘Šä»£ç ï¼",
$ENV_GOBACK_URL
);

23 
ex™
();

27 
ShowMsg
("åˆ é™¤ç¡®è®¤ç ä¸æ­£ç¡®ï¼",
$ENV_GOBACK_URL
);

28 
ex™
();

31 if(
	g$dİo¡
=="getjs")

33 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

34 
	g$jscode
 = "<script src='{$cfg_phpurl}/rpad/js.php?aid=$aid'†anguage='javascript'></script>";

35 
	g$showhtml
 = "<xmp style='color:#333333;background-color:#ffffff'>\r\n\r\n$jscode\r\n\r\n</xmp>";

36 
	g$showhtml
 .= "é¢„è§ˆï¼š<iframe‚ame='testfrm' frameborder='0' src='rpad_edit.php?aid={$aid}&dopost=testjs' id='testfrm' width='100%' height='200'></iframe>";

37 
	g$wšt™Ë
 = "å¹¿å‘Šç®¡ç†-è·å–JS";

38 
	g$wecome_šfo
 = "<a href='rpad_main.php'><u>å¹¿å‘Šç®¡ç†</u></a>::è·å–JS";

39 
	g$wš
 = 
Ãw
 
OxWšdow
();

40 
	g$wš
->
In™
();

41 
	g$wš
->
AddT™Ë
("ä»¥ä¸‹ä¸ºé€‰å®šå¹¿å‘Šçš„JSè°ƒç”¨ä»£ç ï¼š");

42 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd",
$showhtml
);

43 
	g$wš
->
Di¥Ïy
();

44 
ex™
();

46 if(
	g$dİo¡
=='testjs')

48 
echo
 "<script src='{$cfg_phpurl}/rpad/js.php?aid=$aid&nocache=1'†anguage='javascript'></script>";

49 
ex™
();

51 if(
	g$dİo¡
=='saveedit')

53 
$¡¬‰ime
 = 
G‘MkTime
($starttime);

54 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

56 if(
	g$adty³
=='code')

58 
$nÜm·¿ms
 = 
$htmlcode
;

60 
–£if
(
$adty³
=='text')

62 
$nÜm·¿ms
 = 
£rŸlize
(
$‹xt
);

64 
–£if
(
$adty³
=='image')

66 
$nÜm·¿ms
 = 
£rŸlize
(
$image
);

68 
–£if
(
$adty³
=='slide')

70 
$nÜm·¿ms
 = 
£rŸlize
(
$¦ide
);

72 
–£if
(
$adty³
=='flash')

74 
$nÜm·¿ms
 = 
£rŸlize
(
$æash
);

78 
ShowMsg
("æœªçŸ¥å¹¿å‘Šç±»å‹ï¼","-1");

79 
ex™
();

81 
	g$qu”y
 = "Update `#@__rpad`

82 
£t


83 
ty³id
='$typeid',

84 
	gadÇme
='$adname',

85 
	gtime£t
='$timeset',

86 
	g¡¬‰ime
='$starttime',

87 
	g’dtime
='$endtime',

88 
	gadty³
='$adtype',

89 
	gnÜm·¿ms
='$normparams',

90 
	gexpbody
='$expbody'

91 
wh”e
 
aid
='$aid'

93 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

94 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€åˆ™å¹¿å‘Šä»£ç ï¼",
$ENV_GOBACK_URL
);

95 
ex™
();

97 
	g$row
 = 
$dsql
->
G‘OÃ
("Select * From `#@__rpad` where‡id='$aid'");

98 
	g$cod•¬ams
 = 
$¦id•¬ams
 = 
$æash·¿ms
 = 
$imag•¬ams
 = 
$‹x¬ams
 = 
¬¿y
();

99 if(
	g$row
['adtype'] == 'code')

101 
$cod•¬ams
['code'] = 
$row
['normparams'];

103 if(
	g$row
['adtype'] == 'slide')

105 
$¦id•¬ams
 = 
un£rŸlize
(
$row
['normparams']);

107 if(
	g$row
['adtype'] == 'flash')

109 
$æash·¿ms
 = 
un£rŸlize
(
$row
['normparams']);

111 if(
	g$row
['adtype'] == 'image')

113 
$imag•¬ams
 = 
un£rŸlize
(
$row
['normparams']);

115 if(
	g$row
['adtype'] == 'text')

117 
$‹x¬ams
 = 
un£rŸlize
(
$row
['normparams']);

119 
šşude
 
XAKINClude
('templets/rpad_edit.htm');

	@E:\web\weixun\xakadmin\rpad_main.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

4 
»quœe_Úû
(
XAKINC
.'/common.func.php');

5 
£tcook›
('ENV_GOBACK_URL',
$xakNowu¾
,
time
()+3600,'/');

7 
	g$sql
 = "Select‡d.aid,ad.tagname,tp.typename,ad.adname,ad.timeset,ad.endtime

8 
From
 `#@
__½ad
` 
ad
 
Ëá
 
još
 `#@
__¬ùy³
` 

 
Ú
p.
id
÷d.
ty³id


9 
Üd”
 
by
 
ad
.
aid
 
desc
";

11 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

12 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/rpad_main.htm");

13 
	g$dli¡
->
S‘Sourû
(
$sql
);

14 
	g$dli¡
->
di¥Ïy
();

16 
funùiÚ
 
	$Te¡Ty³
(
$Šame
)

18 if(
$Šame
=="")

24  
$Šame
;

26 
	}
}

28 
funùiÚ
 
	$TimeS‘V®ue
(
$ts
)

30 if(
$ts
==0)

38 
	}
}

	@E:\web\weixun\xakadmin\search_keywords_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

10 if(
em±y
(
$·gesize
)è
	g$·gesize
 = 30;

11 if(
em±y
(
$·g’o
)è
	g$·g’o
 = 1;

12 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

13 if(
em±y
(
$Üd”by
)è
	g$Üd”by
 = 'aid';

16 if(
	g$dİo¡
=='getlist')

18 
AjaxH—d
();

19 
G‘KeywÜdLi¡
(
$dsql
,
$·g’o
,
$·gesize
,
$Üd”by
);

20 
ex™
();

23 if(
	g$dİo¡
=='update')

25 
$aid
 = 
´eg_»¶aû
("#[^0-9]#", "", $aid);

26 
	g$couÁ
 = 
´eg_»¶aû
("#[^0-9]#", "", 
$couÁ
);

27 
	g$keywÜd
 = 
Œim
(
$keywÜd
);

28 
	g$¥wÜds
 = 
Œim
(
$¥wÜds
);

29 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__search_keywords` SET keyword='$keyword',spwords='$spwords',count='$count' WHERE‡id='$aid';");

30 
AjaxH—d
();

31 
G‘KeywÜdLi¡
(
$dsql
, 
$·g’o
, 
$·gesize
, 
$Üd”by
);

32 
ex™
();

35 if(
	g$dİo¡
=='del')

37 
$aid
 = 
´eg_»¶aû
("#[^0-9]#", "", $aid);

38 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__search_keywords` WHERE‡id='$aid';");

39 
AjaxH—d
();

40 
G‘KeywÜdLi¡
(
$dsql
, 
$·g’o
, 
$·gesize
, 
$Üd”by
);

41 
ex™
();

44 if(
	g$dİo¡
=='delall')

46 
fÜ—ch
(
$aids
 
as
 
$aid
)

48 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__search_keywords` WHERE‡id='$aid';");

50 
ShowMsg
("åˆ é™¤æˆåŠŸï¼",
$ENV_GOBACK_URL
);

51 
ex™
();

54 if(
	g$dİo¡
=='')

56 
$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__search_keywords` ");

57 
	g$tÙ®Row
 = 
$row
['dd'];

58 
šşude
(
XAKADMIN
."/templets/search_keywords_main.htm");

62 
funùiÚ
 
G‘KeywÜdLi¡
(
$dsql
,
$·g’o
,
$·gesize
,
$Üd”by
='aid')

64 
glob®
 
$cfg_phpu¾
;

65 
	g$¡¬t
 = (
$·g’o
-1è* 
$·gesize
;

66 
	g$´šth—d
 ="<form‚ame='form3'‡ction=\"search_keywords_main.php\" method=\"post\">

67 <
šput
 
Çme
=\"dopost\"ype=\"hidden\" value=\"\">

68 <
bË
 
width
='98%' 
bÜd”
='0' 
ûÎ·ddšg
='1' 
ûÎ¥acšg
='1' 
bgcŞÜ
='#cfcfcf' 
¡yË
='m¬gš-bÙtom:3px' 
®ign
='center'>

69 <
Œ
 
®ign
='ûÁ”' 
bgcŞÜ
='#F9FCFD' 
height
='24'>

70 <
td
 
width
='5%'>é€‰æ‹©</td>

71 <
td
 
width
='6%' 
height
='23'><
a
 
h»f
='#' 
Úşick
=\"ReloadPage('aid')\"><u>ID</u></a></td>

72 <
td
 
width
='20%'>å…³é”®å­—</td>

73 <
td
 
width
='35%'>åˆ†è¯ç»“æœ</td>

74 <
td
 
width
='6%'><
a
 
h»f
='#' 
Úşick
=\"ReloadPage('count')\"><u>é¢‘ç‡</u></a></td>

75 <
td
 
width
='6%'><
a
 
h»f
='#' 
Úşick
=\"ReloadPage('result')\"><u>ç»“æœ</u></a></td>

76 <
td
 
width
='15%'><
a
 
h»f
='#' 
Úşick
=\"ReloadPage('lasttime')\"><u>æœ€åæœç´¢æ—¶é—´</u></a></td>

77 <
td
>ç®¡ç†</td>

78 </
Œ
>\
r
\
n


80 
echo
 
$´šth—d
;

81 if(
	g$Üd”by
=='»suÉ'è
$Üd”by
 = $orderby." ASC";

82 
	g$Üd”by
 = 
$Üd”by
." DESC";

83 
	g$dsql
->
S‘Qu”y
("SELECT * FROM #@__search_keywords ORDER BY $orderby LIMIT $start,$pagesize ");

84 
	g$dsql
->
Execu‹
();

85 
	g$row
 = 
$dsql
->
G‘A¼ay
())

87 
$lše
 = "

88 <
Œ
 
®ign
='ûÁ”' 
bgcŞÜ
='#FFFFFF' 
ÚMou£Move
=\"javascript:this.bgColor='#F9FCFD';\" onMouseOut=\"javascript:this.bgColor='#FFFFFF';\">

89 <
td
 
height
='24'><
šput
 
Çme
=\"aids[]\"ype=\"checkbox\" class=\"np\" value=\"{$row['aid']}\" /></td>

90 <
td
 
height
='24'>{
$row
['aid']}</td>

91 <
td
 
¡yË
='·ddšg:5px;'><
šput
 
Çme
='keywÜd' 
ty³
='‹xt' 
id
='keywÜd{$row['
aid
']}' 
v®ue
='{$row['
keywÜd
']}' style='width:93%;'></td>

92 <
td
 
¡yË
='·ddšg:5px;'><
šput
 
Çme
='¥wÜds' 
ty³
='‹xt' 
id
='¥wÜds{$row['
aid
']}' 
v®ue
='{$row['
¥wÜds
']}' style='width:95%;'></td>

93 <
td
 
¡yË
='·ddšg:5px;'><
šput
 
Çme
='couÁ' 
ty³
='‹xt' 
id
='couÁ{$row['
aid
']}' 
v®ue
='{$row['
couÁ
']}' 
size
='5'></td>

94 <
td
><
a
 
h»f
='{$cfg_phpu¾}/£¬ch.php?kwty³=0&keywÜd=".u¾’code($row['
keywÜd
'])."&£¬chty³ñ™ËkeywÜd' 
rg‘
='_bÏnk'><
u
>{
$row
['result']}</u></a></td>

95 <
td
>".MyD©e("
Y
-
m
-
d
 
H
:
i
:
s
",$row['lasttime'])."</td>

96 <
td
>

97 <
a
 
h»f
='#' 
Úşick
='Upd©eNÙe({$row['
aid
']})'>æ›´æ–°</a> |

98 <
a
 
h»f
='#' 
Úşick
='D–NÙe({$row['
aid
']})'>åˆ é™¤</a>

99 </
td
>

100 </
Œ
>

102 
echo
 
$lše
;

104 
	gecho
 " <tr‡lign='left' bgcolor='#ffffff' height='30'>

105 <
td
 
	gcŞ¥ª
='8' 
¡yË
='padding-left:10px;'>

106 <
a
 
h»f
='javasüt:£lAÎ()' 
şass
='coolbg‚p'>åé€‰</a>

107 <
a
 
h»f
='javasüt:no£lAÎ()' 
şass
='coolbg‚p'>å–æ¶ˆ</a>

108 <
a
 
h»f
='javasüt:d–®l()' 
şass
='coolbg‚p'>åˆ é™¤</a>

109 </
td
>

110 </
Œ
>\
r
\
n
";

111 
echo
 "</table></form>\r\n";

	@E:\web\weixun\xakadmin\shops_delivery.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('shops_Delivery');

9 
»quœe_Úû
 
	gXAKINC
.'/datalistcp.class.php';

11 if(!
is£t
(
$do
)è
	g$do
 ='';

12 if(
	g$do
=='add')

14 ifĞ
em±y
(
$dÇme
è|| (
¡¾’
($dname) > 100) )

16 
ShowMsg
("è¯·å¡«å†™é…é€æ–¹å¼åç§°!","-1");

17 
ex™
();

19 
	g$´iû
 = 
´eg_»¶aû
("#[^.0-9]#", "", 
$´iû
);

20 if(
	g$´iû
 < 0.01)

22 
	g$´iû
 = '0.00';

24 
	g$des
 = 
ú_sub¡rR
(
$des
,255);

25 
	g$InQu”y
 = "INSERT INTO #@__shops_delivery(`dname`,`price`,`des`) VALUES ('$dname','$price','$des');";

26 
	g$»suÉ
 = 
$dsql
->
Execu‹NÚeQu”y
(
$InQu”y
);

27 if(
	g$»suÉ
)

29 
ShowMsg
("æˆåŠŸæ·»åŠ ä¸€ä¸ªé…é€æ–¹å¼!","shops_delivery.php");

33 
ShowMsg
("æ·»åŠ é…é€æ–¹å¼æ—¶å‘ç”ŸSQLé”™è¯¯!","-1");

35 
ex™
();

36 } ià(
	g$do
 == 'del')

38 
$id
 = 
štv®
($id);

39 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__shops_delivery WHERE…id='$id'");

40 
ShowMsg
("å·²åˆ é™¤å½“å‰é…é€æ–¹å¼!","shops_delivery.php");

41 
ex™
();

42 } ià(
	g$do
 == 'edit')

44 
fÜ—ch
(
$pid
 
as
 
$id
)

46 
$id
 = 
štv®
($id);

47 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT…id,dname,price,des FROM #@__shops_delivery WHERE…id='$id' LIMIT 0,1");

48 if(!
is_¬¿y
(
$row
))

52 
	g$dÇme
 = 
$
{"m_dÇme".
$id
};

53 
	g$´iû
 = 
$
{"m_´iû".
$id
};

54 
	g$des
 = 
$
{"m_des".
$id
};

55 ifĞ
em±y
(
$dÇme
è|| (
¡¾’
($dname) > 100) )

57 
	g$dÇme
 = 
add¦ashes
(
$row
['dname']);

59 
	g$´iû
 = 
´eg_»¶aû
("#[^.0-9]#", "", 
$´iû
);

60 if(
em±y
(
$´iû
))

62 
	g$´iû
 = 
$row
['price'];

64 if(
em±y
(
$des
))

66 
	g$des
 = 
add¦ashes
(
$row
['des']);

70 
	g$des
 = 
ú_sub¡rR
(
$des
,255);

72 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__shops_delivery SET dname='$dname',price='$price',des='$des' WHERE…id='$id'");

74 
ShowMsg
("æˆåŠŸä¿®æ”¹é…é€æ–¹å¼!","shops_delivery.php");

75 
ex™
();

77 
	g$d–iv”y¬r
 = 
¬¿y
();

78 
	g$dsql
->
S‘Qu”y
("SELECT…id,dname,price,des FROM #@__shops_delivery ORDER BY orders ASC");

79 
	g$dsql
->
Execu‹
();

80 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

82 
$d–iv”y¬r
[] = 
$row
;

83 
	}
}

84 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

85 
	g$dli¡
->
	g·geSize
 = 25;

88 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
."/templets/shops_delivery.htm");

89 
	g$dli¡
->
S‘Sourû
("SELECT `pid`,`dname`,`price`,`des` FROM #@__shops_delivery ORDER BY `orders` ASC");

90 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\shops_operations.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('shops_Operations');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

11 if(
	$is£t
(
$dİo¡
))

13 
	`CheckPurv›w
('shops_Operations_cpanel');

14 if(
$dİo¡
 == 'up')

16 
$nids
 = 
	`ex¶ode
('`',
$nid
);

17 
$wh
 = '';

18 
	`fÜ—ch
(
$nids
 
as
 
$n
)

20 if(
$wh
=='') $wh = " WHERE oid='$n' ";

21 
$wh
 .= " OR oid='$n' ";

23 
$sql
="UPDATE #@__shops_orders SET `state`='1' $wh ";

24 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

26 ià(
$dİo¡
 == 'push')

28 
$nids
 = 
	`ex¶ode
('`', 
$nid
);

29 
$wh
 = '';

30 
	`fÜ—ch
(
$nids
 
as
 
$n
)

32 if(
$wh
=='') $wh = " WHERE oid='$n' ";

33 
$wh
 .= " OR oid='$n' ";

35 
$sql
="UPDATE #@__shops_orders SET `state`='2' $wh ";

36 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

38 ià(
$dİo¡
 == 'ok')

40 
$nids
 = 
	`ex¶ode
('`',
$nid
);

41 
$wh
 = '';

42 
	`fÜ—ch
(
$nids
 
as
 
$n
)

44 if(
$wh
=='') $wh = " WHERE oid='$n' ";

45 
$wh
 .= " OR oid='$n' ";

47 
$sql
="UPDATE #@__shops_orders SET `state`='4' $wh ";

48 
$dsql
->
	`Execu‹NÚeQu”y
(
$sql
);

50 ià(
$dİo¡
 == 'delete')

52 
$nids
 = 
	`ex¶ode
('`', 
$nid
);

53 
	`fÜ—ch
(
$nids
 
as
 
$n
)

55 
$qu”y
 = "DELETE FROM `#@__shops_products` WHERE oid='$n'";

56 
$qu”y2
 = "DELETE FROM `#@__shops_orders` WHERE oid='$n'";

57 
$qu”y3
 = "DELETE FROM `#@__shops_userinfo` WHERE oid='$n'";

58 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
);

59 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y2
);

60 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y3
);

62 
	`ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„è®¢å•è®°å½•ï¼",
$ENV_GOBACK_URL
);

63 
	`ex™
();

67 
	`ShowMsg
("ä¸å……è®¸çš„æ“ä½œèŒƒå›´ï¼",
$ENV_GOBACK_URL
);

68 
	`ex™
();

70 
	`ShowMsg
("æˆåŠŸæ›´æ”¹æŒ‡å®šçš„è®¢å•è®°å½•ï¼",
$ENV_GOBACK_URL
);

71 
	`ex™
();

72 
	}
}

74 
	g$addsql
 = '';

75 if(
em±y
(
$oid
)è
	g$oid
 = 0;

76 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

77 if(
	$is£t
(
$buyid
))

79 
$buyid
 = 
	`´eg_»¶aû
("#[^-0-9A-Z]#", "", $buyid);

80 
$addsql
 = "WHERE s.oid='".
$buyid
."'";

81 
	}
}

82 if(
	$is£t
(
$¡a
))

84 
$addsql
 = "WHERE s.`state`='$sta'";

85 
	}
}

86 
	g$sql
 = "SELECT s.`oid`,s.`cartcount`,s.`price`,s.`state`,s.`stime`,s.priceCount,s.dprice,s.paytype,u.`consignee`,u.`tel`,s.`userid` FROM #@__shops_orders AS s LEFT JOIN #@__shops_userinfo AS u ON s.oid=u.oid $addsql ORDER BY `stime` DESC";

88 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

89 
	g$dli¡
->
S‘P¬am‘”
("oid",
$oid
);

90 if(
is£t
(
$¡a
)è
	g$dli¡
->
S‘P¬am‘”
("sta",$sta);

91 
	g$lfe
 = 
XAKADMIN
."/templets/shops_operations.htm";

94 
	g$dli¡
->
S‘Tem¶©e
(
$lfe
);

95 
	g$dli¡
->
S‘Sourû
(
$sql
);

96 
	g$dli¡
->
Di¥Ïy
();

98 
funùiÚ
 
	$G‘S
(
$¡a
)

100 if(
$¡a
==0)

104 if(
$¡a
==1)

108 if(
$¡a
==2)

112 if(
$¡a
==3)

120 
	}
}

122 
funùiÚ
 
	$G‘sTy³
(
$pid
)

124 
glob®
 
$dsql
;

125 
$pid
 = 
	`štv®
($pid);

126 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT‚ame FROM #@__payment WHERE id='$pid'");

127 if(
	`is_¬¿y
(
$row
))

129  
$row
['name'];

135 
	}
}

137 
funùiÚ
 
	$G‘Memb”ID
(
$mid
)

139 
glob®
 
$dsql
;

140 if(
$mid
==0)  '0';

141 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT userid FROM `#@__member_list` WHERE mid='$mid' ");

142 if(
	`is_¬¿y
(
$row
))

144  "<¨h»f='memb”_v›w.php?id={$mid}'>".
$row
['userid']."</a>";

150 
	}
}

	@E:\web\weixun\xakadmin\shops_operations_cart.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
CheckPurv›w
('shops_Operations');

11 if(!
	$is£t
(
$oid
)è
	`ex™
("<a href='javascript:window.close()'>æ— æ•ˆæ“ä½œ!</a>");

12 
$oid
 = 
	`´eg_»¶aû
("#[^-0-9A-Z]#", "", $oid);

13 if(
	$em±y
(
$oid
)è
	`ex™
("<a href='javascript:window.close()'>æ— æ•ˆè®¢å•å·!</a>");

15 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__shops_userinfo WHERE oid='$oid'");

16 
$sql
="SELECT o.*,p.title,p.price‡s uprice,d.dname FROM #@__shops_orders‡s o†eft join #@__shops_products‡s… on o.oid=p.oid†eft join #@__shops_delivery‡s d on d.pid=o.pid WHERE o.oid='$oid'";

18 
$dli¡
 = 
Ãw
 
	`D©aLi¡CP
();

19 
$dli¡
->
·geSize
 = 20;

20 
$dli¡
->
	`S‘P¬am‘”
("oid",
$oid
);

21 
$dli¡
->
	`S‘Tem¶©e
(
XAKADMIN
."/templets/shops_operations_cart.htm");

22 
$dli¡
->
	`S‘Sourû
(
$sql
);

23 
$dli¡
->
	`Di¥Ïy
();

24 
$dli¡
->
	`Clo£
();

26 
funùiÚ
 
	$G‘S
(
$¡a
,
$oid
)

28 
glob®
 
$dsql
;

29 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT…aytype FROM #@__shops_orders WHERE oid='$oid'");

30 
$·yÇme
 = 
$dsql
->
	`G‘OÃ
("SELECT‚ame,fee FROM #@__payment WHERE id='{$row['paytype']}'");

31 if(
$¡a
==0)

33  
$·yÇme
['name']." æ‰‹ç»­è´¹:".$payname['fee']."å…ƒ";

35 ià(
$¡a
==1)

39 ià(
$¡a
==2)

41  '<¨h»f="shİs_´oduùs.php?do=ok&oid='.
$oid
.'">ç¡®è®¤</a>';

47 
	}
}

	@E:\web\weixun\xakadmin\shops_operations_userinfo.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('shops_Operations');

9 if(!
	$is£t
(
$oid
)è
	`ex™
("<a href='javascript:window.close()'>æ— æ•ˆæ“ä½œ!</a>");

10 
$oid
 = 
	`´eg_»¶aû
("#[^-0-9A-Z]#", "", $oid);

11 if(
	$em±y
(
$oid
)è
	`ex™
("<a href='javascript:window.close()'>æ— æ•ˆè®¢å•å·!</a>");

13 
$rows
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__shops_userinfo WHERE oid='$oid' LIMIT 0,1");

14 if(!
	$is_¬¿y
(
$rows
)){

15 
$dsql
->
	`Clo£
();

16 
	`ex™
("<a href='javascript:window.close()'>è¯¥è®¢å•ä¸‹æ²¡ç›¸å…³ç”¨æˆ·ä¿¡æ¯!</a>");

17 
	}
}

19 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT…id,dprice FROM #@__shops_orders WHERE oid='$oid'");

20 if(
	$is_¬¿y
(
$row
))

22 
$rs
 = 
$dsql
->
	`G‘OÃ
("SELECT dname FROM #@__shops_delivery WHERE…id='$row[pid]'");

23 
$rows
['dÇme'] = 
$rs
['dname'];

24 
$rows
['d´iû'] = 
$row
['dprice'];

25 
	}
}

26 
	g$rows
['des'] = 
¡r¦ashes
(
$rows
['des']);

27 
šşude
 
	gXAKADMIN
."/templets/shops_operations_userinfo.htm";

28 
un£t
(
$rows
);

	@E:\web\weixun\xakadmin\stepselect_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('c_Stepselect');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
»quœe_Úû
(
XAKINC
.'/enums.func.php');

15 
	g$ENV_GOBACK_URL
 = (
is£t
(
$ENV_GOBACK_URL
) ? $ENV_GOBACK_URL : 'stepselect_main.php');

16 if(
	$em±y
(
$aùiÚ
))

18 
	`£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
	`time
()+3600,"/");

19 if(!
	`is£t
(
$egroup
)) $egroup = '';

20 if(!
	`is£t
(
$tİv®ue
)) $topvalue = 0;

21 
$‘y³s
 = 
	`¬¿y
();

22 
$egroups
 = 
	`¬¿y
();

23 
$dsql
->
	`Execu‹
('me','SELECT * FROM `#@__stepselect` ORDER BY id DESC');

24 
$¬r
 = 
$dsql
->
	`G‘A¼ay
())

26 
$‘y³s
[] = 
$¬r
;

27 
$egroups
[
$¬r
['egroup']] = $arr['itemname'];

30 if(
$egroup
!='')

32 
$Üd”by
 = 'ORDER BY disorder ASC,ƒvalue ASC';

33 if(!
	`em±y
(
$tİv®ue
))

36 ià(
$tİv®ue
 % 500 == 0)

38 
$egroupsql
 = " WHEREƒgrou°LIKE '$egroup' ANDƒv®ue>=$tİv®uANDƒv®u< ".(
$tİv®ue
 + 500);

40 
$egroupsql
 = " WHERE (evalue LIKE '$topvalue.%%%' ORƒvalue=$topvalue) ANDƒgroup LIKE '$egroup'";

45 
$egroupsql
 = " WHEREƒgroup LIKE '$egroup' ";

47 
$sql
 = "SELECT * FROM `#@__sys_enum` $egroupsql $orderby";

49 
$egroupsql
 = '';

50 
$sql
 = "SELECT * FROM `#@__stepselect` ORDER BY id DESC";

53 
$dli¡
 = 
Ãw
 
	`D©aLi¡CP
();

54 
$dli¡
->
	`S‘P¬am‘”
('egroup',
$egroup
);

55 
$dli¡
->
	`S‘P¬am‘”
('tİv®ue',
$tİv®ue
);

56 
$dli¡
->
	`S‘Tem¶‘
(
XAKADMIN
."/templets/stepselect_main.htm");

57 
$dli¡
->
	`S‘Sourû
(
$sql
);

58 
$dli¡
->
	`di¥Ïy
();

59 
	`ex™
();

60 
	}
}

61 if(
	g$aùiÚ
=='ed™' || 
$aùiÚ
=='addnew' || $action=='addenum' || $action=='view')

63 
AjaxH—d
();

64 
šşude
('./templets/stepselect_showajax.htm');

65 
ex™
();

71 if(
	g$aùiÚ
=='del')

73 
$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__stepselect` WHERE id='$id' ");

74 if(!
is_¬¿y
(
$¬r
))

76 
ShowMsg
("æ— æ³•è·å–åˆ†ç±»ä¿¡æ¯ï¼Œä¸å…è®¸åç»­æ“ä½œï¼", "¡•£Ëù_maš.php?".
ExecTime
());

77 
ex™
();

79 if(
	g$¬r
['issystem']==1)

81 
ShowMsg
("ç³»ç»Ÿå†…ç½®çš„æšä¸¾åˆ†ç±»ä¸èƒ½åˆ é™¤ï¼", "¡•£Ëù_maš.php?".
ExecTime
());

82 
ex™
();

84 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__stepselect` WHERE id='$id'; ");

85 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__sys_enum` WHEREƒgroup='{$arr['egroup']}'; ");

86 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªåˆ†ç±»ï¼", "¡•£Ëù_maš.php?".
ExecTime
());

87 
ex™
();

89 if(
	g$aùiÚ
=='delenumAllSel')

91 if(
is£t
(
$ids
è&& 
is_¬¿y
($ids))

93 
$id
 = 
još
(',', 
$ids
);

95 
	g$groups
 = 
¬¿y
();

96 
	g$dsql
->
Execu‹
('me', "SELECTƒgroup FROM `#@__sys_enum` WHERE id IN($id) GROUP BYƒgroup");

97 
	g$row
 = 
$dsql
->
G‘A¼ay
('me'))

99 
$groups
[] = 
$row
['egroup'];

102 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__sys_enum` WHERE id IN($id); ");

105 
fÜ—ch
(
$groups
 
as
 
$egrİu
)

107 
Wr™eEnumsCache
(
$egroup
);

110 
ShowMsg
("æˆåŠŸåˆ é™¤é€‰ä¸­çš„æšä¸¾åˆ†ç±»ï¼", 
$ENV_GOBACK_URL
);

114 
ShowMsg
("ä½ æ²¡é€‰æ‹©ä»»ä½•åˆ†ç±»ï¼", "-1");

116 
ex™
();

118 if(
	g$aùiÚ
=='delenum')

120 
$row
 = 
$dsql
->
G‘OÃ
("SELECTƒgroup FROM `#@__sys_enum` WHERE id = '$id' ");

121 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__sys_enum` WHERE id='{$id}'; ");

122 
Wr™eEnumsCache
(
$row
['egroup']);

123 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªæšä¸¾ï¼", 
$ENV_GOBACK_URL
);

124 
ex™
();

130 if(
	g$aùiÚ
=='edit_save')

132 if(
´eg_m©ch
("#[^0-9a-z_-]#i", 
$egroup
))

134 
ShowMsg
("ç»„åç§°ä¸èƒ½æœ‰å…¨è§’å­—ç¬¦æˆ–ç‰¹æ®Šç¬¦å·ï¼","-1");

135 
ex™
();

137 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__stepselect` SET `itemname`='$itemname',`egroup`='$egroup' WHERE id='$id'; ");

138 
ShowMsg
("æˆåŠŸä¿®æ”¹ä¸€ä¸ªåˆ†ç±»ï¼", "¡•£Ëù_maš.php?".
ExecTime
());

139 
ex™
();

145 if(
	g$aùiÚ
=='addnew_save')

147 if(
´eg_m©ch
("#[^0-9a-z_-]#i", 
$egroup
))

149 
ShowMsg
("ç»„åç§°ä¸èƒ½æœ‰å…¨è§’å­—ç¬¦æˆ–ç‰¹æ®Šç¬¦å·ï¼", "-1");

150 
ex™
();

152 
	g$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__stepselect` WHERE itemname LIKE '$itemname' ORƒgroup LIKE '$egroup' ");

153 if(
is_¬¿y
(
$¬r
))

155 
ShowMsg
("ä½ æŒ‡å®šçš„ç±»åˆ«åç§°æˆ–ç»„åç§°å·²ç»å­˜åœ¨ï¼Œä¸èƒ½ä½¿ç”¨ï¼","stepselect_main.php");

156 
ex™
();

158 
	g$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__stepselect`(`itemname`,`egroup`,`issign`,`issystem`) VALUES('$itemname','$egroup','0','0'); ");

159 
Wr™eEnumsCache
(
$egroup
);

160 
ShowMsg
("æˆåŠŸæ·»åŠ ä¸€ä¸ªåˆ†ç±»ï¼","stepselect_main.php?egroup=$egroup");

161 
ex™
();

167 if(
	g$aùiÚ
=='exarea')

169 
$bigty³s
 = 
¬¿y
();

170 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__sys_enum` WHEREƒgroup='nativeplace'; ");

171 
	g$qu”y
 = "SELECT * FROM `#@__area` WHERE„eid =0 order by id‡sc";

172 
	g$dsql
->
Execu‹
('me', 
$qu”y
);

173 
	g$n
 = 1;

174 
	g$row
 = 
$dsql
->
G‘A¼ay
())

176 
$bigty³s
[
$row
['id']] = 
$ev®ue
 = 
$disÜd”
 = 
$n
 * 500;

177 
	g$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__sys_enum`(`ename`,`evalue`,`egroup`,`disorder`,`issign`)

178 
VALUES
('{$row['
Çme
']}','$evalue','nativeplace','$disorder','0'); ");

179 
$n
++;

181 
$¡y³s
 = 
¬¿y
();

182 
fÜ—ch
(
$bigty³s
 
as
 
$k
=>
$v
)

184 
$qu”y
 = "SELECT * FROM `#@__area` WHERE„eid=$k order by id‡sc";

185 
$dsql
->
Execu‹
('me', 
$qu”y
);

186 
$n
 = 1;

187 
$row
 = 
$dsql
->
G‘A¼ay
())

189 
$¡y³s
[
$row
['id']] = 
$ev®ue
 = 
$disÜd”
 = 
$v
 + 
$n
;

190 
$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__sys_enum`(`ename`,`evalue`,`egroup`,`disorder`,`issign`)

191 
VALUES
('{$row['
Çme
']}','$evalue','nativeplace','$disorder','0'); ");

192 
$n
++;

195 
Wr™eEnumsCache
('nativeplace');

196 
ShowMsg
("æˆåŠŸå¯¼å…¥æ‰€æœ‰æ—§çš„åœ°åŒºæ•°æ®ï¼", "stepselect_main.php?egroup=nativeplace");

197 
ex™
();

211 if(
$aùiÚ
=='addenum_save')

213 if(
em±y
(
$’ame
è||ƒm±y(
$egroup
))

215 
Showmsg
("ç±»åˆ«åç§°æˆ–ç»„åç§°ä¸èƒ½ä¸ºç©ºï¼","-1");

216 
ex™
();

218 if(
$issign
 =ğ1 || 
$tİv®ue
 == 0)

220 
$’ames
 = 
ex¶ode
(',', 
$’ame
);

221 
fÜ—ch
(
$’ames
 
as
 
$’ame
)

223 
$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__sys_enum` WHEREƒgroup='$egroup' AND (evalue MOD 500)=0 ORDER BY disorder DESC ");

224 if(!
is_¬¿y
(
$¬r
)è
$disÜd”
 = 
$ev®ue
 = (
$issign
==1 ? 1 : 500);

225 
$disÜd”
 = 
$ev®ue
 = 
$¬r
['disÜd”'] + (
$issign
==1 ? 1 : 500);

227 
$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__sys_enum`(`ename`,`evalue`,`egroup`,`disorder`,`issign`)

228 
VALUES
('$ename','$evalue','$egroup','$disorder','$issign'); ");

230 
Wr™eEnumsCache
(
$egroup
);

231 
ShowMsg
("æˆåŠŸæ·»åŠ æšä¸¾åˆ†ç±»ï¼".
$dsql
->
G‘E¼Ü
(), 
$ENV_GOBACK_URL
);

232 
ex™
();

233 } ià(
$issign
 =ğ2 && 
$tİv®ue
 != 0)

235 
$mšid
 = 
$tİv®ue
;

236 
$maxnum
 = 500;

237 
$’ames
 = 
ex¶ode
(',', 
$’ame
);

238 
fÜ—ch
 (
$’ames
 
as
 
$’ame
)

240 
$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__sys_enum` WHEREƒgroup='$egroup' ANDƒvalue LIKE '$topvalue.%%%' ORDER BYƒvalue DESC ");

241 if(!
is_¬¿y
(
$¬r
))

243 
$disÜd”
 = 
$mšid
;

244 
$ev®ue
 = 
$mšid
.'.001';

248 
$disÜd”
 = 
$mšid
;

249 
´eg_m©ch
("#([0-9]{1,})\.([0-9]{1,})#", 
$¬r
['ev®ue'], 
$m©chs
);

250 
$addv®ue
 = 
$m©chs
[2] + 1;

251 
$addv®ue
 = 
¥rštf
("%03d", $addvalue);

252 
$ev®ue
 = 
$m©chs
[1].'.'.
$addv®ue
;

254 
$sql
 = "INSERT INTO `#@__sys_enum`(`ename`,`evalue`,`egroup`,`disorder`,`issign`)

255 
VALUES
('$ename','$evalue','$egroup','$disorder','$issign'); ";

257 
$dsql
->
Execu‹NÚeQu”y
(
$sql
);

260 
Wr™eEnumsCache
(
$egroup
);

261 
ShowMsg
("æˆåŠŸæ·»åŠ æšä¸¾åˆ†ç±»ï¼", 
$ENV_GOBACK_URL
);

262 
ex™
();

264 
$mšid
 = 
$tİv®ue
;

265 
$maxid
 = 
$tİv®ue
 + 500;

266 
$’ames
 = 
ex¶ode
(',', 
$’ame
);

267 
fÜ—ch
(
$’ames
 
as
 
$’ame
)

269 
$¬r
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__sys_enum` WHEREƒgroup='$egroup' ANDƒvalue>$minid ANDƒvalue<$maxid ORDER BYƒvalue DESC ");

270 if(!
is_¬¿y
(
$¬r
))

272 
$disÜd”
 = 
$ev®ue
 = 
$mšid
+1;

276 
$disÜd”
 = 
$¬r
['disorder']+1;

277 
$ev®ue
 = 
$¬r
['evalue']+1;

279 
$dsql
->
Execu‹NÚeQu”y
("INSERT INTO `#@__sys_enum`(`ename`,`evalue`,`egroup`,`disorder`,`issign`)

280 
VALUES
('$ename','$evalue','$egroup','$disorder','$issign'); ");

282 
Wr™eEnumsCache
(
$egroup
);

283 
ShowMsg
("æˆåŠŸæ·»åŠ æšä¸¾åˆ†ç±»ï¼", 
$ENV_GOBACK_URL
);

284 
ex™
();

291 if(
$aùiÚ
=='upenum')

293 
$’ame
 = 
Œim
(
´eg_»¶aû
("# â””â”€(â”€){1,}#", '', $ename));

294 
$row
 = 
$dsql
->
G‘OÃ
("SELECTƒgroup FROM `#@__sys_enum` WHERE id = '$aid' ");

295 
Wr™eEnumsCache
(
$row
['egroup']);

296 
$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__sys_enum` SET `ename`='$ename',`disorder`='$disorder' WHERE id='$aid'; ");

297 
ShowMsg
("æˆåŠŸä¿®æ”¹ä¸€ä¸ªæšä¸¾ï¼", 
$ENV_GOBACK_URL
);

298 
ex™
();

304 if(
$aùiÚ
=='upallcache')

306 if(!
is£t
(
$egroup
)) $egroup = '';

307 
Wr™eEnumsCache
(
$egroup
);

308 
ShowMsg
("æˆæ›´æ–°æšä¸¾ç¼“å­˜ï¼", 
$ENV_GOBACK_URL
);

309 
ex™
();

	@E:\web\weixun\xakadmin\story_add.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_Catalog');

8 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

10 
	g$keywÜds
 = 
$wr™”
 = '';

12 
	g$dsql
->
S‘Qu”y
("SELECT id,classname,pid,rank,booktype FROM #@__story_catalog ORDER BY„ank ASC");

13 
	g$dsql
->
Execu‹
();

14 
	g$¿nks
 = 
A¼ay
();

15 
	g$bty³s
 = 
A¼ay
();

16 
	g$¡y³s
 = 
A¼ay
();

17 
	g$bookty³s
 = 
A¼ay
();

18 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

20 if(
$row
['pid']==0)

22 
$bty³s
[
$row
['id']] = $row['classname'];

26 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

28 
$¿nks
[
$row
['id']] = $row['rank'];

29 if(
$row
['booktype']=='0')

31 
$bookty³s
[
$row
['id']] = 'å°è¯´';

35 
$bookty³s
[
$row
['id']] = 'æ¼«ç”»';

37 
	}
}

38 
	g$Ï¡id
 = 
$row
['id'];

39 
	g$msg
 = '';

40 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/templets/story_add.htm");

	@E:\web\weixun\xakadmin\story_add_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

8 
CheckPurv›w
('story_New');

9 
»quœe_Úû
(
XAKINC
. "/image.func.php");

10 
»quœe_Úû
(
XAKINC
. "/oxwindow.class.php");

11 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/inc/inc_archives_functions.php");

12 if(!
	$is£t
(
$iscomm’d
))

14 
$iscomm’d
 = 0;

15 
	}
}

16 if(
	g$ÿtid
==0)

18 
ShowMsg
("è¯·æŒ‡å®šå›¾ä¹¦æ‰€å±æ ç›®ï¼", "-1");

19 
ex™
();

23 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_catalog WHERE id='$catid' ");

24 
	g$bÿtid
 = 
$Äow
['pid'];

25 
	g$bookty³
 = 
$Äow
['booktype'];

26 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

27 
	g$bookÇme
 = 
ú_sub¡r
(
$bookÇme
,50);

28 if(
	g$keywÜds
!=""è
$keywÜds
 = 
Œim
(
ú_sub¡r
($keywords,60));

30 if(
em±y
(
$authÜ
))
	g$authÜ
=
$cu£rLogš
->
g‘U£rName
();

33 if(
	g$l™pic
 != ""){

34 
$l™pic
 = 
G‘DDImage
('l™pic',
$l™piúame
,0);

36 
	g$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

39 if(
	g$desütiÚ
=="" && 
$cfg_auÙ_desütiÚ
>0)

41 
$desütiÚ
 = 
¡r¦ashes
(
ú_sub¡r
(
html2‹xt
(
$body
),
$cfg_auÙ_desütiÚ
));

42 
	g$desütiÚ
 = 
add¦ashes
(
$desütiÚ
);

45 
	g$šQu”y
 = "

46 
INSERT
 
INTO
 `#@
__¡Üy_books
`(`
ÿtid
`,`
	gbÿtid
`,`
	gbookty³
`,`
	giscomm’d
`,`
	gşick
`,`
	gä“num
`,`
	gbookÇme
`,`
	gauthÜ
`,`
	gmid
`,`
	gl™pic
`,`
	gpubd©e
`,`
	gÏ¡po¡
`,`
	gpo¡num
`,`
	gÏ¡ãedback
`,`
	gãedbacknum
`,`
	gw“kcc
`,`
	gmÚthcc
`,`
	gw“kup
`,`
	gmÚthup
`,`
	gdesütiÚ
`,`
	gbody
`,`
	gkeywÜds
`,`
	gu£r
`,`
	g£ndd©e
` ,`
	g¬üªk
`,`
	ggoodpo¡
`,`
	gbadpo¡
`,`
	gnÙpo¡
`è
VALUES
 ('$catid','$bcatid','$booktype', '$iscommend', '$click', '$freenum', '$bookname', '$author', '0', '$litpic', '$pubdate', '$pubdate', '0', '0', '0', '0', '0', '0', '0', '$description' , '$body' , '$keywords', '','".time()."','$arcrank','0','0','0')";

47 if(!
	g$dsql
->
	$Execu‹NÚeQu”y
(
$šQu”y
))

49 
	`ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼","-1");

50 
	`ex™
();

51 
	}
}

52 
	g$¬cID
 = 
$dsql
->
G‘La¡ID
();

55 
»quœe_Úû
(
XAKROOT
. '/book/include/story.view.class.php');

56 
	g$bv
 = 
Ãw
 
BookV›w
(
$¬cID
, 'book');

57 
	g$¬tU¾
 = 
$bv
->
MakeHtml
();

58 
	g$bv
->
Clo£
();

61 
	g$msg
 = "

63 <
a
 
h»f
='./¡Üy_add.php?ÿtid=$ÿtid'><
u
>ç»§ç»­å‘å¸ƒå›¾ä¹¦</u></a>

64 &
nb¥
;&
	gnb¥
;

65 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹å›¾ä¹¦</u></a>

66 &
nb¥
;&
	gnb¥
;

67 <
a
 
	gh»f
='./¡Üy_add_cÚ‹Á.php?bookid={$¬cID}'><
u
>å¢åŠ å›¾ä¹¦å†…å®¹</u></a>

68 &
nb¥
;&
	gnb¥
;

69 <
a
 
	gh»f
='./¡Üy_books.php'><
u
>ç®¡ç†å›¾ä¹¦</u></a>

71 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒå›¾ä¹¦ï¼";

72 
	g$wecome_šfo
 = "è¿è½½ç®¡ç†::å‘å¸ƒå›¾ä¹¦";

73 
	g$wš
 = 
Ãw
 
OxWšdow
();

74 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒä¸€æœ¬å›¾ä¹¦ï¼š");

75 
	g$wš
->
AddMsgI‹m
(
$msg
);

76 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd", "&nb¥;", 
çl£
);

77 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_add_content.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_New');

8 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

10 if(
	$em±y
(
$bookid
))

12 
	`ShowMsg
("å‚æ•°é”™è¯¯ï¼","-1");

13 
	`ex™
();

14 
	}
}

15 
	g$bookšfos
 = 
$dsql
->
G‘OÃ
("SELECT catid,bcatid,bookname,booktype FROM #@__story_books WHERE bid='$bookid' ");

16 if(
em±y
(
$bookšfos
['bookty³'])è
	g$bookšfos
['booktype'] = '';

18 if(
	g$bookšfos
['booktype']==1)

20 
h—d”
("location:story_add_photo.php?bookid={$bookid}");

21 
ex™
();

25 
	g$dsql
->
S‘Qu”y
("SELECT id,classname,pid,rank FROM #@__story_catalog ORDER BY„ank ASC");

26 
	g$dsql
->
Execu‹
();

27 
	g$¿nks
 = 
A¼ay
();

28 
	g$bty³s
 = 
A¼ay
();

29 
	g$¡y³s
 = 
A¼ay
();

30 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

32 if(
$row
['pid']==0)

34 
$bty³s
[
$row
['id']] = $row['classname'];

38 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

40 
$¿nks
[
$row
['id']] = $row['rank'];

41 
	}
}

42 
	g$Ï¡id
 = 
$row
['id'];

43 
	g$msg
 = '';

44 
	g$dsql
->
S‘Qu”y
("SELECT id,chapnum,chaptername FROM #@__story_chapter WHERE bookid='$bookid' ORDER BY chapnum DESC");

45 
	g$dsql
->
Execu‹
();

46 
	g$ch­‹rs
 = 
A¼ay
();

47 
	g$ch­nums
 = 
A¼ay
();

48 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

50 
$ch­‹rs
[
$row
['id']] = $row['chaptername'];

51 
$ch­nums
[
$row
['id']] = $row['chapnum'];

52 
	}
}

53 
	g$ÿtid
 = 
$bookšfos
['catid'];

54 
	g$bÿtid
 = 
$bookšfos
['bcatid'];

55 
	g$bookÇme
 = 
$bookšfos
['bookname'];

56 
	g$bookty³
 = 
$bookšfos
['booktype'];

57 
»quœe_Úû
(
XAKADMIN
. '/templets/story_add_content.htm');

	@E:\web\weixun\xakadmin\story_add_content_action.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
»quœe_Úû
(
XAKINC
. "/oxwindow.class.php");

8 
»quœe_Úû
(
XAKROOT
. '/book/include/story.func.php');

9 ifĞ
em±y
(
$ch­‹rid
)

10 || (!
em±y
(
$addch­‹r
è&& !
	$em±y
(
$ch­‹ºew
)) )

12 if(
	`em±y
(
$ch­‹ºew
))

14 
	`ShowMsg
("ç”±äºä½ å‘å¸ƒçš„å†…å®¹æ²¡é€‰æ‹©ç« èŠ‚ï¼Œç³»ç»Ÿæ‹’ç»å‘å¸ƒï¼", "-1");

15 
	`ex™
();

17 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__story_chapter WHERE bookid='$bookid' ORDER BY chapnum desc");

18 if(
	`is_¬¿y
(
$row
))

20 
$nch­num
 = 
$row
['chapnum']+1;

24 
$nch­num
 = 1;

26 
$qu”y
 = "INSERT INTO `#@__story_chapter`(`bookid`,`catid`,`chapnum`,`mid`,`chaptername`,`bookname`)

27 
	`VALUES
 ('$bookid', '$catid', '$nchapnum', '0', '$chapternew','$bookname');";

28 
$rs
 = 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
);

29 if(
$rs
)

31 
$ch­‹rid
 = 
$dsql
->
	`G‘La¡ID
();

35 
	`ShowMsg
("å¢åŠ ç« èŠ‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŸå› ï¼","-1");

36 
	`ex™
();

38 
	}
}

41 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_catalog WHERE id='$catid' ");

42 
	g$bÿtid
 = 
$Äow
['pid'];

43 
	g$bookty³
 = 
$Äow
['booktype'];

44 if(
	$em±y
(
$bÿtid
))

46 
$bÿtid
 = 0;

47 
	}
}

48 if(
	$em±y
(
$bookty³
))

50 
$bookty³
 = 0;

51 
	}
}

52 
	g$addtime
 = 
time
();

56 
	g$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

59 
	g$Ìow
 = 
$dsql
->
G‘OÃ
("SELECT sortid From #@__story_content WHERE bookid='$bookid' AND chapterid='$chapterid' ORDER BY sortid DESC");

60 if(
	$em±y
(
$Ìow
))

62 
$sÜtid
 = 1;

63 
	}
}

66 
	g$sÜtid
 = 
$Ìow
['sortid']+1;

68 
	g$šQu”y
 = "

69 
INSERT
 
INTO
 `#@
__¡Üy_cÚ‹Á
`(`
t™Ë
`,`
	gbookÇme
`,`
	gch­‹rid
`,`
	gÿtid
`,`
	gbÿtid
`,`
	gbookid
`,`
	gbookty³
`,`
	gsÜtid
`,

70 `
	gmid
`,`
	gbigpic
`,`
	gbody
`,`
	gaddtime
`)

71 
VALUES
 ('$title','$bookname', '$chapterid', '$catid','$bcatid', '$bookid','$booktype','$sortid', '0', '' , '', '$addtime');";

72 if(!
	g$dsql
->
	$Execu‹NÚeQu”y
(
$šQu”y
))

74 
	`ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼".
$dsql
->
	`G‘E¼Ü
().
$šQu”y
,"-1");

75 
$dsql
->
	`Clo£
();

76 
	`ex™
();

77 
	}
}

78 
	g$¬cID
 = 
$dsql
->
G‘La¡ID
();

79 
Wr™eBookText
(
$¬cID
,
$body
);

82 
	g$row
 = 
$dsql
->
G‘OÃ
("Select count(id) AS dd FROM #@__story_content WHERE bookid = '$bookid' ");

83 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__¡Üy_book SET…o¡num='{$row['dd']}',Ï¡po¡='".
time
()."' WHERE bid='$bookid' ");

86 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT count(id) AS dd FROM #@__story_content WHERE bookid = '$bookid' AND chapterid='$chapterid' ");

87 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__story_chapter SET…ostnum='{$row['dd']}' WHERE id='$chapterid' ");

91 if(
em±y
(
$¬tcÚ‹ÁU¾
)è
	g$¬tcÚ‹ÁU¾
 = '';

93 if(
	g$¬tcÚ‹ÁU¾
==""è
$¬tcÚ‹ÁU¾
 = 
$cfg_cm¥©h
."/book/story.php?id=$arcID";

95 
»quœe_Úû
(
XAKROOT
.'/book/include/story.view.class.php');

96 
	g$bv
 = 
Ãw
 
BookV›w
(
$bookid
, 'book');

97 
	g$¬tU¾
 = 
$bv
->
MakeHtml
();

98 
	g$bv
->
Clo£
();

101 
	g$msg
 = "

103 <
a
 
h»f
='¡Üy_add_cÚ‹Á.php?bookid={$bookid}'><
u
>ç»§ç»­å‘å¸ƒ</u></a>

104 &
nb¥
;&
	gnb¥
;

105 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆå°è¯´</u></a>

106 &
nb¥
;&
	gnb¥
;

107 <
a
 
	gh»f
='$¬tcÚ‹ÁU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆå†…å®¹</u></a>

108 &
nb¥
;&
	gnb¥
;

109 <
a
 
	gh»f
='¡Üy_li¡_cÚ‹Á.php?bookid={$bookid}'><
u
>ç®¡ç†æ‰€æœ‰å†…å®¹</u></a>

110 &
nb¥
;&
	gnb¥
;

111 <
a
 
	gh»f
='¡Üy_books.php'><
u
>ç®¡ç†æ‰€æœ‰å›¾ä¹¦</u></a>

113 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒæ–‡ç« ï¼";

114 
	g$wecome_šfo
 = "è¿è½½ç®¡ç†::å‘å¸ƒæ–‡ç« ";

115 
	g$wš
 = 
Ãw
 
OxWšdow
();

116 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒæ–‡ç« ï¼š");

117 
	g$wš
->
AddMsgI‹m
(
$msg
);

118 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

119 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_add_photo.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_New');

8 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

10 if(
	$em±y
(
$bookid
))

12 
	`ShowMsg
("å‚æ•°é”™è¯¯ï¼","-1");

13 
	`ex™
();

14 
	}
}

15 
	g$bookšfos
 = 
$dsql
->
G‘OÃ
("SELECT catid,bcatid,bookname,booktype FROM #@__story_books WHERE bid='$bookid' ");

16 if(
	g$bookšfos
['booktype']==0)

18 
h—d”
("location:story_add_content.php?bookid={$bookid}");

19 
ex™
();

23 
	g$dsql
->
S‘Qu”y
("SELECT id,classname,pid,rank FROM #@__story_catalog ORDER BY„ank ASC");

24 
	g$dsql
->
Execu‹
();

25 
	g$¿nks
 = 
A¼ay
();

26 
	g$bty³s
 = 
A¼ay
();

27 
	g$¡y³s
 = 
A¼ay
();

28 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

30 if(
$row
['pid']==0)

32 
$bty³s
[
$row
['id']] = $row['classname'];

36 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

38 
$¿nks
[
$row
['id']] = $row['rank'];

39 
	}
}

40 
	g$Ï¡id
 = 
$row
['id'];

41 
	g$msg
 = '';

42 
	g$dsql
->
S‘Qu”y
("SELECT id,chapnum,chaptername FROM #@__story_chapter WHERE bookid='$bookid' ORDER BY chapnum DESC");

43 
	g$dsql
->
Execu‹
();

44 
	g$ch­‹rs
 = 
A¼ay
();

45 
	g$ch­nums
 = 
A¼ay
();

46 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

48 
$ch­‹rs
[
$row
['id']] = $row['chaptername'];

49 
$ch­nums
[
$row
['id']] = $row['chapnum'];

50 
	}
}

51 
	g$ÿtid
 = 
$bookšfos
['catid'];

52 
	g$bÿtid
 = 
$bookšfos
['bcatid'];

53 
	g$bookÇme
 = 
$bookšfos
['bookname'];

54 
	g$bookty³
 = 
$bookšfos
['booktype'];

55 
»quœe_Úû
 
XAKINClude
('/templets/story_add_photo.htm');

	@E:\web\weixun\xakadmin\story_add_photo_action.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_New');

8 
»quœe_Úû
(
XAKINC
. "/image.func.php");

9 
»quœe_Úû
(
XAKINC
. "/oxwindow.class.php");

10 
»quœe_Úû
(
XAKADMIN
. '/inc/inc_archives_functions.php');

11 ifĞ
em±y
(
$ch­‹rid
)

12 || (!
em±y
(
$addch­‹r
è&& !
	$em±y
(
$ch­‹ºew
)) )

14 if(
	`em±y
(
$ch­‹ºew
))

16 
	`ShowMsg
("ç”±äºä½ å‘å¸ƒçš„å†…å®¹æ²¡é€‰æ‹©ç« èŠ‚ï¼Œç³»ç»Ÿæ‹’ç»å‘å¸ƒï¼","-1");

17 
	`ex™
();

20 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__story_chapter WHERE bookid='$bookid' ORDER BY chapnum DESC");

21 if(
	`is_¬¿y
(
$row
))

23 
$nch­num
 = 
$row
['chapnum']+1;

27 
$nch­num
 = 1;

29 
$qu”y
 = "INSERT INTO `#@__story_chapter`(`bookid`,`catid`,`chapnum`,`mid`,`chaptername`,`bookname`)

30 
	`VALUES
 ('$bookid', '$catid', '$nchapnum', '0', '$chapternew','$bookname');";

31 
$rs
 = 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
);

32 if(
$rs
)

34 
$ch­‹rid
 = 
$dsql
->
	`G‘La¡ID
();

38 
	`ShowMsg
("å¢åŠ ç« èŠ‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŸå› ï¼", "-1");

39 
	`ex™
();

41 
	}
}

44 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_catalog WHERE id='$catid' ");

45 
	g$bÿtid
 = 
$Äow
['pid'];

46 
	g$bookty³
 = 
$Äow
['booktype'];

47 
	g$addtime
 = 
time
();

50 
	g$Ìow
 = 
$dsql
->
G‘OÃ
("SELECT sortid FROM #@__story_content WHERE bookid='$bookid' AND chapterid='$chapterid' ORDER BY sortid DESC");

51 if(
	$em±y
(
$Ìow
))

53 
$sÜtid
 = 1;

54 
	}
}

57 
	g$sÜtid
 = 
$Ìow
['sortid']+1;

61 if(!
	$is£t
(
$i¤emÙe
))

63 
$i¤emÙe
 = 0;

64 
	}
}

67 
	g$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

68 
	g$po¡num
 = 0;

69 
	g$i
=1;$i<=
$phÙÚum
;$i++)

71 
	g$bigpic
 = 
U¶ßdOÃImage
('imgfe'.
$i
,
$
{'imgu¾'.$i},
$i¤emÙe
);

72 if(
	g$bigpic
!='')

74 
$t™Ën
 = 
$
{'t™Ë'.
$i
};

75 if(
em±y
(
$t™Ën
))

77 
	g$t™Ën
 = 
$
{'title'};

79 
	g$šQu”y
 = "

80 
INSERT
 
INTO
 `#@
__¡Üy_cÚ‹Á
`(`
t™Ë
`,`
	gbookÇme
`,`
	gch­‹rid
`,`
	gÿtid
`,`
	gbÿtid
`,`
	gbookty³
`,`
	gbookid
`,`
	gsÜtid
`,

81 `
	gmid
`,`
	gbigpic
`,`
	gbody
`,`
	gaddtime
`)

82 
VALUES
 ('$titlen','$bookname', '$chapterid', '$catid','$bcatid','$booktype', '$bookid','$sortid', '0', '$bigpic' , '', '$addtime');";

83 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
);

85 if(
	g$rs
)

87 
	g$sÜtid
++;

88 
	g$po¡num
++;

92 
	g$¬cID
 = 
$dsql
->
G‘La¡ID
();

95 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT count(id) AS dd FROM #@__story_content WHERE bookid = '$bookid' ");

96 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__¡Üy_book SET…o¡num='{$row['dd']}',Ï¡po¡='".
time
()."' WHERE bid='$bookid' ");

99 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT count(id) AS dd FROM #@__story_content WHERE bookid = '$bookid' AND chapterid='$chapterid' ");

100 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__story_chapter SET…ostnum='{$row['dd']}' WHERE id='$chapterid' ");

101 if(
	$em±y
(
$¬cID
))

103 
	`ShowMsg
("æ²¡æˆåŠŸä¿å­˜ä»»ä½•å›¾ç‰‡ï¼Œå¯èƒ½æ˜¯ç³»ç»Ÿæœ‰é—®é¢˜ï¼","-1");

104 
	`ex™
();

105 
	}
}

109 if(
em±y
(
$¬tcÚ‹ÁU¾
)è
	g$¬tcÚ‹ÁU¾
="";

111 if(
	g$¬tcÚ‹ÁU¾
==""è
$¬tcÚ‹ÁU¾
 = 
$cfg_mašs™e
.
$cfg_cm¥©h
."/book/show-photo.php?id=$arcID&bookid=$bookid&chapterid=$chapterid";

113 
»quœe_Úû
(
XAKROOT
. '/book/include/story.view.class.php');

114 
	g$bv
 = 
Ãw
 
BookV›w
(
$bookid
, 'book');

115 
	g$¬tU¾
 = 
$bv
->
MakeHtml
();

116 
	g$bv
->
Clo£
();

119 
	g$msg
 = "

121 <
a
 
h»f
='¡Üy_add_phÙo.php?bookid={$bookid}'><
u
>ç»§ç»­å‘å¸ƒ</u></a>

122 &
nb¥
;&
	gnb¥
;

123 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆæ¼«ç”»</u></a>

124 &
nb¥
;&
	gnb¥
;

125 <
a
 
	gh»f
='$¬tcÚ‹ÁU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆå†…å®¹</u></a>

126 &
nb¥
;&
	gnb¥
;

127 <
a
 
	gh»f
='¡Üy_li¡_cÚ‹Á.php?bookid={$bookid}'><
u
>æœ¬ä¹¦æ‰€æœ‰å†…å®¹</u></a>

128 &
nb¥
;&
	gnb¥
;

129 <
a
 
	gh»f
='¡Üy_books.php'><
u
>ç®¡ç†æ‰€æœ‰å›¾ä¹¦</u></a>

131 
$wšt™Ë
 = "æˆåŠŸå‘å¸ƒå›¾ç‰‡ï¼";

132 
	g$wecome_šfo
 = "è¿è½½ç®¡ç†::å‘å¸ƒå›¾ç‰‡";

133 
	g$wš
 = 
Ãw
 
OxWšdow
();

134 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒå›¾ç‰‡ï¼š");

135 
	g$wš
->
AddMsgI‹m
(
$msg
);

136 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd", "&nb¥;", 
çl£
);

137 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_books.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
»quœe_Úû
 
	gXAKINC
. '/datalistcp.class.php';

8 
£tcook›
("ENV_GOBACK_URL", 
$xakNowu¾
, 
time
()+3600,"/");

9 
CheckPurv›w
('story_list');

10 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

12 if(!
is£t
(
$ÿtid
)è
	g$ÿtid
 = 0;

14 if(!
is£t
(
$keywÜd
)è
	g$keywÜd
 = "";

16 if(!
is£t
(
$Üd”by
)è
	g$Üd”by
 = 0;

18 if(!
is£t
(
$ischeck
)è
	g$ischeck
 = 0;

20 if(!
is£t
(
$cid
)è
	g$cid
 = 0;

22 if(
	g$aùiÚ
 == 'checked')

24 
$id
 = 
štv®
($id);

25 
	g$qu”y
="UPDATE #@__story_books SET ischeck=1 WHERE bid='$id'";

26 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

28 
showmsg
('å®¡æ ¸æˆåŠŸ','story_books.php');

29 
ex™
();

33 
showmsg
('å®¡æ ¸å¤±è´¥','story_books.php');

34 
ex™
();

39 
	g$dsql
->
S‘Qu”y
("SELECT id,classname,pid,rank FROM #@__story_catalog ORDER BY„ank ASC");

40 
	g$dsql
->
Execu‹
();

41 
	g$¿nks
 = 
A¼ay
();

42 
	g$bty³s
 = 
A¼ay
();

43 
	g$¡y³s
 = 
A¼ay
();

44 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

46 if(
$row
['pid']==0)

48 
$bty³s
[
$row
['id']] = $row['classname'];

52 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

54 
$¿nks
[
$row
['id']] = $row['rank'];

55 
	}
}

56 
	g$addqu”y
 = "";

57 if(
	g$ischeck
 == 1)

59 
$addqu”y
 .= "‡nd ischeck=0 ";

61 
	g$Üd”by
 = " ORDER BY b.bid DESC ";

62 if(
	g$ÿtid
!=0)

64 
$addqu”y
 .= " And (b.bcatid='$catid' OR b.catid='$catid') ";

66 if(
	g$keywÜd
!="")

68 
$addqu”y
 .= " And (b.bookname LIKE '%$keyword%' OR b.author LIKE '%$keyword%') ";

70 
	g$qu”y
 = "

71 
SELECT
 
b
.
bid
,
	gb
.
	gÿtid
,b.
	gbookÇme
,b.
	gbookty³
,b.
	gl™pic
,b.
	gischeck
,b.
	gpo¡num
,b.
	g£ndd©e
,
	gc
.
id
 
AS
 
	gcid
,c.
şas¢ame
 
	gFROM
 #@
__¡Üy_books
 b

72 
LEFT
 
	gJOIN
 #@
__¡Üy_ÿlog
 
c
 
ON
 
	gc
.
	gid
 = 
b
.
ÿtid
 
WHERE
 b.
bid
>0 
$addqu”y
 
$Üd”by


74 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

75 
	g$dli¡
->
	g·geSize
 = 20;

76 
	g$dli¡
->
S‘P¬am‘”
("keywÜd", 
$keywÜd
);

77 
	g$dli¡
->
S‘P¬am‘”
("ÿtid", 
$cid
);

78 
	g$dli¡
->
S‘P¬am‘”
("Üd”by", 
$Üd”by
);

79 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
. '/templets/story_books.htm');

80 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

81 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_catalog.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_Catalog');

8 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

10 if(!
is£t
(
$¡y³s
)è
	g$¡y³s
 = '';

14 
funùiÚ
 
	$TjBookNum
(
$cid
,&
$dsql
)

16 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT count(bid) AS dd FROM #@__story_books WHERE catid='$cid' OR bcatid='$cid' ");

17  
$row
['dd'];

18 
	}
}

24 if(
	g$aùiÚ
=='add')

26 
$šQu”y
 = "INSERT INTO #@__story_catalog(classname,pid,rank,listrule,viewrule,booktype,keywords,description)

27 
VALUES
('$classname','$pid','$rank','','','$booktype','$keywords','$description')";

28 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
);

29 if(
	g$rs
)

31 
	g$msg
 = "æˆåŠŸå¢åŠ ä¸€ä¸ªæ ç›®ï¼š{$classname} ï¼";

35 
	g$msg
 = "å¢åŠ æ ç›®æ—¶å¤±è´¥ï¼š{$classname} ï¼";

43 if(
	g$aùiÚ
=='editsave')

45 
$šQu”y
 = "UPDATE #@__story_catalog SET

46 
şas¢ame
='$şas¢ame',
	gpid
='$pid',
	g¿nk
='$¿nk',
	gbookty³
='$booktype',

47 
	gkeywÜds
='$keywÜds',
	gdesütiÚ
='$description'

48 
WHERE
 
id
='$catid' ";

49 
$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
);

50 
	g$msg
 = "æˆåŠŸä¿®æ”¹æ ç›®ï¼š{$catid} = {$classname} ï¼";

51 if(
is£t
(
$¿nks
[
$ÿtid
]))

53 
	g$¿nks
[
$ÿtid
] = 
$¿nk
;

55 if(
is£t
(
$bty³s
[
$ÿtid
]))

57 
	g$bty³s
[
$ÿtid
] = 
$şas¢ame
;

61 if(
is_¬¿y
(
$¡y³s
))

63 
fÜ—ch
(
$¡y³s
 
as
 
$kk
=>
$vv
)

65 if(
is£t
(
$vv
[
$ÿtid
]))

67 
$¡y³s
[
$kk
][
$ÿtid
] = 
$şas¢ame
;

79 if(
	g$aùiÚ
=='del')

81 
$dsql
->
S‘Qu”y
("SELECT id FROM #@__story_catalog WHERE…id='{$catid}' ");

82 
	g$dsql
->
Execu‹
();

83 
	g$ids
 = 
$ÿtid
;

84 
	g$row
 = 
$dsql
->
G‘A¼ay
())

86 
$ids
 .ğ','.
$row
['id'];

88 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_books WHERE catid in ($ids) ");

89 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_chapter WHERE catid in ($ids) ");

90 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_content WHERE catid in ($ids) ");

91 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_catalog WHERE id in ($ids) ");

92 
	g$msg
 = "åˆ é™¤æ ç›®ï¼š{$catid} ï¼OK";

99 if(
	g$aùiÚ
=='uprank')

101 
fÜ—ch
(
$_POST
 
as
 
$rk
=>
$rv
)

103 if(
”eg
('¿nk',
$rk
))

105 
$ÿtid
 = 
¡r_»¶aû
('¿nk_','',
$rk
);

106 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__story_catalog SET„ank='{$rv}' WHERE id='$catid' ");

107 
	g$¿nks
[
$ÿtid
] = 
$rv
;

110 
ShowMsg
("æˆåŠŸæ›´æ–°æ’åºï¼","story_catalog.php");

111 
ex™
();

115 
	g$dsql
->
S‘Qu”y
("SELECT id,classname,pid,rank FROM #@__story_catalog ORDER BY„ank ASC");

116 
	g$dsql
->
Execu‹
();

117 
	g$¿nks
 = 
A¼ay
();

118 
	g$bty³s
 = 
A¼ay
();

119 
	g$¡y³s
 = 
A¼ay
();

120 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

122 if(
$row
['pid']==0)

124 
$bty³s
[
$row
['id']] = $row['classname'];

128 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

130 
$¿nks
[
$row
['id']] = $row['rank'];

131 
	}
}

132 
	g$Ï¡id
 = 
$row
['id'];

133 
	g$msg
 = '';

139 if(
	g$aùiÚ
=='editload')

141 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_catalog WHERE id='$catid'");

142 
AjaxH—d
();

144 <
fÜm
 
	gÇme
='ed™fÜm' 
aùiÚ
='¡Üy_ÿlog.php' 
m‘hod
='get'>

145 <
šput
 
ty³
='hidd’' 
Çme
='aùiÚ' 
v®ue
='editsave' />

146 <
šput
 
ty³
='hidd’' 
Çme
='ÿtid' 
v®ue
='<?phpƒcho $catid; ?>' />

147 <
bË
 
width
="100%" 
bÜd”
="0" 
ûÎ¥acšg
="0" 
ûÎ·ddšg
="0">

148 <
Œ
>

149 <
td
 
width
="90" 
height
="28">æ ç›®åç§°ï¼š</td>

150 <
td
 
width
="101"><
šput
 
Çme
="şas¢ame" 
ty³
="‹xt" 
id
="şas¢ame" 
v®ue
="<?phpƒcho $row['classname']; ?>" /></td>

151 <
td
 
width
="20" 
®ign
="right" 
v®ign
="tİ"><
a
 
h»f
="javasüt:Clo£Ed™C©®og()"><
img
 
¤c
="images/şo£.gif" width="12" 
height
="12" 
bÜd”
="0" /></a></td>

152 </
Œ
>

153 <
Œ
>

154 <
td
 
height
="28">éš¶å±æ ç›®ï¼š</td>

155 <
td
 
cŞ¥ª
="2">

156 <
£Ëù
 
Çme
="pid" 
id
="pid">

157 <
İtiÚ
 
v®ue
="0">é¡¶çº§æ ç›®</option>

158 <?
php


159 
fÜ—ch
(
$bty³s
 
as
 
$k
=>
$v
)

161 if(
$row
['pid']==
$k
)

163 
echo
 "<option value='$k' selected>{$v}</option>\r\n";

165 
–£if
(
$v
 !ğ
$row
['classname'])

167 
echo
 "<option value='$k'>{$v}</option>\r\n";

171 </
	g£Ëù
>

172 </
	gtd
>

173 </
	gŒ
>

174 <
	gŒ
>

175 <
td
 
	gheight
="28">æ’åºçº§åˆ«ï¼š</td>

176 <
td
 
cŞ¥ª
="2"><
šput
 
Çme
="¿nk" 
ty³
="‹xt" 
id
="¿nk" 
size
="5" 
v®ue
="<?phpƒcho $row['rank']; ?>" />

177 ï¼ˆæ•°å€¼å°é å‰ï¼‰</
td
>

178 </
Œ
>

179 <
Œ
>

180 <
td
 
height
="28">è¿è½½ç±»å‹ï¼š</td>

181 <
td
 
cŞ¥ª
="2">

182 <
šput
 
Çme
="bookty³" 
ty³
="¿dio" 
v®ue
="0"<?
php
 if(
$row
['bookty³']==0è
echo
 " checked='checked'";?> />

184 <
šput
 
	gty³
="¿dio" 
Çme
="bookty³" 
v®ue
="1" <?
php
 if(
$row
['bookty³']==1è
echo
 " checked='checked'";?> />

186 </
	gtd
>

187 </
	gŒ
>

188 <
	gŒ
>

189 <
td
 
	gheight
="28">å…³é”®å­—ï¼š</td>

190 <
td
 
cŞ¥ª
="2"><
šput
 
Çme
="keywÜds" 
ty³
="‹xt" 
id
="keywÜds" 
v®ue
="<?phpƒcho $row['keywords']; ?>" /></td>

191 </
Œ
>

192 <
Œ
>

193 <
td
>æ‘˜ã€€è¦ï¼š</td>

194 <
td
 
cŞ¥ª
="2">

195 <
‹x»a
 
Çme
="desütiÚ" 
id
="desütiÚ" 
¡yË
="width:180px;height:45px"><?
php
 
echo
 
$row
['desütiÚ']; ?></
	g‹x»a
>

196 </
	gtd
>

197 </
	gŒ
>

198 <
	gŒ
>

199 <
td
 
	gheight
="43">&
nb¥
;</
	gtd
>

200 <
td
 
	gcŞ¥ª
="2"><
šput
 
ty³
="subm™" 
Çme
="Subm™" 
v®ue
="ä¿å­˜æ›´æ”¹" 
¡yË
="width:80px"/></td>

201 </
Œ
>

202 </
bË
>

203 </
fÜm
>

204 <?
php


205 
ex™
();

207 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/templets/story_catalog.htm");

	@E:\web\weixun\xakadmin\story_content_edit.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
»quœe_Úû
(
XAKROOT
. "/book/include/story.func.php");

8 
CheckPurv›w
('story_Edit');

9 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

11 if(
	$em±y
(
$cid
))

13 
	`ShowMsg
("å‚æ•°é”™è¯¯ï¼", "-1");

14 
	`ex™
();

15 
	}
}

18 
	g$dsql
->
S‘Qu”y
("Select id,classname,pid,rank From #@__story_catalog order by„ank‡sc");

19 
	g$dsql
->
Execu‹
();

20 
	g$¿nks
 = 
A¼ay
();

21 
	g$bty³s
 = 
A¼ay
();

22 
	g$¡y³s
 = 
A¼ay
();

23 
	g$row
 = 
$dsql
->
	$G‘A¼ay
()){

24 if(
$row
['pid']==0è
$bty³s
[$row['id']] = $row['classname'];

25 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

26 
$¿nks
[
$row
['id']] = $row['rank'];

27 
	}
}

28 
	g$Ï¡id
 = 
$row
['id'];

31 
	g$cÚ‹Ás
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_content WHERE id='$cid' ");

33 
	g$bookšfos
 = 
$dsql
->
G‘OÃ
("SELECT catid,bcatid,bookname,booktype FROM #@__story_books WHERE bid='{$contents['bookid']}' ");

34 
	g$ÿtid
 = 
$bookšfos
['catid'];

35 
	g$bÿtid
 = 
$bookšfos
['bcatid'];

36 
	g$bookÇme
 = 
$bookšfos
['bookname'];

37 
	g$bookty³
 = 
$bookšfos
['booktype'];

38 
	g$bookid
 = 
$cÚ‹Ás
['bookid'];

40 
	g$dsql
->
S‘Qu”y
("SELECT id,chapnum,chaptername FROM #@__story_chapter WHERE bookid='{$contents['bookid']}' ORDER BY chapnum DESC");

41 
	g$dsql
->
Execu‹
();

42 
	g$ch­‹rs
 = 
A¼ay
();

43 
	g$ch­nums
 = 
A¼ay
();

44 
	g$row
 = 
$dsql
->
	$G‘A¼ay
()){

45 
$ch­‹rs
[
$row
['id']] = $row['chaptername'];

46 
$ch­nums
[
$row
['id']] = $row['chapnum'];

47 
	}
}

49 
»quœe_Úû
 
XAKINClude
('/templets/story_content_edit.htm');

	@E:\web\weixun\xakadmin\story_do.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_Del');

8 
»quœe_Úû
(
XAKINC
. "/oxwindow.class.php");

9 if(
	$em±y
(
$aùiÚ
))

11 
	`ShowMsg
("ä½ æ²¡æŒ‡å®šä»»ä½•å‚æ•°ï¼","-1");

12 
	`ex™
();

13 
	}
}

19 if(
	g$aùiÚ
=='delbook')

21 
$bids
 = 
ex¶ode
(',', 
$bid
);

22 
fÜ—ch
(
$bids
 
as
 
$i
 => 
$bid
)

24 if(
štv®
(
$bid
)<=0)

28 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT booktype FROM #@__story_books WHERE bid='$bid' ");

29 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_books WHERE bid='$bid' ");

30 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_chapter WHERE bookid='$bid' ");

33 if(
em±y
(
$row
['booktype']))

35 
	g$row
['booktype'] = '';

37 if(
	g$row
['booktype']==1)

39 
$dsql
->
S‘Qu”y
("SELECT bigpic FROM #@__story_content WHERE bookid='$bid' ");

40 
	g$dsql
->
Execu‹
();

41 
	g$row
 = 
$dsql
->
G‘A¼ay
())

43 
$bigpic
 = 
$row
['bigpic'];

44 ifĞ
	g$bigpic
!="" && !
”egi
('^h‰p://',
$bigpic
) )

46 @
uÆšk
(
$cfg_ba£dœ
.
$bigpic
);

50 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_content WHERE bookid='$bid' ");

52 
	g$i
 = 
$i
+1;

53 if(
em±y
(
$ENV_GOBACK_URL
))

55 
	g$ENV_GOBACK_URL
 = 'story_books.php';

57 
ShowMsg
("æˆåŠŸåˆ é™¤ {$i} æœ¬å›¾ä¹¦ï¼",
$ENV_GOBACK_URL
);

58 
ex™
();

65 if(
	g$aùiÚ
=='delcontent')

68 
$row
 = 
$dsql
->
G‘OÃ
("SELECT bigpic,chapterid,bookid FROM #@__story_content WHERE id='$cid' ");

69 
	g$ch­‹rid
 = 
$row
['chapterid'];

70 
	g$bookid
 = 
$row
['bookid'];

73 ifĞ
	g$row
['bigpic']!="" && !
”egi
('^h‰p://',
$row
['bigpic']) )

75 @
uÆšk
(
$cfg_ba£dœ
.
$row
['bigpic']);

77 
	g$dsql
->
Execu‹NÚeQu”y
(" DELETE FROM #@__story_content WHERE id='$cid' ");

80 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT count(id) AS dd FROM #@__story_content WHERE bookid='$bookid' ");

81 
	g$dsql
->
Execu‹NÚeQu”y
("Update #@__story_books SET…ostnum='{$row['dd']}' WHERE bid='$bookid' ");

84 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT count(id) AS dd FROM #@__story_content WHERE chapterid='$chapterid' ");

85 
	g$dsql
->
Execu‹NÚeQu”y
("Update #@__story_chapter SET…ostnum='{$row['dd']}' WHERE id='$chapterid' ");

86 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šå†…å®¹ï¼",
$ENV_GOBACK_URL
);

87 
ex™
();

94 if(
	g$aùiÚ
=='editChapter')

97 
»quœe_Úû
(
XAKINC
."/charSET.func.php");

99 
	g$dsql
->
Execu‹NÚeQu”y
("Update #@__story_chapter SET chaptername='$chaptername',chapnum='$chapnum' WHERE id='$cid' ");

100 
AjaxH—d
();

101 
	gecho
 "<font color='red'>æˆåŠŸæ›´æ–°ç« èŠ‚ï¼š{$chaptername} ï¼ [<a href=\"javascript:CloseLayer('editchapter')\">å…³é—­æç¤º</a>]</font> <br /><br /> æç¤ºï¼šä¿®æ”¹ç« èŠ‚åç§°æˆ–ç« èŠ‚åºå·ç›´æ¥åœ¨å·¦è¾¹ä¿®æ”¹ï¼Œç„¶åç‚¹å‡»å³è¾¹çš„ [æ›´æ–°] ä¼šä¿å­˜ã€‚ ";

102 
ex™
();

109 if(
	g$aùiÚ
=='delChapter')

111 
$row
 = 
$dsql
->
G‘OÃ
("SELECT c.bookid,b.booktype FROM #@__story_chapter c LEFT JOIN #@__story_books b ON b.bid=c.bookid WHERE c.id='$cid' ");

112 
	g$bookid
 = 
$row
['bookid'];

113 
	g$bookty³
 = 
$row
['booktype'];

114 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_chapter WHERE id='$cid' ");

117 if(
	g$bookty³
==1)

119 
$dsql
->
S‘Qu”y
("SELECT bigpic FROM #@__story_content WHERE bookid='$bookid' ");

120 
	g$dsql
->
Execu‹
();

121 
	g$row
 = 
$dsql
->
G‘A¼ay
())

123 
$bigpic
 = 
$row
['bigpic'];

124 ifĞ
	g$bigpic
!="" && !
”egi
('^h‰p://',
$bigpic
) )

126 @
uÆšk
(
$cfg_ba£dœ
.
$bigpic
);

130 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__story_content WHERE chapterid='$cid' ");

133 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT count(id) AS dd FROM #@__story_content WHERE bookid='$bookid' ");

134 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__story_books SET…ostnum='{$row['dd']}' WHERE bid='$bookid' ");

135 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šç« èŠ‚ï¼",
$ENV_GOBACK_URL
);

136 
ex™
();

143 if(
	g$aùiÚ
=='upChapterSort')

145 if(
isSET
(
$ids
è&& 
is_¬¿y
($ids))

147 
fÜ—ch
(
$ids
 
as
 
$cid
)

149 
$ch­‹ºame
 = 
$
{'ch­‹ºame_'.
$cid
};

150 
	g$ch­num
ğ
$
{'ch­num_'.
$cid
};

151 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE #@__story_chapter SET chaptername='$chaptername',chapnum='$chapnum' WHERE id='$cid' ");

154 
ShowMsg
("æˆåŠŸæ›´æ–°æŒ‡å®šç« èŠ‚ä¿¡æ¯ï¼", 
$ENV_GOBACK_URL
);

155 
ex™
();

	@E:\web\weixun\xakadmin\story_edit.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_Edit');

8 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

12 
	g$dsql
->
S‘Qu”y
("SELECT id,classname,pid,rank FROM #@__story_catalog ORDER BY„ank ASC");

13 
	g$dsql
->
Execu‹
();

14 
	g$¿nks
 = 
A¼ay
();

15 
	g$bty³s
 = 
A¼ay
();

16 
	g$¡y³s
 = 
A¼ay
();

17 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

19 if(
$row
['pid']==0)

21 
$bty³s
[
$row
['id']] = $row['classname'];

25 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

27 
$¿nks
[
$row
['id']] = $row['rank'];

28 
	}
}

29 
	g$Ï¡id
 = 
$row
['id'];

30 
	g$msg
 = '';

31 
	g$books
 = 
$dsql
->
G‘OÃ
("SELECT S.*,A.membername FROM #@__arcrank AS A LEFT JOIN #@__story_books AS S ON A.rank=S.arcrank WHERE S.bid='$bookid' ");

32 
»quœe_Úû
(
XAKADMIN
. '/templets/story_edit.htm');

	@E:\web\weixun\xakadmin\story_edit_action.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_New');

8 
»quœe_Úû
(
XAKINC
. "/image.func.php");

9 
»quœe_Úû
(
XAKINC
. "/oxwindow.class.php");

10 
»quœe_Úû
(
XAKADMIN
. "/inc/inc_archives_functions.php");

11 if(!
is£t
(
$iscomm’d
)è
	g$iscomm’d
 = 0;

13 if(
	g$ÿtid
==0)

15 
ShowMsg
("è¯·æŒ‡å®šå›¾ä¹¦æ‰€å±æ ç›®ï¼","-1");

16 
ex™
();

20 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_catalog WHERE id='$catid' ");

21 
	g$bÿtid
 = 
$Äow
['pid'];

22 
	g$bookty³
 = 
$Äow
['booktype'];

23 
	g$pubd©e
 = 
G‘MkTime
(
$pubd©e
);

24 
	g$Ï¡po¡
=
time
();

25 
	g$bookÇme
 = 
ú_sub¡r
(
$bookÇme
,50);

26 if(
	g$keywÜds
!=""è
$keywÜds
 = 
Œim
(
ú_sub¡r
($keywords, 60));

30 if(
	g$l™pic
 !=""è
$l™pic
 = 
G‘DDImage
('litpic', $litpic, 0);

32 if(
	g$l™piúame
 !="" && 
$l™pic
 =ğ""è$l™piøğ
G‘DDImage
('l™pic', 
$l™piúame
, 0);

34 
	g$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

37 if(
	g$desütiÚ
=="" && 
$cfg_auÙ_desütiÚ
>0)

39 
$desütiÚ
 = 
¡r¦ashes
(
ú_sub¡r
(
html2‹xt
(
$body
), 
$cfg_auÙ_desütiÚ
));

40 
	g$desütiÚ
 = 
add¦ashes
(
$desütiÚ
);

42 
	g$upQu”y
 = "

43 
Upd©e
 `#@
__¡Üy_books
`

44 
£t
 
ÿtid
='$catid',

45 
	gbÿtid
='$bcatid',

46 
	giscomm’d
='$iscommend',

47 
	gşick
='$click',

48 
	gä“num
='$freenum',

49 
	g¬üªk
='$arcrank',

50 
	gbookÇme
='$bookname',

51 
	gauthÜ
='$author',

52 
	gl™pic
='$litpic',

53 
	gpubd©e
='$pubdate',

54 
	gÏ¡po¡
='$lastpost',

55 
	gdesütiÚ
='$description',

56 
	gbody
='$body',

57 
	gkeywÜds
='$keywords',

58 
	g¡©us
='$status',

59 
	gischeck
='$ischeck'

60 
wh”e
 
bid
='$bookid' ";

62 if(!
$dsql
->
	$Execu‹NÚeQu”y
(
$upQu”y
))

64 
	`ShowMsg
("æ›´æ–°æ•°æ®åº“æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼".
$dsql
->
	`G‘E¼Ü
(),"-1");

65 
$dsql
->
	`Clo£
();

66 
	`ex™
();

67 
	}
}

70 
»quœe_Úû
(
XAKROOT
. '/book/include/story.view.class.php');

71 
	g$bv
 = 
Ãw
 
BookV›w
(
$bookid
, 'book');

72 
	g$¬tU¾
 = 
$bv
->
MakeHtml
();

73 
	g$bv
->
Clo£
();

76 
	g$msg
 = "

78 <
a
 
h»f
='¡Üy_ed™.php?bookid={$bookid}'><
u
>ç»§ç»­ä¿®æ”¹</u></a>

79 &
nb¥
;&
	gnb¥
;

80 <
a
 
	gh»f
='¡Üy_add.php?ÿtid={$ÿtid}'><
u
>å‘å¸ƒæ–°å›¾ä¹¦</u></a>

81 &
nb¥
;&
	gnb¥
;

82 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆå›¾ä¹¦</u></a>

83 &
nb¥
;&
	gnb¥
;

84 <
a
 
	gh»f
='¡Üy_add_cÚ‹Á.php?bookid={$bookid}'><
u
>å¢åŠ å›¾ä¹¦å†…å®¹</u></a>

85 &
nb¥
;&
	gnb¥
;

86 <
a
 
	gh»f
='¡Üy_books.php'><
u
>ç®¡ç†å›¾ä¹¦</u></a>

88 
$wšt™Ë
 = "æˆåŠŸä¿®æ”¹å›¾ä¹¦ï¼";

89 
	g$wecome_šfo
 = "è¿è½½ç®¡ç†::ä¿®æ”¹å›¾ä¹¦";

90 
	g$wš
 = 
Ãw
 
OxWšdow
();

91 
	g$wš
->
AddT™Ë
("æˆåŠŸä¿®æ”¹ä¸€æœ¬å›¾ä¹¦ï¼š");

92 
	g$wš
->
AddMsgI‹m
(
$msg
);

93 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd", "&nb¥;", 
çl£
);

94 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_edit_content_action.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_Edit');

8 
»quœe_Úû
(
XAKINC
. "/oxwindow.class.php");

9 
»quœe_Úû
(
XAKROOT
. "/book/include/story.func.php");

11 ifĞ
em±y
(
$ch­‹rid
)

12 || (!
em±y
(
$addch­‹r
è&& !
	$em±y
(
$ch­‹ºew
)) )

14 if(
	`em±y
(
$ch­‹ºew
))

16 
	`ShowMsg
("ç”±äºä½ å‘å¸ƒçš„å†…å®¹æ²¡é€‰æ‹©ç« èŠ‚ï¼Œç³»ç»Ÿæ‹’ç»å‘å¸ƒï¼", "-1");

17 
	`ex™
();

19 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * From #@__story_chapter WHERE bookid='$bookid' ORDER BY chapnum DESC");

20 if(
	`is_¬¿y
(
$row
)è
$nch­num
 = $row['chapnum']+1;

21 
$nch­num
 = 1;

22 
$qu”y
 = "INSERT INTO `#@__story_chapter`(`bookid`,`catid`,`chapnum`,`mid`,`chaptername`,`bookname`)

23 
	`VALUES
 ('$bookid', '$catid', '$nchapnum', '0', '$chapternew','$bookname');";

24 
$rs
 = 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
);

25 if(
$rs
){

26 
$ch­‹rid
 = 
$dsql
->
	`G‘La¡ID
();

30 
	`ShowMsg
("å¢åŠ ç« èŠ‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŸå› ï¼", "-1");

31 
	`ex™
();

33 
	}
}

36 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_catalog WHERE id='$catid' ");

37 
	g$bÿtid
 = 
$Äow
['pid'];

38 
	g$bookty³
 = 
$Äow
['booktype'];

40 if(
em±y
(
$bÿtid
)è
	g$bÿtid
 = 0;

41 if(
em±y
(
$bookty³
)è
	g$bookty³
 = 0;

44 
	g$addtime
 = 
time
();

46 
	g$šQu”y
 = "

47 
UPDATE
 `#@
__¡Üy_cÚ‹Á
` 
SET
 `
t™Ë
`='$t™Ë',`
	gbookÇme
`='$bookname',

48 `
	gch­‹rid
`='$ch­‹rid',`
	gsÜtid
`='$sÜtid',`
	gbody
`=''

49 
WHERE
 
id
='$cid'

52 if(!
$dsql
->
	$Execu‹NÚeQu”y
(
$šQu”y
)){

53 
	`ShowMsg
("æ›´æ–°æ•°æ®æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼".
	`¡r_»pŞaû
("'","`",
$dsql
->
	`G‘E¼Ü
().
$šQu”y
),"-1");

54 
$dsql
->
	`Clo£
();

55 
	`ex™
();

56 
	}
}

58 
Wr™eBookText
(
$cid
,
$body
);

59 if(
em±y
(
$¬tcÚ‹ÁU¾
))
	g$¬tcÚ‹ÁU¾
="";

60 if(
	g$¬tcÚ‹ÁU¾
==""è
$¬tcÚ‹ÁU¾
 = 
$cfg_mašs™e
.
$cfg_cm¥©h
."/book/story.php?id={$cid}";

62 
»quœe_Úû
(
XAKROOT
. "/book/include/story.view.class.php");

63 
	g$bv
 = 
Ãw
 
BookV›w
(
$bookid
,'book');

64 
	g$¬tU¾
 = 
$bv
->
MakeHtml
();

65 
	g$bv
->
Clo£
();

70 
	g$msg
 = "

72 <
a
 
h»f
='¡Üy_cÚ‹Á_ed™.php?cid={$cid}'><
u
>ç»§ç»­ç¼–è¾‘</u></a>

73 &
nb¥
;&
	gnb¥
;

74 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆå°è¯´</u></a>

75 &
nb¥
;&
	gnb¥
;

76 <
a
 
	gh»f
='$¬tcÚ‹ÁU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆå†…å®¹</u></a>

77 &
nb¥
;&
	gnb¥
;

78 <
a
 
	gh»f
='¡Üy_li¡_cÚ‹Á.php?bookid={$bookid}'><
u
>æœ¬ä¹¦æ‰€æœ‰å†…å®¹</u></a>

79 &
nb¥
;&
	gnb¥
;

80 <
a
 
	gh»f
='¡Üy_books.php'><
u
>ç®¡ç†æ‰€æœ‰å›¾ä¹¦</u></a>

83 
$wšt™Ë
 = "æˆåŠŸä¿®æ”¹æ–‡ç« ï¼";

84 
	g$wecome_šfo
 = "è¿è½½ç®¡ç†::å‘å¸ƒæ–‡ç« ";

85 
	g$wš
 = 
Ãw
 
OxWšdow
();

86 
	g$wš
->
AddT™Ë
("æˆåŠŸä¿®æ”¹æ–‡ç« ï¼š");

87 
	g$wš
->
AddMsgI‹m
(
$msg
);

88 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd", "&nb¥;", 
çl£
);

89 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_edit_photo_action.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_Edit');

8 
šşude_Úû
(
XAKINC
. "/image.func.php");

9 
šşude_Úû
(
XAKINC
. "/oxwindow.class.php");

10 
»quœe_Úû
(
XAKADMIN
. "/inc/inc_archives_functions.php");

12 ifĞ
em±y
(
$ch­‹rid
)

13 || (!
em±y
(
$addch­‹r
è&& !
	$em±y
(
$ch­‹ºew
)) )

15 if(
	`em±y
(
$ch­‹ºew
))

17 
	`ShowMsg
("ç”±äºä½ å‘å¸ƒçš„å†…å®¹æ²¡é€‰æ‹©ç« èŠ‚ï¼Œç³»ç»Ÿæ‹’ç»å‘å¸ƒï¼", "-1");

18 
	`ex™
();

20 
$dsql
 = 
Ãw
 
	`XakSql
();

21 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM #@__story_chapter WHERE bookid='$bookid' ORDER BY chapnum DESC");

22 if(
	`is_¬¿y
(
$row
)è
$nch­num
 = $row['chapnum']+1;

23 
$nch­num
 = 1;

24 
$qu”y
 = "INSERT INTO `#@__story_chapter`(`bookid`,`catid`,`chapnum`,`mid`,`chaptername`,`bookname`)

25 
	`VALUES
 ('$bookid', '$catid', '$nchapnum', '0', '$chapternew','$bookname');";

26 
$rs
 = 
$dsql
->
	`Execu‹NÚeQu”y
(
$qu”y
);

27 if(
$rs
){

28 
$ch­‹rid
 = 
$dsql
->
	`G‘La¡ID
();

32 
	`ShowMsg
("å¢åŠ ç« èŠ‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŸå› ï¼","-1");

33 
	`ex™
();

35 
	}

	g}–£


37 
	g$dsql
 = 
Ãw
 
XakSql
();

41 
	g$Äow
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_catalog WHERE id='$catid' ");

42 
	g$bÿtid
 = 
$Äow
['pid'];

43 
	g$bookty³
 = 
$Äow
['booktype'];

45 if(
em±y
(
$bÿtid
)è
	g$bÿtid
 = 0;

46 if(
em±y
(
$bookty³
)è
	g$bookty³
 = 0;

49 
	g$addtime
 = 
time
();

52 if(!
is£t
(
$i¤emÙe
)è
	g$i¤emÙe
 = 0;

53 
	g$bigpic
 = 
U¶ßdOÃImage
('imgfe',
$imgu¾
,
$i¤emÙe
);

55 
	g$admšID
 = 
$cu£rLogš
->
g‘U£rID
();

59 
	g$šQu”y
 = "

60 
UPDATE
 `#@
__¡Üy_cÚ‹Á
` 
SET
 `
t™Ë
`='$t™Ë',`
	gbookÇme
`='$bookname',

61 `
	gch­‹rid
`='$ch­‹rid',`
	gsÜtid
`='$sÜtid',`
	gbigpic
`='$bigpic'

62 
WHERE
 
id
='$cid'

65 if(!
$dsql
->
	$Execu‹NÚeQu”y
(
$šQu”y
)){

66 
	`ShowMsg
("æŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ï¼".
	`¡r_»pŞaû
("'","`", 
$dsql
->
	`G‘E¼Ü
().
$šQu”y
), "-1");

67 
$dsql
->
	`Clo£
();

68 
	`ex™
();

69 
	}
}

71 
	g$¬cID
 = 
$cid
;

77 if(
em±y
(
$¬tcÚ‹ÁU¾
))
	g$¬tcÚ‹ÁU¾
="";

78 if(
	g$¬tcÚ‹ÁU¾
==""è
$¬tcÚ‹ÁU¾
 = 
$cfg_mašs™e
.
$cfg_cm¥©h
."/book/show-photo.php?id=$arcID&bookid=$bookid&chapterid=$chapterid";

80 
»quœe_Úû
(
XAKROOT
. '/book/include/story.view.class.php');

81 
	g$bv
 = 
Ãw
 
BookV›w
(
$bookid
, 'book');

82 
	g$¬tU¾
 = 
$bv
->
MakeHtml
();

83 
	g$bv
->
Clo£
();

88 
	g$msg
 = "

90 <
a
 
h»f
='¡Üy_phÙo_ed™.php?cid={$cid}'><
u
>ç»§ç»­ä¿®æ”¹</u></a>

91 &
nb¥
;&
	gnb¥
;

92 <
a
 
	gh»f
='$¬tU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆæ¼«ç”»</u></a>

93 &
nb¥
;&
	gnb¥
;

94 <
a
 
	gh»f
='$¬tcÚ‹ÁU¾' 
rg‘
='_bÏnk'><
u
>é¢„è§ˆå†…å®¹</u></a>

95 &
nb¥
;&
	gnb¥
;

96 <
a
 
	gh»f
='¡Üy_li¡_cÚ‹Á.php?bookid={$bookid}'><
u
>ç®¡ç†æ‰€æœ‰å†…å®¹</u></a>

97 &
nb¥
;&
	gnb¥
;

98 <
a
 
	gh»f
='¡Üy_books.php'><
u
>ç®¡ç†æ‰€æœ‰å›¾ä¹¦</u></a>

101 
$wšt™Ë
 = "æˆåŠŸä¿®æ”¹å†…å®¹ï¼";

102 
	g$wecome_šfo
 = "è¿è½½ç®¡ç†::ä¿®æ”¹æ¼«ç”»å†…å®¹";

103 
	g$wš
 = 
Ãw
 
OxWšdow
();

104 
	g$wš
->
AddT™Ë
("æˆåŠŸå‘å¸ƒæ¼«ç”»ï¼š");

105 
	g$wš
->
AddMsgI‹m
(
$msg
);

106 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd", "&nb¥;", 
çl£
);

107 
	g$wš
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_feedback_edit.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

3 
CheckPurv›w
('sys_Feedback');

4 
	g$id
 = 
is£t
(
$id
è&& 
is_num”ic
($id) ? $id : 0;

5 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL'])? "story_feedback_main.php" : $_COOKIE['ENV_GOBACK_URL'];

6 if(
	$em±y
(
$dİo¡
))

8 
$dİo¡
 = "";

9 
	}
}

10 if(
	g$dİo¡
=='edit')

12 
$msg
 = 
ú_sub¡rR
($msg,2500);

13 
	g$admšmsg
 = 
Œim
(
$admšmsg
);

14 if(
	g$admšmsg
!="")

16 
$admšmsg
 = 
ú_sub¡rR
($adminmsg,1500);

17 
	g$admšmsg
 = 
¡r_»¶aû
("<","&É;",
$admšmsg
);

18 
	g$admšmsg
 = 
¡r_»¶aû
(">","&gt;",
$admšmsg
);

19 
	g$admšmsg
 = 
¡r_»¶aû
(" ","&nb¥;&nb¥;",
$admšmsg
);

20 
	g$admšmsg
 = 
¡r_»¶aû
("\r\n","<br/>\n",
$admšmsg
);

21 
	g$msg
 = 
$msg
."<br/>\n"."<font color=red>ç®¡ç†å‘˜å›å¤ï¼š $adminmsg</font>\n";

23 
	g$qu”y
 = "UPDATE `#@__bookfeedback` SET username='$username',msg='$msg',ischeck=1 WHERE id=$id";

24 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

25 
ShowMsg
("æˆåŠŸå›å¤ä¸€åˆ™ç•™è¨€ï¼",
$ENV_GOBACK_URL
);

26 
ex™
();

28 
	g$qu”y
 = "SELECT * FROM `#@__bookfeedback` WHERE id=$id";

29 
	g$row
 = 
$dsql
->
G‘OÃ
(
$qu”y
);

30 
šşude
 
XAKINClude
('templets/story_feedback_edit.htm');

	@E:\web\weixun\xakadmin\story_feedback_main.php

1 <?
php


2 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

5 
CheckPurv›w
('sys_Feedback');

6 
»quœe_Úû
(
XAKINC
. "/datalistcp.class.php");

7 
»quœe_Úû
(
XAKINC
. "/typelink.class.php");

8 
£tcook›
("ENV_GOBACK_URL", 
$xakNowu¾
, 
time
()+3600,"/");

10 
funùiÚ
 
	$IsCheck
(
$¡
){  $¡==1? "[å·²å®¡æ ¸]" : "<fÚˆcŞÜ='»d'>[æœªå®¡æ ¸]</fÚt>";
	}
}

13 if(!
	$em±y
(
$job
))

15 
$ids
 = 
	`´eg_»¶aû
("#[^0-9,]#", '', 
$fid
);

16 if(
	`em±y
(
$ids
))

18 
	`ShowMsg
("ä½ æ²¡é€‰ä¸­ä»»ä½•é€‰é¡¹ï¼", 
$_COOKIE
['ENV_GOBACK_URL'], 0, 500);

19 
ex™
;

21 
	}
}

24 
	g$job
 = '';

28 ifĞ
	g$job
 == 'del' )

30 
$qu”y
 = "DELETE From `#@__bookfeedback` WHERE id in($ids) ";

31 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

32 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šçš„è¯„è®º!",
$_COOKIE
['ENV_GOBACK_URL'],0,500);

33 
ex™
();

36 ifĞ
	g$job
 == 'delall' )

38 
$dsql
->
S‘Qu”y
("SELECT ip FROM `#@__bookfeedback` WHERE id in ($ids) ");

39 
	g$dsql
->
Execu‹
();

40 
	g$s
 = '';

41 
	g$row
 = 
$dsql
->
G‘A¼ay
())

43 
$s
 .= ($ips=='' ? " ip = '{$row['ip']}' " : " OR ip = '{$row['ip']}' ");

45 if(
	g$s
!='')

47 
$qu”y
 = "DELETE FROM `#@__bookfeedback` WHERE $ips ";

48 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

50 
ShowMsg
("æˆåŠŸåˆ é™¤æŒ‡å®šç›¸åŒIPçš„æ‰€æœ‰è¯„è®º!", 
$_COOKIE
['ENV_GOBACK_URL'], 0, 500);

51 
ex™
();

54 if(
	g$job
=='check')

56 
$qu”y
 = "UPDATE `#@__bookfeedback` SET ischeck=1 WHERE id in($ids) ";

57 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

58 
ShowMsg
("æˆåŠŸå®¡æ ¸æŒ‡å®šè¯„è®º!", 
$_COOKIE
['ENV_GOBACK_URL'], 0, 500);

59 
ex™
();

64 
	g$bgcŞÜ
 = '';

65 
	g$ty³id
 = 
is£t
(
$ty³id
è&& 
is_num”ic
($typeid) ? $typeid : 0;

66 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

67 
	g$keywÜd
 = !
is£t
(
$keywÜd
) ? '' : $keyword;

68 
	g$
 = !
is£t
(
$
) ? '' : $ip;

70 
	g$
 = 
Ãw
 
Ty³Lšk
(
$ty³id
);

71 
	g$İ’¬¿y
 = 
$
->
G‘O±iÚA¼ay
(
$ty³id
,
$admš_ÿlogs
,0);

73 
	g$addsql
 = (
$ty³id
 !ğ0 ? " Andy³id iÀ(".
G‘SÚIds
($typeid).")" : '');

74 
	g$addsql
 .ğ(
$aid
 != 0 ? " And‡id=$aid " : '');

75 
	g$addsql
 .ğ(
$
 != '' ? " And ip†ike '$ip' " : '');

76 
	g$qu”y¡ršg
 = "SELECT * FROM `#@__bookfeedback` WHERE msg†ike '%$keyword%' $addsql ORDER BY dtime DESC";

78 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

79 
	g$dli¡
->
	g·geSize
 = 15;

80 
	g$dli¡
->
S‘P¬am‘”
('aid', 
$aid
);

81 
	g$dli¡
->
S‘P¬am‘”
('', 
$
);

82 
	g$dli¡
->
S‘P¬am‘”
('ty³id', 
$ty³id
);

83 
	g$dli¡
->
S‘P¬am‘”
('keywÜd', 
$keywÜd
);

84 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
. '/templets/story_feedback_main.htm');

85 
	g$dli¡
->
S‘Sourû
(
$qu”y¡ršg
);

86 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_list_chapter.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
»quœe_Úû
 
	gXAKINC
. '/datalistcp.class.php';

8 
£tcook›
("ENV_GOBACK_URL", 
$xakNowu¾
, 
time
()+3600,"/");

9 
CheckPurv›w
('story_books');

10 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

12 if(!
is£t
(
$keywÜd
)è
	g$keywÜd
 = "";

14 if(!
is£t
(
$bid
)è
	g$bid
 = 0;

16 if(!
em±y
(
$bookid
)è
	g$bid
 = $bookid;

19 
	g$addqu”y
 = " id>0 ";

20 
	g$Üd”by
 = " ORDER BY id DESC ";

21 if(
	g$keywÜd
!=""è
$addqu”y
 .= " And (bookname LIKE '%$keyword%' OR chaptername LIKE '%$keyword%') ";

23 if(
	g$bid
!=0è
$addqu”y
 .= " And bookid='$bid' ";

26 
	g$qu”y
 = "

27 
SELECT
 * 
FROM
 #@
__¡Üy_ch­‹r
 
WHERE
 
$addqu”y
 
$Üd”by


29 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

30 
	g$dli¡
->
	g·geSize
 = 20;

31 
	g$dli¡
->
S‘P¬am‘”
("keywÜd", 
$keywÜd
);

32 
	g$dli¡
->
S‘P¬am‘”
("bid", 
$bid
);

33 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
. '/templets/story_list_chapter.htm');

34 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

35 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_list_content.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
»quœe_Úû
 
	gXAKINC
. '/datalistcp.class.php';

8 
£tcook›
("ENV_GOBACK_URL", 
$xakNowu¾
, 
time
()+3600,"/");

9 
CheckPurv›w
('story_books');

10 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

12 if(!
is£t
(
$bookty³
)è
	g$bookty³
 = '-1';

14 if(!
is£t
(
$keywÜd
)è
	g$keywÜd
 = "";

16 if(!
is£t
(
$Üd”by
)è
	g$Üd”by
 = 0;

18 if(!
is£t
(
$bookid
)è
	g$bookid
 = 0;

20 if(!
is£t
(
$ch­id
)è
	g$ch­id
 = 0;

22 
	g$addqu”y
 = "";

23 
	g$Üd”by
 = " ORDER BY ct.id DESC ";

24 if(
	g$bookty³
!='-1'è
$addqu”y
 .= " And ct.booktype='$booktype' ";

26 if(
	g$keywÜd
!=""è
$addqu”y
 .= " And (ct.bookname†ike '%$keyword%' Or ct.title†ike '%$keyword%') ";

28 if(
	g$bookid
!=0è
$addqu”y
 .= " And ct.bookid='$bookid' ";

30 if(
	g$ch­id
!=0è
$addqu”y
 .= " And ct.chapterid='$chapid' ";

32 
	g$qu”y
 = "

33 
SELECT
 
ù
.
id
,
	gù
.
	gt™Ë
,ù.
	gbookid
,ù.
	gch­‹rid
,ù.
	gsÜtid
,ù.
	gbookÇme
,ù.
	gaddtime
,ù.
	gbookty³
,
	gc
.
	gch­‹ºame
,c.
ch­num
 
	gFROM
 #@
__¡Üy_cÚ‹Á
 ct

34 
LEFT
 
	gJOIN
 #@
__¡Üy_ch­‹r
 
c
 
ON
 
	gc
.
	gid
 = 
ù
.
ch­‹rid
 
WHERE
 ct.
id
>0 
$addqu”y
 
$Üd”by


36 
$dli¡
 = 
Ãw
 
D©aLi¡CP
();

37 
	g$dli¡
->
	g·geSize
 = 20;

38 
	g$dli¡
->
S‘P¬am‘”
("keywÜd", 
$keywÜd
);

39 
	g$dli¡
->
S‘P¬am‘”
("bookty³", 
$bookty³
);

40 
	g$dli¡
->
S‘P¬am‘”
("book™", 
$bookid
);

41 
	g$dli¡
->
S‘P¬am‘”
("ch­id", 
$ch­id
);

42 
	g$dli¡
->
S‘Tem¶©e
(
XAKADMIN
. '/templets/story_list_content.htm');

43 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

44 
	g$dli¡
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\story_photo_edit.php

1 <?
php


6 
»quœe_Úû
(
dœÇme
(
__FILE__
). "/config.php");

7 
CheckPurv›w
('story_Edit');

8 if(!
is£t
(
$aùiÚ
)è
	g$aùiÚ
 = '';

9 if(
	$em±y
(
$cid
))

11 
	`ShowMsg
("å‚æ•°é”™è¯¯ï¼", "-1");

12 
	`ex™
();

13 
	}
}

16 
	g$dsql
->
S‘Qu”y
("SELECT id,classname,pid,rank FROM #@__story_catalog ORDER BY„ank ASC");

17 
	g$dsql
->
Execu‹
();

18 
	g$¿nks
 = 
A¼ay
();

19 
	g$bty³s
 = 
A¼ay
();

20 
	g$¡y³s
 = 
A¼ay
();

21 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

23 if(
$row
['pid']==0)

25 
$bty³s
[
$row
['id']] = $row['classname'];

29 
$¡y³s
[
$row
['pid']][$row['id']] = $row['classname'];

31 
$¿nks
[
$row
['id']] = $row['rank'];

32 
	}
}

33 
	g$Ï¡id
 = 
$row
['id'];

34 
	g$cÚ‹Ás
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__story_content WHERE id='$cid' ");

35 
	g$bookšfos
 = 
$dsql
->
G‘OÃ
("SELECT catid,bcatid,bookname,booktype FROM #@__story_books WHERE bid='{$contents['bookid']}' ");

36 
	g$ÿtid
 = 
$bookšfos
['catid'];

37 
	g$bÿtid
 = 
$bookšfos
['bcatid'];

38 
	g$bookÇme
 = 
$bookšfos
['bookname'];

39 
	g$bookty³
 = 
$bookšfos
['booktype'];

40 
	g$bookid
 = 
$cÚ‹Ás
['bookid'];

41 
	g$dsql
->
S‘Qu”y
("SELECT id,chapnum,chaptername FROM #@__story_chapter WHERE bookid='{$contents['bookid']}' order by chapnum DESC");

42 
	g$dsql
->
Execu‹
();

43 
	g$ch­‹rs
 = 
A¼ay
();

44 
	g$ch­nums
 = 
A¼ay
();

45 
	g$row
 = 
$dsql
->
	$G‘A¼ay
())

47 
$ch­‹rs
[
$row
['id']] = $row['chaptername'];

48 
$ch­nums
[
$row
['id']] = $row['chapnum'];

49 
	}
}

50 
»quœe_Úû
 
XAKINClude
('/templets/story_photo_edit.htm');

	@E:\web\weixun\xakadmin\swfupload.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
»quœe_Úû
(
XAKINC
.'/image.func.php');

13 if(
	$em±y
(
$dİo¡
))

15 
	`ši_£t
('html_errors', '0');

16 iàĞ
	`em±y
(
$Fed©a
è|| !
	`is_u¶ßded_fe
($Filedata) )

18 
echo
 'ERROR: Upload Error! ';

19 
	`ex™
(0);

23 
$tmpdœ
 = 
XAKDATA
.'/uploadtmp';

24 if(!
	`is_dœ
(
$tmpdœ
))

26 
	`MkdœAÎ
(
$tmpdœ
, 
$cfg_dœ_purv›w
);

27 
	`Clo£F
();

28 if(!
	`is_dœ
(
$tmpdœ
))

30 
echo
 "ERROR: Create {$tmpdir} dir Error! ";

31 
	`ex™
(0);

35 
$Fed©aNew
 = 
	`¡r_»¶aû
("\\", '/', 
$Fed©a
);

36 
$Fed©aNew
 = 
$tmpdœ
.'/'.
	`´eg_»¶aû
("/(.*)[\/]/isU", "", $FiledataNew);

37 
	`move_u¶ßded_fe
(
$Fed©a
, 
$Fed©aNew
);

39 
$šfo
 = 
$áy³
 = 
$¢ame
 = '';

40 
$¤cInfo
 = 
	`G‘ImageSize
(
$Fed©aNew
, 
$šfo
);

42 ià(!
	`is_¬¿y
(
$¤cInfo
))

44 @
	`uÆšk
(
$Fed©a
);

45 
echo
 "ERROR: Image info Error! ";

46 
	`ex™
(0);

50 
$¤cInfo
[2])

53 
$áy³
 = 'image/gif';

54 
$¢ame
 = '.gif';

57 
$áy³
 = 'image/jpeg';

58 
$¢ame
 = '.jpg';

61 
$áy³
 = 'image/png';

62 
$¢ame
 = '.png';

65 
$áy³
 = 'image/bmp';

66 
$¢ame
 = '.bmp';

70 if(
$áy³
=='')

72 @
	`uÆšk
(
$Fed©a
);

73 
echo
 "ERROR: Imageype Error! ";

74 
	`ex™
(0);

78 
$fedœ
 = 
$cfg_image_dœ
.'/'.
	`MyD©e
(
$cfg_addÚ_§v‘y³
, 
	`time
());

79 if(!
	`is_dœ
(
XAKROOT
.
$fedœ
))

81 
	`MkdœAÎ
(
$cfg_ba£dœ
.
$fedœ
, 
$cfg_dœ_purv›w
);

82 
	`Clo£F
();

84 
$f’ame
 = 
$cu£rLogš
->
	`g‘U£rID
().'-'.
	`dd2ch¬
(
	`MyD©e
('ymdHis', 
	`time
()));

85 ifĞ
	`fe_exi¡s
(
$cfg_ba£dœ
.
$fedœ
.'/'.
$f’ame
.
$¢ame
) )

87 
$i
=50; $i <= 5000; $i++)

89 ifĞ!
	`fe_exi¡s
(
$cfg_ba£dœ
.
$fedœ
.'/'.
$f’ame
.'-'.
$i
.
$¢ame
) )

91 
$f’ame
 = $f’ame.'-'.
$i
;

96 
$feu¾
 = 
$fedœ
.'/'.
$f’ame
.
$¢ame
;

97 
$rs
 = 
	`cİy
(
$Fed©aNew
, 
$cfg_ba£dœ
.
$feu¾
);

100 if(
$cfg_®bum_m¬k
=='Y')

102 
	`W©”Img
(
$cfg_ba£dœ
.
$feu¾
, 'up');

105 
	`uÆšk
(
$Fed©aNew
);

106 if(!
$rs
)

108 
echo
 "ERROR: Copy Uploadfile Error! ";

109 
	`ex™
(0);

111 
$t™Ë
 = 
$f’ame
.
$¢ame
;

113 
$šqu”y
 = "INSERT INTO `#@__uploads`(title,url,mediatype,width,height,playtime,filesize,uptime,mid)

114 
	`VALUES
 ('$title','$fileurl','$ftype','0','0','0','".filesize($cfg_basedir.$fileurl)."','".time()."','".$cuserLogin->getUserID()."'); ";

115 if(!
	`em±y
(
$¬cid
))

117 
$šqu”y
 = "INSERT INTO `#@__uploads`(arcid,title,url,mediatype,width,height,playtime,filesize,uptime,mid)

118 
	`VALUES
 ('$arcid','$title','$fileurl','$ftype','0','0','0','".filesize($cfg_basedir.$fileurl)."','".time()."','".$cuserLogin->getUserID()."'); ";

121 
$dsql
->
	`Execu‹NÚeQu”y
(
$šqu”y
);

122 
$fid
 = 
$dsql
->
	`G‘La¡ID
();

123 
	`AddMyAddÚ
(
$fid
, 
$feu¾
);

126 
	`ob_¡¬t
();

127 
	`ImageResizeNew
(
$cfg_ba£dœ
.
$feu¾
, 
$cfg_ddimg_width
, 
$cfg_ddimg_height
, '', 
çl£
);

128 
$imagev¬ŸbË
 = 
	`ob_g‘_cÚ‹Ás
();

129 
	`ob_’d_ş—n
();

132 ià(!
	`is£t
(
$_SESSION
['fe_šfo'])è$_SESSION['fe_šfo'] = 
	`¬¿y
();

133 ià(!
	`is£t
(
$_SESSION
['bigfe_šfo'])è$_SESSION['bigfe_šfo'] = 
	`¬¿y
();

134 ià(!
	`is£t
(
$_SESSION
['fileid'])) $_SESSION['fileid'] = 1;

135 
$_SESSION
['fileid']++;

137 
$_SESSION
['bigfe_šfo'][$_SESSION['feid']] = 
$feu¾
;

138 
$_SESSION
['fe_šfo'][$_SESSION['feid']] = 
$imagev¬ŸbË
;

139 
echo
 "FILEID:".
$_SESSION
['fileid'];

140 
	`ex™
(0);

141 
	}
}

146 if(
	g$dİo¡
=='thumbnail')

148 ifĞ
em±y
(
$id
) )

150 
h—d”
('HTTP/1.1 500 Internal Server Error');

151 
	gecho
 'No ID';

152 
ex™
(0);

154 ià(!
is_¬¿y
(
$_SESSION
['fe_šfo']è|| !
is£t
($_SESSION['fe_šfo'][
$id
]))

156 
h—d”
('HTTP/1.1 404 Not found');

157 
ex™
(0);

159 
h—d”
('Content-type: image/jpeg');

160 
h—d”
('CÚ‹Á-L’gth: '.
¡¾’
(
$_SESSION
['fe_šfo'][
$id
]));

161 
echo
 
	g$_SESSION
['fe_šfo'][
$id
];

162 
ex™
(0);

167 if(
	g$dİo¡
=='del')

169 if(!
is£t
(
$_SESSION
['bigfe_šfo'][
$id
]))

171 
echo
 '';

172 
ex™
();

174 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__uploads` WHERE url LIKE '{$_SESSION['bigfile_info'][$id]}'; ");

175 @
uÆšk
(
$cfg_ba£dœ
.
$_SESSION
['bigfe_šfo'][
$id
]);

176 
	g$_SESSION
['fe_šfo'][
$id
] = '';

177 
	g$_SESSION
['bigfe_šfo'][
$id
] = '';

178 
	gecho
 "<b>å·²åˆ é™¤ï¼</b>";

179 
ex™
();

184 if(
	g$dİo¡
=='addtoedit')

186 if(!
is£t
(
$_SESSION
['bigfe_šfo'][
$id
]))

188 
echo
 '';

189 
ex™
();

191 
echo
 
	g$_SESSION
['bigfe_šfo'][
$id
];

192 
ex™
();

198 if(
	g$dİo¡
=='ddimg')

201 
ob_¡¬t
();

202 if(!
´eg_m©ch
("/^(h‰p:\/\/)?([^\/]+)/i", 
$img
)è
	g$img
 = 
$cfg_ba£dœ
.$img;

203 
ImageResizeNew
(
$img
, 
$cfg_ddimg_width
, 
$cfg_ddimg_height
, '', 
çl£
);

204 
	g$imagev¬ŸbË
 = 
ob_g‘_cÚ‹Ás
();

205 
ob_’d_ş—n
();

206 
h—d”
('Content-type: image/jpeg');

207 
h—d”
('CÚ‹Á-L’gth: '.
¡¾’
(
$imagev¬ŸbË
));

208 
echo
 
	g$imagev¬ŸbË
;

209 
ex™
();

214 if(
	g$dİo¡
=='delold')

216 
$imgfe
 = 
$cfg_ba£dœ
.
$picfe
;

217 if(!
fe_exi¡s
(
$imgfe
è&& !
is_dœ
($imgfeè&& 
´eg_m©ch
("#^".
$cfg_medŸs_dœ
."#", $imgfile))

219 @
uÆšk
(
$imgfe
);

221 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__uploads` WHERE url LIKE '{$picfile}'; ");

222 
	gecho
 "<b>å·²åˆ é™¤ï¼</b>";

223 
ex™
();

	@E:\web\weixun\xakadmin\sys_admin_user.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_User');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

11 if(
em±y
(
$¿nk
)è
	g$¿nk
 = '';

12 
	g$¿nk
 = " WHERE CONCAT(#@__admin.usertype)='$rank' ";

14 
	g$dsql
->
S‘Qu”y
("SELECT„ank,typename FROM `#@__admintype` ");

15 
	g$dsql
->
Execu‹
();

16 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

18 
$admšRªks
[
$row
->
¿nk
] = $row->
ty³Çme
;

19 
	}
}

20 
	g$qu”y
 = "SELECT `#@__admin_list`.*,#@__arctype.typename FROM `#@__admin_list` LEFT JOIN `#@__arctype` ON `#@__admin_list`.typeid = `#@__arctype`.id $rank ";

21 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

22 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/sys_admin_user.htm");

23 
	g$dli¡
->
S‘Sourû
(
$qu”y
);

24 
	g$dli¡
->
Di¥Ïy
();

26 
funùiÚ
 
	$G‘U£rTy³
(
$Œªk
)

28 
glob®
 
$admšRªks
;

29 if(
	`is£t
(
$admšRªks
[
$Œªk
]))  $adminRanks[$trank];

31 
	}
}

33 
funùiÚ
 
	$G‘ChªÃl
(
$c
)

35 if(
$c
==""||$c==0)  "æ‰€æœ‰é¢‘é“";

36  
$c
;

37 
	}
}

	@E:\web\weixun\xakadmin\sys_admin_user_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_User');

9 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
='';

12 if(
	g$dİo¡
=='add')

14 if(
´eg_m©ch
("#[^0-9a-zA-Z_@!\.-]#", 
$pwd
è||…»g_m©ch("#[^0-9a-zA-Z_@!\.-]#", 
$u£rid
))

16 
ShowMsg
('å¯†ç æˆ–æˆ–ç”¨æˆ·åä¸åˆæ³•ï¼Œ<br />è¯·ä½¿ç”¨[0-9a-zA-Z_@!.-]å†…çš„å­—ç¬¦ï¼', '-1', 0, 3000);

17 
ex™
();

19 
	g$§ãcodeok
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
), 0, 24);

20 if(
	g$§ãcode
 !ğ
$§ãcodeok
 )

22 
ShowMsg
('è¯·å¡«å†™å®‰å…¨éªŒè¯ä¸²ï¼', '-1', 0, 3000);

23 
ex™
();

25 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__member_list` WHERE userid LIKE '$userid' ");

26 if(
	g$row
['dd']>0)

28 
ShowMsg
('ç”¨æˆ·åå·²å­˜åœ¨ï¼','-1');

29 
ex™
();

32 
	g$pwd
 = 
$mpwd
 = 
PassJoš
(
$pwd
);

35 
	g$ty³id
 = 
još
(',', 
$ty³ids
);

36 if(
	g$ty³id
=='0'è
$ty³id
 = '';

39 
	g$admšqu”y
 = "INSERT INTO `#@__member_list` (`mtype`,`userid`,`pwd`,`uname`,`sex`,`rank`,`money`,`email`,

40 `
scÜes
` ,`
	gm©t
` ,`
	gçû
`,`
	g§ãque¡iÚ
`,`
	g§ãªsw”
` ,`
	gjoštime
` ,`
	gjoš
` ,`
	glogštime
` ,`
	glogš
` )

41 
VALUES
 ('ä¸ªäºº','$userid','$mpwd','$uname','ç”·','100','0','$email','1000','10','','0','','0','','0',''); ";

42 
	g$dsql
->
Execu‹NÚeQu”y
(
$admšqu”y
);

44 
	g$mid
 = 
$dsql
->
G‘La¡ID
();

45 if(
	g$mid
 <= 0 )

47 
d›
(
$dsql
->
G‘E¼Ü
().' æ•°æ®åº“å‡ºé”™ï¼');

51 
	g$šqu”y
 = "INSERT INTO `#@__admin_list`(id,usertype,userid,pwd,uname,typeid,tname,email)

52 
VALUES
('$mid','$usertype','$userid','$pwd','$uname','$typeid','$tname','$email'); ";

53 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

55 
	g$admšqu”y
 = "INSERT INTO `#@__member_person` (`mid`,`onlynet`,`sex`,`uname`,`qq`,`msn`,`tel`,`mobile`,`place`,`oldplace`,`birthday`,`star`,

56 `
šcome
` , `
	geduÿtiÚ
` , `
	gheight
` , `
	gbodyty³
` , `
	gblood
` , `
	gvoÿtiÚ
` , `
	gsmoke
` , `
	gm¬™®
` , `
	ghou£
` ,`
	gdršk
` , `
	gd©šgty³
` , `
	gÏnguage
` , `
	gÇtu»
` , `
	glovemsg
` , `
	gadd»ss
`,`
	gu±ime
`)

57 
VALUES
 ('$mid', '1', 'ç”·', '{$userid}', '', '', '', '', '0', '0','1980-01-01', '1', '0', '0', '160', '0', '0', '0', '0', '0', '0','0', '0', '', '', '', '','0'); ";

58 
	g$dsql
->
Execu‹NÚeQu”y
(
$admšqu”y
);

60 
	g$admšqu”y
 = "INSERT INTO `#@__member_tj` (`mid`,`article`,`album`,`archives`,`homecount`,`pagecount`,`feedback`,`friend`,`stow`)

61 
VALUES
 ('$mid','0','0','0','0','0','0','0','0'); ";

62 
	g$dsql
->
Execu‹NÚeQu”y
(
$admšqu”y
);

64 
	g$admšqu”y
 = "Insert Into `#@__member_space`(`mid` ,`pagesize` ,`matt` ,`spacename` ,`spacelogo` ,`spacestyle`, `sign` ,`spacenews`)

65 
V®ues
('$mid','10','0','{$uname}çš„ç©ºé—´','','person','',''); ";

66 
	g$dsql
->
Execu‹NÚeQu”y
(
$admšqu”y
);

68 
ShowMsg
('æˆåŠŸå¢åŠ ä¸€ä¸ªç”¨æˆ·ï¼', 'sys_admin_user.php');

69 
ex™
();

71 
	g$¿ndcode
 = 
mt_¿nd
(10000, 99999);

72 
	g$§ãcode
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
), 0, 24);

73 
	g$ty³O±iÚs
 = '';

74 
	g$dsql
->
S‘Qu”y
(" SELECT id,typename FROM `#@__arctype` WHERE„eid=0 AND (ispart=0 OR ispart=1) ");

75 
	g$dsql
->
Execu‹
('op');

76 
	g$row
 = 
$dsql
->
G‘Objeù
('op'))

78 
$tİc
 = 
$row
->
id
;

79 
	g$ty³O±iÚs
 .= "<option value='{$row->id}' class='btype'>{$row->typename}</option>\r\n";

80 
	g$dsql
->
S‘Qu”y
(" SELECT id,typename FROM `#@__arctype` WHERE„eid={$row->id} AND (ispart=0 OR ispart=1) ");

81 
	g$dsql
->
Execu‹
('s');

82 
	g$row
 = 
$dsql
->
G‘Objeù
('s'))

84 
$ty³O±iÚs
 .= "<option value='{$row->id}' class='stype'>â€”{$row->typename}</option>\r\n";

87 
šşude
 
XAKINClude
('templets/sys_admin_user_add.htm');

	@E:\web\weixun\xakadmin\sys_admin_user_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('sys_User');

9 
»quœe_Úû
(
XAKINC
.'/typelink.class.php');

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 
	g$id
 = 
´eg_»¶aû
("#[^0-9]#", '', 
$id
);

13 if(
	g$dİo¡
=='saveedit')

15 
$pwd
 = 
Œim
($pwd);

16 if(
	g$pwd
!='' && 
´eg_m©ch
("#[^0-9a-zA-Z_@!\.-]#", 
$pwd
))

18 
ShowMsg
('å¯†ç ä¸åˆæ³•ï¼Œè¯·ä½¿ç”¨[0-9a-zA-Z_@!.-]å†…çš„å­—ç¬¦ï¼', '-1', 0, 3000);

19 
ex™
();

21 
	g$§ãcodeok
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
), 0, 24);

22 if(
	g$§ãcodeok
 !ğ
$§ãcode
)

24 
ShowMsg
("è¯·å¡«å†™æ­£ç¡®çš„å®‰å…¨éªŒè¯ä¸²ï¼", "sys_admin_user_edit.php?id={$id}&dopost=edit");

25 
ex™
();

27 
	g$pwdm
 = '';

28 if(
	g$pwd
 != '')

30 
$pwdm
 = ",pwd='".
PassJoš
(
$pwd
)."'";

31 
	g$pwd
 = ",pwd='".
PassJoš
(
$pwd
)."'";

34 if(
em±y
(
$ty³ids
))

36 
	g$ty³id
 = '';

38 
	g$ty³id
 = 
još
(',', 
$ty³ids
);

39 if(
	g$ty³id
=='0'è
$ty³id
 = '';

41 if(
	g$id
!=1){

42 
$qu”y
 = "UPDATE `#@__admin_list` SET uname='$uname',usertype='$usertype',tname='$tname',email='$email',typeid='$typeid' $pwd WHERE id='$id'";

44 
	g$qu”y
 = "UPDATE `#@__admin_list` SET uname='$uname',tname='$tname',email='$email',typeid='$typeid' $pwd WHERE id='$id'";

46 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

47 
	g$qu”y
 = "UPDATE `#@__member_list` SET uname='$uname',email='$email'$pwdm WHERE mid='$id'";

48 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

49 
ShowMsg
("æˆåŠŸæ›´æ”¹ä¸€ä¸ªå¸æˆ·ï¼", "sys_admin_user.php");

50 
ex™
();

52 if(
	g$dİo¡
=='delete')

54 if(
em±y
(
$u£rok
)) $userok="";

55 if(
	g$u£rok
!="yes")

57 
$¿ndcode
 = 
mt_¿nd
(10000, 99999);

58 
	g$§ãcode
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
),0,24);

59 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

60 
	g$wšt™Ë
 = "åˆ é™¤ç”¨æˆ·";

61 
	g$wecome_šfo
 = "<a href='sys_admin_user.php'>ç³»ç»Ÿå¸å·ç®¡ç†</a>::åˆ é™¤ç”¨æˆ·";

62 
	g$wš
 = 
Ãw
 
OxWšdow
();

63 
	g$wš
->
In™
("sys_admin_user_edit.php","js/blank.js","POST");

64 
	g$wš
->
AddHidd’
("dİo¡", 
$dİo¡
);

65 
	g$wš
->
AddHidd’
("userok", "yes");

66 
	g$wš
->
AddHidd’
("¿ndcode", 
$¿ndcode
);

67 
	g$wš
->
AddHidd’
("§ãcode", 
$§ãcode
);

68 
	g$wš
->
AddHidd’
("id", 
$id
);

69 
	g$wš
->
AddT™Ë
("ç³»ç»Ÿè­¦å‘Šï¼");

70 
	g$wš
->
AddMsgI‹m
("ä½ ç¡®ä¿¡è¦åˆ é™¤ç”¨æˆ·ï¼š$userid å—ï¼Ÿ","50");

71 
	g$wš
->
AddMsgI‹m
("å®‰å…¨éªŒè¯ä¸²ï¼š<input‚ame='safecode'ype='text' id='safecode' size='16' style='width:200px' />&nbsp;(å¤åˆ¶æœ¬ä»£ç ï¼š <font color='red'>$safecode</font> )","30");

72 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("ok");

73 
	g$wš
->
Di¥Ïy
();

74 
ex™
();

76 
	g$§ãcodeok
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
),0,24);

77 if(
	g$§ãcodeok
!=
$§ãcode
)

79 
ShowMsg
("è¯·å¡«å†™æ­£ç¡®çš„å®‰å…¨éªŒè¯ä¸²ï¼", "sys_admin_user.php");

80 
ex™
();

84 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y2
("DELETE FROM `#@__admš_li¡` WHERE id='$id' AND id<>1 AND id<>'".
$cu£rLogš
->
g‘U£rID
()."' ");

85 if(
	g$rs
>0)

88 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__member_list` SET matt='0' WHERE mid='$id' LIMIT 1");

89 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªå¸æˆ·ï¼","sys_admin_user.php");

93 
ShowMsg
("ä¸èƒ½åˆ é™¤idä¸º1çš„åˆ›å»ºäººå¸å·ï¼Œä¸èƒ½åˆ é™¤è‡ªå·±ï¼","sys_admin_user.php",0,3000);

95 
ex™
();

99 
	g$¿ndcode
 = 
mt_¿nd
(10000,99999);

100 
	g$§ãcode
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
.
$¿ndcode
),0,24);

101 
	g$ty³O±iÚs
 = '';

102 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__admin_list` WHERE id='$id'");

103 
	g$ty³ids
 = 
ex¶ode
(',', 
$row
['typeid']);

104 
	g$dsql
->
S‘Qu”y
("SELECT id,typename FROM `#@__arctype` WHERE„eid=0 AND (ispart=0 OR ispart=1)");

105 
	g$dsql
->
Execu‹
('op');

107 
	g$Äow
 = 
$dsql
->
G‘Objeù
('op'))

109 
$ty³O±iÚs
 .ğ"<İtiÚ v®ue='{$Äow->id}' cÏss='bty³'".(
š_¬¿y
(
$Äow
->
id
, 
$ty³ids
) ? ' selected' : '').">{$nrow->typename}</option>\r\n";

110 
	g$dsql
->
S‘Qu”y
("SELECT id,typename FROM #@__arctype WHERE„eid={$nrow->id} AND (ispart=0 OR ispart=1)");

111 
	g$dsql
->
Execu‹
('s');

113 
	g$Äow
 = 
$dsql
->
G‘Objeù
('s'))

115 
$ty³O±iÚs
 .ğ"<İtiÚ v®ue='{$Äow->id}' cÏss='¡y³'".(
š_¬¿y
(
$Äow
->
id
, 
$ty³ids
) ? ' selected' : '').">â€”{$nrow->typename}</option>\r\n";

118 
šşude
 
XAKINClude
('templets/sys_admin_user_edit.htm');

	@E:\web\weixun\xakadmin\sys_admin_user_tj.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_User');

10 if(
is£t
(
$dİo¡
è&& 
	g$dİo¡
=='getone')

12 
$row
 = 
$dsql
->
G‘OÃ
("SELECT userid FROM `#@__admin_list` WHERE id='$uid'; ");

13 
	g$u£rid
 = 
$row
['userid'];

14 
	g$y
 = 
štv®
(
MyD©e
('Y', 
time
()));

15 
	g$m
 = 
štv®
(
MyD©e
('m', 
time
()));

16 
	g$d
 = 
štv®
(
MyD©e
('d', 
time
()));

19 
	g$sql
="SELECT‡ddtable FROM `#@__channeltype` WHERE issystem='-1'";

20 
	g$dsql
->
Execu‹
('me', 
$sql
);

21 
	g$äow
 = 
$dsql
->
G‘A¼ay
('me'))

23 
$dd
=
em±y
($dd)? "0" : $dd;

24 
	g$cc
=
em±y
(
$cc
)? "0" : $cc;

25 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd,SUM(click) AS cc FROM `{$frow['addtable']}` WHERE mid='$uid'; ");

26 
	g$dd
 +ğ
$row
['dd'];

27 
	g$cc
 +ğ
$row
['cc'];

29 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(id) AS dd,SUM(click) AS cc FROM `#@__archives` WHERE mid='$uid'; ");

30 
	g$dd
 = 
$row
['dd'] + 
$dd
;

31 
	g$cc
 = 
$row
['cc'] + 
$cc
;

34 
	g$¡¬‰ime
 = 0;

35 ifĞ
´eg_m©ch
("#[123]#", 
$m
è&& 
	g$m
 < 10è
	g$¡¬‰ime
 = 
$y
."-01-01 00:00:00";

36 ifĞ
´eg_m©ch
("#[456]#", 
$m
èè
	g$¡¬‰ime
 = 
$y
."-04-01 00:00:00";

37 ifĞ
´eg_m©ch
("#[789]#", 
$m
èè
	g$¡¬‰ime
 = 
$y
."-07-01 00:00:00";

38 
	g$¡¬‰ime
 = 
$y
."-10-01 00:00:00";

39 
	g$i¡¬‰ime
 = 
G‘MkTime
(
$¡¬‰ime
);

40 
	g$sql
="SELECT‡ddtable FROM `#@__channeltype` WHERE issystem='-1'";

41 
	g$dsql
->
Execu‹
('me', 
$sql
);

42 
	g$äow
 = 
$dsql
->
G‘A¼ay
('me'))

44 
$dds
 = 
em±y
($dds)? "0" : $dds;

45 
	g$ccs
 = 
em±y
(
$ccs
)? "0" : $ccs;

46 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd,SUM(click) AS cc FROM `{$frow['addtable']}` WHERE senddate>$istarttime AND mid='$uid'; ");

47 
	g$dds
 +ğ
$row
['dd'];

48 
	g$ccs
 +ğ
$row
['cc'];

50 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(id) AS dd,SUM(click) AS cc FROM `#@__archives` WHERE senddate>$istarttime AND mid='$uid'; ");

51 
	g$dds
 = 
$row
['dd'] + 
$dds
;

52 
	g$ccs
 = 
$row
['cc'] + 
$ccs
;

55 
	g$¡¬‰ime
 = 
$y
."-{$m}-01 00:00:00";

56 
	g$i¡¬‰ime
 = 
G‘MkTime
(
$¡¬‰ime
);

57 
	g$sql
="SELECT‡ddtable FROM `#@__channeltype` WHERE issystem='-1'";

58 
	g$dsql
->
Execu‹
('me', 
$sql
);

59 
	g$äow
 = 
$dsql
->
G‘A¼ay
('me'))

61 
$ddm
 = 
em±y
($ddm)? "0" : $ddm;

62 
	g$ccm
 = 
em±y
(
$ccm
)? "0" : $ccm;

63 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd,SUM(click) AS cc FROM `{$frow['addtable']}` WHERE senddate>$istarttime AND mid='$uid'; ");

64 
	g$ddm
 +ğ
$row
['dd'];

65 
	g$ccm
 +ğ
$row
['cc'];

67 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(id) AS dd,SUM(click) AS cc FROM `#@__archives` WHERE senddate>$istarttime AND mid='$uid'; ");

68 
	g$ddm
 = 
$row
['dd'] + 
$ddm
;

69 
	g$ccm
 = 
$row
['cc'] + 
$ccm
;

72 
	g$¡¬‰ime
 = 
$y
."-{$m}-{$d} 00:00:00";

73 
	g$i¡¬‰ime
 = 
G‘MkTime
(
$¡¬‰ime
) - (7*24*3600);

74 
	g$sql
="SELECT‡ddtable FROM `#@__channeltype` WHERE issystem='-1'";

75 
	g$dsql
->
Execu‹
('me', 
$sql
);

76 
	g$äow
 = 
$dsql
->
G‘A¼ay
('me'))

78 
$ddw
=
em±y
($ddw)? "0" : $ddw;

79 
	g$ccw
=
em±y
(
$ccw
)? "0" : $ccw;

80 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd,SUM(click) AS cc FROM `{$frow['addtable']}` WHERE senddate>$istarttime AND mid='$uid'; ");

81 
	g$ddw
 +ğ
$row
['dd'];

82 
	g$ccw
 +ğ
$row
['cc'];

84 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(id) AS dd,SUM(click) AS cc FROM `#@__archives` WHERE senddate>$istarttime AND mid='$uid'; ");

85 
	g$ddw
 = 
$row
['dd'] + 
$ddw
;

86 
	g$ccw
 = 
$row
['cc'] + 
$ccw
;

89 
	g$¡¬‰ime
 = 
$y
."-{$m}-{$d} 00:00:00";

90 
	g$i¡¬‰ime
 = 
G‘MkTime
(
$¡¬‰ime
);

91 
	g$sql
="SELECT‡ddtable FROM `#@__channeltype` WHERE issystem='-1'";

92 
	g$dsql
->
Execu‹
('me', 
$sql
);

93 
	g$äow
 = 
$dsql
->
G‘A¼ay
('me'))

95 
$ddd
=
em±y
($ddd)? "0" : $ddd;

96 
	g$ccd
=
em±y
(
$ccd
)? "0" : $ccd;

97 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd,SUM(click) AS cc FROM `{$frow['addtable']}` WHERE senddate>$istarttime AND mid='$uid'; ");

98 
	g$ddd
 +ğ
$row
['dd'];

99 
	g$ccd
 +ğ
$row
['cc'];

101 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(id) AS dd,SUM(click) AS cc FROM `#@__archives` WHERE senddate>$istarttime AND mid='$uid'; ");

102 
	g$ddd
 = 
$row
['dd'] + 
$ddd
;

103 
	g$ccd
 = 
$row
['cc'] + 
$ccd
;

105 
	g$msg
 = "<table width='96%' border='0'‡lign='center' cellpadding='3' cellspacing='1' bgcolor='#cfcfcf'>

106 <
Œ
 
®ign
='ûÁ”' 
bgcŞÜ
='#F9FCFD'>

107 <
td
 
width
='18%' 
height
='26'><
¡rÚg
>ç®¡ç†å‘˜â†“|ç»Ÿè®¡ä¿¡æ¯â†’</strong></td>

108 <
td
 
width
='18%'><
¡rÚg
>å…¨éƒ¨(æ–‡æ¡£|ç‚¹å‡»)</strong></td>

109 <
td
 
width
='16%'><
¡rÚg
>å­£åº¦</strong></td>

110 <
td
 
width
='16%'><
¡rÚg
>å½“æœˆ</strong></td>

111 <
td
 
width
='16%'><
¡rÚg
>è¿‘ä¸ƒå¤©</strong></td>

112 <
td
 
width
='16%'><
¡rÚg
>å½“å¤©</strong></td>

113 </
Œ
>

114 <
Œ
 
®ign
='ûÁ”' 
bgcŞÜ
='#FFFFFF'>

115 <
td
 
height
='26'>{
$u£rid
}</td>

116 <
td
>{
$dd
} | {
$cc
}</td>

117 <
td
>{
$dds
} | {
$ccs
}</td>

118 <
td
>{
$ddm
} | {
$ccm
}</td>

119 <
td
>{
$ddw
} | {
$ccw
}</td>

120 <
td
>{
$ddd
} | {
$ccd
}</td>

121 </
Œ
>

122 </
bË
><
br
 
¡yË
='ş—r:bÙh'/>\
r
\
n
";

123 
AjaxH—d
();

124 
echo
 
	g$msg
;

125 
ex™
();

128 
šşude
 
XAKINClude
('templets/sys_admin_user_tj.htm');

	@E:\web\weixun\xakadmin\sys_cache_up.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_ArcBatch');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

10 if(
em±y
(
$¡•
)è
	g$¡•
 = 1;

12 if(
	g$dİo¡
=="ok")

14 if(
em±y
(
$u·rc
)) $uparc = 0;

15 if(
	g$¡•
 == -1)

17 if(
$u·rc
 =ğ0è
¦“p
(1);

18 
ShowMsg
("æˆåŠŸæ›´æ–°æ‰€æœ‰ç¼“å­˜ï¼","javascript:;");

19 
ex™
();

23 if(
	g$¡•
 == 1)

25 
UpD©eC©Cache
();

26 
CË¬O±Cache
();

27 
ShowMsg
("æˆåŠŸæ›´æ–°æ ç›®ç¼“å­˜ï¼ŒåŠåå°æ ç›®é€‰é¡¹,å‡†å¤‡æ›´æ–°æšä¸¾ç¼“å­˜...","sys_cache_up.php?dopost=ok&step=2&uparc=$uparc");

28 
ex™
();

32 if(
	g$¡•
 == 2)

34 
šşude_Úû
(
XAKINC
."/enums.func.php");

35 
Wr™eEnumsCache
();

37 
ShowMsg
("æˆåŠŸæ›´æ–°æšä¸¾ç¼“å­˜ï¼Œå‡†å¤‡æ›´æ–°è°ƒç”¨ç¼“å­˜...", "sys_cache_up.php?dopost=ok&step=3&uparc=$uparc");

38 
ex™
();

42 if(
	g$¡•
 == 3)

44 
echo
 '<m‘¨h‰p-equiv="CÚ‹Á-Ty³" cÚ‹Á="‹xt/html; ch¬£t='.
$cfg_soá_Ïng
.'">';

45 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__arccache`");

46 
	gecho
 "\næˆåŠŸæ›´æ–°arclistè°ƒç”¨ç¼“å­˜ï¼Œå‡†å¤‡æ¸…ç†è¿‡æœŸä¼šå‘˜è®¿é—®å†å²...<hr />";

47 
	g$Şdtime
 = 
time
() - (90 * 24 * 3600);

48 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_vhistory` WHERE vtime<'$oldtime' ");

49 
	gecho
 "æˆåŠŸæ¸…ç†è¿‡æœŸä¼šå‘˜è®¿é—®å†å²ï¼Œå‡†å¤‡æ¸…ç†è¿‡æœŸçŸ­ä¿¡...<hr />";

50 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__member_pms` WHERE sendtime<'$oldtime' ");

51 
	gecho
 "æˆåŠŸæ¸…ç†è¿‡æœŸçŸ­ä¿¡ï¼Œå‡†å¤‡ä¿®æ­£é”™è¯¯æ–‡æ¡£ï¼Œè¿™å¯èƒ½è¦å è¾ƒé•¿çš„æ—¶é—´...";

52 if(
	g$u·rc
 == 1)

54 
echo
 "<script†anguage='javascript'>location='sys_cache_up.php?dopost=ok&step=9';</script>";

58 
	gecho
 "<script†anguage='javascript'>location='sys_cache_up.php?dopost=ok&step=-1&uparc=$uparc';</script>";

60 
ex™
();

63 if(
	g$¡•
 == 9)

65 
ShowMsg
('ä¿®æ­£é”™è¯¯æ–‡æ¡£æ“ä½œå·²ç»å–æ¶ˆï¼Œè¯·åœ¨&lt;ç³»ç»Ÿ-&gt;ç³»ç»Ÿé”™è¯¯ä¿®å¤[S]&gt;ä¸­æ“ä½œ...','sys_cache_up.php?dopost=ok&step=-1&uparc=1',0,5000);

66 
ex™
();

69 
šşude
 
XAKINClude
('templets/sys_cache_up.htm');

	@E:\web\weixun\xakadmin\sys_data.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Data');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
	g$dİo¡
=="viewinfo")

13 
echo
 "[<a href='#' onclick='javascript:HideObj(\"_mydatainfo\")'><u>å…³é—­</u></a>]\r\n<xmp>";

14 if(
em±y
(
$bËÇme
))

16 
	gecho
 "æ²¡æœ‰æŒ‡å®šè¡¨åï¼";

20 
	g$dsql
->
S‘Qu”y
("SHOW CREATE TABLE ".
$dsql
->
dbName
.".".
$bËÇme
);

21 
	g$dsql
->
Execu‹
('me');

22 
	g$row2
 = 
$dsql
->
G‘A¼ay
('me',
MYSQL_BOTH
);

23 
	g$ùšfo
 = 
$row2
[1];

24 
echo
 
Œim
(
$ùšfo
);

26 
	gecho
 '</xmp>';

27 
ex™
();

29 if(
	g$dİo¡
=="opimize")

31 
echo
 "[<a href='#' onclick='javascript:HideObj(\"_mydatainfo\")'><u>å…³é—­</u></a>]\r\n<xmp>";

32 if(
em±y
(
$bËÇme
))

34 
	gecho
 "æ²¡æœ‰æŒ‡å®šè¡¨åï¼";

38 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("OPTIMIZE TABLE `$tablename` ");

39 if(
	g$rs
)

41 
	gecho
 "æ‰§è¡Œä¼˜åŒ–è¡¨ï¼š $tablename OKï¼";

45 
	gecho
 "æ‰§è¡Œä¼˜åŒ–è¡¨ï¼š $bËÇm å¤±è´¥ï¼ŒåŸå› æ˜¯ï¼š".
	g$dsql
->
G‘E¼Ü
();

48 
	gecho
 '</xmp>';

49 
ex™
();

51 if(
	g$dİo¡
=="repair")

53 
echo
 "[<a href='#' onclick='javascript:HideObj(\"_mydatainfo\")'><u>å…³é—­</u></a>]\r\n<xmp>";

54 if(
em±y
(
$bËÇme
))

56 
	gecho
 "æ²¡æœ‰æŒ‡å®šè¡¨åï¼";

60 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("REPAIR TABLE `$tablename` ");

61 if(
	g$rs
)

63 
	gecho
 "ä¿®å¤è¡¨ï¼š $tablename OKï¼";

67 
	gecho
 "ä¿®å¤è¡¨ï¼š $bËÇm å¤±è´¥ï¼ŒåŸå› æ˜¯ï¼š".
	g$dsql
->
G‘E¼Ü
();

70 
	gecho
 '</xmp>';

71 
ex™
();

75 
	g$Ùh”TabËs
 = 
A¼ay
();

76 
	g$xakSysTabËs
 = 
A¼ay
();

77 
	g$chªÃlTabËs
 = 
A¼ay
();

78 
	g$dsql
->
S‘Qu”y
("SELECT‡ddtable FROM `#@__channeltype` ");

79 
	g$dsql
->
Execu‹
();

80 
	g$row
 = 
$dsql
->
	$G‘Objeù
())

82 
$chªÃlTabËs
[] = 
$row
->
addbË
;

83 
	}
}

84 
	g$dsql
->
S‘Qu”y
("SHOW TABLES");

85 
	g$dsql
->
Execu‹
('t');

86 
	g$row
 = 
$dsql
->
G‘A¼ay
('t',
MYSQL_BOTH
))

88 if(
´eg_m©ch
("#^{$cfg_db´efix}#", 
$row
[0])||
š_¬¿y
($row[0],
$chªÃlTabËs
))

90 
	g$xakSysTabËs
[] = 
$row
[0];

94 
	g$Ùh”TabËs
[] = 
$row
[0];

97 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

98 
šşude
 
XAKINClude
('templets/sys_data.htm');

100 
funùiÚ
 
	$TjCouÁ
(
$tbÇme
,&
$dsql
)

102 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT COUNT(*) AS dd FROM $tbname");

103  
$row
['dd'];

104 
	}
}

	@E:\web\weixun\xakadmin\sys_data_done.php

1 <?
	gphp


7 @
ob_¡¬t
();

8 @
£t_time_lim™
(0);

9 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

10 
CheckPurv›w
('sys_Data');

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

13 
	g$bkdœ
 = 
XAKDATA
.'/'.
$cfg_backup_dœ
;

16 
	g$gÙojs
 = "function GotoNextPage(){

17 
docum’t
.
gÚext
."."
subm™
();

18 }"."\
	gr
\
	gn£t
"."
Timeout
('GotoNextPage()',500);";

20 
	g$dojs
 = "<script†anguage='javascript'>$gotojs</script>";

26 if(
	g$dİo¡
=='bak')

28 if(
em±y
(
$bË¬r
))

30 
ShowMsg
('ä½ æ²¡é€‰ä¸­ä»»ä½•è¡¨ï¼', 'javascript:;');

31 
ex™
();

33 if(!
is_dœ
(
$bkdœ
))

35 
MkdœAÎ
(
$bkdœ
, 
$cfg_dœ_purv›w
);

36 
Clo£F
();

40 
	g$bËs
 = 
ex¶ode
(',', 
$bË¬r
);

41 if(!
is£t
(
$is¡ruù
))

43 
	g$is¡ruù
 = 0;

45 if(!
is£t
(
$¡¬os
))

47 
	g$¡¬os
 = 0;

49 if(!
is£t
(
$isz
))

51 
	g$isz
 = 0;

53 if(
em±y
(
$nowbË
))

55 
	g$nowbË
 = '';

57 if(
em±y
(
$fsize
))

59 
	g$fsize
 = 2048;

61 
	g$fsizeb
 = 
$fsize
 * 1024;

64 if(
	g$nowbË
=='')

66 
$tmsg
 = '';

67 
	g$dh
 = 
dœ
(
$bkdœ
);

68 
	g$f’ame
 = 
$dh
->
»ad
())

70 if(!
´eg_m©ch
("#txt$#", 
$f’ame
))

74 
	g$f’ame
 = 
$bkdœ
."/$filename";

75 if(!
is_dœ
(
$f’ame
))

77 
uÆšk
(
$f’ame
);

80 
	g$dh
->
şo£
();

81 
	g$tmsg
 .= "æ¸…é™¤å¤‡ä»½ç›®å½•æ—§æ•°æ®å®Œæˆ...<br />";

83 if(
	g$is¡ruù
==1)

85 
$bkfe
 = 
$bkdœ
."/bËs_¡ruù_".
sub¡r
(
md5
(
time
().
mt_¿nd
(1000,5000).
$cfg_cook›_’code
),0,16).".txt";

86 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
();

87 
	g$å
 = 
fİ’
(
$bkfe
, "w");

88 
fÜ—ch
(
$bËs
 
as
 
$t
)

90 
fwr™e
(
$å
, "DROP TABLE IF EXISTS `$t`;\r\n\r\n");

91 
	g$dsql
->
S‘Qu”y
("SHOW CREATE TABLE ".
$dsql
->
dbName
.".".
$t
);

92 
	g$dsql
->
Execu‹
('me');

93 
	g$row
 = 
$dsql
->
G‘A¼ay
('me', 
MYSQL_BOTH
);

96 
	g$row
[1] = 
´eg_»¶aû
("#AUTO_INCREMENT=([0-9]{1,})[ \r\n\t]{1,}#i", "", 
$row
[1]);

99 if(
	g$d©©y³
==4.0 && 
$mysql_v”siÚ
 > 4.0)

101 
$’g1
 = "#ENGINE=MyISAM[ \r\n\t]{1,}DEFAULT[ \r\n\t]{1,}CHARSET=".
$cfg_db_Ïnguage
."#i";

102 
	g$bËSŒuù
 = 
´eg_»¶aû
(
$’g1
, "TYPE=MyISAM", 
$row
[1]);

106 if(
	g$d©©y³
==4.1 && 
$mysql_v”siÚ
 < 4.1)

108 
$’g1
 = "#ENGINE=MyISAM DEFAULT CHARSET={$cfg_db_language}#i";

109 
	g$bËSŒuù
 = 
´eg_»¶aû
("TYPE=MyISAM", 
$’g1
, 
$row
[1]);

114 
	g$bËSŒuù
 = 
$row
[1];

116 
fwr™e
(
$å
,''.
$bËSŒuù
.";\r\n\r\n");

118 
fşo£
(
$å
);

119 
	g$tmsg
 .= "å¤‡ä»½æ•°æ®è¡¨ç»“æ„ä¿¡æ¯å®Œæˆ...<br />";

121 
	g$tmsg
 .= "<font color='red'>æ­£åœ¨è¿›è¡Œæ•°æ®å¤‡ä»½çš„åˆå§‹åŒ–å·¥ä½œï¼Œè¯·ç¨å...</font>";

122 
	g$dÚeFÜm
 = "<form‚ame='gonext' method='post'‡ction='sys_data_done.php'>

123 <
šput
 
ty³
='hidd’' 
Çme
='is¡ruù' 
v®ue
='$isstruct' />

124 <
šput
 
ty³
='hidd’' 
Çme
='dİo¡' 
v®ue
='bak' />

125 <
šput
 
ty³
='hidd’' 
Çme
='fsize' 
v®ue
='$fsize' />

126 <
šput
 
ty³
='hidd’' 
Çme
='bË¬r' 
v®ue
='$tablearr' />

127 <
šput
 
ty³
='hidd’' 
Çme
='nowbË' 
v®ue
='{$tables[0]}' />

128 <
šput
 
ty³
='hidd’' 
Çme
='¡¬os' 
v®ue
='0' />

129 <
šput
 
ty³
='hidd’' 
Çme
='isz' 
v®ue
='$isz' />\
r
\
n
</
fÜm
>\r\n{
$dojs
}\r\n";

130 
PutInfo
(
$tmsg
, 
$dÚeFÜm
);

131 
ex™
();

136 
	g$j
 = 0;

137 
	g$fs
 = 
$bakSŒ
 = '';

140 
	g$dsql
->
G‘TabËF›lds
(
$nowbË
);

141 
	g$šbË
 = "INSERT INTO `$nowtable` VALUES(";

142 
	g$r
 = 
$dsql
->
G‘F›ldObjeù
())

144 
$fs
[
$j
] = 
Œim
(
$r
->
Çme
);

145 
	g$j
++;

147 
	g$fsd
 = 
$j
-1;

150 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `$nowtable` ");

151 
	g$dsql
->
Execu‹
();

152 
	g$m
 = 0;

153 
	g$bakf’ame
 = "$bkdœ/{$nowbË}_{$¡¬os}_".
sub¡r
(
md5
(
time
().
mt_¿nd
(1000,5000).
$cfg_cook›_’code
),0,16).".txt";

154 
	g$row2
 = 
$dsql
->
G‘A¼ay
())

156 if(
$m
 < 
$¡¬os
)

158 
$m
++;

163 if(
¡¾’
(
$bakSŒ
è> 
	g$fsizeb
)

165 
	g$å
 = 
fİ’
(
$bakf’ame
,"w");

166 
fwr™e
(
$å
,
$bakSŒ
);

167 
fşo£
(
$å
);

168 
	g$tmsg
 = "<font color='red'>å®Œæˆåˆ°{$m}æ¡è®°å½•çš„å¤‡ä»½ï¼Œç»§ç»­å¤‡ä»½{$nowtable}...</font>";

169 
	g$dÚeFÜm
 = "<form‚ame='gonext' method='post'‡ction='sys_data_done.php'>

170 <
šput
 
ty³
='hidd’' 
Çme
='is¡ruù' 
v®ue
='$isstruct' />

171 <
šput
 
ty³
='hidd’' 
Çme
='dİo¡' 
v®ue
='bak' />

172 <
šput
 
ty³
='hidd’' 
Çme
='fsize' 
v®ue
='$fsize' />

173 <
šput
 
ty³
='hidd’' 
Çme
='bË¬r' 
v®ue
='$tablearr' />

174 <
šput
 
ty³
='hidd’' 
Çme
='nowbË' 
v®ue
='$nowtable' />

175 <
šput
 
ty³
='hidd’' 
Çme
='¡¬os' 
v®ue
='$m' />

176 <
šput
 
ty³
='hidd’' 
Çme
='isz' 
v®ue
='$isz' />\
r
\
n
</
fÜm
>\r\n{
$dojs
}\r\n";

177 
PutInfo
(
$tmsg
,
$dÚeFÜm
);

178 
ex™
();

182 
	g$lše
 = 
$šbË
;

183 
	g$j
=0; $j<=
$fsd
; $j++)

185 if(
	g$j
 < 
	g$fsd
)

187 
	g$lše
 .ğ"'".
RpLše
(
add¦ashes
(
$row2
[
$fs
[
$j
]]))."',";

191 
	g$lše
 .ğ"'".
RpLše
(
add¦ashes
(
$row2
[
$fs
[
$j
]]))."');\r\n";

194 
	g$m
++;

195 
	g$bakSŒ
 .ğ
$lše
;

199 if(
	g$bakSŒ
!='')

201 
$å
 = 
fİ’
(
$bakf’ame
,"w");

202 
fwr™e
(
$å
,
$bakSŒ
);

203 
fşo£
(
$å
);

205 
	g$i
=0; $i<
couÁ
(
$bËs
); $i++)

207 if(
	g$bËs
[
$i
] =ğ
$nowbË
)

209 if(
is£t
(
$bËs
[
$i
+1]))

211 
$nowbË
 = 
$bËs
[
$i
+1];

212 
	g$¡¬os
 = 0;

216 
PutInfo
("å®Œæˆæ‰€æœ‰æ•°æ®å¤‡ä»½ï¼","");

217 
ex™
();

221 
	g$tmsg
 = "<font color='red'>å®Œæˆåˆ°{$m}æ¡è®°å½•çš„å¤‡ä»½ï¼Œç»§ç»­å¤‡ä»½{$nowtable}...</font>";

222 
	g$dÚeFÜm
 = "<form‚ame='gonext' method='post'‡ction='sys_data_done.php?dopost=bak'>

223 <
šput
 
ty³
='hidd’' 
Çme
='is¡ruù' 
v®ue
='$isstruct' />

224 <
šput
 
ty³
='hidd’' 
Çme
='fsize' 
v®ue
='$fsize' />

225 <
šput
 
ty³
='hidd’' 
Çme
='bË¬r' 
v®ue
='$tablearr' />

226 <
šput
 
ty³
='hidd’' 
Çme
='nowbË' 
v®ue
='$nowtable' />

227 <
šput
 
ty³
='hidd’' 
Çme
='¡¬os' 
v®ue
='$¡¬os'>\
r
\
n
</
fÜm
>\r\n{
$dojs
}\r\n";

228 
PutInfo
(
$tmsg
,
$dÚeFÜm
);

229 
ex™
();

237 if(
	g$dİo¡
=='redat')

239 if(
$bakfes
=='')

241 
ShowMsg
('æ²¡æŒ‡å®šä»»ä½•è¦è¿˜åŸçš„æ–‡ä»¶!', 'javascript:;');

242 
ex™
();

244 
	g$bakfesTmp
 = 
$bakfes
;

245 
	g$bakfes
 = 
ex¶ode
(',', 
$bakfes
);

246 if(
em±y
(
$¡ruùfe
))

248 
	g$¡ruùfe
 = "";

250 if(
em±y
(
$d–fe
))

252 
	g$d–fe
 = 0;

254 if(
em±y
(
$¡¬tgo
))

256 
	g$¡¬tgo
 = 0;

258 if(
	g$¡¬tgo
==0 && 
$¡ruùfe
!='')

260 
$tbd©a
 = '';

261 
	g$å
 = 
fİ’
("$bkdir/$structfile", 'r');

262 !
ãof
(
$å
))

264 
	g$tbd©a
 .ğ
fg‘s
(
$å
, 1024);

266 
fşo£
(
$å
);

267 
	g$qu”ys
 = 
ex¶ode
(';', 
$tbd©a
);

269 
fÜ—ch
(
$qu”ys
 
as
 
$q
)

271 
	g$dsql
->
Execu‹NÚeQu”y
(
Œim
(
$q
).';');

273 if(
	g$d–fe
==1)

275 @
uÆšk
("$bkdir/$structfile");

277 
	g$tmsg
 = "<font color='red'>å®Œæˆæ•°æ®è¡¨ä¿¡æ¯è¿˜åŸï¼Œå‡†å¤‡è¿˜åŸæ•°æ®...</font>";

278 
	g$dÚeFÜm
 = "<form‚ame='gonext' method='post'‡ction='sys_data_done.php?dopost=redat'>

279 <
šput
 
ty³
='hidd’' 
Çme
='¡¬tgo' 
v®ue
='1' />

280 <
šput
 
ty³
='hidd’' 
Çme
='d–fe' 
v®ue
='$delfile' />

281 <
šput
 
ty³
='hidd’' 
Çme
='bakfes' 
v®ue
='$bakfilesTmp' />

282 </
fÜm
>\
r
\
n
{
$dojs
}\r\n";

283 
PutInfo
(
$tmsg
, 
$dÚeFÜm
);

284 
ex™
();

288 
	g$nowfe
 = 
$bakfes
[0];

289 
	g$bakfesTmp
 = 
´eg_»¶aû
("#".
$nowfe
."[,]{0,1}#", "", 
$bakfesTmp
);

290 
	g$oknum
=0;

291 ifĞ
fesize
("$bkdir/$nowfile") > 0 )

293 
	g$å
 = 
fİ’
("$bkdir/$nowfile", 'r');

294 !
ãof
(
$å
))

296 
	g$lše
 = 
Œim
(
fg‘s
(
$å
, 512*1024));

297 if(
	g$lše
=="") ;

298 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$lše
);

299 if(
	g$rs
è
	g$oknum
++;

301 
fşo£
(
$å
);

303 if(
	g$d–fe
==1)

305 @
uÆšk
("$bkdir/$nowfile");

307 if(
	g$bakfesTmp
=="")

309 
ShowMsg
('æˆåŠŸè¿˜åŸæ‰€æœ‰çš„æ–‡ä»¶çš„æ•°æ®!', 'javascript:;');

310 
ex™
();

312 
	g$tmsg
 = "æˆåŠŸè¿˜åŸ{$nowfile}çš„{$oknum}æ¡è®°å½•<br/><br/>æ­£åœ¨å‡†å¤‡è¿˜åŸå…¶å®ƒæ•°æ®...";

313 
	g$dÚeFÜm
 = "<form‚ame='gonext' method='post'‡ction='sys_data_done.php?dopost=redat'>

314 <
šput
 
ty³
='hidd’' 
Çme
='¡¬tgo' 
v®ue
='1' />

315 <
šput
 
ty³
='hidd’' 
Çme
='d–fe' 
v®ue
='$delfile' />

316 <
šput
 
ty³
='hidd’' 
Çme
='bakfes' 
v®ue
='$bakfilesTmp' />

317 </
fÜm
>\
r
\
n
{
$dojs
}\r\n";

318 
PutInfo
(
$tmsg
, 
$dÚeFÜm
);

319 
ex™
();

323 
funùiÚ
 
	$PutInfo
(
$msg1
,
$msg2
)

325 
glob®
 
$cfg_dœ_purv›w
,
$cfg_soá_Ïng
;

326 
$msgšfo
 = "<html>\n<head>

327 <
m‘a
 
h‰p
-
equiv
='CÚ‹Á-Ty³' 
cÚ‹Á
='text/html; charset={$cfg_soft_lang}' />

328 <
t™Ë
>ç³»ç»Ÿæç¤ºä¿¡æ¯</title>

329 <
ba£
 
rg‘
='_£lf'/>\
n
</
h—d
>\n<
body
 
Ëám¬gš
='0' 
tİm¬gš
='0'>\n<
ûÁ”
>

330 <
br
/>

331 <
div
 
¡yË
='width:400px;padding-top:4px;height:24;font-size:10pt;border-left:1px solid #cccccc;border-top:1px solid #cccccc;border-right:1px solid #cccccc;background-color:#DBEEBD;'>ç³»ç»Ÿæç¤ºä¿¡æ¯ï¼</div>

332 <
div
 
¡yË
='width:400px;height:100px;font-size:10pt;border:1px solid #cccccc;background-color:#F4FAEB'>

333 <
¥ª
 
¡yË
='lše-height:160%'><
br
/>{
$msg1
}</span>

334 <
br
/><br/></
div
>\
r
\
n
{
$msg2
}";

335 
echo
 
$msgšfo
."</center>\n</body>\n</html>";

336 
	}
}

338 
funùiÚ
 
	$RpLše
(
$¡r
)

340 
$¡r
 = 
	`¡r_»¶aû
("\r", "\\r", $str);

341 
$¡r
 = 
	`¡r_»¶aû
("\n", "\\n", $str);

342  
$¡r
;

343 
	}
}

	@E:\web\weixun\xakadmin\sys_data_replace.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('sys_Data');

9 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

10 if(
	$em±y
(
$aùiÚ
))

12 
	`»quœe_Úû
(
XAKADMIN
."/templets/sys_data_replace.htm");

13 
	`ex™
();

14 
	}
}

20 if(
	g$aùiÚ
=='getfields')

22 
AjaxH—d
();

23 
	g$dsql
->
G‘TabËF›lds
(
$ex±abË
);

24 
	gecho
 "<div style='border:1px solid #ababab;background-color:#FEFFF0;margin-top:6px;padding:3px;line-height:160%'>";

25 
	gecho
 "è¡¨(".
	g$ex±abË
.")å«æœ‰çš„å­—æ®µï¼š<br>";

26 
	g$row
 = 
$dsql
->
G‘F›ldObjeù
())

28 
echo
 "<¨h»f=\"javasüt:pf('{$row->Çme}')\"><u>".
$row
->
Çme
."</u></a>\r\n";

30 
	gecho
 "</div>";

31 
ex™
();

37 if(
	g$aùiÚ
=='apply')

39 
$v®id©e
 = 
em±y
($v®id©eè? '' : 
¡¹Şow”
($validate);

40 
	g$sv®i
 = 
G‘CkVdV®ue
();

41 if(
	g$v®id©e
 =ğ"" || 
$v®id©e
 !ğ
$sv®i
)

43 
ShowMsg
("å®‰å…¨ç¡®è®¤ç ä¸æ­£ç¡®!", "javascript:;");

44 
ex™
();

46 if(
	g$ex±abË
 =ğ'' || 
$½f›ld
 == '')

48 
ShowMsg
("è¯·æŒ‡å®šæ•°æ®è¡¨å’Œå­—æ®µï¼", "javascript:;");

49 
ex™
();

51 if(
	g$½¡ršg
=='')

53 
ShowMsg
("è¯·æŒ‡å®šè¢«æ›¿æ¢å†…å®¹ï¼", "javascript:;");

54 
ex™
();

56 if(
	g$½ty³
=='replace')

58 
$cÚd™iÚ
 = 
em±y
($condition) ? '' : " WHERE $condition ";

59 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("UPDATE $exptable SET $rpfield=REPLACE($rpfield,'$rpstring','$tostring') $condition ");

60 
	g$dsql
->
Execu‹NÚeQu”y
("OPTIMIZE TABLE `$exptable`");

61 if(
	g$rs
)

63 
ShowMsg
("æˆåŠŸå®Œæˆæ•°æ®æ›¿æ¢ï¼", "javascript:;");

64 
ex™
();

68 
ShowMsg
("æ•°æ®æ›¿æ¢å¤±è´¥ï¼", "javascript:;");

69 
ex™
();

74 
	g$cÚd™iÚ
 = 
em±y
(
$cÚd™iÚ
) ? '' : " And $condition ";

75 
	g$½¡ršg
 = 
¡r¦ashes
(
$½¡ršg
);

76 
	g$½¡ršg2
 = 
¡r_»¶aû
("\\","\\\\",
$½¡ršg
);

77 
	g$½¡ršg2
 = 
¡r_»¶aû
("'","\\'",
$½¡ršg2
);

78 
	g$dsql
->
S‘Qu”y
("SELECT $keyfield,$rpfield FROM $exptable WHERE $rpfield REGEXP '$rpstring2' $condition ");

79 
	g$dsql
->
Execu‹
();

80 
	g$‰
 = 
$dsql
->
G‘TÙ®Row
();

81 if(
	g$‰
==0)

83 
ShowMsg
("æ ¹æ®ä½ æŒ‡å®šçš„æ­£åˆ™ï¼Œæ‰¾ä¸åˆ°ä»»ä½•ä¸œè¥¿ï¼","javascript:;");

84 
ex™
();

86 
	g$oo
 = 0;

87 
	g$row
 = 
$dsql
->
G‘A¼ay
())

89 
$kid
 = 
$row
[
$keyf›ld
];

90 
	g$½f
 = 
´eg_»¶aû
("#".
$½¡ršg
."#i", 
$to¡ršg
, 
$row
[
$½f›ld
]);

91 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("UPDATE $exptable SET $rpfield='$rpf' WHERE $keyfield='$kid' ");

92 if(
	g$rs
)

94 
	g$oo
++;

97 
	g$dsql
->
Execu‹NÚeQu”y
("OPTIMIZE TABLE `$exptable`");

98 
ShowMsg
("å…±æ‰¾åˆ° $tt æ¡è®°å½•ï¼ŒæˆåŠŸæ›¿æ¢äº† $oo æ¡ï¼", "javascript:;");

99 
ex™
();

	@E:\web\weixun\xakadmin\sys_data_revert.php

1 <?
php


5 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

6 
CheckPurv›w
('sys_Data');

7 
	g$bkdœ
 = 
XAKDATA
."/".
$cfg_backup_dœ
;

8 
	g$f–i¡s
 = 
A¼ay
();

9 
	g$dh
 = 
dœ
(
$bkdœ
);

10 
	g$¡ruùfe
 = "æ²¡æ‰¾åˆ°æ•°æ®ç»“æ„æ–‡ä»¶";

11 (
	g$f’ame
=
$dh
->
»ad
()è!=ğ
çl£
)

13 if(!
´eg_m©ch
("#txt$#", 
$f’ame
))

17 if(
´eg_m©ch
("#bËs_¡ruù#", 
$f’ame
))

19 
	g$¡ruùfe
 = 
$f’ame
;

21 ifĞ
fesize
("$bkdir/$filename") >0 )

23 
	g$f–i¡s
[] = 
$f’ame
;

26 
	g$dh
->
şo£
();

27 
šşude
 
XAKINClude
('templets/sys_data_revert.htm');

	@E:\web\weixun\xakadmin\sys_group.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Group');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

10 
šşude
 
XAKINClude
('templets/sys_group.htm');

	@E:\web\weixun\xakadmin\sys_group_add.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Group');

9 if(!
	$em±y
(
$dİo¡
))

11 
$row
 = 
$dsql
->
	`G‘OÃ
("SELECT * FROM `#@__admšty³` WHERE„ªk='".
$¿nkid
."'");

12 if(
	`is_¬¿y
(
$row
))

14 
	`ShowMsg
('ä½ æ‰€åˆ›å»ºçš„ç»„åˆ«çš„çº§åˆ«å€¼å·²å­˜åœ¨ï¼Œä¸å…è®¸é‡å¤!', '-1');

15 
	`ex™
();

17 if(
$¿nkid
 > 10)

19 
	`ShowMsg
('ç»„çº§åˆ«å€¼ä¸èƒ½å¤§äº10ï¼Œ å¦åˆ™ä¸€åˆ‡æƒé™è®¾ç½®å‡æ— æ•ˆ!', '-1');

20 
	`ex™
();

22 
$AÎPurv›ws
 = '';

23 if(
	`is_¬¿y
(
$purv›ws
))

25 
	`fÜ—ch
(
$purv›ws
 
as
 
$pur
)

27 
$AÎPurv›ws
 = 
$pur
.' ';

29 
$AÎPurv›ws
 = 
	`Œim
($AllPurviews);

31 
$dsql
->
	`Execu‹NÚeQu”y
("INSERT INTO `#@__admintype` (rank,typename,system,purviews) VALUES ('$rankid','$groupname', 0, '$AllPurviews');");

32 
	`ShowMsg
("æˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ç»„!", "sys_group.php");

33 
	`ex™
();

34 
	}
}

35 
šşude
 
XAKINClude
('templets/sys_group_add.htm');

	@E:\web\weixun\xakadmin\sys_group_edit.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Group');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

11 if(
	g$dİo¡
=='save')

13 if(
$¿nk
==10)

15 
ShowMsg
('è¶…çº§ç®¡ç†å‘˜çš„æƒé™ä¸å…è®¸æ›´æ”¹!', 'sys_group.php');

16 
ex™
();

18 
	g$purv›w
 = "";

19 if(
is_¬¿y
(
$purv›ws
))

21 
fÜ—ch
(
$purv›ws
 
as
 
$p
)

23 
	g$purv›w
 .= "$p ";

25 
	g$purv›w
 = 
Œim
(
$purv›w
);

27 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__admintype` SETypename='$typename',purviews='$purview' WHERE CONCAT(`rank`)='$rank'");

28 
ShowMsg
('æˆåŠŸæ›´æ”¹ç”¨æˆ·ç»„çš„æƒé™!', 'sys_group.php');

29 
ex™
();

31 if(
	g$dİo¡
=='del')

33 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__admintype` WHERE CONCAT(`rank`)='$rank' AND system='0';");

34 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªç”¨æˆ·ç»„!","sys_group.php");

35 
ex™
();

37 
	g$groupRªks
 = 
A¼ay
();

38 
	g$groupS‘
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__admintype` WHERE CONCAT(`rank`)='{$rank}' ");

39 
	g$groupRªks
 = 
ex¶ode
(' ', 
$groupS‘
['purviews']);

40 
šşude
 
XAKINClude
('templets/sys_group_edit.htm');

43 
funùiÚ
 
	$CRªk
(
$n
)

45 
glob®
 
$groupRªks
;

46  
	`š_¬¿y
(
$n
,
$groupRªks
) ? ' checked' : '';

47 
	}
}

	@E:\web\weixun\xakadmin\sys_info.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Edit');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

11 
	g$cÚfigfe
 = 
XAKDATA
.'/config.cache.inc.php';

14 
funùiÚ
 
	$ReWr™eCÚfig
()

16 
glob®
 
$dsql
,
$cÚfigfe
;

17 if(!
	`is_wr™—bË
(
$cÚfigfe
))

19 
echo
 "é…ç½®æ–‡ä»¶'{$configfile}'ä¸æ”¯æŒå†™å…¥ï¼Œæ— æ³•ä¿®æ”¹ç³»ç»Ÿé…ç½®å‚æ•°ï¼";

20 
	`ex™
();

22 
$å
 = 
	`fİ’
(
$cÚfigfe
,'w');

23 
	`æock
(
$å
,3);

24 
	`fwr™e
(
$å
,"<"."?php\r\n");

25 
$dsql
->
	`S‘Qu”y
("SELECT `varname`,`type`,`value`,`groupid` FROM `#@__sysconfig` ORDER BY‡id ASC ");

26 
$dsql
->
	`Execu‹
();

27 
$row
 = 
$dsql
->
	`G‘A¼ay
())

29 if(
$row
['type']=='number')

31 if(
$row
['value']=='') $row['value'] = 0;

32 
	`fwr™e
(
$å
,"\${$row['v¬Çme']} = ".
$row
['value'].";\r\n");

36 
	`fwr™e
(
$å
,"\${$row['v¬Çme']} = '".
	`¡r_»¶aû
("'",'',
$row
['value'])."';\r\n");

39 
	`fwr™e
(
$å
,"?".">");

40 
	`fşo£
(
$å
);

41 
	}
}

44 if(
	g$dİo¡
=="save")

46 
fÜ—ch
(
$_POST
 
as
 
$k
=>
$v
)

48 if(
´eg_m©ch
("#^ed™___#", 
$k
))

50 
$v
 = 
ú_sub¡rR
(
$
{
$k
}, 1024);

56 
	g$k
 = 
´eg_»¶aû
("#^ed™___#", "", 
$k
);

57 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__sysconfig` SET `value`='$v' WHERE varname='$k' ");

59 
ReWr™eCÚfig
();

60 
ShowMsg
("æˆåŠŸæ›´æ”¹ç«™ç‚¹é…ç½®ï¼", "sys_info.php");

61 
ex™
();

64 if(
	g$dİo¡
=='add')

66 if(
$v¬ty³
=='boŞ' && (
$nv¬v®ue
!='Y' && $nvarvalue!='N'))

68 
ShowMsg
("å¸ƒå°”å˜é‡å€¼å¿…é¡»ä¸º'Y'æˆ–'N'!","-1");

69 
ex™
();

71 if(
Œim
(
$nv¬Çme
)=='' || 
´eg_m©ch
("#[^a-z_]#i", $nvarname) )

73 
ShowMsg
("å˜é‡åä¸èƒ½ä¸ºç©ºå¹¶ä¸”å¿…é¡»ä¸º[a-z_]ç»„æˆ!","-1");

74 
ex™
();

76 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT varname FROM `#@__sysconfig` WHERE varname LIKE '$nvarname' ");

77 if(
is_¬¿y
(
$row
))

79 
ShowMsg
("è¯¥å˜é‡åç§°å·²ç»å­˜åœ¨!","-1");

80 
ex™
();

82 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT‡id FROM `#@__sysconfig` ORDER BY‡id DESC ");

83 
	g$aid
 = 
$row
['aid'] + 1;

84 
	g$šqu”y
 = "INSERT INTO `#@__sysconfig`(`aid`,`varname`,`info`,`value`,`type`,`groupid`)

85 
VALUES
 ('$aid','$nvarname','$varmsg','$nvarvalue','$vartype','$vargroup')";

86 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$šqu”y
);

87 if(!
	g$rs
)

89 
ShowMsg
("æ–°å¢å˜é‡å¤±è´¥ï¼Œå¯èƒ½æœ‰éæ³•å­—ç¬¦ï¼", "sys_info.php?gp=$vargroup");

90 
ex™
();

92 if(!
is_wr™—bË
(
$cÚfigfe
))

94 
ShowMsg
("æˆåŠŸä¿å­˜å˜é‡ï¼Œä½†ç”±äº $configfile æ— æ³•å†™å…¥ï¼Œå› æ­¤ä¸èƒ½æ›´æ–°é…ç½®æ–‡ä»¶ï¼","sys_info.php?gp=$vargroup");

95 
ex™
();

98 
ReWr™eCÚfig
();

99 
ShowMsg
("æˆåŠŸä¿å­˜å˜é‡å¹¶æ›´æ–°é…ç½®æ–‡ä»¶ï¼","sys_info.php?gp=$vargroup");

100 
ex™
();

104 ià(
	g$dİo¡
=='search')

106 
$keywÜds
 = 
is£t
($keywÜds)? 
¡r_gs
($keywords) : '';

107 
	g$i
 = 1;

108 
	g$cÚfig¡r
 = <<<
EOT


109 <
bË
 
width
="100%" 
ûÎ¥acšg
="1" 
ûÎ·ddšg
="1" 
bÜd”
="0" 
bgcŞÜ
="#cfcfcf" 
id
="tdS—rch" 
¡yË
="">

110 <
tbody
>

111 <
Œ
 
height
="25" 
bgcŞÜ
="#F9FCFD" 
®ign
="center">

112 <
td
 
width
="300">å‚æ•°è¯´æ˜</td>

113 <
td
>å‚æ•°å€¼</td>

114 <
td
 
width
="220">å˜é‡å</td>

115 </
Œ
>

116 
EOT
;

117 
echo
 
	g$cÚfig¡r
;

118 ià(
	g$keywÜds
)

121 
	g$dsql
->
S‘Qu”y
("SELECT * FROM `#@__sysconfig` WHERE info LIKE '%$keywords%' order by‡id‡sc");

122 
	g$dsql
->
Execu‹
();

124 
	g$row
 = 
$dsql
->
G‘A¼ay
()) {

125 
$bgcŞÜ
 = (
$i
++%2==0)? "#F9FCFD" : "#ffffff";

126 
	g$row
['šfo'] = 
´eg_»¶aû
("#{$keywÜds}#", '<fÚˆcŞÜ="»d">'.
$keywÜds
.'</fÚt>', 
$row
['info']);

128 <
Œ
 
	g®ign
="ûÁ”" 
height
="25" 
bgcŞÜ
="<?phpƒcho $bgcolor?>">

129 <
td
 
width
="300"><?
php
 
echo
 
$row
['šfo']; ?>ï¼š </
	gtd
>

130 <
td
 
	g®ign
="Ëá" 
¡yË
="padding:3px;">

131 <?
php


132 if(
$row
['type']=='bool')

134 
$c1
='';

135 
	g$c2
 = '';

136 
	g$row
['v®ue']=='Y' ? 
$c1
=" checked" : 
$c2
=" checked";

137 
	gecho
 "<inputype='radio' class='np'‚ame='edit___{$row['varname']}' value='Y'$c1>æ˜¯ ";

138 
	gecho
 "<inputype='radio' class='np'‚ame='edit___{$row['varname']}' value='N'$c2>å¦ ";

139 }if(
	g$row
['type']=='bstring')

141 
echo
 "<‹x»¨Çme='ed™___{$row['v¬Çme']}'„ow='4' id='ed™___{$row['v¬Çme']}' cÏss='‹x»a_šfo' styË='width:98%;height:50px'>".
html¥ecŸlch¬s
(
$row
['value'])."</textarea>";

142 }if(
	g$row
['type']=='number')

144 
echo
 "<inputype='text'‚ame='edit___{$row['varname']}' id='edit___{$row['varname']}' value='{$row['value']}' style='width:30%'>";

147 
	gecho
 "<špuˆty³='‹xt'‚ame='ed™___{$row['v¬Çme']}' id='ed™___{$row['v¬Çme']}' v®ue=\"".
html¥ecŸlch¬s
(
$row
['value'])."\" style='width:80%'>";

150 </
	gtd
>

151 <
	gtd
><?
php
 
echo
 
	g$row
['varname']?></td>

152 </
	gŒ
>

153 <?
	gphp


156 </
	gbË
>

157 <?
php


158 
	gex™
;

160 ià(
	g$i
 == 1)

162 
echo
 '<tr‡lign="center" bgcolor="#F9FCFD" height="25"><td colspan="3">æ²¡æœ‰æ‰¾åˆ°æœç´¢çš„å†…å®¹</td></tr></table>';

164 
	gex™
;

166 
šşude
 
XAKINClude
('templets/sys_info.htm');

	@E:\web\weixun\xakadmin\sys_info_mark.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Edit');

9 
»quœe_Úû
(
XAKINC
."/image.func.php");

10 if(
	g$cfg_phÙo_suµÜt
=='')

12 
echo
 "ä½ çš„ç³»ç»Ÿæ²¡å®‰è£…GDåº“ï¼Œä¸å…è®¸ä½¿ç”¨æœ¬åŠŸèƒ½ï¼";

13 
ex™
();

15 
	g$ImageW©”CÚfigFe
 = 
XAKDATA
."/mark/inc_photowatermark_config.php";

16 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = "";

18 if(
	g$aùiÚ
=="save")

20 
$v¬s
 = 
¬¿y
('photo_markup','photo_markdown','photo_marktype','photo_wwidth','photo_wheight','photo_waterpos','photo_watertext','photo_fontsize','photo_fontcolor','photo_marktrans','photo_diaphaneity');

21 
	g$cÚfig¡r
 = 
$shÜŠame
 = "";

22 
fÜ—ch
(
$v¬s
 
as
 
$v
)

24 
	g$
{
	g$v
} = 
¡r_»¶aû
("'", "", 
$
{'g‘_'.
$v
});

25 
	g$cÚfig¡r
 .ğ"\${$v} = '".
$
{
$v
}."';\r\n";

27 if(
is_u¶ßded_fe
(
$Ãwimg
))

29 
	g$imgfe_ty³
 = 
¡¹Şow”
(
Œim
(
$Ãwimg_ty³
));

30 if(!
š_¬¿y
(
$imgfe_ty³
, 
$cfg_phÙo_ty³Çmes
))

32 
ShowMsg
("ä¸Šä¼ çš„å›¾ç‰‡æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨ {$cfg_photo_support}æ ¼å¼çš„å…¶ä¸­ä¸€ç§ï¼","-1");

33 
ex™
();

35 if(
	g$imgfe_ty³
=='image/xpng')

37 
$shÜŠame
 = ".png";

39 if(
	g$imgfe_ty³
=='image/gif')

41 
$shÜŠame
 = ".gif";

43 if(
	g$imgfe_ty³
=='image/png')

45 
$shÜŠame
 = ".png";

49 
	g$shÜŠame
 = ".gif";

51 
	g$phÙo_m¬kimg
 = 'm¬k'.
$shÜŠame
;

52 @
move_u¶ßded_fe
(
$Ãwimg
,
XAKDATA
."/m¬k/".
$phÙo_m¬kimg
);

54 
	g$cÚfig¡r
 .= "\$photo_markimg = '{$photo_markimg}';\r\n";

55 
	g$cÚfig¡r
 = "<"."?php\r\n".
$cÚfig¡r
."?".">\r\n";

56 
	g$å
 = 
fİ’
(
$ImageW©”CÚfigFe
,"w"è
Ü
 
d›
("å†™å…¥æ–‡ä»¶ $ImageWaterConfigFile å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™ï¼");

57 
fwr™e
(
$å
,
$cÚfig¡r
);

58 
fşo£
(
$å
);

59 
	gecho
 "<script>alert('ä¿®æ”¹é…ç½®æˆåŠŸï¼');</script>\r\n";

61 
»quœe_Úû
(
$ImageW©”CÚfigFe
);

62 
šşude
 
XAKINClude
('templets/sys_info_mark.htm');

	@E:\web\weixun\xakadmin\sys_multiserv.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_SoftConfig');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
	g$dİo¡
=="save")

14 
$cÚfigfe
 = 
XAKDATA
."/cache/inc_remote_config.php";

15 
	g$rmšfo
 = 
£rŸlize
(
¬¿y
('rmho¡'=>
$c_rmho¡
, 'rmpÜt'=>
$c_rmpÜt
,

16 'rmÇme'=>
$c_rmÇme
, 'rmpwd'=>
$c_rmpwd
));

17 
	g$qu”y
 = "UPDATE `#@__multiserv_config` SET

18 `
»mÙeu¶ßds
` = '$c_remoteuploads' ,

19 `
	g»mÙeupU¾
` ='$c_remoteupUrl' ,

20 `
	grmšfo
` = '$rminfo',

21 `
	g£rvšfo
` = '$c_servinfo'";

22 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

25 
	g$cÚfig¡r
 = "\$»mÙeu¶ßd ğ'".
$c_»mÙeu¶ßds
."';\r\n";

26 
	g$cÚfig¡r
 .ğ"\$»mÙeupU¾ = '".
$c_»mÙeupU¾
."';\r\n";

27 
	g$cÚfig¡r
 .ğ"\$rmho¡ = '".
$c_rmho¡
."';\r\n";

28 
	g$cÚfig¡r
 .ğ"\$rmpÜˆğ'".
$c_rmpÜt
."';\r\n";

29 
	g$cÚfig¡r
 .ğ"\$rmÇmğ'".
$c_rmÇme
."';\r\n";

30 
	g$cÚfig¡r
 .ğ"\$rmpwd = '".
$c_rmpwd
."';\r\n";

31 
	g$cÚfig¡r
 = "<"."?php\r\n".
$cÚfig¡r
."?".">\r\n";

33 
	g$å
 = 
fİ’
(
$cÚfigfe
, "w"è
Ü
 
d›
("å†™å…¥æ–‡ä»¶ $safeconfigfile å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™ï¼");

34 
fwr™e
(
$å
, 
$cÚfig¡r
);

35 
fşo£
(
$å
);

37 
ShowMsg
('æˆåŠŸä¿å­˜å‚æ•°ï¼', 'sys_multiserv.php');

38 
ex™
();

42 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__multiserv_config` ");

43 if(!
	$is_¬¿y
(
$row
))

45 
$dsql
->
	`Execu‹NÚeQu”y
("INSERT INTO `#@__multiserv_config`

46 (`
»mÙeu¶ßds
`, `
»mÙeupU¾
`, `
rmšfo
`, `
£rvšfo
`)

47 
	`VALUES
 ('0','', '', '')"

49 
$row
['remoteuploads'] = 1;

50 
$row
['remoteupUrl'] = '';

51 
$row
['rminfo'] = '';

52 
$row
['servinfo'] = '';

53 
	}
}

55 if(!
em±y
(
$row
['rminfo']))

57 
	g$row
['rmšfo'] = 
un£rŸlize
(
$row
['rminfo']);

61 
	g$qu”y
 = "SELECT `#@__admin_list`.*,`#@__admintype`.typename FROM `#@__admin_list` LEFT JOIN `#@__admintype` ON `#@__admin_list`.usertype = `#@__admintype`.rank";

62 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

63 
	g$dsql
->
Execu‹
();

64 
	g$row3
 = 
$dsql
->
	$G‘A¼ay
())

66 
$admšLi¡s
[] = 
$row3
;

67 
	}
}

68 
šşude
 
XAKINClude
('templets/sys_multiserv.htm');

69 
ex™
();

	@E:\web\weixun\xakadmin\sys_passport.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 if(!
is£t
(
$dİo¡
)è
	g$dİo¡
 = "";

10 if(
	g$dİo¡
=='save')

12 
$CÚfigFe
 = 
XAKINC
."/data_passport.php";

13 
	g$v¬s
 = 
¬¿y
('cfg_pp_need','cfg_pp_encode','cfg_pp_login','cfg_pp_exit','cfg_pp_reg');

14 
	g$cÚfig¡r
 = "";

15 
fÜ—ch
(
$v¬s
 
as
 
$v
)

17 
	g$
{
	g$v
} = 
¡r_»¶aû
("'", "", 
$
{
$v
});

18 
	g$cÚfig¡r
 .ğ"\${$v} = '".
¡r_»¶aû
("'","",
¡r¦ashes
(
$
{'ed™___'.
$v
}))."';\r\n";

20 
	g$cÚfig¡r
 = '<'.'?'."\r\n".
$cÚfig¡r
.'?'.'>';

21 
	g$å
 = 
fİ’
(
$CÚfigFe
, "w"è
Ü
 
d›
("å†™å…¥æ–‡ä»¶ $ConfigFile å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™ï¼");

22 
fwr™e
(
$å
, 
$cÚfig¡r
);

23 
fşo£
(
$å
);

24 
	gecho
 "<süt>®”t('ä¿®æ”¹é€šè¡Œè¯é…ç½®æˆåŠŸï¼');wšdow.loÿtiÚ='sys_·s¥Üt.php?".
time
()."';</script>\r\n";

26 
šşude
 
XAKINClude
('templets/sys_passport.htm');

	@E:\web\weixun\xakadmin\sys_payment.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

9 
CheckPurv›w
('sys_Data');

11 
	g$dİo¡
 = (
em±y
(
$dİo¡
))? '' : $dopost;

12 
	g$pid
 = (
em±y
(
$pid
))? 0 : 
´eg_»¶aû
('/[^0-9]/','',$pid);

45 şas 
	cA¼ay2fÜm


47 
v¬
 
	m$FÜmA¼ay
 = 
¬¿y
();

48 
v¬
 
	m$A¼FromTPL
 = '';

50 
funùiÚ
 
__cÚ¡ruù
(
$fÜm¬¿y
 = 
	$¬¿y
())

52 if(
	`couÁ
(
$fÜm¬¿y
) > 1)

54 
$this
->
FÜmA¼ay
 = 
$fÜm¬¿y
;

56 
$this
->
	`S‘DeçuÉT¶
();

69 
funùiÚ
 
	`G‘I‹rm
(
$™”mid
 = '', 
$™”mty³
 = 1)

71 
$»v®
 = 
$»v®_fÜm
 = 
$»v®_t™Ë
 = 
$»v®_des
 = 
$myfÜmI‹m
 = '';

72 if(
	`is_¬¿y
(
$this
->
FÜmA¼ay
))

74 
	`fÜ—ch
 (
$this
->
FÜmA¼ay
 
as
 
$key
 => 
$v®
) {

75 if(
$key
 =ğ
$™”mid
)

77 
$»v®_t™Ë
 = 
$v®
['title'];

78 
$»v®_des
 = 
$v®
['description'];

79 
$»v®_fÜm
 = 
$this
->
	`G‘FÜm
(
$key
,
$v®
, $val['type']);

81 if(
$™”mty³
 == 1)

82 
$»v®
 = 
	`´eg_»¶aû
(
	`¬¿y
("/~title~/","/~form~/","/~description~/"),

83 
	`¬¿y
(
$»v®_t™Ë
, 
$»v®_fÜm
, 
$»v®_des
), 
$this
->
A¼FromTPL
);

84  
$»v®_fÜm
;

88  
FALSE
;

90  
	`em±y
(
$»v®
)? '' : $reval;

91 
	}
}

93 
funùiÚ
 
G‘FÜm
(
$key
, 
$fÜm¬ry
 = 
¬¿y
(), 
$fÜmty³
='text')

95 
$fÜmty³
)

99 
$v®¡r
=(
em±y
(
$fÜm¬ry
['value']))? "value=''" : "value='{$formarry['value']}'";

100 
	g$»v®_fÜm
 = "<inputype='text'‚ame='{$key}' id='{$key}' style='width:300px' class='text'{$valstr}>";

104 
$»v®_t™Ë
 = 
$fÜm¬ry
['title'];

105 
	g$™ems
 = 
ex¶ode
(',',
$fÜm¬ry
['iterm']);

106 
	g$»v®_fÜm
 = "<select‚ame='{$key}' class='text'>";

107 if(
is_¬¿y
(
$™ems
))

109 
fÜ—ch
(
$™ems
 
as
 
$v
)

111 
	g$v
 = 
Œim
(
$v
);

112 if(
	g$v
=='') ;

114 
	g$v
 = 
¡r_»¶aû
("ï¼š", ":", 
$v
);

115 ifĞ
´eg_m©ch
("/[\:]/",
$v
) )

117 
li¡
(
$v®ue
, 
$Çme
èğ
´eg_¥l™
('#:#', 
$v
);

118 
	g$»v®_fÜm
 .ğ(
$fÜm¬ry
['v®ue'] =ğ
$v®ue
)? "<option value='$value' selected>$name</option>\r\n" : "<option value='$value'>$name</option>\r\n";

120 
	g$»v®_fÜm
 .ğ(
$fÜm¬ry
['v®ue'] =ğ
$v
)? "<option value='$v' selected>$v</option>\r\n" : "<option value='$v'>$v</option>\r\n";

124 
	g$»v®_fÜm
 .= "</select>\r\n";

127  
	g$»v®_fÜm
;

132 
funùiÚ
 
	$G‘AÎ
()

134 
$»v®
=
	`em±y
($reval)? '' : $reval;

135 if(
	`is_¬¿y
(
$this
->
FÜmA¼ay
))

137 
	`fÜ—ch
 (
$this
->
FÜmA¼ay
 
as
 
$key
 => 
$v®
)

139 
$»v®
 .ğ
$this
->
	`G‘I‹rm
(
$key
);

141  
$»v®
;

143  
FALSE
;

145 
	}
}

148 
funùiÚ
 
S‘DeçuÉT¶
(
$Êame
 = '')

150 if(
em±y
(
$Êame
))

152 
$this
->
A¼FromTPL
 = '<p>~title~ï¼š~form~<small>~description~</small></p>';

154 if(
fe_exi¡s
(
$Êame
)è
	g$this
->
	gA¼FromTPL
 = 
fe_g‘_cÚ‹Ás
($tplname);

155 
	g$this
->
	gA¼FromTPL
 = 
$Êame
;

159 
	g$l¡ršg
 = "

160 <
Œ
>

161 <
td
 
height
='25' 
®ign
='ûÁ”'>~
t™Ë
~ï¼š</td>

162 <
td
>~
fÜm
~ <
sm®l
>~
desütiÚ
~</small></td>

163 </
Œ
>

167 if(
$dİo¡
=='install')

169 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__payment` WHERE id='$pid'");

170 if(
is_¬¿y
(
$row
))

172 if(
	g$cfg_soá_Ïng
 == 'utf-8')

174 
$cÚfig_row
 = 
AutoCh¬£t
(
un£rŸlize
(
utf82gb
(
$row
['config'])));

175 }if(
	g$cfg_soá_Ïng
 == 'gb2312'){

176 
$cÚfig_row
 = 
un£rŸlize
(
$row
['config']);

179 
	g$af
 = 
Ãw
 
A¼ay2fÜm
(
$cÚfig_row
);

180 
	g$af
->
S‘DeçuÉT¶
(
$l¡ršg
);

181 
	g$»v®
 = 
$af
->
G‘AÎ
();

183 
šşude
 
XAKINClude
('templets/sys_payment_install.htm');

184 
	gex™
;

187 if(
	g$dİo¡
=='config')

189 if(
$·y_Çme
=="" || 
$·y_desc
=="" || 
$·y_ãe
=="")

191 
ShowMsg
("æ‚¨æœ‰æœªå¡«å†™çš„é¡¹ç›®ï¼","-1");

192 
ex™
();

194 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__payment` WHERE id='$pid'");

195 if(
	g$cfg_soá_Ïng
 == 'utf-8')

197 
$cÚfig
 = 
AutoCh¬£t
(
un£rŸlize
(
utf82gb
(
$row
['config'])));

198 }if(
	g$cfg_soá_Ïng
 == 'gb2312'){

199 
$cÚfig
 = 
un£rŸlize
(
$row
['config']);

201 
	g$·ym’ts
 = "'code' => '".
$row
['code']."',";

202 
fÜ—ch
 (
$cÚfig
 
as
 
$key
 => 
$v
)

204 
$cÚfig
[
$key
]['v®ue'] = 
$
{$key};

205 
	g$·ym’ts
 .ğ"'".
$key
."' => '".
$cÚfig
[$key]['value']."',";

207 
	g$·ym’ts
 = 
sub¡r
(
$·ym’ts
, 0, -1);

208 
	g$·ym’t
 = "\$·ym’t÷¼ay(".
$·ym’ts
.")";

209 
	g$cÚfig¡r
 = "<"."?php\r\n".
$·ym’t
."\r\n?".">\r\n";

210 if(!
em±y
(
$·ym’t
))

212 
	g$m_fe
 = 
XAKDATA
."/·ym’t/".
$row
['code'].".php";

213 
	g$å
 = 
fİ’
(
$m_fe
,"w"è
Ü
 
d›
("å†™å…¥æ–‡ä»¶ $safeconfigfile å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™ï¼");

214 
fwr™e
(
$å
,
$cÚfig¡r
);

215 
fşo£
(
$å
);

217 if(
	g$cfg_soá_Ïng
 == 'utf-8')

219 
$cÚfig
 = 
AutoCh¬£t
($config,'utf-8','gb2312');

220 
	g$cÚfig
 = 
£rŸlize
(
$cÚfig
);

221 
	g$cÚfig
 = 
gb2utf8
(
$cÚfig
);

223 
	g$cÚfig
 = 
£rŸlize
(
$cÚfig
);

226 
	g$qu”y
 = "UPDATE `#@__payment` SET‚ame = '$pay_name',fee='$pay_fee',description='$pay_desc',config='$config',enabled='1' WHERE id='$pid'";

227 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

228 if(
	g$pm
=='ed™'è
$msg
="ä¿å­˜ä¿®æ”¹æˆåŠŸ";

229 
	g$msg
="å®‰è£…æˆåŠŸï¼";

230 
ShowMsg
(
$msg
, "sys_payment.php");

231 
ex™
();

235 if(
	g$dİo¡
=='uninstall')

237 
$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__payment` WHERE id='$pid'");

238 if(
	g$cfg_soá_Ïng
 == 'utf-8')

240 
$cÚfig
 = 
AutoCh¬£t
(
un£rŸlize
(
utf82gb
(
$row
['config'])));

241 }if(
	g$cfg_soá_Ïng
 == 'gb2312'){

242 
$cÚfig
 = 
un£rŸlize
(
$row
['config']);

244 
fÜ—ch
 (
$cÚfig
 
as
 
$key
 => 
$v
) $config[$key]['value']="";

245 if(
	g$cfg_soá_Ïng
 == 'utf-8')

247 
$cÚfig
 = 
AutoCh¬£t
($config,'utf-8','gb2312');

248 
	g$cÚfig
 = 
£rŸlize
(
$cÚfig
);

249 
	g$cÚfig
 = 
gb2utf8
(
$cÚfig
);

251 
	g$cÚfig
 = 
£rŸlize
(
$cÚfig
);

253 
	g$qu”y
 = "UPDATE `#@__payment` SET fee='',config='$config',enabled='0' WHERE id='$pid'";

254 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

256 
	g$m_fe
 = 
XAKDATA
."/·ym’t/".
$row
['code'].".php";

257 @
uÆšk
(
$m_fe
);

258 
ShowMsg
("åˆ é™¤æˆåŠŸï¼", "sys_payment.php");

259 
ex™
();

261 
	g$sql
 = "SELECT * FROM `#@__payment` ORDER BY„ank ASC";

262 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

263 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/sys_payment.htm");

264 
	g$dli¡
->
S‘Sourû
(
$sql
);

265 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\sys_repair.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('sys_ArcBatch');

9 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/../functions/oxwindow.class.php');

12 if(
	$em±y
(
$dİo¡
))

14 
$wš
 = 
Ãw
 
	`OxWšdow
();

15 
$wš
->
	`In™
("sys_repair.php", "js/blank.js", "POST'ƒnctype='multipart/form-data' ");

16 
$wš
->
mašT™Ë
 = "ç³»ç»Ÿä¿®å¤å·¥å…·";

17 
$wecome_šfo
 = "<a href='index_body.php'>ç³»ç»Ÿä¸»é¡µ</a> &gt;&gt; ç³»ç»Ÿé”™è¯¯ä¿®å¤å·¥å…·";

18 
$wš
->
	`AddT™Ë
('æœ¬å·¥å…·ç”¨äºæ£€æµ‹å’Œä¿®å¤ä½ çš„ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„é”™è¯¯');

19 
$msg
 = "

20 <
bË
 
width
='98%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0' 
®ign
='center'>

21 <
Œ
>

22 <
td
 
height
='250' 
v®ign
='top'>

23 <
br
 />

24 <
b
>æœ¬å·¥å…·ç›®å‰ä¸»è¦æ‰§è¡Œä¸‹é¢åŠ¨ä½œï¼š</b><
br
 />

25 1ã€ä¿®å¤/ä¼˜åŒ–æ•°æ®è¡¨ï¼›<
br
 />

26 2ã€æ›´æ–°ç³»ç»Ÿç¼“å­˜ï¼›<
br
 />

27 3ã€æ£€æµ‹ç³»ç»Ÿå˜é‡ä¸€è‡´æ€§ã€‚<
br
 />

28 4ã€æ£€æµ‹å¾®è¡¨ä¸ä¸»è¡¨æ•°æ®ä¸€è‡´æ€§ã€‚<
br
 />

29 <
br
 />

30 <
br
 />

31 <
a
 
h»f
='sys_»·œ.php?dİo¡=1' 
¡yË
='fÚt-size:18px;cŞÜ:»d'><
b
>ç‚¹å‡»æ­¤å¼€å§‹è¿›è¡Œå¸¸è§„æ£€æµ‹&
gt
;&gt;</b></a>

32 <
br
 /><br /><br />

33 </
td
>

34 </
Œ
>

35 </
bË
>

37 
$wš
->
	`AddMsgI‹m
("<div style='padding-left:20px;line-height:150%'>$msg</div>");

38 
$wšfÜm
 = 
$wš
->
	`G‘Wšdow
('hand','');

39 
$wš
->
	`Di¥Ïy
();

40 
	`ex™
();

41 
	}
}

46 if(
	g$dİo¡
==1)

48 
$wš
 = 
Ãw
 
OxWšdow
();

49 
	g$wš
->
In™
("sys_repair.php", "js/blank.js", "POST'ƒnctype='multipart/form-data' ");

50 
	g$wš
->
	gmašT™Ë
 = "ç³»ç»Ÿä¿®å¤å·¥å…·";

51 
	g$wecome_šfo
 = "<a href='sys_repair.php'>ç³»ç»Ÿé”™è¯¯ä¿®å¤å·¥å…·</a> &gt;&gt; æ£€æµ‹æ•°æ®ç»“æ„";

52 
	g$wš
->
AddT™Ë
('æœ¬å·¥å…·ç”¨äºæ£€æµ‹å’Œä¿®å¤ä½ çš„ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„é”™è¯¯');

53 
	g$msg
 = "

54 <
bË
 
width
='98%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0' 
®ign
='center'>

55 <
Œ
>

56 <
td
 
height
='250' 
v®ign
='top'>

57 <
br
 />

58 <
b
><
fÚt
 
cŞÜ
='green'>å·²å®Œæˆæ•°æ®ç»“æ„å®Œæ•´æ€§æ£€æµ‹ï¼</font></b>

59 <
hr
 
size
='1'/>

60 <
br
 />

61 <
b
>å¦‚æœä½ ç³»ç»Ÿæœ‰ä¸‹é¢å‡ ç§é—®é¢˜ä¹‹ä¸€ï¼Œè¯·æ£€æµ‹å¾®è¡¨æ­£ç¡®æ€§ï¼š</b><
br
 />

62 1ã€æ— æ³•è·å¾—ä¸»é”®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œåç»­æ“ä½œ<
br
 />

63 2ã€æ›´æ–°æ•°æ®åº“
¬chives
è¡¨æ—¶å‡ºé”™<
br
 />

64 3ã€åˆ—è¡¨æ˜¾ç¤ºæ•°æ®ç›®ä¸å®é™…æ–‡æ¡£æ•°ä¸ä¸€è‡´<
br
 />

65 <
br
 />

66 <
a
 
h»f
='sys_»·œ.php?dİo¡=2' 
¡yË
='fÚt-size:18px;'><
b
>ç‚¹å‡»æ­¤æ£€æµ‹å¾®è¡¨æ­£ç¡®æ€§&
gt
;&
	ggt
;</
	gb
></
	ga
>

67 <
	gbr
 /><br /><br />

68 </
	gtd
>

69 </
	gŒ
>

70 </
	gbË
>

72 
	g$wš
->
AddMsgI‹m
("<div style='padding-left:20px;line-height:150%'>$msg</div>");

73 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('hand','');

74 
	g$wš
->
Di¥Ïy
();

75 
ex™
();

81 if(
	g$dİo¡
==2)

83 
$msg
 = '';

85 
	g$®Ïrúum
 = 0;

86 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__archives` ");

87 
	g$®Ïrúum
 = 
$¬úum
 = 
$row
['dd'];

88 
	g$msg
 .= "<br />#@__archives è¡¨æ€»è®°å½•æ•°ï¼š {$arcnum} <br />";

90 
	g$shbËs
 = 
¬¿y
();

91 
	g$dsql
->
Execu‹
('me', " SELECT‡ddtable FROM `#@__channeltype` WHERE id < -1 ");

92 
	g$row
 = 
$dsql
->
G‘A¼ay
('me') )

94 
$addbË
 = 
¡¹Şow”
(
Œim
(
¡r_»¶aû
('#@__', 
$cfg_db´efix
, 
$row
['addtable'])));

95 if(
em±y
(
$addbË
))

101 ifĞ!
is£t
(
$shbËs
[
$addbË
]) )

103 
	g$shbËs
[
$addbË
] = 1;

104 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(aid) AS dd FROM `$addtable` ");

105 
	g$msg
 .= "<br />{$addtable} è¡¨æ€»è®°å½•æ•°ï¼š {$row['dd']} <br />";

106 
	g$®Ïrúum
 +ğ
$row
['dd'];

110 
	g$msg
 .= "â€»æ€»æœ‰æ•ˆè®°å½•æ•°ï¼š {$allarcnum} <br /> ";

111 
	g$”¿Î
 = "<a href='index_body.php' style='font-size:14px;'><b>å®Œæˆä¿®æ­£æˆ–æ— é”™è¯¯è¿”å›&gt;&gt;</b></a>";

112 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__arctiny` ");

113 
	g$msg
 .= "â€»å¾®ç»Ÿè®¡è¡¨è®°å½•æ•°ï¼š {$row['dd']}<br />";

114 if(
	g$row
['dd']==
$®Ïrúum
)

116 
$msg
 .= "<p style='color:green;font-size:16px'><b>ä¸¤è€…è®°å½•ä¸€è‡´ï¼Œæ— éœ€ä¿®æ­£ï¼</b></p><br />";

120 
	g$sql
 = " TRUNCATE TABLE `#@__arctiny`";

121 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

122 
	g$msg
 .= "<font color='red'>ä¸¤è€…è®°å½•ä¸ä¸€è‡´ï¼Œå°è¯•è¿›è¡Œç®€å•ä¿®æ­£...</font><br />";

124 
	g$sql
 = "INSERT INTO `#@__arctiny`(id,ypeid,ypeid2,‡rcrank, channel, senddate, sortrank, mid)

125 
SELECT
 
id
, 
	gty³id
, 
	gty³id2
, 
	g¬üªk
, 
	gchªÃl
, 
	g£ndd©e
, 
	gsÜŒªk
, 
mid
 
	gFROM
 `#@
	g__¬chives
` ";

126 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

128 
fÜ—ch
(
$shbËs
 
as
 
$tb
=>
$v
)

130 
$sql
 = "INSERT INTO `#@__arctiny`(id,ypeid,ypeid2,‡rcrank, channel, senddate, sortrank, mid)

131 
SELECT
 
aid
, 
	gty³id
, 0, 
	g¬üªk
, 
	gchªÃl
, 
	g£ndd©e
, 0, 
mid
 
	gFROM
 `
	g$tb
` ";

132 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$sql
);

133 
	g$dß¼ay
[
$tb
] = 1;

135 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT COUNT(*) AS dd FROM `#@__arctiny` ");

136 if(
	g$row
['dd']==
$®Ïrúum
)

138 
$msg
 .= "<p style='color:green;font-size:16px'><b>ä¿®æ­£è®°å½•æˆåŠŸï¼</b></p><br />";

142 
	g$msg
 .= "<p style='color:red;font-size:16px'><b>ä¿®æ­£è®°å½•å¤±è´¥ï¼Œå»ºè®®è¿›è¡Œé«˜çº§ç»¼åˆæ£€æµ‹ï¼</b></p><br />";

143 
	g$”¿Î
 = " <a href='sys_repair.php?dopost=3' style='font-size:14px;'><b>è¿›è¡Œé«˜çº§ç»“åˆæ€§æ£€æµ‹&gt;&gt;</b></a> ";

146 
UpD©eC©Cache
();

147 
	g$wš
 = 
Ãw
 
OxWšdow
();

148 
	g$wš
->
In™
("sys_repair.php", "js/blank.js", "POST'ƒnctype='multipart/form-data' ");

149 
	g$wš
->
	gmašT™Ë
 = "ç³»ç»Ÿä¿®å¤å·¥å…·";

150 
	g$wecome_šfo
 = "<a href='sys_repair.php'>ç³»ç»Ÿé”™è¯¯ä¿®å¤å·¥å…·</a> &gt;&gt; æ£€æµ‹å¾®è¡¨æ­£ç¡®æ€§";

151 
	g$wš
->
AddT™Ë
('æœ¬å·¥å…·ç”¨äºæ£€æµ‹å’Œä¿®å¤ä½ çš„ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„é”™è¯¯');

152 
	g$msg
 = "

153 <
bË
 
width
='98%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0' 
®ign
='center'>

154 <
Œ
>

155 <
td
 
height
='250' 
v®ign
='top'>

156 {
$msg
}

157 <
hr
 />

158 <
br
 />

159 {
$”¿Î
}

160 </
td
>

161 </
Œ
>

162 </
bË
>

164 
$wš
->
AddMsgI‹m
("<div style='padding-left:20px;line-height:150%'>$msg</div>");

165 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('hand','');

166 
	g$wš
->
Di¥Ïy
();

167 
ex™
();

173 if(
	g$dİo¡
==3)

175 
$”ºum
 = 0;

176 
	g$sql
 = " TRUNCATE TABLE `#@__arctiny`";

177 
	g$dsql
->
Execu‹NÚeQu”y
(
$sql
);

179 
	g$sql
 = "SELECT‡rc.id,‡rc.typeid,‡rc.typeid2,‡rc.arcrank,‡rc.channel,‡rc.senddate,‡rc.sortrank,

180 
¬c
.
mid
, 
	gch
.
addbË
 
	gFROM
 `#@
	g__¬chives
`‡rø
LEFT
 
	gJOIN
 `#@
	g__chªÃÉy³
` 
ch
 
ON
 ch.
	gid
÷rc.
chªÃl
 ";

181 
$dsql
->
Execu‹
('me', 
$sql
);

182 
	g$row
 = 
$dsql
->
G‘A¼ay
('me') )

184 
$sql
 = "INSERT INTO `#@__arctiny`(id,ypeid,ypeid2,‡rcrank, channel, senddate, sortrank, mid)

185 
VALUES
('{$row['
id
']}','{$row['
ty³id
']}','{$row['
ty³id2
']}','{$row['
¬üªk
']}',

186 '{$row['
chªÃl
']}','{$row['
£ndd©e
']}','{$row['
sÜŒªk
']}','{$row['
mid
']}'); ";

187 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$sql
);

188 if(!
	g$rs
)

190 
	g$addbË
 = 
Œim
(
$addbË
);

191 
	g$”ºum
 ++;

192 
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__archives` WHERE id='{$row['id']}' ");

193 if(!
em±y
(
$addbË
)è
	g$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `$addtable` WHERE id='{$row['id']}' ");

197 
	g$dsql
->
S‘Qu”y
("SELECT id,addtable FROM `#@__channeltype` WHERE id < -1 ");

198 
	g$dsql
->
Execu‹
();

199 
	g$dß¼ay
 = 
¬¿y
();

200 
	g$row
 = 
$dsql
->
G‘A¼ay
())

202 
$tb
 = 
¡r_»¶aû
('#@__', 
$cfg_db´efix
, 
$row
['addtable']);

203 if(
em±y
(
$tb
è|| 
is£t
(
$dß¼ay
[$tb]) )

209 
	g$sql
 = "INSERT INTO `#@__arctiny`(id,ypeid,ypeid2,‡rcrank, channel, senddate, sortrank, mid)

210 
SELECT
 
aid
, 
	gty³id
, 0, 
	g¬üªk
, 
	gchªÃl
, 
	g£ndd©e
, 0, 
mid
 
	gFROM
 `
	g$tb
` ";

211 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$sql
);

212 
	g$dß¼ay
[
$tb
] = 1;

215 
	g$wš
 = 
Ãw
 
OxWšdow
();

216 
	g$wš
->
In™
("sys_repair.php","js/blank.js","POST'ƒnctype='multipart/form-data' ");

217 
	g$wš
->
	gmašT™Ë
 = "ç³»ç»Ÿä¿®å¤å·¥å…·";

218 
	g$wecome_šfo
 = "<a href='sys_repair.php'>ç³»ç»Ÿé”™è¯¯ä¿®å¤å·¥å…·</a> &gt;&gt; é«˜çº§ç»¼åˆæ£€æµ‹ä¿®å¤";

219 
	g$wš
->
AddT™Ë
('æœ¬å·¥å…·ç”¨äºæ£€æµ‹å’Œä¿®å¤ä½ çš„ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„é”™è¯¯');

220 
	g$msg
 = "

221 <
bË
 
width
='98%' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0' 
®ign
='center'>

222 <
Œ
>

223 <
td
 
height
='250' 
v®ign
='top'>

224 å®Œæˆæ‰€æœ‰ä¿®å¤æ“ä½œï¼Œç§»é™¤é”™è¯¯è®°å½• {
$”ºum
} æ¡ï¼

225 <
hr
 />

226 <
br
 />

227 <
a
 
h»f
='šdex_body.php' 
¡yË
='fÚt-size:14px;'><
b
>å®Œæˆä¿®æ­£æˆ–æ— é”™è¯¯è¿”å›&
gt
;&
	ggt
;</
	gb
></
	ga
>

228 </
	gtd
>

229 </
	gŒ
>

230 </
	gbË
>

232 
	g$wš
->
AddMsgI‹m
("<div style='padding-left:20px;line-height:150%'>$msg</div>");

233 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('hand','');

234 
	g$wš
->
Di¥Ïy
();

235 
ex™
();

	@E:\web\weixun\xakadmin\sys_safe.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Safe');

9 
	g$§ãcÚfigfe
 = 
XAKDATA
."/safe/inc_safe_config.php";

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 if(
	g$dİo¡
 == "save")

14 
$cÚfig¡r
 = 
$shÜŠame
 = "";

15 
	g$gdİ’
 = 
em±y
(
$gdİ’
)? "" : $gdopen;

16 
	g$cod‘y³
 = 
em±y
(
$cod‘y³
)? 3 : $codetype;

17 
	g$gdty³
 = 
em±y
(
$gdty³
)? 1 : $gdtype;

18 
	g$gd_wwidth
 = 
em±y
(
$gd_wwidth
)? 0 : $gd_wwidth;

19 
	g$gd_wheight
 = 
em±y
(
$gd_wheight
)? 0 : $gd_wheight;

20 
	g$cod–’
 = 
em±y
(
$cod–’
)? 4 : $codelen;

21 
	g$gdçq_»g
 = 
em±y
(
$gdçq_»g
)? 0 : $gdfaq_reg;

22 
	g$gdçq_£nd
 = 
em±y
(
$gdçq_£nd
)? 0 : $gdfaq_send;

23 
	g$gdçq_msg
 = 
em±y
(
$gdçq_msg
)? 0 : $gdfaq_msg;

25 if(
is_¬¿y
(
$gdİ’
))

27 
	g$cÚfig¡r
 = "\$§ã_gdİ’ = '".
im¶ode
(",",
$gdİ’
)."';\r\n";

29 
	g$cÚfig¡r
 = "\$safe_gdopen = '';\r\n";

31 
	g$cÚfig¡r
 .ğ"\$§ã_cod‘y³ = '".
$cod‘y³
."';\r\n";

32 
	g$cÚfig¡r
 .ğ"\$§ã_gdty³ = '".
$gdty³
."';\r\n";

33 
	g$cÚfig¡r
 .ğ"\$§ã_wwidth = '".
$gd_wwidth
."';\r\n";

34 
	g$cÚfig¡r
 .ğ"\$§ã_wheighˆğ'".
$gd_wheight
."';\r\n";

35 
	g$cÚfig¡r
 .ğ"\$§ã_cod–’ = '".
$cod–’
."';\r\n";

36 
	g$cÚfig¡r
 .ğ"\$§ã_çq_»g = '".
$gdçq_»g
."';\r\n";

37 
	g$cÚfig¡r
 .ğ"\$§ã_çq_£nd = '".
$gdçq_£nd
."';\r\n";

38 
	g$cÚfig¡r
 .ğ"\$§ã_çq_msg = '".
$gdçq_msg
."';\r\n";

41 
	g$çqs
 = 
¬¿y
();

42 
	g$i
 = 1; $˜<ğ
couÁ
(
$que¡iÚ
)-1; $i++)

44 
	g$v®
 = 
Œim
(
$que¡iÚ
[
$i
]);

45 if(
	g$v®
)

47 
	g$çqs
[
$i
]['que¡iÚ'] = 
¡r_»¶aû
("'","\"",
¡r¦ashes
(
$v®
));

48 
	g$çqs
[
$i
]['ªsw”'] = 
¡r¦ashes
(
Œim
(
$ªsw”
[$i]));

53 
	g$cÚfig¡r
 .ğ"\$§ã_çq ğ'".
£rŸlize
(
$çqs
)."';\r\n";

54 
	g$cÚfig¡r
 = "<"."?php\r\n".
$cÚfig¡r
."?".">\r\n";

56 
	g$å
 = 
fİ’
(
$§ãcÚfigfe
, "w"è
Ü
 
d›
("å†™å…¥æ–‡ä»¶ $safeconfigfile å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™ï¼");

57 
fwr™e
(
$å
, 
$cÚfig¡r
);

58 
fşo£
(
$å
);

59 
ShowMsg
("ä¿®æ”¹é…ç½®æˆåŠŸï¼","sys_safe.php");

60 
	gex™
;

63 
»quœe_Úû
(
$§ãcÚfigfe
);

64 
	g$§ãçqs
 = 
un£rŸlize
(
$§ã_çqs
);

65 
šşude
 
XAKINClude
('templets/sys_safe.htm');

	@E:\web\weixun\xakadmin\sys_safetest.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('sys_Edit');

9 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

10 if(
em±y
(
$mes§ge
)è
	g$mes§ge
 = 'å°šæœªè¿›è¡Œæ£€æµ‹â€¦â€¦';

11 if(
em±y
(
$f‘y³
)è
	g$f‘y³
 = 'php|inc';

12 if(
em±y
(
$šfo
)è
	g$šfo
 = 'eval|cmd|_GET|_POST';

14 
	g$§ãfe
 = "data/common.inc.php

15 
šdex
.
php


16 
xakadmš
/
cÚfig
.
php


17 
xakadmš
/
šdex_body
.
php


18 
xakadmš
/
memb”_do
.
php


19 
xakadmš
/
sys_šfo_·y
.
php


20 
xakadmš
/
mychªÃl_maš
.
php


21 
group
/
po¡fÜm
.
php


22 
group
/
»¶y
.
php


23 
šşude
/
commÚ
.
šc
.
php


24 
šşude
/
ma
.
şass
.
php


25 
šşude
/
Lurd
.
şass
.
php


26 
šşude
/
·ym’t
/
®ay
.
php


27 
šşude
/
·ym’t
/
bªk
.
php


28 
šşude
/
·ym’t
/
cod
.
php


29 
šşude
/
·ym’t
/
y“·y
.
php


30 
šşude
/
h–³rs
/
debug
.
h–³r
.
php


31 
šşude
/
»que¡
.
şass
.
php


32 
šşude
/
xakcŞËùiÚ
.
şass
.
php


33 
šşude
/
xakg
.
şass
.
php


34 
šşude
/
dŸlog
/
cÚfig
.
php


35 
šşude
/
glib
/
php
.
lib
.php

36 
šşude
/
FCKed™Ü
/
fcked™Ü
.
php


37 
šşude
/
sm
.
şass
.
php


38 
šşude
/
z
.
şass
.
php


39 
š¡®l
/
commÚ
.
šc
.
php


40 
šşude
/
jsÚ
.
şass
.
php


41 
šşude
/
¥hšxş›Á
.
şass
.
php


42 
moduË
/
bsh¬e
.
php


43 
š¡®l
/
šdex
.
php
";

45 
$admšDœ
 = 
´eg_»¶aû
("#(.*)[\/\\\\]#", "", 
dœÇme
(
__FILE__
));

46 
	g$§ãfe
 = 
Œim
(
¡r_»¶aû
('xakadmš/',
$admšDœ
.'/',
$§ãfe
));

47 
	g$§ãfes
 = 
´eg_¥l™
("#[\r\n]{1,}#", 
$§ãfe
);

49 
funùiÚ
 
	$Te¡OÃFe
(
$f
)

51 
glob®
 
$mes§ge
, 
$šfo
;

52 
$¡r
 = '';

55 if(
	`NÙCheckFe
(
$f
è|| 
	`´eg_m©ch
("#data/tplcache|.svn#", $f))  -1;

57 
$å
 = 
	`fİ’
(
$f
, 'r');

58 !
	`ãof
(
$å
)è{ 
$¡r
 .ğ
	`fg‘s
($fp,1024); }

59 
	`fşo£
(
$å
);

60 if(
	`´eg_m©ch
("#(".
$šfo
.")[ \r\n\t]{0,}([\[\(])#i", 
$¡r
))

62 
$Œfe
 = 
	`´eg_»¶aû
("#^".
XAKROOT
."#", '', 
$f
);

63 
$mes§ge
 .= "<div style='clear:both;border-bottom:1px dotted #B8E6A2;line-height:24px'>

64 <
div
 
¡yË
='width:350px;æßt:Ëá'>å¯ç–‘æ–‡ä»¶ï¼š{
$Œfe
}</div>

65 <
div
 
¡yË
='æßt:Ëá'>[<
a
 
h»f
='fe_mªage_v›w.php?fmdo=d–&f’ame=$Œfe&aùiv•©h=' 
rg‘
='_bÏnk'><
u
>åˆ é™¤</u></a>]

66 [<
a
 
h»f
='fe_mªage_v›w.php?fmdoód™&f’ame=$Œfe&aùiv•©h=' 
rg‘
='_bÏnk'><
u
>æŸ¥çœ‹æºç </u></a>]

67 </
div
></div>\
r
\
n
";

71 
	}
}

73 
funùiÚ
 
	$NÙCheckFe
(
$f
)

75 
glob®
 
$§ãfes
, 
$§ãfe
;

76 if(
$§ãfe
 != '')

78 
	`fÜ—ch
(
$§ãfes
 
as
 
$v
)

81 ifĞ
	`´eg_m©ch
("#".
$v
."#i", 
$f
èè 
TRUE
;

84  
çl£
;

85 
	}
}

87 
funùiÚ
 
	$Te¡Saã
(
$tdœ
)

89 
glob®
 
$f‘y³
;

90 
$dh
 = 
	`dœ
(
$tdœ
);

91 
$âame
=
$dh
->
	`»ad
())

93 
$âamef
 = 
$tdœ
.'/'.
$âame
;

94 if(@
	`is_dœ
(
$âamef
è&& 
$âame
 != '.' && $fname != '..')

96 
	`Te¡Saã
(
$âamef
);

98 if(
	`´eg_m©ch
("#\.(" . 
$f‘y³
 . ")#i", 
$âamef
))

100 
	`Te¡OÃFe
(
$âamef
);

103 
	}
}

106 if(
	g$aùiÚ
=='test')

108 
$mes§ge
 = '';

109 
AjaxH—d
();

110 
Te¡Saã
(
XAKROOT
);

111 if(
	g$mes§ge
==''è
$mes§ge
 = "<font color='green' style='font-size:14px'>æ²¡å‘ç°å¯ç–‘æ–‡ä»¶ï¼</font>";

112 
echo
 
	g$mes§ge
;

113 
ex™
();

117 if(
	g$aùiÚ
=='clear')

119 
glob®
 
$cfg_lÿche_dœ
;

120 
	g$mes§ge
 = '';

121 
	g$d
 = 
XAKROOT
.
$cfg_lÿche_dœ
;

122 
AjaxH—d
();

123 
¦“p
(1);

124 if(
´eg_m©ch
("#d©a\/#", 
$cfg_lÿche_dœ
è&& 
fe_exi¡s
(
$d
è&& 
is_dœ
($d))

126 
	g$dh
 = 
dœ
(
$d
);

127 
	g$f’ame
 = 
$dh
->
»ad
())

129 if(
$f’ame
=='.'||$filename=='..'||$filename=='index.html') ;

130 @
uÆšk
(
$d
.'/'.
$f’ame
);

133 
	g$mes§ge
 = "<font color='green' style='font-size:14px'>æˆåŠŸæ¸…ç©ºæ¨¡æ¿ç¼“å­˜ï¼</font>";

134 
echo
 
	g$mes§ge
;

135 
ex™
();

138 
šşude
(
dœÇme
(
__FILE__
).'/templets/sys_safetest.htm');

	@E:\web\weixun\xakadmin\sys_sql_info.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Data');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

10 
	g$dbdoc
 = 
Ãw
 
MakeDBDocum’t
;

11 
	g$dbdoc
->
show
();

13 şas 
	cMakeDBDocum’t


15 
v¬
 
	m$dsql
;

16 
funùiÚ
 
	$__cÚ¡ruù
()

18 
glob®
 
$dsql
;

19 
$this
->
dsql
 = 
$dsql
;

22 
funùiÚ
 
	$ª®y£_bË
(&
$bËšfo
, 
$bËÇme
)

24 
$æšes
 = 
	`ex¶ode
("\n", 
$bËšfo
);

25 
$addšfo
 = 
$tbšfo
 = 
$tb_comm’t
 = '';

26 
$f›lds
 = 
	`¬¿y
();

27 
	`fÜ—ch
(
$æšes
 
as
 
$lše
)

29 
$lše
 = 
	`Œim
($line);

30 ifĞ
$lše
=='' ) ;

31 ifĞ
	`´eg_m©ch
('/CREATE TABLE/i', 
$lše
) ) ;

32 ifĞ!
	`´eg_m©ch
('/`/', 
$lše
) )

34 
$¬r
 = '';

35 
	`´eg_m©ch
("/ENGINE=([a-z]*)(.*)DEFAULT CHARSET=([a-z0-9]*)/i", 
$lše
, 
$¬r
);

36 
$tbšfo
 = "ENGINE=".
$¬r
[1].'/CHARSET='.$arr[3];

37 
$¬r
 = '';

38 
	`´eg_m©ch
("/comm’t='([^']*)'/i", 
$lše
, 
$¬r
);

39 ifĞ
	`is£t
(
$¬r
[1]) )

41 
$tb_comm’t
 = 
$¬r
[1];

45 ifĞ
	`´eg_m©ch
('/KEY/', 
$lše
) )

47 
$addšfo
 .ğ
$lše
."<br />\n";

51 
$¬r
 = '';

52 
$Æše
 = 
	`´eg_»¶aû
("/comm’ˆ'([^']*)'/i", '', 
$lše
);

53 
	`´eg_m©ch
("/`([^`]*)` (.*)[,]{0,1}$/U", 
$Æše
, 
$¬r
);

54 
$f
 = 
$¬r
[1];

55 
$f›lds
[ 
$f
 ][0] = 
$¬r
[2];

56 
$f›lds
[ 
$f
 ][1] = '';

57 
$¬r
 = '';

58 
	`´eg_m©ch
("/comm’ˆ'([^']*)'/i", 
$lše
, 
$¬r
);

59 ifĞ
	`is£t
(
$¬r
[1]) )

61 
$f›lds
[ 
$f
 ][1] = 
$¬r
[1];

66 
$bËhtml
 = " <table width=\"960\"‡lign=\"center\" border=\"0\" cellpadding=\"5\" cellspacing=\"1\" bgcolor=\"#C1D1A3\" style=\"font-size:14px;margin-bottom:10px\">

67 <
Œ
>

68 <
td
 
height
=\"34\" colspan=\"3\" bgcolor=\"#DDEDA5\">

69 <
a
 
Çme
=\"{$tablename}\"></a>

70 <
bË
 
width
=\"90%\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">

71 <
Œ
>

72 <
td
 
width
=\"29%\"><strong>è¡¨åï¼š{$tablename}</strong> <br />($tbinfo)</td>

73 <
td
 
width
=\"71%\">è¯´æ˜ï¼š{$tb_comment}</td>

74 </
Œ
>

75 </
bË
></
td
>

76 </
Œ
>

77 <
Œ
>

78 <
td
 
width
=\"20%\" height=\"28\" bgcolor=\"#F7FDEA\">å­—æ®µå</td>

79 <
td
 
width
=\"28%\" bgcolor=\"#F7FDEA\">è¯´æ˜æè¿°</td>

80 <
td
 
bgcŞÜ
=\"#F7FDEA\">å…·ä½“å‚æ•°</td>

81 </
Œ
>\
n
";

82 
	`fÜ—ch
(
$f›lds
 
as
 
$k
=>
$v
)

84 
$bËhtml
 .= " <tr height=\"24\" bgcolor=\"#FFFFFF\">

85 <
td
><
b
>{
$k
}</b></td>

86 <
td
>{
$v
[1]}</td>

87 <
td
>{
$v
[0]}</td>

88 </
Œ
>\
n
";

90 
$bËhtml
 .= " <tr>

91 <
td
 
height
=\"28\" colspan=\"3\" bgcolor=\"#F7FDEA\">

92 <
b
>ç´¢å¼•ï¼š</b><
br
 />

93 {
$addšfo
}

94 </
td
>

95 </
Œ
>

96 </
bË
>";

97  
$bËhtml
;

98 
	}
}

100 
funùiÚ
 
show
Ğ
$ty³
='' )

102 
$Çmehtml
 = 
$bËhtml
 = '';

103 
	g$this
->
	gdsql
->
Execu‹
('me', ' SHOW TABLES; ');

104  
	g$row
 = 
$this
->
dsql
->
G‘A¼ay
('me', 
MYSQL_NUM
) )

107 
	g$this
->
	gdsql
->
Execu‹
('dd', " Show CREATE TABLE `{$row[0]}` ");

108 
	g$row2
 = 
$this
->
dsql
->
G‘A¼ay
('dd', 
MYSQL_NUM
);

110 ifĞ
	g$ty³
=='' )

112 ifĞ
´eg_m©ch
("/^cms_/", 
$row
[0]) ) ;

116 ifĞ!
´eg_m©ch
("/^".
$ty³
."_/", 
$row
[0]) ) ;

119 
	g$Çmehtml
 .= "<a href='#{$row[0]}'>{$row[0]}</a> | ";

120 
	g$bËhtml
 .ğ
$this
->
ª®y£_bË
Ğ
$row2
[1], 
$row
[0]);

122 
	g$htmlh—d
 = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">

123 <
html
 
xmÊs
=\"http://www.w3.org/1999/xhtml\">

124 <
h—d
>

125 <
m‘a
 
h‰p
-
equiv
=\"Content-Type\" content=\"text/html; charset={$cfg_soft_lang}\" />

126 <
lšk
 
h»f
=\"css/base.css\"„el=\"stylesheet\"ype=\"text/css\">

127 <
¡yË
>

129 
fÚt
-
size
:14
px
;

130 
	gfÚt
-
	gçmy
:
ArŸl
, \"å®‹ä¼‘\", \"Courier New\";

132 
	ga
 {

133 
	g‹xt
-
	gdecÜ©iÚ
:
nÚe
;

135 </
	g¡yË
>

136 <
	gt™Ë
>æ•°æ®åº“è¯´æ˜æ–‡æ¡£</title>

137 </
	gh—d
>

138 <
body
 
	gbackground
='images/®lbg.gif' 
Ëám¬gš
='8' 
tİm¬gš
='8'>";

139 
echo
 
$htmlh—d
;

140 
	gecho
 "<bË‡lign='ûÁ”' width='960' styË='m¬gš-bÙtom:8px' ><Œ><td>".
	g$Çmehtml
."</td></tr></table>";

141 
echo
 
	g$bËhtml
;

142 
	gecho
 "</body>\n</html>";

143 
ex™
();

	@E:\web\weixun\xakadmin\sys_sql_query.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Data');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 if(
	g$dİo¡
=="viewinfo")

14 if(
em±y
(
$bËÇme
))

16 
echo
 "æ²¡æœ‰æŒ‡å®šè¡¨åï¼";

20 
	g$dsql
->
S‘Qu”y
("SHOW CREATE TABLE ".
$dsql
->
dbName
.".".
$bËÇme
);

21 
	g$dsql
->
Execu‹
('me');

22 
	g$row2
 = 
$dsql
->
G‘A¼ay
('me',
MYSQL_BOTH
);

23 
	g$ùšfo
 = 
$row2
[1];

24 
	gecho
 "<xmp>".
Œim
(
$ùšfo
)."</xmp>";

26 
ex™
();

29 if(
	g$dİo¡
=="opimize")

31 if(
em±y
(
$bËÇme
))

33 
echo
 "æ²¡æœ‰æŒ‡å®šè¡¨åï¼";

37 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("OPTIMIZE TABLE `$tablename` ");

38 if(
	g$rs
è
	gecho
 "æ‰§è¡Œä¼˜åŒ–è¡¨ï¼š $tablename OKï¼";

39 
	gecho
 "æ‰§è¡Œä¼˜åŒ–è¡¨ï¼š $bËÇm å¤±è´¥ï¼ŒåŸå› æ˜¯ï¼š".
	g$dsql
->
G‘E¼Ü
();

41 
ex™
();

44 if(
	g$dİo¡
=="opimizeAll")

46 
$dsql
->
S‘Qu”y
("SHOW TABLES");

47 
	g$dsql
->
Execu‹
('t');

48 
	g$row
 = 
$dsql
->
G‘A¼ay
('t',
MYSQL_BOTH
))

50 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("OPTIMIZE TABLE `{$row[0]}` ");

51 if(
	g$rs
)

53 
	gecho
 "ä¼˜åŒ–è¡¨: {$row[0]} ok!<br />\r\n";

55 
	gecho
 "ä¼˜åŒ–è¡¨: {$row[0]} å¤±è´¥! åŸå› æ˜¯: ".
	g$dsql
->
G‘E¼Ü
()."<br />\r\n";

58 
ex™
();

61 if(
	g$dİo¡
=="repair")

63 if(
em±y
(
$bËÇme
))

65 
echo
 "æ²¡æœ‰æŒ‡å®šè¡¨åï¼";

69 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("REPAIR TABLE `$tablename` ");

70 if(
	g$rs
è
	gecho
 "ä¿®å¤è¡¨ï¼š $tablename OKï¼";

71 
	gecho
 "ä¿®å¤è¡¨ï¼š $bËÇm å¤±è´¥ï¼ŒåŸå› æ˜¯ï¼š".
	g$dsql
->
G‘E¼Ü
();

73 
ex™
();

76 if(
	g$dİo¡
=="repairAll")

78 
$dsql
->
S‘Qu”y
("Show Tables");

79 
	g$dsql
->
Execu‹
('t');

80 
	g$row
 = 
$dsql
->
G‘A¼ay
('t',
MYSQL_BOTH
))

82 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
("REPAIR TABLE `{$row[0]}` ");

83 if(
	g$rs
)

85 
	gecho
 "ä¿®å¤è¡¨: {$row[0]} ok!<br />\r\n";

87 
	gecho
 "ä¿®å¤è¡¨: {$row[0]} å¤±è´¥! åŸå› æ˜¯: ".
	g$dsql
->
G‘E¼Ü
()."<br />\r\n";

90 
ex™
();

93 if(
	g$dİo¡
=="query")

95 
$sqlqu”y
 = 
Œim
(
¡r¦ashes
($sqlquery));

96 if(
´eg_m©ch
("#drİ(.*éabË#i", 
$sqlqu”y
) ||…reg_match("#drop(.*)database#", $sqlquery))

98 
	gecho
 "<span style='font-size:10pt'>åˆ é™¤'æ•°æ®è¡¨'æˆ–'æ•°æ®åº“'çš„è¯­å¥ä¸å…è®¸åœ¨è¿™é‡Œæ‰§è¡Œã€‚</span>";

99 
ex™
();

102 if(
´eg_m©ch
("#^£Ëù #i", 
$sqlqu”y
))

104 
	g$dsql
->
S‘Qu”y
(
$sqlqu”y
);

105 
	g$dsql
->
Execu‹
();

106 if(
	g$dsql
->
G‘TÙ®Row
()<=0)

108 
echo
 "è¿è¡ŒSQLï¼š{$sqlquery}ï¼Œæ— è¿”å›è®°å½•ï¼";

112 
	gecho
 "è¿è¡ŒSQLï¼š{$sqlqu”y}ï¼Œå…±æœ‰".
	g$dsql
->
G‘TÙ®Row
()."æ¡è®°å½•ï¼Œæœ€å¤§è¿”å›100æ¡ï¼";

114 
	g$j
 = 0;

115 
	g$row
 = 
$dsql
->
G‘A¼ay
())

117 
$j
++;

118 if(
	g$j
 > 100)

122 
	gecho
 "<hr size=1 width='100%'/>";

123 
	gecho
 "è®°å½•ï¼š$j";

124 
	gecho
 "<hr size=1 width='100%'/>";

125 
fÜ—ch
(
$row
 
as
 
$k
=>
$v
)

127 
echo
 "<font color='red'>{$k}ï¼š</font>{$v}<br/>\r\n";

130 
ex™
();

132 if(
	g$qu”yty³
==2)

135 
$sqlqu”y
 = 
¡r_»¶aû
("\r","",$sqlquery);

136 
	g$sqls
 = 
´eg_¥l™
("#;[ \t]{0,}\n#",
$sqlqu”y
);

137 
	g$Ã¼Code
 = ""; 
	g$i
=0;

138 
fÜ—ch
(
$sqls
 
as
 
$q
)

140 
	g$q
 = 
Œim
(
$q
);

141 if(
	g$q
=="")

145 
	g$dsql
->
Execu‹NÚeQu”y
(
$q
);

146 
	g$”rCode
 = 
Œim
(
$dsql
->
G‘E¼Ü
());

147 if(
	g$”rCode
=="")

149 
$i
++;

153 
	g$Ã¼Code
 .ğ"æ‰§è¡Œï¼š <fÚˆcŞÜ='blue'>$q</fÚt> å‡ºé”™ï¼Œé”™è¯¯æç¤ºï¼š<fÚˆcŞÜ='»d'>".
$”rCode
."</font><br>";

156 
	gecho
 "æˆåŠŸæ‰§è¡Œ{$i}ä¸ªSQLè¯­å¥ï¼<br><br>";

157 
echo
 
	g$Ã¼Code
;

161 
	g$dsql
->
Execu‹NÚeQu”y
(
$sqlqu”y
);

162 
	g$Ã¼Code
 = 
Œim
(
$dsql
->
G‘E¼Ü
());

163 
	gecho
 "æˆåŠŸæ‰§è¡Œ1ä¸ªSQLè¯­å¥ï¼<br><br>";

164 
echo
 
	g$Ã¼Code
;

166 
ex™
();

168 
šşude
 
XAKINClude
('templets/sys_sql_query.htm');

	@E:\web\weixun\xakadmin\sys_task.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Task');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

12 if(
	g$dİo¡
=='del')

14 
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM `#@__sys_task` WHERE id='$id' ");

15 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªä»»åŠ¡ï¼", "sys_task.php");

16 
ex™
();

18 
šşude
 
XAKINClude
('templets/sys_task.htm');

	@E:\web\weixun\xakadmin\sys_task_add.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Task');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
	g$dİo¡
=='save')

13 
$¡¬‰ime
 = 
em±y
($¡¬‰imeè? 0 : 
G‘MkTime
($starttime);

14 
	g$’dtime
 = 
em±y
(
$’dtime
è? 0 : 
G‘MkTime
($endtime);

15 
	g$ruÁime
 = 
$h
.':'.
$m
;

16 
	g$Qu”y
 = "INSERT INTO `#@__sys_task`(`taskname`,`dourl`,`islock`,`runtype`,`runtime`,`starttime`,`endtime`,`freq`,`lastrun`,`description`,`parameter`,`settime`)

17 
VALUES
('$taskname', '$dourl', '$nislock', '$runtype', '$runtime', '$starttime', '$endtime','$freq', '0', '$description','$parameter', '".time()."'); ";

18 
	g$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$Qu”y
);

19 if(
	g$rs
)

21 
ShowMsg
('æˆåŠŸå¢åŠ ä¸€ä¸ªä»»åŠ¡!', 'sys_task.php');

25 
ShowMsg
('å¢åŠ ä»»åŠ¡å¤±è´¥!'.
$dsql
->
G‘E¼Ü
(), 'javascript:;');

27 
ex™
();

30 
šşude
 
XAKINClude
('templets/sys_task_add.htm');

	@E:\web\weixun\xakadmin\sys_task_edit.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Task');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = '';

11 if(
	g$dİo¡
=='save')

13 
$¡¬‰ime
 = 
em±y
($¡¬‰imeè? 0 : 
G‘MkTime
($starttime);

14 
	g$’dtime
 = 
em±y
(
$’dtime
è? 0 : 
G‘MkTime
($endtime);

15 
	g$ruÁime
 = 
$h
.':'.
$m
;

16 
	g$qu”y
 = "UPDATE `#@__sys_task`

17 
SET
 `
skÇme
` = '$taskname',

18 `
	gdou¾
` = '$dourl',

19 `
	gi¦ock
` = '$nislock',

20 `
	gruÁy³
` = '$runtype',

21 `
	gruÁime
` = '$runtime',

22 `
	g¡¬‰ime
` = '$starttime',

23 `
	g’dtime
` = '$endtime',

24 `
	gäeq
` = '$freq',

25 `
	gdesütiÚ
` = '$description',

26 `
	g·¿m‘”
` = '$parameter'

27 
WHERE
 
id
='$id' ";

28 
$rs
 = 
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

29 if(
	g$rs
)

31 
ShowMsg
('æˆåŠŸä¿®æ”¹ä¸€ä¸ªä»»åŠ¡!', 'sys_task.php');

35 
ShowMsg
('ä¿®æ”¹ä»»åŠ¡å¤±è´¥!'.
$dsql
->
G‘E¼Ü
(), 'javascript:;');

37 
ex™
();

40 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__sys_task` WHERE id='$id' ");

41 
šşude
 
XAKINClude
('templets/sys_task_edit.htm');

	@E:\web\weixun\xakadmin\sys_verifies.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Edit');

9 @
£t_time_lim™
(0);

10 
»quœe
(
XAKINC
.'/xakhttpdown.class.php');

12 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

15 
$v”LockFe
 = 
XAKDATA
.'/admin/ver.txt';

17 
$v”if›sLockFe
 = 
XAKDATA
.'/admin/verifies.txt';

19 
$å
 = 
	`fİ’
(
$v”LockFe
,'r');

20 
$upTime
 = 
	`Œim
(
	`ä—d
(
$å
,64));

21 
	`fşo£
(
$å
);

23 
$upd©eTime
 = 
	`sub¡r
(
$upTime
,0,4).'-'.substr($upTime,4,2).'-'.substr($upTime,6,2);

24 
$v”if›sTime
 = "æœªåŒæ­¥è¿‡æŒ‡çº¹ç ";

25 if(
	$fe_exi¡s
(
$v”if›sLockFe
))

27 
$å
 = 
	`fİ’
(
$v”if›sLockFe
,'r');

28 
$upTime
 = 
	`Œim
(
	`ä—d
(
$å
,64));

29 
	`fşo£
(
$å
);

30 
$v”if›sTime
 = 
	`sub¡r
(
$upTime
,0,4).'-'.substr($upTime,4,2).'-'.substr($upTime,6,2);

31 
	}
}

33 
	g$tmpdœ
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
),0,16);

38 if(!
funùiÚ_exi¡s
('file_get_contents'))

40 
funùiÚ
 
fe_g‘_cÚ‹Ás
(
$âame
)

42 if(!
fe_exi¡s
(
$âame
è|| 
is_dœ
($fname))

48 
	g$å
 = 
fİ’
(
$âame
, 'r');

49 
	g$ù
 = 
ä—d
(
$å
, 
fesize
(
$âame
));

50 
fşo£
(
$å
);

51  
	g$ù
;

56 if(
	g$aùiÚ
 == '')

58 
šşude
(
XAKADMIN
.'/templets/sys_verifies.htm');

59 
ex™
();

65 if(
	g$aùiÚ
 == 'verify')

67 
$dsql
->
S‘Qu”y
("SELECT * FROM `#@__verifies` ");

68 
	g$dsql
->
Execu‹
();

69 
	g$f–i¡
 = 
¬¿y
();

70 
	g$row
 = 
$dsql
->
G‘A¼ay
())

72 
$tu»fe
 = 
¡r_»¶aû
('../xakadmš', '.', 
$row
['filename']);

74 if(!
fe_exi¡s
(
$tu»fe
)) {

77 ifĞ
fesize
(
$tu»fe
)==0 ) {

80 
	g$ù
 = 
fe_g‘_cÚ‹Ás
(
$tu»fe
);

81 
	g$ù
 = 
´eg_»¶aû
("/\/\*\*[\r\n]{1,}(.*)[\r\n]{1,} \*\//sU", '', 
$ù
);

82 
	g$ùhash
 = 
md5
(
$ù
);

83 if(
	g$ùhash
 !ğ
$row
['cthash'])

85 
$row
['loÿlhash'] = 
$ùhash
;

86 
	g$row
['mtime'] = 
MyD©e
('Y-m-d H:i:s', 
femtime
(
$tu»fe
));

87 
	g$row
['tu»fe'] = 
$tu»fe
;

88 
	g$f–i¡
[] = 
$row
;

91 if(!
is£t
(
$f–i¡
[0]))

93 
ShowMsg
("æ‰€æœ‰æ–‡ä»¶éƒ½é€šè¿‡æ•ˆéªŒè¯ï¼Œæ ¸å¿ƒæ–‡ä»¶æ²¡æœ‰è¢«æ”¹åŠ¨è¿‡ï¼","sys_verifies.php");

97 
šşude
(
XAKADMIN
.'/templets/sys_verifies_verify.htm');

99 
ex™
();

105 ià(
	g$aùiÚ
 == 'view')

107 
»quœe_Úû
(
XAKINC
."/oxwindow.class.php");

109 
	g$f‘xt
 = '';

110 ifĞ!
´eg_m©ch
("#d©a(.*)commÚ.šc.php#i", 
$f’ame
) )

112 
	g$å
 = 
fİ’
(
$f’ame
, 'r');

113 
	g$f‘xt
 = 
ä—d
(
$å
, 
fesize
(
$f’ame
));

114 
fşo£
(
$å
);

117 
	g$f‘xt
 = 
¡r_»¶aû
('‹x»a', '!‹x»a', 
$f‘xt
);

119 
	g$wšt™Ë
 = "æ–‡ä»¶æ•ˆéªŒ::æŸ¥çœ‹æ–‡ä»¶";

120 
	g$wecome_šfo
 = "<a href='sys_verifies.php'><u>æ–‡ä»¶æ•ˆéªŒ</u></a>::æŸ¥çœ‹æ–‡ä»¶";

121 
	g$wš
 = 
Ãw
 
OxWšdow
();

122 
	g$wš
->
In™
();

123 
	g$wš
->
AddT™Ë
("ä»¥ä¸‹ä¸ºæ–‡ä»¶ $filename çš„å†…å®¹ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¯ç–‘ï¼š");

124 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","<‹x»¨Çme='f‘xt' styË='width:100%;height:450px;wÜd-w¿p: b»ak-wÜd;wÜd-b»ak:b»ak-®l;'>".
$f‘xt
."</textarea>");

125 
	g$wš
->
Di¥Ïy
();

126 
ex™
();

132 ià(
	g$aùiÚ
 == 'manage')

134 
$dsql
->
S‘Qu”y
("SELECT * FROM `#@__verifies` ");

135 
	g$dsql
->
Execu‹
();

136 
	g$f–i¡
 = 
¬¿y
();

137 
	g$row
 = 
$dsql
->
G‘A¼ay
())

139 
$f–i¡
[] = 
$row
;

141 
šşude
(
XAKADMIN
.'/templets/sys_verifies_manage.htm');

142 
ex™
();

148 ià(
	g$aùiÚ
 == 'getfiles')

150 if(!
is£t
(
$»fes
))

152 
ShowMsg
("ä½ æ²¡è¿›è¡Œä»»ä½•æ“ä½œï¼","sys_verifies.php");

153 
ex™
();

155 
	g$ÿcheFes
 = 
XAKDATA
.'/modifytmp.inc';

156 
	g$å
 = 
fİ’
(
$ÿcheFes
, 'w');

157 
fwr™e
(
$å
, '<'.'?php'."\r\n");

158 
fwr™e
(
$å
, '$tmpdœ = "'.
$tmpdœ
.'";'."\r\n");

159 
	g$dœs
 = 
¬¿y
();

160 
	g$i
 = -1;

161 
	g$admšDœ
 = 
´eg_»¶aû
("#(.*)[\/\\\\]#", "", 
dœÇme
(
__FILE__
));

162 
fÜ—ch
(
$»fes
 
as
 
$f’ame
)

164 
	g$f’ame
 = 
sub¡r
(
$f’ame
,3,
¡¾’
($filename)-3);

165 if(
´eg_m©ch
("#^xakadmš/#i", 
$f’ame
))

167 
	g$curdœ
 = 
G‘DœName
Ğ
´eg_»¶aû
("#^xakadmš/#i", 
$admšDœ
.'/', 
$f’ame
) );

169 
	g$curdœ
 = 
G‘DœName
(
$f’ame
);

171 ifĞ!
is£t
(
$dœs
[
$curdœ
]) )

173 
	g$dœs
[
$curdœ
] = 
Te¡IsFeDœ
($curdir);

175 
	g$i
++;

176 
fwr™e
(
$å
, '$fes['.
$i
.'] = "'.
$f’ame
.'";'."\r\n");

178 
fwr™e
(
$å
, '$feCÚuˆğ'.
$i
.';'."\r\n");

179 
fwr™e
(
$å
, '?'.'>');

180 
fşo£
(
$å
);

182 
	g$dœšfos
 = '';

183 if(
	g$i
 > -1)

185 
	g$dœšfos
 = '<tr bgcolor="#ffffff"><td colspan="2">';

186 
	g$dœšfos
 .= "æœ¬æ¬¡å‡çº§éœ€è¦åœ¨ä¸‹é¢æ–‡ä»¶å¤¹å†™å…¥æ›´æ–°æ–‡ä»¶ï¼Œè¯·æ³¨æ„æ–‡ä»¶å¤¹æ˜¯å¦æœ‰å†™å…¥æƒé™ï¼š<br />\r\n";

187 
fÜ—ch
(
$dœs
 
as
 
$curdœ
)

189 
	g$dœšfos
 .ğ
$curdœ
['name']." çŠ¶æ€ï¼š".($curdir['writeable'] ? "[âˆšæ­£å¸¸]" : "<font color='red'>[Ã—ä¸å¯å†™]</font>")."<br />\r\n";

191 
	g$dœšfos
 .= "</td></tr>\r\n";

194 
	g$dÚeSŒ
 = "<iframe‚ame='stafrm' src='sys_verifies.php?action=down&curfile=0' frameborder='0' id='stafrm' width='100%' height='100%'></iframe>\r\n";

196 
šşude
(
XAKADMIN
.'/templets/sys_verifies_getfiles.htm');

198 
ex™
();

204 if(
	g$aùiÚ
=='down')

206 
$ÿcheFes
 = 
XAKDATA
.'/modifytmp.inc';

207 
»quœe_Úû
(
$ÿcheFes
);

209 if(
	g$feCÚut
==-1 || 
$curfe
 > 
$feCÚut
)

211 
ShowMsg
("å·²ä¸‹è½½æ‰€æœ‰æ–‡ä»¶<br /><a href='sys_verifies.php?action=apply'>[ç›´æ¥æ›¿æ¢æ–‡ä»¶]</a> &nbsp; <a href='#'>[æˆ‘è‡ªå·±æ‰‹åŠ¨æ›¿æ¢æ–‡ä»¶]</a>","javascript:;");

212 
ex™
();

216 
MkTmpDœ
(
$tmpdœ
, 
$fes
[
$curfe
]);

218 
	g$downfe
 = 
$upd©eHo¡
.
$cfg_soá_Ïng
.'/sourû/'.
$fes
[
$curfe
];

220 
	g$dhd
 = 
Ãw
 
XakH‰pDown
();

221 
	g$dhd
->
O³nU¾
(
$downfe
);

222 
	g$dhd
->
SaveToBš
(
XAKDATA
.'/'.
$tmpdœ
.'/'.
$fes
[
$curfe
]);

223 
	g$dhd
->
Clo£
();

225 
ShowMsg
("æˆåŠŸä¸‹è½½æ–‡ä»¶ï¼š{$fes[$curfe]}ï¼› ç»§ç»­ä¸‹è½½ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚","sys_v”if›s.php?aùiÚ=down&curfe=".(
$curfe
+1));

226 
ex™
();

232 if(
	g$aùiÚ
=='modify')

234 if(!
is£t
(
$modifys
))

236 
ShowMsg
("æ²¡é€‰å®šè¦ä¿®æ”¹çš„æ–‡ä»¶ï¼","-1");

237 
ex™
();

241 
fÜ—ch
(
$modifys
 
as
 
$âame
)

243 if(
	g$m‘hod
=='local')

245 
$tu»F’ame
 = 
¡r_»¶aû
('../xakadmš','./',
$âame
);

246 if(
fe_exi¡s
(
$tu»F’ame
))

248 
	g$å
 = 
fİ’
(
$tu»F’ame
,'r');

249 
	g$ù
 = 
ä—d
(
$å
,
fesize
(
$tu»F’ame
));

250 
fşo£
(
$å
);

251 
	g$ùhash
 = 
md5
(
$ù
);

252 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__verifies` SET `method`='local',cthash='$cthash' WHERE filename='$fname' ");

257 
	g$dsql
->
Execu‹NÚeQu”y
("UPDATE `#@__verifies` SET `method`='offical' WHERE filename='$fname' ");

261 if(
	g$m‘hod
=='local')

263 
ShowMsg
("æˆåŠŸä¿®æ”¹æŒ‡å®šæ–‡ä»¶çš„éªŒè¯æ–¹å¼ï¼","sys_verifies.php?action=manage");

267 
ShowMsg
("æˆåŠŸä¿®æ”¹æŒ‡å®šæ–‡ä»¶çš„éªŒè¯æ–¹å¼ï¼<br /> ç”±äºä½ ä¿®æ”¹äº†æ–‡ä»¶ä¸ºè¿œç¨‹éªŒè¯æ–¹å¼ï¼Œå› æ­¤éœ€è¿›è¡Œæ›´æ–°æ“ä½œ<br /> <a href='sys_verifies.php?action=update'>[æ›´æ–°]</a> &nbsp; <a href='sys_verifies.php?action=manage'>[è¿”å›]</a>","javascript:;");

269 
ex™
();

275 ià(
	g$aùiÚ
 == 'apply')

277 
$ÿcheFes
 = 
XAKDATA
.'/modifytmp.inc';

278 
»quœe_Úû
(
$ÿcheFes
);

279 
	g$sDœ
 = 
XAKDATA
."/$tmpdir";

280 
	g$tDœ
 = 
XAKROOT
;

282 
	g$badı
 = 0;

283 
	g$admšDœ
 = 
´eg_»¶aû
("#(.*)[\/\\\\]#", "", 
dœÇme
(
__FILE__
));

285 if(
is£t
(
$fes
è&& 
is_¬¿y
($files))

287 
fÜ—ch
(
$fes
 
as
 
$f
)

289 if(
´eg_m©ch
("#^xakadmš#", 
$f
)è
	g$tf
 = 
´eg_»¶aû
("#^xakadmš#", 
$admšDœ
, $f);

290 
	g$tf
 = 
$f
;

292 if(
fe_exi¡s
(
$sDœ
.'/'.
$f
))

295 
	g$ù
 = 
fe_g‘_cÚ‹Ás
(
$sDœ
.'/'.
$f
);

296 
	g$ù
 = 
´eg_»¶aû
("/\/\*\*[\r\n]{1,}(.*)[\r\n]{1,} \*\//sU", '', 
$ù
);

297 
	g$Ãwhash
 = 
md5
(
$ù
);

298 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__verifies` WHERE filename='../{$f}' ");

299 if(
is_¬¿y
(
$row
è&& 
	g$row
['ùhash'] !ğ
$Ãwhash
)

301 
$badı
++;

303 
	g$rs
 = @
cİy
(
$sDœ
.'/'.
$f
, 
$tDœ
.'/'.
$tf
);

304 if(
	g$rs
è
uÆšk
(
$sDœ
.'/'.
$f
);

305 
	g$badı
++;

311 
	g$badmsg
 = 'ï¼';

312 if(
	g$badı
 > 0)

314 
	g$badmsg
 = "ï¼Œå…¶ {$badcp} ä¸ªæ–‡ä»¶æ•ˆéªŒç ä¸æ­£ç¡®æˆ–å¤åˆ¶å¤±è´¥ï¼Œ<br />è¯·ä»ä¸´æ—¶ç›®å½•[../config/{$tmpdir}]ä¸­å–å‡ºè¿™å‡ ä¸ªæ–‡ä»¶æ‰‹åŠ¨è¿˜åŸã€‚";

317 
ShowMsg
("æˆåŠŸå®Œæˆè¿˜åŸæŒ‡å®šæ–‡ä»¶{$badmsg}", "javascript:;");

318 
ex™
();

324 if(
	g$aùiÚ
 == 'update')

326 
$rmFe
 = 
$upd©eHo¡
.
$cfg_soá_Ïng
.'/verifys.txt';

327 
	g$dhd
 = 
Ãw
 
XakH‰pDown
();

328 
	g$dhd
->
O³nU¾
(
$rmFe
);

329 
	g$ù
 = 
$dhd
->
G‘Html
();

330 
	g$dhd
->
Clo£
();

331 
	g$ùs
 = 
¥l™
("[\r\n]{1,}",
$ù
);

332 
fÜ—ch
(
$ùs
 
as
 
$ù
)

334 
	g$ù
 = 
Œim
(
$ù
);

335 if(
em±y
(
$ù
)) ;

336 
li¡
(
$Çmeid
, 
$ùhash
, 
$âame
èğ
ex¶ode
("\t", 
$ù
);

337 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__verifies` WHERE‚ameid='$nameid' ");

338 if(!
is_¬¿y
(
$row
è|| (
	g$row
['m‘hod']=='officŸl' && $row['ùhash']!=
$ùhash
 ))

340 
$dsql
->
Execu‹NÚeQu”y
("REPLACE INTO `#@__verifies`(nameid,cthash,method,filename) VALUES ('$nameid','$cthash','official','$fname'); ");

343 
	g$å
 = 
fİ’
(
$v”if›sLockFe
,'w');

344 
fwr™e
(
$å
, 
MyD©e
('Ymd',
time
()));

345 
fşo£
(
$å
);

346 
ShowMsg
("å®Œæˆæ•ˆéªŒç æ›´æ–°ï¼Œæ˜¯å¦é©¬ä¸Šè¿›è¡Œæ•ˆéªŒæ“ä½œï¼Ÿ<br /> <a href='sys_verifies.php?action=verify'>[å¼€å§‹æ•ˆéªŒ]</a> &nbsp; <a href='sys_verifies.php?action=manage'>[ç®¡ç†]</a> &nbsp; <a href='sys_verifies.php'>[è¿”å›]</a>","javascript:;");

347 
ex™
();

353 ià(
	g$aùiÚ
 == 'make')

355 
$å
 = 
fİ’
(
XAKROOT
.'/../verifys.txt','w');

356 
fÜ—ch
 (
´eg_ls
 ('../', 
TRUE
, "/.*\.Õhp|htm|html|js)$/i", 'CVS,d©a,html,u¶ßds,‹m¶‘s,¥ecŸl'è
as
 
$Úefe
)

358 
	g$Çmeid
 = 
md5
(
$Úefe
);

359 
	g$ùbody
 = 
fe_g‘_cÚ‹Ás
(
XAKADMIN
.'/'.
$Úefe
);

360 
	g$ùbody
 = 
´eg_»¶aû
("/\/\*\*[\r\n]{1,}(.*)[\r\n]{1,} \*\//sU", '', 
$ùbody
);

361 
	g$ùhash
 = 
md5
(
$ùbody
);

362 
fwr™e
(
$å
,"{$nameid}\t{$cthash}\t{$onefile}\r\n");

364 
fşo£
(
$å
);

365 
ShowMsg
("æ“ä½œæˆåŠŸï¼","sys_verifies.php");

366 
ex™
();

370 
funùiÚ
 
´eg_ls
(
$·th
=".", 
$»c
=
FALSE
, 
$·t
="/.*/", 
$ignÜedœ
='')

372 
sub¡r
 (
$·th
,-1,1) =="/")

374 
$·th
=
sub¡r
 ($path,0,-1);

376 ià(!
is_dœ
 (
$·th
) )

378 
	g$·th
=
dœÇme
 (
$·th
);

380 ià(
	g$»c
!==
TRUE
)

382 
$»c
=
FALSE
;

384 
	g$d
=
dœ
 (
$·th
);

385 
	g$»t
=
A¼ay
 ();

386 
	gFALSE
!=ğ(
$e
=
$d
->
»ad
 () ) )

388 iàĞ(
$e
==".") || ($e=="..") )

392 ià(
	g$»c
 && 
is_dœ
 (
$·th
."/".
$e
è&& (
	g$ignÜedœ
 =ğ'' || 
¡½os
(
$ignÜedœ
,$è==ğ
FALSE
))

394 
$»t
 = 
¬¿y_m”ge
 ($»t, 
´eg_ls
(
$·th
."/".
$e
, 
$»c
, 
$·t
, 
$ignÜedœ
));

397 ià(!
´eg_m©ch
 (
$·t
, 
$e
) )

401 
	g$»t
[] = 
$·th
."/".
$e
;

403  (
em±y
 (
$»t
è&& 
´eg_m©ch
 (
$·t
,
ba£Çme
(
$·th
))è? 
A¼ay
 ($path."/") : $ret;

406 
funùiÚ
 
	$Te¡Wr™eAbË
(
$d
)

408 
$tfe
 = '_xak_test.txt';

409 
$å
 = @
	`fİ’
(
$d
.
$tfe
, 'w');

410 if(!
$å
)

412  
FALSE
;

415 
	`fşo£
(
$å
);

416 
$rs
 = @
	`uÆšk
(
$d
.'/'.
$tfe
);

417  
TRUE
;

419 
	}
}

421 
funùiÚ
 
	$G‘DœName
(
$f’ame
)

423 
$dœÇme
 = '../'.
	`´eg_»¶aû
("#[\\\\\/]{1,}#", '/', 
$f’ame
);

424 
$dœÇme
 = 
	`´eg_»¶aû
("#([^\/]*)$#", '', $dirname);

425  
$dœÇme
;

426 
	}
}

428 
funùiÚ
 
	$Te¡IsFeDœ
(
$dœÇme
)

430 
$dœs
 = 
	`¬¿y
('Çme'=>'','isdœ'=>
FALSE
,'writeable'=>FALSE);

431 
$dœs
['Çme'] = 
$dœÇme
;

432 if(
	`is_dœ
(
$dœÇme
))

434 
$dœs
['isdœ'] = 
TRUE
;

435 
$dœs
['wr™—bË'] = 
	`Te¡Wr™eAbË
(
$dœÇme
);

437  
$dœs
;

438 
	}
}

440 
funùiÚ
 
	$MkTmpDœ
(
$tmpdœ
,
$f’ame
)

442 
$ba£dœ
 = 
XAKDATA
.'/'.
$tmpdœ
;

443 
$dœÇme
 = 
	`Œim
(
	`´eg_»¶aû
("#[\\\\\/]{1,}#", '/', 
$f’ame
));

444 
$dœÇme
 = 
	`´eg_»¶aû
("#([^\/]*)$#", "", $dirname);

445 if(!
	`is_dœ
(
$ba£dœ
))

447 
	`mkdœ
(
$ba£dœ
, 0777);

449 if(
$dœÇme
=='')

451  
TRUE
;

453 
$dœs
 = 
	`ex¶ode
('/', 
$dœÇme
);

454 
$curdœ
 = 
$ba£dœ
;

455 
	`fÜ—ch
(
$dœs
 
as
 
$d
)

457 
$d
 = 
	`Œim
($d);

458 if(
	`em±y
(
$d
)) ;

459 
$curdœ
 = $curdœ.'/'.
$d
;

460 if(!
	`is_dœ
(
$curdœ
))

462 
	`mkdœ
(
$curdœ
,0777è
Ü
 
	`d›
($curdir);

465  
TRUE
;

466 
	}
}

	@E:\web\weixun\xakadmin\tag_test.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_Other');

9 
»quœe_Úû
(
XAKINC
."/typelink.class.php");

10 
šşude
 
XAKINClude
('templets/tag_test.htm');

	@E:\web\weixun\xakadmin\tag_test_action.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_Test');

9 
»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

10 if(
	$em±y
(
$·¹code
))

12 
	`ShowMsg
('é”™è¯¯è¯·æ±‚','javascript:;');

13 
ex™
;

14 
	}
}

15 
	g$·¹code
 = 
¡r¦ashes
(
$·¹code
);

17 if(
em±y
(
$ty³id
)è
	g$ty³id
 = 0;

18 if(
em±y
(
$showsourû
)è
	g$showsourû
 = "";

20 if(
	g$ty³id
>0è
	g$pv
 = 
Ãw
 
P¬tV›w
(
$ty³id
);

21 
	g$pv
 = 
Ãw
 
P¬tV›w
();

23 
	g$pv
->
S‘Tem¶‘
(
$·¹code
, "string");

24 ifĞ
	g$showsourû
 =ğ"" || 
$showsourû
 == "yes" )

26 
echo
 "æ¨¡æ¿ä»£ç :";

27 
	gecho
 "<¥ª styË='cŞÜ:»d;'><´e>".
html¥ecŸlch¬s
(
$·¹code
)."</pre></span>";

28 
	gecho
 "ç»“æœ:<hr size='1' width='100%'>";

30 
	g$pv
->
Di¥Ïy
();

	@E:\web\weixun\xakadmin\tags_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('sys_Keyword');

9 
»quœe_Úû
(
XAKINC
.'/datalistcp.class.php');

10 
	g$time¡amp
 = 
time
();

11 if(
em±y
(
$g
)è
	g$g
 = '';

13 if(
	$em±y
(
$aùiÚ
))

15 
$Üd”by
 = 
	`em±y
($Üd”byè? 'id' : 
	`´eg_»¶aû
("#[^a-z]#i", '', $orderby);

16 
$Üd”way
 = 
	`is£t
($orderway) && $orderway == 'asc' ? 'asc' : 'desc';

17 if(!
	`em±y
(
$g
)è
$wh”e
 = " whereag†ike '%$tag%'";

18 
$wh”e
 = '';

20 
$ÃwÜd”way
 = (
$Üd”way
 == 'desc' ? 'asc' : 'desc');

21 
$qu”y
 = "SELECT * FROM `#@__tagindex` $where ORDER BY $orderby $orderway";

22 
$dli¡
 = 
Ãw
 
	`D©aLi¡CP
();

23 
$g
 = 
	`¡r¦ashes
($tag);

24 
$dli¡
->
	`S‘P¬am‘”
("g", 
$g
);

25 
$dli¡
->
	`S‘P¬am‘”
("Üd”way", 
$Üd”way
);

26 
$dli¡
->
	`S‘P¬am‘”
("Üd”by", 
$Üd”by
);

27 
$dli¡
->
·geSize
 = 20;

28 
$dli¡
->
	`S‘Tem¶‘
(
XAKADMIN
."/templets/tags_main.htm");

29 
$dli¡
->
	`S‘Sourû
(
$qu”y
);

30 
$dli¡
->
	`Di¥Ïy
();

31 
	`ex™
();

32 
	}
}

36 if(
	g$aùiÚ
 == 'update')

38 
$tid
 = (
em±y
($tidè? 0 : 
štv®
($tid) );

39 if(
em±y
(
$tid
))

41 
ShowMsg
('æ²¡æœ‰é€‰æ‹©è¦åˆ é™¤çš„tag!','-1');

42 
ex™
();

44 
	g$qu”y
 = "UPDATE `#@__tagindex` SET `count`='$count' WHERE id='$tid' ";

45 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

46 
ShowMsg
("æˆåŠŸä¿å­˜æ ‡ç­¾çš„ç‚¹å‡»ä¿¡æ¯!", 'tags_main.php');

47 
ex™
();

52 if(
	g$aùiÚ
 == 'delete')

54 if(@
is_¬¿y
(
$ids
))

56 
$¡ršgids
 = 
im¶ode
(',', 
$ids
);

58 if(!
em±y
(
$ids
))

60 
	g$¡ršgids
 = 
$ids
;

64 
ShowMsg
('æ²¡æœ‰é€‰æ‹©è¦åˆ é™¤çš„tag','-1');

65 
ex™
();

67 
	g$qu”y
 = "DELETE FROM `#@__tagindex` WHERE id IN ($stringids)";

68 if(
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

70 
	g$qu”y
 = "DELETE FROM `#@__taglist` WHEREid IN ($stringids)";

71 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

72 
ShowMsg
("åˆ é™¤tags[ $stringids ]æˆåŠŸ", 'tags_main.php');

76 
ShowMsg
("åˆ é™¤tags[ $stringids ]å¤±è´¥", 'tags_main.php');

78 
ex™
();

83 if(
	g$aùiÚ
 == 'fetch')

85 
$wh”esql
 = '';

86 
	g$¡¬t
 = 
is£t
(
$¡¬t
è&& 
is_num”ic
($start) ? $start : 0;

87 
	g$wh”e
 = 
¬¿y
();

88 if(
is£t
(
$¡¬id
è&& 
is_num”ic
($¡¬idè&& 
	g$¡¬id
 > 0)

90 
	g$wh”e
[] = " id>$startaid ";

94 
	g$¡¬id
 = 0;

96 if(
is£t
(
$’daid
è&& 
is_num”ic
($’daidè&& 
	g$’daid
 > 0)

98 
	g$wh”e
[] = " id<$endaid ";

102 
	g$’daid
 = 0;

104 if(!
em±y
(
$wh”e
))

106 
	g$wh”esql
 = " WHERE‡rüªk>-1 AND ".
im¶ode
(' AND ', 
$wh”e
);

108 
	g$qu”y
 = "SELECT id‡s‡id,arcrank,typeid,keywords FROM `#@__archives` $wheresql LIMIT $start, 100";

109 
	g$dsql
->
S‘Qu”y
(
$qu”y
);

110 
	g$dsql
->
Execu‹
();

111 
	g$com¶‘e
 = 
Œue
;

112 
	g$row
 = 
$dsql
->
G‘A¼ay
())

114 
$aid
 = 
$row
['aid'];

115 
	g$ty³id
 = 
$row
['typeid'];

116 
	g$¬üªk
 = 
$row
['arcrank'];

117 
	g$row
['keywÜds'] = 
Œim
(
$row
['keywords']);

118 if(
	g$row
['keywÜds']!='' && !
´eg_m©ch
("#,#", 
$row
['keywords']))

120 
	g$key¬r
 = 
ex¶ode
(' ', 
$row
['keywords']);

124 
	g$key¬r
 = 
ex¶ode
(',', 
$row
['keywords']);

126 
fÜ—ch
(
$key¬r
 
as
 
$keywÜd
)

128 
	g$keywÜd
 = 
Œim
(
$keywÜd
);

129 if(
	g$keywÜd
 !ğ'' && 
¡¾’
(
$keywÜd
)<13 )

131 
$keywÜd
 = 
add¦ashes
($keyword);

132 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__tagindex` WHEREag LIKE '$keyword'");

133 if(
is_¬¿y
(
$row
))

135 
	g$tid
 = 
$row
['id'];

136 
	g$qu”y
 = "UPDATE `#@__tagindex` SET `total`=`total`+1 WHERE id='$tid' ";

137 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

141 
	g$qu”y
 = " INSERT INTO `#@__tagindex`(`tag`,`count`,`total`,`weekcc`,`monthcc`,`weekup`,`monthup`,`addtime`) VALUES('$keyword','0','1','0','0','$timestamp','$timestamp','$timestamp');";

142 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

143 
	g$tid
 = 
$dsql
->
G‘La¡ID
();

145 
	g$qu”y
 = "REPLACE INTO `#@__taglist`(`tid`,`aid`,`typeid`,`arcrank`,`tag`) VALUES ('$tid', '$aid', '$typeid','$arcrank','$keyword'); ";

146 
	g$dsql
->
Execu‹NÚeQu”y
(
$qu”y
);

149 
	g$com¶‘e
 = 
FALSE
;

151 if(
	g$com¶‘e
)

153 
ShowMsg
("tagsè·å–å®Œæˆ", 'tags_main.php');

154 
ex™
();

156 
	g$¡¬t
 = 
$¡¬t
 + 100;

157 
	g$gÙo
 = "tags_main.php?action=fetch&startaid=$startaid&endaid=$endaid&start=$start";

158 
ShowMsg
('ç»§ç»­è·å–g ...', 
$gÙo
, 0, 500);

159 
ex™
();

	@E:\web\weixun\xakadmin\task_do.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

8 
	g$dİo¡
 = (!
is£t
(
$dİo¡
) ? '' : $dopost);

17 
funùiÚ
 
G‘NextU¾
(
$nÙ®lowA¼
 = 
¬¿y
('dopost', 'f', 'del'))

19 
	g$»u¾
 = "task_do.php?f=0";

20 
fÜ—ch
(
$_GET
 
as
 
$k
=>
$v
)

22 if(
$k
=='nextdo')

24 
$Ãxtdo
 = '';

25 
	g$Ãxtdos
 = 
ex¶ode
(',', 
$GLOBALS
[
$k
]);

26 if(
is£t
(
$Ãxtdos
[1]))

28 
	g$i
=1; $˜< 
couÁ
(
$Ãxtdos
); $i++)

30 ifĞ
Œim
(
$Ãxtdos
[
$i
]) == '' ) ;

31 
	g$Ãxtdo
 .ğ(
$Ãxtdo
=='' ? 
$Ãxtdos
[
$i
] : ','.$nextdos[$i]);

35 ifĞ
š_¬¿y
('mÜejob', 
$nÙ®lowA¼
) )

37 
	g$»u¾
 .ğ"&dİo¡tmp=".
$Ãxtdos
[0];

38 if(
	g$Ãxtdo
 !ğ''è
$»u¾
 .= "&nextdotmp=$nextdo";

42 
	g$»u¾
 .ğ"&dİo¡=".
$Ãxtdos
[0];

43 if(
	g$Ãxtdo
 !ğ''è
$»u¾
 .= "&nextdo=$nextdo";

46 ifĞ
š_¬¿y
(
$k
, 
$nÙ®lowA¼
) )

52 
	g$»u¾
 .ğ"&{$k}=".
u¾’code
(
$GLOBALS
[
$k
]);

55  
	g$»u¾
;

61 if(
	g$dİo¡
=='makeprenext')

63 
»quœe_Úû
(
XAKINC
.'/arc.archives.class.php');

64 
	g$aid
 = 
štv®
(
$aid
);

65 
	g$´eRow
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__arctiny` WHERE id<$aid AND‡rcrank>-1 ANDypeid='$typeid' ORDER BY id DESC");

66 
	g$ÃxtRow
 = 
$dsql
->
G‘OÃ
("SELECT id FROM `#@__arctiny` WHERE id>$aid AND‡rcrank>-1 ANDypeid='$typeid' ORDER BY id ASC");

67 if(
is_¬¿y
(
$´eRow
))

69 
	g$’vs
['aid'] = 
$´eRow
['id'];

70 
	g$¬c
 = 
Ãw
 
Archives
(
$´eRow
['id']);

71 
	g$¬c
->
MakeHtml
();

73 if(
is_¬¿y
(
$ÃxtRow
))

75 
	g$’vs
['aid'] = 
$ÃxtRow
['id'];

76 
	g$¬c
 = 
Ãw
 
Archives
(
$ÃxtRow
['id']);

77 
	g$¬c
->
MakeHtml
();

79 ifĞ
em±y
(
$Ãxtdo
) )

81 
ShowMsg
("<b>å®Œæˆä¸Šä¸‹ç¯‡æ–‡æ¡£æ›´æ–°ä»»åŠ¡ï¼å®Œæˆæ‰€æœ‰æ›´æ–°ä»»åŠ¡ï¼</b>", "close::tgtable");

82 
ex™
();

86 
	g$jumpu¾
 = 
G‘NextU¾
();

87 
ShowMsg
("å®Œæˆä¸‹ç¯‡æ–‡æ¡£æ›´æ–°ä»»åŠ¡ï¼ ç»§ç»­æ‰§è¡Œå…¶å®ƒä»»åŠ¡...", 
$jumpu¾
,0,500);

88 
ex™
();

95 if(
	g$dİo¡
=='makeindex')

97 
»quœe_Úû
(
XAKINC
.'/arc.partview.class.php');

98 
	g$’vs
 = 
$_sys_glob®s
 = 
¬¿y
();

99 
	g$’vs
['aid'] = 0;

100 
	g$pv
 = 
Ãw
 
P¬tV›w
();

101 
	g$row
 = 
$pv
->
dsql
->
G‘OÃ
('SELECT * FROM `#@__homepageset`');

102 
	g$‹m¶‘
 = 
¡r_»¶aû
("{¡yË}", 
$cfg_df_¡yË
, 
$row
['templet']);

103 
	g$homeFe
 = 
dœÇme
(
__FILE__
).'/'.
$row
['position'];

104 
	g$homeFe
 = 
¡r_»¶aû
("//", "/", sŒ_»¶aû("\\", "/", 
$homeFe
));

105 
	g$å
 = 
fİ’
(
$homeFe
, 'w'è
Ü
 
d›
("æ— æ³•æ›´æ–°ç½‘ç«™ä¸»é¡µåˆ°ï¼š$homeFile ä½ç½®");

106 
fşo£
(
$å
);

107 
	g$l
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
.'/'.
$‹m¶‘
;

108 if(!
fe_exi¡s
(
$l
))

110 
	g$l
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
.'/default/index.htm';

111 if(!
fe_exi¡s
(
$l
)è
ex™
("æ— æ³•æ‰¾åˆ°ä¸»é¡µæ¨¡æ¿ï¼š$tpl ");

113 
	g$GLOBALS
['_arclistEnv'] = 'index';

114 
	g$pv
->
S‘Tem¶‘
(
$l
);

115 
	g$pv
->
SaveToHtml
(
$homeFe
);

116 
	g$pv
->
Clo£
();

117 ifĞ
em±y
(
$Ãxtdo
) )

119 
ShowMsg
("<b>å®Œæˆä¸»é¡µæ›´æ–°ä»»åŠ¡ï¼å®Œæˆæ‰€æœ‰æ›´æ–°ä»»åŠ¡ï¼</b>", "close::tgtable");

120 
ex™
();

124 
	g$jumpu¾
 = 
G‘NextU¾
();

125 
ShowMsg
("å®Œæˆä¸»é¡µæ›´æ–°ï¼ ç°åœ¨è·³è½¬åˆ°å…¶å®ƒæ›´æ–°ä»»åŠ¡...", 
$jumpu¾
,0,500);

126 
ex™
();

133 if(
	g$dİo¡
=='makeparenttype')

135 
»quœe_Úû
(
XAKDATA
."/cache/inc_catalog_base.inc");

136 
»quœe_Úû
(
XAKINC
.'/arc.listview.class.php');

137 
	g$nÙ®lowA¼
 = 
¬¿y
('dopost', 'f', 'del', 'curpage', 'morejob');

139 
	g$jumpu¾
 = 
G‘NextU¾
(
$nÙ®lowA¼
);

141 ifĞ
em±y
(
$ty³id
) )

143 
ShowMsg
("<b>å®Œæˆæ ç›®æ›´æ–°ä»»åŠ¡ï¼å®Œæˆæ‰€æœ‰æ›´æ–°ä»»åŠ¡ï¼</b>", "close::tgtable");

144 
ex™
();

146 
	g$tİids
 = 
ex¶ode
(',', 
G‘Tİids
(
$ty³id
));

147 if(
em±y
(
$cu½age
)è
	g$cu½age
 = 0;

148 
	g$tid
 = 
$tİids
[
$cu½age
];

150 if(
is£t
(
$cfg_Cs
[
$tid
]è&& 
	g$cfg_Cs
[$tid][1]>0)

152 
»quœe_Úû
(
XAKINC
."/arc.listview.class.php");

153 
	g$lv
 = 
Ãw
 
Li¡V›w
(
$tid
);

154 
	g$lv
->
MakeHtml
();

155 
	g$lv
->
Clo£
();

159 
»quœe_Úû
(
XAKINC
."/arc.sglistview.class.php");

160 
	g$lv
 = 
Ãw
 
SgLi¡V›w
(
$tid
);

161 
	g$lv
->
MakeHtml
();

162 
	g$lv
->
Clo£
();

165 if(
	g$cu½age
 >ğ
couÁ
(
$tİids
)-1)

167 ifĞ!
em±y
(
$dİo¡tmp
) )

169 
$jumpu¾
 = 
´eg_»¶aû
("#doposttmp|nextdotmp#", 'del', $jumpurl);

170 
	g$jumpu¾
 .= "&dopost={$doposttmp}&nextdo={$nextdotmp}";

171 
ShowMsg
("å®Œæˆæ ç›®:{$tid} æ›´æ–°ï¼<b¸/><b>å®Œæˆæ ç›®æ›´æ–°ä»»åŠ¡ï¼Œç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡...</b>", 
$jumpu¾
,0,500);

172 
ex™
();

176 
ShowMsg
("å®Œæˆæ ç›®:{$tid} æ›´æ–°ï¼<br /><b>å®Œæˆæ ç›®æ›´æ–°ä»»åŠ¡ï¼Œå®Œæˆæ‰€æœ‰æ›´æ–°ä»»åŠ¡ï¼</b>", "close::tgtable");

177 
ex™
();

182 
	g$cu½age
++;

183 
	g$jumpu¾
 .= "&curpage={$curpage}&dopost=makeparenttype";

184 
ShowMsg
("å®Œæˆæ ç›®:{$tid} æ›´æ–°ï¼Œç»§ç»­æ›´æ–°å…¶å®ƒæ ç›®...", 
$jumpu¾
,0,500);

185 
ex™
();

	@E:\web\weixun\xakadmin\templets_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('plus_æ–‡ä»¶ç®¡ç†å™¨');

10 if(
em±y
(
$acdœ
)è
	g$acdœ
 = 
$cfg_df_¡yË
;

11 
	g$‹m¶‘dœ
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
;

12 
	g$‹m¶‘dœd
 = 
$‹m¶‘dœ
.'/'.
$acdœ
;

13 
	g$‹m¶‘u¾d
 = 
$cfg_‹m¶‘u¾
.'/'.
$acdœ
;

15 if(
´eg_m©ch
("#\.#", 
$acdœ
))

17 
ShowMsg
('NÙ AÎow dœ '.
$acdœ
.'!', '-1');

18 
ex™
();

22 
funùiÚ
 
	$G‘InfoA¼ay
(
$f’ame
)

24 
$¬rs
 = 
	`¬¿y
();

25 
$dli¡
 = 
	`fe
(
$f’ame
);

26 
	`fÜ—ch
(
$dli¡
 
as
 
$d
)

28 
$d
 = 
	`Œim
($d);

29 if(
$d
!='')

31 
	`li¡
(
$dÇme
, 
$šfo
èğ
	`ex¶ode
(',', 
$d
);

32 
$¬rs
[
$dÇme
] = 
$šfo
;

35  
$¬rs
;

36 
	}
}

38 
	g$dœli¡s
 = 
G‘InfoA¼ay
(
$‹m¶‘dœ
.'/templet-dirlist.inc');

39 
	g$f–i¡s
 = 
G‘InfoA¼ay
(
$‹m¶‘dœ
.'/templet-filelist.inc');

40 
	g$¶u¦i¡s
 = 
G‘InfoA¼ay
(
$‹m¶‘dœ
.'/templet-pluslist.inc');

41 
	g$fešfos
 = (
$acdœ
=='moduË' ? 
$¶u¦i¡s
 : 
$f–i¡s
);

43 
šşude
 
XAKINClude
('templets/templets_default.htm');

	@E:\web\weixun\xakadmin\templets_one.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_One');

9 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

10 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

12 
	g$addqu”y
 = '';

13 
	g$keywÜd
 = (!
is£t
(
$keywÜd
) ? '' : $keyword);

14 
	g$likeid
 = (!
is£t
(
$likeid
) ? '' : $likeid);

15 
	g$addq
 = 
$likeid
!='' ? " AND†ikeid LIKE '$likeid' " : '';

16 
	g$sql
 = "SELECT‡id,title,ismake,uptime,filename,likeid FROM `#@__sgpage` WHEREitle LIKE '%$keyword%' $addq ORDER BY‡id DESC";

17 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

18 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/templets_one.htm");

19 
	g$dli¡
->
S‘Sourû
(
$sql
);

20 
	g$dli¡
->
di¥Ïy
();

22 
funùiÚ
 
	$G‘IsMake
(
$im
)

24  
$im
==1 ? 'éœ€ç¼–è¯‘' : 'ä¸ç¼–è¯‘';

25 
	}
}

	@E:\web\weixun\xakadmin\templets_one_add.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_One');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

11 if(
	g$dİo¡
=="save")

13 
»quœe_Úû
(
XAKINC
."/arc.partview.class.php");

14 
	g$u±ime
 = 
time
();

15 
	g$body
 = 
¡r_»¶aû
('&quÙ;', '\\"', 
$body
);

16 
	g$f’ame
 = 
´eg_»¶aû
("#^\/#", "", 
$nf’ame
);

17 if(
	g$likeid
=='')

19 
$likeid
 = 
$likeid£l
;

21 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT filename FROM `#@__sgpage` WHERE†ikeid='$likeid' AND filename LIKE '$filename' ");

22 if(
is_¬¿y
(
$row
))

24 
ShowMsg
("å·²ç»å­˜åœ¨ç›¸åŒçš„æ–‡ä»¶åï¼Œè¯·æ›´æ”¹ä¸ºå…¶å®ƒæ–‡ä»¶åï¼","-1");

25 
ex™
();

27 
	g$šQu”y
 = "INSERT INTO `#@__sgpage`(title,keywords,description,template,likeid,ismake,filename,uptime,body)

28 
VALUES
('$title','$keywords','$description','$template','$likeid','$ismake','$filename','$uptime','$body'); ";

29 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

31 
ShowMsg
("å¢åŠ é¡µé¢å¤±è´¥ï¼Œè¯·æ£€å†…å®¹æ˜¯å¦æœ‰é—®é¢˜ï¼","-1");

32 
ex™
();

34 
	g$id
 = 
$dsql
->
G‘La¡ID
();

35 
šşude_Úû
(
XAKINC
."/arc.sgpage.class.php");

36 
	g$sg
 = 
Ãw
 
sg·ge
(
$id
);

37 
	g$sg
->
SaveToHtml
();

38 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ä¸ªé¡µé¢ï¼","templets_one.php");

39 
ex™
();

41 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT MAX(aid) AS‡id FROM `#@__sgpage` ");

42 
	g$nowid
 = 
is_¬¿y
(
$row
) ? $row['aid']+1 : '';

43 
šşude_Úû
(
XAKADMIN
."/templets/templets_one_add.htm");

	@E:\web\weixun\xakadmin\templets_one_edit.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('temp_One');

9 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

11 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

12 if(
	g$dİo¡
=="saveedit")

14 
šşude_Úû
(
XAKINC
."/arc.sgpage.class.php");

15 
	g$u±ime
 = 
time
();

16 
	g$body
 = 
¡r_»¶aû
('&quÙ;', '\\"', 
$body
);

17 
	g$f’ame
 = 
´eg_»¶aû
("#^\/#", "", 
$nf’ame
);

20 if(
	g$Şdf’ame
!=
$f’ame
)

22 
$Şdf’ame
 = 
$cfg_ba£dœ
.
$cfg_cm¥©h
."/".$oldfilename;

23 if(
is_fe
(
$Şdf’ame
))

25 
uÆšk
(
$Şdf’ame
);

28 if(
	g$likeid£l
!=
$Şdlikeid
 )

30 
$likeid
 = 
$likeid£l
;

32 
	g$šQu”y
 = "

33 
UPDATE
 `#@
__sg·ge
` 
SET


34 
t™Ë
='$title',

35 
	gkeywÜds
='$keywords',

36 
	gdesütiÚ
='$description',

37 
	glikeid
='$likeid',

38 
	gismake
='$ismake',

39 
	gf’ame
='$filename',

40 
	g‹m¶©e
='$template',

41 
	gu±ime
='$uptime',

42 
	gbody
='$body'

43 
WHERE
 
aid
='$aid'; ";

44 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

46 
ShowMsg
("æ›´æ–°é¡µé¢æ•°æ®æ—¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥é•¿ç›¸æ˜¯å¦æœ‰é—®é¢˜ï¼","-1");

47 
ex™
();

49 
	g$sg
 = 
Ãw
 
sg·ge
(
$aid
);

50 
	g$sg
->
SaveToHtml
();

51 
ShowMsg
("æˆåŠŸä¿®æ”¹ä¸€ä¸ªé¡µé¢ï¼", "templets_one.php");

52 
ex™
();

54 if(
	g$dİo¡
=="delete")

56 
$row
 = 
$dsql
->
G‘OÃ
("SELECT filename FROM `#@__sgpage` WHERE‡id='$aid'");

57 
	g$f’ame
 = 
´eg_»¶aû
("#\/{1,}#", "/", 
$cfg_ba£dœ
.
$cfg_cm¥©h
."/".
$row
['filename']);

58 
	g$dsql
->
Execu‹NÚeQu”y
(" DELETE FROM `#@__sgpage` WHERE‡id='$aid' ");

59 if(
is_fe
(
$f’ame
))

61 
uÆšk
(
$f’ame
);

63 
ShowMsg
("æˆåŠŸåˆ é™¤ä¸€ä¸ªé¡µé¢ï¼", "templets_one.php");

64 
ex™
();

66 if(
	g$dİo¡
=="make")

68 
šşude_Úû
(
XAKINC
."/arc.sgpage.class.php");

69 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT filename FROM `#@__sgpage` WHERE‡id='$aid'");

70 
	g$feu¾
 = 
$cfg_cmsu¾
.'/'.
´eg_»¶aû
("#\/{1,}#", "/", 
$row
['filename']);

71 
	g$sg
 = 
Ãw
 
sg·ge
(
$aid
);

72 
	g$sg
->
SaveToHtml
();

73 
ShowMsg
("æˆåŠŸæ›´æ–°ä¸€ä¸ªé¡µé¢ï¼", 
$feu¾
);

74 
ex™
();

76 if(
	g$dİo¡
=="mkall")

78 
šşude_Úû
(
XAKINC
."/arc.sgpage.class.php");

79 
	g$dsql
->
Execu‹
("ex","SELECT‡id FROM `#@__sgpage` ");

80 
	g$i
 = 0;

81 
	g$row
 = 
$dsql
->
G‘A¼ay
("ex"))

83 
$sg
 = 
Ãw
 
sg·ge
(
$row
['aid']);

84 
	g$sg
->
SaveToHtml
();

85 
	g$i
++;

87 
ShowMsg
("æˆåŠŸæ›´æ–° $i ä¸ªé¡µé¢ï¼", '-1');

88 
ex™
();

90 if(
	g$dİo¡
=="mksel")

92 if(
em±y
(
$ids
))

94 
$ids
 = '';

96 
šşude_Úû
(
XAKINC
."/arc.sgpage.class.php");

97 
	g$i
 = 0;

98 if(
	g$ids
 == 0)

100 
ShowMsg
('æ‚¨æ²¡æœ‰é€‰æ‹©éœ€è¦æ›´æ–°çš„æ–‡æ¡£ï¼','-1');

101 
ex™
();

103 if(
is_¬¿y
(
$ids
))

105 
fÜ—ch
(
$ids
 
as
 
$aid
)

107 
	g$sg
 = 
Ãw
 
sg·ge
(
$aid
);

108 
	g$sg
->
SaveToHtml
();

109 
	g$i
++;

111 
ShowMsg
("æˆåŠŸæ›´æ–° $i ä¸ªé¡µé¢ï¼",'-1');

112 
ex™
();

115 if(
	g$dİo¡
=="view")

117 if(
em±y
(
$aid
))

119 
ShowMsg
('é”™è¯¯çš„IDï¼','javascript:;');

120 
ex™
();

122 
šşude_Úû
(
XAKINC
."/arc.sgpage.class.php");

123 
	g$sg
 = 
Ãw
 
sg·ge
(
$aid
);

124 
	g$sg
->
di¥Ïy
();

125 
ex™
();

127 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM `#@__sgpage` WHERE‡id='$aid' ");

128 
šşude
(
XAKADMIN
."/templets/templets_one_edit.htm");

	@E:\web\weixun\xakadmin\templets_tagsource.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/config.php');

8 
CheckPurv›w
('plus_æ–‡ä»¶ç®¡ç†å™¨');

10 
	g$libdœ
 = 
XAKINC
.'/taglib';

11 
	g$h–pdœ
 = 
XAKINC
.'/taglib/help';

14 
funùiÚ
 
	$G‘H–pInfo
(
$gÇme
)

16 
glob®
 
$h–pdœ
;

17 
$h–pfe
 = 
$h–pdœ
.'/'.
$gÇme
.'.txt';

18 if(!
	`fe_exi¡s
(
$h–pfe
))

22 
$å
 = 
	`fİ’
(
$h–pfe
,'r');

23 
$h–pšfo
 = 
	`fg‘s
(
$å
,64);

24 
	`fşo£
(
$å
);

25  
$h–pšfo
;

26 
	}
}

28 
šşude
 
XAKINClude
('templets/templets_tagsource.htm');

	@E:\web\weixun\xakadmin\testenv.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('sys_Edit');

9 if(
em±y
(
$aùiÚ
)è
	g$aùiÚ
 = '';

11 
	g$ÃedDœ
 = "$cfg_medias_dir|

12 
$cfg_image_dœ
|

13 
$ddcfg_image_dœ
|

14 
$cfg_u£r_dœ
|

15 
$cfg_soá_dœ
|

16 
$cfg_Ùh”_medŸs
|

17 
$cfg_medŸs_dœ
/
æšk
|

18 
$cfg_cm¥©h
/
cÚfig
|

19 
$cfg_cm¥©h
/
cÚfig
/
$cfg_backup_dœ
|

20 
$cfg_cm¥©h
/
cÚfig
/
‹xtd©a
|

21 
$cfg_cm¥©h
/
cÚfig
/
£ssiÚs
|

22 
$cfg_cm¥©h
/
cÚfig
/
lÿche
|

23 
$cfg_cm¥©h
/
cÚfig
/
admš
|

24 
$cfg_cm¥©h
/
cÚfig
/
’ums
|

25 
$cfg_cm¥©h
/
cÚfig
/
m¬k
|

26 
$cfg_cm¥©h
/
cÚfig
/
moduË
|

27 
$cfg_cm¥©h
/
cÚfig
/
rss
";

29 <
html
>

30 <
h—d
>

31 <
m‘a
 
h‰p
-
equiv
='CÚ‹Á-Ty³' 
cÚ‹Á
='text/html; charset=utf-8'>

32 <
t™Ë
>ç³»ç»Ÿç›®å½•æƒé™æ£€æµ‹ä¸ä¿®æ­£</title>

33 <
lšk
 
h»f
='css/ba£.css' 
»l
='¡yËsh“t' 
ty³
='text/css'>

34 </
h—d
>

35 <
body
 
background
='images/®lbg.gif' 
Ëám¬gš
='8' 
tİm¬gš
='8'>

36 <
bË
 
width
="98%" 
bÜd”
="0" 
®ign
="ûÁ”" 
ûÎ·ddšg
="3" 
ûÎ¥acšg
="1" 
bgcŞÜ
="#cfcfcf">

37 <
Œ
>

38 <
td
 
height
="28" 
background
="images/tbg.gif" 
¡yË
="padding-left:10px;">

39 <
b
>ç³»ç»Ÿç›®å½•æƒé™æ£€æµ‹ä¸ä¿®æ­£</b>

40 </
td
>

41 </
Œ
>

42 <
Œ
>

43 <
td
 
bgcŞÜ
="#FFFFFF" 
v®ign
="tİ" 
¡yË
="padding:5px;">

44 <?
php


45 
echo
 '<m‘¨h‰p-equiv="CÚ‹Á-Ty³" cÚ‹Á="‹xt/html; ch¬£t='.
$cfg_soá_Ïng
.'">';

46 if((
	g$isSaãMode
 || 
	g$cfg_áp_mkdœ
=='Y'è&& 
$cfg_áp_ho¡
=='')

48 
echo
 "ç”±äºä½ çš„ç«™ç‚¹çš„PHPé…ç½®å­˜åœ¨é™åˆ¶ï¼Œç¨‹åºåªèƒ½é€šè¿‡FTPå½¢å¼è¿›è¡Œç›®å½•æ“ä½œï¼Œå› æ­¤ä½ å¿…é¡»åœ¨åå°æŒ‡å®šFTPç›¸å…³çš„å˜é‡ï¼<br>";

49 
	gecho
 "<a href='sys_info.php'>&lt;&lt;ä¿®æ”¹ç³»ç»Ÿå‚æ•°&gt;&gt;</a>";

50 
ex™
();

52 if(
	g$aùiÚ
=='')

54 
echo
 "æœ¬ç¨‹åºå°†æ£€æµ‹ä¸‹åˆ—ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæˆ–è€…æ˜¯å¦å…·æœ‰å†™å…¥çš„æƒé™ï¼Œå¹¶å°è¯•åˆ›å»ºæˆ–æ›´æ”¹ï¼š<br>";

55 
	gecho
 "ï¼ˆå¦‚æœæ‚¨çš„ä¸»æœºä½¿ç”¨çš„æ˜¯windowsç³»ç»Ÿï¼Œæ‚¨æ— éœ€è¿›è¡Œæ­¤æ“ä½œï¼‰";

56 
	gecho
 "<´e>".
¡r_»¶aû
('|','',
$ÃedDœ
)."</pre>";

57 
	gecho
 "</td></tr>\r\n<tr><td bgcolor='#F9FCFD' height='32px' style='padding-left:20px'>\r\n<a href='testenv.php?action=ok' class='np coolbg'>&lt;&lt;å¼€å§‹æ£€æµ‹&gt;&gt;</a> &nbsp; <a href='index_body.php' class='np coolbg'>&lt;&lt;è¿”å›ä¸»é¡µ&gt;&gt;</a>";

61 
	g$ÃedDœs
 = 
ex¶ode
('|', 
$ÃedDœ
);

62 
	g$ÃedDœ
 = '';

63 
fÜ—ch
(
$ÃedDœs
 
as
 
$ÃedDœ
)

65 
	g$ÃedDœ
 = 
Œim
(
$ÃedDœ
);

66 
	g$ÃedDœ
 = 
¡r_»¶aû
("\\","/",
$ÃedDœ
);

67 
	g$ÃedDœ
 = 
´eg_»¶aû
("#\/{1,}#", "/", 
$ÃedDœ
);

68 if(
C»©eDœ
(
$ÃedDœ
))

70 
	gecho
 "æˆåŠŸæ›´æ”¹æˆ–åˆ›å»ºï¼š{$needDir} <br>";

74 
	gecho
 "æ›´æ”¹æˆ–åˆ›å»ºç›®å½•ï¼š{$needDir} <font color='red'>å¤±è´¥ï¼</font> <br>";

77 
	gecho
 "<br>å¦‚æœå‘ç°æ›´æ”¹æˆ–åˆ›å»ºé”™è¯¯çš„é¡¹ç›®ï¼Œè¯·<¨h»f='‹¡’v.php?aùiÚ=ok&¶ay=".
time
()."'><u>é‡è¯•</u></a>æˆ–æ‰‹åŠ¨ç™»é™†åˆ°FTPæ›´æ”¹ç›¸å…³ç›®å½•çš„æƒé™ä¸º777æˆ–666<br>";

78 
	gecho
 "</td></tr>\r\n<tr><td bgcolor='#F9FCFD' height='32px' style='padding-left:20px'>\r\n<a href='index_body.php' class='np coolbg'>&lt;&lt;è¿”å›ä¸»é¡µ&gt;&gt;</a>";

79 
Clo£F
();

82 </
	gtd
>

83 </
	gŒ
>

84 </
	gbË
>

85 </
	gbody
>

86 </
	ghtml
>

	@E:\web\weixun\xakadmin\tpl.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_æ–‡ä»¶ç®¡ç†å™¨');

10 
	g$aùiÚ
 = 
is£t
(
$aùiÚ
è? 
	$Œim
(
$aùiÚ
) : '';

12 if(
	`em±y
(
$acdœ
)è$acdœ = 
$cfg_df_¡yË
;

13 
$‹m¶‘dœ
 = 
$cfg_ba£dœ
.
$cfg_‹m¶‘s_dœ
;

14 
$‹m¶‘dœd
 = 
$‹m¶‘dœ
.'/'.
$acdœ
;

15 
$‹m¶‘u¾d
 = 
$cfg_‹m¶‘u¾
.'/'.
$acdœ
;

16 if(
	`em±y
(
$f’ame
)) $filename = '';

17 
$f’ame
 = 
	`´eg_»¶aû
("#[\/\\\\]#", '', $filename);

18 if(
	`´eg_m©ch
("#\.#", 
$acdœ
))

20 
	`ShowMsg
('NÙ AÎow dœ '.
$acdœ
.'!','-1');

21 
	`ex™
();

22 
	}
}

27 if(
	g$aùiÚ
 =ğ'ed™' || 
$aùiÚ
 == 'newfile')

29 if(
$f’ame
 =ğ'' && 
$aùiÚ
 == 'edit')

31 
ShowMsg
('æœªæŒ‡å®šè¦ç¼–è¾‘çš„æ–‡ä»¶', '-1');

32 
ex™
();

34 if(!
fe_exi¡s
(
$‹m¶‘dœd
.'/'.
$f’ame
è&& 
	g$aùiÚ
 == 'edit')

36 
$aùiÚ
 = 'newfile';

41 if(
	g$aùiÚ
 == 'edit')

43 
$å
 = 
fİ’
(
$‹m¶‘dœd
.'/'.
$f’ame
, 'r');

44 
	g$cÚ‹Á
 = 
ä—d
(
$å
, 
fesize
(
$‹m¶‘dœd
.'/'.
$f’ame
));

45 
fşo£
(
$å
);

46 
	g$cÚ‹Á
 = 
´eg_»¶aû
("#<‹x»a#i", "##‹x»a", 
$cÚ‹Á
);

47 
	g$cÚ‹Á
 = 
´eg_»¶aû
("#</‹x»a#i", "##/‹x»a", 
$cÚ‹Á
);

48 
	g$cÚ‹Á
 = 
´eg_»¶aû
("#<fÜm#i", "##fÜm", 
$cÚ‹Á
);

49 
	g$cÚ‹Á
 = 
´eg_»¶aû
("#</fÜm#i", "##/fÜm", 
$cÚ‹Á
);

53 if(
em±y
(
$f’ame
)è
	g$f’ame
 = 'newtpl.htm';

54 
	g$cÚ‹Á
 = '';

58 
	g$h–ps
 = 
$dgs
 = 
¬¿y
();

59 
	g$gH–pDœ
 = 
XAKINC
.'/taglib/help/';

60 
	g$dœ
 = 
dœ
(
$gH–pDœ
);

61 
	gçl£
 !=ğ(
$’Œy
 = 
$dœ
->
»ad
()))

63 if(
$’Œy
 !ğ'.' && $’Œy !ğ'..' && !
is_dœ
(
$gH–pDœ
.$entry))

65 
$dgs
[] = 
¡r_»¶aû
('.txt', '', 
$’Œy
);

68 
	g$dœ
->
şo£
();

69 
fÜ—ch
(
$dgs
 
as
 
$g
)

72 
	g$å
 = 
fİ’
(
$gH–pDœ
.
$g
.'.txt','r');

73 
	g$h–pCÚ‹Á
 = 
ä—d
(
$å
,
fesize
(
$gH–pDœ
.
$g
.'.txt'));

74 
fşo£
(
$å
);

75 
	g$h–ps
[
$g
] = 
ex¶ode
('>>xak>>', 
$h–pCÚ‹Á
);

78 
šşude
 
	gXAKADMIN
.'/templets/tpl_edit.htm';

79 
ex™
();

85 if(
	g$aùiÚ
 == 'saveedit')

87 if(
$f’ame
 == '')

89 
ShowMsg
('æœªæŒ‡å®šè¦ç¼–è¾‘çš„æ–‡ä»¶æˆ–æ–‡ä»¶åä¸åˆæ³•', '-1');

90 
ex™
();

92 if(!
´eg_m©ch
("#\.htm$#", 
$f’ame
))

94 
ShowMsg
('æ¨¡æ¿æ–‡ä»¶ï¼Œæ–‡ä»¶åå¿…é¡»ç”¨.htmç»“å°¾ï¼', '-1');

95 
ex™
();

97 
	g$cÚ‹Á
 = 
¡r¦ashes
(
$cÚ‹Á
);

98 
	g$cÚ‹Á
 = 
´eg_»¶aû
("/##‹x»a/i", "<‹x»a", 
$cÚ‹Á
);

99 
	g$cÚ‹Á
 = 
´eg_»¶aû
("/##\/‹x»a/i", "</‹x»a", 
$cÚ‹Á
);

100 
	g$cÚ‹Á
 = 
´eg_»¶aû
("/##fÜm/i", "<fÜm", 
$cÚ‹Á
);

101 
	g$cÚ‹Á
 = 
´eg_»¶aû
("/##\/fÜm/i", "</fÜm", 
$cÚ‹Á
);

102 
	g$Œuefe
 = 
$‹m¶‘dœd
.'/'.
$f’ame
;

103 
	g$å
 = 
fİ’
(
$Œuefe
, 'w');

104 
fwr™e
(
$å
, 
$cÚ‹Á
);

105 
fşo£
(
$å
);

106 
ShowMsg
('æˆåŠŸä¿®æ”¹æˆ–æ–°å»ºæ–‡ä»¶', '‹m¶‘s_maš.php?acdœ='.
$acdœ
);

107 
ex™
();

113 ià(
	g$aùiÚ
 == 'del')

115 
$Œuefe
 = 
$‹m¶‘dœd
.'/'.
$f’ame
;

116 if(
uÆšk
(
$Œuefe
))

118 
ShowMsg
('åˆ é™¤æ–‡ä»¶æˆåŠŸ','‹m¶‘s_maš.php?acdœ='.
$acdœ
);

119 
ex™
();

123 
ShowMsg
('åˆ é™¤æ–‡ä»¶å¤±è´¥','-1');

124 
ex™
();

131 ià(
	g$aùiÚ
 == 'upload')

133 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/../functions/oxwindow.class.php');

134 
	g$acdœ
 = 
¡r_»¶aû
('.', '', 
$acdœ
);

135 
	g$wš
 = 
Ãw
 
OxWšdow
();

136 
	g$wš
->
In™
("tpl.php","js/blank.js","POST'ƒnctype='multipart/form-data' ");

137 
	g$wš
->
	gmašT™Ë
 = "æ¨¡å—ç®¡ç†";

138 
	g$wecome_šfo
 = "<a href='templets_main.php'>æ¨¡æ¿ç®¡ç†</a> &gt;&gt; ä¸Šä¼ æ¨¡æ¿";

139 
	g$wš
->
AddT™Ë
('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶:');

140 
	g$wš
->
AddHidd’
("action",'uploadok');

141 
	g$msg
 = "

142 <
bË
 
width
='600' 
bÜd”
='0' 
ûÎ¥acšg
='0' 
ûÎ·ddšg
='0'>

143 <
Œ
>

144 <
td
 
width
='96' 
height
='60'>è¯·é€‰æ‹©æ–‡ä»¶ï¼š</td>

145 <
td
 
width
='504'>

146 <
šput
 
Çme
='acdœ' 
ty³
='hidd’' 
v®ue
='$acdir' />

147 <
šput
 
Çme
='upfe' 
ty³
='fe' 
id
='upfe' 
¡yË
='width:380px' />

148 </
td
>

149 </
Œ
>

150 </
bË
>

152 
$wš
->
AddMsgI‹m
("<div style='padding-left:20px;line-height:150%'>$msg</div>");

153 
	g$wšfÜm
 = 
$wš
->
G‘Wšdow
('ok','');

154 
	g$wš
->
Di¥Ïy
();

155 
ex™
();

161 ià(
	g$aùiÚ
 == 'uploadok')

163 ifĞ!
is_u¶ßded_fe
(
$upfe
) )

165 
ShowMsg
("è²Œä¼¼ä½ ä»€ä¹ˆéƒ½æ²¡æœ‰ä¸Šä¼ å“¦ï¼","javascript:;");

166 
ex™
();

170 ifĞ!
´eg_m©ch
("#\.(htm|html)$#", 
$upfe_Çme
) )

172 
ShowMsg
("æ¨¡æ¿åªèƒ½ç”¨ .htm æˆ– .htmlæ‰©å±•åï¼", "-1");

173 
ex™
();

175 ifĞ
´eg_m©ch
("#[\\\\\/]#", 
$upfe_Çme
) )

177 
ShowMsg
("æ¨¡æ¿æ–‡ä»¶åæœ‰éæ³•å­—ç¬¦ï¼Œç¦æ­¢ä¸Šä¼ ï¼", "-1");

178 
ex™
();

180 
move_u¶ßded_fe
(
$upfe
, 
$‹m¶‘dœd
.'/'.
$upfe_Çme
);

181 @
uÆšk
(
$upfe
);

182 
ShowMsg
("æˆåŠŸä¸Šä¼ ä¸€ä¸ªæ¨¡æ¿ï¼","templets_main.php?acdir=$acdir");

183 
ex™
();

185 
ex™
();

191 if(
	g$aùiÚ
=='ed™g' || 
$aùiÚ
=='addnewtag')

193 if(
$aùiÚ
=='addnewtag')

195 
$democode
 = '<'."?php

196 if(!
defšed
('XAKINC'))

198 
ex™
(\"Warning...\");

200 
funùiÚ
 
lib_demÙag
(&\
$ùag
,&\
$»fObj
)

202 
glob®
 \
$dsql
,\
$’vs
;

205 \
$©i¡
=\"row|12,titlelen|24\";

206 
FlA‰sDeçuÉ
(\
$ùag
->
CA‰ribu‹
->
I‹ms
,\
$©i¡
);

207 
exŒaù
(\
$ùag
->
CA‰ribu‹
->
I‹ms
, 
EXTR_SKIP
);

208 \
$»v®ue
 = '';

213 \
$»v®ue
 = 'Hello Word!';

216  \
$»v®ue
;

219 
$f’ame
 = "demotag.lib.php";

220 
$t™Ë
 = "æ–°å»ºæ ‡ç­¾";

224 if(!
´eg_m©ch
("#^[a-z0-9_-]{1,}\.lib\.php$#i", 
$f’ame
))

226 
ShowMsg
('æ–‡ä»¶ä¸æ˜¯æ ‡å‡†çš„æ ‡ç­¾ç¢ç‰‡æ–‡ä»¶ï¼Œä¸å…è®¸åœ¨æ­¤ç¼–è¾‘ï¼','-1');

227 
ex™
();

229 
$å
 = 
fİ’
(
XAKINC
.'/glib/'.
$f’ame
,'r');

230 
$democode
 = 
ä—d
(
$å
, 
fesize
(
XAKINC
.'/glib/'.
$f’ame
));

231 
fşo£
(
$å
);

232 
$t™Ë
 = "ä¿®æ”¹æ ‡ç­¾";

234 
šşude
 
XAKADMIN
.'/templets/tpl_edit_tag.htm';

235 
ex™
();

241 if(
$aùiÚ
=='savetagfile')

243 if(!
´eg_m©ch
("#^[a-z0-9_-]{1,}\.lib\.php$#i", 
$f’ame
))

245 
ShowMsg
('æ–‡ä»¶åä¸åˆæ³•ï¼Œä¸å…è®¸è¿›è¡Œæ“ä½œï¼', '-1');

246 
ex™
();

248 
»quœe_Úû
(
XAKINC
.'/oxwindow.class.php');

249 
$gÇme
 = 
´eg_»¶aû
("#\.lib\.php$#i", "", 
$f’ame
);

250 
$cÚ‹Á
 = 
¡r¦ashes
($content);

251 
$Œuefe
 = 
XAKINC
.'/glib/'.
$f’ame
;

252 
$å
 = 
fİ’
(
$Œuefe
, 'w');

253 
fwr™e
(
$å
, 
$cÚ‹Á
);

254 
fşo£
(
$å
);

255 
$msg
 = "

256 <
fÜm
 
Çme
='fÜm1' 
aùiÚ
='g_‹¡_aùiÚ.php' 
rg‘
='bÏnk' 
m‘hod
='post'>

257 <
šput
 
ty³
='hidd’' 
Çme
='dİo¡' 
v®ue
='make' />

258 <
b
>æµ‹è¯•æ ‡ç­¾ï¼š</b>(éœ€è¦ä½¿ç”¨ç¯å¢ƒå˜é‡çš„ä¸èƒ½åœ¨æ­¤æµ‹è¯•)<
br
/>

259 <
‹x»a
 
Çme
='·¹code' 
cŞs
='150' 
rows
='6' 
¡yË
='width:90%;'>{
xak
:{
$gÇme
} }{/xak:{$gÇme}}</‹x»a><
br
 />

260 <
šput
 
Çme
='imageF›ld1' 
ty³
='image' 
şass
='Å' 
¤c
='images/bu‰Ú_ok.gif' 
width
='60' 
height
='22' 
bÜd”
='0' />

261 </
fÜm
>

263 
$wšt™Ë
 = "æˆåŠŸä¿®æ”¹/åˆ›å»ºæ–‡ä»¶ï¼";

264 
$wecome_šfo
 = "<a href='templets_tagsource.php'>æ ‡ç­¾æºç ç¢ç‰‡ç®¡ç†</a> &gt;&gt; ä¿®æ”¹/æ–°å»ºæ ‡ç­¾";

265 
$wš
 = 
Ãw
 
OxWšdow
();

266 
$wš
->
AddT™Ë
("ä¿®æ”¹/æ–°å»ºæ ‡ç­¾ï¼š");

267 
$wš
->
AddMsgI‹m
(
$msg
);

268 
$wšfÜm
 = 
$wš
->
G‘Wšdow
("hªd","&nb¥;",
çl£
);

269 
$wš
->
Di¥Ïy
();

270 
ex™
();

	@E:\web\weixun\xakadmin\update_guide.php

1 <?
php


8 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

9 
CheckPurv›w
('sys_Edit');

10 @
£t_time_lim™
(0);

11 
»quœe
(
XAKINC
.'/inc/inc_fun_funAdmin.php');

12 
»quœe
(
XAKINC
.'/xakhttpdown.class.php');

14 
funùiÚ
 
	$Te¡Wr™eAbË
(
$d
)

16 
$tfe
 = '_xak_test.txt';

17 
$å
 = @
	`fİ’
(
$d
.
$tfe
,'w');

18 if(!
$å
) {

19  
çl£
;

22 
	`fşo£
(
$å
);

23 
$rs
 = @
	`uÆšk
(
$d
.'/'.
$tfe
);

24  
Œue
;

26 
	}
}

28 
funùiÚ
 
	$G‘DœName
(
$f’ame
)

30 
$dœÇme
 = '../'.
	`´eg_»¶aû
("#[\\\\\/]{1,}#", '/', 
$f’ame
);

31 
$dœÇme
 = 
	`´eg_»¶aû
("#([^\/]*)$#", '', $dirname);

32  
$dœÇme
;

33 
	}
}

35 
funùiÚ
 
	$Te¡IsFeDœ
(
$dœÇme
)

37 
$dœs
 = 
	`¬¿y
('Çme'=>'', 'isdœ'=>
FALSE
, 'writeable'=>FALSE);

38 
$dœs
['Çme'] = 
$dœÇme
;

39 if(
	`is_dœ
(
$dœÇme
))

41 
$dœs
['isdœ'] = 
TRUE
;

42 
$dœs
['wr™—bË'] = 
	`Te¡Wr™eAbË
(
$dœÇme
);

44  
$dœs
;

45 
	}
}

47 
funùiÚ
 
	$MkTmpDœ
(
$tmpdœ
,
$f’ame
)

49 
$ba£dœ
 = 
XAKDATA
.'/'.
$tmpdœ
;

50 
$dœÇme
 = 
	`Œim
(
	`´eg_»¶aû
("#[\\\\\/]{1,}#", '/', 
$f’ame
));

51 
$dœÇme
 = 
	`´eg_»¶aû
("#([^\/]*)$#","",$dirname);

52 if(!
	`is_dœ
(
$ba£dœ
))

54 
	`mkdœ
(
$ba£dœ
,0777);

56 if(
$dœÇme
=='')

58  
TRUE
;

60 
$dœs
 = 
	`ex¶ode
('/', 
$dœÇme
);

61 
$curdœ
 = 
$ba£dœ
;

62 
	`fÜ—ch
(
$dœs
 
as
 
$d
)

64 
$d
 = 
	`Œim
($d);

65 if(
	`em±y
(
$d
)) ;

66 
$curdœ
 = $curdœ.'/'.
$d
;

67 if(!
	`is_dœ
(
$curdœ
))

69 
	`mkdœ
(
$curdœ
, 0777è
Ü
 
	`d›
($curdir);

72  
TRUE
;

73 
	}
}

75 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = 'test';

78 
	g$v”LockFe
 = 
XAKDATA
.'/admin/ver.txt';

80 
	g$å
 = 
fİ’
(
$v”LockFe
,'r');

81 
	g$upTime
 = 
Œim
(
ä—d
(
$å
,64));

82 
fşo£
(
$å
);

83 
	g$oktime
 = 
sub¡r
(
$upTime
,0,4).'-'.substr($upTime,4,2).'-'.substr($upTime,6,2);

89 if(
	g$dİo¡
=='test')

91 
AjaxH—d
();

93 
	g$dhd
 = 
Ãw
 
XakH‰pDown
();

94 
	g$dhd
->
O³nU¾
(
$upd©eHo¡
.'/verinfo.txt');

95 
	g$v”li¡
 = 
Œim
(
$dhd
->
G‘Html
());

96 
	g$dhd
->
Clo£
();

97 if(
	g$cfg_soá_Ïng
=='utf-8')

99 
$v”li¡
 = 
gb2utf8
($verlist);

101 
	g$v”li¡
 = 
´eg_»¶aû
("#[\r\n]{1,}#", "\n", 
$v”li¡
);

102 
	g$v”li¡s
 = 
ex¶ode
("\n", 
$v”li¡
);

105 
	g$upd©eV”s
 = 
¬¿y
();

106 
	g$up™ems
 = 
$Ï¡Time
 = '';

107 
	g$n
 = 0;

108 
fÜ—ch
(
$v”li¡s
 
as
 
$v”¡r
)

110 ifĞ
em±y
(
$v”¡r
è|| 
´eg_m©ch
("#^\/\/#", $verstr) )

114 
li¡
(
$vtime
, 
$vÏng
, 
$is§ã
, 
$vmsg
èğ
ex¶ode
(',', 
$v”¡r
);

115 
	g$vtime
 = 
Œim
(
$vtime
);

116 
	g$vÏng
 = 
Œim
(
$vÏng
);

117 
	g$is§ã
 = 
Œim
(
$is§ã
);

118 
	g$vmsg
 = 
Œim
(
$vmsg
);

119 if(
	g$vtime
 > 
	g$upTime
 && 
	g$vÏng
==
$cfg_soá_Ïng
)

121 
$upd©eV”s
[
$n
]['is§ã'] = 
$is§ã
;

122 
	g$upd©eV”s
[
$n
]['vmsg'] = 
$vmsg
;

123 
	g$up™ems
 .ğ(
$up™ems
=='' ? 
$vtime
 : ','.$vtime);

124 
	g$Ï¡Time
 = 
$vtime
;

125 
	g$upd©eV”s
[
$n
]['vtime'] = 
sub¡r
(
$vtime
,0,4).'-'.substr($vtime,4,2).'-'.substr($vtime,6,2);

126 
	g$n
++;

132 if(
	g$n
==0)

134 
$offU¾
 = 
SpG‘NewInfo
();

135 
	gecho
 "<div class='updatedvt'><b>ä½ ç³»ç»Ÿç‰ˆæœ¬æœ€åæ›´æ–°æ—¶é—´ä¸ºï¼š{$oktime}ï¼Œå½“å‰æ²¡æœ‰å¯ç”¨çš„æ›´æ–°</b></div>\r\n";

136 
	gecho
 "<iframe‚ame='stafrm' src='{$offUrl}&uptime={$oktime}' frameborder='0' id='stafrm' width='100%' height='50'></iframe>";

140 
	gecho
 "<div style='width:98%'><form‚ame='fup'‡ction='update_guide.php' method='post' onsubmit='ShowWaitDiv()'>\r\n";

141 
	gecho
 "<inputype='hidden'‚ame='dopost' value='getlist' />\r\n";

142 
	gecho
 "<inputype='hidden'‚ame='vtime' value='$lastTime' />\r\n";

143 
	gecho
 "<inputype='hidden'‚ame='upitems' value='$upitems' />\r\n";

144 
	gecho
 "<div class='upinfotitle'>ä½ ç³»ç»Ÿç‰ˆæœ¬æœ€åæ›´æ–°æ—¶é—´ä¸ºï¼š{$oktime}ï¼Œå½“å‰å¯ç”¨çš„æ›´æ–°æœ‰ï¼š</div>\r\n";

145 
fÜ—ch
(
$upd©eV”s
 
as
 
$v”s
)

147 
	g$¡yË
 = '';

148 if(
	g$v”s
['issafe']==1)

150 
$¡yË
 = "color:red;";

152 
	gecho
 "<div styË='{$¡yË}' cÏss='v”lše'>ã€".(
	g$v”s
['issafe']==1 ? "å®‰å…¨æ›´æ–°" : "æ™®é€šæ›´æ–°")."ã€‘";

153 
echo
 
	g$v”s
['vtime']."ï¼Œæ›´æ–°è¯´æ˜ï¼š{$vers['vmsg']}</div>\r\n";

155 
	gecho
 "<div style='line-height:32px'><inputype='submit'‚ame='sb1' value=' ç‚¹å‡»æ­¤è·å–æ‰€æœ‰æ›´æ–°æ–‡ä»¶ï¼Œç„¶åé€‰æ‹©å®‰è£… ' class='np coolbg' style='cursor:pointer' />\r\n";

156 
	gecho
 " &nbsp; <inputype='button'‚ame='sb2' value=' å¿½ç•¥è¿™äº›æ›´æ–° ' onclick='SkipReload({$lastTime})' class='np coolbg' style='cursor:pointer' /></div>\r\n";

157 
	gecho
 "</form></div>";

160 
ex™
();

166 if(
	g$dİo¡
=='skip')

168 
AjaxH—d
();

169 
	g$å
 = 
fİ’
(
$v”LockFe
, 'w');

170 
fwr™e
(
$å
, 
$vtime
);

171 
fşo£
(
$å
);

172 
	g$offU¾
 = 
SpG‘NewInfo
();

173 
	gecho
 "<div class='updatedvt'><b>ä½ ç³»ç»Ÿç‰ˆæœ¬æœ€åæ›´æ–°æ—¶é—´ä¸ºï¼š{$oktime}ï¼Œå½“å‰æ²¡æœ‰å¯ç”¨çš„æ›´æ–°ã€‚</b></div>\r\n";

174 
	gecho
 "<iframe‚ame='stafrm' src='{$offUrl}&uptime={$oktime}' frameborder='0' id='stafrm' width='100%' height='60'></iframe>";

175 
ex™
();

177 if(
	g$dİo¡
=='skipback')

179 
$å
 = 
fİ’
(
$v”LockFe
, 'w');

180 
fwr™e
(
$å
, 
$vtime
);

181 
fşo£
(
$å
);

182 
ShowMsg
("æˆåŠŸè·³è¿‡è¿™äº›æ›´æ–°ï¼", "index_body.php");

183 
ex™
();

189 if(
	g$dİo¡
=='getlist')

191 
$up™emsA¼
 = 
ex¶ode
(',', 
$up™ems
);

192 
rsÜt
(
$up™emsA¼
);

194 
	g$tmpdœ
 = 
sub¡r
(
md5
(
$cfg_cook›_’code
), 0, 16);

196 
	g$dhd
 = 
Ãw
 
XakH‰pDown
();

197 
	g$feA¼
 = 
¬¿y
();

198 
	g$f
 = 0;

199 
fÜ—ch
(
$up™emsA¼
 
as
 
$up™em
)

201 
	g$du¾
 = 
$upd©eHo¡
.
$cfg_soá_Ïng
.'/'.
$up™em
.'.file.txt';

202 
	g$dhd
->
O³nU¾
(
$du¾
);

203 
	g$f–i¡
 = 
$dhd
->
G‘Html
();

204 
	g$f–i¡
 = 
Œim
Ğ
´eg_»¶aû
("#[\r\n]{1,}#", "\n", 
$f–i¡
) );

205 if(!
em±y
(
$f–i¡
))

207 
	g$f–i¡s
 = 
ex¶ode
("\n", 
$f–i¡
);

208 
fÜ—ch
(
$f–i¡s
 
as
 
$f–i¡
)

210 
	g$f–i¡
 = 
Œim
(
$f–i¡
);

211 if(
em±y
(
$f–i¡
)) ;

212 
	g$fs
 = 
ex¶ode
(',', 
$f–i¡
);

213 ifĞ
em±y
(
$fs
[1]) )

215 
	g$fs
[1] = 
$up™em
." å¸¸è§„åŠŸèƒ½æ›´æ–°æ–‡ä»¶";

217 if(!
is£t
(
$feA¼
[
$fs
[0]]))

219 
	g$feA¼
[
$fs
[0]] = 
$up™em
." ".
Œim
($fs[1]);

220 
	g$f
++;

225 
	g$dhd
->
Clo£
();

227 
	g$®lFeLi¡
 = '';

228 if(
	g$f
==0)

230 
$®lFeLi¡
 = "<font color='green'><b>æ²¡å‘ç°å¯ç”¨çš„æ–‡ä»¶åˆ—è¡¨ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯å®˜æ–¹æœåŠ¡å™¨å­˜åœ¨é—®é¢˜ï¼Œè¯·ç¨åå†å°è¯•ï¼</b></font>";

234 
	g$®lFeLi¡
 .= "<div style='width:98%'><form‚ame='fup'‡ction='update_guide.php' method='post'>\r\n";

235 
	g$®lFeLi¡
 .= "<inputype='hidden'‚ame='vtime' value='$vtime' />\r\n";

236 
	g$®lFeLi¡
 .= "<inputype='hidden'‚ame='dopost' value='getfiles' />\r\n";

237 
	g$®lFeLi¡
 .= "<inputype='hidden'‚ame='upitems' value='$upitems' />\r\n";

238 
	g$®lFeLi¡
 .= "<div class='upinfotitle'>ä»¥ä¸‹æ˜¯éœ€è¦ä¸‹è½½çš„æ›´æ–°æ–‡ä»¶ï¼ˆè·¯å¾„ç›¸å¯¹äºç³»ç»Ÿçš„æ ¹ç›®å½•ï¼‰ï¼š</div>\r\n";

239 
	g$f–i¡s
 = 
ex¶ode
("\n",
$f–i¡
);

240 
fÜ—ch
(
$feA¼
 
as
 
$k
=>
$v
)

242 
$®lFeLi¡
 .= "<div class='verline'><inputype='checkbox'‚ame='files[]' value='{$k}' checked='checked' /> $k({$v})</div>\r\n";

244 
	g$®lFeLi¡
 .= "<div class='verline'>";

245 
	g$®lFeLi¡
 .= "æ–‡ä»¶ä¸´æ—¶å­˜æ”¾ç›®å½•ï¼š../config/<inputype='text'‚ame='tmpdir' style='width:200px' value='$tmpdir' /><br />\r\n";

246 
	g$®lFeLi¡
 .= "<inputype='checkbox'‚ame='skipnodir' value='1' checked='checked' /> è·³è¿‡ç³»ç»Ÿä¸­æ²¡æœ‰çš„æ–‡ä»¶å¤¹(é€šå¸¸æ˜¯å¯é€‰æ¨¡å—çš„è¡¥ä¸)</div>\r\n";

247 
	g$®lFeLi¡
 .= "<div style='line-height:36px;background:#F8FEDA'>&nbsp;\r\n";

248 
	g$®lFeLi¡
 .= "<inputype='submit'‚ame='sb1' value=' ä¸‹è½½å¹¶åº”ç”¨è¿™äº›è¡¥ä¸ ' class='np coolbg' style='cursor:pointer' />\r\n";

249 
	g$®lFeLi¡
 .="</form></div>";

252 
šşude
 
XAKINClude
('templets/update_guide_getlist.htm');

253 
ex™
();

259 if(
	g$dİo¡
=='getfilesstart')

262 
$msg
 = "å¦‚æœæ£€æµ‹æ—¶å‘ç°ä½ æ²¡å®‰è£…æ¨¡å—çš„æ–‡ä»¶å¤¹æœ‰é”™è¯¯ï¼Œå¯ä¸å¿…ç†ä¼š<br />";

263 
	g$msg
 .= "<a href=update_guide.php?dopost=down&curfile=0>ç¡®è®¤ç›®å½•çŠ¶æ€éƒ½æ­£å¸¸åï¼Œè¯·ç‚¹å‡»å¼€å§‹ä¸‹è½½æ–‡ä»¶&gt;&gt;</a><br />";

264 
ShowMsg
(
$msg
,"javascript:;");

265 
ex™
();

267 if(
	g$dİo¡
=='getfiles')

269 
$ÿcheFes
 = 
XAKDATA
.'/cache/updatetmp.inc';

270 
	g$sknodœ
 = (
is£t
(
$sknodœ
) ? 1 : 0);

271 
	g$admšDœ
 = 
´eg_»¶aû
("#(.*)[\/\\\\]#", "", 
dœÇme
(
__FILE__
));

273 if(!
is£t
(
$fes
))

275 
	g$dÚeSŒ
 = "<p‡lign='center' style='color:red'><br />ä½ æ²¡æœ‰æŒ‡å®šä»»ä½•éœ€è¦ä¸‹è½½æ›´æ–°çš„æ–‡ä»¶ï¼Œæ˜¯å¦è·³è¿‡è¿™äº›æ›´æ–°ï¼Ÿ<br /><br />";

276 
	g$dÚeSŒ
 .= "<a href='update_guide.php?dopost=skipback&vtime=$vtime' class='np coolbg'>[è·³è¿‡è¿™äº›æ›´æ–°]</a> &nbsp; ";

277 
	g$dÚeSŒ
 .= "<a href='index_body.php' class='np coolbg'>[ä¿ç•™æç¤ºä»¥åå†è¿›è¡Œæ“ä½œ]</a></p>";

281 
	g$å
 = 
fİ’
(
$ÿcheFes
, 'w');

282 
fwr™e
(
$å
, '<'.'?php'."\r\n");

283 
fwr™e
(
$å
, '$tmpdœ = "'.
$tmpdœ
.'";'."\r\n");

284 
fwr™e
(
$å
, '$vtimğ'.
$vtime
.';'."\r\n");

285 
	g$dœs
 = 
¬¿y
();

286 
	g$i
 = -1;

287 
fÜ—ch
(
$fes
 
as
 
$f’ame
)

289 
	g$tf’ame
 = 
$f’ame
;

290 ifĞ
´eg_m©ch
("#^xakadmš\/#i", 
$f’ame
) )

292 
	g$tf’ame
 = 
´eg_»¶aû
("#^xakadmš\/#", 
$admšDœ
.'/', 
$f’ame
);

294 
	g$curdœ
 = 
G‘DœName
(
$tf’ame
);

295 ifĞ!
is£t
(
$dœs
[
$curdœ
]) )

297 
	g$dœs
[
$curdœ
] = 
Te¡IsFeDœ
($curdir);

299 if(
	g$sknodœ
==1 && 
$dœs
[
$curdœ
]['isdœ'] =ğ
FALSE
)

304 @
mkdœ
(
$curdœ
, 0777);

305 
	g$dœs
[
$curdœ
] = 
Te¡IsFeDœ
($curdir);

307 
	g$i
++;

308 
fwr™e
(
$å
, '$fes['.
$i
.'] = "'.
$f’ame
.'";'."\r\n");

310 
fwr™e
(
$å
, '$feCÚuˆğ'.
$i
.';'."\r\n");

312 
	g$™ems
 = 
ex¶ode
(',', 
$up™ems
);

313 
fÜ—ch
(
$™ems
 
as
 
$sqlfe
)

315 
fwr™e
(
$å
,'$sqls[] = "'.
$sqlfe
.'.sql";'."\r\n");

317 
fwr™e
(
$å
, '?'.'>');

318 
fşo£
(
$å
);

320 
	g$dœšfos
 = '';

321 if(
	g$i
 > -1)

323 
	g$dœšfos
 = '<tr bgcolor="#ffffff"><td colspan="2">';

324 
	g$dœšfos
 .= "æœ¬æ¬¡å‡çº§éœ€è¦åœ¨ä¸‹é¢æ–‡ä»¶å¤¹å†™å…¥æ›´æ–°æ–‡ä»¶ï¼Œè¯·æ³¨æ„æ–‡ä»¶å¤¹æ˜¯å¦æœ‰å†™å…¥æƒé™ï¼š<br />\r\n";

325 
fÜ—ch
(
$dœs
 
as
 
$curdœ
)

327 
	g$dœšfos
 .ğ
$curdœ
['name']." çŠ¶æ€ï¼š".($curdir['writeable'] ? "[âˆšæ­£å¸¸]" : "<font color='red'>[Ã—ä¸å¯å†™]</font>")."<br />\r\n";

329 
	g$dœšfos
 .= "</td></tr>\r\n";

332 
	g$dÚeSŒ
 = "<iframe‚ame='stafrm' src='update_guide.php?dopost=getfilesstart' frameborder='0' id='stafrm' width='100%' height='100%'></iframe>\r\n";

334 
šşude
 
XAKINClude
('templets/update_guide_getfiles.htm');

335 
ex™
();

341 if(
	g$dİo¡
=='down')

343 
$ÿcheFes
 = 
XAKDATA
.'/cache/updatetmp.inc';

344 
»quœe_Úû
(
$ÿcheFes
);

346 if(
em±y
(
$¡¬tup
))

348 if(
	g$feCÚut
==-1 || 
$curfe
 > 
$feCÚut
)

350 
ShowMsg
("å·²ä¸‹è½½æ‰€æœ‰æ–‡ä»¶ï¼Œå¼€å§‹ä¸‹è½½æ•°æ®åº“å‡çº§æ–‡ä»¶...","update_guide.php?dopost=down&startup=1");

351 
ex™
();

355 
MkTmpDœ
(
$tmpdœ
, 
$fes
[
$curfe
]);

357 
	g$downfe
 = 
$upd©eHo¡
.
$cfg_soá_Ïng
.'/sourû/'.
$fes
[
$curfe
];

359 
	g$dhd
 = 
Ãw
 
XakH‰pDown
();

360 
	g$dhd
->
O³nU¾
(
$downfe
);

361 
	g$dhd
->
SaveToBš
(
XAKDATA
.'/'.
$tmpdœ
.'/'.
$fes
[
$curfe
]);

362 
	g$dhd
->
Clo£
();

364 
ShowMsg
("æˆåŠŸä¸‹è½½å¹¶ä¿å­˜æ–‡ä»¶ï¼š{$fes[$curfe]}ï¼› ç»§ç»­ä¸‹è½½ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚","upd©e_guide.php?dİo¡=down&curfe=".(
$curfe
+1));

365 
ex™
();

369 
MkTmpDœ
(
$tmpdœ
, 'sql.txt');

370 
	g$dhd
 = 
Ãw
 
XakH‰pDown
();

371 
	g$ù
 = '';

372 
fÜ—ch
(
$sqls
 
as
 
$sql
)

374 
	g$downfe
 = 
$upd©eHo¡
.
$cfg_soá_Ïng
.'/'.
$sql
;

375 
	g$dhd
->
O³nU¾
(
$downfe
);

376 
	g$ù
 .ğ
$dhd
->
G‘Html
();

378 
	g$dhd
->
Clo£
();

379 
	g$Œuefe
 = 
XAKDATA
.'/'.
$tmpdœ
.'/sql.txt';

380 
	g$å
 = 
fİ’
(
$Œuefe
, 'w');

381 
fwr™e
(
$å
, 
$ù
);

382 
fşo£
(
$å
);

384 
ShowMsg
("å®Œæˆæ‰€æœ‰è¿œç¨‹æ–‡ä»¶è·å–æ“ä½œï¼š<a href='update_guide.php?dopost=apply'>&lt;&lt;ç‚¹å‡»æ­¤å¼€å§‹ç›´æ¥å‡çº§&gt;&gt;</a><br />ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨[../config/{$tmpdir}]ç›®å½•çš„æ–‡ä»¶æ‰‹åŠ¨å‡çº§ã€‚","javascript:;");

386 
ex™
();

388 
ex™
();

394 if(
	g$dİo¡
=='apply')

396 
$ÿcheFes
 = 
XAKDATA
.'/cache/updatetmp.inc';

397 
»quœe_Úû
(
$ÿcheFes
);

399 if(
em±y
(
$¡•
))

401 
	g$Œuefe
 = 
XAKDATA
.'/'.
$tmpdœ
.'/sql.txt';

402 
	g$å
 = 
fİ’
(
$Œuefe
, 'r');

403 
	g$sql
 = @
ä—d
(
$å
, 
fesize
(
$Œuefe
));

404 
fşo£
(
$å
);

405 if(!
em±y
(
$sql
))

407 
	g$mysql_v”siÚ
 = 
$dsql
->
G‘V”siÚ
(
Œue
);

409 
	g$sql
 = 
´eg_»¶aû
('#ENGINE=MyISAM#i', 'TYPE=MyISAM', 
$sql
);

410 
	g$sql41tmp
 = 'ENGINE=MyISAM DEFAULT CHARSET='.
$cfg_db_Ïnguage
;

411 if(
	g$mysql_v”siÚ
 >= 4.1)

413 
$sql
 = 
´eg_»¶aû
('#TYPE=MyISAM#i', 
$sql41tmp
, $sql);

416 
	g$sqls
 = 
ex¶ode
(";\r\n", 
$sql
);

417 
fÜ—ch
(
$sqls
 
as
 
$sql
)

419 if(
Œim
(
$sql
)!='')

421 
$dsql
->
Execu‹NÚeQu”y
(
Œim
(
$sql
));

425 
ShowMsg
("å®Œæˆæ•°æ®åº“æ›´æ–°ï¼Œç°åœ¨å¼€å§‹å¤åˆ¶æ–‡ä»¶ã€‚","update_guide.php?dopost=apply&step=1");

426 
ex™
();

430 
	g$sDœ
 = 
XAKDATA
."/$tmpdir";

431 
	g$tDœ
 = 
XAKROOT
;

433 
	g$badı
 = 0;

434 
	g$admšDœ
 = 
´eg_»¶aû
("#(.*)[\/\\\\]#", "", 
dœÇme
(
__FILE__
));

436 if(
is£t
(
$fes
è&& 
is_¬¿y
($files))

438 
fÜ—ch
(
$fes
 
as
 
$f
)

440 if(
´eg_m©ch
('#^xakadmš#', 
$f
))

442 
	g$tf
 = 
´eg_»¶aû
('#^xakadmš#', 
$admšDœ
, 
$f
);

445 
	g$tf
 = 
$f
;

447 if(
fe_exi¡s
(
$sDœ
.'/'.
$f
))

449 
	g$rs
 = @
cİy
(
$sDœ
.'/'.
$f
, 
$tDœ
.'/'.
$tf
);

450 if(
	g$rs
) {

451 
uÆšk
(
$sDœ
.'/'.
$f
);

454 
	g$badı
++;

460 
	g$å
 = 
fİ’
(
$v”LockFe
,'w');

461 
fwr™e
(
$å
,
$vtime
);

462 
fşo£
(
$å
);

464 
	g$badmsg
 = 'ï¼';

465 if(
	g$badı
 > 0)

467 
	g$badmsg
 = "ï¼Œå…¶ä¸­å¤±è´¥ {$badcp} ä¸ªæ–‡ä»¶ï¼Œ<br />è¯·ä»ä¸´æ—¶ç›®å½•[../config/{$tmpdir}]ä¸­å–å‡ºè¿™å‡ ä¸ªæ–‡ä»¶æ‰‹åŠ¨å‡çº§ã€‚";

470 
ShowMsg
("æˆåŠŸå®Œæˆå‡çº§{$badmsg}","javascript:;");

471 
ex™
();

	@E:\web\weixun\xakadmin\upload.php

1 <?
php


15 
h—d”
('Content-Type:ext/html; charset=UTF-8');

16 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

17 
	g$šputName
='filedata';

18 
	g$©chFuÎDœ
 = 
¡r_»¶aû
("\\", '/', 
dœÇme
(
__FILE__
) ).'/../uploads/allimg';

19 
	g$©chDœ
 = '/uploads/allimg/';

21 
	g$dœTy³
=1;

22 
	g$maxA‰achSize
=2097152;

23 
	g$upExt
='txt,rar,zip,jpg,jpeg,gif,png,swf,wmv,avi,wma,mp3,mid';

24 
	g$msgTy³
=2;

25 
	g$immedŸ‹
=
is£t
(
$_GET
['immediate'])?$_GET['immediate']:0;

26 
ši_£t
('date.timezone','Asia/Shanghai');

28 
	g$”r
 = "";

29 
	g$msg
 = "''";

30 
	g$‹mpP©h
=
$©chFuÎDœ
.'/'.
d©e
("YmdHis").
mt_¿nd
(10000,99999).'.tmp';

31 
	g$loÿlName
='';

33 if(
is£t
(
$_SERVER
['HTTP_CONTENT_DISPOSITION'])&&
´eg_m©ch
('/©chm’t;\s+Çme="(.+?)";\s+f’ame="(.+?)"/i',$_SERVER['HTTP_CONTENT_DISPOSITION'],
$šfo
)){

34 
fe_put_cÚ‹Ás
(
$‹mpP©h
,
fe_g‘_cÚ‹Ás
("php://input"));

35 
	g$loÿlName
=
$šfo
[2];

38 
	g$upfe
=@
$_FILES
[
$šputName
];

39 if(!
is£t
(
$upfe
))
	g$”r
='æ–‡ä»¶åŸŸçš„nameé”™è¯¯';

40 
–£if
(!
em±y
(
$upfe
['error'])){

41 
	g$upfe
['error'])

44 
$”r
 = 'æ–‡ä»¶å¤§å°è¶…è¿‡äº†php.iniå®šä¹‰çš„upload_max_filesizeå€¼';

47 
$”r
 = 'æ–‡ä»¶å¤§å°è¶…è¿‡äº†HTMLå®šä¹‰çš„MAX_FILE_SIZEå€¼';

50 
$”r
 = 'æ–‡ä»¶ä¸Šä¼ ä¸å®Œå…¨';

53 
$”r
 = 'æ— æ–‡ä»¶ä¸Šä¼ ';

56 
$”r
 = 'ç¼ºå°‘ä¸´æ—¶æ–‡ä»¶å¤¹';

59 
$”r
 = 'å†™æ–‡ä»¶å¤±è´¥';

62 
$”r
 = 'ä¸Šä¼ è¢«å…¶å®ƒæ‰©å±•ä¸­æ–­';

66 
$”r
 = 'æ— æœ‰æ•ˆé”™è¯¯ä»£ç ';

69 
–£if
(
em±y
(
$upfe
['tmp_Çme']è|| $upfe['tmp_Çme'] =ğ'nÚe')
$”r
 = 'æ— æ–‡ä»¶ä¸Šä¼ ';

71 
move_u¶ßded_fe
(
$upfe
['tmp_Çme'],
$‹mpP©h
);

72 
	g$loÿlName
=
$upfe
['name'];

76 if(
	g$”r
==''){

77 
$feInfo
=
·thšfo
(
$loÿlName
);

78 
	g$ex‹nsiÚ
=
$feInfo
['extension'];

79 if(
´eg_m©ch
('/'.
¡r_»¶aû
(',','|',
$upExt
).'/i',
$ex‹nsiÚ
))

81 
	g$by‹s
=
fesize
(
$‹mpP©h
);

82 if(
	g$by‹s
 > 
	g$maxA‰achSize
)
	g$”r
='è¯·ä¸è¦ä¸Šä¼ å¤§å°è¶…è¿‡'.
fÜm©By‹s
(
$maxA‰achSize
).'çš„æ–‡ä»¶';

85 
	g$dœTy³
)

87 1: 
$©chSubDœ
 = 
d©e
('ymd'); ;

88 2: 
$©chSubDœ
 = 'mÚth_'.
d©e
('ym'); ;

89 3: 
$©chSubDœ
 = 'ext_'.
$ex‹nsiÚ
; ;

91 
	g$©chFuÎDœ
 = 
$©chFuÎDœ
.'/'.
$©chSubDœ
;

92 if(!
is_dœ
(
$©chFuÎDœ
))

94 @
mkdœ
(
$©chFuÎDœ
, 0777);

95 @
fşo£
(
fİ’
(
$©chFuÎDœ
.'/index.htm', 'w'));

97 
	gPHP_VERSION
 < '4.2.0' && 
mt_¤ªd
(()
miüÙime
() * 1000000);

98 
	g$ÃwF’ame
=
d©e
("YmdHis").
mt_¿nd
(1000,9999).'.'.
	g$ex‹nsiÚ
;

99 
	g$rg‘P©h
 = 
$©chFuÎDœ
.'/'.
$ÃwF’ame
;

101 
»Çme
(
$‹mpP©h
,
$rg‘P©h
);

102 @
chmod
(
$rg‘P©h
,0755);

103 
	g$rg‘P©h
=
jsÚSŒšg
(
$rg‘P©h
);

104 if(
	g$immedŸ‹
=='1')
$rg‘P©h
='!'.$targetPath;

105 
	g$rg‘P©h
 = 
$©chDœ
.
$©chSubDœ
.'/'.
$ÃwF’ame
;

106 if(
	g$msgTy³
==1)
$msg
="'$targetPath'";

107 
	g$msg
="{'u¾':'".
$rg‘P©h
."','loÿÊame':'".
jsÚSŒšg
(
$loÿlName
)."','id':'1'}";

110 
	g$”r
='ä¸Šä¼ æ–‡ä»¶æ‰©å±•åå¿…éœ€ä¸ºï¼š'.
$upExt
;

112 @
uÆšk
(
$‹mpP©h
);

115 
	gecho
 "{'”r':'".
jsÚSŒšg
(
$”r
)."','msg':".
	g$msg
."}";

118 
funùiÚ
 
	$jsÚSŒšg
(
$¡r
)

120  
	`´eg_»¶aû
("/([\\\\\/'])/",'\\\$1',
$¡r
);

121 
	}
}

122 
funùiÚ
 
	$fÜm©By‹s
(
$by‹s
) {

123 if(
$by‹s
 >= 1073741824) {

124 
$by‹s
 = 
	`round
($bytes / 1073741824 * 100) / 100 . 'GB';

125 } 
	`–£if
(
$by‹s
 >= 1048576) {

126 
$by‹s
 = 
	`round
($bytes / 1048576 * 100) / 100 . 'MB';

127 } 
	`–£if
(
$by‹s
 >= 1024) {

128 
$by‹s
 = 
	`round
($bytes / 1024 * 100) / 100 . 'KB';

130 
$by‹s
 = $bytes . 'Bytes';

132  
$by‹s
;

133 
	}
}

	@E:\web\weixun\xakadmin\vote_add.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/xakvote.class.php");

9 
»quœe_Úû
(
XAKINC
."/helpers/filter.helper.php");

10 
CheckPurv›w
('plus_æŠ•ç¥¨æ¨¡å—');

11 if(
em±y
(
$dİo¡
)è
	g$dİo¡
 = "";

12 if(
em±y
(
$i§rc
)è
	g$i§rc
 = 0;

13 if(
	g$dİo¡
=="§ve" && 
$i§rc
 == 0)

15 
$¡¬‰ime
 = 
G‘MkTime
($starttime);

16 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

17 
	g$vÙe™ems
 = "";

19 
	g$j
 = 0;

20 
	g$i
=1; $i<=15; $i++)

22 if(!
em±y
(
$
{"vÙe™em".
$i
}))

24 
	g$j
++;

25 
	g$vÙe™ems
 .ğ"<v:nÙid=\\'$j\\' couÁ=\\'0\\'>".
$
{"vÙe™em".
$i
}."</v:note>\r\n";

28 
	g$šQu”y
 = "INSERT INTO #@__vote(votename,starttime,endtime,totalcount,ismore,votenote,isallow,view,spec,isenable)

29 
VALUES
('$votename','$starttime','$endtime','0','$ismore','$voteitems','$isallow','$view','$spec','$isenable'); ";

30 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

32 
ShowMsg
("å¢åŠ æŠ•ç¥¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ˜¯å¦éæ³•ï¼","-1");

33 
ex™
();

35 
	g$aid
 = 
$dsql
->
G‘La¡ID
();

36 
	g$vt
 = 
Ãw
 
XakVÙe
(
$aid
);

37 
	g$vÙe_cÚ‹Á
 = 
$vt
->
G‘VÙeFÜm
();

38 
	g$vÙe_cÚ‹Á
 = 
´eg_»¶aû
(
¬¿y
("#/#","#([\r\n])[\s]+#"),¬¿y("\/"," "),
$vÙe_cÚ‹Á
);

39 
	g$vÙe_cÚ‹Á
 = 'docum’t.wr™e("'.
$vÙe_cÚ‹Á
.'");';

41 
	g$vÙe_fe
 = 
XAKDATA
."/vÙe/vÙe_".
$aid
.".js";

42 
fe_put_cÚ‹Ás
(
$vÙe_fe
, 
$vÙe_cÚ‹Á
);

43 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ç»„æŠ•ç¥¨ï¼","vote_main.php");

44 
ex™
();

46 if(
	g$dİo¡
=="§ve" && 
$i§rc
 == 1)

48 
$¡¬‰ime
 = 
G‘MkTime
($starttime);

49 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

50 
	g$vÙe™ems
 = "";

52 
	g$j
 = 0;

53 
	g$i
=1; $i<=15; $i++)

55 if(!
em±y
(
$
{"vÙe™em".
$i
}))

57 
	g$j
++;

58 
	g$vÙe™ems
 .ğ"<v:nÙid=\\'$j\\' couÁ=\\'0\\'>".
$
{"vÙe™em".
$i
}."</v:note>\r\n";

61 
	g$šQu”y
 = "INSERT INTO #@__vote(votename,starttime,endtime,totalcount,ismore,votenote,isallow,view,spec,isenable)

62 
VALUES
('$votename','$starttime','$endtime','0','$ismore','$voteitems','$isallow','$view','$spec','$isenable'); ";

63 if(!
	g$dsql
->
Execu‹NÚeQu”y
(
$šQu”y
))

65 
ShowMsg
("å¢åŠ æŠ•ç¥¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ˜¯å¦éæ³•ï¼","-1");

66 
ex™
();

68 
	g$aid
 = 
$dsql
->
G‘La¡ID
();

69 
	g$vt
 = 
Ãw
 
XakVÙe
(
$aid
);

70 
	g$vÙe_cÚ‹Á
 = 
$vt
->
G‘VÙeFÜm
();

71 
	g$vÙe_cÚ‹Á
 = 
´eg_»¶aû
(
¬¿y
("#/#","#([\r\n])[\s]+#"),¬¿y("\/"," "),
$vÙe_cÚ‹Á
);

72 
	g$vÙe_cÚ‹Á
 = 'docum’t.wr™e("'.
$vÙe_cÚ‹Á
.'");';

74 
	g$vÙe_fe
 = 
XAKDATA
."/vÙe/vÙe_".
$aid
.".js";

75 
fe_put_cÚ‹Ás
(
$vÙe_fe
, 
$vÙe_cÚ‹Á
);

76 
ShowMsg
("æˆåŠŸå¢åŠ ä¸€ç»„æŠ•ç¥¨ï¼","vÙe_maš.php?is£l=1&aid=".
$aid
);

77 
ex™
();

79 
	g$¡¬tDay
 = 
time
();

80 
	g$’dDay
 = 
AddDay
(
$¡¬tDay
,30);

81 
	g$¡¬tDay
 = 
G‘D©eTimeMk
(
$¡¬tDay
);

82 
	g$’dDay
 = 
G‘D©eTimeMk
(
$’dDay
);

83 
šşude
 
XAKINClude
('templets/vote_add.htm');

	@E:\web\weixun\xakadmin\vote_edit.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
)."/config.php");

8 
CheckPurv›w
('plus_æŠ•ç¥¨æ¨¡å—');

9 
»quœe_Úû
(
XAKINC
."/xaktag.class.php");

10 if(
em±y
(
$dİo¡
)è
	g$dİo¡
="";

12 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

13 
	g$ENV_GOBACK_URL
 = 
em±y
(
$_COOKIE
['ENV_GOBACK_URL']) ? "vote_main.php" : $_COOKIE['ENV_GOBACK_URL'];

15 if(
	g$dİo¡
=="delete")

17 if(
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__vote WHERE‡id='$aid'"))

19 if(
$dsql
->
Execu‹NÚeQu”y
("DELETE FROM #@__vote_member WHERE voteid='$aid'"))

21 
ShowMsg
('æˆåŠŸåˆ é™¤ä¸€ç»„æŠ•ç¥¨!', 
$ENV_GOBACK_URL
);

22 
	gex™
;

27 
ShowMsg
('æŒ‡å®šåˆ é™¤æŠ•ç¥¨ä¸å­˜åœ¨!', 
$ENV_GOBACK_URL
);

28 
	gex™
;

31 if(
	g$dİo¡
=="saveedit")

33 
$¡¬‰ime
 = 
G‘MkTime
($starttime);

34 
	g$’dtime
 = 
G‘MkTime
(
$’dtime
);

35 
	g$qu”y
 = "UPDATE #@__vote SET votename='$votename',

36 
¡¬‰ime
='$starttime',

37 
	g’dtime
='$endtime',

38 
	gtÙ®couÁ
='$totalcount',

39 
	gismÜe
='$ismore',

40 
	gvÙ’Ùe
='$votenote',

41 
	gi§Îow
='$isallow',

42 
	gv›w
='$view',

43 
	g¥ec
='$spec',

44 
	gi£ÇbË
='$isenable'

45 
WHERE
 
aid
='$aid'

47 if(
$dsql
->
Execu‹NÚeQu”y
(
$qu”y
))

49 
$vt
 = 
Ãw
 
XakVÙe
(
$aid
);

50 
	g$vÙe_fe
 = 
XAKDATA
."/vÙe/vÙe_".
$aid
.".js";

51 
	g$vÙe_cÚ‹Á
 = 
$vt
->
G‘VÙeFÜm
();

52 
	g$vÙe_cÚ‹Á
 = 
´eg_»¶aû
(
¬¿y
("#/#","#([\r\n])[\s]+#"),¬¿y("\/"," "),
$vÙe_cÚ‹Á
);

53 
	g$vÙe_cÚ‹Á
 = 'docum’t.wr™e("'.
$vÙe_cÚ‹Á
.'");';

54 
fe_put_cÚ‹Ás
(
$vÙe_fe
,
$vÙe_cÚ‹Á
);

55 
ShowMsg
('æˆåŠŸæ›´æ”¹ä¸€ç»„æŠ•ç¥¨!',
$ENV_GOBACK_URL
);

59 
ShowMsg
('æ›´æ”¹ä¸€ç»„æŠ•ç¥¨å¤±è´¥!',
$ENV_GOBACK_URL
);

64 
	g$row
 = 
$dsql
->
G‘OÃ
("SELECT * FROM #@__vote WHERE‡id='$aid'");

65 if(!
is_¬¿y
(
$row
))

67 
ShowMsg
('æŒ‡å®šæŠ•ç¥¨ä¸å­˜åœ¨ï¼', '-1');

68 
ex™
();

70 
šşude
 
XAKINClude
('templets/vote_edit.htm');

	@E:\web\weixun\xakadmin\vote_getcode.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/xakvote.class.php");

9 
	g$aid
 = 
is£t
(
$aid
è&& 
is_num”ic
($aid) ? $aid : 0;

10 
šşude
 
XAKINClude
('templets/vote_getcode.htm');

	@E:\web\weixun\xakadmin\vote_main.php

1 <?
php


7 
»quœe_Úû
(
dœÇme
(
__FILE__
)."/config.php");

8 
»quœe_Úû
(
XAKINC
."/datalistcp.class.php");

9 
£tcook›
("ENV_GOBACK_URL",
$xakNowu¾
,
time
()+3600,"/");

10 
	g$sql
 = "SELECT‡id,votename,starttime,endtime,totalcount,isenable FROM #@__vote ORDER BY‡id DESC";

11 
	g$dli¡
 = 
Ãw
 
D©aLi¡CP
();

12 
	g$is£l
 = 
is£t
(
$is£l
) ? $issel : 0;

13 
	g$aid
 = 
is£t
(
$aid
) ? $aid : 0;

14 if(
	g$is£l
 == 1)

16 
$dli¡
->
S‘P¬am‘”
('is£l',
$is£l
);

17 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/vote_select.htm");

19 
	g$dli¡
->
S‘Tem¶‘
(
XAKADMIN
."/templets/vote_main.htm");

21 
	g$dli¡
->
S‘Sourû
(
$sql
);

22 
	g$dli¡
->
di¥Ïy
();

	@E:\web\weixun\xakadmin\xmenu2.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu2.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu2.htm');

	@E:\web\weixun\xakadmin\xmenu3.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu3.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu3.htm');

	@E:\web\weixun\xakadmin\xmenu4.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu4.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu4.htm');

	@E:\web\weixun\xakadmin\xmenu5.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu5.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu5.htm');

	@E:\web\weixun\xakadmin\xmenu6.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu6.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu6.htm');

	@E:\web\weixun\xakadmin\xmenu7.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu7.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu7.htm');

	@E:\web\weixun\xakadmin\xmenu8.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu8.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu8.htm');

	@E:\web\weixun\xakadmin\xmenu9.php

1 <?
php


2 
»quœe
(
dœÇme
(
__FILE__
).'/config.php');

3 
»quœe
(
XAKADMIN
.'/inc/xmenu9.php');

4 
»quœe
(
XAKADMIN
.'/inc/inc_menu_func.php');

5 
	g$İ’™em
 = (
em±y
(
$İ’™em
) ? 1 : $openitem);

6 
šşude
 
XAKINClude
('templets/xmenu9.htm');

	@
1
.
0
522
21920
E:\web\weixun\config\admin\config_update.php
E:\web\weixun\config\cache\memberlogin\c4\ca\42\c4ca4238a0b923820dcc509a6f75849b.php
E:\web\weixun\config\cache\memberlogin\ec\cb\c8\eccbc87e4b5ce2fe28308fd9f2a7baf3.php
E:\web\weixun\config\config.cache.bak.php
E:\web\weixun\config\config.cache.inc.php
E:\web\weixun\config\downmix.data.php
E:\web\weixun\config\helper.inc.php
E:\web\weixun\config\mark\inc_photowatermark_config.php
E:\web\weixun\config\module\modulescache.php
E:\web\weixun\config\safe\inc_safe_config.php
E:\web\weixun\config\safequestions.php
E:\web\weixun\config\smiley.data.php
E:\web\weixun\config\template.rand.php
E:\web\weixun\config\xakdb.php
E:\web\weixun\functions\Lurd.class.php
E:\web\weixun\functions\arc.archives.class.php
E:\web\weixun\functions\arc.caicai.class.php
E:\web\weixun\functions\arc.freelist.class.php
E:\web\weixun\functions\arc.listview.class.php
E:\web\weixun\functions\arc.memberlistview.class.php
E:\web\weixun\functions\arc.partview.class.php
E:\web\weixun\functions\arc.rssview.class.php
E:\web\weixun\functions\arc.searchview.class.php
E:\web\weixun\functions\arc.sglistview.class.php
E:\web\weixun\functions\arc.sgpage.class.php
E:\web\weixun\functions\arc.specview.class.php
E:\web\weixun\functions\arc.taglist.class.php
E:\web\weixun\functions\archives.func.php
E:\web\weixun\functions\channelunit.class.php
E:\web\weixun\functions\channelunit.func.php
E:\web\weixun\functions\charset.func.php
E:\web\weixun\functions\ckeditor\ckeditor.inc.php
E:\web\weixun\functions\ckeditor\ckeditor.php
E:\web\weixun\functions\ckeditor\ckeditor_php4.php
E:\web\weixun\functions\ckeditor\ckeditor_php5.php
E:\web\weixun\functions\common.func.php
E:\web\weixun\functions\common.inc.php
E:\web\weixun\functions\control.class.php
E:\web\weixun\functions\customfields.func.php
E:\web\weixun\functions\datalistcp.class.php
E:\web\weixun\functions\dialog\config.php
E:\web\weixun\functions\dialog\select_images.php
E:\web\weixun\functions\dialog\select_images_post.php
E:\web\weixun\functions\dialog\select_media.php
E:\web\weixun\functions\dialog\select_media_post.php
E:\web\weixun\functions\dialog\select_soft.php
E:\web\weixun\functions\dialog\select_soft_post.php
E:\web\weixun\functions\dialog\select_templets.php
E:\web\weixun\functions\dialog\select_templets_post.php
E:\web\weixun\functions\diyform.cls.php
E:\web\weixun\functions\downmix.inc.php
E:\web\weixun\functions\enums.func.php
E:\web\weixun\functions\extend.func.php
E:\web\weixun\functions\filter.inc.php
E:\web\weixun\functions\ftp.class.php
E:\web\weixun\functions\helpers\archive.helper.php
E:\web\weixun\functions\helpers\cache.helper.php
E:\web\weixun\functions\helpers\channelunit.helper.php
E:\web\weixun\functions\helpers\charset.helper.php
E:\web\weixun\functions\helpers\cookie.helper.php
E:\web\weixun\functions\helpers\debug.helper.php
E:\web\weixun\functions\helpers\downmix.helper.php
E:\web\weixun\functions\helpers\extend.helper.php
E:\web\weixun\functions\helpers\file.helper.php
E:\web\weixun\functions\helpers\filter.helper.php
E:\web\weixun\functions\helpers\image.helper.php
E:\web\weixun\functions\helpers\smiley.helper.php
E:\web\weixun\functions\helpers\string.helper.php
E:\web\weixun\functions\helpers\test.helper.php
E:\web\weixun\functions\helpers\time.helper.php
E:\web\weixun\functions\helpers\upload.helper.php
E:\web\weixun\functions\helpers\util.helper.php
E:\web\weixun\functions\helpers\validate.helper.php
E:\web\weixun\functions\image.class.php
E:\web\weixun\functions\image.func.php
E:\web\weixun\functions\inc\inc_fun_funAdmin.php
E:\web\weixun\functions\inc\inc_fun_funString.php
E:\web\weixun\functions\inc\inc_stat.php
E:\web\weixun\functions\json.class.php
E:\web\weixun\functions\mail.class.php
E:\web\weixun\functions\memberlogin.class.php
E:\web\weixun\functions\membermodel.cls.php
E:\web\weixun\functions\model.class.php
E:\web\weixun\functions\oxwindow.class.php
E:\web\weixun\functions\payment\alipay.php
E:\web\weixun\functions\payment\bank.php
E:\web\weixun\functions\payment\cod.php
E:\web\weixun\functions\payment\yeepay.php
E:\web\weixun\functions\request.class.php
E:\web\weixun\functions\shopcar.class.php
E:\web\weixun\functions\sitemap.class.php
E:\web\weixun\functions\sphinxclient.class.php
E:\web\weixun\functions\splitword.class.php
E:\web\weixun\functions\taglib\ad.lib.php
E:\web\weixun\functions\taglib\adminname.lib.php
E:\web\weixun\functions\taglib\arclist.lib.php
E:\web\weixun\functions\taglib\arclistsg.lib.php
E:\web\weixun\functions\taglib\arcpagelist.lib.php
E:\web\weixun\functions\taglib\ask.lib.php
E:\web\weixun\functions\taglib\asktype.lib.php
E:\web\weixun\functions\taglib\autochannel.lib.php
E:\web\weixun\functions\taglib\banner.lib.php
E:\web\weixun\functions\taglib\bookcontentlist.lib.php
E:\web\weixun\functions\taglib\booklist.lib.php
E:\web\weixun\functions\taglib\bshare.lib.php
E:\web\weixun\functions\taglib\cattree.lib.php
E:\web\weixun\functions\taglib\channel.lib.php
E:\web\weixun\functions\taglib\channel2.lib.php
E:\web\weixun\functions\taglib\channel\img.lib.php
E:\web\weixun\functions\taglib\channel\softlinks.lib.php
E:\web\weixun\functions\taglib\channel\specialtopic.lib.php
E:\web\weixun\functions\taglib\channel\stepselect.lib.php
E:\web\weixun\functions\taglib\channelartlist.lib.php
E:\web\weixun\functions\taglib\channeltitle.lib.php
E:\web\weixun\functions\taglib\demotag.lib.php
E:\web\weixun\functions\taglib\feedback.lib.php
E:\web\weixun\functions\taglib\flink.lib.php
E:\web\weixun\functions\taglib\flinktype.lib.php
E:\web\weixun\functions\taglib\group.lib.php
E:\web\weixun\functions\taglib\groupthread.lib.php
E:\web\weixun\functions\taglib\hotwords.lib.php
E:\web\weixun\functions\taglib\infoguide.lib.php
E:\web\weixun\functions\taglib\infolink.lib.php
E:\web\weixun\functions\taglib\json.lib.php
E:\web\weixun\functions\taglib\likearticle.lib.php
E:\web\weixun\functions\taglib\likepage.lib.php
E:\web\weixun\functions\taglib\likesgpage.lib.php
E:\web\weixun\functions\taglib\loop.lib.php
E:\web\weixun\functions\taglib\memberinfos.lib.php
E:\web\weixun\functions\taglib\memberlist.lib.php
E:\web\weixun\functions\taglib\myad.lib.php
E:\web\weixun\functions\taglib\mynews.lib.php
E:\web\weixun\functions\taglib\mytag.lib.php
E:\web\weixun\functions\taglib\php.lib.php
E:\web\weixun\functions\taglib\productimagelist.lib.php
E:\web\weixun\functions\taglib\rpad.lib.php
E:\web\weixun\functions\taglib\softmsg.lib.php
E:\web\weixun\functions\taglib\sonchannel.lib.php
E:\web\weixun\functions\taglib\sql.lib.php
E:\web\weixun\functions\taglib\tag.lib.php
E:\web\weixun\functions\taglib\type.lib.php
E:\web\weixun\functions\taglib\vote.lib.php
E:\web\weixun\functions\tpllib\plus_ask.php
E:\web\weixun\functions\tpllib\plus_channel.php
E:\web\weixun\functions\tpllib\plus_memberlist.php
E:\web\weixun\functions\tpllib\plus_newvisitor.php
E:\web\weixun\functions\tpllib\plus_spacenewart.php
E:\web\weixun\functions\typelink.class.php
E:\web\weixun\functions\typeunit.class.admin.php
E:\web\weixun\functions\typeunit.class.menu.php
E:\web\weixun\functions\typeunit.class.selector.php
E:\web\weixun\functions\uploadsafe.inc.php
E:\web\weixun\functions\userlogin.class.php
E:\web\weixun\functions\vdimgck.php
E:\web\weixun\functions\wap.inc.php
E:\web\weixun\functions\xakatt.class.php
E:\web\weixun\functions\xakcollection.class.php
E:\web\weixun\functions\xakcollection.func.php
E:\web\weixun\functions\xakhtml2.class.php
E:\web\weixun\functions\xakhttpdown.class.php
E:\web\weixun\functions\xakmodule.class.php
E:\web\weixun\functions\xaksql.class.php
E:\web\weixun\functions\xaksqli.class.php
E:\web\weixun\functions\xaktag.class.php
E:\web\weixun\functions\xaktemplate.class.php
E:\web\weixun\functions\xakvote.class.php
E:\web\weixun\functions\zip.class.php
E:\web\weixun\index.php
E:\web\weixun\install\config.cache.inc.php
E:\web\weixun\install\install.inc.php
E:\web\weixun\install\xakdb.php
E:\web\weixun\module\#buy_action.php#
E:\web\weixun\module\ad_js.php
E:\web\weixun\module\buy_action.php
E:\web\weixun\module\count.php
E:\web\weixun\module\email.php
E:\web\weixun\module\form.php
E:\web\weixun\module\list.php
E:\web\weixun\module\rpad\js.php
E:\web\weixun\module\rpad\rpad_func.php
E:\web\weixun\module\search.php
E:\web\weixun\module\view.php
E:\web\weixun\user\ajax_feedback.php
E:\web\weixun\user\ajax_loginsta.php
E:\web\weixun\user\ajax_membergroup.php
E:\web\weixun\user\album_add.php
E:\web\weixun\user\album_edit.php
E:\web\weixun\user\archives_add.php
E:\web\weixun\user\archives_do.php
E:\web\weixun\user\archives_edit.php
E:\web\weixun\user\archives_sg_add.php
E:\web\weixun\user\archives_sg_edit.php
E:\web\weixun\user\article_add.php
E:\web\weixun\user\article_edit.php
E:\web\weixun\user\buy.php
E:\web\weixun\user\buy_action.php
E:\web\weixun\user\caicai.php
E:\web\weixun\user\check_card.php
E:\web\weixun\user\config.php
E:\web\weixun\user\content_list.php
E:\web\weixun\user\content_sg_list.php
E:\web\weixun\user\control.php
E:\web\weixun\user\edit_baseinfo.php
E:\web\weixun\user\edit_face.php
E:\web\weixun\user\edit_fullinfo.php
E:\web\weixun\user\edit_space_info.php
E:\web\weixun\user\feed.php
E:\web\weixun\user\feedback.php
E:\web\weixun\user\flink_main.php
E:\web\weixun\user\guestbook_admin.php
E:\web\weixun\user\inc\archives_check.php
E:\web\weixun\user\inc\archives_check_edit.php
E:\web\weixun\user\inc\config_pay_alipay.php
E:\web\weixun\user\inc\config_pay_cbpayment.php
E:\web\weixun\user\inc\config_pay_nps.php
E:\web\weixun\user\inc\config_pay_tenpay.php
E:\web\weixun\user\inc\config_pay_yeepay.php
E:\web\weixun\user\inc\config_space.php
E:\web\weixun\user\inc\inc_archives_functions.php
E:\web\weixun\user\inc\inc_batchup.php
E:\web\weixun\user\inc\inc_catalog_options.php
E:\web\weixun\user\inc\inc_list_functions.php
E:\web\weixun\user\inc\inc_pwd_functions.php
E:\web\weixun\user\inc\space_action.php
E:\web\weixun\user\index.php
E:\web\weixun\user\index_do.php
E:\web\weixun\user\login.php
E:\web\weixun\user\mail.php
E:\web\weixun\user\mtypes.php
E:\web\weixun\user\myfriend.php
E:\web\weixun\user\myfriend_group.php
E:\web\weixun\user\mypay.php
E:\web\weixun\user\mystow.php
E:\web\weixun\user\operation.php
E:\web\weixun\user\pm.php
E:\web\weixun\user\reg_new.php
E:\web\weixun\user\resetpassword.php
E:\web\weixun\user\search.php
E:\web\weixun\user\shops_orders.php
E:\web\weixun\user\shops_point.php
E:\web\weixun\user\shops_products.php
E:\web\weixun\user\soft_add.php
E:\web\weixun\user\soft_edit.php
E:\web\weixun\user\spaceskin.php
E:\web\weixun\user\templets\menu.php
E:\web\weixun\user\uploads.php
E:\web\weixun\user\uploads_add.php
E:\web\weixun\user\uploads_edit.php
E:\web\weixun\user\uploads_select.php
E:\web\weixun\user\visit-history.php
E:\web\weixun\xakadmin\action_search.php
E:\web\weixun\xakadmin\actionsearch_class.php
E:\web\weixun\xakadmin\ad_add.php
E:\web\weixun\xakadmin\ad_edit.php
E:\web\weixun\xakadmin\ad_main.php
E:\web\weixun\xakadmin\adtype_main.php
E:\web\weixun\xakadmin\album_add.php
E:\web\weixun\xakadmin\album_edit.php
E:\web\weixun\xakadmin\album_testhtml.php
E:\web\weixun\xakadmin\api_ucenter.php
E:\web\weixun\xakadmin\archives_add.php
E:\web\weixun\xakadmin\archives_do.php
E:\web\weixun\xakadmin\archives_edit.php
E:\web\weixun\xakadmin\archives_sg_add.php
E:\web\weixun\xakadmin\archives_sg_edit.php
E:\web\weixun\xakadmin\article_add.php
E:\web\weixun\xakadmin\article_allowurl_edit.php
E:\web\weixun\xakadmin\article_coonepage_rule.php
E:\web\weixun\xakadmin\article_description_main.php
E:\web\weixun\xakadmin\article_edit.php
E:\web\weixun\xakadmin\article_keywords_main.php
E:\web\weixun\xakadmin\article_keywords_make.php
E:\web\weixun\xakadmin\article_keywords_select.php
E:\web\weixun\xakadmin\article_select_sw.php
E:\web\weixun\xakadmin\article_source_edit.php
E:\web\weixun\xakadmin\article_string_mix.php
E:\web\weixun\xakadmin\article_template_rand.php
E:\web\weixun\xakadmin\article_test_same.php
E:\web\weixun\xakadmin\article_test_title.php
E:\web\weixun\xakadmin\article_writer_edit.php
E:\web\weixun\xakadmin\baidunews.php
E:\web\weixun\xakadmin\cards_make.php
E:\web\weixun\xakadmin\cards_manage.php
E:\web\weixun\xakadmin\cards_type.php
E:\web\weixun\xakadmin\catalog_add.php
E:\web\weixun\xakadmin\catalog_del.php
E:\web\weixun\xakadmin\catalog_do.php
E:\web\weixun\xakadmin\catalog_edit.php
E:\web\weixun\xakadmin\catalog_main.php
E:\web\weixun\xakadmin\catalog_menu.php
E:\web\weixun\xakadmin\co_add.php
E:\web\weixun\xakadmin\co_do.php
E:\web\weixun\xakadmin\co_edit.php
E:\web\weixun\xakadmin\co_edit_text.php
E:\web\weixun\xakadmin\co_export.php
E:\web\weixun\xakadmin\co_export_corule.php
E:\web\weixun\xakadmin\co_gather_start.php
E:\web\weixun\xakadmin\co_gather_start_action.php
E:\web\weixun\xakadmin\co_get_corule.php
E:\web\weixun\xakadmin\co_getsource_url_action.php
E:\web\weixun\xakadmin\co_main.php
E:\web\weixun\xakadmin\co_test_rule.php
E:\web\weixun\xakadmin\co_url.php
E:\web\weixun\xakadmin\co_view.php
E:\web\weixun\xakadmin\config.php
E:\web\weixun\xakadmin\conn.php
E:\web\weixun\xakadmin\content_att.php
E:\web\weixun\xakadmin\content_batch_up.php
E:\web\weixun\xakadmin\content_batchup_action.php
E:\web\weixun\xakadmin\content_i_list.php
E:\web\weixun\xakadmin\content_list.php
E:\web\weixun\xakadmin\content_s_list.php
E:\web\weixun\xakadmin\content_select_list.php
E:\web\weixun\xakadmin\content_sg_list.php
E:\web\weixun\xakadmin\content_tj.php
E:\web\weixun\xakadmin\diy_add.php
E:\web\weixun\xakadmin\diy_edit.php
E:\web\weixun\xakadmin\diy_field_add.php
E:\web\weixun\xakadmin\diy_field_edit.php
E:\web\weixun\xakadmin\diy_list.php
E:\web\weixun\xakadmin\diy_main.php
E:\web\weixun\xakadmin\erraddsave.php
E:\web\weixun\xakadmin\exit.php
E:\web\weixun\xakadmin\feedback_edit.php
E:\web\weixun\xakadmin\feedback_main.php
E:\web\weixun\xakadmin\file_class.php
E:\web\weixun\xakadmin\file_manage_control.php
E:\web\weixun\xakadmin\file_manage_main.php
E:\web\weixun\xakadmin\file_manage_view.php
E:\web\weixun\xakadmin\file_pic_view.php
E:\web\weixun\xakadmin\freelist_add.php
E:\web\weixun\xakadmin\freelist_edit.php
E:\web\weixun\xakadmin\freelist_main.php
E:\web\weixun\xakadmin\friendlink_add.php
E:\web\weixun\xakadmin\friendlink_edit.php
E:\web\weixun\xakadmin\friendlink_main.php
E:\web\weixun\xakadmin\friendlink_type.php
E:\web\weixun\xakadmin\group_edit.php
E:\web\weixun\xakadmin\group_guestbook.php
E:\web\weixun\xakadmin\group_main.php
E:\web\weixun\xakadmin\group_notice.php
E:\web\weixun\xakadmin\group_store.php
E:\web\weixun\xakadmin\group_threads.php
E:\web\weixun\xakadmin\group_user.php
E:\web\weixun\xakadmin\imagecut.php
E:\web\weixun\xakadmin\inc\inc_action_info.php
E:\web\weixun\xakadmin\inc\inc_admin_channel.php
E:\web\weixun\xakadmin\inc\inc_archives_all.php
E:\web\weixun\xakadmin\inc\inc_archives_functions.php
E:\web\weixun\xakadmin\inc\inc_batchup.php
E:\web\weixun\xakadmin\inc\inc_catalog_options.php
E:\web\weixun\xakadmin\inc\inc_coonepage.php
E:\web\weixun\xakadmin\inc\inc_list_functions.php
E:\web\weixun\xakadmin\inc\inc_menu.php
E:\web\weixun\xakadmin\inc\inc_menu_func.php
E:\web\weixun\xakadmin\inc\inc_menu_map.php
E:\web\weixun\xakadmin\inc\inc_menu_module.php
E:\web\weixun\xakadmin\inc\xmenu2.php
E:\web\weixun\xakadmin\inc\xmenu3.php
E:\web\weixun\xakadmin\inc\xmenu4.php
E:\web\weixun\xakadmin\inc\xmenu5.php
E:\web\weixun\xakadmin\inc\xmenu6.php
E:\web\weixun\xakadmin\inc\xmenu7.php
E:\web\weixun\xakadmin\inc\xmenu8.php
E:\web\weixun\xakadmin\inc\xmenu9.php
E:\web\weixun\xakadmin\index.php
E:\web\weixun\xakadmin\index_body.php
E:\web\weixun\xakadmin\index_menu.php
E:\web\weixun\xakadmin\index_menu_load.php
E:\web\weixun\xakadmin\index_menu_module.php
E:\web\weixun\xakadmin\index_testenv.php
E:\web\weixun\xakadmin\index_top.php
E:\web\weixun\xakadmin\log_edit.php
E:\web\weixun\xakadmin\log_list.php
E:\web\weixun\xakadmin\login.php
E:\web\weixun\xakadmin\mail_file_manage.php
E:\web\weixun\xakadmin\mail_getfile.php
E:\web\weixun\xakadmin\mail_send.php
E:\web\weixun\xakadmin\mail_title.php
E:\web\weixun\xakadmin\mail_title_send.php
E:\web\weixun\xakadmin\mail_type.php
E:\web\weixun\xakadmin\makehtml_all.php
E:\web\weixun\xakadmin\makehtml_archives.php
E:\web\weixun\xakadmin\makehtml_archives_action.php
E:\web\weixun\xakadmin\makehtml_freelist.php
E:\web\weixun\xakadmin\makehtml_freelist_action.php
E:\web\weixun\xakadmin\makehtml_homepage.php
E:\web\weixun\xakadmin\makehtml_js.php
E:\web\weixun\xakadmin\makehtml_js_action.php
E:\web\weixun\xakadmin\makehtml_list.php
E:\web\weixun\xakadmin\makehtml_list_action.php
E:\web\weixun\xakadmin\makehtml_map.php
E:\web\weixun\xakadmin\makehtml_map_guide.php
E:\web\weixun\xakadmin\makehtml_rss.php
E:\web\weixun\xakadmin\makehtml_rss_action.php
E:\web\weixun\xakadmin\makehtml_spec.php
E:\web\weixun\xakadmin\makehtml_story.php
E:\web\weixun\xakadmin\makeremote_all.php
E:\web\weixun\xakadmin\media_add.php
E:\web\weixun\xakadmin\media_edit.php
E:\web\weixun\xakadmin\media_main.php
E:\web\weixun\xakadmin\member_do.php
E:\web\weixun\xakadmin\member_feed_edit.php
E:\web\weixun\xakadmin\member_guestbook.php
E:\web\weixun\xakadmin\member_info_main.php
E:\web\weixun\xakadmin\member_main.php
E:\web\weixun\xakadmin\member_model_add.php
E:\web\weixun\xakadmin\member_model_edit.php
E:\web\weixun\xakadmin\member_model_field_add.php
E:\web\weixun\xakadmin\member_model_field_edit.php
E:\web\weixun\xakadmin\member_model_main.php
E:\web\weixun\xakadmin\member_msg_edit.php
E:\web\weixun\xakadmin\member_operations.php
E:\web\weixun\xakadmin\member_pm.php
E:\web\weixun\xakadmin\member_pmall.php
E:\web\weixun\xakadmin\member_pmone.php
E:\web\weixun\xakadmin\member_rank.php
E:\web\weixun\xakadmin\member_scores.php
E:\web\weixun\xakadmin\member_toadmin.php
E:\web\weixun\xakadmin\member_type.php
E:\web\weixun\xakadmin\member_view.php
E:\web\weixun\xakadmin\module_main.php
E:\web\weixun\xakadmin\module_make.php
E:\web\weixun\xakadmin\module_upload.php
E:\web\weixun\xakadmin\mychannel_add.php
E:\web\weixun\xakadmin\mychannel_edit.php
E:\web\weixun\xakadmin\mychannel_field_add.php
E:\web\weixun\xakadmin\mychannel_field_edit.php
E:\web\weixun\xakadmin\mychannel_main.php
E:\web\weixun\xakadmin\mynews_add.php
E:\web\weixun\xakadmin\mynews_edit.php
E:\web\weixun\xakadmin\mynews_main.php
E:\web\weixun\xakadmin\mytag_add.php
E:\web\weixun\xakadmin\mytag_edit.php
E:\web\weixun\xakadmin\mytag_main.php
E:\web\weixun\xakadmin\mytag_tag_guide.php
E:\web\weixun\xakadmin\mytag_tag_guide_ok.php
E:\web\weixun\xakadmin\pic_view.php
E:\web\weixun\xakadmin\plus_edit.php
E:\web\weixun\xakadmin\plus_main.php
E:\web\weixun\xakadmin\public_guide.php
E:\web\weixun\xakadmin\recycling.php
E:\web\weixun\xakadmin\rpad_add.php
E:\web\weixun\xakadmin\rpad_edit.php
E:\web\weixun\xakadmin\rpad_main.php
E:\web\weixun\xakadmin\search_keywords_main.php
E:\web\weixun\xakadmin\shops_delivery.php
E:\web\weixun\xakadmin\shops_operations.php
E:\web\weixun\xakadmin\shops_operations_cart.php
E:\web\weixun\xakadmin\shops_operations_userinfo.php
E:\web\weixun\xakadmin\stepselect_main.php
E:\web\weixun\xakadmin\story_add.php
E:\web\weixun\xakadmin\story_add_action.php
E:\web\weixun\xakadmin\story_add_content.php
E:\web\weixun\xakadmin\story_add_content_action.php
E:\web\weixun\xakadmin\story_add_photo.php
E:\web\weixun\xakadmin\story_add_photo_action.php
E:\web\weixun\xakadmin\story_books.php
E:\web\weixun\xakadmin\story_catalog.php
E:\web\weixun\xakadmin\story_content_edit.php
E:\web\weixun\xakadmin\story_do.php
E:\web\weixun\xakadmin\story_edit.php
E:\web\weixun\xakadmin\story_edit_action.php
E:\web\weixun\xakadmin\story_edit_content_action.php
E:\web\weixun\xakadmin\story_edit_photo_action.php
E:\web\weixun\xakadmin\story_feedback_edit.php
E:\web\weixun\xakadmin\story_feedback_main.php
E:\web\weixun\xakadmin\story_list_chapter.php
E:\web\weixun\xakadmin\story_list_content.php
E:\web\weixun\xakadmin\story_photo_edit.php
E:\web\weixun\xakadmin\swfupload.php
E:\web\weixun\xakadmin\sys_admin_user.php
E:\web\weixun\xakadmin\sys_admin_user_add.php
E:\web\weixun\xakadmin\sys_admin_user_edit.php
E:\web\weixun\xakadmin\sys_admin_user_tj.php
E:\web\weixun\xakadmin\sys_cache_up.php
E:\web\weixun\xakadmin\sys_data.php
E:\web\weixun\xakadmin\sys_data_done.php
E:\web\weixun\xakadmin\sys_data_replace.php
E:\web\weixun\xakadmin\sys_data_revert.php
E:\web\weixun\xakadmin\sys_group.php
E:\web\weixun\xakadmin\sys_group_add.php
E:\web\weixun\xakadmin\sys_group_edit.php
E:\web\weixun\xakadmin\sys_info.php
E:\web\weixun\xakadmin\sys_info_mark.php
E:\web\weixun\xakadmin\sys_multiserv.php
E:\web\weixun\xakadmin\sys_passport.php
E:\web\weixun\xakadmin\sys_payment.php
E:\web\weixun\xakadmin\sys_repair.php
E:\web\weixun\xakadmin\sys_safe.php
E:\web\weixun\xakadmin\sys_safetest.php
E:\web\weixun\xakadmin\sys_sql_info.php
E:\web\weixun\xakadmin\sys_sql_query.php
E:\web\weixun\xakadmin\sys_task.php
E:\web\weixun\xakadmin\sys_task_add.php
E:\web\weixun\xakadmin\sys_task_edit.php
E:\web\weixun\xakadmin\sys_verifies.php
E:\web\weixun\xakadmin\tag_test.php
E:\web\weixun\xakadmin\tag_test_action.php
E:\web\weixun\xakadmin\tags_main.php
E:\web\weixun\xakadmin\task_do.php
E:\web\weixun\xakadmin\templets_main.php
E:\web\weixun\xakadmin\templets_one.php
E:\web\weixun\xakadmin\templets_one_add.php
E:\web\weixun\xakadmin\templets_one_edit.php
E:\web\weixun\xakadmin\templets_tagsource.php
E:\web\weixun\xakadmin\testenv.php
E:\web\weixun\xakadmin\tpl.php
E:\web\weixun\xakadmin\update_guide.php
E:\web\weixun\xakadmin\upload.php
E:\web\weixun\xakadmin\vote_add.php
E:\web\weixun\xakadmin\vote_edit.php
E:\web\weixun\xakadmin\vote_getcode.php
E:\web\weixun\xakadmin\vote_main.php
E:\web\weixun\xakadmin\xmenu2.php
E:\web\weixun\xakadmin\xmenu3.php
E:\web\weixun\xakadmin\xmenu4.php
E:\web\weixun\xakadmin\xmenu5.php
E:\web\weixun\xakadmin\xmenu6.php
E:\web\weixun\xakadmin\xmenu7.php
E:\web\weixun\xakadmin\xmenu8.php
E:\web\weixun\xakadmin\xmenu9.php
